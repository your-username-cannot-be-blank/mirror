
    <html>
      <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <style>
    th, td {
      border: 1px solid black;
      border-collapse: collapse;
    }
    th, td {
      word-wrap: break-word;
      padding: 5px;
    }
    table {
      width: 100%;
      max-width: 100%;
      border: 1px solid black;
      border-collapse: collapse;
      table-layout: fixed;
      word-wrap: break-word
    }
    code {
      word-wrap: break-word;
    }
    pre {
        white-space: pre-wrap;
    }
    </style>
        <title>nekoray-autorun-проблемы</title>
      </head>
      <body>
        <table border="1" width="100%" cellpadding="5">
          <tr>
            <th style="width: 10%;">Ник</th>
            <th>Пост</th>
            <th style="width: 10%;">Дата</th>
          </tr>
    <tr><td>kencarson</td><td><p>Хочу поинтересоваться, удалось ли кому-то нормально настроить автозапуск при старте системы?<br>
Через раз слетает то TUN, то галочка с прокси. А родная опция авторана в принципе не работает, нужно добавлять службу. Это неровности софта, или можно как-то наладить этот момент, чтобы при запуске винды сразу включался TUN вместе с прокси и вообще не вспоминать про него?</p></td><td>2024-10-23T11:45:46.238Z</td></tr><tr><td>MasterYoba</td><td><p>Насколько я помню,  tun режим в windows клиенте nekoray требует запуска с админскими правами, а классический автозапуск с админскими правами невозможен в принципе. Вроде раньше это обходилось через планировщик задач windows, можно сделать задачу запускать приложение с админскими правами.</p>
<p>Пробуйте:</p><aside class="onebox allowlistedgeneric" data-onebox-src="https://www.thewindowsclub.com/autostart-programs-windows-10-make">
  <header class="source">
      <img src="nekoray-autorun-проблемы/cf799727639532e704d5fc65d28ebed2008eef3d.png" class="site-icon" data-dominant-color="0DA2EE" width="32" height="32">

      <a href="https://www.thewindowsclub.com/autostart-programs-windows-10-make" target="_blank" rel="noopener nofollow ugc" title="01:49PM - 28 March 2024">The Windows Club – 28 Mar 24</a>
  </header>

  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:690/394;"><img src="https://ntc.party/uploads/default/original/2X/b/b3271ec44e0a9e2da55f8c3ab145ad265678b86b.webp" class="thumbnail" data-dominant-color="9B8C95" width="690" height="394"></div>

<h3><a href="https://www.thewindowsclub.com/autostart-programs-windows-10-make" target="_blank" rel="noopener nofollow ugc">How to auto start Programs as Administrator without UAC prompt in Windows 11/10</a></h3>

  <p>Learn how to make programs always run or auto start as administrator without UAC, with elevated privileges in Windows, on every boot or start up.</p>


  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>
</td><td>2024-10-23T13:00:12.559Z</td></tr><tr><td>kencarson</td><td><p>С правами всё норм, TUN включается, но не всегда. Проблема именно в хаотичных отлётах либо туна либо прокси</p></td><td>2024-10-23T13:20:24.963Z</td></tr><tr><td>MasterYoba</td><td><p>Можно попробовать клиент без гуя, вроде того же сингбокса, где весь конфиг в текстовом файле. Там галка точно не “слетит”. <img src="https://ntc.party/images/emoji/twitter/slightly_smiling_face.png?v=12" title=":slightly_smiling_face:" class="emoji" alt=":slightly_smiling_face:" loading="lazy" width="20" height="20"><br>
Ну или пробовать альтернативный гуи клиент v2rayn</p></td><td>2024-10-23T13:35:45.728Z</td></tr><tr><td>kencarson</td><td><p>Учитывая то, что каких-либо навыков работы с данными конфигами 0, перспектива сделать всё то же, что даёт некорэй (TUN по белому списку <strong>процессов</strong> и полный байпасс по всему остальному) выглядит крайне туманно. Вопрос больше исходит от того, что может есть какие-то моменты в самом клиенте, которые фиксанут это, потому что я находил пару тем, где ребята просили помочь с автораном (просто чтобы приложение запускалось).</p></td><td>2024-10-23T13:43:10.973Z</td></tr><tr><td>AndreiKopishev(Andrei Kopishev)</td><td><p>Тоже с этим мучался, оно непонятно как работает, решал проблему отключая и включая галочки “Запомнить последний профиль” и “Запускать вместе с системой” потом закрывал NekoRay, перезапускал компьютер и в определенный момент оно начинало работать.</p></td><td>2024-10-23T14:43:02.629Z</td></tr><tr><td>kencarson</td><td><p>прям на постоянке теперь работает? я прост пару раз грузанул норм, потом отпала галка. И помню были посты, где типы настраивали ещё первоначально TUN режим, и часто упоминали, что он бывает багается.</p></td><td>2024-10-23T14:47:31.004Z</td></tr><tr><td>AndreiKopishev(Andrei Kopishev)</td><td><p>Да, на постоянке.</p>
<p>Я именно включал галочки, перезагружал компьютер, потом выключал галочки и так пока не заработает.<br>
Я понимаю как это тупо звучит, но это сработало.</p></td><td>2024-10-23T14:49:54.445Z</td></tr><tr><td>kencarson</td><td><p>прикол, ну, спс конечно, буду пробовать, я щас делаю через службы запуск отложенный на 30 сек, может не успевают прогрузиться какие-то сетевые моменты вовремя</p></td><td>2024-10-23T15:10:19.803Z</td></tr><tr><td>throwaway1</td><td><p>Тоже бодался с некобоксом с такой же проблемой, по итогу просто на сингбокс перешел. Получилось что-то вроде такого:</p>
<ul>
<li>Качаешь <a href="https://github.com/SagerNet/sing-box" rel="noopener nofollow ugc">sing-box</a></li>
<li>Качаешь <a href="https://github.com/SagerNet/sing-geosite" rel="noopener nofollow ugc">geosite.db</a> и <a href="https://github.com/SagerNet/sing-geoip" rel="noopener nofollow ugc">geoip.db</a>, закидываешь их в папку к сингбоксу (очень желательно, чтобы по пути к папке не было русских символов)</li>
<li>Экспортируешь свой конфиг из некобокса: ПКМ по серверу &gt; Share &gt; Export sing-box config &gt; copy core config</li>
<li>Создаешь в папке сингбокса файл config.json и вставляешь в файл свой скопированный конфиг</li>
</ul>
<details>
<summary>
Создаешь в планировщике заданий задачу со следующими параметрами:</summary>
<p><img src="nekoray-autorun-проблемы/56fbd5990aafd0be0fead399f2379b4aab67b143.png" alt="image" data-base62-sha1="cpuC8rEpDJsSemPOWYzFhrRJoQ3" width="632" height="480"><br>
<img src="nekoray-autorun-проблемы/0dadc785e68f66ff25529121dde8e5187a9b521e.png" alt="image" data-base62-sha1="1X0wIC4cQiLgoV5mDFUqGTcmssS" width="632" height="480"><br>
В третьей вкладке создаешь новый action: start a program, туда вставляешь:<br>
<strong>Program \ script</strong>: “путь\к\сингбоксу.exe” со скобочками<br>
<strong>Add arguments</strong>: run -c путь\к\config.json<br>
<img src="nekoray-autorun-проблемы/b775eed2d76dd04978857ee3a17589ea35aae2c9.png" alt="image" data-base62-sha1="qaY2Vla5AMKEzKttHM4QkHG5q5j" width="632" height="480"><br>
Так же в папке с сингбоксом можно создать .bat с такими параметрами, он просто запустит программу в фоне (это на случай, если вдруг захочется иметь ярлык запуска сингбокса на рабочем столе или в панели задач)</p>
<pre><code class="lang-auto">cd /d "%~dp0"
start "sing-box" /min "sing-box.exe" run
</code></pre>
</details></td><td>2024-10-23T17:46:55.531Z</td></tr><tr><td>rewhat</td><td><p>singbox автоматом может качать geosite и geoip кст. Достаточно простого советского…</p>
<pre><code class="lang-auto">  "route": {
    "geoip": {
      "download_detour": "proxy"
    },
    "geosite": {
      "download_detour": "proxy"
    },
</code></pre>
<p>а для сервиса я такие скрипты замутил:</p>
<details>
<summary>
Спойлер</summary>
<p>service_install.ps1</p>
<pre><code class="lang-auto"># Self-elevate the script if required
# https://stackoverflow.com/a/64576446
if (-Not ([Security.Principal.WindowsPrincipal] [Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole] 'Administrator')) {
 if ([int](Get-CimInstance -Class Win32_OperatingSystem | Select-Object -ExpandProperty BuildNumber) -ge 6000) {
  $CommandLine = "-File `"" + $MyInvocation.MyCommand.Path + "`" " + $MyInvocation.UnboundArguments
  Start-Process -FilePath PowerShell.exe -Verb Runas -ArgumentList $CommandLine
  Exit
 }
}

# Stop and delete service.
Stop-Service -Name "SingBox" -ErrorAction SilentlyContinue
sc.exe delete "SingBox"

# Set executable params with cmd /c start /b to prevent locking
$exePath = Join-Path $PSScriptRoot "sing-box.exe"
$serviceConfig = "cmd.exe /c start /b $exePath -D $PSScriptRoot -c config.json run"

# Create service and set description.
sc.exe create "SingBox" binPath= $serviceConfig start= auto
sc.exe description "SingBox" "sing-box VPN"

# Set failure actions to restart the service after 60 seconds if it fails
sc.exe failure "SingBox" reset= 60 actions= restart/60000

# Add a delay to allow the service to initialize properly
Start-Sleep -Seconds 10

# Start service.
Start-Service -Name "SingBox"
</code></pre>
<p>service_uninstall.ps1</p>
<pre><code class="lang-auto"># Self-elevate the script if required
# https://stackoverflow.com/a/64576446
if (-Not ([Security.Principal.WindowsPrincipal] [Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole] 'Administrator')) {
 if ([int](Get-CimInstance -Class Win32_OperatingSystem | Select-Object -ExpandProperty BuildNumber) -ge 6000) {
  $CommandLine = "-File `"" + $MyInvocation.MyCommand.Path + "`" " + $MyInvocation.UnboundArguments
  Start-Process -FilePath PowerShell.exe -Verb Runas -ArgumentList $CommandLine
  Exit
 }
}

# Stop and delete service.
Stop-Service -Name "SingBox" -ErrorAction SilentlyContinue
sc.exe delete "SingBox"

# Wait.
Write-Host -NoNewLine 'Press any key to continue...';
$null = $Host.UI.RawUI.ReadKey('NoEcho,IncludeKeyDown');
</code></pre>
</details></td><td>2024-10-23T17:47:25.844Z</td></tr><tr><td>kencarson</td><td><p>насколько функционал сингбокса идентичен некобоксу? он тунелит отдельные процессы не затрагивая остальной трафик?</p></td><td>2024-10-23T17:55:52.849Z</td></tr><tr><td>rewhat</td><td><p>nekobox это просто обертка на sing-box, просто чтоб удобно было</p></td><td>2024-10-23T17:56:30.548Z</td></tr><tr><td>throwaway1</td><td><p>Некобокс работает на сингбоксе, различий 0. По-факту, некобокс это просто гуй сингбокса.</p></td><td>2024-10-23T17:56:31.816Z</td></tr><tr><td>kencarson</td><td><p>а чтоб переключить сервер, надо будет конфиг получается постоянно менять?</p></td><td>2024-10-23T17:59:47.322Z</td></tr><tr><td>throwaway1</td><td><p>Да, у меня то только 1 сервер, поэтому не испытываю трудностей с этим</p></td><td>2024-10-23T18:01:09.064Z</td></tr><tr><td>kencarson</td><td><p>у меня 3, в целом конечно извернуться там можно, но предпочтительнее было бы с неко как-то эту тему порешать, но в целом вариант выглядит рабочим, попробую, спс</p></td><td>2024-10-23T18:03:26.795Z</td></tr><tr><td>throwaway1</td><td><p>Я слышал, есть еще <a href="https://github.com/GUI-for-Cores/GUI.for.SingBox" rel="noopener nofollow ugc">sing-box gui</a>, но я его не пробовал, поэтому советовать не могу</p></td><td>2024-10-23T18:05:00.019Z</td></tr><tr><td>throwaway1</td><td><p>Спс, попробую</p></td><td>2024-10-23T18:06:55.197Z</td></tr><tr><td>Pony</td><td><p>Это и сейчас замечательно обходится через планировщик <img src="https://ntc.party/images/emoji/twitter/wink.png?v=12" title=":wink:" class="emoji" alt=":wink:" loading="lazy" width="20" height="20"></p></td><td>2024-10-25T09:12:57.302Z</td></tr><tr><td>Anyuta1166</td><td><p>Да, но галочка слетает, это факт. У меня такая же проблема. Никакой отложенный запуск не помогает, хоть на 15 сек, хоть на 5 мин, все равно рандомно при автостарте не включается режим “TUN”.</p></td><td>2024-10-25T10:16:21.144Z</td></tr><tr><td>Pony</td><td><p>Экспортируйте конфиг в sing-box и запускайте через него, или лишь возьмите часть inbound где tun засуньте его к общим настройкам в custom inbound, т.е. по факту приведите конфиг состояние всё в одном  (Встроенный Tun*). Тогда вам будет не важно стоит галочка или нет.</p></td><td>2024-10-25T13:05:34.259Z</td></tr><tr><td>MetalSerCore</td><td><p>Отпишу для кучи, я честно не знаю как получилось это сделать (вроде где-то мисскликнул), автозапуск самого некорэя не работает, но при ручном запуске сразу такое окно и при соглашении автоматом все запускается с включенным TUNом<br>
<img src="nekoray-autorun-проблемы/363b272b02f33c0f3f59434d1e3662c86f9fe8cb.jpeg" alt="1" data-base62-sha1="7JKw7F4dYGEhjzyfiSzikbKRIpR" width="518" height="166"></p></td><td>2024-10-25T15:02:08.900Z</td></tr><tr><td>Anyuta1166</td><td><p>Засунула часть inbound где tun к общим настройкам в custom inbound. Сходу не заработало.<br>
При включенной в GUI галочке “TUN” NekoRay пишет в конфиг <code>"route":{"auto_detect_interface":true,</code>. Но если галочку выключить и сделать финт с custom inbound, то NekoRay в этом месте прописывает false. В итоге tun-интерфейс поднимается, но трафик до VPN-сервера пытается идти через туннель, и ничего не работает.</p></td><td>2024-10-26T07:16:43.018Z</td></tr><tr><td>GagaMaga600(GagaMaga600)</td><td><p>Создать .bat файл<br>
Прописать в него путь к файлу</p>
<blockquote>
<p>start C:\nekoray\nekobox.exe</p>
</blockquote>
<p>Добавить этот .bat в автозапуск с помощью программы Reg Organizer (или любым другим удобным способом), с записью в реестр HKEY_LOCAL_MACHINE <em>(функционал в этой программе)</em></p>
<p>По итогу, после включения компа, nekobox сам запускается <span class="spoiler">в тихом режиме (в трее) <strong>УЖЕ НЕТ</strong></span>, подключается к серверу и подключается к прокси.<br>
С TUN-режимом не прокатывает.</p>
<p><em>p.s.: чёрт меня дёрнул, скачать бета версию nekobox, после возврата на Latest версию, больше не запускается в тихом режиме (в трее), и каждый раз приходится закрывать окно</em></p></td><td>2024-11-05T19:55:44.018Z</td></tr><tr><td>kencarson</td><td><p>Я в итоге просто выставил отложенный на 30 сек запуск, как выше писал.</p>
<p>В планировщике заданий путь прописал /nekobox.exe" -tray , запускается сразу свернуто, без мельканий.</p>
<p>Пока что работает без нареканий, ставил ещё на слабый ноут, при 30 секундах, галочка один раз упала, переставил на 1 мин - всё гладко. Тут были посты, что и при 5 минутах не помогает, поэтому не могу утверждать, что это панацея.</p></td><td>2024-11-06T01:14:29.317Z</td></tr><tr><td>Gruper_duper(Gruper)</td><td><p>Автозапуск с админ правами в windows можно только через планировщика настроить. Можно вручную тыкать галочки и триггеры, но процесс утомительный.</p>
<p>Через вот такой батник все работает как часы:</p>
<details>
<summary>
Автозагрузка Nekoray/nekobox</summary>
<p><span class="mention">@echo</span> off<br>
setlocal</p>
<p>:: Путь к программе<br>
set “program_path=С:\path\nekobox.exe”<br>
set “task_name=NameOfTask”</p>
<p>:: Проверяем, запущен ли BAT-файл с правами администратора<br>
net session &gt;nul 2&gt;&amp;1<br>
if %errorlevel% neq 0 (<br>
echo Запуск с правами администратора…<br>
powershell -Command “Start-Process ‘%~f0’ -Verb RunAs”<br>
exit /b<br>
)</p>
<p>:: Создаём задачу в Планировщике заданий<br>
schtasks /create /tn “%task_name%” /tr “%program_path%” /sc onlogon /rl highest /f</p>
<p>echo Задача создана, программа будет запускаться с правами администратора при входе в систему!<br>
pause</p>
</details>
<p>В Neko после этого галочку “запускаться вместе с системой” обязательно убрать, иначе криво запускаться будет.</p></td><td>2025-01-05T18:03:41.145Z</td></tr><tr><td>notcvnt</td><td><aside class="quote no-group" data-username="kencarson" data-post="1" data-topic="12206" data-full="true">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/kencarson/48/11745_2.png" class="avatar"> kencarson:</div>
<blockquote>
<p>Хочу поинтересоваться, удалось ли кому-то нормально настроить автозапуск при старте системы?<br>
Через раз слетает то TUN, то галочка с прокси. А родная опция авторана в принципе не работает, нужно добавлять службу. Это неровности софта, или можно как-то наладить этот момент, чтобы при запуске винды сразу включался TUN вместе с прокси и вообще не вспоминать про него?</p>
</blockquote>
</aside>
<p>В планировщике задач создать задачу, чтобы при запуске компьютера или при заходе в систему запускался nekobox (nekoray) и поставить галочку на запуск с правами администратора. Поставить в самом nekobox (nekoray) “Запомнить последний профиль” и убрать “Запускаться вместе с системой” Так уже в районе месяца пользуюсь, всем устраивает.</p></td><td>2025-01-10T17:12:48.162Z</td></tr>
    </table>
      </body>
    </html>