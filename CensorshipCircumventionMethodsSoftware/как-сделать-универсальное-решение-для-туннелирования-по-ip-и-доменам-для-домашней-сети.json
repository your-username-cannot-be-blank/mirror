[
    {
        "id": 23063,
        "name": "",
        "username": "pr0act1v3",
        "avatar_template": "/letter_avatar_proxy/v4/letter/p/8dc957/{size}.png",
        "created_at": "2024-02-28T13:25:35.949Z",
        "cooked": "<p>У меня настроена такая система: на мобильных устройствах VPN до дома, дома роутер принимает BGP-маршруты с VPS (на VPS их формирует из общедоступных списков специально отдельный скрипт) и заворачивает часть трафика в VPN. Также дома свои DNS, которые шлют запросы через TLS (DoT).<br>\nПервая проблема возникает с Cloudflare и другими CDN, в которой на одних и тех же адресах могут быть как заблокированные в России или заблокировавшиеся от России, так и российские сайты, которые не любят VPN. Также я замечаю, что некоторые (неправильно настроенные) серверы за Cloudflare, например <a href=\"http://lostfilm.tv\" rel=\"noopener nofollow ugc\">lostfilm.tv</a> вообще не открываются при частичной маршрутизации, ситуацию спасает только полное туннелирование всего трафика.<br>\nВторая проблема - надежность использования решения на наиболее распространенных протоколах VPN в перспективе.</p>\n<p>Промежуточный вариант - использовать наряду с маршрутами к заблокированным IP список заблокированных доменов без их резолвинга в адреса. Но я не нашел никакого более удобного варианта кроме как использовать плагины типа Switchy Omega. Но они не для всех браузеров, и уж точно не для айфонов.</p>\n<p>Я представляю себе решение примерно следующим образом: на домашнем сервере стоит нечто (sing-box, xray, GOST ?), принимающее одновременно и списки IP-адресов, и списки доменов. Роутер отправляет весь исходящий трафик на этот сервер, где принимается решение:</p>\n<ol>\n<li>если TCP (а может можно и UDP?) на 443 порт и в сторону списка доменов, в туннель;</li>\n<li>если иное и в сторону списка адресов, в туннель;</li>\n<li>в противном случае - напрямую.<br>\nДля отработки первого случая, как я понимаю, во всех браузерах один раз нужно будет прописать настройки прокси, работающего на домашнем сервере.</li>\n</ol>\n<p>Вопросы:</p>\n<ol>\n<li>какое приложение использовать в качестве комбайна, чтобы и оба варианта списков мог переваривать мог, и имел входящий proxy, например Socks5?</li>\n<li>как разделить трафик домашнего сервера на трафик самого сервера и входящий-исходящий при наличии одного физического интерфейса? mpls? несколько ip-адресов? как это лучше сделать?</li>\n<li>как сообщать роутеру, какие пакеты куда слать? на ум приходит mpls, ну или в зависимости от того, с какого ip от сервера приходят пакеты.</li>\n</ol>\n<p>Перечитал все известные статьи комрада MiraclePtr с Хабра, но не нашел какого-то более менее универсального варианта. Предложенные варианты клиентов типа nekoray или shadowrocket достаточно гибкие с точки зрения настроек, но это именно клиенты, которые должны ставиться на клиентских устройствах. Я же пытаюсь реализовать так, чтобы с одной стороны был сервер, а с другой - клиент. Видел подобное в китайских прокси (inbounds, outbounds), но так и не смог найти, как это все правильно использовать вместе. Тот же xray в качестве inbounds принимает отдельные протоколы, весь трафик туда направить не получится. А может и не нужно?<br>\nУкажите, пожалуйста, направление <img src=\"https://ntc.party/images/emoji/twitter/slight_smile.png?v=12\" title=\":slight_smile:\" class=\"emoji\" alt=\":slight_smile:\" loading=\"lazy\" width=\"20\" height=\"20\"></p>",
        "post_number": 1,
        "post_type": 1,
        "posts_count": 11,
        "updated_at": "2024-02-28T13:29:58.870Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 1102,
        "reads": 124,
        "readers_count": 123,
        "score": 5509.8,
        "yours": false,
        "topic_id": 7312,
        "topic_slug": "%D0%BA%D0%B0%D0%BA-%D1%81%D0%B4%D0%B5%D0%BB%D0%B0%D1%82%D1%8C-%D1%83%D0%BD%D0%B8%D0%B2%D0%B5%D1%80%D1%81%D0%B0%D0%BB%D1%8C%D0%BD%D0%BE%D0%B5-%D1%80%D0%B5%D1%88%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B4%D0%BB%D1%8F-%D1%82%D1%83%D0%BD%D0%BD%D0%B5%D0%BB%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-%D0%BF%D0%BE-ip-%D0%B8-%D0%B4%D0%BE%D0%BC%D0%B5%D0%BD%D0%B0%D0%BC-%D0%B4%D0%BB%D1%8F-%D0%B4%D0%BE%D0%BC%D0%B0%D1%88%D0%BD%D0%B5%D0%B9-%D1%81%D0%B5%D1%82%D0%B8",
        "display_username": "",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 2,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
            {
                "url": "http://lostfilm.tv",
                "internal": false,
                "reflection": false,
                "clicks": 10
            }
        ],
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 3323,
        "hidden": false,
        "trust_level": 1,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": false,
        "wiki": false,
        "post_url": "/t/%D0%BA%D0%B0%D0%BA-%D1%81%D0%B4%D0%B5%D0%BB%D0%B0%D1%82%D1%8C-%D1%83%D0%BD%D0%B8%D0%B2%D0%B5%D1%80%D1%81%D0%B0%D0%BB%D1%8C%D0%BD%D0%BE%D0%B5-%D1%80%D0%B5%D1%88%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B4%D0%BB%D1%8F-%D1%82%D1%83%D0%BD%D0%BD%D0%B5%D0%BB%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-%D0%BF%D0%BE-ip-%D0%B8-%D0%B4%D0%BE%D0%BC%D0%B5%D0%BD%D0%B0%D0%BC-%D0%B4%D0%BB%D1%8F-%D0%B4%D0%BE%D0%BC%D0%B0%D1%88%D0%BD%D0%B5%D0%B9-%D1%81%D0%B5%D1%82%D0%B8/7312/1",
        "can_translate": false
    },
    {
        "id": 23085,
        "name": "Alexander Borouhin",
        "username": "borouhin",
        "avatar_template": "/user_avatar/ntc.party/borouhin/{size}/3734_2.png",
        "created_at": "2024-02-28T18:30:31.377Z",
        "cooked": "<p>По списку на все вопросы не отвечу, но скажу, как у меня сделано (или планируется сделать). У меня очень похожая система - во всех домах/офисах роутеры, в России сервер для VPN. И плюс отдельный сервер, который по заданным критериям (IP, подсеть, домен, AS) формирует списки, через какую выходную точку (сервер / роутер) маршрутизировать пакеты.  Этот последний сервер по BGP раздаёт получившиеся списки префиксов для каждой выходной точки в виде отдельного BGP community роутерам и VPN-серверу.</p>\n<p>Так вот, что порекомендую из своего опыта по Вашим вопросам:</p>\n<ol>\n<li>\n<p>Во-первых, DNS-сервер должен быть свой, использоваться всеми клиентами в локальной сети и VPN, и именно с использованием этого DNS-сервера должны ресолвится домены для списков маршрутизации (и обновляться периодически). Это спасёт хотя бы от ситуации “сервер для целей маршрутизации выдал IP для одного региона, а клиент у себя получил IP для другого, и маршрут к нему построился неправильно”. Но не спасает от рандомно меняющихся IP, которыми многие CDN и иже с ними грешат. Тут пока что добавляю в списки целыми AS.</p>\n</li>\n<li>\n<p>Во-вторых, отделить и по-разному маршрутизировать трафик клиентов и собственный трафик сервера элементарно, но вот готовую инструкцию тут не напишу, отправлю читать маны <img src=\"https://ntc.party/images/emoji/twitter/slight_smile.png?v=12\" title=\":slight_smile:\" class=\"emoji\" alt=\":slight_smile:\" loading=\"lazy\" width=\"20\" height=\"20\"> Ключевые слова - ip rule, iptables CONNMARK (ну или что там у nftables аналогичное, к стыду своему на них не переполз до сих пор)</p>\n</li>\n<li>\n<p>В-третьих, чтобы полностью решить проблему с рандомными ответами некоторых DNS, а заодно и проблему с ресолвингом по маске домена (*.example.com) вижу один способ - на своём DNS-сервере включить логирование всех запросов (unbound позволяет) и фоном парсить эти логи на предмет соответствия включённым в наши критерии маршрутизации доменам/маскам, при совпадении - обновлять списки префиксов. Но тут надо писать что-то не совсем примитивное (без асинхронности никак), так что до сих пор руки не дошли.</p>\n</li>\n<li>\n<p>В-четвёртых, прокси (VLESS и иже с ними) на текущий момент только добавляют лишней головной боли, особенно если нужен не только доступ к заблокированному, но и доступ к своей сети извне. Amnezia-WG работает, очень шустро, пока не блокируется, но имеет шансы. WG внутри Cloak работает, не так шустро, но приемлемо, шансы блокировки не выше, чем у VLESS со товарищи. Так что между серверами/роутерами я настроил оба этих варианта и OSPF, который перекинет маршрут с амнезии на клоак при отпадании первой автоматически. А для клиентов VPN-сервера - OpenConnect.</p>\n</li>\n</ol>",
        "post_number": 2,
        "post_type": 1,
        "posts_count": 11,
        "updated_at": "2024-02-28T18:33:58.134Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 19,
        "reads": 114,
        "readers_count": 113,
        "score": 117.8,
        "yours": false,
        "topic_id": 7312,
        "topic_slug": "%D0%BA%D0%B0%D0%BA-%D1%81%D0%B4%D0%B5%D0%BB%D0%B0%D1%82%D1%8C-%D1%83%D0%BD%D0%B8%D0%B2%D0%B5%D1%80%D1%81%D0%B0%D0%BB%D1%8C%D0%BD%D0%BE%D0%B5-%D1%80%D0%B5%D1%88%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B4%D0%BB%D1%8F-%D1%82%D1%83%D0%BD%D0%BD%D0%B5%D0%BB%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-%D0%BF%D0%BE-ip-%D0%B8-%D0%B4%D0%BE%D0%BC%D0%B5%D0%BD%D0%B0%D0%BC-%D0%B4%D0%BB%D1%8F-%D0%B4%D0%BE%D0%BC%D0%B0%D1%88%D0%BD%D0%B5%D0%B9-%D1%81%D0%B5%D1%82%D0%B8",
        "display_username": "Alexander Borouhin",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 2682,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": false,
        "wiki": false,
        "post_url": "/t/%D0%BA%D0%B0%D0%BA-%D1%81%D0%B4%D0%B5%D0%BB%D0%B0%D1%82%D1%8C-%D1%83%D0%BD%D0%B8%D0%B2%D0%B5%D1%80%D1%81%D0%B0%D0%BB%D1%8C%D0%BD%D0%BE%D0%B5-%D1%80%D0%B5%D1%88%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B4%D0%BB%D1%8F-%D1%82%D1%83%D0%BD%D0%BD%D0%B5%D0%BB%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-%D0%BF%D0%BE-ip-%D0%B8-%D0%B4%D0%BE%D0%BC%D0%B5%D0%BD%D0%B0%D0%BC-%D0%B4%D0%BB%D1%8F-%D0%B4%D0%BE%D0%BC%D0%B0%D1%88%D0%BD%D0%B5%D0%B9-%D1%81%D0%B5%D1%82%D0%B8/7312/2",
        "can_translate": false
    },
    {
        "id": 23091,
        "name": "",
        "username": "pr0act1v3",
        "avatar_template": "/letter_avatar_proxy/v4/letter/p/8dc957/{size}.png",
        "created_at": "2024-02-28T21:14:05.801Z",
        "cooked": "<p>Спасибо за советы!</p>\n<ol>\n<li>У меня уже все готово, за исключением того, что DNS для дома и мобильных устройств, а VPS ресолвит всё сам. Попробую проверить, станет ли лучше, если VPS начнет обращаться к домашним DNS.</li>\n<li>Уже использую connection mark, но не думал, что можно в таком ключе! Но если речь об опросе DNS, возможно лучше приглядеться к другим вариантам (см. дальше).</li>\n<li>Похоже на то, что было описано в статье <a href=\"https://habr.com/ru/articles/467547/\" class=\"inline-onebox\" rel=\"noopener nofollow ugc\">Обход блокировок РКН с помощью DNSTap и BGP / Хабр</a>. Вероятно под это дело можно взять отдельное готовое приложение для сбора логов с DNS, и тогда запариваться с асинхронностью лишний раз не придется. Ещё автор предлагает манипулировать маршрутами, полученными на основании анализа DNS, с помощью BGP с небольшим TTL.</li>\n<li>Тоже настроил для входящих домой как резервные варианты, в том числе OpenConnect. Про наводку Wireguard + Cloak для исходящих также спасибо, буду думать.</li>\n</ol>",
        "post_number": 3,
        "post_type": 1,
        "posts_count": 11,
        "updated_at": "2024-02-28T21:16:24.909Z",
        "reply_count": 1,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 9,
        "reads": 105,
        "readers_count": 104,
        "score": 71.0,
        "yours": false,
        "topic_id": 7312,
        "topic_slug": "%D0%BA%D0%B0%D0%BA-%D1%81%D0%B4%D0%B5%D0%BB%D0%B0%D1%82%D1%8C-%D1%83%D0%BD%D0%B8%D0%B2%D0%B5%D1%80%D1%81%D0%B0%D0%BB%D1%8C%D0%BD%D0%BE%D0%B5-%D1%80%D0%B5%D1%88%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B4%D0%BB%D1%8F-%D1%82%D1%83%D0%BD%D0%BD%D0%B5%D0%BB%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-%D0%BF%D0%BE-ip-%D0%B8-%D0%B4%D0%BE%D0%BC%D0%B5%D0%BD%D0%B0%D0%BC-%D0%B4%D0%BB%D1%8F-%D0%B4%D0%BE%D0%BC%D0%B0%D1%88%D0%BD%D0%B5%D0%B9-%D1%81%D0%B5%D1%82%D0%B8",
        "display_username": "",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
            {
                "url": "https://habr.com/ru/articles/467547/",
                "internal": false,
                "reflection": false,
                "title": "Обход блокировок РКН с помощью DNSTap и BGP / Хабр",
                "clicks": 45
            }
        ],
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 3323,
        "hidden": false,
        "trust_level": 1,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": false,
        "wiki": false,
        "post_url": "/t/%D0%BA%D0%B0%D0%BA-%D1%81%D0%B4%D0%B5%D0%BB%D0%B0%D1%82%D1%8C-%D1%83%D0%BD%D0%B8%D0%B2%D0%B5%D1%80%D1%81%D0%B0%D0%BB%D1%8C%D0%BD%D0%BE%D0%B5-%D1%80%D0%B5%D1%88%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B4%D0%BB%D1%8F-%D1%82%D1%83%D0%BD%D0%BD%D0%B5%D0%BB%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-%D0%BF%D0%BE-ip-%D0%B8-%D0%B4%D0%BE%D0%BC%D0%B5%D0%BD%D0%B0%D0%BC-%D0%B4%D0%BB%D1%8F-%D0%B4%D0%BE%D0%BC%D0%B0%D1%88%D0%BD%D0%B5%D0%B9-%D1%81%D0%B5%D1%82%D0%B8/7312/3",
        "can_translate": false
    },
    {
        "id": 23092,
        "name": "Alexander Borouhin",
        "username": "borouhin",
        "avatar_template": "/user_avatar/ntc.party/borouhin/{size}/3734_2.png",
        "created_at": "2024-02-28T21:48:10.756Z",
        "cooked": "<p>Хм… за наводку на DNSTap (точнее, dnstap-bgp) спасибо, оно, по ходу, делает бóльшую часть того, что я собирался писать сам.</p>\n<p>Про WG через Cloak - для понимания тяжести проблемы, на трансграничном канале, который выдаёт около 800 Мбит/с без всяких туннелей, WG и Amnezia-WG выжимают около 600 Мбит/с <em>(Амнезия почти не снижает скорость, но несколько больше нагружает CPU, чем обычный WG, который на уровне ядра)</em>, - WG через Cloak выдаёт около 250 Мбит/с. Не знаю, можно ли эту пропорцию экстраполировать на более и менее широкие каналы, но для грубой оценки, думаю, можно взять, а там смотрите, насколько для Вас это критично. VLESS должен дать большую скорость, но если надо обеспечить полноценную связность сетей по обе стороны туннеля - это так себе решается через VLESS.</p>",
        "post_number": 4,
        "post_type": 1,
        "posts_count": 11,
        "updated_at": "2024-02-28T21:58:39.720Z",
        "reply_count": 1,
        "reply_to_post_number": 3,
        "quote_count": 0,
        "incoming_link_count": 4,
        "reads": 98,
        "readers_count": 97,
        "score": 44.6,
        "yours": false,
        "topic_id": 7312,
        "topic_slug": "%D0%BA%D0%B0%D0%BA-%D1%81%D0%B4%D0%B5%D0%BB%D0%B0%D1%82%D1%8C-%D1%83%D0%BD%D0%B8%D0%B2%D0%B5%D1%80%D1%81%D0%B0%D0%BB%D1%8C%D0%BD%D0%BE%D0%B5-%D1%80%D0%B5%D1%88%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B4%D0%BB%D1%8F-%D1%82%D1%83%D0%BD%D0%BD%D0%B5%D0%BB%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-%D0%BF%D0%BE-ip-%D0%B8-%D0%B4%D0%BE%D0%BC%D0%B5%D0%BD%D0%B0%D0%BC-%D0%B4%D0%BB%D1%8F-%D0%B4%D0%BE%D0%BC%D0%B0%D1%88%D0%BD%D0%B5%D0%B9-%D1%81%D0%B5%D1%82%D0%B8",
        "display_username": "Alexander Borouhin",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 2,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "reply_to_user": {
            "username": "pr0act1v3",
            "name": "",
            "avatar_template": "/letter_avatar_proxy/v4/letter/p/8dc957/{size}.png"
        },
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 2682,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": false,
        "wiki": false,
        "post_url": "/t/%D0%BA%D0%B0%D0%BA-%D1%81%D0%B4%D0%B5%D0%BB%D0%B0%D1%82%D1%8C-%D1%83%D0%BD%D0%B8%D0%B2%D0%B5%D1%80%D1%81%D0%B0%D0%BB%D1%8C%D0%BD%D0%BE%D0%B5-%D1%80%D0%B5%D1%88%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B4%D0%BB%D1%8F-%D1%82%D1%83%D0%BD%D0%BD%D0%B5%D0%BB%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-%D0%BF%D0%BE-ip-%D0%B8-%D0%B4%D0%BE%D0%BC%D0%B5%D0%BD%D0%B0%D0%BC-%D0%B4%D0%BB%D1%8F-%D0%B4%D0%BE%D0%BC%D0%B0%D1%88%D0%BD%D0%B5%D0%B9-%D1%81%D0%B5%D1%82%D0%B8/7312/4",
        "can_translate": false
    },
    {
        "id": 23160,
        "name": "",
        "username": "pr0act1v3",
        "avatar_template": "/letter_avatar_proxy/v4/letter/p/8dc957/{size}.png",
        "created_at": "2024-02-29T17:31:37.353Z",
        "cooked": "<p>Я думаю, что лучше настроить больше и всего сразу и выбирать лучше из того, что работает, чем потом в спешке что-то прикручивать, когда РКН запустит в пульт гаечным ключом, как это было с “блокировкой” Телеграма.</p>\n<p>И всё-таки возвращаясь к моему вопросу: а что если попробовать сделать прям собственный DPI с маркировкой пакетов? Понятно, что железо при этом потребуется производительнее, но и поставить старый компьютер под такое дело - не проблема. Я нахожу и опенсорсные решения, только не совсем представляю (нет опыта работы с DPI), насколько их можно использовать не для блокировки трафика (как IDS/IPS), а именно для маркировки с последующей маршрутизацией.</p>",
        "post_number": 5,
        "post_type": 1,
        "posts_count": 11,
        "updated_at": "2024-02-29T17:31:37.353Z",
        "reply_count": 1,
        "reply_to_post_number": 4,
        "quote_count": 0,
        "incoming_link_count": 1,
        "reads": 86,
        "readers_count": 85,
        "score": 27.2,
        "yours": false,
        "topic_id": 7312,
        "topic_slug": "%D0%BA%D0%B0%D0%BA-%D1%81%D0%B4%D0%B5%D0%BB%D0%B0%D1%82%D1%8C-%D1%83%D0%BD%D0%B8%D0%B2%D0%B5%D1%80%D1%81%D0%B0%D0%BB%D1%8C%D0%BD%D0%BE%D0%B5-%D1%80%D0%B5%D1%88%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B4%D0%BB%D1%8F-%D1%82%D1%83%D0%BD%D0%BD%D0%B5%D0%BB%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-%D0%BF%D0%BE-ip-%D0%B8-%D0%B4%D0%BE%D0%BC%D0%B5%D0%BD%D0%B0%D0%BC-%D0%B4%D0%BB%D1%8F-%D0%B4%D0%BE%D0%BC%D0%B0%D1%88%D0%BD%D0%B5%D0%B9-%D1%81%D0%B5%D1%82%D0%B8",
        "display_username": "",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "reply_to_user": {
            "username": "borouhin",
            "name": "Alexander Borouhin",
            "avatar_template": "/user_avatar/ntc.party/borouhin/{size}/3734_2.png"
        },
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 3323,
        "hidden": false,
        "trust_level": 1,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": false,
        "wiki": false,
        "post_url": "/t/%D0%BA%D0%B0%D0%BA-%D1%81%D0%B4%D0%B5%D0%BB%D0%B0%D1%82%D1%8C-%D1%83%D0%BD%D0%B8%D0%B2%D0%B5%D1%80%D1%81%D0%B0%D0%BB%D1%8C%D0%BD%D0%BE%D0%B5-%D1%80%D0%B5%D1%88%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B4%D0%BB%D1%8F-%D1%82%D1%83%D0%BD%D0%BD%D0%B5%D0%BB%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-%D0%BF%D0%BE-ip-%D0%B8-%D0%B4%D0%BE%D0%BC%D0%B5%D0%BD%D0%B0%D0%BC-%D0%B4%D0%BB%D1%8F-%D0%B4%D0%BE%D0%BC%D0%B0%D1%88%D0%BD%D0%B5%D0%B9-%D1%81%D0%B5%D1%82%D0%B8/7312/5",
        "can_translate": false
    },
    {
        "id": 23164,
        "name": "Alexander Borouhin",
        "username": "borouhin",
        "avatar_template": "/user_avatar/ntc.party/borouhin/{size}/3734_2.png",
        "created_at": "2024-02-29T17:59:47.084Z",
        "cooked": "<p>Не понимаю, чем Вам MARK/CONNMARK не такой “DPI” (ну точнее тут нет DPI, но маркировка пакетов это и есть в чистом виде)? Вы именно что добавляете к каждому пакету (а для CONNMARK - и к последующим пакетам того же соединения) дополнительное поле, по которому потом можно или в следующих цепочках обрабатывать, или в другую таблицу маршрутизации отправлять.</p>\n<p>P.S. А, понял, Вы хотите в Layer 7 залезть для классификации пакетов, так? Ну тогда возьмите какой-нибудь <a href=\"https://github.com/ntop/nDPI\" rel=\"noopener nofollow ugc\">nDPI</a> и лезьте <img src=\"https://ntc.party/images/emoji/twitter/slight_smile.png?v=12\" title=\":slight_smile:\" class=\"emoji\" alt=\":slight_smile:\" loading=\"lazy\" width=\"20\" height=\"20\"><br>\nP.P.S. Однако, со времён, когда я в эту сторону смотрел, многое изменилось <img src=\"https://ntc.party/images/emoji/twitter/thinking.png?v=12\" title=\":thinking:\" class=\"emoji\" alt=\":thinking:\" loading=\"lazy\" width=\"20\" height=\"20\"> Раньше можно было собрать <a href=\"https://github.com/betolj/ndpi-netfilter/\" rel=\"noopener nofollow ugc\">ndpi-netfilter</a> и прямо в iptables использовать возможности этой библиотеки, а сейчас этот проект мёртвый, авторы ndpi предлагают использовать свой продукт nprobe за денежку… в общем, надо разбираться.</p>",
        "post_number": 6,
        "post_type": 1,
        "posts_count": 11,
        "updated_at": "2024-02-29T18:16:00.462Z",
        "reply_count": 0,
        "reply_to_post_number": 5,
        "quote_count": 0,
        "incoming_link_count": 19,
        "reads": 85,
        "readers_count": 84,
        "score": 112.0,
        "yours": false,
        "topic_id": 7312,
        "topic_slug": "%D0%BA%D0%B0%D0%BA-%D1%81%D0%B4%D0%B5%D0%BB%D0%B0%D1%82%D1%8C-%D1%83%D0%BD%D0%B8%D0%B2%D0%B5%D1%80%D1%81%D0%B0%D0%BB%D1%8C%D0%BD%D0%BE%D0%B5-%D1%80%D0%B5%D1%88%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B4%D0%BB%D1%8F-%D1%82%D1%83%D0%BD%D0%BD%D0%B5%D0%BB%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-%D0%BF%D0%BE-ip-%D0%B8-%D0%B4%D0%BE%D0%BC%D0%B5%D0%BD%D0%B0%D0%BC-%D0%B4%D0%BB%D1%8F-%D0%B4%D0%BE%D0%BC%D0%B0%D1%88%D0%BD%D0%B5%D0%B9-%D1%81%D0%B5%D1%82%D0%B8",
        "display_username": "Alexander Borouhin",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 3,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
            {
                "url": "https://github.com/ntop/nDPI",
                "internal": false,
                "reflection": false,
                "title": "GitHub - ntop/nDPI: Open Source Deep Packet Inspection Software Toolkit",
                "clicks": 4
            },
            {
                "url": "https://github.com/betolj/ndpi-netfilter/",
                "internal": false,
                "reflection": false,
                "title": "GitHub - betolj/ndpi-netfilter",
                "clicks": 0
            }
        ],
        "read": true,
        "user_title": null,
        "reply_to_user": {
            "username": "pr0act1v3",
            "name": "",
            "avatar_template": "/letter_avatar_proxy/v4/letter/p/8dc957/{size}.png"
        },
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 2682,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": false,
        "wiki": false,
        "post_url": "/t/%D0%BA%D0%B0%D0%BA-%D1%81%D0%B4%D0%B5%D0%BB%D0%B0%D1%82%D1%8C-%D1%83%D0%BD%D0%B8%D0%B2%D0%B5%D1%80%D1%81%D0%B0%D0%BB%D1%8C%D0%BD%D0%BE%D0%B5-%D1%80%D0%B5%D1%88%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B4%D0%BB%D1%8F-%D1%82%D1%83%D0%BD%D0%BD%D0%B5%D0%BB%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-%D0%BF%D0%BE-ip-%D0%B8-%D0%B4%D0%BE%D0%BC%D0%B5%D0%BD%D0%B0%D0%BC-%D0%B4%D0%BB%D1%8F-%D0%B4%D0%BE%D0%BC%D0%B0%D1%88%D0%BD%D0%B5%D0%B9-%D1%81%D0%B5%D1%82%D0%B8/7312/6",
        "can_translate": false
    },
    {
        "id": 23184,
        "name": null,
        "username": "ValdikSS",
        "avatar_template": "/user_avatar/ntc.party/valdikss/{size}/2_2.png",
        "created_at": "2024-02-29T21:21:12.696Z",
        "cooked": "<p>Есть четыре принципиальных подхода к решению задачи:</p>\n<ol>\n<li>\n<p>То, что у вас или у <a class=\"mention\" href=\"/u/borouhin\">@borouhin</a> сейчас, в каком-либо виде, сводящееся к маршрутизации по IP-адресам. Пре-резолв заблокированных доменов, динамическое добавление маршрутов через <code>dnsmasq ipset</code>/dnstap — не принципиально.</p>\n</li>\n<li>\n<p>Анализ доменов на уровне DNS и переадресация заблокированных в какие-то другие IP-адреса (как в <a href=\"https://antizapret.prostovpn.org:8443/tech.html#vpn\">VPN АнтиЗапрета</a>).<br>\nРеализовано в</p>\n<ul>\n<li><a href=\"https://bitbucket.org/anticensority/antizapret-vpn-container/src/master/mkosi/mkosi.extra/root/dnsmap/proxy.py\">АнтиЗапрете</a></li>\n<li><a href=\"https://github.com/stek29/myazvpn\" class=\"inline-onebox\">GitHub - stek29/myazvpn: my (re)implementation of antizapret like vpn</a></li>\n</ul>\n</li>\n<li>\n<p>Выборочное или полное перенаправление TCP/UDP-трафика на локальный прокси с поддержкой «<a href=\"https://www.v2fly.org/v5/config/inbound.html#sniffingobject\">сниффига</a>» (анализа HTTP/TLS/QUIC-пакетов и вычленения домена) и правил маршрутизации: v2fly/xray/sing-box сотоварищи.<br>\nВам не нужен Socks5 в качестве inbound, используйте то, что понимает iptables redirect. В v2fly это называется <a href=\"https://www.v2fly.org/en_US/config/protocols/dokodemo.html\">dokodemo-door</a>.</p>\n</li>\n<li>\n<p>«Сниффинг» домена на уровне netfilter и перенаправление трафика на уровне маршрутизации метками или как-либо еще («свой DPI»). Если распарсить пакет и определить домен достаточно просто:</p>\n<ul>\n<li><a href=\"https://github.com/Lochnair/xt_tls\" class=\"inline-onebox\">GitHub - Lochnair/xt_tls: Filter TLS traffic with IPtables</a></li>\n<li><a href=\"https://github.com/gibbon4ik/xt_tlslist\" class=\"inline-onebox\">GitHub - gibbon4ik/xt_tlslist: xt_tlslist is an extension for netfilter/IPtables that allows you to filter traffic based on TLS hostnames</a></li>\n</ul>\n<p>то перенаправление по другому маршруту/интерфейсу потребует <a href=\"https://habr.com/ru/news/667096/comments/#comment_24367298\">переустановки соединения</a>, каких-либо готовых инструментов для этого я не знаю.</p>\n</li>\n</ol>\n<p>Первый подход чреват оверинжинирингом всего и вся, но не решает проблем, с которыми вы же и столкнулись. То, что вы здесь описываете с bgp-dnstap сродни выкидывания мусора в иллюминатор с МКС.<br>\nВторой требует использования только DNS сервера, и с другими работать не будет. Если какое-либо приложение внутри себя использует сторонний DNS/DoH, либо же просто устанавливает соединение по фиксированному адресу, то DNS этого не поймает.<br>\nТретий способ легко и гибко конфигурируется, но также легко отбирает у вас <em>все</em> возможности по маршрутизации на сетевом уровне. Не знаю, как в аналогах, но в v2fly <a href=\"https://github.com/v2fly/v2ray-core/issues/2665\">сломан mark на freedom outbound</a>, остаются, разве что, разные source ip-адреса в качестве возможной метки.<br>\nЧетвертый способ самый прикольный (и позволит делать и другие вещи, как например, прозрачное перенаправление bittorrent-трафика через другой канал), но нет реализаций, и сделать её правильно может быть не так тривиально, как кажется.</p>",
        "post_number": 7,
        "post_type": 1,
        "posts_count": 11,
        "updated_at": "2024-02-29T21:21:12.696Z",
        "reply_count": 1,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 23,
        "reads": 76,
        "readers_count": 75,
        "score": 135.2,
        "yours": false,
        "topic_id": 7312,
        "topic_slug": "%D0%BA%D0%B0%D0%BA-%D1%81%D0%B4%D0%B5%D0%BB%D0%B0%D1%82%D1%8C-%D1%83%D0%BD%D0%B8%D0%B2%D0%B5%D1%80%D1%81%D0%B0%D0%BB%D1%8C%D0%BD%D0%BE%D0%B5-%D1%80%D0%B5%D1%88%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B4%D0%BB%D1%8F-%D1%82%D1%83%D0%BD%D0%BD%D0%B5%D0%BB%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-%D0%BF%D0%BE-ip-%D0%B8-%D0%B4%D0%BE%D0%BC%D0%B5%D0%BD%D0%B0%D0%BC-%D0%B4%D0%BB%D1%8F-%D0%B4%D0%BE%D0%BC%D0%B0%D1%88%D0%BD%D0%B5%D0%B9-%D1%81%D0%B5%D1%82%D0%B8",
        "display_username": null,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
            {
                "url": "https://github.com/stek29/myazvpn",
                "internal": false,
                "reflection": false,
                "title": "GitHub - stek29/myazvpn: my (re)implementation of antizapret like vpn",
                "clicks": 16
            },
            {
                "url": "https://antizapret.prostovpn.org:8443/tech.html#vpn",
                "internal": false,
                "reflection": false,
                "clicks": 15
            },
            {
                "url": "https://bitbucket.org/anticensority/antizapret-vpn-container/src/master/mkosi/mkosi.extra/root/dnsmap/proxy.py",
                "internal": false,
                "reflection": false,
                "title": "Bitbucket",
                "clicks": 11
            },
            {
                "url": "https://www.v2fly.org/en_US/config/protocols/dokodemo.html",
                "internal": false,
                "reflection": false,
                "title": "Dokodemo-door | V2Fly.org",
                "clicks": 5
            },
            {
                "url": "https://github.com/gibbon4ik/xt_tlslist",
                "internal": false,
                "reflection": false,
                "title": "GitHub - gibbon4ik/xt_tlslist: xt_tlslist is an extension for netfilter/IPtables that allows you to filter traffic based on TLS hostnames",
                "clicks": 4
            },
            {
                "url": "https://www.v2fly.org/v5/config/inbound.html#sniffingobject",
                "internal": false,
                "reflection": false,
                "title": "Inbounds | V2Fly.org",
                "clicks": 3
            },
            {
                "url": "https://github.com/v2fly/v2ray-core/issues/2665",
                "internal": false,
                "reflection": false,
                "title": "direct freedom outbound traffic doesn't get marked · Issue #2665 · v2fly/v2ray-core · GitHub",
                "clicks": 2
            },
            {
                "url": "https://github.com/Lochnair/xt_tls",
                "internal": false,
                "reflection": false,
                "title": "GitHub - Lochnair/xt_tls: Filter TLS traffic with IPtables",
                "clicks": 2
            },
            {
                "url": "https://habr.com/ru/news/667096/comments/#comment_24367298",
                "internal": false,
                "reflection": false,
                "title": "В России блокируют доступ к сетям Cloudflare и Digital Ocean / Комментарии / Хабр",
                "clicks": 1
            }
        ],
        "read": true,
        "user_title": "AntiZapret staff",
        "title_is_group": false,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": true,
        "admin": true,
        "staff": true,
        "user_id": 1,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": false,
        "wiki": false,
        "post_url": "/t/%D0%BA%D0%B0%D0%BA-%D1%81%D0%B4%D0%B5%D0%BB%D0%B0%D1%82%D1%8C-%D1%83%D0%BD%D0%B8%D0%B2%D0%B5%D1%80%D1%81%D0%B0%D0%BB%D1%8C%D0%BD%D0%BE%D0%B5-%D1%80%D0%B5%D1%88%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B4%D0%BB%D1%8F-%D1%82%D1%83%D0%BD%D0%BD%D0%B5%D0%BB%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-%D0%BF%D0%BE-ip-%D0%B8-%D0%B4%D0%BE%D0%BC%D0%B5%D0%BD%D0%B0%D0%BC-%D0%B4%D0%BB%D1%8F-%D0%B4%D0%BE%D0%BC%D0%B0%D1%88%D0%BD%D0%B5%D0%B9-%D1%81%D0%B5%D1%82%D0%B8/7312/7",
        "can_translate": false
    },
    {
        "id": 23189,
        "name": "Alexander Borouhin",
        "username": "borouhin",
        "avatar_template": "/user_avatar/ntc.party/borouhin/{size}/3734_2.png",
        "created_at": "2024-02-29T23:28:55.723Z",
        "cooked": "<p>Мне кажется, если всё-таки решать более общую задачу, кроме первого способа ничего и не остаётся.</p>\n<p>Когда у нас один список заблокированных доменов, который для всех клиентов надо маршрутизировать через один сервер, - могут быть варианты. А когда, как у меня сейчас, семь списков, четыре выходных точки, и в каждом сегменте сети свои настройки, какой список через какую точку маршрутизировать… (простейший пример - для зарубежного сегмента список GeoIP-RU перенаправляем через российский сервер, а для российского игнорируем его, а для списка РКН наоборот). При этом списки могут формироваться как из готовых перечней IP/подстей/AS/GeoIP/доменов/масок, так и динамически (пример - турецкие блокировки, единого реестра, который можно скачать, нет, но есть сервис, который позволяет проверить, заблокирован ли IP/домен).</p>\n<p>В общем, как только задачка становится чуть более широкой, а в нынешних непростых условиях она неизбежно становится <img src=\"https://ntc.party/images/emoji/twitter/slight_smile.png?v=12\" title=\":slight_smile:\" class=\"emoji\" alt=\":slight_smile:\" loading=\"lazy\" width=\"20\" height=\"20\"> - вариант 1 это не оверинжиниринг, а суровая необходимость. Вообще в идеале хотелось бы сделать максимально модульную систему, к которой любая новая страна добавляется путём заведения в оной VPSки и изменения конфига.</p>",
        "post_number": 8,
        "post_type": 1,
        "posts_count": 11,
        "updated_at": "2024-02-29T23:28:55.723Z",
        "reply_count": 1,
        "reply_to_post_number": 7,
        "quote_count": 0,
        "incoming_link_count": 2,
        "reads": 70,
        "readers_count": 69,
        "score": 29.0,
        "yours": false,
        "topic_id": 7312,
        "topic_slug": "%D0%BA%D0%B0%D0%BA-%D1%81%D0%B4%D0%B5%D0%BB%D0%B0%D1%82%D1%8C-%D1%83%D0%BD%D0%B8%D0%B2%D0%B5%D1%80%D1%81%D0%B0%D0%BB%D1%8C%D0%BD%D0%BE%D0%B5-%D1%80%D0%B5%D1%88%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B4%D0%BB%D1%8F-%D1%82%D1%83%D0%BD%D0%BD%D0%B5%D0%BB%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-%D0%BF%D0%BE-ip-%D0%B8-%D0%B4%D0%BE%D0%BC%D0%B5%D0%BD%D0%B0%D0%BC-%D0%B4%D0%BB%D1%8F-%D0%B4%D0%BE%D0%BC%D0%B0%D1%88%D0%BD%D0%B5%D0%B9-%D1%81%D0%B5%D1%82%D0%B8",
        "display_username": "Alexander Borouhin",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "reply_to_user": {
            "username": "ValdikSS",
            "name": null,
            "avatar_template": "/user_avatar/ntc.party/valdikss/{size}/2_2.png"
        },
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 2682,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": false,
        "wiki": false,
        "post_url": "/t/%D0%BA%D0%B0%D0%BA-%D1%81%D0%B4%D0%B5%D0%BB%D0%B0%D1%82%D1%8C-%D1%83%D0%BD%D0%B8%D0%B2%D0%B5%D1%80%D1%81%D0%B0%D0%BB%D1%8C%D0%BD%D0%BE%D0%B5-%D1%80%D0%B5%D1%88%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B4%D0%BB%D1%8F-%D1%82%D1%83%D0%BD%D0%BD%D0%B5%D0%BB%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-%D0%BF%D0%BE-ip-%D0%B8-%D0%B4%D0%BE%D0%BC%D0%B5%D0%BD%D0%B0%D0%BC-%D0%B4%D0%BB%D1%8F-%D0%B4%D0%BE%D0%BC%D0%B0%D1%88%D0%BD%D0%B5%D0%B9-%D1%81%D0%B5%D1%82%D0%B8/7312/8",
        "can_translate": false
    },
    {
        "id": 23217,
        "name": "",
        "username": "pr0act1v3",
        "avatar_template": "/letter_avatar_proxy/v4/letter/p/8dc957/{size}.png",
        "created_at": "2024-03-01T15:28:29.044Z",
        "cooked": "<p><a class=\"mention\" href=\"/u/valdikss\">@ValdikSS</a>, спасибо большое за подробный ликбез. К четвертому подходу я слабо представляю как подступиться (сохранять весь трафик и посылать повторные запросы от нового адреса с DPI-сервера, а потом переписывать ответные пакеты с помощью dynamic NAT для RELATED и ESTABLISHED?).<br>\nДа, подход с dnstap и мне кажется чрезчур наивным, поэтому я склоняюсь к третьему варианту из перечисленных. И мне кажется, что такой вариант позволяет</p>\n<aside class=\"quote no-group\" data-username=\"borouhin\" data-post=\"8\" data-topic=\"7312\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://ntc.party/user_avatar/ntc.party/borouhin/48/3734_2.png\" class=\"avatar\"> borouhin:</div>\n<blockquote>\n<p>сделать максимально модульную систему, к которой любая новая страна добавляется путём заведения в оной VPSки и изменения конфига</p>\n</blockquote>\n</aside>\n<p>А ещё</p>\n<aside class=\"quote no-group\" data-username=\"borouhin\" data-post=\"8\" data-topic=\"7312\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://ntc.party/user_avatar/ntc.party/borouhin/48/3734_2.png\" class=\"avatar\"> borouhin:</div>\n<blockquote>\n<p>семь списков, четыре выходных точки, и в каждом сегменте сети свои настройки, какой список через какую точку маршрутизировать…</p>\n</blockquote>\n</aside>\n<p>очень хорошо сочетается с конфигом китайских прокси типа xray, vray и тд., в которых можно и прописывать AS, и GeoIP, и подцеплять списки IP и доменов. Вы наверное просто не видели это в деле. Я как раз загорелся идеей этого поста, поковыряв конфиг XTLS в nekoray и поняв, насколько он гибкий. Здесь прямо напрашивается сделать клиент еще и сервером.<br>\nДа, минус такого подхода в том, что двухстороннюю связность таким образом не настроишь, но это же proxy, а не VPN, и цель тут не в настройке свзяности и проброске сетей.</p>\n<p>Быстрый гуглеж не дал найти сломанные mark в issues аналогов v2ray, но учитывая что они все в той или иной степени форки, очень даже вероятно проблема есть у многих или у всех. Однако свойство “sendThrough” в конфиге приведенного примера (а также например xray <a href=\"https://xtls.github.io/config/outbound.html#outboundobject\" class=\"inline-onebox\" rel=\"noopener nofollow ugc\">出站代理 | Project X</a>) позволяет направлять трафик на разные IP-адреса. <a class=\"mention\" href=\"/u/valdikss\">@ValdikSS</a>, разве этого недостаточно, чтобы передать информацию для роутера, куда это слать дальше, или я не учитываю что-то еще?</p>",
        "post_number": 9,
        "post_type": 1,
        "posts_count": 11,
        "updated_at": "2024-03-01T15:30:22.067Z",
        "reply_count": 1,
        "reply_to_post_number": null,
        "quote_count": 1,
        "incoming_link_count": 3,
        "reads": 66,
        "readers_count": 65,
        "score": 33.2,
        "yours": false,
        "topic_id": 7312,
        "topic_slug": "%D0%BA%D0%B0%D0%BA-%D1%81%D0%B4%D0%B5%D0%BB%D0%B0%D1%82%D1%8C-%D1%83%D0%BD%D0%B8%D0%B2%D0%B5%D1%80%D1%81%D0%B0%D0%BB%D1%8C%D0%BD%D0%BE%D0%B5-%D1%80%D0%B5%D1%88%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B4%D0%BB%D1%8F-%D1%82%D1%83%D0%BD%D0%BD%D0%B5%D0%BB%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-%D0%BF%D0%BE-ip-%D0%B8-%D0%B4%D0%BE%D0%BC%D0%B5%D0%BD%D0%B0%D0%BC-%D0%B4%D0%BB%D1%8F-%D0%B4%D0%BE%D0%BC%D0%B0%D1%88%D0%BD%D0%B5%D0%B9-%D1%81%D0%B5%D1%82%D0%B8",
        "display_username": "",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
            {
                "url": "https://xtls.github.io/config/outbound.html#outboundobject",
                "internal": false,
                "reflection": false,
                "title": "出站代理 | Project X",
                "clicks": 0
            }
        ],
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 3323,
        "hidden": false,
        "trust_level": 1,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": false,
        "wiki": false,
        "post_url": "/t/%D0%BA%D0%B0%D0%BA-%D1%81%D0%B4%D0%B5%D0%BB%D0%B0%D1%82%D1%8C-%D1%83%D0%BD%D0%B8%D0%B2%D0%B5%D1%80%D1%81%D0%B0%D0%BB%D1%8C%D0%BD%D0%BE%D0%B5-%D1%80%D0%B5%D1%88%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B4%D0%BB%D1%8F-%D1%82%D1%83%D0%BD%D0%BD%D0%B5%D0%BB%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-%D0%BF%D0%BE-ip-%D0%B8-%D0%B4%D0%BE%D0%BC%D0%B5%D0%BD%D0%B0%D0%BC-%D0%B4%D0%BB%D1%8F-%D0%B4%D0%BE%D0%BC%D0%B0%D1%88%D0%BD%D0%B5%D0%B9-%D1%81%D0%B5%D1%82%D0%B8/7312/9",
        "can_translate": false
    },
    {
        "id": 23218,
        "name": "Alexander Borouhin",
        "username": "borouhin",
        "avatar_template": "/user_avatar/ntc.party/borouhin/{size}/3734_2.png",
        "created_at": "2024-03-01T15:30:41.807Z",
        "cooked": "<aside class=\"quote no-group\" data-username=\"pr0act1v3\" data-post=\"9\" data-topic=\"7312\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://ntc.party/letter_avatar_proxy/v4/letter/p/8dc957/48.png\" class=\"avatar\"> pr0act1v3:</div>\n<blockquote>\n<p>но это же proxy, а не VPN, и цель тут не в настройке свзяности и проброске сетей.</p>\n</blockquote>\n</aside>\n<p>Увы, мне совершенно не нужен прокси, который не VPN, и очень нужна связность сетей на каждой плодащке, так что изыскания в этом направлении не могу комментировать <img src=\"https://ntc.party/images/emoji/twitter/slight_smile.png?v=12\" title=\":slight_smile:\" class=\"emoji\" alt=\":slight_smile:\" loading=\"lazy\" width=\"20\" height=\"20\"></p>",
        "post_number": 10,
        "post_type": 1,
        "posts_count": 11,
        "updated_at": "2024-03-01T15:30:41.807Z",
        "reply_count": 0,
        "reply_to_post_number": 9,
        "quote_count": 1,
        "incoming_link_count": 0,
        "reads": 63,
        "readers_count": 62,
        "score": 12.6,
        "yours": false,
        "topic_id": 7312,
        "topic_slug": "%D0%BA%D0%B0%D0%BA-%D1%81%D0%B4%D0%B5%D0%BB%D0%B0%D1%82%D1%8C-%D1%83%D0%BD%D0%B8%D0%B2%D0%B5%D1%80%D1%81%D0%B0%D0%BB%D1%8C%D0%BD%D0%BE%D0%B5-%D1%80%D0%B5%D1%88%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B4%D0%BB%D1%8F-%D1%82%D1%83%D0%BD%D0%BD%D0%B5%D0%BB%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-%D0%BF%D0%BE-ip-%D0%B8-%D0%B4%D0%BE%D0%BC%D0%B5%D0%BD%D0%B0%D0%BC-%D0%B4%D0%BB%D1%8F-%D0%B4%D0%BE%D0%BC%D0%B0%D1%88%D0%BD%D0%B5%D0%B9-%D1%81%D0%B5%D1%82%D0%B8",
        "display_username": "Alexander Borouhin",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 2682,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": false,
        "wiki": false,
        "post_url": "/t/%D0%BA%D0%B0%D0%BA-%D1%81%D0%B4%D0%B5%D0%BB%D0%B0%D1%82%D1%8C-%D1%83%D0%BD%D0%B8%D0%B2%D0%B5%D1%80%D1%81%D0%B0%D0%BB%D1%8C%D0%BD%D0%BE%D0%B5-%D1%80%D0%B5%D1%88%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B4%D0%BB%D1%8F-%D1%82%D1%83%D0%BD%D0%BD%D0%B5%D0%BB%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-%D0%BF%D0%BE-ip-%D0%B8-%D0%B4%D0%BE%D0%BC%D0%B5%D0%BD%D0%B0%D0%BC-%D0%B4%D0%BB%D1%8F-%D0%B4%D0%BE%D0%BC%D0%B0%D1%88%D0%BD%D0%B5%D0%B9-%D1%81%D0%B5%D1%82%D0%B8/7312/10",
        "can_translate": false
    },
    {
        "id": 24426,
        "name": "Jamakasi",
        "username": "Jamakasi",
        "avatar_template": "/user_avatar/ntc.party/jamakasi/{size}/4754_2.png",
        "created_at": "2024-04-02T08:32:12.367Z",
        "cooked": "<p><a class=\"mention\" href=\"/u/valdikss\">@ValdikSS</a> у меня сейчас есть в разработке еще один вариант. Точнее он уже успешно работает но пока выкатываеть его стыдно, за несколько лет путем проб и ошибок вывел себе идеальную систему под все свои задачи.<br>\nОбщая суть следующая.<br>\n1 Раскидываются ULA префиксы на свои сети.<br>\n2 Маршрутизация этих префиксов между домашними роутерами\\vps\\vds.<br>\n3 В нужных локация поднимается nat64, к примеру tayga. Скажем в США, Европе и РФ.<br>\n4 Дальше мой говнософт в виде мидлваров к coredns.<br>\n4.1 первый мидлвар снифает входящие запросы, сверяет с бд, если есть то отправляет на следующий dns, если нет то просто резольвит.<br>\n4.2 особый мидлвар который делает dns64. Отходя от стандартов мапирует v4 в v6 как обычно, но необычно что выпиливает все не dns64 ответы в виде оригинальных v4 и v6 адресов, ломает dnssec<br>\nДля пункты 4.1 есть restapi по управлению бд на лету, она к слову inmem, могут синхронизироваться между инстансами. Можно более одной бд вести.</p>\n<p>На выходе:<br>\n1 никаких трюков с маркировкой в фаирволе или гигансткими таблицами маршрутизации с bgp\\ospf<br>\n2 набивка бд только нужными доменами с возможностью заворотов в нужную локацию. Скажем нетфликс надо через америкосию, ибей через европу, а госуслуги через рф.<br>\n3 rest по синхронной набивке бд.<br>\n4 очень компактно по ресурсам на серверах, по сути tayga для nat64 и coredns.<br>\n5 Довольно геморно для разворачивания и это не вариант в установил и запустил.</p>\n<p>Когда чуть облагорожу исходники и допишу хоть какие то readme то вкину на гитхаб всё и где нибудь тут.</p>",
        "post_number": 11,
        "post_type": 1,
        "posts_count": 11,
        "updated_at": "2024-04-02T08:32:12.367Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 6,
        "reads": 49,
        "readers_count": 48,
        "score": 39.8,
        "yours": false,
        "topic_id": 7312,
        "topic_slug": "%D0%BA%D0%B0%D0%BA-%D1%81%D0%B4%D0%B5%D0%BB%D0%B0%D1%82%D1%8C-%D1%83%D0%BD%D0%B8%D0%B2%D0%B5%D1%80%D1%81%D0%B0%D0%BB%D1%8C%D0%BD%D0%BE%D0%B5-%D1%80%D0%B5%D1%88%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B4%D0%BB%D1%8F-%D1%82%D1%83%D0%BD%D0%BD%D0%B5%D0%BB%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-%D0%BF%D0%BE-ip-%D0%B8-%D0%B4%D0%BE%D0%BC%D0%B5%D0%BD%D0%B0%D0%BC-%D0%B4%D0%BB%D1%8F-%D0%B4%D0%BE%D0%BC%D0%B0%D1%88%D0%BD%D0%B5%D0%B9-%D1%81%D0%B5%D1%82%D0%B8",
        "display_username": "Jamakasi",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 3471,
        "hidden": false,
        "trust_level": 1,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": false,
        "wiki": false,
        "post_url": "/t/%D0%BA%D0%B0%D0%BA-%D1%81%D0%B4%D0%B5%D0%BB%D0%B0%D1%82%D1%8C-%D1%83%D0%BD%D0%B8%D0%B2%D0%B5%D1%80%D1%81%D0%B0%D0%BB%D1%8C%D0%BD%D0%BE%D0%B5-%D1%80%D0%B5%D1%88%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B4%D0%BB%D1%8F-%D1%82%D1%83%D0%BD%D0%BD%D0%B5%D0%BB%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-%D0%BF%D0%BE-ip-%D0%B8-%D0%B4%D0%BE%D0%BC%D0%B5%D0%BD%D0%B0%D0%BC-%D0%B4%D0%BB%D1%8F-%D0%B4%D0%BE%D0%BC%D0%B0%D1%88%D0%BD%D0%B5%D0%B9-%D1%81%D0%B5%D1%82%D0%B8/7312/11",
        "can_translate": false
    }
]