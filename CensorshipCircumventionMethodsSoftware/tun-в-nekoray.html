
    <html>
      <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <style>
    th, td {
      border: 1px solid black;
      border-collapse: collapse;
    }
    th, td {
      word-wrap: break-word;
      padding: 5px;
    }
    table {
      width: 100%;
      max-width: 100%;
      border: 1px solid black;
      border-collapse: collapse;
      table-layout: fixed;
      word-wrap: break-word
    }
    code {
      word-wrap: break-word;
    }
    pre {
        white-space: pre-wrap;
    }
    </style>
        <title>tun-в-nekoray</title>
      </head>
      <body>
        <table border="1" width="100%" cellpadding="5">
          <tr>
            <th style="width: 10%;">Ник</th>
            <th>Пост</th>
            <th style="width: 10%;">Дата</th>
          </tr>
    <tr><td>DBT081</td><td><p>В nekoray на windows 10:<br>
tun mode whitelist работает некорректно и пускает через себя всю систему, а должен только процессы из whitelist</p></td><td>2024-10-09T13:41:37.048Z</td></tr><tr><td>boltor</td><td><aside class="quote quote-modified" data-post="16" data-topic="10832">
  <div class="title">
    <div class="quote-controls"></div>
    <img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/b/cc9497/48.png" class="avatar">
    <a href="https://ntc.party/t/%D0%BF%D0%BE%D0%BC%D0%BE%D0%B3%D0%B8%D1%82%D0%B5-%D1%81%D0%B4%D0%B5%D0%BB%D0%B0%D1%82%D1%8C-%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B8-nekoray-%D0%BF%D0%BE%D0%B4-youtube/10832/16">Помогите сделать настройки Nekoray под YouTube</a> <a class="badge-category__wrapper " href="/c/censorship-circumvention-software/tunneling-software/24"><span data-category-id="24" style="--category-badge-color: #652D90; --category-badge-text-color: #FFFFFF; --parent-category-badge-color: #92278F;" data-parent-category-id="11" data-drop-close="true" class="badge-category --has-parent" title="Everything that encapsulates data and transmits it to middlebox server: VPN, proxy, cloaking software"><span class="badge-category__name">Tunneling software</span></span></a>
  </div>
  <blockquote>
    Вы судя по всему используете Nekoray последней стабильной версии 3.26, там проксирование по имени процесса работает только по чёрному списку, т.е. в виде исключения, и галочка Whitelist mode ничего не делает. 
Скачайте с гитхаба <a href="https://github.com/MatsuriDayo/nekoray/releases/tag/4.0-beta3" rel="noopener nofollow ugc">последнюю пре-релиз версию</a>, сделайте первоначальную настройку по своему вкусу, тему, ДНС, подписки, автозапуск и всё прочее. 
Далее пройдите в Настройки → Настройки маршрутов → Базовые маршруты и справа внизу выберите Outbound по умолчанию → bypass, чтобы пускать всё нап…
  </blockquote>
</aside>
</td><td>2024-10-09T13:43:31.650Z</td></tr><tr><td>DBT081</td><td><p>благодарю, буду пробовать</p></td><td>2024-10-09T13:44:28.033Z</td></tr><tr><td>Pony</td><td><p>Отслеживание процессов работает только в режиме TUN. Если вы выбрали “Встроенный Tun*”, в этом режиме TUN конфиг объединиться с обычным и будет запущено не два xray или sing-box, а лишь один с общим конфигом. TUN работает как виртуальное подключение и в любом случае весь трафик прогоняет через себя, нужен он чтобы видеть путь к процессу и на основе этого фильтровать.</p>
<p>Так вот, когда используется моно процесс - конфиг кривой, вы можете в этом убедится через “Поделится → Экспортировать конфиг”.</p>
<p>Основная заминка в том, что по умолчанию в маршрутах “final” установлен как “proxy”, а в режиме разделённых окон для TUN “final” прописан как “bypass”. Какие тут есть варианты?</p>
<ol>
<li>Самый простой, отключаем “Встроенный Tun*” чтобы для процессов запускался отдельный конфиг, для всего остального тоже;</li>
<li>Настраиваем всё ручками используя logical правила.</li>
</ol>
<p>К примеру я придерживаюсь следующего принципа для стратегии final: proxy только для выбранных процессов.</p>
<p>в rules на самое дно опускаем правило для процесса</p>
<pre><code class="lang-auto">      {
        "outbound": "proxy",
        "process_name": [
          "Discord.exe",
          "Update.exe"
        ]
      }
</code></pre>
<p>поднимаемся на верх и меняем final на bypass</p>
<pre><code class="lang-auto">    "final": "bypass",
</code></pre>
<p>а где же логика, можно спросить?<br>
я использую обход для доступной зоны и перебиваю нужным правилами сверху<br>
вот картинка целиком, читаем снизу вверх</p>
<pre data-code-wrap="js"><code class="lang-js"> "route": {
   "final": "bypass",
   "rules": [
     { // Если нужно наложение для процесса используем logical, полезно для geocdn или youtube после google
       "type": "logical",
       "mode": "and",
       "rules": [
         {
           "geosite": [
             "discord",
             "youtube"
           ]
         },
         {
           "process_name": [
             "Discord.exe",
             "Update.exe"
           ]
         }
       ],
       "outbound": "proxy"
     },
     { // Перебиваем для всего гео домены
       "domain_suffix": [
         ".ir"
       ],
       "geosite": [
         "google"
       ],
       "outbound": "bypass"
     },
     { // Перебиваем для всего geo ip
       "geoip": [
         "ir"
       ],
       "outbound": "bypass"
     },
     { // Перебиваем для всего приватные ip
       "ip_is_private": true,
       "outbound": "bypass"
     },
     { // Только для процессов выводим в прокси
       "outbound": "proxy",
       "process_name": [
         "Discord.exe",
         "Update.exe"
       ]
     }
   ]
 }
</code></pre></td><td>2024-10-23T17:25:05.400Z</td></tr><tr><td>kencarson</td><td><p>Что мы на выходе получаем? Остаётся полный TUN для выбранных процессов, а весь остальной трафик идёт напрямую? У меня проблема похожая. Скачав последнюю бетку 4.0, со встроенным туном у меня белый список работает, проксирует только то, что нужно, но при открытии сайтов из браузера, который в белый список для проксирования не входит, неко все равно проводит некую обработку, пропускает через сервак судя по всему, понимает что проксировать не нужно и пускает байпасом. Т.е. некий инпут лаг я чувствую при этом сценарии, и хочу поинтересоваться, при данном конфиге эта проблема пофиксится?</p></td><td>2024-10-24T22:54:15.834Z</td></tr><tr><td>Pony</td><td><p>Если использовать подобную схему, то да, мы на выходе получаем проксирование только определенных процессов. Если нет каких либо дополнительных правил схему можно сократить до</p>
<pre data-code-wrap="js"><code class="lang-js">"route": {
  "final": "bypass",
    { // Перебиваем для всего приватные ip
      "ip_is_private": true,
      "outbound": "bypass"
    },
    { // Только для процессов выводим в прокси
      "outbound": "proxy",
      "process_name": [
        "Discord.exe",
        "Update.exe"
      ]
    }
  ]
}
</code></pre>
<p>Аналогичные правила хорошо бы и для dns секции добавить.</p>
<p>Относительно инпут лага, он в схеме с TUN в любом случае будет при старте соединения (1-3ms зависимо от раздутых правил), если хотите полностью его избежать, то это возможно только с ручной настройкой прокси в приложениях где это возможно и никак иначе, чтобы именно само приложение определяло для себя куда ходить.</p></td><td>2024-10-25T08:21:35.114Z</td></tr><tr><td>kencarson</td><td><p>ну там как будто не 1-3ms, я так замечаю, если сам сервак перегружен впски, то оно может и несколько секунд висеть</p></td><td>2024-10-25T13:35:34.566Z</td></tr><tr><td>Pony</td><td><p>Не должно, только если <code>sniff_override_destination</code> или <code>reverse_mapping</code> в true, так как они насилуют dns, правила отрабатывают локально, для самой машины задержка должна быть минимальна, мы естественно говорим про локальный клиент и фильтрацию локальных процессов. При тормознутом DNS и множестве запросов можно попробовать переписать TTL в dns правилах <code>"rewrite_ttl": 28800</code> и включить кеш для отказов <code>"store_rdrc": true</code></p></td><td>2024-10-25T14:53:48.800Z</td></tr><tr><td>kencarson</td><td><p>“sniff_override_destination”: false , а  <code>reverse_mapping</code> вообще нету</p></td><td>2024-10-25T15:03:39.753Z</td></tr><tr><td>kencarson</td><td><p>вот я щас просто в моменте альттабнулся в браузер, открыл озон, который помимо процесса еще и по геоайпи должен не проксироваться, получил нормальный такой лаг и вот что в логах</p>
<details>
<summary>
Спойлер</summary>
<pre><code class="lang-auto">INFO[0603] [3201561675 0ms] inbound/tun[tun-in]: inbound packet connection from xx.xx.xx.xx
INFO[0603] [3201561675 0ms] inbound/tun[tun-in]: inbound packet connection to xx.xx.xx.xx
INFO[0603] [3201561675 0ms] router: found process path: C:\Windows\System32\svchost.exe
INFO[0603] dns: exchanged stats.vk-portal.net A stats.vk-portal.net. 272 IN A xx.xx.xx.xx
INFO[0603] [1058693205 0ms] inbound/tun[tun-in]: inbound connection from xx.xx.xx.xx:xx.xx.xx.xx
INFO[0603] [1058693205 0ms] inbound/tun[tun-in]: inbound connection to xx.xx.xx.xx:443
INFO[0603] [1058693205 0ms] router: found process path: C:\Program Files\Application\vivaldi.exe
INFO[0603] [1058693205 0ms] outbound/direct[bypass]: outbound connection to xx.xx.xx.xx:443
INFO[0603] dns: exchanged stats.vk-portal.net A stats.vk-portal.net. 272 IN A xx.xx.xx.xx
INFO[0604] [2470248214 0ms] inbound/tun[tun-in]: inbound packet connection from xx.xx.xx.xx:64874
INFO[0604] [2470248214 0ms] inbound/tun[tun-in]: inbound packet connection to xx.xx.xx.xx
INFO[0604] [2470248214 0ms] router: found process path: C:\Windows\System32\svchost.exe
INFO[0604] dns: exchanged bifrost.vivaldi.com A bifrost.vivaldi.com. 120 IN A xx.xx.xx.xx
INFO[0604] [27643922 0ms] inbound/tun[tun-in]: inbound connection from xx.xx.xx.xx:61875
INFO[0604] [27643922 0ms] inbound/tun[tun-in]: inbound connection to xx.xx.xx.xx:443
INFO[0604] [27643922 0ms] router: found process path: C:\Program Files\Application\vivaldi.exe
INFO[0604] [27643922 0ms] outbound/direct[bypass]: outbound connection to xx.xx.xx.xx:443
INFO[0604] dns: exchanged bifrost.vivaldi.com A bifrost.vivaldi.com. 120 IN A xx.xx.xx.xx
ERROR[0608] dns: exchange failed for ozon.ru. IN A: lookup ozon.ru: i/o timeout
ERROR[0608] dns: exchange failed for ozon.ru. IN A: lookup ozon.ru: operation was canceled
ERROR[0608] dns: exchange failed for ozon.ru. IN A: lookup ozon.ru: operation was canceled
ERROR[0608] dns: exchange failed for ozon.ru. IN A: lookup ozon.ru: operation was canceled
ERROR[0608] dns: exchange failed for ozon.ru. IN A: lookup ozon.ru: operation was canceled
INFO[0609] [3401884075 0ms] inbound/tun[tun-in]: inbound packet connection from xx.xx.xx.xx:60228
INFO[0609] [3401884075 0ms] inbound/tun[tun-in]: inbound packet connection to xx.xx.xx.xx
INFO[0609] [3401884075 0ms] router: found process path: C:\Windows\System32\svchost.exe
INFO[0609] [1765476771 0ms] inbound/tun[tun-in]: inbound packet connection from xx.xx.xx.xx:60985
INFO[0609] [1765476771 0ms] inbound/tun[tun-in]: inbound packet connection to xx.xx.xx.xx:443
INFO[0609] [1765476771 0ms] router: found process path: C:\Program Files\Application\vivaldi.exe
INFO[0609] [1765476771 0ms] outbound/direct[bypass]: outbound packet connection
INFO[0609] dns: exchanged dns.msftncsi.com A dns.msftncsi.com. 17 IN A xx.xx.xx.xx
INFO[0609] dns: exchanged dns.msftncsi.com A dns.msftncsi.com. 17 IN A xx.xx.xx.xx
INFO[0609] [778881140 0ms] inbound/tun[tun-in]: inbound packet connection from xx.xx.xx.xx:63454
INFO[0609] [778881140 0ms] inbound/tun[tun-in]: inbound packet connection to xx.xx.xx.xx
INFO[0609] [778881140 0ms] router: found process path: C:\Windows\System32\svchost.exe
INFO[0615] [867408169 0ms] inbound/tun[tun-in]: inbound packet connection from xx.xx.xx.xx:60111
INFO[0615] [867408169 0ms] inbound/tun[tun-in]: inbound packet connection to xx.xx.xx.xx:443
INFO[0615] [867408169 0ms] router: found process path: C:\Program Files\Application\vivaldi.exe
INFO[0615] [867408169 0ms] outbound/direct[bypass]: outbound packet connection
INFO[0615] [3449262751 0ms] inbound/tun[tun-in]: inbound packet connection from xx.xx.xx.xx:50307
INFO[0615] [3449262751 0ms] inbound/tun[tun-in]: inbound packet connection to xx.xx.xx.xx
INFO[0615] [3449262751 0ms] router: found process path: C:\Windows\System32\svchost.exe
INFO[0616] dns: exchanged play.google.com A play.google.com. 300 IN A xx.xx.xx.xx
INFO[0616] [1520234091 0ms] inbound/tun[tun-in]: inbound packet connection from xx.xx.xx.xx:54243
INFO[0616] [1520234091 0ms] inbound/tun[tun-in]: inbound packet connection to xx.xx.xx.xx
INFO[0616] [1520234091 0ms] router: found process path: C:\Windows\System32\svchost.exe
INFO[0616] dns: cached play.google.com A play.google.com. 299 IN A xx.xx.xx.xx
INFO[0616] [3348733976 0ms] inbound/tun[tun-in]: inbound connection from xx.xx.xx.xx:61877
INFO[0616] [3348733976 0ms] inbound/tun[tun-in]: inbound connection to xx.xx.xx.xx:443
INFO[0616] [3348733976 1ms] outbound/vless[proxy]: outbound connection to xx.xx.xx.xx:443
INFO[0616] dns: exchanged play.google.com A play.google.com. 197 IN A xx.xx.xx.xx
INFO[0616] dns: exchanged play.google.com SOA google.com. 60 IN SOA ns1.google.com. dns-admin.google.com. xx.xx.xx.xx
INFO[0616] dns: exchanged play.google.com SOA google.com. 60 IN SOA ns1.google.com. dns-admin.google.com. xx.xx.xx.xx
INFO[0616] [3348733976 148ms] outbound/vless[proxy]: outbound connection to xx.xx.xx.xx:443
ERROR[0619] dns: exchange failed for www.ozon.ru. IN A: lookup www.ozon.ru: i/o timeout
ERROR[0619] dns: exchange failed for www.ozon.ru. IN A: lookup www.ozon.ru: operation was canceled
ERROR[0619] dns: exchange failed for www.ozon.ru. IN A: lookup www.ozon.ru: operation was canceled
ERROR[0619] dns: exchange failed for www.ozon.ru. IN A: lookup www.ozon.ru: operation was canceled
ERROR[0619] dns: exchange failed for www.ozon.ru. IN A: lookup www.ozon.ru: operation was canceled
INFO[0620] [838971003 0ms] inbound/tun[tun-in]: inbound packet connection from xx.xx.xx.xx:57997
INFO[0620] [838971003 0ms] inbound/tun[tun-in]: inbound packet connection to xx.xx.xx.xx:443
INFO[0620] [838971003 0ms] router: found process path: C:\Program Files\Application\vivaldi.exe
INFO[0620] [838971003 0ms] outbound/direct[bypass]: outbound packet connection
INFO[0620] [684439540 0ms] inbound/tun[tun-in]: inbound packet connection from xx.xx.xx.xx:60987
INFO[0620] [684439540 0ms] inbound/tun[tun-in]: inbound packet connection to xx.xx.xx.xx:443
INFO[0620] [1576783644 0ms] inbound/tun[tun-in]: inbound packet connection from xx.xx.xx.xx:51059
INFO[0620] [1576783644 0ms] inbound/tun[tun-in]: inbound packet connection to xx.xx.xx.xx
INFO[0620] [684439540 1ms] router: found process path: C:\Program Files\Application\vivaldi.exe
INFO[0620] [1576783644 0ms] router: found process path: C:\Windows\System32\svchost.exe
INFO[0620] [684439540 1ms] outbound/direct[bypass]: outbound packet connection
INFO[0620] [4079921284 0ms] inbound/tun[tun-in]: inbound packet connection from xx.xx.xx.xx:53468
INFO[0620] [4079921284 0ms] inbound/tun[tun-in]: inbound packet connection to xx.xx.xx.xx
INFO[0620] [4079921284 0ms] router: found process path: C:\Windows\System32\svchost.exe
INFO[0621] [1326365875 0ms] inbound/tun[tun-in]: inbound packet connection from xx.xx.xx.xx:62525
INFO[0621] [1326365875 0ms] inbound/tun[tun-in]: inbound packet connection to xx.xx.xx.xx
INFO[0621] [1326365875 0ms] router: found process path: C:\Windows\System32\svchost.exe
INFO[0621] dns: exchanged cdn1.ozonusercontent.com CNAME cdn1.ozonusercontent.com. 221 IN CNAME edge-mmedia-lb.ozone.ru.
INFO[0621] dns: exchanged cdn1.ozonusercontent.com A edge-mmedia-lb.ozone.ru. 221 IN A xx.xx.xx.xx
INFO[0621] dns: exchanged cdn1.ozonusercontent.com A edge-mmedia-lb.ozone.ru. 221 IN A xx.xx.xx.xx
INFO[0621] [567517468 0ms] inbound/tun[tun-in]: inbound packet connection from xx.xx.xx.xx:63869
INFO[0621] [567517468 0ms] inbound/tun[tun-in]: inbound packet connection to xx.xx.xx.xx:443
INFO[0621] [567517468 0ms] router: found process path: C:\Program Files\Application\vivaldi.exe
INFO[0621] [567517468 0ms] outbound/direct[bypass]: outbound packet connection
INFO[0621] dns: exchanged cdn1.ozonusercontent.com CNAME cdn1.ozonusercontent.com. 96 IN CNAME edge-mmedia-lb.ozone.ru.
INFO[0621] dns: exchanged cdn1.ozonusercontent.com A edge-mmedia-lb.ozone.ru. 96 IN A xx.xx.xx.xx
INFO[0621] dns: exchanged cdn1.ozonusercontent.com A edge-mmedia-lb.ozone.ru. 96 IN A xx.xx.xx.xx
INFO[0621] [1620951015 0ms] inbound/tun[tun-in]: inbound connection from xx.xx.xx.xx:61879
INFO[0621] [1620951015 0ms] inbound/tun[tun-in]: inbound connection to xx.xx.xx.xx:443
INFO[0621] [1620951015 1ms] router: found process path: C:\Program Files\Application\vivaldi.exe
INFO[0621] [1620951015 1ms] outbound/direct[bypass]: outbound connection to xx.xx.xx.xx:443
INFO[0621] [4090609774 0ms] inbound/tun[tun-in]: inbound connection from xx.xx.xx.xx:61881
INFO[0621] [4090609774 0ms] inbound/tun[tun-in]: inbound connection to xx.xx.xx.xx:8080
INFO[0621] [4090609774 0ms] outbound/direct[bypass]: outbound connection to xx.xx.xx.xx:8080
ERROR[0630] dns: exchange failed for st.ozone.ru. IN A: lookup st.ozone.ru: i/o timeout
ERROR[0630] dns: exchange failed for st.ozone.ru. IN A: lookup st.ozone.ru: operation was canceled
ERROR[0630] dns: exchange failed for st.ozone.ru. IN A: lookup st.ozone.ru: operation was canceled
ERROR[0630] dns: exchange failed for st.ozone.ru. IN A: lookup st.ozone.ru: operation was canceled
ERROR[0630] dns: exchange failed for st.ozone.ru. IN A: lookup st.ozone.ru: operation was canceled
ERROR[0631] dns: exchange failed for ir-2.ozone.ru. IN A: lookup ir-2.ozone.ru: i/o timeout
ERROR[0631] dns: exchange failed for ir-2.ozone.ru. IN A: lookup ir-2.ozone.ru: operation was canceled
ERROR[0631] dns: exchange failed for ir-2.ozone.ru. IN A: lookup ir-2.ozone.ru: operation was canceled
ERROR[0631] dns: exchange failed for ir-2.ozone.ru. IN A: lookup ir-2.ozone.ru: operation was canceled
ERROR[0631] dns: exchange failed for ir-2.ozone.ru. IN A: lookup ir-2.ozone.ru: operation was canceled
INFO[0632] [3185401635 0ms] inbound/tun[tun-in]: inbound packet connection from xx.xx.xx.xx:57432
INFO[0632] [3185401635 0ms] inbound/tun[tun-in]: inbound packet connection to xx.xx.xx.xx:443
INFO[0632] [3185401635 0ms] router: found process path: C:\Program Files\Application\vivaldi.exe
INFO[0632] [3185401635 0ms] outbound/direct[bypass]: outbound packet connection
INFO[0632] [555816126 0ms] inbound/tun[tun-in]: inbound connection from xx.xx.xx.xx:61883
INFO[0632] [555816126 0ms] inbound/tun[tun-in]: inbound connection to xx.xx.xx.xx:443
INFO[0632] [555816126 0ms] router: found process path: C:\Program Files\Application\vivaldi.exe
INFO[0632] [555816126 0ms] outbound/direct[bypass]: outbound connection to xx.xx.xx.xx:443
INFO[0632] [1233291715 0ms] inbound/tun[tun-in]: inbound packet connection from xx.xx.xx.xx:62710
INFO[0632] [1233291715 0ms] inbound/tun[tun-in]: inbound packet connection to xx.xx.xx.xx:443
INFO[0632] [1233291715 0ms] router: found process path: C:\Program Files\Application\vivaldi.exe
INFO[0632] [1233291715 0ms] outbound/direct[bypass]: outbound packet connection
INFO[0632] [1641750125 0ms] inbound/tun[tun-in]: inbound connection from xx.xx.xx.xx:61885
INFO[0632] [1641750125 0ms] inbound/tun[tun-in]: inbound connection to xx.xx.xx.xx:443
INFO[0632] [1641750125 0ms] router: found process path: C:\Program Files\Application\vivaldi.exe
INFO[0632] [1641750125 0ms] outbound/direct[bypass]: outbound connection to xx.xx.xx.xx:443
ERROR[0632] [1083690989 5m41s] inbound/tun[tun-in]: download: raw-read tcp xx.xx.xx.xx:61604-&gt;xx.xx.xx.xx:80: An existing connection was forcibly closed by the remote host.
INFO[0632] [2399230989 0ms] inbound/tun[tun-in]: inbound packet connection from xx.xx.xx.xx:59154
INFO[0632] [2399230989 0ms] inbound/tun[tun-in]: inbound packet connection to xx.xx.xx.xx
INFO[0632] [2399230989 0ms] router: found process path: C:\Windows\System32\svchost.exe
INFO[0632] [2600775942 0ms] inbound/tun[tun-in]: inbound packet connection from xx.xx.xx.xx:63090
INFO[0632] [2600775942 0ms] inbound/tun[tun-in]: inbound packet connection to xx.xx.xx.xx
INFO[0632] [2600775942 0ms] router: found process path: C:\Windows\System32\svchost.exe
INFO[0632] [3849125006 0ms] inbound/tun[tun-in]: inbound packet connection from xx.xx.xx.xx:52753
INFO[0632] [3849125006 0ms] inbound/tun[tun-in]: inbound packet connection to xx.xx.xx.xx
INFO[0632] [3849125006 0ms] router: found process path: C:\Windows\System32\svchost.exe
INFO[0632] dns: exchanged ocsp.globalsign.com CNAME ocsp.globalsign.com. 234 IN CNAME global.prd.cdn.globalsign.com.
INFO[0632] dns: exchanged ocsp.globalsign.com CNAME global.prd.cdn.globalsign.com. 234 IN CNAME cdn.globalsigncdn.com.cdn.cloudflare.net.
INFO[0632] dns: exchanged ocsp.globalsign.com A cdn.globalsigncdn.com.cdn.cloudflare.net. 234 IN A xx.xx.xx.xx
INFO[0632] dns: exchanged ocsp.globalsign.com A cdn.globalsigncdn.com.cdn.cloudflare.net. 234 IN A xx.xx.xx.xx
INFO[0632] [1066541159 0ms] inbound/tun[tun-in]: inbound connection from xx.xx.xx.xx:61887
INFO[0632] [1066541159 0ms] inbound/tun[tun-in]: inbound connection to xx.xx.xx.xx:80
INFO[0632] [1066541159 0ms] router: found process path: C:\Program Files\Application\vivaldi.exe
INFO[0632] [1066541159 1ms] outbound/direct[bypass]: outbound connection to xx.xx.xx.xx:80
INFO[0632] dns: exchanged ocsp.globalsign.com CNAME ocsp.globalsign.com. 276 IN CNAME global.prd.cdn.globalsign.com.
INFO[0632] dns: exchanged ocsp.globalsign.com CNAME global.prd.cdn.globalsign.com. 276 IN CNAME cdn.globalsigncdn.com.cdn.cloudflare.net.
INFO[0632] dns: exchanged ocsp.globalsign.com A cdn.globalsigncdn.com.cdn.cloudflare.net. 276 IN A xx.xx.xx.xx
INFO[0632] dns: exchanged ocsp.globalsign.com A cdn.globalsigncdn.com.cdn.cloudflare.net. 276 IN A xx.xx.xx.xx
INFO[0632] [2651529950 0ms] inbound/tun[tun-in]: inbound connection from xx.xx.xx.xx:61889
INFO[0632] [2651529950 0ms] inbound/tun[tun-in]: inbound connection to xx.xx.xx.xx:443
INFO[0632] [2826113552 0ms] inbound/tun[tun-in]: inbound connection from xx.xx.xx.xx:61890
INFO[0632] [2826113552 0ms] inbound/tun[tun-in]: inbound connection to xx.xx.xx.xx:443
INFO[0632] [4181788425 0ms] inbound/tun[tun-in]: inbound connection from xx.xx.xx.xx:61891
INFO[0632] [4181788425 0ms] inbound/tun[tun-in]: inbound connection to xx.xx.xx.xx:443
INFO[0632] [957016265 0ms] inbound/tun[tun-in]: inbound connection from xx.xx.xx.xx:61892
INFO[0632] [957016265 0ms] inbound/tun[tun-in]: inbound connection to xx.xx.xx.xx:443
INFO[0632] [1338555140 0ms] inbound/tun[tun-in]: inbound connection from xx.xx.xx.xx:61893
INFO[0632] [1338555140 0ms] inbound/tun[tun-in]: inbound connection to xx.xx.xx.xx:443
INFO[0632] dns: exchanged s.deepl.com CNAME s.deepl.com. 300 IN CNAME hpkaj.deepl.com.
INFO[0632] dns: exchanged s.deepl.com CNAME hpkaj.deepl.com. 300 IN CNAME 46a2e5c3c5a64e218b60f2c2ee76b750.pacloudflare.com.
INFO[0632] dns: exchanged s.deepl.com A 46a2e5c3c5a64e218b60f2c2ee76b750.pacloudflare.com. 300 IN A xx.xx.xx.xx
INFO[0632] [2651529950 1ms] router: found process path: C:\Program Files\Application\vivaldi.exe
INFO[0632] [2651529950 1ms] outbound/direct[bypass]: outbound connection to xx.xx.xx.xx:443
INFO[0632] [2826113552 1ms] router: found process path: C:\Program Files\Application\vivaldi.exe
INFO[0632] [2826113552 1ms] outbound/direct[bypass]: outbound connection to xx.xx.xx.xx:443
INFO[0632] [4181788425 1ms] router: found process path: C:\Program Files\Application\vivaldi.exe
INFO[0632] [4181788425 1ms] outbound/direct[bypass]: outbound connection to xx.xx.xx.xx:443
INFO[0632] [957016265 1ms] router: found process path: C:\Program Files\Application\vivaldi.exe
INFO[0632] [957016265 1ms] outbound/direct[bypass]: outbound connection to xx.xx.xx.xx:443
INFO[0632] [1338555140 1ms] router: found process path: C:\Program Files\Application\vivaldi.exe
INFO[0632] [1338555140 1ms] outbound/direct[bypass]: outbound connection to xx.xx.xx.xx:443
INFO[0632] [1135949303 0ms] inbound/tun[tun-in]: inbound connection from xx.xx.xx.xx:61899
INFO[0632] [1135949303 0ms] inbound/tun[tun-in]: inbound connection to xx.xx.xx.xx:443
INFO[0632] [1135949303 0ms] router: found process path: C:\Program Files\Application\vivaldi.exe
INFO[0632] [1135949303 0ms] outbound/direct[bypass]: outbound connection to xx.xx.xx.xx:443
INFO[0632] [3215767973 0ms] inbound/tun[tun-in]: inbound packet connection from xx.xx.xx.xx:51198
INFO[0632] [3215767973 0ms] inbound/tun[tun-in]: inbound packet connection to xx.xx.xx.xx
INFO[0632] [3215767973 0ms] router: found process path: C:\Windows\System32\svchost.exe
INFO[0632] dns: exchanged s.deepl.com CNAME s.deepl.com. 300 IN CNAME hpkaj.deepl.com.
INFO[0632] dns: exchanged s.deepl.com CNAME hpkaj.deepl.com. 300 IN CNAME 46a2e5c3c5a64e218b60f2c2ee76b750.pacloudflare.com.
INFO[0632] dns: exchanged s.deepl.com A 46a2e5c3c5a64e218b60f2c2ee76b750.pacloudflare.com. 300 IN A xx.xx.xx.xx
INFO[0632] dns: exchanged 7ng6v3lu3c.execute-api.us-east-1.amazonaws.com A 7ng6v3lu3c.execute-api.us-east-1.amazonaws.com. 60 IN A xx.xx.xx.xx
INFO[0632] dns: exchanged 7ng6v3lu3c.execute-api.us-east-1.amazonaws.com A 7ng6v3lu3c.execute-api.us-east-1.amazonaws.com. 60 IN A xx.xx.xx.xx
INFO[0632] dns: exchanged 7ng6v3lu3c.execute-api.us-east-1.amazonaws.com A 7ng6v3lu3c.execute-api.us-east-1.amazonaws.com. 60 IN A xx.xx.xx.xx
INFO[0632] dns: exchanged 7ng6v3lu3c.execute-api.us-east-1.amazonaws.com A 7ng6v3lu3c.execute-api.us-east-1.amazonaws.com. 60 IN A xx.xx.xx.xx
INFO[0632] dns: exchanged 7ng6v3lu3c.execute-api.us-east-1.amazonaws.com A 7ng6v3lu3c.execute-api.us-east-1.amazonaws.com. 60 IN A xx.xx.xx.xx
INFO[0632] dns: exchanged 7ng6v3lu3c.execute-api.us-east-1.amazonaws.com A 7ng6v3lu3c.execute-api.us-east-1.amazonaws.com. 60 IN A xx.xx.xx.xx
INFO[0632] dns: exchanged 7ng6v3lu3c.execute-api.us-east-1.amazonaws.com A 7ng6v3lu3c.execute-api.us-east-1.amazonaws.com. 60 IN A xx.xx.xx.xx
INFO[0632] dns: exchanged 7ng6v3lu3c.execute-api.us-east-1.amazonaws.com A 7ng6v3lu3c.execute-api.us-east-1.amazonaws.com. 60 IN A xx.xx.xx.xx
INFO[0632] dns: exchanged 7ng6v3lu3c.execute-api.us-east-1.amazonaws.com A 7ng6v3lu3c.execute-api.us-east-1.amazonaws.com. 60 IN A xx.xx.xx.xx
INFO[0632] dns: exchanged 7ng6v3lu3c.execute-api.us-east-1.amazonaws.com A 7ng6v3lu3c.execute-api.us-east-1.amazonaws.com. 60 IN A xx.xx.xx.xx
INFO[0632] dns: exchanged 7ng6v3lu3c.execute-api.us-east-1.amazonaws.com A 7ng6v3lu3c.execute-api.us-east-1.amazonaws.com. 60 IN A xx.xx.xx.xx
INFO[0632] dns: exchanged 7ng6v3lu3c.execute-api.us-east-1.amazonaws.com A 7ng6v3lu3c.execute-api.us-east-1.amazonaws.com. 60 IN A xx.xx.xx.xx
INFO[0632] [2297705604 0ms] inbound/tun[tun-in]: inbound packet connection from xx.xx.xx.xx:55567
INFO[0632] [2297705604 0ms] inbound/tun[tun-in]: inbound packet connection to xx.xx.xx.xx:443
INFO[0632] [2297705604 0ms] router: found process path: C:\Program Files\Application\vivaldi.exe
INFO[0632] [2297705604 0ms] outbound/direct[bypass]: outbound packet connection
INFO[0632] [1046287425 0ms] inbound/tun[tun-in]: inbound connection from xx.xx.xx.xx:61901
INFO[0632] [1046287425 0ms] inbound/tun[tun-in]: inbound connection to xx.xx.xx.xx:443
INFO[0632] [1046287425 1ms] router: found process path: C:\Program Files\Application\vivaldi.exe
INFO[0632] [1046287425 1ms] outbound/direct[bypass]: outbound connection to xx.xx.xx.xx:443
INFO[0633] [2543815819 0ms] inbound/tun[tun-in]: inbound packet connection from xx.xx.xx.xx:55210
INFO[0633] [2543815819 0ms] inbound/tun[tun-in]: inbound packet connection to xx.xx.xx.xx:443
INFO[0633] [2543815819 0ms] router: found process path: C:\Program Files\Application\vivaldi.exe
INFO[0633] [2543815819 0ms] outbound/direct[bypass]: outbound packet connection
INFO[0633] [4018843444 0ms] inbound/tun[tun-in]: inbound packet connection from xx.xx.xx.xx:50685
INFO[0633] [4018843444 0ms] inbound/tun[tun-in]: inbound packet connection to xx.xx.xx.xx:443
INFO[0633] [4018843444 0ms] router: found process path: C:\Program Files\Application\vivaldi.exe
INFO[0633] [4018843444 0ms] outbound/direct[bypass]: outbound packet connection
INFO[0633] [2543370102 0ms] inbound/tun[tun-in]: inbound connection from xx.xx.xx.xx:61903
INFO[0633] [2543370102 0ms] inbound/tun[tun-in]: inbound connection to xx.xx.xx.xx:443
INFO[0633] [2543370102 1ms] router: found process path: C:\Program Files\Application\vivaldi.exe
INFO[0633] [2543370102 1ms] outbound/direct[bypass]: outbound connection to xx.xx.xx.xx:443
</code></pre>
</details></td><td>2024-10-25T15:58:29.628Z</td></tr><tr><td>bv0</td><td><p>dns для прямых запросов local? Если да, то попробуйте вписать какой-нибудь. Например <a href="https://1.1.1.1/dns-query" rel="noopener nofollow ugc">https://1.1.1.1/dns-query</a></p></td><td>2024-10-25T16:45:37.426Z</td></tr><tr><td>kencarson</td><td><p>сейчас local, до этого doh.pub/dns-query был - то же самое</p></td><td>2024-10-25T17:18:20.417Z</td></tr><tr><td>Pony</td><td><p>По ошибке явно мы не смогли достучаться до dns сервера, нужно убедится в его доступности из источника, дальше гадать всё равно что на кофейной гуще, так как нужен полный sing-box конфиг</p></td><td>2024-10-25T20:38:20.411Z</td></tr><tr><td>Pony</td><td><p>При использовании TUN в качестве direct dns надо указывать стандартный незащищённый, идеально просто локальный (к примеру от роутера если стационар), вот минимальный жизнеспособный конфиг, где всё идёт в пропуск кроме chrome.exe, обращаю внимание, что также мы обязаны отлавливать dns запросы и заворачивать их на внутреннюю службу, в любом стандартном конфиге это будет даже при mixed</p>
<pre data-code-wrap="js"><code class="lang-js">{
  "dns": {
    "final": "dns-direct",
    "independent_cache": true,
    "rules": [
      {
        "process_name": ["chrome.exe"],
        "server": "dns-remote"
      }
    ],
    "servers": [
      {
        "address": "https://dns.google/dns-query", // любой dns для проксированных
        "address_resolver": "dns-direct",
        "detour": "proxy", // только через прокси
        "strategy": "ipv4_only",
        "tag": "dns-remote"
      },
      {
        "address": "77.88.8.8", // незащищенный dns для прямых запросов
        "address_resolver": "dns-local",
        "detour": "direct", // только напрямую
        "strategy": "ipv4_only",
        "tag": "dns-direct"
      },
      {
        "address": "local",
        "detour": "direct",
        "tag": "dns-local"
      }
    ]
  },
  "inbounds": [
    {
      "auto_route": true,
      "domain_strategy": "ipv4_only",
      "endpoint_independent_nat": false,
      "inet4_address": "172.19.0.1/28",
      "interface_name": "neko-tun",
      "mtu": 9000,
      "sniff": true,
      "sniff_override_destination": false,
      "stack": "gvisor",
      "strict_route": false,
      "tag": "tun-in",
      "type": "tun"
    }
  ],
  "log": {
    "level": "warn"
  },
  "outbounds": [ // настройки прокси
    {
      "domain_strategy": "ipv4_only",
      "server": "192.168.1.1",
      "server_port": 1080,
      "tag": "proxy",
      "type": "socks"
    },
    {
      "tag": "direct",
      "type": "direct"
    },
    {
      "tag": "bypass",
      "type": "direct"
    },
    { // обязательно должно быть
      "tag": "dns-out",
      "type": "dns"
    }
  ],
  "route": {
    "auto_detect_interface": true,
    "final": "bypass",
    "rules": [ // ловим любые стандартные dns запросы
      {
        "outbound": "dns-out",
        "port": [53]
      },
      {
        "outbound": "dns-out",
        "protocol": "dns"
      },
      {
        "ip_is_private": true,
        "outbound": "bypass"
      },
      {
        "outbound": "proxy",
        "process_name": ["chrome.exe"]
      }
    ]
  }
}
</code></pre></td><td>2024-10-25T21:09:16.088Z</td></tr><tr><td>kencarson</td><td><p>прикол в том, что этот лог, который я скинул на "local"днсе и есть, и такое случается нередко, пару секунд пролаг и потом сайт загружается</p>
<details>
<summary>
Спойлер</summary>
<p>{<br>
“dns”: {<br>
“independent_cache”: true,<br>
“rules”: [<br>
{<br>
“outbound”: “any”,<br>
“server”: “direct”<br>
},<br>
{<br>
“domain”: [<br>
“xxxxxxxxxxx”<br>
],<br>
“domain_keyword”: [<br>
],<br>
“domain_regex”: [<br>
],<br>
“domain_suffix”: [<br>
“ru”,<br>
“su”,<br>
“xn–p1ai”<br>
],<br>
“geosite”: [<br>
],<br>
“server”: “dns-direct”<br>
},<br>
{<br>
“query_type”: [<br>
32,<br>
33<br>
],<br>
“server”: “dns-block”<br>
},<br>
{<br>
“domain_suffix”: “.lan”,<br>
“server”: “dns-block”<br>
}<br>
],<br>
“servers”: [<br>
{<br>
“address”: “<a href="https://dns.google/dns-query" rel="noopener nofollow ugc">https://dns.google/dns-query</a>”,<br>
“address_resolver”: “dns-local”,<br>
“detour”: “proxy”,<br>
“strategy”: “ipv4_only”,<br>
“tag”: “dns-remote”<br>
},<br>
{<br>
“address”: “local”,<br>
“address_resolver”: “dns-local”,<br>
“detour”: “direct”,<br>
“strategy”: “ipv4_only”,<br>
“tag”: “dns-direct”<br>
},<br>
{<br>
“address”: “rcode://success”,<br>
“tag”: “dns-block”<br>
},<br>
{<br>
“address”: “local”,<br>
“detour”: “direct”,<br>
“tag”: “dns-local”<br>
}<br>
]<br>
}</p>
</details></td><td>2024-10-25T22:09:36.970Z</td></tr><tr><td>Pony</td><td><aside class="quote no-group" data-username="kencarson" data-post="15" data-topic="11331">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/kencarson/48/11745_2.png" class="avatar"> kencarson:</div>
<blockquote>
<p>и такое случается нередко</p>
</blockquote>
</aside>
<p>значит локальный ресолвер уходит в луп или блочится, нужно узнать его адрес через nslookup и верхним правилом пропустить его, вероятнее всего там адрес из tun и добавление его сети исправит ситуацию</p>
<pre data-code-wrap="json"><code class="lang-json">      {
        "outbound": "bypass",
        "ip_cidr": [
          "172.19.0.1/28"
        ],
        "protocol": "dns"
      }
</code></pre>
<p>но без полного конфига сложно судить</p></td><td>2024-10-25T23:36:38.041Z</td></tr><tr><td>kencarson</td><td><details>
<summary>
Спойлер</summary>
<p>{<br>
“dns”: {<br>
“independent_cache”: true,<br>
“rules”: [<br>
{<br>
“outbound”: “any”,<br>
“server”: “direct”<br>
},<br>
{<br>
“domain”: [<br>
“xxxxxxxxxxxxxx”<br>
],<br>
“domain_keyword”: [<br>
],<br>
“domain_regex”: [<br>
],<br>
“domain_suffix”: [<br>
“ru”,<br>
“su”,<br>
“xn–p1ai”<br>
],<br>
“geosite”: [<br>
],<br>
“server”: “dns-direct”<br>
},<br>
{<br>
“query_type”: [<br>
32,<br>
33<br>
],<br>
“server”: “dns-block”<br>
},<br>
{<br>
“domain_suffix”: “.lan”,<br>
“server”: “dns-block”<br>
}<br>
],<br>
“servers”: [<br>
{<br>
“address”: “<a href="https://dns.google/dns-query" rel="noopener nofollow ugc">https://dns.google/dns-query</a>”,<br>
“address_resolver”: “dns-local”,<br>
“detour”: “proxy”,<br>
“strategy”: “ipv4_only”,<br>
“tag”: “dns-remote”<br>
},<br>
{<br>
“address”: “local”,<br>
“address_resolver”: “dns-local”,<br>
“detour”: “direct”,<br>
“strategy”: “ipv4_only”,<br>
“tag”: “dns-direct”<br>
},<br>
{<br>
“address”: “rcode://success”,<br>
“tag”: “dns-block”<br>
},<br>
{<br>
“address”: “local”,<br>
“detour”: “direct”,<br>
“tag”: “dns-local”<br>
}<br>
]<br>
},<br>
“inbounds”: [<br>
{<br>
“domain_strategy”: “”,<br>
“listen”: “127.0.0.1”,<br>
“listen_port”: 2080,<br>
“sniff”: true,<br>
“sniff_override_destination”: false,<br>
“tag”: “mixed-in”,<br>
“type”: “mixed”<br>
},<br>
{<br>
“auto_route”: true,<br>
“domain_strategy”: “”,<br>
“endpoint_independent_nat”: true,<br>
“inet4_address”: “xxxxxxxx”,<br>
“interface_name”: “neko-tun”,<br>
“mtu”: 9000,<br>
“sniff”: true,<br>
“sniff_override_destination”: false,<br>
“stack”: “gvisor”,<br>
“strict_route”: false,<br>
“tag”: “tun-in”,<br>
“type”: “tun”<br>
}<br>
],<br>
“log”: {<br>
“level”: “info”<br>
},<br>
“outbounds”: [<br>
{<br>
“domain_strategy”: “”,<br>
“flow”: “xxxxxxxxxx”,<br>
“packet_encoding”: “”,<br>
“server”: “xxxxxxxxxxxx”,<br>
“server_port”: 443,<br>
“tag”: “proxy”,<br>
“tls”: {<br>
“enabled”: true,<br>
“reality”: {<br>
“enabled”: true,<br>
“public_key”: “xxxxxxxxxxxxxxxxxxxx”,<br>
“short_id”: “”<br>
},<br>
“server_name”: “xxxxxxxxxxxxxxxxx”,<br>
“utls”: {<br>
“enabled”: true,<br>
“fingerprint”: “chrome”<br>
}<br>
},<br>
“type”: “vless”,<br>
“uuid”: “xxxxxxxxxxxxxxxxxxxx”<br>
},<br>
{<br>
“tag”: “direct”,<br>
“type”: “direct”<br>
},<br>
{<br>
“tag”: “bypass”,<br>
“type”: “direct”<br>
},<br>
{<br>
“tag”: “block”,<br>
“type”: “block”<br>
},<br>
{<br>
“tag”: “dns-out”,<br>
“type”: “dns”<br>
}<br>
],<br>
“route”: {<br>
“auto_detect_interface”: true,<br>
“final”: “bypass”,<br>
“geoip”: {<br>
“path”: “xxxxxxxxxxx/nekoray/geoip.db”<br>
},<br>
“geosite”: {<br>
“path”: “xxxxxxxxxxx/nekoray/geosite.db”<br>
},<br>
“rules”: [<br>
{<br>
“outbound”: “dns-out”,<br>
“protocol”: “dns”<br>
},<br>
{<br>
“domain”: [<br>
],<br>
“domain_keyword”: [<br>
],<br>
“domain_regex”: [<br>
],<br>
“domain_suffix”: [<br>
“ru”,<br>
“su”,<br>
“xn–p1ai”<br>
],<br>
“geosite”: [<br>
],<br>
“outbound”: “bypass”<br>
},<br>
{<br>
“geoip”: [<br>
“ru”,<br>
“private”<br>
],<br>
“ip_cidr”: [<br>
],<br>
“outbound”: “bypass”<br>
},<br>
{<br>
“network”: “udp”,<br>
“outbound”: “block”,<br>
“port”: [<br>
135,<br>
137,<br>
138,<br>
139,<br>
5353<br>
]<br>
},<br>
{<br>
“ip_cidr”: [<br>
“xxxxxxxxxxx”,<br>
“xxxxxxxxxxx”<br>
],<br>
“outbound”: “block”<br>
},<br>
{<br>
“outbound”: “block”,<br>
“source_ip_cidr”: [<br>
“xxxxxxxxxxxxx”,<br>
“xxxxxxxxxxxxx”<br>
]<br>
},<br>
{<br>
“outbound”: “proxy”,<br>
“process_name”: [<br>
“firefox.exe”,<br>
“Discord.exe”,<br>
“Update.exe”,<br>
“NVIDIA GeForce Experience.exe”,<br>
“NvBroadcast.Container.exe”,<br>
“nvcontainer.exe”,<br>
“NVDisplay.Container.exe”,<br>
“NVIDIA Share.exe”,<br>
“NVIDIA Web Helper.exe”,<br>
“nvsphelper64.exe”<br>
]<br>
}<br>
]<br>
}<br>
}</p>
</details></td><td>2024-10-26T00:12:37.320Z</td></tr><tr><td>Pony</td><td><p>В твоём случае как и предлагал выше, либо вместо local в dns прописываешь публичный адрес без tls или https, обычный, стандартный 8.8.8.8, либо добавляешь в пропуск tun подсеть на dns запросы, и проверять это всё добро через nslookup, mixed если не раздаешь прокси можно грохнуть.</p>
<p>Или</p>
<pre data-code-wrap="json"><code class="lang-json">{
  "dns": {
    "final": "dns-direct",
    "strategy": "ipv4_only",
    "independent_cache": true,
    "rules": [
      {
        "process_name": ["chrome.exe"],
        "server": "dns-remote"
      }
    ],
    "servers": [
      {
        "address": "https://dns.google/dns-query",
        "address_resolver": "dns-direct",
        "detour": "proxy",
        "tag": "dns-remote"
      },
      {
        "address": "tls://common.dot.dns.yandex.net",
        "address_resolver": "dns-local",
        "detour": "direct",
        "tag": "dns-direct"
      },
      {
        "address": "local",
        "detour": "direct-in",
        "tag": "dns-local"
      }
    ]
  },
  "inbounds": [
    {
      "auto_route": true,
      "endpoint_independent_nat": true,
      "inet4_address": "172.19.0.1/28",
      "interface_name": "neko-tun",
      "mtu": 9000,
      "sniff": true,
      "sniff_override_destination": false,
      "stack": "gvisor",
      "strict_route": false,
      "tag": "tun-in",
      "type": "tun"
    }
  ],
  "log": {
    "level": "warn"
  },
  "outbounds": [
    {
      "tag": "proxy",
      "type": "socks"
    },
    {
      "tag": "direct",
      "type": "direct"
    },
    {
      "tag": "bypass",
      "type": "direct"
    },
    {
      "tag": "dns-out",
      "type": "dns"
    }
  ],
  "route": {
    "auto_detect_interface": true,
    "final": "bypass",
    "rules": [
      {
        "outbound": "bypass",
        "ip_cidr": [
          "172.19.0.1/28"
        ],
        "protocol": "dns"
      },
      {
        "outbound": "dns-out",
        "protocol": "dns"
      },
      {
        "outbound": "dns-out",
        "protocol": "dns"
      },
      {
        "outbound": "proxy",
        "process_name": ["chrome.exe"]
      }
    ]
  }
}
</code></pre>
<p>или</p>
<pre data-code-wrap="json"><code class="lang-json">{
  "dns": {
    "final": "dns-local",
    "strategy": "ipv4_only",
    "independent_cache": true,
    "rules": [
      {
        "process_name": ["chrome.exe"],
        "server": "dns-remote"
      }
    ],
    "servers": [
      {
        "address": "https://dns.google/dns-query",
        "address_resolver": "dns-local",
        "detour": "proxy",
        "tag": "dns-remote"
      },
      {
        "address": "8.8.8.8",
        "detour": "direct-in",
        "tag": "dns-local"
      }
    ]
  },
  "inbounds": [
    {
      "auto_route": true,
      "endpoint_independent_nat": true,
      "inet4_address": "172.19.0.1/28",
      "interface_name": "neko-tun",
      "mtu": 9000,
      "sniff": true,
      "sniff_override_destination": false,
      "stack": "gvisor",
      "strict_route": false,
      "tag": "tun-in",
      "type": "tun"
    }
  ],
  "log": {
    "level": "warn"
  },
  "outbounds": [
    {
      "tag": "proxy",
      "type": "socks"
    },
    {
      "tag": "direct",
      "type": "direct"
    },
    {
      "tag": "bypass",
      "type": "direct"
    },
    {
      "tag": "dns-out",
      "type": "dns"
    }
  ],
  "route": {
    "auto_detect_interface": true,
    "final": "bypass",
    "rules": [
      {
        "outbound": "dns-out",
        "protocol": "dns"
      },
      {
        "outbound": "dns-out",
        "protocol": "dns"
      },
      {
        "outbound": "proxy",
        "process_name": ["chrome.exe"]
      }
    ]
  }
}
</code></pre></td><td>2024-10-26T00:57:09.603Z</td></tr><tr><td>kencarson</td><td><p>спасибо, буду пробовать, щас поставил обычный яндекс без шифрования, пока что нареканий не вижу. А чем по итогу это вызвано?</p></td><td>2024-10-26T01:01:42.219Z</td></tr><tr><td>Pony</td><td><aside class="quote no-group" data-username="kencarson" data-post="19" data-topic="11331">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/kencarson/48/11745_2.png" class="avatar"> kencarson:</div>
<blockquote>
<p>А чем по итогу это вызвано?</p>
</blockquote>
</aside>
<p>Tun перехватывает весь трафик и защищённый запрос улетает в роутинг и зависает во встроенном dns без разрешения. В случае ipv6 + tun, DNS и вовсе отвалится, так как будет вставлять в интерфейс адрес по которому не будет ресолвить адреса, так как рабочий ресолвер будет только на ipv4, так что там вообще нельзя указывать local, по этому в любой конфигурации у китайцев DNS Alibaba открытый</p></td><td>2024-10-26T09:13:08.502Z</td></tr><tr><td>A.g(A.g)</td><td><p>Кто-нибудь обращал внимание, что в свежих 4 версиях сломали байпас на локальные ресурсы?</p>
<p>Сравнивал, как работают 3.26 и 4b4. Так вот 4b4 не пропускает трафик к внутренним корпоративным адресам (exchange, облако и т.п.), а 3.26 работает нормально. Сравнивал настройки двух версий в интерфейсах, всё одинаково. По логам видно, что 3.26 пускает запросы в обход, а 4b4 упорно пытается направить через прокси.</p>
<p>Работает в режиме TUN.</p></td><td>2024-11-07T08:18:41.094Z</td></tr><tr><td>Manuka</td><td><p>Как настроить Nekobox (Nekoray) так, чтобы он проксировал только выбранные процессы (например, Discord), и все, что идет через порт 2080 (к адресу 127.0.0.1:2080 подключаю браузер с расширением “Обход блокировок Рунета” и использую список Антицензорсити, чтобы проксировались только заблокированные домены, удобно, что список автоматически обновляется)?</p></td><td>2024-11-26T19:50:22.425Z</td></tr><tr><td>hdrover</td><td><p>Для дискорда есть вот такое: <a href="https://ntc.party/t/%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-%D0%BF%D1%80%D0%BE%D0%BA%D1%81%D0%B8-%D1%82%D0%BE%D0%BB%D1%8C%D0%BA%D0%BE-%D0%B4%D0%BB%D1%8F-discord-%D1%87%D0%B5%D1%80%D0%B5%D0%B7-dll-%D0%BF%D0%BB%D1%8E%D1%81-%D0%B3%D0%BE%D0%BB%D0%BE%D1%81%D0%BE%D0%B2%D1%8B%D0%B5-%D0%B7%D0%B2%D0%BE%D0%BD%D0%BA%D0%B8-%D0%B1%D0%B5%D0%B7-%D0%BF%D1%80%D0%BE%D0%BA%D1%81%D0%B8/12044" class="inline-onebox">Настройка прокси только для Discord через DLL (плюс голосовые звонки без прокси)</a></p></td><td>2024-11-26T21:18:30.966Z</td></tr><tr><td>wsvall</td><td><aside class="quote no-group" data-username="Pony" data-post="6" data-topic="11331" data-full="true">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/p/4da419/48.png" class="avatar"> Pony:</div>
<blockquote>
<p>Если использовать подобную схему, то да, мы на выходе получаем проксирование только определенных процессов. Если нет каких либо дополнительных правил схему можно сократить до</p>
<pre data-code-wrap="js"><code class="lang-js">"route": {
  "final": "bypass",
    { // Перебиваем для всего приватные ip
      "ip_is_private": true,
      "outbound": "bypass"
    },
    { // Только для процессов выводим в прокси
      "outbound": "proxy",
      "process_name": [
        "Discord.exe",
        "Update.exe"
      ]
    }
  ]
}
</code></pre>
</blockquote>
</aside>
<p>Подскажите, этот конфиг можно сразу вставить в nekoray, заменив свой (если да, то где это) ? Или на основании это конфига нужно в гуи прокликать и прописать руками?</p></td><td>2024-12-24T12:18:29.372Z</td></tr><tr><td>eternal001</td><td><p>2 недели назад вышла версия 4.0.1<br>
<div class="lightbox-wrapper"><a class="lightbox" href="tun-в-nekoray/e2b6ebe16ab479f80867294940e2bdee3e2a88ab.png" data-download-href="https://ntc.party/uploads/default/e2b6ebe16ab479f80867294940e2bdee3e2a88ab" title="изображение"><img src="tun-в-nekoray/e2b6ebe16ab479f80867294940e2bdee3e2a88ab_2_470x375.png" alt="изображение" data-base62-sha1="wlBOzhNvfthM1ciRczI0Cq0By0b" width="470" height="375" srcset="tun-в-nekoray/e2b6ebe16ab479f80867294940e2bdee3e2a88ab_2_470x375.png, tun-в-nekoray/e2b6ebe16ab479f80867294940e2bdee3e2a88ab_2_705x562.png 1.5x, tun-в-nekoray/e2b6ebe16ab479f80867294940e2bdee3e2a88ab.png 2x" data-dominant-color="F3F3F2"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">изображение</span><span class="informations">805×641 24.3 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p><aside class="onebox allowlistedgeneric" data-onebox-src="https://github.com/MatsuriDayo/nekoray/releases/tag/4.0.1">
  <header class="source">
      <img src="https://ntc.party/uploads/default/original/2X/b/bad3e5f9ad67c1ddf145107ce7032ac1d7b22563.svg" class="site-icon" data-dominant-color="" width="32" height="32">

      <a href="https://github.com/MatsuriDayo/nekoray/releases/tag/4.0.1" target="_blank" rel="noopener">GitHub</a>
  </header>

  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:690/344;"><img src="tun-в-nekoray/475d23d940cbafaaeb367c8d79e614bea207d5a0_2_690x345.png" class="thumbnail" data-dominant-color="F3EEF0" width="690" height="345"></div>

<h3><a href="https://github.com/MatsuriDayo/nekoray/releases/tag/4.0.1" target="_blank" rel="noopener">Release 4.0.1 · MatsuriDayo/nekoray</a></h3>

  <p>重要提示

主程序更名 nekobox.exe （自动升级可能无法删除旧版，需要手动删除。新装没有问题）
建议丢弃之前 3.X 版本的程序和数据，完全删除程序和配置后重新安装

此版本的更新

修复 DNS outbound any 配置错误
自定义配置添加数组 prepend &amp; append 写法
域名规则默认使用 domain_suffix
URL 测试完毕后，在日志框输出提示
#14...</p>


  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>
</td><td>2024-12-24T13:35:37.877Z</td></tr><tr><td>spotted_giraffe</td><td><p>Рекомендуете с 3.26 переходить? Я читал на форуме что в новых версиях проблемы есть, поддержки xhttp тоже нет вроде?</p></td><td>2024-12-24T13:43:07.803Z</td></tr><tr><td>wsvall</td><td><p>Ага, я на ней сижу, проблем с Дискордом нет. Просто поинтересовался как конфиги чужие заливать в nekoray, посмотрел тут D:\distrib\network\vpn\nekoray\config как то все разбито по группам(по файлам разным), непонятна…</p></td><td>2024-12-24T14:06:02.166Z</td></tr><tr><td>eternal001</td><td><p><div class="lightbox-wrapper"><a class="lightbox" href="tun-в-nekoray/8e6c2e068caf7f1c47bb9f75cde2b66a5c0a599b.png" data-download-href="https://ntc.party/uploads/default/8e6c2e068caf7f1c47bb9f75cde2b66a5c0a599b" title="изображение"><img src="tun-в-nekoray/8e6c2e068caf7f1c47bb9f75cde2b66a5c0a599b_2_690x415.png" alt="изображение" data-base62-sha1="kjVzE1MiNzk7Bku4XWTQJhum8Of" width="690" height="415" srcset="tun-в-nekoray/8e6c2e068caf7f1c47bb9f75cde2b66a5c0a599b_2_690x415.png, tun-в-nekoray/8e6c2e068caf7f1c47bb9f75cde2b66a5c0a599b_2_1035x622.png 1.5x, tun-в-nekoray/8e6c2e068caf7f1c47bb9f75cde2b66a5c0a599b.png 2x" data-dominant-color="F7F7F7"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">изображение</span><span class="informations">1282×772 36.8 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div><br>
Настройки → Настройки маршрутов → Базовые маршруты → Кастомные маршруты</p></td><td>2024-12-24T14:19:48.094Z</td></tr><tr><td>naykaminka(Sergey)</td><td><p>Почему некорей а не в2рей ?<br>
Последний xhhtp поддерживает</p>
<p>Пользуетесь ли мультиплексированием ?<br>
Читал что если ядро рей а клиент синг то нужны танцы с бубном.</p></td><td>2024-12-24T15:52:34.177Z</td></tr><tr><td>Pony</td><td><aside class="quote no-group" data-username="eternal001" data-post="25" data-topic="11331">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/e/3da27b/48.png" class="avatar"> eternal001:</div>
<blockquote>
<p>2 недели назад вышла версия 4.0.1</p>
</blockquote>
</aside>
<p>В ней нет изменений которые изменяли бы поведение описанное выше, так как дефолтная работа с TUN запускает два сервера сразу, а используя встроенный (т.е. один сервер) просто подставляет кривой конфиг <img src="https://ntc.party/images/emoji/twitter/wink.png?v=12" title=":wink:" class="emoji" alt=":wink:" loading="lazy" width="20" height="20"><br>
Да и в целом она не шибко от beta-4 отличается, из критичного только dns починили для правил, но sing-box 1.11 так и не затащили, хотя после него у тех кто конфиги пишет знатно полыхнёт</p></td><td>2024-12-24T16:22:28.361Z</td></tr><tr><td>wsvall</td><td><aside class="quote no-group" data-username="naykaminka" data-post="29" data-topic="11331" data-full="true">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/naykaminka/48/13848_2.png" class="avatar"> naykaminka:</div>
<blockquote>
<p>Почему некорей а не в2рей ?</p>
</blockquote>
</aside>
<p>А я пару дней только с этим вожусь, еще не посмотрел другие клиенты. Спасибо, гляну v2ray.</p>
<aside class="quote no-group" data-username="naykaminka" data-post="29" data-topic="11331" data-full="true">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/naykaminka/48/13848_2.png" class="avatar"> naykaminka:</div>
<blockquote>
<p>Пользуетесь ли мультиплексированием ?<br>
Читал что если ядро рей а клиент синг то нужны танцы с бубном.</p>
</blockquote>
</aside>
<p>Только сейчас благодоря вам понял какая настройка отвечает за паралельное использование днс, кароче не работает мультиплекс у меня в некорай 4 (сервер хрей, клиент синг), возможно в 3.26 работает, проверю…</p></td><td>2024-12-24T16:44:58.436Z</td></tr><tr><td>BrOleg5</td><td><p>Да там всё несложно. Структура директории <code>config</code> следующая:</p>
<pre data-code-wrap="bash"><code class="lang-bash">config
├── groups # Хранит общие настройки nekoray/nekobox и конфигурации групп
│   ├── 0.json # Конфигурация группы 0
│   ├── 1.json # Конфигурация группы 1
│   ├── ...
│   ├── n.json # Конфигурация группы n
│   ├── coreType # Хранит выбранное ядро: 0 - Xray, 1 - sing-box
│   ├── nekobox.json # Хранит основные настройки программы, если выбрано ядро sing-box
│   ├── nekoray.json # Хранит основные настройки программы, если выбрано ядро Xray
│   ├── pm.json # Хранит массив ID групп
├── profiles # Хранит профили серверов
│   ├── 0.json # Профиль серера 0
│   ├── 1.json # Профиль серера 1
│   ├── ...
│   ├── n.json # Профиль серера n
├── routes # Хранит профили настроек маршрутеризации ядра Xray
│   ├── Default # Дефолтный профиль настроек маршрутеризации
├── routes_box # Хранит профили настроек маршрутеризации ядра sing-box
│   ├── Default # Дефолтный профиль настроек маршрутеризации
└── dashboard # Хранит html файлы дашбордов clash
     └── index.html
</code></pre>
<p>Профили серверов можно собирать в группы, настраивать для них подписки и прочее. Делается это в Настройка → Группы. Если в группах ничего не трогали, то у вас будет одна группа Default (или “По умолчанию”, в зависимости от языка) с конфигурацией в файле <code>groups/0.json</code>.</p>
<p>Профили серверов все свалены в кучу без разделения по группам в директории <code>profiles</code>. Принадлежность профиля к группе задаётся в поле <code>gid</code> (ID группы) файла профиля сервера. ID группы можно узнать из файлов конфигурации группы в поле <code>id</code>, или по имени файла, так как он как раз совпадает с его ID.</p>
<p>Профили настроек маршрутов хранятся в директории <code>routes</code> или <code>routes_box</code>, в зависимости от выбранного ядра. Можно сохранять и загружать профили маршрутов в меню Настройки → Настройки маршрутов → Общие, там есть секция Набор маршрутов, тыкаем “Изменить набор маршрутов”. В окне отобразятся все профили из директории <code>routes</code> или <code>routes_box</code>. Можно менять настройки маршрутов и с помощью функции Запись сохранять их в отдельный профиль-файл.</p>
<h3><a name="p-75186-h-1" class="anchor" href="#p-75186-h-1"></a>Итог</h3>
<p>Eсли хотите делится профилем сервера, то берёте его конфигурацию из <code>profiles</code> на одной системе и помещаете в <code>profiles</code> на другой. При этом меняете <code>gid</code> в json файле профиля на вашу группу, иначе сервер не добавится в вашу группу и в интерфейс программы.<br>
Но вообще проще конечно делится через QR или ссылку. Хотя я с помощью переноса файлов копировал профили серверов между моими системами, всё работало нормально.</p>
<p>Если хотите делится настройками маршрутов, то сохраняете её через меню “Изменить набор маршрутов” в файл и копируете его из <code>routes</code> или <code>routes_box</code> на одной системе в <code>routes</code> или <code>routes_box</code> на другой. Затем нужно из меню “Изменить набор маршрутов” загрузить этот профиль.</p></td><td>2024-12-25T06:05:03.352Z</td></tr><tr><td>Pony</td><td><aside class="quote no-group" data-username="wsvall" data-post="31" data-topic="11331">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/wsvall/48/14315_2.png" class="avatar"> wsvall:</div>
<blockquote>
<p>Спасибо, гляну v2ray.</p>
</blockquote>
</aside>
<p>Это не другой клиент это другое ядро, nekobox стал box называться из-за перехода на sing-box от слабой поддержки 2ray, разные ядра, разные клиенты, разные конфиги, разная работая с правилами и условными правилами</p></td><td>2024-12-25T08:44:33.814Z</td></tr><tr><td>wsvall</td><td><p>Намаялся с настройкой сил уже нет (несколько дней сижу с этим).<br>
У меня сервер vless с realitty.<br>
Я ставил NekoBox (разных версий), v2Rayn результат один и тот же, опишу ситуацию.<br>
Визуально все OK, меня устраивает, я имею ввиду сеть работает как мне нужно (если трафик к Яндекс, то он идет прямо к нему без прокси… если нет, то в прокси, Дискорд ну и все такое так же OK). Я в TUN (sing-box).<br>
Но очень сильно напрягают параллельные запросы которые я вижу в Wireshark. Как я проверяю:</p>
<ol>
<li>Включаю туннель.</li>
<li>Задаю фильтр в Wireshark ip.dst == 78.110.50.142</li>
<li>Открываю <a href="https://ipmy.ru/" rel="noopener nofollow ugc">https://ipmy.ru/</a> в браузере (этот сайт попадает под фильтр gepip:ru, потому что IP ru)</li>
<li>Вижу в Wireshark два запроса к 78.110.50.142 от 172.19.0.1 (IP tun) и от 192.168.49.48 (мой ПК)</li>
<li>Иду в Микротик, смотрю куда ушли запросы: один прямиком к 78.110.50.142, а второй на IPvpn:443</li>
</ol>
<p>Очень хочу это исправить (чтобы был один запрос), я спрашивал в соседней теме про такое, мне посоветовали, что можно создать правило-маршрут в программе-клиенте, который я использую для подключения к впн или использовать локальный ДНС сервер и слать все запросы на него он разберется (если я правильно конечно понял).<br>
Вариант с локальным ДНС отпадает.<br>
Chat GPT давал мне советы, конфиги, но ничего не помогло (скорее всего я что-то не так делал)<br>
Подскажите, пожалуйста, как мне добиться средствами маршрутов или правил один запрос к сайту, желательно средствами NekoBox или v2rayN ?!<br>
Может поделитесь примерами своих конфигов… не нашел похожих тем, разве это не важно, провайдер же будет видеть два одновременных запроса к одному сайту, понятно что ему пофигу (пока), но все же.</p>
<p>И если использовать режим прокси:1080 будет так же два запроса одновременных? (не проверял еще)</p></td><td>2024-12-26T16:32:51.972Z</td></tr><tr><td>0ka(0ka)</td><td><p>вам не нравится запрос к прокси серверу когда заходите на ру сайт? днс запросы тогда тоже направляйте напрямую а не через прокси</p></td><td>2024-12-26T16:41:19.164Z</td></tr><tr><td>wsvall</td><td><p>Да! Вот конфиг днс из v2rayN, в нем на мой взгляд (не уверен конечно до конца) днс запросы идут напрямую, посмотрите пожалуйста.</p>
<details>
<summary>
Спойлер</summary>
<p>{<br>
“servers”: [<br>
{<br>
“tag”: “remote”,<br>
“address”: “8.8.8.8”,<br>
“strategy”: “prefer_ipv4”,<br>
“detour”: “proxy”<br>
},<br>
{<br>
“tag”: “local”,<br>
“address”: “77.88.8.8”,<br>
“strategy”: “prefer_ipv4”,<br>
“detour”: “direct”<br>
},<br>
{<br>
“tag”: “block”,<br>
“address”: “rcode://success”<br>
}<br>
],<br>
“rules”: [<br>
{<br>
“server”: “remote”,<br>
“clash_mode”: “Global”<br>
},<br>
{<br>
“server”: “local”,<br>
“clash_mode”: “Direct”<br>
},<br>
{<br>
“server”: “block”,<br>
“rule_set”: [<br>
“geosite-category-ads-all”<br>
]<br>
}<br>
],<br>
“final”: “remote”<br>
}</p>
</details>
<p>Вот как в гуи выглядит<br>
<div class="lightbox-wrapper"><a class="lightbox" href="tun-в-nekoray/c9e1c996b150e5124b0e43365ab598813b67f0f7.png" data-download-href="https://ntc.party/uploads/default/c9e1c996b150e5124b0e43365ab598813b67f0f7" title="image"><img src="tun-в-nekoray/c9e1c996b150e5124b0e43365ab598813b67f0f7.png" alt="image" data-base62-sha1="sNVIzECg2RVzSmIrGqyItxVroUL" width="690" height="483" data-dominant-color="E1E6E5"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">985×690 22.1 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p></td><td>2024-12-26T17:08:29.818Z</td></tr><tr><td>0ka(0ka)</td><td><p>что за clash mode не знаю, замените его правила на те же что и в правилах роутинга (т.е. geoip-ru в local dns)</p></td><td>2024-12-26T17:11:39.121Z</td></tr><tr><td>JokoKenguru(Александр)</td><td><p>В итоге даже на версии 4.0.1 от 12.12 белый лист не работает корректно(<br>
Какой то выход из ситуации появился?</p></td><td>2025-01-18T19:39:48.340Z</td></tr><tr><td>0ka(0ka)</td><td><p>некорректно это как? вы пытаетесь сделать белый список для приложений?</p></td><td>2025-01-18T20:08:23.108Z</td></tr><tr><td>xX_RUP3R7_P4UL50N_Xx</td><td><p>Для того, что бы он работал корректно, нужно в настройках маршрутизации выставить дефолтный outbound с proxy на bypass, тогда проксироваться будут только процессы из белого списка, а всё остальное идти напрямую:</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="tun-в-nekoray/bcf477d0c782200266d314982f0e3f9b30902040.png" data-download-href="https://ntc.party/uploads/default/bcf477d0c782200266d314982f0e3f9b30902040" title="Снимок экрана 2025-01-19 021130"><img src="tun-в-nekoray/bcf477d0c782200266d314982f0e3f9b30902040.png" alt="Снимок экрана 2025-01-19 021130" data-base62-sha1="qXzx9HvTGgun8QZ77H3xQebpARO" width="627" height="500" data-dominant-color="2E2D2D"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">Снимок экрана 2025-01-19 021130</span><span class="informations">996×793 23.9 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>Тоже сначала не понял, почему в онлайн играх пинг выше обычного, только потом дошло, что дело в NekoBox’е. Из-за этого решил опытным путём поковыряться в настройках - как оказалось, в разных режимах одна и та же опция может работать совершенно по разному, что собственно говоря и было в случае с белым списком приложений и конечной выходной точкой (outbound’ом).</p></td><td>2025-01-18T23:05:16.010Z</td></tr><tr><td>JokoKenguru(Александр)</td><td><p>Тогда в чем смысл белого списка? Я запутался… если мне всего то надо было что бы он через себя пропускал первые 4 из списка… а остальные нет… что я тут делаю не так? или это все делается не так? а как на вашем скриншоте… забить в точности как у вас и будет работать?<br>
а унбаунд у меня всегда стоял прокси</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="tun-в-nekoray/add2bf094681ae21037751c160426cfa581f9718.png" data-download-href="https://ntc.party/uploads/default/add2bf094681ae21037751c160426cfa581f9718" title="image"><img src="tun-в-nekoray/add2bf094681ae21037751c160426cfa581f9718.png" alt="image" data-base62-sha1="oNI7H5VNvgVi0rhW3yYLmrQuTq0" width="690" height="284" data-dominant-color="E6F1E7"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">850×351 10 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div><br>
<div class="lightbox-wrapper"><a class="lightbox" href="tun-в-nekoray/a37789972d9fa7e23c7ff1f72e929566736dd262.png" data-download-href="https://ntc.party/uploads/default/a37789972d9fa7e23c7ff1f72e929566736dd262" title="image"><img src="tun-в-nekoray/a37789972d9fa7e23c7ff1f72e929566736dd262.png" alt="image" data-base62-sha1="nk5W07NQWmX4WQ1P7p3GWiHOmjg" width="495" height="500" data-dominant-color="F0F2F0"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">593×598 6.37 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div><br>
<div class="lightbox-wrapper"><a class="lightbox" href="tun-в-nekoray/a0b6251d45be9555eefd97a39bf966b73d11f845.png" data-download-href="https://ntc.party/uploads/default/a0b6251d45be9555eefd97a39bf966b73d11f845" title="image"><img src="tun-в-nekoray/a0b6251d45be9555eefd97a39bf966b73d11f845.png" alt="image" data-base62-sha1="mVIDCEnMO3D85VuF3k1As5cM5zn" width="634" height="500" data-dominant-color="F2F8F3"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">802×632 4.36 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p></td><td>2025-01-19T04:57:56.188Z</td></tr><tr><td>xX_RUP3R7_P4UL50N_Xx</td><td><p>Как раз в том, чтобы выборочно проксировать только нужные приложения, а остальные шли напрямую (без ВПН).</p>
<p>В списке оставь только chrome.exe, Discord.exe, Updater.exe и RocketLeague.exe (если правильно понял), MTU оставить на 9000 (как подсказали ниже).</p>
<p>Затем, в третьем окне пропиши как сделано у меня (весь RU трафик идёт напрямую, НЕ на впн, + выборочные настройки для определённых сайтов. Если ютуб смотришь с помощью Zapret, то строчку с geosite:youtube удали, если же Zapret не используешь, то оставь её, иначе ютуб работать не будет).</p>
<p>И самое главное - Outbound по-умолчанию выстави в bypass, без этого белый список приложений не будет адекватно работать.</p>
<p><a class="attachment" href="tun-в-nekoray/aqrtNZLgJpFmkpvMKvajFIROhfo.txt">01_Russia-to-Direct_Other-to-Proxy.txt</a> (478 байтов)</p></td><td>2025-01-19T07:16:40.796Z</td></tr><tr><td>0ka(0ka)</td><td><aside class="quote no-group" data-username="xX_RUP3R7_P4UL50N_Xx" data-post="42" data-topic="11331">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/xx_rup3r7_p4ul50n_xx/48/13752_2.png" class="avatar"> xX_RUP3R7_P4UL50N_Xx:</div>
<blockquote>
<p>заодно советую выставить MTU в 1500, чтобы не было фрагментации пакетов и увеличеннной в связи с этим задержкой.</p>
</blockquote>
</aside>
<p>MTU 9000 нужен тупо для увеличения производительности, никакой дополнительной фрагментации он не cделает, обмен данными происходит на localhost</p></td><td>2025-01-19T07:26:57.478Z</td></tr><tr><td>xX_RUP3R7_P4UL50N_Xx</td><td><p>А… Интересно, не знал. То есть, его в любом случае следует оставлять в 9000, не смотря на MTU реального интерфейса? Справедливо ли это для других клиентов, таких как Husi, Hiddify и прочие, или это актуально только в случае с NekoBox?</p>
<p>И ещё вопрос - в чём разница между gVisor, System и Mixed? Какой стоит использовать, а какой нет и при каких обстоятельствах? Благодарю.</p></td><td>2025-01-19T07:37:25.740Z</td></tr><tr><td>0ka(0ka)</td><td><aside class="quote no-group" data-username="xX_RUP3R7_P4UL50N_Xx" data-post="44" data-topic="11331">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/xx_rup3r7_p4ul50n_xx/48/13752_2.png" class="avatar"> xX_RUP3R7_P4UL50N_Xx:</div>
<blockquote>
<p>То есть, его в любом случае следует оставлять в 9000, не смотря на MTU реального интерфейса?</p>
</blockquote>
</aside>
<p>да, MTU реального интерфейса вообще не важен. Справедливо это для всех <strong>прокси</strong> клиентов с TUN.</p>
<aside class="quote no-group" data-username="xX_RUP3R7_P4UL50N_Xx" data-post="44" data-topic="11331">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/xx_rup3r7_p4ul50n_xx/48/13752_2.png" class="avatar"> xX_RUP3R7_P4UL50N_Xx:</div>
<blockquote>
<p>в чём разница между gVisor, System и Mixed?</p>
</blockquote>
</aside>
<p>в чем разница не скажу, mixed (default) это system для TCP трафика и gvisor для UDP трафика.</p>
<p>на счёт фрагментации: даже с 1500 TUN MTU возможна фрагментация QUIC протокола, но я сам не проверял т.к. обычно его блокирую (он через TCP прокси сам по себе работает медленно, фрагментация тут уже не особо важна, чтобы 100% небыло фрагментации то надо ставить TUN MTU в ~1240, но хз что может сломаться с таким низким значением т.к. некоторые протоколы (напр онлайн игры) нужно фрагментировать на уровне прокси иначе они работать не будут вообще). И вообще всё что я написал про фрагменты может быть бредом т.к. я не смотрел как именно работает TUN, может он собирает фрагменты сам и MTU интерфейса не важен совершенно…</p></td><td>2025-01-19T07:45:42.691Z</td></tr><tr><td>xX_RUP3R7_P4UL50N_Xx</td><td><aside class="quote no-group" data-username="0ka" data-post="45" data-topic="11331">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/0/d78d45/48.png" class="avatar"> 0ka:</div>
<blockquote>
<p>да, MTU реального интерфейса вообще не важен. Справедливо это для всех <strong>прокси</strong> клиентов с TUN.</p>
</blockquote>
</aside>
<p>Благодарю <img src="https://ntc.party/images/emoji/twitter/wink.png?v=12" title=":wink:" class="emoji" alt=":wink:" loading="lazy" width="20" height="20"></p>
<aside class="quote no-group" data-username="0ka" data-post="45" data-topic="11331">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/0/d78d45/48.png" class="avatar"> 0ka:</div>
<blockquote>
<p>в чем разница не скажу, mixed (default) это system для TCP трафика и gvisor для UDP трафика.</p>
</blockquote>
</aside>
<p>Спросил у ChatGPT, он написал что разница в подходах:</p>
<ul>
<li>
<p>System - это системная реализация (неожиданно), в теории требует меньше ресурсов и обладает меньшими задержками, из минусов - требует больших прав (видимо администратора), а так же могут быть проблемы с совместимостью (вроде как раз у Hiddify были проблемы в связанные с этим).</p>
</li>
<li>
<p>gVisor - это внешняя реализация, вроде как основанная на контейнеризации, что требует меньше прав, увеличивает совместимость и даёт некую гибкость, но в теории работает медленее и с чуть большими задержками.</p>
</li>
<li>
<p>Mixed - комбинация двух подходов, по всей видимости компромисс, когда частично работает режим System, а gVisor выполняет дополнительные функции.</p>
</li>
</ul>
<p>Насколько я понял,  если System работает без проблем, то лучше использовать его, в противных же случаях можно перейти на остальные.</p></td><td>2025-01-19T08:02:00.110Z</td></tr><tr><td>JokoKenguru(Александр)</td><td><p>Сделал все как вы сказали… гугл перестал гуглиться<br>
<div class="lightbox-wrapper"><a class="lightbox" href="tun-в-nekoray/b622b5e2d2f2238259dc7717694f9847062310ac.png" data-download-href="https://ntc.party/uploads/default/b622b5e2d2f2238259dc7717694f9847062310ac" title="image"><img src="tun-в-nekoray/b622b5e2d2f2238259dc7717694f9847062310ac.png" alt="image" data-base62-sha1="pZfgwsrvuHGfm59uzN0vAMM1xUw" width="634" height="500" data-dominant-color="EFF6F0"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">802×632 6.42 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div><br>
<div class="lightbox-wrapper"><a class="lightbox" href="tun-в-nekoray/6c6037bbdcce86cafc8e60e6c19e0dcb79d12039.png" data-download-href="https://ntc.party/uploads/default/6c6037bbdcce86cafc8e60e6c19e0dcb79d12039" title="image"><img src="tun-в-nekoray/6c6037bbdcce86cafc8e60e6c19e0dcb79d12039.png" alt="image" data-base62-sha1="fsJIa5x3mBBn6rZEq4O1Cxbohpn" width="690" height="469" data-dominant-color="EFF3EF"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">916×623 14.6 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div><br>
для проверки запустил штуку что крутит карты в стиме, она не соединяется с сервером(<br>
<div class="lightbox-wrapper"><a class="lightbox" href="tun-в-nekoray/c96b5a1bd210e34d3784b12791717ef72825b2d8.png" data-download-href="https://ntc.party/uploads/default/c96b5a1bd210e34d3784b12791717ef72825b2d8" title="image"><img src="tun-в-nekoray/c96b5a1bd210e34d3784b12791717ef72825b2d8.png" alt="image" data-base62-sha1="sJPYgScf5Di0tuzxsBTzlQf6kDm" width="690" height="360" data-dominant-color="2B332C"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">979×512 10.4 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div><br>
Что то я делаю все равно не так(<br>
А вот все что стоит в браузере<br>
<div class="lightbox-wrapper"><a class="lightbox" href="tun-в-nekoray/137a217eb610c4e535904ecbe1a230fbdf8c62ff.png" data-download-href="https://ntc.party/uploads/default/137a217eb610c4e535904ecbe1a230fbdf8c62ff" title="image"><img src="tun-в-nekoray/137a217eb610c4e535904ecbe1a230fbdf8c62ff_2_690x381.png" alt="image" data-base62-sha1="2MiJDoIdDS1D2tuYVOUrelZO9Ov" width="690" height="381" srcset="tun-в-nekoray/137a217eb610c4e535904ecbe1a230fbdf8c62ff_2_690x381.png, tun-в-nekoray/137a217eb610c4e535904ecbe1a230fbdf8c62ff_2_1035x571.png 1.5x, tun-в-nekoray/137a217eb610c4e535904ecbe1a230fbdf8c62ff.png 2x" data-dominant-color="2E3134"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">1331×736 64.5 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p></td><td>2025-01-19T09:29:28.318Z</td></tr><tr><td>xX_RUP3R7_P4UL50N_Xx</td><td><p>Однозначно выключи Обход блокировок Рунета, вместе они конфликтуют, это раз. Второе - у тебя зачем-то стоят две галочки “Режим TUN” и “Режим системного прокси”, нужно использовать только TUN.</p>
<p>В общем, отключи расширение Обхода, выйди из NekoBox’а, и ещё можешь попробовать использовать клиент с моими настройками (если даже так не заработает, то хз, видимо в системе что-то не так настроено) - <a href="http://www.mediafire.com/file/gdr3a4869jw7b5f/NekoBox.zip">http://www.mediafire.com/file/gdr3a4869jw7b5f/NekoBox.zip</a></p></td><td>2025-01-19T09:45:26.331Z</td></tr><tr><td>0ka(0ka)</td><td><aside class="quote no-group" data-username="xX_RUP3R7_P4UL50N_Xx" data-post="48" data-topic="11331">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/xx_rup3r7_p4ul50n_xx/48/13752_2.png" class="avatar"> xX_RUP3R7_P4UL50N_Xx:</div>
<blockquote>
<p>нужно использовать только TUN.</p>
</blockquote>
</aside>
<p>можно использовать и обе галки, поддерживающие прокси проги будут использовать именно его и меньше грузить проц</p></td><td>2025-01-19T13:51:46.162Z</td></tr><tr><td>xX_RUP3R7_P4UL50N_Xx</td><td><p>Это да, но вайтлист приложений работает только в TUN режиме</p></td><td>2025-01-19T14:00:48.060Z</td></tr><tr><td>JokoKenguru(Александр)</td><td><p>почему то ваш сайт перестает работать на вашей сборке<br>
<div class="lightbox-wrapper"><a class="lightbox" href="tun-в-nekoray/0b7d126c1b2409e85f01a3a3832a1ba161653bc1.png" data-download-href="https://ntc.party/uploads/default/0b7d126c1b2409e85f01a3a3832a1ba161653bc1" title="image"><img src="tun-в-nekoray/0b7d126c1b2409e85f01a3a3832a1ba161653bc1.png" alt="image" data-base62-sha1="1DDduwq5Ygr3bncKe6Dz1iD3zdT" width="690" height="452" data-dominant-color="232629"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">722×474 5.9 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div><br>
А еще ютуб перестал работать…<br>
<div class="lightbox-wrapper"><a class="lightbox" href="tun-в-nekoray/74e204493b8785ea250992eec89ec37fdb289249.png" data-download-href="https://ntc.party/uploads/default/74e204493b8785ea250992eec89ec37fdb289249" title="image"><img src="tun-в-nekoray/74e204493b8785ea250992eec89ec37fdb289249_2_690x388.png" alt="image" data-base62-sha1="gFZCLiVo6y3paROkg0KlFn3IYM9" width="690" height="388" srcset="tun-в-nekoray/74e204493b8785ea250992eec89ec37fdb289249_2_690x388.png, tun-в-nekoray/74e204493b8785ea250992eec89ec37fdb289249_2_1035x582.png 1.5x, tun-в-nekoray/74e204493b8785ea250992eec89ec37fdb289249_2_1380x776.png 2x" data-dominant-color="141714"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">1920×1080 66.8 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>fix<br>
поставил обе галочки, тун и режим прокси… заработало</p></td><td>2025-01-19T19:00:51.676Z</td></tr><tr><td>JokoKenguru(Александр)</td><td><p>О кстати, ублок перестал работать на твич… запускать рекламу стал… как вернуть ему работоспособность? такое началось после впн</p></td><td>2025-01-19T21:19:50.745Z</td></tr>
    </table>
      </body>
    </html>