[
    {
        "id": 23937,
        "name": "Alexander",
        "username": "moocluck",
        "avatar_template": "/letter_avatar_proxy/v4/letter/m/73ab20/{size}.png",
        "created_at": "2024-03-21T23:08:35.036Z",
        "cooked": "<p>Привет!</p>\n<p>Использую 3X-UI на VPS, место WG, OpenVPN и Outline. Но столкнулся с проблемой. VPS хочется использовать не только для обхода ограничений, но еще и для других целей, вроде своего сайта, бота в телеграмме и тп.</p>\n<p>Понял, что для решения проблемы стоит использовать реверс-прокси, остановил свой выбор на Traefik, но не получается настроить его для 3X-UI <em>(с условным приложением на React все получилось)</em>.</p>\n<p>Пробовал искать конфиги, но нашел только пару для X-UI, но с ними не завелось <img src=\"https://ntc.party/images/emoji/twitter/slightly_frowning_face.png?v=12\" title=\":slightly_frowning_face:\" class=\"emoji\" alt=\":slightly_frowning_face:\" loading=\"lazy\" width=\"20\" height=\"20\">.</p>\n<details>\n<summary>\nПервый вариант</summary>\n<blockquote>\n<p>В x-ui для inbound с Reality включен только этот Reality. По поводу путей панели и подписок у меня договорённость между x-ui и Traefik. Для HOSTNAME перед запуском был выполнен экспорт из bash: export HOSTNAME. Энтрипоинт на :54321 был добавлен для удобства с панелью. Сейчас у меня x-ui, а у 3x-ui другой дефолтный порт. Да и вообще обратите внимание на имена энтрипоинтов, вдруг не совпадают.</p>\n</blockquote>\n<pre><code class=\"lang-auto\">version: '3.9'\nservices:\n  xui:  \n    image: alireza7/x-ui:1.5.5\n    container_name: x-ui\n    hostname: ${HOSTNAME}\n    volumes:\n      - \"./db/:/etc/x-ui/\"\n      - \"./cert/:/cert/\"\n    environment:\n      - XRAY_VMESS_AEAD_FORCED=false\n      - XUI_LOG_LEVEL=warn\n    restart: unless-stopped\n#    network_mode: host\n    labels:\n      - \"traefik.enable=true\"\n      # Web panel\n      - \"traefik.http.routers.xui-panel-r.entrypoints=websecure\"\n      - \"traefik.http.routers.xui-panel-r.rule=HostRegexp(`{host:.+}`) &amp;&amp; PathPrefix(`/xuipanel`)\"\n      - \"traefik.http.routers.xui-panel-r.tls=true\"\n      - \"traefik.http.routers.xui-panel-r.service=xui-panel-s\"\n      - \"traefik.http.services.xui-panel-s.loadbalancer.server.port=54321\"\n      # Web panel fix port\n      - \"traefik.http.routers.xui-panel-rr.entrypoints=p54321\"\n      - \"traefik.http.routers.xui-panel-rr.rule=HostRegexp(`{host:.+}`)\"\n      - \"traefik.http.routers.xui-panel-rr.tls=true\"\n      - \"traefik.http.routers.xui-panel-rr.middlewares=xui-redirect\"\n      - \"traefik.http.middlewares.xui-redirect.redirectscheme.scheme=https\"\n      - \"traefik.http.middlewares.xui-redirect.redirectscheme.port=443\"\n      - \"traefik.http.routers.xui-panel-rr.service=noop@internal\"\n      # Subscriptions\n      - \"traefik.http.routers.xui-sub-r.entrypoints=websecure\"\n      - \"traefik.http.routers.xui-sub-r.rule=HostRegexp(`{host:.+}`) &amp;&amp; PathPrefix(`/xuisub`)\"\n      - \"traefik.http.routers.xui-sub-r.tls=true\"\n      - \"traefik.http.routers.xui-sub-r.service=xui-sub-s\"\n      - \"traefik.http.services.xui-sub-s.loadbalancer.server.port=4430\"\n      # Shadowsocks\n      - \"traefik.tcp.routers.xui-shadowsocks-r.rule=ClientIP(`0.0.0.0/0`)\"\n      - \"traefik.tcp.routers.xui-shadowsocks-r.service=xui-shadowsocks-s\"\n      - \"traefik.tcp.routers.xui-shadowsocks-r.entrypoints=p8080\"\n      - \"traefik.tcp.services.xui-shadowsocks-s.loadbalancer.server.port=8080\"\n      # Vless/Reality\n      - \"traefik.tcp.routers.xui-reality-r.rule=HostSNI(`microsoft.com`)\"\n      - \"traefik.tcp.routers.xui-reality-r.tls.passthrough=true\"\n      - \"traefik.tcp.routers.xui-reality-r.service=xui-reality-s\"\n      - \"traefik.tcp.routers.xui-reality-r.entrypoints=websecure\"\n      - \"traefik.tcp.services.xui-reality-s.loadbalancer.server.port=443\"\n    networks:\n      traefik:\n#      xui-bridge:\nnetworks:\n  traefik:\n    external: true\n#  xui-bridge:\n#    name: xui\n\n</code></pre>\n</details>\n<details>\n<summary>\nВторой вариант</summary>\n<blockquote>\n<p>Идея в том, что нужно создать роутер, который будет отправлять запросы на поддельный адрес (<a href=\"http://www.microsoft.com\" rel=\"noopener nofollow ugc\">www.microsoft.com</a> в моем случае) на 443 порт контейнера. Для этого используется директива HostSNI.<br>\n443 порт в контейнере должен быть свободен, веб-морду и сервис подписок вешайте на другие порты (я на них делаю роутинг через отдельные поддомены, traefik запрашивает сертификат сразу на все поддомены, wildcard certificate).</p>\n</blockquote>\n<pre><code class=\"lang-auto\">version: \"3.9\"\n\nservices:\n  xui:\n    image: alireza7/x-ui\n    container_name: x-ui\n    volumes:\n      - ПУТЬ_ДЛЯ_БЕКАПА_НАСТРОЕК:/etc/x-ui/\n    environment:\n      PUID: 1000\n      PGID: 1000\n      TZ: America/Los_Angeles #ПОМЕНЯЙТЕ НА СВОЙ ЧАСОВОЙ ПОЯС\n      XRAY_VMESS_AEAD_FORCED: \"false\"\n    networks:\n      - intranet\n    restart: unless-stopped\n    labels:\n      - traefik.http.routers.xui.rule=Host(`xui.ДОМЕН_TRAEFIK.com`)\n      - traefik.http.routers.xui.service=xui-web-config\n      - traefik.http.services.xui-web-config.loadbalancer.server.port=54321 #ПОРТ ДЛЯ Web-морды\n\n      - traefik.http.routers.xui-sub.rule=Host(`sssub.ДОМЕН_TRAEFIK.com`)\n      - traefik.http.routers.xui-sub.service=xui-subscription\n      - traefik.http.services.xui-subscription.loadbalancer.server.port=4433 #ПОРТ для подписок\n\n      - traefik.tcp.routers.vless.rule=HostSNI(`www.microsoft.com`) \n      - traefik.tcp.routers.vless.tls.passthrough=true\n      - traefik.tcp.routers.vless.service=xui-reality\n      - traefik.tcp.services.xui-reality.loadbalancer.server.port=443\n      \nnetworks:\n  intranet: #СЕТЬ В КОТОРОЙ РАБОТАЕТ TRAEFIK\n    external: true\n</code></pre>\n<blockquote>\n<p>Единственная проблема в том, что в веб-морде неправильно отображается ссылка на подписки, приходится менять http на https в начале и удалять порт.</p>\n</blockquote>\n</details>\n<p>Думаю тема достаточно актуальна и может быть полезна для настройки нескольких протоколов на сервере не только для меня.</p>\n<p>Если кто-то уже использует связку Traefik и 3X-UI, не могли бы вы поделиться своим конфигом compose файла?</p>",
        "post_number": 1,
        "post_type": 1,
        "posts_count": 9,
        "updated_at": "2024-09-17T12:11:28.526Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 3327,
        "reads": 140,
        "readers_count": 139,
        "score": 16613.0,
        "yours": false,
        "topic_id": 7535,
        "topic_slug": "%D0%B8%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5-3x-ui-%D0%B2-%D1%81%D0%B2%D1%8F%D0%B7%D0%BA%D0%B5-%D1%81-traefik",
        "display_username": "Alexander",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 2,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
            {
                "url": "http://www.microsoft.com",
                "internal": false,
                "reflection": false,
                "title": "Microsoft Corporation",
                "clicks": 0
            }
        ],
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 3424,
        "hidden": false,
        "trust_level": 1,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": false,
        "wiki": false,
        "post_url": "/t/%D0%B8%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5-3x-ui-%D0%B2-%D1%81%D0%B2%D1%8F%D0%B7%D0%BA%D0%B5-%D1%81-traefik/7535/1",
        "can_translate": false
    },
    {
        "id": 23938,
        "name": "0ka",
        "username": "0ka",
        "avatar_template": "/letter_avatar_proxy/v4/letter/0/d78d45/{size}.png",
        "created_at": "2024-03-21T23:27:27.163Z",
        "cooked": "<p>это для того, чтобы все сервисы были на 1 порту?</p>",
        "post_number": 2,
        "post_type": 1,
        "posts_count": 9,
        "updated_at": "2024-03-21T23:27:27.163Z",
        "reply_count": 1,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 3,
        "reads": 134,
        "readers_count": 133,
        "score": 46.8,
        "yours": false,
        "topic_id": 7535,
        "topic_slug": "%D0%B8%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5-3x-ui-%D0%B2-%D1%81%D0%B2%D1%8F%D0%B7%D0%BA%D0%B5-%D1%81-traefik",
        "display_username": "0ka",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 488,
        "hidden": false,
        "trust_level": 3,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": false,
        "wiki": false,
        "post_url": "/t/%D0%B8%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5-3x-ui-%D0%B2-%D1%81%D0%B2%D1%8F%D0%B7%D0%BA%D0%B5-%D1%81-traefik/7535/2",
        "can_translate": false
    },
    {
        "id": 23940,
        "name": "Alexander",
        "username": "moocluck",
        "avatar_template": "/letter_avatar_proxy/v4/letter/m/73ab20/{size}.png",
        "created_at": "2024-03-22T07:06:44.713Z",
        "cooked": "<p>Ну можно и так сказать. Просто сайт который стоит на VPS желательно тоже на 443/80 ставить, чтоб посетители не указывали порт при подключении, и Reality очень желательно на 443 ставить.</p>\n<p>По сути на 443/80 стоит Traefik, а он уже в зависимости от запроса направляет его куда нужно.</p>\n<p>Можно место traefik использовать nginx, но мне traefik показался более удобным ещё и certbot отдельно ставить не нужно.</p>",
        "post_number": 3,
        "post_type": 1,
        "posts_count": 9,
        "updated_at": "2024-03-22T07:09:16.086Z",
        "reply_count": 1,
        "reply_to_post_number": 2,
        "quote_count": 0,
        "incoming_link_count": 2,
        "reads": 131,
        "readers_count": 130,
        "score": 41.2,
        "yours": false,
        "topic_id": 7535,
        "topic_slug": "%D0%B8%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5-3x-ui-%D0%B2-%D1%81%D0%B2%D1%8F%D0%B7%D0%BA%D0%B5-%D1%81-traefik",
        "display_username": "Alexander",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 2,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "reply_to_user": {
            "username": "0ka",
            "name": "0ka",
            "avatar_template": "/letter_avatar_proxy/v4/letter/0/d78d45/{size}.png"
        },
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 3424,
        "hidden": false,
        "trust_level": 1,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": false,
        "wiki": false,
        "post_url": "/t/%D0%B8%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5-3x-ui-%D0%B2-%D1%81%D0%B2%D1%8F%D0%B7%D0%BA%D0%B5-%D1%81-traefik/7535/3",
        "can_translate": false
    },
    {
        "id": 23944,
        "name": "0ka",
        "username": "0ka",
        "avatar_template": "/letter_avatar_proxy/v4/letter/0/d78d45/{size}.png",
        "created_at": "2024-03-22T09:41:18.483Z",
        "cooked": "<aside class=\"quote no-group\" data-username=\"moocluck\" data-post=\"3\" data-topic=\"7535\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://ntc.party/letter_avatar_proxy/v4/letter/m/73ab20/48.png\" class=\"avatar\"> moocluck:</div>\n<blockquote>\n<p>Reality очень желательно на 443 ставить.</p>\n</blockquote>\n</aside>\n<p>В китае возможно да, но если вы в рф, то reality будет только замедлять соединение, в данный момент не вижу в нем смысла</p>",
        "post_number": 4,
        "post_type": 1,
        "posts_count": 9,
        "updated_at": "2024-03-22T09:42:14.027Z",
        "reply_count": 0,
        "reply_to_post_number": 3,
        "quote_count": 1,
        "incoming_link_count": 10,
        "reads": 121,
        "readers_count": 120,
        "score": 74.2,
        "yours": false,
        "topic_id": 7535,
        "topic_slug": "%D0%B8%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5-3x-ui-%D0%B2-%D1%81%D0%B2%D1%8F%D0%B7%D0%BA%D0%B5-%D1%81-traefik",
        "display_username": "0ka",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 488,
        "hidden": false,
        "trust_level": 3,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": false,
        "wiki": false,
        "post_url": "/t/%D0%B8%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5-3x-ui-%D0%B2-%D1%81%D0%B2%D1%8F%D0%B7%D0%BA%D0%B5-%D1%81-traefik/7535/4",
        "can_translate": false
    },
    {
        "id": 23956,
        "name": "",
        "username": "lll",
        "avatar_template": "/letter_avatar_proxy/v4/letter/l/4491bb/{size}.png",
        "created_at": "2024-03-22T19:20:35.996Z",
        "cooked": "<p>Настраивал на основе этих конфигов и рекомендаций.</p>\n<aside class=\"onebox githubblob\" data-onebox-src=\"https://github.com/Team418-git/easyXray/blob/2de299fddf5a972b1946fe2a5585f4dd5eb472b7/docker-compose.yml\">\n  <header class=\"source\">\n\n      <a href=\"https://github.com/Team418-git/easyXray/blob/2de299fddf5a972b1946fe2a5585f4dd5eb472b7/docker-compose.yml\" target=\"_blank\" rel=\"noopener nofollow ugc\">github.com</a>\n  </header>\n\n  <article class=\"onebox-body\">\n    <h4><a href=\"https://github.com/Team418-git/easyXray/blob/2de299fddf5a972b1946fe2a5585f4dd5eb472b7/docker-compose.yml\" target=\"_blank\" rel=\"noopener nofollow ugc\">Team418-git/easyXray/blob/2de299fddf5a972b1946fe2a5585f4dd5eb472b7/docker-compose.yml</a></h4>\n\n\n      <pre><code class=\"lang-yml\">version: \"3.9\"\n\nservices:\n  3x-ui:\n    image: ghcr.io/mhsanaei/3x-ui:v1.7.8\n    container_name: 3x-ui\n    labels:\n      - \"traefik.enable=true\"\n      - \"traefik.http.routers.3x-ui.rule=Host(`${XUI_HOSTNAME}`)\"\n      - \"traefik.http.routers.3x-ui.tls.certresolver=myresolver\"\n      - \"traefik.http.services.3x-ui.loadbalancer.server.port=2053\"\n    environment:\n      XRAY_VMESS_AEAD_FORCED: \"false\"\n      XUI_USERNAME: ${XUI_USERNAME}\n      XUI_PASSWORD: ${XUI_PASSWORD}\n      XUI_PANEL_PORT: ${XUI_PANEL_PORT}\n      XUI_HOSTNAME: ${XUI_HOSTNAME}\n      XUI_EMAIL: ${XUI_EMAIL}\n      TGTOKEN: ${TGTOKEN}\n      ADMINID: ${ADMINID}\n</code></pre>\n\n\n\n  This file has been truncated. <a href=\"https://github.com/Team418-git/easyXray/blob/2de299fddf5a972b1946fe2a5585f4dd5eb472b7/docker-compose.yml\" target=\"_blank\" rel=\"noopener nofollow ugc\">show original</a>\n\n  </article>\n\n  <div class=\"onebox-metadata\">\n    \n    \n  </div>\n\n  <div style=\"clear: both\"></div>\n</aside>\n<aside class=\"onebox allowlistedgeneric\" data-onebox-src=\"https://habr.com/ru/articles/735536/comments/#comment_25847250\">\n  <header class=\"source\">\n      <img src=\"использование-3x-ui-в-связке-с-traefik/e8fc7b34a1237fbc93fd62548efc1a4df1f7fa72.png\" class=\"site-icon\" data-dominant-color=\"97BFD2\" width=\"16\" height=\"16\">\n\n      <a href=\"https://habr.com/ru/articles/735536/comments/#comment_25847250\" target=\"_blank\" rel=\"noopener nofollow ugc\">Хабр</a>\n  </header>\n\n  <article class=\"onebox-body\">\n    <div class=\"aspect-image\" style=\"--aspect-ratio:690/361;\"><img src=\"использование-3x-ui-в-связке-с-traefik/402af0a397458beb8d452c685f57a4cb5666d085.png\" class=\"thumbnail\" data-dominant-color=\"4B6677\" width=\"690\" height=\"362\"></div>\n\n<h3><a href=\"https://habr.com/ru/articles/735536/comments/#comment_25847250\" target=\"_blank\" rel=\"noopener nofollow ugc\">3X-UI: Shadowsocks-2022 &amp; XRay (XTLS) сервер с простой настройкой и...</a></h3>\n\n  <p>Статья опубликована под лицензией Creative Commons BY-NC-SA . В серии предыдущих статей я описывал, почему повсеместно используемые VPN- и прокси-протоколы такие как OpenVPN и L2TP&nbsp; очень уязвимы...</p>\n\n\n  </article>\n\n  <div class=\"onebox-metadata\">\n    \n    \n  </div>\n\n  <div style=\"clear: both\"></div>\n</aside>\n<aside class=\"onebox githubblob\" data-onebox-src=\"https://github.com/sa-mustafa/xray-v2ray-trojan-docker/blob/main/docker-compose.yml\">\n  <header class=\"source\">\n\n      <a href=\"https://github.com/sa-mustafa/xray-v2ray-trojan-docker/blob/main/docker-compose.yml\" target=\"_blank\" rel=\"noopener nofollow ugc\">github.com</a>\n  </header>\n\n  <article class=\"onebox-body\">\n    <h4><a href=\"https://github.com/sa-mustafa/xray-v2ray-trojan-docker/blob/main/docker-compose.yml\" target=\"_blank\" rel=\"noopener nofollow ugc\">sa-mustafa/xray-v2ray-trojan-docker/blob/main/docker-compose.yml</a></h4>\n\n\n      <pre><code class=\"lang-yml\">version: '3.9'\n\nservices:\n  traefik:\n    image: traefik:v2.9.5\n    ports:\n      - target: 80\n        published: 80\n        mode: host\n      - target: 443\n        published: 443\n        mode: host\n    networks: [web]\n    labels:\n      - traefik.enable=true\n      - traefik.docker.network=web\n      # Use the custom label \"traefik.constraint-label=traefik\"\n      # This public Traefik will only use services with this label\n      - traefik.constraint-label=traefik\n    command:\n</code></pre>\n\n\n\n  This file has been truncated. <a href=\"https://github.com/sa-mustafa/xray-v2ray-trojan-docker/blob/main/docker-compose.yml\" target=\"_blank\" rel=\"noopener nofollow ugc\">show original</a>\n\n  </article>\n\n  <div class=\"onebox-metadata\">\n    \n    \n  </div>\n\n  <div style=\"clear: both\"></div>\n</aside>\n\n<p>У меня конфиг самого прокси аналогичен роутеру <code>xui-reality-r</code> из первого варианта; но использую другой домен, не <code>www.microsoft.com</code>.<br>\nВ итоге имею 3 сервиса: 1) поддомен веб-морды 3X-UI; 2) поддомен для подписок (публично доступный); 3) поддомен для самого прокси reality.</p>\n<h2><a name=\"p-23956-h-1\" class=\"anchor\" href=\"#p-23956-h-1\"></a>Пример конфига</h2>\n<p>docker-compose.yml</p>\n<pre data-code-wrap=\"yml\"><code class=\"lang-yml\">---\nversion: '3'\n\nnetworks:\n  traefik_network:\n    external:\n      name: xxx\n\nservices:\n  3x-ui:\n    image: ghcr.io/mhsanaei/3x-ui:latest\n    container_name: 3x-ui\n    networks:\n      - xxx\n    volumes:\n      - $PWD/db/:/etc/x-ui/\n      - $PWD/cert/:/root/cert/\n    environment:\n      XRAY_VMESS_AEAD_FORCED: \"false\"\n    tty: true\n    restart: unless-stopped\n    labels:\n      - \"traefik.enable=true\"\n      - \"traefik.docker.network=xxx\"\n\n      - \"traefik.tcp.routers.xui-proxy.service=xui-proxy\"\n      - \"traefik.tcp.routers.xui-proxy.entrypoints=https\"\n      - \"traefik.tcp.routers.xui-proxy.rule=HostSNI(`foo.bar`,`foo.{{ mydomain }}`)\"\n      - \"traefik.tcp.routers.xui-proxy.tls=true\"\n      - \"traefik.tcp.routers.xui-proxy.tls.passthrough=true\"\n      - \"traefik.tcp.services.xui-proxy.loadbalancer.server.port=443\"\n\n      - \"traefik.http.routers.xui-admin.service=xui-admin\"\n      - \"traefik.http.services.xui-admin.loadbalancer.server.scheme=http\"\n      - \"traefik.http.services.xui-admin.loadbalancer.server.port=2053\"\n      - \"traefik.http.routers.xui-admin-http.service=xui-admin\"\n      - \"traefik.http.routers.xui-admin-http.rule=Host(`xui-admin.{{ mydomain }}`)\"\n      - \"traefik.http.routers.xui-admin-http.entrypoints=http\"\n      - \"traefik.http.routers.xui-admin.rule=Host(`xui-admin.{{ mydomain }}`)\"\n      - \"traefik.http.routers.xui-admin.entrypoints=https\"\n      - \"traefik.http.routers.xui-admin.tls=true\"\n      - \"traefik.http.routers.xui-admin.tls.certresolver=http\"\n\n      - \"traefik.http.routers.xui-sub.service=xui-sub\"\n      - \"traefik.http.services.xui-sub.loadbalancer.server.scheme=http\"\n      - \"traefik.http.services.xui-sub.loadbalancer.server.port=2096\"\n      - \"traefik.http.routers.xui-sub-http.service=xui-sub\"\n      - \"traefik.http.routers.xui-sub-http.rule=Host(`xui-sub.{{ mydomain }}`)\"\n      - \"traefik.http.routers.xui-sub-http.entrypoints=http\"\n      - \"traefik.http.routers.xui-sub-http.middlewares=redirect@file\"\n      - \"traefik.http.routers.xui-sub.rule=Host(`xui-sub.{{ mydomain }}`)\"\n      - \"traefik.http.routers.xui-sub.entrypoints=https\"\n      - \"traefik.http.routers.xui-sub.tls=true\"\n      - \"traefik.http.routers.xui-sub.tls.certresolver=http\"\n      # Fix host for subscription response body\n      - \"traefik.http.middlewares.xui-sub-fix-host.headers.customrequestheaders.host=foo.{{ mydomain }}\"\n      - \"traefik.http.routers.xui-sub.middlewares=xui-sub-fix-host@docker\"\n\n</code></pre>\n<p>traefik.yaml</p>\n<pre data-code-wrap=\"yml\"><code class=\"lang-yml\">entryPoints:\n  http:\n    address: :80\n  https:\n    address: :443\n    http:\n      tls:\n        options: default\n        certResolver: 'http'\n\n</code></pre>",
        "post_number": 5,
        "post_type": 1,
        "posts_count": 9,
        "updated_at": "2024-03-22T19:20:35.996Z",
        "reply_count": 1,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 83,
        "reads": 112,
        "readers_count": 111,
        "score": 442.4,
        "yours": false,
        "topic_id": 7535,
        "topic_slug": "%D0%B8%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5-3x-ui-%D0%B2-%D1%81%D0%B2%D1%8F%D0%B7%D0%BA%D0%B5-%D1%81-traefik",
        "display_username": "",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
            {
                "url": "https://github.com/Team418-git/easyXray/blob/2de299fddf5a972b1946fe2a5585f4dd5eb472b7/docker-compose.yml",
                "internal": false,
                "reflection": false,
                "title": "easyXray/docker-compose.yml at 2de299fddf5a972b1946fe2a5585f4dd5eb472b7 · Team418-git/easyXray · GitHub",
                "clicks": 105
            },
            {
                "url": "https://habr.com/ru/articles/735536/comments/#comment_25847250",
                "internal": false,
                "reflection": false,
                "title": "3X-UI: Shadowsocks-2022 & XRay (XTLS) сервер с простой настройкой и приятным интерфейсом / Комментарии / Хабр",
                "clicks": 58
            },
            {
                "url": "https://github.com/sa-mustafa/xray-v2ray-trojan-docker/blob/main/docker-compose.yml",
                "internal": false,
                "reflection": false,
                "title": "xray-v2ray-trojan-docker/docker-compose.yml at main · sa-mustafa/xray-v2ray-trojan-docker · GitHub",
                "clicks": 35
            }
        ],
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 2749,
        "hidden": false,
        "trust_level": 1,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": false,
        "wiki": false,
        "post_url": "/t/%D0%B8%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5-3x-ui-%D0%B2-%D1%81%D0%B2%D1%8F%D0%B7%D0%BA%D0%B5-%D1%81-traefik/7535/5",
        "can_translate": false
    },
    {
        "id": 24007,
        "name": "Alexander",
        "username": "moocluck",
        "avatar_template": "/letter_avatar_proxy/v4/letter/m/73ab20/{size}.png",
        "created_at": "2024-03-24T02:08:10.621Z",
        "cooked": "<p>Я попробовал настроить еще раз, раньше вообще ничего не работало, теперь веб-морда запустилась, но xrey и подписки не заводится.</p>\n<p>Может вы заметите чего-нибудь?</p>\n<details>\n<summary>\ntraefik.yml</summary>\n<pre><code class=\"lang-auto\">entryPoints:\n  http:\n    address: \":80\"\n  https:\n    address: \":443\"\n\nhttp:\n  routers:\n    http-catchall:\n      rule: hostregexp(`{host:.+}`)\n      entrypoints:\n      - http\n      middlewares:\n      - redirect-to-https\n  middlewares:\n    redirect-to-https:\n      redirectScheme:\n        scheme: https\n        permanent: false\n\nproviders:\n  docker:\n    endpoint: \"unix:///var/run/docker.sock\"\n    exposedByDefault: false\n    network: traefik\n  file:\n    directory: /traefik/config\n    watch: true\n\ncertificatesResolvers:\n  letsEncrypt:\n    acme:\n      email: myemail@email.com\n      storage: /ssl/acme.json\n      httpChallenge:\n        entryPoint: http\n</code></pre>\n</details>\n<details>\n<summary>\ntraefik docker-compose.yml</summary>\n<pre><code class=\"lang-auto\">version: '3.9'\n\nservices:\n  traefik:\n    image: traefik:v2.2\n    container_name: traefik\n    restart: unless-stopped\n    security_opt:\n      - no-new-privileges:true\n    ports:\n      - 80:80\n      - 443:443 \n    volumes:\n      - /etc/localtime:/etc/localtime:ro\n      - /var/run/docker.sock:/var/run/docker.sock:ro\n      - ./logs/:/var/log/traefik/\n      - ./traefik.yml:/traefik.yml:ro\n      - ./config/:/traefik/config/:ro\n      - ./ssl/acme.json:/ssl/acme.json\n    labels:\n      - \"traefik.enable=true\"\n      - \"traefik.http.routers.traefik.entrypoints=https\"\n      - \"traefik.http.routers.traefik.rule=Host(`traefik.mydomain.io`)\"\n      - \"traefik.http.routers.traefik.tls=true\"\n      - \"traefik.http.routers.traefik.tls.certresolver=letsEncrypt\"\n      - \"traefik.http.routers.traefik.service=api@internal\"\n      - \"traefik.http.middlewares.traefik-auth.basicauth.users=login:password\"\n      - \"traefik.http.routers.traefik.middlewares=traefik-auth\"\n\nnetworks:\n  default:\n    name: traefik\n</code></pre>\n</details>\n<details>\n<summary>\n3x-ui docker-compose.yml</summary>\n<pre><code class=\"lang-auto\">version: \"3.9\"\n\nservices:\n  3x-ui:\n    image: ghcr.io/mhsanaei/3x-ui:latest\n    container_name: 3x-ui\n    volumes:\n      - $PWD/db/:/etc/x-ui/\n      - $PWD/cert/:/root/cert/\n    environment:\n      XRAY_VMESS_AEAD_FORCED: \"false\"\n    restart: unless-stopped\n    networks:\n      - traefik\n    labels:\n      - \"traefik.enable=true\"\n\n      # Web panel\n      - \"traefik.http.routers.xui-admin-http.service=xui-admin\"\n      - \"traefik.http.routers.xui-admin-http.rule=Host(`vless.mydomain.io`)\"\n      - \"traefik.http.routers.xui-admin-http.entrypoints=http\"\n\n      - \"traefik.http.routers.xui-admin.service=xui-admin\"\n      - \"traefik.http.routers.xui-admin.rule=Host(`vless.mydomain.io`)\"\n      - \"traefik.http.routers.xui-admin.entrypoints=https\"\n      - \"traefik.http.routers.xui-admin.tls=true\"\n      - \"traefik.http.routers.xui-admin.tls.certresolver=http\"\n\n      - \"traefik.http.services.xui-admin.loadbalancer.server.scheme=http\"\n      - \"traefik.http.services.xui-admin.loadbalancer.server.port=web-panel-port\"\n\n      # Subscriptions\n      - \"traefik.http.routers.xui-sub-http.service=xui-sub\"\n      - \"traefik.http.routers.xui-sub-http.rule=Host(`vless-sub.mydomain.io`)\"\n      - \"traefik.http.routers.xui-sub-http.entrypoints=http\"\n\n      - \"traefik.http.routers.xui-sub.service=xui-sub\"\n      - \"traefik.http.routers.xui-sub.rule=Host(`vless-sub.moocluck.ru`)\"\n      - \"traefik.http.routers.xui-sub.entrypoints=https\"\n      - \"traefik.http.routers.xui-sub.tls=true\"\n      - \"traefik.http.routers.xui-sub.tls.certresolver=http\"\n\n      - \"traefik.http.services.xui-sub.loadbalancer.server.scheme=http\"\n      - \"traefik.http.services.xui-sub.loadbalancer.server.port=subscriptions-port\"\n\n      # Vless/Reality\n      - \"traefik.tcp.routers.xui-proxy.service=xui-proxy\"\n      - \"traefik.tcp.routers.xui-proxy.entrypoints=https\"\n      - \"traefik.tcp.routers.xui-proxy.rule=HostSNI(`preinformer.com`)\"\n      - \"traefik.tcp.routers.xui-proxy.tls=true\"\n      - \"traefik.tcp.routers.xui-proxy.tls.passthrough=true\"\n\n      - \"traefik.tcp.services.xui-proxy.loadbalancer.server.port=443\"\n\nnetworks:\n  traefik: \n    external: true\n\n</code></pre>\n</details>\n<p>Ошибка xrey:</p>\n<pre><code class=\"lang-auto\">XRAY: Failed to start: app/proxyman/inbound: failed to listen TCP on 443 &gt; transport/internet:failed to listen on address: 188.212.125.206:443 &gt; transport/internet/tcp: failed to listen TCP on 188.212.125.206:443 &gt; listen tcp 188.212.125.206:443: bind: cannot assign requested address\n</code></pre>",
        "post_number": 6,
        "post_type": 1,
        "posts_count": 9,
        "updated_at": "2024-03-24T02:08:10.621Z",
        "reply_count": 1,
        "reply_to_post_number": 5,
        "quote_count": 0,
        "incoming_link_count": 23,
        "reads": 92,
        "readers_count": 91,
        "score": 138.4,
        "yours": false,
        "topic_id": 7535,
        "topic_slug": "%D0%B8%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5-3x-ui-%D0%B2-%D1%81%D0%B2%D1%8F%D0%B7%D0%BA%D0%B5-%D1%81-traefik",
        "display_username": "Alexander",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "reply_to_user": {
            "username": "lll",
            "name": "",
            "avatar_template": "/letter_avatar_proxy/v4/letter/l/4491bb/{size}.png"
        },
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 3424,
        "hidden": false,
        "trust_level": 1,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": false,
        "wiki": false,
        "post_url": "/t/%D0%B8%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5-3x-ui-%D0%B2-%D1%81%D0%B2%D1%8F%D0%B7%D0%BA%D0%B5-%D1%81-traefik/7535/6",
        "can_translate": false
    },
    {
        "id": 24021,
        "name": "",
        "username": "lll",
        "avatar_template": "/letter_avatar_proxy/v4/letter/l/4491bb/{size}.png",
        "created_at": "2024-03-24T12:46:31.871Z",
        "cooked": "<p>Похоже на проблемы в конфигурации самого docker / traefik, без учета специфики 3x-ui. Поищи документацию или начни с рабочего примера traefik.</p>\n<p>Для network traefik у меня определено так:</p>\n<pre data-code-wrap=\"yml\"><code class=\"lang-yml\">networks:\n  traefik:\n    name: foo\n    driver: bridge\n</code></pre>",
        "post_number": 7,
        "post_type": 1,
        "posts_count": 9,
        "updated_at": "2024-03-24T12:46:31.871Z",
        "reply_count": 1,
        "reply_to_post_number": 6,
        "quote_count": 0,
        "incoming_link_count": 26,
        "reads": 95,
        "readers_count": 94,
        "score": 154.0,
        "yours": false,
        "topic_id": 7535,
        "topic_slug": "%D0%B8%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5-3x-ui-%D0%B2-%D1%81%D0%B2%D1%8F%D0%B7%D0%BA%D0%B5-%D1%81-traefik",
        "display_username": "",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "reply_to_user": {
            "username": "moocluck",
            "name": "Alexander",
            "avatar_template": "/letter_avatar_proxy/v4/letter/m/73ab20/{size}.png"
        },
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 2749,
        "hidden": false,
        "trust_level": 1,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": false,
        "wiki": false,
        "post_url": "/t/%D0%B8%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5-3x-ui-%D0%B2-%D1%81%D0%B2%D1%8F%D0%B7%D0%BA%D0%B5-%D1%81-traefik/7535/7",
        "can_translate": false
    },
    {
        "id": 24022,
        "name": "Alexander",
        "username": "moocluck",
        "avatar_template": "/letter_avatar_proxy/v4/letter/m/73ab20/{size}.png",
        "created_at": "2024-03-24T13:27:13.738Z",
        "cooked": "<p>Проверю, но думаю дело не в настройке сети, потому что веб морда заводится, а значит traefik видит контейнер с 3x-ui и направляет трафик на морду, значит контейнеры работают в одной сети</p>",
        "post_number": 8,
        "post_type": 1,
        "posts_count": 9,
        "updated_at": "2024-03-24T13:27:13.738Z",
        "reply_count": 0,
        "reply_to_post_number": 7,
        "quote_count": 0,
        "incoming_link_count": 29,
        "reads": 88,
        "readers_count": 87,
        "score": 162.6,
        "yours": false,
        "topic_id": 7535,
        "topic_slug": "%D0%B8%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5-3x-ui-%D0%B2-%D1%81%D0%B2%D1%8F%D0%B7%D0%BA%D0%B5-%D1%81-traefik",
        "display_username": "Alexander",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "reply_to_user": {
            "username": "lll",
            "name": "",
            "avatar_template": "/letter_avatar_proxy/v4/letter/l/4491bb/{size}.png"
        },
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 3424,
        "hidden": false,
        "trust_level": 1,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": false,
        "wiki": false,
        "post_url": "/t/%D0%B8%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5-3x-ui-%D0%B2-%D1%81%D0%B2%D1%8F%D0%B7%D0%BA%D0%B5-%D1%81-traefik/7535/8",
        "can_translate": false
    },
    {
        "id": 78575,
        "name": "Igor",
        "username": "gaarysn",
        "avatar_template": "/user_avatar/ntc.party/gaarysn/{size}/14829_2.png",
        "created_at": "2025-01-10T19:40:37.787Z",
        "cooked": "<p>Если у вас всё же получилось, можете скинуть компоузы traefik и 3x-ui?</p>",
        "post_number": 9,
        "post_type": 1,
        "posts_count": 9,
        "updated_at": "2025-01-10T19:40:37.787Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 1,
        "reads": 34,
        "readers_count": 33,
        "score": 11.8,
        "yours": false,
        "topic_id": 7535,
        "topic_slug": "%D0%B8%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5-3x-ui-%D0%B2-%D1%81%D0%B2%D1%8F%D0%B7%D0%BA%D0%B5-%D1%81-traefik",
        "display_username": "Igor",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 9210,
        "hidden": false,
        "trust_level": 0,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": false,
        "wiki": false,
        "post_url": "/t/%D0%B8%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5-3x-ui-%D0%B2-%D1%81%D0%B2%D1%8F%D0%B7%D0%BA%D0%B5-%D1%81-traefik/7535/9",
        "can_translate": false
    }
]