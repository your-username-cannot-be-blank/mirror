
    <html>
      <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <style>
    th, td {
      border: 1px solid black;
      border-collapse: collapse;
    }
    th, td {
      word-wrap: break-word;
      padding: 5px;
    }
    table {
      width: 100%;
      max-width: 100%;
      border: 1px solid black;
      border-collapse: collapse;
      table-layout: fixed;
      word-wrap: break-word
    }
    code {
      word-wrap: break-word;
    }
    pre {
        white-space: pre-wrap;
    }
    </style>
        <title>tor-and-nodefamily</title>
      </head>
      <body>
        <table border="1" width="100%" cellpadding="5">
          <tr>
            <th style="width: 10%;">Ник</th>
            <th>Пост</th>
            <th style="width: 10%;">Дата</th>
          </tr>
    <tr><td>x2922477383(x2922477383)</td><td><p>Друзья, хотел настроить Tor не использовать в построении цепочек узлы из одних и тех же стран. Например не допускать построения цепочек RU-RU-RU (очень маловероятный сценарий, но все же благодаря ТСПУ можно считать что в РФ есть глобальный наблюдатель) или DE-DE-DE (встречается ну очень часто).<br>
Из актуального <a href="https://gitlab.torproject.org/tpo/core/tor/-/blob/main/doc/man/tor.1.txt" rel="noopener nofollow ugc">мануала</a> решаю воспользоваться NodeFamily.<br>
В torrc торбраузера вставляю все страны из iso и неопределенные страны, но результата нет, строит как и раньше</p>
<pre><code class="lang-auto">...
NodeFamily {AD}
NodeFamily {AE}
NodeFamily {AF}
NodeFamily {AG}
NodeFamily {AI}
NodeFamily {AL}
NodeFamily {AM}
NodeFamily {AO}
NodeFamily {AQ}
NodeFamily {AR}
NodeFamily {AS}
NodeFamily {AT}
NodeFamily {AU}
NodeFamily {AW}
NodeFamily {AX}
NodeFamily {AZ}
NodeFamily {BA}
NodeFamily {BB}
NodeFamily {BD}
NodeFamily {BE}
NodeFamily {BF}
NodeFamily {BG}
NodeFamily {BH}
NodeFamily {BI}
NodeFamily {BJ}
NodeFamily {BL}
NodeFamily {BM}
NodeFamily {BN}
NodeFamily {BO}
NodeFamily {BQ}
NodeFamily {BR}
NodeFamily {BS}
NodeFamily {BT}
NodeFamily {BV}
NodeFamily {BW}
NodeFamily {BY}
NodeFamily {BZ}
NodeFamily {CA}
NodeFamily {CC}
NodeFamily {CD}
NodeFamily {CF}
NodeFamily {CG}
NodeFamily {CH}
NodeFamily {CI}
NodeFamily {CK}
NodeFamily {CL}
NodeFamily {CM}
NodeFamily {CN}
NodeFamily {CO}
NodeFamily {CR}
NodeFamily {CU}
NodeFamily {CV}
NodeFamily {CW}
NodeFamily {CX}
NodeFamily {CY}
NodeFamily {CZ}
NodeFamily {DE}
NodeFamily {DJ}
NodeFamily {DK}
NodeFamily {DM}
NodeFamily {DO}
NodeFamily {DZ}
NodeFamily {EC}
NodeFamily {EE}
NodeFamily {EG}
NodeFamily {EH}
NodeFamily {ER}
NodeFamily {ES}
NodeFamily {ET}
NodeFamily {FI}
NodeFamily {FJ}
NodeFamily {FK}
NodeFamily {FM}
NodeFamily {FO}
NodeFamily {FR}
NodeFamily {GA}
NodeFamily {GB}
NodeFamily {GD}
NodeFamily {GE}
NodeFamily {GF}
NodeFamily {GG}
NodeFamily {GH}
NodeFamily {GI}
NodeFamily {GL}
NodeFamily {GM}
NodeFamily {GN}
NodeFamily {GP}
NodeFamily {GQ}
NodeFamily {GR}
NodeFamily {GS}
NodeFamily {GT}
NodeFamily {GU}
NodeFamily {GW}
NodeFamily {GY}
NodeFamily {HK}
NodeFamily {HM}
NodeFamily {HN}
NodeFamily {HR}
NodeFamily {HT}
NodeFamily {HU}
NodeFamily {ID}
NodeFamily {IE}
NodeFamily {IL}
NodeFamily {IM}
NodeFamily {IN}
NodeFamily {IO}
NodeFamily {IQ}
NodeFamily {IR}
NodeFamily {IS}
NodeFamily {IT}
NodeFamily {JE}
NodeFamily {JM}
NodeFamily {JO}
NodeFamily {JP}
NodeFamily {KE}
NodeFamily {KG}
NodeFamily {KH}
NodeFamily {KI}
NodeFamily {KM}
NodeFamily {KN}
NodeFamily {KP}
NodeFamily {KR}
NodeFamily {KW}
NodeFamily {KY}
NodeFamily {KZ}
NodeFamily {LA}
NodeFamily {LB}
NodeFamily {LC}
NodeFamily {LI}
NodeFamily {LK}
NodeFamily {LR}
NodeFamily {LS}
NodeFamily {LT}
NodeFamily {LU}
NodeFamily {LV}
NodeFamily {LY}
NodeFamily {MA}
NodeFamily {MC}
NodeFamily {MD}
NodeFamily {ME}
NodeFamily {MF}
NodeFamily {MG}
NodeFamily {MH}
NodeFamily {MK}
NodeFamily {ML}
NodeFamily {MM}
NodeFamily {MN}
NodeFamily {MO}
NodeFamily {MP}
NodeFamily {MQ}
NodeFamily {MR}
NodeFamily {MS}
NodeFamily {MT}
NodeFamily {MU}
NodeFamily {MV}
NodeFamily {MW}
NodeFamily {MX}
NodeFamily {MY}
NodeFamily {MZ}
NodeFamily {NA}
NodeFamily {NC}
NodeFamily {NE}
NodeFamily {NF}
NodeFamily {NG}
NodeFamily {NI}
NodeFamily {NL}
NodeFamily {NO}
NodeFamily {NP}
NodeFamily {NR}
NodeFamily {NU}
NodeFamily {NZ}
NodeFamily {OM}
NodeFamily {PA}
NodeFamily {PE}
NodeFamily {PF}
NodeFamily {PG}
NodeFamily {PH}
NodeFamily {PK}
NodeFamily {PL}
NodeFamily {PM}
NodeFamily {PN}
NodeFamily {PR}
NodeFamily {PS}
NodeFamily {PT}
NodeFamily {PW}
NodeFamily {PY}
NodeFamily {QA}
NodeFamily {RE}
NodeFamily {RO}
NodeFamily {RS}
NodeFamily {RU}
NodeFamily {RW}
NodeFamily {SA}
NodeFamily {SB}
NodeFamily {SC}
NodeFamily {SD}
NodeFamily {SE}
NodeFamily {SG}
NodeFamily {SH}
NodeFamily {SI}
NodeFamily {SJ}
NodeFamily {SK}
NodeFamily {SL}
NodeFamily {SM}
NodeFamily {SN}
NodeFamily {SO}
NodeFamily {SR}
NodeFamily {SS}
NodeFamily {ST}
NodeFamily {SV}
NodeFamily {SX}
NodeFamily {SY}
NodeFamily {SZ}
NodeFamily {TC}
NodeFamily {TD}
NodeFamily {TF}
NodeFamily {TG}
NodeFamily {TH}
NodeFamily {TJ}
NodeFamily {TK}
NodeFamily {TL}
NodeFamily {TM}
NodeFamily {TN}
NodeFamily {TO}
NodeFamily {TR}
NodeFamily {TT}
NodeFamily {TV}
NodeFamily {TW}
NodeFamily {TZ}
NodeFamily {UA}
NodeFamily {UG}
NodeFamily {UM}
NodeFamily {US}
NodeFamily {UY}
NodeFamily {UZ}
NodeFamily {VA}
NodeFamily {VC}
NodeFamily {VE}
NodeFamily {VG}
NodeFamily {VI}
NodeFamily {VN}
NodeFamily {VU}
NodeFamily {WF}
NodeFamily {WS}
NodeFamily {YE}
NodeFamily {YT}
NodeFamily {ZA}
NodeFamily {ZM}
NodeFamily {ZW}
NodeFamily {??}
UseBridges 1
</code></pre>
<p><div class="lightbox-wrapper"><a class="lightbox" href="tor-and-nodefamily/ff5af278c9d52dbe67c6784c9aaa91de5721a6e5.jpeg" data-download-href="https://ntc.party/uploads/default/ff5af278c9d52dbe67c6784c9aaa91de5721a6e5" title="tor bug"><img src="tor-and-nodefamily/ff5af278c9d52dbe67c6784c9aaa91de5721a6e5_2_671x500.jpeg" alt="tor bug" data-base62-sha1="AqYBIu3apOMMtMO1FfM9KCWOq0J" width="671" height="500" srcset="tor-and-nodefamily/ff5af278c9d52dbe67c6784c9aaa91de5721a6e5_2_671x500.jpeg, tor-and-nodefamily/ff5af278c9d52dbe67c6784c9aaa91de5721a6e5.jpeg 1.5x, tor-and-nodefamily/ff5af278c9d52dbe67c6784c9aaa91de5721a6e5.jpeg 2x" data-dominant-color="BCB1C6"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">tor bug</span><span class="informations">838×624 144 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>это баг или я не разобрался?</p></td><td>2023-09-28T13:36:48.442Z</td></tr><tr><td>welazsc</td><td><p>Также не будет работать строчка с адресом, без указания узла.<br>
Узел идентифицируется отпечатком, не страной или адресом.<br>
Код ищет указание на узел в строке NodeFamily, затем добавляет в семью все остальное в т.ч. все ноды со страной (странами).</p>
<p>NodeFamily исправляет недостаток информации для конкретного узла, а не все другое сразу.</p>
<p>Считаете это багом? Создайте тикет.<br>
Но это скорей всего фича, а новую стоит риквестировать сразу в арти.</p>
<p>Против глобального наблюдателя сепарировать лучше по AS. Поищите по трекеру, в т.ч. закрытым тикетам, или рассылкам, там где-то обсуждалось. <a href="https://gitlab.torproject.org/tpo/core/tor/-/issues/3678" rel="noopener nofollow ugc">[1]</a> <a href="https://gitlab.torproject.org/tpo/core/tor/-/issues/4981" rel="noopener nofollow ugc">[2]</a></p></td><td>2023-09-28T14:42:18.864Z</td></tr><tr><td>x2922477383(x2922477383)</td><td><p>вот описание из man</p>
<pre><code class="lang-auto">[[NodeFamily]] **NodeFamily** __node__,__node__,__...__::
    The Tor servers, defined by their identity fingerprints,
    constitute a "family" of similar or co-administered servers, so never use
    any two of them in the same circuit. Defining a NodeFamily is only needed
    when a server doesn't list the family itself (with MyFamily). This option
    can be used multiple times; each instance defines a separate family.  In
    addition to nodes, you can also list IP address and ranges and country
    codes in {curly braces}. See &lt;&lt;ExcludeNodes,ExcludeNodes&gt;&gt; for more
    information on how to specify nodes.

</code></pre>
<p>синтаксис</p>
<pre><code class="lang-auto">[[ExcludeNodes]] **ExcludeNodes** __node__,__node__,__...__::
    A list of identity fingerprints, country codes, and address
    patterns of nodes to avoid when building a circuit. Country codes are
    2-letter ISO3166 codes, and must
    be wrapped in braces; fingerprints may be preceded by a dollar sign.
    (Example:
    ExcludeNodes ABCD1234CDEF5678ABCD1234CDEF5678ABCD1234, \{cc}, 255.254.0.0/8) +
     +
    This option can appear multiple times: the values from multiple lines are
    spliced together. +
     +
    By default, this option is treated as a preference that Tor is allowed
    to override in order to keep working.
    For example, if you try to connect to a hidden service,
    but you have excluded all of the hidden service's introduction points,
    Tor will connect to one of them anyway.  If you do not want this
    behavior, set the StrictNodes option (documented below).  +
     +
    Note also that if you are a relay, this (and the other node selection
    options below) only affects your own circuits that Tor builds for you.
    Clients can still build circuits through you to any node.  Controllers
    can tell Tor to build circuits through any node. +
     +
    Country codes are case-insensitive. The code "\{??}" refers to nodes whose
    country can't be identified. No country code, including \{??}, works if
    no GeoIPFile can be loaded. See also the &lt;&lt;GeoIPExcludeUnknown,GeoIPExcludeUnknown&gt;&gt; option below.

</code></pre>
<p>очень жаль, из описания сложилось другое впечатление</p></td><td>2023-09-28T16:41:52.559Z</td></tr><tr><td>welazsc</td><td><p>Кстати, MyFamily работает только при перекрестных ссылках. Иначе bad узел, попав в цепочку, может исключить произвольно другие узлы, создав условие для атаки.</p></td><td>2023-09-28T16:51:22.453Z</td></tr><tr><td>welazsc</td><td><p>Вообще можно написать патч, он должен быть не сложный. Возможно где-то уже существует такой. Но его не примут в код, придется собирать самим для каждой новой версии. Шифропанк своими руками.</p></td><td>2023-09-28T17:04:22.829Z</td></tr><tr><td>x2922477383(x2922477383)</td><td><p>к сожалению не силен в тикетах и реквестах, поэтому мое наблюдение останется не востребованным</p></td><td>2023-09-28T17:08:31.212Z</td></tr><tr><td>LeonMskRu(Leon MskRu)</td><td><p>как вариант Tor Control Panel<br>
<div class="lightbox-wrapper"><a class="lightbox" href="tor-and-nodefamily/42780e0b400ee7402c5ba6523c1eb50326ba7d82.png" data-download-href="https://ntc.party/uploads/default/42780e0b400ee7402c5ba6523c1eb50326ba7d82" title="image"><img src="tor-and-nodefamily/42780e0b400ee7402c5ba6523c1eb50326ba7d82.png" alt="image" data-base62-sha1="9u0JdOeBNEyQjpukeiYY4hLQgcG" width="690" height="150" data-dominant-color="E6EAEE"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">715×156 10.3 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div><br>
отдельно настраиваются ВХОД / ВЫХОД / “middle”</p></td><td>2023-09-28T22:48:22.236Z</td></tr><tr><td>ValdikSS</td><td><p>Также можно управлять построением цепочек и туннелей вручную через ControlPort, добавив параметр <code>__LeaveStreamsUnattached 1</code> в конфиг. Каждое соединение будет генерировать событие в ControlPort, соединение нужно присоединять к circuit’у самостоятельно (программно).</p>
<p>Circuit можно построить произвольной длины и с указанием конкретных релеев.</p></td><td>2023-09-28T23:04:11.358Z</td></tr><tr><td>welazsc</td><td><blockquote>
<p>Вот так, с помощью нехитрых приспособлений буханку белого (или черного) хлеба можно превратить в троллейбус…</p>
</blockquote>
<p><a class="attachment" href="tor-and-nodefamily/rp0SZz2ZNRsTutLFC6OBWtsd8fz.patch">countries.patch</a> (1.3 KB)</p></td><td>2023-09-29T09:24:05.385Z</td></tr><tr><td>x2922477383(x2922477383)</td><td><p>Спасибо. Попробую подтянуть гит, си и компиляцию приложений.</p></td><td>2023-10-02T22:07:44.158Z</td></tr><tr><td>welazsc</td><td><p>Патч как пример, там исключен добавленный код для исполнения. Кроме того, есть типы цепочек (HS, ускорение) которые принципиально не учитывают families (ips, subnets), а только отпечатки. У вас может возникнуть ситуация когда в цепочке используются разные узлы с одним адресом. Это не ошибка, это документированное использование. Я не знаю, что с этим делать.</p></td><td>2023-10-03T07:55:38.737Z</td></tr><tr><td>x2922477383(x2922477383)</td><td><p>Вот попалось, вроде и не заметно что оба сервера из Германии.</p>
<p><img src="tor-and-nodefamily/550141257dd6127dbfe27f4e494571c25fff3287.jpeg" alt="eu" data-base62-sha1="c7ZgUeZBZa2DYffmP5XlVrnr8uH" width="278" height="161"></p>
<p>От куда EU вообще взялось? Нет такого кода в ISO3166.</p></td><td>2023-10-13T09:30:35.094Z</td></tr><tr><td>usnevst</td><td><p>Используют <a href="https://location.ipfire.org/" rel="noopener nofollow ugc">IPFire Location Database</a></p>
<aside class="onebox wikipedia" data-onebox-src="https://en.wikipedia.org/wiki/ISO_3166-1_alpha-2#EU">
  <header class="source">

      <a href="https://en.wikipedia.org/wiki/ISO_3166-1_alpha-2#EU" target="_blank" rel="noopener nofollow ugc">en.wikipedia.org</a>
  </header>

  <article class="onebox-body">
    

<h3><a href="https://en.wikipedia.org/wiki/ISO_3166-1_alpha-2#EU" target="_blank" rel="noopener nofollow ugc">ISO 3166-1 alpha-2</a></h3>

<p>ISO 3166-1 alpha-2 codes are two-letter country codes defined in ISO 3166-1, part of the ISO 3166 standard published by the International Organization for Standardization (ISO), to represent countries, dependent territories, and special areas of geographical interest. They are the most widely used of the country codes published by ISO (the others being alpha-3 and numeric), and are used most prominently for the Internet's country code top-level domains (with a few exceptions). They are also us Th...</p>

  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

<blockquote>
<p>Exceptionally reserved code elements are codes reserved at the request of national ISO member bodies, governments and international organizations, which are required in order to support a particular application, as specified by the requesting body and limited to such use</p>
</blockquote>
<blockquote>
<p>Reserved on request of ISO 4217/MA for the European monetary unit Euro Extended for ISO 6166 “Securities – International securities identification numbering system (ISIN)” in March 1998 Extended for any application needing to represent the name European Union in August 1999</p>
</blockquote>
<p>Можно добавить в <code>ExcludeNodes</code> вместе с <code>{??}</code> как не несущие географической информации.</p></td><td>2023-10-13T18:17:48.156Z</td></tr>
    </table>
      </body>
    </html>