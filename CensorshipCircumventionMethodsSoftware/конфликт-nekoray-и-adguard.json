[
    {
        "id": 55335,
        "name": "",
        "username": "rewhat",
        "avatar_template": "/user_avatar/ntc.party/rewhat/{size}/13085_2.png",
        "created_at": "2024-10-15T21:54:08.072Z",
        "cooked": "<p>При одновременном использовании NekoRay (режим TUN, VLESS), и AdGuard начинает страдать процессор. Вот они слева направо:</p>\n<p><img src=\"конфликт-nekoray-и-adguard/a7cee0083846c0cfda8b31da06e4ebe29bceda41.png\" alt=\"123\" data-base62-sha1=\"nWuXRidzoFxMzoFLZpFZb6IyHXr\" width=\"425\" height=\"131\"></p>\n<p>Один из процессов может начать жрать и 20%. Если отключить AdGuard или NekoBox, то потребление снижается до 0-1%.</p>\n<p>Для фикса пробовал такое:</p>\n<p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"конфликт-nekoray-и-adguard/5d48d2bab2609ff50fec6cc0c1b9732e9e48a8a6.png\" data-download-href=\"https://ntc.party/uploads/default/5d48d2bab2609ff50fec6cc0c1b9732e9e48a8a6\" title=\"1234\"><img src=\"конфликт-nekoray-и-adguard/5d48d2bab2609ff50fec6cc0c1b9732e9e48a8a6.png\" alt=\"1234\" data-base62-sha1=\"djeqvUd1hCmAReTyc7bjoY2HzCu\" width=\"476\" height=\"500\" data-dominant-color=\"2C2C2C\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">1234</span><span class=\"informations\">601×631 12.7 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>\n<p>И такое:</p>\n<p><img src=\"конфликт-nekoray-и-adguard/a02b52a92c17b19e4452f74d0bd5cbf65e58a004.png\" alt=\"12345\" data-base62-sha1=\"mQVdhatQzpm7Yn8ViWXFVFtQIv2\" width=\"164\" height=\"77\"></p>\n<p>Не помогает.</p>\n<p>NekoRay еще в логи спамит, и ему вообще пофиг, есть правила для роутинга процесса AdGuard, или нет:</p>\n<details>\n<summary>\nСпойлер</summary>\n<p><code>INFO[0019] [543243331 11ms] router: found process path: C:\\Program Files\\AdGuard\\AdguardSvc.exe INFO[0019] [543243331 11ms] outbound/direct[direct]: outbound packet connection INFO[0019] [4189587400 13ms] router: found process path: C:\\Program Files\\AdGuard\\AdguardSvc.exe INFO[0019] [4189587400 13ms] outbound/direct[direct]: outbound packet connection INFO[0019] [1717965780 12ms] router: found process path: C:\\Program Files\\AdGuard\\AdguardSvc.exe INFO[0019] [1717965780 12ms] outbound/direct[direct]: outbound packet connection INFO[0019] [3806706700 12ms] router: found process path: C:\\Program Files\\AdGuard\\AdguardSvc.exe INFO[0019] [3806706700 12ms] outbound/direct[direct]: outbound packet connection</code></p>\n</details>\n<p>Как можно это исправить? Чтоб одновременно работали, и не жрали столько ресурсов.</p>\n<p>upd: при разворачивании “сетевая служба” в диспетчере, показывает “DNS клиент”. Наверное DNS не могут поделить, или типа того. Отключил DNS-защиту в AdGuard, вроде пока нормальное потребление. Но хотелось бы использовать dns защиту в Адгуарде <img src=\"https://ntc.party/images/emoji/twitter/thinking.png?v=12\" title=\":thinking:\" class=\"emoji\" alt=\":thinking:\" loading=\"lazy\" width=\"20\" height=\"20\">.</p>\n<p>upd2: дело точно в dns, настройках роутинга, и подобном. Попереключал разные настройки, все вроде стало работать. Решил понять, что конкретно нужно было переключить, начал снова перебирать настройки роутинга, и в итоге нагрузка на ЦП вообще идет под 100%, всё виснет, я хз вообще.</p>",
        "post_number": 1,
        "post_type": 1,
        "posts_count": 7,
        "updated_at": "2024-10-15T23:59:36.717Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 379,
        "reads": 84,
        "readers_count": 83,
        "score": 1911.8,
        "yours": false,
        "topic_id": 11903,
        "topic_slug": "%D0%BA%D0%BE%D0%BD%D1%84%D0%BB%D0%B8%D0%BA%D1%82-nekoray-%D0%B8-adguard",
        "display_username": "",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 4,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 3907,
        "hidden": false,
        "trust_level": 3,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": false,
        "wiki": false,
        "post_url": "/t/%D0%BA%D0%BE%D0%BD%D1%84%D0%BB%D0%B8%D0%BA%D1%82-nekoray-%D0%B8-adguard/11903/1",
        "can_translate": false
    },
    {
        "id": 55393,
        "name": "The Ministry of Love",
        "username": "sunlighthell",
        "avatar_template": "/user_avatar/ntc.party/sunlighthell/{size}/11035_2.png",
        "created_at": "2024-10-16T06:01:58.156Z",
        "cooked": "<p>А вы по дефолту получается пускаете весь трафик через TUN и только Адгард не хотите?<br>\nНапример при настройках как у вас (проксируется весь трафик, кроме 2х экзешников и того что в simple route) тот же включенный торрент будет нагружать проц так же<br>\nПробовали наоборот настроить в Preferences&gt;routing settings&gt;default outbound bypass, а в настройках тун включить вайтлист?</p>",
        "post_number": 2,
        "post_type": 1,
        "posts_count": 7,
        "updated_at": "2024-10-16T06:01:58.156Z",
        "reply_count": 1,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 2,
        "reads": 61,
        "readers_count": 60,
        "score": 27.2,
        "yours": false,
        "topic_id": 11903,
        "topic_slug": "%D0%BA%D0%BE%D0%BD%D1%84%D0%BB%D0%B8%D0%BA%D1%82-nekoray-%D0%B8-adguard",
        "display_username": "The Ministry of Love",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 7204,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": false,
        "wiki": false,
        "post_url": "/t/%D0%BA%D0%BE%D0%BD%D1%84%D0%BB%D0%B8%D0%BA%D1%82-nekoray-%D0%B8-adguard/11903/2",
        "can_translate": false
    },
    {
        "id": 55466,
        "name": "",
        "username": "rewhat",
        "avatar_template": "/user_avatar/ntc.party/rewhat/{size}/13085_2.png",
        "created_at": "2024-10-16T10:56:26.243Z",
        "cooked": "<blockquote>\n<p>А вы по дефолту получается пускаете весь трафик через TUN и только Адгард не хотите?</p>\n</blockquote>\n<p>Все через ВПН, кроме российских сайтов и торрентов. Ну еще кроме WSL, VS Code, Docker, Steam, и подобное, но это уже как получится. При этом должен работать AdGuard с их DNS. В такой конфигурации все очень быстро работает в плане скорости интернета (не считая жрущего процессора).</p>\n<p>В общем, сегодня удалил nekoray на всякий, скачал nekoray beta-4, отключил dns routing (хотя разницы между включением/отключением dns routing вроде и нет), выбрал сервер, включил tun. Работает нормально, ресурсы не жрет. Но если в simple route добавить хоть какие-то элементарные правила типа:</p>\n<pre><code class=\"lang-auto\">{\n    \"rules\": [\n        {\n            \"domain_suffix\": [\n                \".ru\",\n                \".su\",\n                \".xn--p1ai\"\n            ],\n            \"outbound\": \"direct\"\n        },\n        {\n            \"geoip\": [\n                \"private\",\n                \"ru\"\n            ],\n            \"outbound\": \"direct\"\n        }\n    ]\n}\n</code></pre>\n<p>то начинается сущий кошмар, процессор грузит, в логи спамит</p>\n<pre><code class=\"lang-auto\">INFO[0008] [3517323876 0ms] inbound/tun[tun-in]: inbound packet connection from 172.19.0.1:60621\nINFO[0008] [3517323876 0ms] inbound/tun[tun-in]: inbound packet connection to 172.19.0.2:53\nINFO[0008] [3517323876 0ms] outbound/direct[direct]: outbound packet connection\nINFO[0008] [4261053470 0ms] inbound/tun[tun-in]: inbound packet connection from 172.19.0.1:60626\nINFO[0008] [4261053470 0ms] inbound/tun[tun-in]: inbound packet connection to 172.19.0.2:53\nINFO[0008] [4261053470 0ms] outbound/direct[direct]: outbound packet connection\nINFO[0008] [1091316985 0ms] inbound/tun[tun-in]: inbound packet connection from 172.19.0.1:60629\nINFO[0008] [1091316985 0ms] inbound/tun[tun-in]: inbound packet connection to 172.19.0.2:53\nINFO[0008] [1091316985 0ms] outbound/direct[direct]: outbound packet connection\nINFO[0008] [3722262886 0ms] inbound/tun[tun-in]: inbound packet connection from 172.19.0.1:60633\nINFO[0008] [3722262886 0ms] inbound/tun[tun-in]: inbound packet connection to 172.19.0.2:53\n</code></pre>\n<p>Видимо правила роутинга вообще не переваривает.</p>\n<p>Ну в логах это видимо локальный айпишник, может Докера, или еще чего. Не знаю что добавить в исключения, а то щас как добавлю, и опять весь пк зависать начнет.</p>",
        "post_number": 3,
        "post_type": 1,
        "posts_count": 7,
        "updated_at": "2024-10-16T11:10:30.738Z",
        "reply_count": 1,
        "reply_to_post_number": 2,
        "quote_count": 0,
        "incoming_link_count": 6,
        "reads": 57,
        "readers_count": 56,
        "score": 46.4,
        "yours": false,
        "topic_id": 11903,
        "topic_slug": "%D0%BA%D0%BE%D0%BD%D1%84%D0%BB%D0%B8%D0%BA%D1%82-nekoray-%D0%B8-adguard",
        "display_username": "",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 3,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "reply_to_user": {
            "username": "sunlighthell",
            "name": "The Ministry of Love",
            "avatar_template": "/user_avatar/ntc.party/sunlighthell/{size}/11035_2.png"
        },
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 3907,
        "hidden": false,
        "trust_level": 3,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": false,
        "wiki": false,
        "post_url": "/t/%D0%BA%D0%BE%D0%BD%D1%84%D0%BB%D0%B8%D0%BA%D1%82-nekoray-%D0%B8-adguard/11903/3",
        "can_translate": false
    },
    {
        "id": 55635,
        "name": "",
        "username": "rewhat",
        "avatar_template": "/user_avatar/ntc.party/rewhat/{size}/13085_2.png",
        "created_at": "2024-10-16T16:43:55.807Z",
        "cooked": "<p>Вместо nekoray можно использовать v2rayN с правилами:</p>\n<p>Domain (direct)</p>\n<pre><code class=\"lang-auto\">regexp:\\.ru$,\nregexp:\\.su$,\nregexp:\\.xn--p1ai$\n</code></pre>\n<p>IP (direct)</p>\n<pre><code class=\"lang-auto\">geoip:ru\n</code></pre>",
        "post_number": 4,
        "post_type": 1,
        "posts_count": 7,
        "updated_at": "2024-10-16T16:43:55.807Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 7,
        "reads": 45,
        "readers_count": 44,
        "score": 44.0,
        "yours": false,
        "topic_id": 11903,
        "topic_slug": "%D0%BA%D0%BE%D0%BD%D1%84%D0%BB%D0%B8%D0%BA%D1%82-nekoray-%D0%B8-adguard",
        "display_username": "",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 3907,
        "hidden": false,
        "trust_level": 3,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": false,
        "wiki": false,
        "post_url": "/t/%D0%BA%D0%BE%D0%BD%D1%84%D0%BB%D0%B8%D0%BA%D1%82-nekoray-%D0%B8-adguard/11903/4",
        "can_translate": false
    },
    {
        "id": 59252,
        "name": "",
        "username": "Pony",
        "avatar_template": "/letter_avatar_proxy/v4/letter/p/4da419/{size}.png",
        "created_at": "2024-10-25T15:01:42.482Z",
        "cooked": "<aside class=\"quote no-group\" data-username=\"rewhat\" data-post=\"3\" data-topic=\"11903\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://ntc.party/user_avatar/ntc.party/rewhat/48/13085_2.png\" class=\"avatar\"> rewhat:</div>\n<blockquote>\n<p>Видимо правила роутинга вообще не переваривает.</p>\n</blockquote>\n</aside>\n<p>Роутинг тут всё переваривает, это IP вашего TUN, INFO в заголовке явно говорит, что это не ошибка <img src=\"https://ntc.party/images/emoji/twitter/wink.png?v=12\" title=\":wink:\" class=\"emoji\" alt=\":wink:\" loading=\"lazy\" width=\"20\" height=\"20\"></p>\n<p>Нагрузка процесса, вероятна вызвана зацикливанием DNS Запросов, отключите в AdGuard “DNS Защита”</p>",
        "post_number": 5,
        "post_type": 1,
        "posts_count": 7,
        "updated_at": "2024-10-25T15:01:42.482Z",
        "reply_count": 1,
        "reply_to_post_number": 3,
        "quote_count": 1,
        "incoming_link_count": 11,
        "reads": 41,
        "readers_count": 40,
        "score": 68.2,
        "yours": false,
        "topic_id": 11903,
        "topic_slug": "%D0%BA%D0%BE%D0%BD%D1%84%D0%BB%D0%B8%D0%BA%D1%82-nekoray-%D0%B8-adguard",
        "display_username": "",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 7553,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": false,
        "wiki": false,
        "post_url": "/t/%D0%BA%D0%BE%D0%BD%D1%84%D0%BB%D0%B8%D0%BA%D1%82-nekoray-%D0%B8-adguard/11903/5",
        "can_translate": false
    },
    {
        "id": 59258,
        "name": "",
        "username": "rewhat",
        "avatar_template": "/user_avatar/ntc.party/rewhat/{size}/13085_2.png",
        "created_at": "2024-10-25T15:08:20.900Z",
        "cooked": "<p>Спасибо. Ну я уже просто sing-box использую, как-то настроил, и работает.</p>",
        "post_number": 6,
        "post_type": 1,
        "posts_count": 7,
        "updated_at": "2024-10-25T15:08:20.900Z",
        "reply_count": 1,
        "reply_to_post_number": 5,
        "quote_count": 0,
        "incoming_link_count": 5,
        "reads": 43,
        "readers_count": 42,
        "score": 38.6,
        "yours": false,
        "topic_id": 11903,
        "topic_slug": "%D0%BA%D0%BE%D0%BD%D1%84%D0%BB%D0%B8%D0%BA%D1%82-nekoray-%D0%B8-adguard",
        "display_username": "",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "reply_to_user": {
            "username": "Pony",
            "name": "",
            "avatar_template": "/letter_avatar_proxy/v4/letter/p/4da419/{size}.png"
        },
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 3907,
        "hidden": false,
        "trust_level": 3,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": false,
        "wiki": false,
        "post_url": "/t/%D0%BA%D0%BE%D0%BD%D1%84%D0%BB%D0%B8%D0%BA%D1%82-nekoray-%D0%B8-adguard/11903/6",
        "can_translate": false
    },
    {
        "id": 68130,
        "name": "",
        "username": "sboc",
        "avatar_template": "/letter_avatar_proxy/v4/letter/s/f4b2a3/{size}.png",
        "created_at": "2024-11-20T07:03:57.857Z",
        "cooked": "<p>можете попробовать использовать <a href=\"https://github.com/Mahdi-zarei/nekoray/releases\" rel=\"noopener nofollow ugc\">форк</a> nekoray, работает наиболее стабильнее</p>",
        "post_number": 7,
        "post_type": 1,
        "posts_count": 7,
        "updated_at": "2024-11-20T07:03:57.857Z",
        "reply_count": 0,
        "reply_to_post_number": 6,
        "quote_count": 0,
        "incoming_link_count": 4,
        "reads": 33,
        "readers_count": 32,
        "score": 26.6,
        "yours": false,
        "topic_id": 11903,
        "topic_slug": "%D0%BA%D0%BE%D0%BD%D1%84%D0%BB%D0%B8%D0%BA%D1%82-nekoray-%D0%B8-adguard",
        "display_username": "",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
            {
                "url": "https://github.com/Mahdi-zarei/nekoray/releases",
                "internal": false,
                "reflection": false,
                "title": "Releases · Mahdi-zarei/nekoray · GitHub",
                "clicks": 45
            }
        ],
        "read": true,
        "user_title": "",
        "reply_to_user": {
            "username": "rewhat",
            "name": "",
            "avatar_template": "/user_avatar/ntc.party/rewhat/{size}/13085_2.png"
        },
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 8377,
        "hidden": false,
        "trust_level": 1,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": false,
        "wiki": false,
        "post_url": "/t/%D0%BA%D0%BE%D0%BD%D1%84%D0%BB%D0%B8%D0%BA%D1%82-nekoray-%D0%B8-adguard/11903/7",
        "can_translate": false
    }
]