[
    {
        "id": 65331,
        "name": "",
        "username": "metabidlo",
        "avatar_template": "/letter_avatar_proxy/v4/letter/m/a183cd/{size}.png",
        "created_at": "2024-11-12T05:10:46.283Z",
        "cooked": "<p>Стоит два тонких клиента.</p>\n<ol>\n<li>opnsense (192.168.51.1)</li>\n<li>proxmox</li>\n</ol>\n<p>в контейнере proxmox развернул alpine + sing-box(192.168.51.41)<br>\nдобавил правила NAT в opnsense<br>\n<div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"настройка-opnsense-sing-boxв-контейнере/fb6937f31e76dea6c30fc6ec0ce971dd343d273a.jpeg\" data-download-href=\"https://ntc.party/uploads/default/fb6937f31e76dea6c30fc6ec0ce971dd343d273a\" title=\"sgfdsgsdgs\"><img src=\"настройка-opnsense-sing-boxв-контейнере/fb6937f31e76dea6c30fc6ec0ce971dd343d273a_2_690x175.jpeg\" alt=\"sgfdsgsdgs\" data-base62-sha1=\"zS5h2j3GNGudpzXuYlEPIfSLFt8\" width=\"690\" height=\"175\" srcset=\"настройка-opnsense-sing-boxв-контейнере/fb6937f31e76dea6c30fc6ec0ce971dd343d273a_2_690x175.jpeg, настройка-opnsense-sing-boxв-контейнере/fb6937f31e76dea6c30fc6ec0ce971dd343d273a_2_1035x262.jpeg 1.5x, настройка-opnsense-sing-boxв-контейнере/fb6937f31e76dea6c30fc6ec0ce971dd343d273a_2_1380x350.jpeg 2x\" data-dominant-color=\"F7F7F6\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">sgfdsgsdgs</span><span class=\"informations\">1408×358 81.9 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>\n<p>подкинул конфиг в sing-box</p>\n<pre><code class=\"lang-auto\">{\n    \"log\": {\n        \"level\": \"info\",\n        \"timestamp\": true\n    },\n    \"dns\": {\n        \"servers\": [\n            {\n                \"tag\": \"local-dns\",\n                \"address\": \"local\",\n                \"detour\": \"direct-out\"\n            },\n            {\n                \"tag\": \"cloudflare-dns\",\n                \"address\": \"https://1.1.1.1/dns-query\",\n                \"address_resolver\": \"local-dns\",\n                \"detour\": \"vless-out\"\n            }\n        ],\n        \"rules\": [\n            {\n                \"domain\": \"your.server.example.com\",\n                \"server\": \"local-dns\"\n            }\n        ]\n    },\n    \"inbounds\": [\n        {\n            \"type\": \"direct\",\n            \"tag\": \"direct-in\",\n            \"listen\": \"192.168.51.41\",\n            \"listen_port\": 8080\n        }\n    ],\n    \"outbounds\": [\n        {\n            \"type\": \"direct\",\n            \"tag\": \"direct-out\"\n        },\n        {\n            \"type\": \"vless\",\n            \"tag\": \"vless-out\",\n            \"server\": \"111.111.234.82\",\n            \"server_port\": 443,\n            \"uuid\": \"uuid\",\n            \"flow\": \"xtls-rprx-vision\",\n            \"tls\": {\n                \"enabled\": true,\n                \"server_name\": \"yahoo.com\",\n                \"utls\": {\n                    \"enabled\": true\n                },\n                \"reality\": {\n                    \"enabled\": true,\n                    \"public_key\": \"public_key\",\n                    \"short_id\": \"short_id\"\n                }\n            }\n        },\n        {\n            \"type\": \"dns\",\n            \"tag\": \"dns-out\"\n        }\n    ],\n    \"route\": {\n        \"rules\": [\n            {\n                \"outbound\": \"vless-out\"\n            }\n        ]\n    }\n}\n\n\n</code></pre>\n<p>идея в том что я хочу заблоченный трафик http/https отправлять в контейнер с sing-box, что бы он дальше уже проксировал его через vless и тд<br>\nитог, правила вроде правильно перенаправляют запросы, а вот sing-box бесконечно спамит запросами(я так понимаю это петля)<br>\nя не особо в этом шарю, но может кто то подскажет в чем косяк? заранее всем спасибо</p>",
        "post_number": 1,
        "post_type": 1,
        "posts_count": 4,
        "updated_at": "2024-11-12T05:11:58.553Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 410,
        "reads": 66,
        "readers_count": 65,
        "score": 2053.2,
        "yours": false,
        "topic_id": 13018,
        "topic_slug": "%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-opnsense-sing-box%D0%B2-%D0%BA%D0%BE%D0%BD%D1%82%D0%B5%D0%B9%D0%BD%D0%B5%D1%80%D0%B5",
        "display_username": "",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 8229,
        "hidden": false,
        "trust_level": 1,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": false,
        "wiki": false,
        "post_url": "/t/%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-opnsense-sing-box%D0%B2-%D0%BA%D0%BE%D0%BD%D1%82%D0%B5%D0%B9%D0%BD%D0%B5%D1%80%D0%B5/13018/1",
        "can_translate": false
    },
    {
        "id": 65408,
        "name": "",
        "username": "MasterYoba",
        "avatar_template": "/user_avatar/ntc.party/masteryoba/{size}/6182_2.png",
        "created_at": "2024-11-12T08:34:22.356Z",
        "cooked": "<p>Боюсь без полной информации об интерфейсах и маршрутах обоих устройств сложно что-то сказать.</p>\n<p>И еще, я не уверен, что механизм добавления доменов ютуба в правило ната работает так как вы хотите. Домены надо фильтровать на синг боксе а не на фаерволе</p>",
        "post_number": 2,
        "post_type": 1,
        "posts_count": 4,
        "updated_at": "2024-11-12T08:34:22.356Z",
        "reply_count": 1,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 1,
        "reads": 49,
        "readers_count": 48,
        "score": 19.8,
        "yours": false,
        "topic_id": 13018,
        "topic_slug": "%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-opnsense-sing-box%D0%B2-%D0%BA%D0%BE%D0%BD%D1%82%D0%B5%D0%B9%D0%BD%D0%B5%D1%80%D0%B5",
        "display_username": "",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 4361,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": false,
        "wiki": false,
        "post_url": "/t/%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-opnsense-sing-box%D0%B2-%D0%BA%D0%BE%D0%BD%D1%82%D0%B5%D0%B9%D0%BD%D0%B5%D1%80%D0%B5/13018/2",
        "can_translate": false
    },
    {
        "id": 65601,
        "name": "",
        "username": "metabidlo",
        "avatar_template": "/letter_avatar_proxy/v4/letter/m/a183cd/{size}.png",
        "created_at": "2024-11-12T14:45:42.526Z",
        "cooked": "<aside class=\"quote no-group\" data-username=\"MasterYoba\" data-post=\"2\" data-topic=\"13018\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://ntc.party/user_avatar/ntc.party/masteryoba/48/6182_2.png\" class=\"avatar\"> MasterYoba:</div>\n<blockquote>\n<p>тах обоих устройс</p>\n</blockquote>\n</aside>\n<p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"настройка-opnsense-sing-boxв-контейнере/549521d11617c7f0934212f58decee608c77717d.jpeg\" data-download-href=\"https://ntc.party/uploads/default/549521d11617c7f0934212f58decee608c77717d\" title=\"Без имени\"><img src=\"настройка-opnsense-sing-boxв-контейнере/549521d11617c7f0934212f58decee608c77717d_2_690x257.jpeg\" alt=\"Без имени\" data-base62-sha1=\"c4fCxhrp2UAhCj0dGUh0budtQUR\" width=\"690\" height=\"257\" srcset=\"настройка-opnsense-sing-boxв-контейнере/549521d11617c7f0934212f58decee608c77717d_2_690x257.jpeg, настройка-opnsense-sing-boxв-контейнере/549521d11617c7f0934212f58decee608c77717d_2_1035x385.jpeg 1.5x, настройка-opnsense-sing-boxв-контейнере/549521d11617c7f0934212f58decee608c77717d_2_1380x514.jpeg 2x\" data-dominant-color=\"FAFAFA\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">Без имени</span><span class=\"informations\">1530×572 76 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div><br>\nпробовал добавлять домены в NAT с перенаправлением в пустоту и вроде работало, пока правило включено ютуб не открывается, как таколько отключаю правило трафик идет, но потом уходит в петлю.<br>\nтрафик до sing-box доходит, тк бесконечные запросы вижу в логах sing-box</p>",
        "post_number": 3,
        "post_type": 1,
        "posts_count": 4,
        "updated_at": "2024-11-12T14:46:57.805Z",
        "reply_count": 1,
        "reply_to_post_number": 2,
        "quote_count": 1,
        "incoming_link_count": 6,
        "reads": 42,
        "readers_count": 41,
        "score": 43.4,
        "yours": false,
        "topic_id": 13018,
        "topic_slug": "%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-opnsense-sing-box%D0%B2-%D0%BA%D0%BE%D0%BD%D1%82%D0%B5%D0%B9%D0%BD%D0%B5%D1%80%D0%B5",
        "display_username": "",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 8229,
        "hidden": false,
        "trust_level": 1,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": false,
        "wiki": false,
        "post_url": "/t/%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-opnsense-sing-box%D0%B2-%D0%BA%D0%BE%D0%BD%D1%82%D0%B5%D0%B9%D0%BD%D0%B5%D1%80%D0%B5/13018/3",
        "can_translate": false
    },
    {
        "id": 65713,
        "name": "",
        "username": "MasterYoba",
        "avatar_template": "/user_avatar/ntc.party/masteryoba/{size}/6182_2.png",
        "created_at": "2024-11-12T18:15:05.366Z",
        "cooked": "<p>Мне кажется вам вместо инбаунда direct надо использовать tproxy с тем же самым listen_port<br>\nВ случае с direct он не может знать, какой там был исходный порт (443)</p>\n<aside class=\"onebox allowlistedgeneric\" data-onebox-src=\"https://sing-box.sagernet.org/configuration/inbound/tproxy/\">\n  <header class=\"source\">\n      <img src=\"https://ntc.party/uploads/default/original/2X/1/19db269fb603eecca718a1d5ac9653f35daf0151.svg\" class=\"site-icon\" data-dominant-color=\"\" width=\"463\" height=\"500\">\n\n      <a href=\"https://sing-box.sagernet.org/configuration/inbound/tproxy/\" target=\"_blank\" rel=\"noopener nofollow ugc\">sing-box.sagernet.org</a>\n  </header>\n\n  <article class=\"onebox-body\">\n    \n\n<h3><a href=\"https://sing-box.sagernet.org/configuration/inbound/tproxy/\" target=\"_blank\" rel=\"noopener nofollow ugc\">TProxy - sing-box</a></h3>\n\n  <p>The universal proxy platform.</p>\n\n\n  </article>\n\n  <div class=\"onebox-metadata\">\n    \n    \n  </div>\n\n  <div style=\"clear: both\"></div>\n</aside>\n\n<p>Это что касается текущей схемы. А так я бы советовал отказаться от натирования вообще, это какой-то странный подход. Вместо правила nat в opnsense настраивается PBR правило фаервола, где dst можно так же указать ваши youtubeDomains, а шлюзом будет синг бокс (потребуется отдельно создать новый шлюз). А на сингбоксе сделать инбаунд tun.</p>",
        "post_number": 4,
        "post_type": 1,
        "posts_count": 4,
        "updated_at": "2024-11-12T18:27:59.421Z",
        "reply_count": 0,
        "reply_to_post_number": 3,
        "quote_count": 0,
        "incoming_link_count": 7,
        "reads": 36,
        "readers_count": 35,
        "score": 42.2,
        "yours": false,
        "topic_id": 13018,
        "topic_slug": "%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-opnsense-sing-box%D0%B2-%D0%BA%D0%BE%D0%BD%D1%82%D0%B5%D0%B9%D0%BD%D0%B5%D1%80%D0%B5",
        "display_username": "",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 2,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
            {
                "url": "https://sing-box.sagernet.org/configuration/inbound/tproxy/",
                "internal": false,
                "reflection": false,
                "title": "TProxy - sing-box",
                "clicks": 18
            }
        ],
        "read": true,
        "user_title": null,
        "reply_to_user": {
            "username": "metabidlo",
            "name": "",
            "avatar_template": "/letter_avatar_proxy/v4/letter/m/a183cd/{size}.png"
        },
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 4361,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": false,
        "wiki": false,
        "post_url": "/t/%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-opnsense-sing-box%D0%B2-%D0%BA%D0%BE%D0%BD%D1%82%D0%B5%D0%B9%D0%BD%D0%B5%D1%80%D0%B5/13018/4",
        "can_translate": false
    }
]