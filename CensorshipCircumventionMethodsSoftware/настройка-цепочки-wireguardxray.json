[
    {
        "id": 16344,
        "name": "",
        "username": "vurk",
        "avatar_template": "/letter_avatar_proxy/v4/letter/v/a88e57/{size}.png",
        "created_at": "2023-08-12T00:10:25.412Z",
        "cooked": "<p>Всех приветствую.</p>\n<p>Пытаюсь настроить соединение по такой схеме - <a href=\"http://0x0.st/H_6K.jpg\" rel=\"noopener nofollow ugc\">http://0x0.st/H_6K.jpg</a><br>\n<div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"настройка-цепочки-wireguardxray/52fdab100d3df53a2c1e449ed1b8938a1f1bc8cb.jpeg\" data-download-href=\"https://ntc.party/uploads/default/52fdab100d3df53a2c1e449ed1b8938a1f1bc8cb\" title=\"network\"><img src=\"настройка-цепочки-wireguardxray/52fdab100d3df53a2c1e449ed1b8938a1f1bc8cb_2_353x500.jpeg\" alt=\"network\" data-base62-sha1=\"bQaDjVW3oTEIJxp6ENGyoLrpQkr\" width=\"353\" height=\"500\" srcset=\"настройка-цепочки-wireguardxray/52fdab100d3df53a2c1e449ed1b8938a1f1bc8cb_2_353x500.jpeg, настройка-цепочки-wireguardxray/52fdab100d3df53a2c1e449ed1b8938a1f1bc8cb_2_529x750.jpeg 1.5x, настройка-цепочки-wireguardxray/52fdab100d3df53a2c1e449ed1b8938a1f1bc8cb_2_706x1000.jpeg 2x\" data-dominant-color=\"FCFCFD\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">network</span><span class=\"informations\">827×1169 51.2 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>\n<p>Смысл такой организации: 1) российская ВПСка хостит “сервер” ваергарда, чтобы обеспечить доступ клиентом (пиров) между собой, в т.ч. подключенных к ней роутеров для доступа к устройствам за роутерами. 2) Настройка маршрутизации основного трафика для всех клиентов сразу делается в одном месте и удобно - на российской ВПСке. 3) Все, что должно идти не на <em>.ru/</em>.рф, идет на зарубежную (NL) ВПСку.</p>\n<p>Дано: поднято две ВПС (ру и нл). На ру организован шлюз с ваергард, к нему подключены все нужные клиенты. Для клиентов данный шлюз - основной (0.0.0.0/0 и ::/0). На зарубежной ВПС поднят xray-server, настроенный на работу reality (конфигурация рабочая, пробовал подключаться напрямую с клиентов с помощью nekoray/foxray).<br>\nНужно: правильно организовать редирект основного трафика на зарубежную ВПС через xray через терминал (потому что ГУИ на ВПС не будет).</p>\n<p>Что я сделал: скачал xray-core, использовал такой конфиг - <a href=\"http://0x0.st/H_6P.json\" rel=\"noopener nofollow ugc\">http://0x0.st/H_6P.json</a>, поднял клиент на российской ВПСке с этим конфигом. xray не ругался на ошибки. Через ss вижу</p>\n<pre><code class=\"lang-auto\">ss -tunlp | grep xray\ntcp   LISTEN 0      4096       127.0.0.1:10808      0.0.0.0:*    users:((\"xray\",pid=2522,fd=3))\ntcp   LISTEN 0      4096       127.0.0.1:10809      0.0.0.0:*    users:((\"xray\",pid=2522,fd=7))\n</code></pre>\n<p>Вроде работает. Дальше мне надо как-то перевести весь трафик, который идет от “клиентов” (то есть пиров) ваергард “сервера” (пира-шлюза-российской ВПС) на зарубежную ВПС. Тут две проблемы: 1) как это сделать (пробовал iptables через цепочку прероутинга редиректить весь tcp/udp трафик с ваергард порта на порт 10808/9 - не вышло), 2) как при глобальном редиректе всего трафика фильтровать, куда пускать трафик к <em>.ru/</em>.рф, а куда остальной?</p>\n<p>Прошу знатоков подсказать, куда копать.</p>\n<p>ПыСы. В nekoray, например, есть некий tun mode, который создает интерфейс и делает его основным. Как это сделать через xray-core с его конфигом я не понял. Судя по всему, это как раз то, что мне нужно.</p>",
        "post_number": 1,
        "post_type": 1,
        "posts_count": 17,
        "updated_at": "2024-08-09T16:25:05.492Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 5975,
        "reads": 217,
        "readers_count": 216,
        "score": 29893.4,
        "yours": false,
        "topic_id": 5284,
        "topic_slug": "%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-%D1%86%D0%B5%D0%BF%D0%BE%D1%87%D0%BA%D0%B8-wireguardxray",
        "display_username": "",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 2,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
            {
                "url": "http://0x0.st/H_6P.json",
                "internal": false,
                "reflection": false,
                "clicks": 128
            },
            {
                "url": "http://0x0.st/H_6K.jpg",
                "internal": false,
                "reflection": false,
                "title": "H_6K.jpg",
                "clicks": 61
            }
        ],
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 2465,
        "hidden": false,
        "trust_level": 0,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": false,
        "wiki": false,
        "post_url": "/t/%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-%D1%86%D0%B5%D0%BF%D0%BE%D1%87%D0%BA%D0%B8-wireguardxray/5284/1",
        "can_translate": false
    },
    {
        "id": 16348,
        "name": "",
        "username": "Sofi",
        "avatar_template": "/letter_avatar_proxy/v4/letter/s/5f8ce5/{size}.png",
        "created_at": "2023-08-12T02:38:49.464Z",
        "cooked": "<p>Во первых, не PREROUTING нужна, а FORWARD на первом сервере во второй.<br>\nВо вторых, нужен ipset со списком AS тех адресов, который пойдет в Нидерланды.</p>",
        "post_number": 2,
        "post_type": 1,
        "posts_count": 17,
        "updated_at": "2023-08-12T02:38:49.464Z",
        "reply_count": 1,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 3,
        "reads": 178,
        "readers_count": 177,
        "score": 55.6,
        "yours": false,
        "topic_id": 5284,
        "topic_slug": "%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-%D1%86%D0%B5%D0%BF%D0%BE%D1%87%D0%BA%D0%B8-wireguardxray",
        "display_username": "",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": "",
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 2398,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": false,
        "wiki": false,
        "post_url": "/t/%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-%D1%86%D0%B5%D0%BF%D0%BE%D1%87%D0%BA%D0%B8-wireguardxray/5284/2",
        "can_translate": false
    },
    {
        "id": 16355,
        "name": "",
        "username": "vurk",
        "avatar_template": "/letter_avatar_proxy/v4/letter/v/a88e57/{size}.png",
        "created_at": "2023-08-12T06:58:09.954Z",
        "cooked": "<p><a class=\"mention\" href=\"/u/sofi\">@Sofi</a>,</p>\n<p>Поясни подробнее, пожалуйста. Не понял, при чем тут форвардинг, если речь идет об перенаправлении трафика с порта wireguard (например, 51820) на порт local proxy xray (10808/10809). ЕЯПП это больше похоже на transparent proxy, для которой должно работать что-то вроде</p>\n<pre><code class=\"lang-auto\">iptables -t nat -A PREROUTING -p udp --dport 51820 -j REDIRECT --to-port 10808\n</code></pre>\n<p>Но это, очевидно, не работает.</p>\n<p>По поводу AS серверов, разве эту задачу не выполняет сам xray? В доках описано, что можно избирательно пускать трафик в обход прокси, если есть совпадения по домену/regexp и т.д. У меня вопрос здесь в том, достаточно ли будет просто завернуть весь входящий трафик российской ВПС, который идет на порт 51820, в прокси, чтобы xray все сам разруливал, или нужны будут доп. действия (какие)?</p>\n<p>UPD. Пока разбирался с проблемой перевода трафика на другой порт, оказалось что хотя xray запущен на российской ВПС и не ругается на ошибки, по traceroute весь трафик все равно идет напрямую, а не через прокси на зарубежной ВПС. Видимо, еще в конфиге клиента ошибка.</p>",
        "post_number": 3,
        "post_type": 1,
        "posts_count": 17,
        "updated_at": "2023-08-12T07:18:31.314Z",
        "reply_count": 1,
        "reply_to_post_number": 2,
        "quote_count": 0,
        "incoming_link_count": 14,
        "reads": 176,
        "readers_count": 175,
        "score": 110.2,
        "yours": false,
        "topic_id": 5284,
        "topic_slug": "%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-%D1%86%D0%B5%D0%BF%D0%BE%D1%87%D0%BA%D0%B8-wireguardxray",
        "display_username": "",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 3,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "reply_to_user": {
            "username": "Sofi",
            "name": "",
            "avatar_template": "/letter_avatar_proxy/v4/letter/s/5f8ce5/{size}.png"
        },
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 2465,
        "hidden": false,
        "trust_level": 0,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": false,
        "wiki": false,
        "post_url": "/t/%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-%D1%86%D0%B5%D0%BF%D0%BE%D1%87%D0%BA%D0%B8-wireguardxray/5284/3",
        "can_translate": false
    },
    {
        "id": 16357,
        "name": "",
        "username": "Sofi",
        "avatar_template": "/letter_avatar_proxy/v4/letter/s/5f8ce5/{size}.png",
        "created_at": "2023-08-12T09:18:58.583Z",
        "cooked": "<p>Насколько я поняла из вашего вопроса, вам нужно форвардить с РФ до Нидерландов тот трафик, который не должен проходить через сервера РФ, разве нет?<br>\nТо есть при подключении к серверу РФ, трафик, который не попадает под некие правила, должен идти в Нидерланды.<br>\nПоправьте, если не права.<br>\nНасчёт прозрачного прокси - это не так, в вашем случае, правило другое:<br>\niptables -t nat -A OUTPUT -p $tcp/udp --dport $port -j REDIRECT --to-ports $port<br>\nЧтобы работало в PREROUTING как прозрачный прокси, правило должно быть другим:<br>\niptables -t mangle -A PREROUTING -j TPROXY --tproxy-mark $mark</p>\n<p>Конкретнее задачу опишите, пожалуйста.</p>",
        "post_number": 4,
        "post_type": 1,
        "posts_count": 17,
        "updated_at": "2023-08-12T09:18:58.583Z",
        "reply_count": 1,
        "reply_to_post_number": 3,
        "quote_count": 0,
        "incoming_link_count": 6,
        "reads": 154,
        "readers_count": 153,
        "score": 65.8,
        "yours": false,
        "topic_id": 5284,
        "topic_slug": "%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-%D1%86%D0%B5%D0%BF%D0%BE%D1%87%D0%BA%D0%B8-wireguardxray",
        "display_username": "",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": "",
        "reply_to_user": {
            "username": "vurk",
            "name": "",
            "avatar_template": "/letter_avatar_proxy/v4/letter/v/a88e57/{size}.png"
        },
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 2398,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": false,
        "wiki": false,
        "post_url": "/t/%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-%D1%86%D0%B5%D0%BF%D0%BE%D1%87%D0%BA%D0%B8-wireguardxray/5284/4",
        "can_translate": false
    },
    {
        "id": 16358,
        "name": "",
        "username": "vurk",
        "avatar_template": "/letter_avatar_proxy/v4/letter/v/a88e57/{size}.png",
        "created_at": "2023-08-12T10:49:32.203Z",
        "cooked": "<p>Я плохо объяснил. Исправляюсь.</p>\n<p>Есть российская ВПС. У нее две задачи: 1) с помощью wireguard объединить в одну сеть множество устройств, чтобы можно было общаться между устройствами, 2) быть шлюзом для выхода в интернет с помощью <strong>xray</strong> (это важно, что это не просто шлюз, а именно шлюз через xray).</p>\n<p>Шлюз через xray работает следующим образом. На российской ВПС стоит клиент (xray-core) с конфигом, который я публиковал в первом посте (который, судя по всему не работает). На зарубежной ВПС развернут xray-server с xtls-reality в качестве основного способа работы.</p>\n<p>Сейчас у меня два вопроса: 1) как весь трафик от пиров wireguard, для который российская ВПС - шлюз для выхода в интерент, завернуть в xray (в локальный прокси, который открывается на порту 10808 или 10809, 2) как без GUI, то есть средствами только xray-core из терминала по ssh подключить российскую ВПС к зарубежной ВПС так, чтобы трафик, который идет от пиров wireguard и от самой российской ВПС шел по правилам, заданным в конфиге xray-core клиента, т.е. все, что идет на домены *.рф и *.ru  - идет в обход прокси (НЕ через зарубежную ВПС), а весь остальной трафик только через зарубежную ВПС (то есть через xray xtls-reality сервер).</p>\n<p>Сама маршрутизация по доменам осуществляется xray. Для меня не понятно, как это происходит через режим прокси.</p>",
        "post_number": 5,
        "post_type": 1,
        "posts_count": 17,
        "updated_at": "2023-08-12T10:49:32.203Z",
        "reply_count": 3,
        "reply_to_post_number": 4,
        "quote_count": 0,
        "incoming_link_count": 20,
        "reads": 148,
        "readers_count": 147,
        "score": 144.6,
        "yours": false,
        "topic_id": 5284,
        "topic_slug": "%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-%D1%86%D0%B5%D0%BF%D0%BE%D1%87%D0%BA%D0%B8-wireguardxray",
        "display_username": "",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "reply_to_user": {
            "username": "Sofi",
            "name": "",
            "avatar_template": "/letter_avatar_proxy/v4/letter/s/5f8ce5/{size}.png"
        },
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 2465,
        "hidden": false,
        "trust_level": 0,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": false,
        "wiki": false,
        "post_url": "/t/%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-%D1%86%D0%B5%D0%BF%D0%BE%D1%87%D0%BA%D0%B8-wireguardxray/5284/5",
        "can_translate": false
    },
    {
        "id": 16360,
        "name": "",
        "username": "bolvan",
        "avatar_template": "/letter_avatar_proxy/v4/letter/b/8e8cbc/{size}.png",
        "created_at": "2023-08-12T11:48:32.061Z",
        "cooked": "<aside class=\"quote no-group\" data-username=\"vurk\" data-post=\"5\" data-topic=\"5284\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://ntc.party/letter_avatar_proxy/v4/letter/v/a88e57/48.png\" class=\"avatar\"> vurk:</div>\n<blockquote>\n<ol>\n<li>как весь трафик от пиров wireguard, для который российская ВПС - шлюз для выхода в интерент, завернуть в xray (в локальный прокси, который открывается на порту 10808 или 10809</li>\n</ol>\n</blockquote>\n</aside>\n<p><a href=\"https://github.com/bol-van/zapret/blob/master/docs/redsocks.txt\">redsocks</a><br>\nЗаворот ip трафика на прокси работает лишь для tcp.<br>\nЯ бы очень хорошо подумал, прежде чем связываться с прокси. Не лучше ли пробросить нормально через тоннель ip ?<br>\nВариантов множество. Хоть тот же wireguard+ipobfs с уродованием IP фреймов, благо у ВПСок внешний ип есть.   Нестандартный IP протокол и транспортный хедер, не похожий ни на что.<br>\nЭто невозможно через NAT, требует рута, сложно, так что у цензоров руки еще не скоро доберутся (надеюсь)</p>\n<p>Что касается доменов, то как вы собираетесь их распознавать и по ним принимать решение ? Это возможно для http, теоретически можно выдернуть SNI из ClientHello, то есть сделать для https, но что со всем остальным делать ?<br>\nК тому же домен никак не связан с местоположением сервера. Может все же geoip ?</p>",
        "post_number": 6,
        "post_type": 1,
        "posts_count": 17,
        "updated_at": "2023-08-13T06:50:23.566Z",
        "reply_count": 0,
        "reply_to_post_number": 5,
        "quote_count": 1,
        "incoming_link_count": 21,
        "reads": 141,
        "readers_count": 140,
        "score": 133.2,
        "yours": false,
        "topic_id": 5284,
        "topic_slug": "%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-%D1%86%D0%B5%D0%BF%D0%BE%D1%87%D0%BA%D0%B8-wireguardxray",
        "display_username": "",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 4,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
            {
                "url": "https://github.com/bol-van/zapret/blob/master/docs/redsocks.txt",
                "internal": false,
                "reflection": false,
                "clicks": 20
            }
        ],
        "read": true,
        "user_title": "Zapret anti-DPI software staff",
        "title_is_group": false,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": true,
        "admin": false,
        "staff": true,
        "user_id": 19,
        "hidden": false,
        "trust_level": 3,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": false,
        "wiki": false,
        "post_url": "/t/%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-%D1%86%D0%B5%D0%BF%D0%BE%D1%87%D0%BA%D0%B8-wireguardxray/5284/6",
        "can_translate": false
    },
    {
        "id": 16361,
        "name": "",
        "username": "Sofi",
        "avatar_template": "/letter_avatar_proxy/v4/letter/s/5f8ce5/{size}.png",
        "created_at": "2023-08-12T13:53:27.105Z",
        "cooked": "<p>Поднимается redsocks или подобный прокси.<br>\nВ конфиге указывается порт и адреса с которого и на который будет идти редирект, затем правилом выше перекидываете трафик пиров на этот порт:<br>\niptables -t nat -A PREROUTING -p udp --dport $wg_port -j REDIRECT --to-ports $proxy_port</p>\n<p>По второму вопросу:<br>\nБез понятия что из себя вообще представляет x-ray.<br>\nВ случае соединения двух vps, достаточно прокинуть туннель через тот же wg, а для пиров исключить вторую vps из правил маршрутизации для РФ.<br>\nP. S. Пропишите адрес шлюза на первой vps как адрес порта редиректа для прокси на который перенаправляете пиров.</p>",
        "post_number": 7,
        "post_type": 1,
        "posts_count": 17,
        "updated_at": "2023-08-12T13:53:57.401Z",
        "reply_count": 0,
        "reply_to_post_number": 5,
        "quote_count": 0,
        "incoming_link_count": 37,
        "reads": 138,
        "readers_count": 137,
        "score": 212.6,
        "yours": false,
        "topic_id": 5284,
        "topic_slug": "%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-%D1%86%D0%B5%D0%BF%D0%BE%D1%87%D0%BA%D0%B8-wireguardxray",
        "display_username": "",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": "",
        "reply_to_user": {
            "username": "vurk",
            "name": "",
            "avatar_template": "/letter_avatar_proxy/v4/letter/v/a88e57/{size}.png"
        },
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 2398,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": false,
        "wiki": false,
        "post_url": "/t/%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-%D1%86%D0%B5%D0%BF%D0%BE%D1%87%D0%BA%D0%B8-wireguardxray/5284/7",
        "can_translate": false
    },
    {
        "id": 16399,
        "name": "0ka",
        "username": "0ka",
        "avatar_template": "/letter_avatar_proxy/v4/letter/0/d78d45/{size}.png",
        "created_at": "2023-08-13T15:34:57.636Z",
        "cooked": "<p>пользуйся sing-box вместо xray, он поддерживает tun, в который весь wg трафик пойдёт без проблем, конфиг дам если надо. Протокол лучше используй ss, а не vless/vless/trojan т.к. он поддерживает udp, а не делает конвертацию в TCP (это медленно). Если к этому еще приделать rule по доменам, то сервак понадобится не слабый т.к. маршрутизировать будет sing-box (медленно)</p>",
        "post_number": 8,
        "post_type": 1,
        "posts_count": 17,
        "updated_at": "2023-08-13T15:42:28.381Z",
        "reply_count": 2,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 40,
        "reads": 127,
        "readers_count": 126,
        "score": 235.4,
        "yours": false,
        "topic_id": 5284,
        "topic_slug": "%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-%D1%86%D0%B5%D0%BF%D0%BE%D1%87%D0%BA%D0%B8-wireguardxray",
        "display_username": "0ka",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 2,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 488,
        "hidden": false,
        "trust_level": 3,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": false,
        "wiki": false,
        "post_url": "/t/%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-%D1%86%D0%B5%D0%BF%D0%BE%D1%87%D0%BA%D0%B8-wireguardxray/5284/8",
        "can_translate": false
    },
    {
        "id": 16404,
        "name": null,
        "username": "ValdikSS",
        "avatar_template": "/user_avatar/ntc.party/valdikss/{size}/2_2.png",
        "created_at": "2023-08-14T07:58:38.859Z",
        "cooked": "<aside class=\"quote no-group\" data-username=\"vurk\" data-post=\"5\" data-topic=\"5284\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://ntc.party/letter_avatar_proxy/v4/letter/v/a88e57/48.png\" class=\"avatar\"> vurk:</div>\n<blockquote>\n<ol>\n<li>как весь трафик от пиров wireguard, для который российская ВПС - шлюз для выхода в интерент, завернуть в xray</li>\n</ol>\n</blockquote>\n</aside>\n<p>Нужно использовать <a href=\"https://www.v2fly.org/config/protocols/dokodemo.html\">inbound dokodemo-door</a> с соответствующими iptables/nftables-правилами.</p>\n<aside class=\"quote no-group\" data-username=\"vurk\" data-post=\"5\" data-topic=\"5284\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://ntc.party/letter_avatar_proxy/v4/letter/v/a88e57/48.png\" class=\"avatar\"> vurk:</div>\n<blockquote>\n<ol start=\"2\">\n<li>как без GUI, то есть средствами только xray-core из терминала по ssh подключить российскую ВПС к зарубежной ВПС</li>\n</ol>\n</blockquote>\n</aside>\n<p>Настройка не отличается от просто настройки v2fly/xray в качестве прокси-сервера/клиента. Только учтите, что это всё ещё прокси: вы сможете туннелировать только TCP/UDP-трафик, не сможете принимать входящие подключения, могут быть проблемы с VoIP/WebRTC.</p>\n<p>В вашем конфигурационном файле нет правил на маршрутизации (routing → rules) через удалённый сервер.</p>\n<aside class=\"quote no-group\" data-username=\"vurk\" data-post=\"5\" data-topic=\"5284\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://ntc.party/letter_avatar_proxy/v4/letter/v/a88e57/48.png\" class=\"avatar\"> vurk:</div>\n<blockquote>\n<p>Сама маршрутизация по доменам осуществляется xray. Для меня не понятно, как это происходит через режим прокси.</p>\n</blockquote>\n</aside>\n<p><code>geosite</code> — специальный список IP-диапазонов или доменов. Вряд ли в вашей базе существует список <code>ru</code>. Если вы хотите маршрутизировать все диапазоны IP-адресов, закреплённые за Россией, нужно использовать routing → rules → <code>\"ip\": [\"geoip:ru\"]</code>, если домены: <code>\"domains\": [\"domain:ru\"]</code> (все домены, заканчивающиеся на <code>.ru</code>).<br>\nЧтобы маршрутизация по доменам работала, в inbound нужно включить <a href=\"https://www.v2fly.org/config/inbounds.html#sniffingobject\">sniffing</a>.<br>\nОбратите внимание, что директива (по крайней мере, в v2fly) называется domain<strong>s</strong>, а не domain. Возможно, у вас ошибка.</p>",
        "post_number": 9,
        "post_type": 1,
        "posts_count": 17,
        "updated_at": "2023-08-14T07:58:38.859Z",
        "reply_count": 0,
        "reply_to_post_number": 5,
        "quote_count": 1,
        "incoming_link_count": 58,
        "reads": 127,
        "readers_count": 126,
        "score": 315.4,
        "yours": false,
        "topic_id": 5284,
        "topic_slug": "%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-%D1%86%D0%B5%D0%BF%D0%BE%D1%87%D0%BA%D0%B8-wireguardxray",
        "display_username": null,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
            {
                "url": "https://www.v2fly.org/config/protocols/dokodemo.html",
                "internal": false,
                "reflection": false,
                "title": "Dokodemo-door | V2Fly.org",
                "clicks": 118
            },
            {
                "url": "https://www.v2fly.org/config/inbounds.html#sniffingobject",
                "internal": false,
                "reflection": false,
                "title": "Inbounds | V2Fly.org",
                "clicks": 25
            }
        ],
        "read": true,
        "user_title": "AntiZapret staff",
        "title_is_group": false,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": true,
        "admin": true,
        "staff": true,
        "user_id": 1,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": false,
        "wiki": false,
        "post_url": "/t/%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-%D1%86%D0%B5%D0%BF%D0%BE%D1%87%D0%BA%D0%B8-wireguardxray/5284/9",
        "can_translate": false
    },
    {
        "id": 16521,
        "name": "Вячеслав",
        "username": "aphexman",
        "avatar_template": "/letter_avatar_proxy/v4/letter/a/48db29/{size}.png",
        "created_at": "2023-08-16T10:52:49.250Z",
        "cooked": "<p>Привет! Я вижу ты крутой спец, помоги пожалуйста с настройкой wireguard разобраться, заранее спасибо!</p>",
        "post_number": 10,
        "post_type": 1,
        "posts_count": 17,
        "updated_at": "2023-08-16T10:52:49.250Z",
        "reply_count": 1,
        "reply_to_post_number": 8,
        "quote_count": 0,
        "incoming_link_count": 4,
        "reads": 108,
        "readers_count": 107,
        "score": 46.6,
        "yours": false,
        "topic_id": 5284,
        "topic_slug": "%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-%D1%86%D0%B5%D0%BF%D0%BE%D1%87%D0%BA%D0%B8-wireguardxray",
        "display_username": "Вячеслав",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "reply_to_user": {
            "username": "0ka",
            "name": "0ka",
            "avatar_template": "/letter_avatar_proxy/v4/letter/0/d78d45/{size}.png"
        },
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 2492,
        "hidden": false,
        "trust_level": 0,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": false,
        "wiki": false,
        "post_url": "/t/%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-%D1%86%D0%B5%D0%BF%D0%BE%D1%87%D0%BA%D0%B8-wireguardxray/5284/10",
        "can_translate": false
    },
    {
        "id": 16552,
        "name": "0ka",
        "username": "0ka",
        "avatar_template": "/letter_avatar_proxy/v4/letter/0/d78d45/{size}.png",
        "created_at": "2023-08-16T18:36:18.853Z",
        "cooked": "<p>в плане? что нужно?</p>",
        "post_number": 11,
        "post_type": 1,
        "posts_count": 17,
        "updated_at": "2023-08-16T18:36:18.853Z",
        "reply_count": 0,
        "reply_to_post_number": 10,
        "quote_count": 0,
        "incoming_link_count": 32,
        "reads": 104,
        "readers_count": 103,
        "score": 180.8,
        "yours": false,
        "topic_id": 5284,
        "topic_slug": "%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-%D1%86%D0%B5%D0%BF%D0%BE%D1%87%D0%BA%D0%B8-wireguardxray",
        "display_username": "0ka",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "reply_to_user": {
            "username": "aphexman",
            "name": "Вячеслав",
            "avatar_template": "/letter_avatar_proxy/v4/letter/a/48db29/{size}.png"
        },
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 488,
        "hidden": false,
        "trust_level": 3,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": false,
        "wiki": false,
        "post_url": "/t/%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-%D1%86%D0%B5%D0%BF%D0%BE%D1%87%D0%BA%D0%B8-wireguardxray/5284/11",
        "can_translate": false
    },
    {
        "id": 19438,
        "name": null,
        "username": "Gamber",
        "avatar_template": "/letter_avatar_proxy/v4/letter/g/e95f7d/{size}.png",
        "created_at": "2023-10-31T06:34:52.181Z",
        "cooked": "<p><a href=\"https://ntc.party/t/%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-%D1%86%D0%B5%D0%BF%D0%BE%D1%87%D0%BA%D0%B8-wireguardxray/5284/8\">0ka</a> буду признателен, если поделитесь примером конфига.<br>\nЗадача один в один, как описывает топикстартер.<br>\nСразу пошел по варианту tun интерфейса.<br>\nПодключение до заморской локации установлено успешно, по статическим маршрутам доступ к отдельным ресурсам есть.<br>\nНо как грамотно прокинуть клиентов WG RU до Xray NL сервера, через tun интерфейс, понять не могу.<br>\nЧерез дефолтный шлюз, WG клиенты в Интернет выходят без проблем.<br>\nSing-box</p>\n<pre><code class=\"lang-auto\">{\n    \"log\": {\n        \"level\": \"debug\"\n    },\n    \"inbounds\": [\n        {\n            \"type\": \"tun\",\n            \"interface_name\": \"tun0\",\n            \"domain_strategy\": \"ipv4_only\",\n            \"inet4_address\": \"172.16.0.1/30\",\n            \"stack\": \"gvisor\",\n            \"endpoint_independent_nat\": true,\n            \"auto_route\": false,\n            \"strict_route\": false,\n            \"sniff\": true\n        }\n    ],\n    \"outbounds\": [\n        {\n            \"type\": \"vless\",\n            \"server\": \"***\",\n            \"server_port\": 443,\n            \"uuid\": \"***\",\n            \"flow\": \"xtls-rprx-vision\",\n            \"network\": \"tcp\",\n            \"tls\": {\n                \"enabled\": true,\n                \"disable_sni\": false,\n                \"server_name\": \"www.nvidia.com\",\n                \"insecure\": false,\n                \"utls\": {\n                    \"enabled\": true,\n                    \"fingerprint\": \"\"\n                },\n                \"reality\": {\n                    \"enabled\": true,\n                    \"public_key\": \"***\",\n                    \"short_id\": \"***\"\n                }\n            }\n        }\n    ],\n    \"route\": {\n              \"auto_detect_interface\": true\n            }\n}\n</code></pre>\n<p>iptabels (выход через дефолтный шлюз)</p>\n<pre><code class=\"lang-auto\">*filter\n-I FORWARD -i wg+ -j ACCEPT\nCOMMIT\n*nat\n-A POSTROUTING -o eth0 -j MASQUERADE\nCOMMIT\n</code></pre>\n<p>ip</p>\n<pre><code class=\"lang-auto\">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000\n    link/ether 00:16:5b:c1:b4:fd brd ff:ff:ff:ff:ff:ff\n    altname enp0s3\n    altname ens3\n    inet 1.2.3.4/32 brd 1.2.3.253 scope global eth0\n       valid_lft forever preferred_lft forever\n    inet6 fe80::216:5bff:fec1:b4fd/64 scope link\n       valid_lft forever preferred_lft forever\n4: wg0: &lt;POINTOPOINT,NOARP,UP,LOWER_UP&gt; mtu 1420 qdisc noqueue state UNKNOWN group default qlen 1000\n    link/none\n    inet 172.17.0.1/24 scope global wg0\n       valid_lft forever preferred_lft forever\n49: tun0: &lt;POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP&gt; mtu 9000 qdisc fq_codel state UNKNOWN group default qlen 500\n    link/none\n    inet 172.16.0.1/30 brd 172.16.0.3 scope global tun0\n       valid_lft forever preferred_lft forever\n    inet6 fe80::d3cd:ff75:7334:8ddb/64 scope link stable-privacy\n       valid_lft forever preferred_lft forever\n</code></pre>\n<p>route (прописан маршрут до <a href=\"http://2ip.ru\" rel=\"noopener nofollow ugc\">2ip.ru</a>, все работает, вижу IP NL сервера)</p>\n<pre><code class=\"lang-auto\">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface\ndefault         5.6.7.8      0.0.0.0         UG    0      0        0 eth0\n5.6.7.8      0.0.0.0         255.255.255.255 UH    0      0        0 eth0\n172.16.0.0      0.0.0.0         255.255.255.252 U     0      0        0 tun0\n172.17.0.0      0.0.0.0         255.255.255.0   U     0      0        0 wg0\nstatic.35.201.2 172.16.0.1      255.255.255.255 UGH   0      0        0 tun0\n</code></pre>",
        "post_number": 12,
        "post_type": 1,
        "posts_count": 17,
        "updated_at": "2023-10-31T06:35:30.331Z",
        "reply_count": 2,
        "reply_to_post_number": 8,
        "quote_count": 0,
        "incoming_link_count": 76,
        "reads": 99,
        "readers_count": 98,
        "score": 409.8,
        "yours": false,
        "topic_id": 5284,
        "topic_slug": "%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-%D1%86%D0%B5%D0%BF%D0%BE%D1%87%D0%BA%D0%B8-wireguardxray",
        "display_username": null,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
            {
                "url": "http://2ip.ru",
                "internal": false,
                "reflection": false,
                "title": "Узнать IP адрес",
                "clicks": 2
            }
        ],
        "read": true,
        "user_title": null,
        "reply_to_user": {
            "username": "0ka",
            "name": "0ka",
            "avatar_template": "/letter_avatar_proxy/v4/letter/0/d78d45/{size}.png"
        },
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 2787,
        "hidden": false,
        "trust_level": 1,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": false,
        "wiki": false,
        "post_url": "/t/%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-%D1%86%D0%B5%D0%BF%D0%BE%D1%87%D0%BA%D0%B8-wireguardxray/5284/12",
        "can_translate": false
    },
    {
        "id": 19446,
        "name": null,
        "username": "Dhohbr",
        "avatar_template": "/letter_avatar_proxy/v4/letter/d/8797f3/{size}.png",
        "created_at": "2023-10-31T07:32:33.666Z",
        "cooked": "<p><a class=\"mention\" href=\"/u/gamber\">@Gamber</a> если я равильно понял вас, то должно работать так:<br>\nДобавьте правило<br>\n-A POSTROUTING -s 172.17.0.0/24 -o tun0 -j MASQUERADE</p>\n<p>Тогда клиенты должны видеть на сайте 2ip адрес NL сервера.<br>\nА это -I FORWARD -i wg+ -j ACCEPT можно убрать, если у вас глобально ACCEPT стоит.</p>",
        "post_number": 13,
        "post_type": 1,
        "posts_count": 17,
        "updated_at": "2023-10-31T07:32:33.666Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 23,
        "reads": 84,
        "readers_count": 83,
        "score": 131.8,
        "yours": false,
        "topic_id": 5284,
        "topic_slug": "%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-%D1%86%D0%B5%D0%BF%D0%BE%D1%87%D0%BA%D0%B8-wireguardxray",
        "display_username": null,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 209,
        "hidden": false,
        "trust_level": 3,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": false,
        "wiki": false,
        "post_url": "/t/%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-%D1%86%D0%B5%D0%BF%D0%BE%D1%87%D0%BA%D0%B8-wireguardxray/5284/13",
        "can_translate": false
    },
    {
        "id": 19448,
        "name": "0ka",
        "username": "0ka",
        "avatar_template": "/letter_avatar_proxy/v4/letter/0/d78d45/{size}.png",
        "created_at": "2023-10-31T09:23:58.062Z",
        "cooked": "<p>попробуйте так</p>\n<pre><code class=\"lang-auto\">echo \"5 sing-rt\" &gt;&gt; /etc/iproute2/rt_tables #создаем новую таблицу маршрутов\n\nip route add default dev tun0 table sing-rt #добавляем шлюз sing-box в новую таблицу\n\nip rule add from 172.17.0.0/24 table sing-rt #добавляем правило: для source addr 172.17.0.0/24 (wg subnet) использовать новую таблицу маршрутов\n\niptables -t nat -A POSTROUTING -o tun0 -j MASQUERADE #\n</code></pre>\n<p>и проверка на сервере через</p>\n<pre><code class=\"lang-auto\">curl -v --interface wg0 2ip.ru\n</code></pre>\n<p>это всё без гарантий т.к. проверить не могу, если последняя команда фейлит то проверяйте на клиенте</p>",
        "post_number": 14,
        "post_type": 1,
        "posts_count": 17,
        "updated_at": "2023-11-01T00:39:58.047Z",
        "reply_count": 1,
        "reply_to_post_number": 12,
        "quote_count": 0,
        "incoming_link_count": 55,
        "reads": 85,
        "readers_count": 84,
        "score": 292.0,
        "yours": false,
        "topic_id": 5284,
        "topic_slug": "%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-%D1%86%D0%B5%D0%BF%D0%BE%D1%87%D0%BA%D0%B8-wireguardxray",
        "display_username": "0ka",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 3,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
            {
                "url": "https://ntc.party/t/sing-box-%D0%BA%D0%BE%D0%BD%D1%84%D0%BB%D0%B8%D0%BA%D1%82%D1%83%D0%B5%D1%82-%D1%81-docker/6449/14",
                "internal": true,
                "reflection": true,
                "title": "Sing-box конфликтует с docker",
                "clicks": 10
            }
        ],
        "read": true,
        "user_title": null,
        "reply_to_user": {
            "username": "Gamber",
            "name": null,
            "avatar_template": "/letter_avatar_proxy/v4/letter/g/e95f7d/{size}.png"
        },
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 488,
        "hidden": false,
        "trust_level": 3,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": false,
        "wiki": false,
        "post_url": "/t/%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-%D1%86%D0%B5%D0%BF%D0%BE%D1%87%D0%BA%D0%B8-wireguardxray/5284/14",
        "can_translate": false
    },
    {
        "id": 19453,
        "name": "Ainur Khammatov",
        "username": "nzkhammatov",
        "avatar_template": "/user_avatar/ntc.party/nzkhammatov/{size}/4650_2.png",
        "created_at": "2023-10-31T09:52:48.750Z",
        "cooked": "<p><code>https://serverfault.com/a/1073566</code></p>",
        "post_number": 15,
        "post_type": 1,
        "posts_count": 17,
        "updated_at": "2023-10-31T09:52:48.750Z",
        "reply_count": 0,
        "reply_to_post_number": 12,
        "quote_count": 0,
        "incoming_link_count": 11,
        "reads": 78,
        "readers_count": 77,
        "score": 70.6,
        "yours": false,
        "topic_id": 5284,
        "topic_slug": "%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-%D1%86%D0%B5%D0%BF%D0%BE%D1%87%D0%BA%D0%B8-wireguardxray",
        "display_username": "Ainur Khammatov",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": "",
        "reply_to_user": {
            "username": "Gamber",
            "name": null,
            "avatar_template": "/letter_avatar_proxy/v4/letter/g/e95f7d/{size}.png"
        },
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 172,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": false,
        "wiki": false,
        "post_url": "/t/%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-%D1%86%D0%B5%D0%BF%D0%BE%D1%87%D0%BA%D0%B8-wireguardxray/5284/15",
        "can_translate": false
    },
    {
        "id": 19480,
        "name": null,
        "username": "Gamber",
        "avatar_template": "/letter_avatar_proxy/v4/letter/g/e95f7d/{size}.png",
        "created_at": "2023-10-31T13:17:13.175Z",
        "cooked": "<p><a href=\"https://ntc.party/u/0ka\">0ka</a> <a href=\"https://ntc.party/u/khammatov\">khammatov</a> Благодарю, все получилось.<br>\n<a href=\"https://ntc.party/u/0ka\">0ka</a> Во второй строчке небольшая опечатка, нужно tun0.<br>\nА так все ok, взлетело.<br>\n<a href=\"https://ntc.party/u/Dhohbr\">Dhohbr</a> именно так и пробовал первоначально.<br>\nКак оказалась, вся изюминка именно в отдельной таблице маршрутов )</p>",
        "post_number": 16,
        "post_type": 1,
        "posts_count": 17,
        "updated_at": "2023-10-31T13:17:13.175Z",
        "reply_count": 0,
        "reply_to_post_number": 14,
        "quote_count": 0,
        "incoming_link_count": 24,
        "reads": 88,
        "readers_count": 87,
        "score": 137.6,
        "yours": false,
        "topic_id": 5284,
        "topic_slug": "%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-%D1%86%D0%B5%D0%BF%D0%BE%D1%87%D0%BA%D0%B8-wireguardxray",
        "display_username": null,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "reply_to_user": {
            "username": "0ka",
            "name": "0ka",
            "avatar_template": "/letter_avatar_proxy/v4/letter/0/d78d45/{size}.png"
        },
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 2787,
        "hidden": false,
        "trust_level": 1,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": false,
        "wiki": false,
        "post_url": "/t/%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-%D1%86%D0%B5%D0%BF%D0%BE%D1%87%D0%BA%D0%B8-wireguardxray/5284/16",
        "can_translate": false
    },
    {
        "id": 26265,
        "name": null,
        "username": "Gamber",
        "avatar_template": "/letter_avatar_proxy/v4/letter/g/e95f7d/{size}.png",
        "created_at": "2024-06-06T17:11:11.951Z",
        "cooked": "<p>Наверное, не буду поднимать новую тему, так как это, по сути, продолжение истории.</p>\n<p>После успешного тестирования вышеописанной связки на стороннем RU VPS, решил поднять его непосредственно у себя.</p>\n<p>Дано:</p>\n<p>Две локации в RU. На обеих Микротики в качестве маршрутизаторов.</p>\n<p>Локация 1. За NAT провайдера.</p>\n<p>Локация 2. Публичная статика.</p>\n<p>Между локациями поднят WG туннель, прописаны маршруты в LAN обеих локаций.</p>\n<p>В LAN Локации 2 поднят сервер на Debian, на котором развернут Sing-Box клиент, смотрящий в зарубежный NL сервер.</p>\n<p>По конфигу клиента все в целом так же, только в Inbound включен auto_route.</p>\n<p>В iptables, NAT на LAN интерфейсе сервера.</p>\n<p>Клиент успешно поднимается, curl <a href=\"http://2ip.ru\" rel=\"noopener nofollow ugc\">2ip.ru</a> отдает зарубежный IP. Дополнительных таблиц маршрутизации не создаю.</p>\n<p>На роутере в Локации 1 поднят GRE туннель в Локацию 2 на Debain сервер. GRE добавлен в NAT, по BGP получаю список заблокированных подсетей в роуты, в качестве шлюза задаю IP GRE интерфейса на стороне Debian. Тут вопросов нет, все работает как нужно.</p>\n<p>Проблемы начинаются в Локации 2. Первое, что я попытался сделать, повторить схему, реализованную в первой локации. Создал на Debian еще один GRE интерфейс, поднял туннель с роутером, добавил туннель на роутере в NAT, прописал маршруты до GRE Debian сервера. Вот с NAT и начинаются проблемы, первые пару минут все работает (хосты в LAN успешно ходят куда нужно через NL), но потом я вижу, как NAT правило для GRE начинает генерировать огромное количество трафика, процесс клиента Sing-Box уходит в 100% загрузку и падает. Есть стойкое подозрение, что получилась у меня петля или нечто подобное.</p>\n<p>Попробовал выйти из ситуации так. Убрал GRE и NAT, в маршруты BGP прописал IP LAN интерфейса Debian сервера. Работает, но есть ощущение, что криво. При подключении с рабочего ПК к заблокированному ресурсу, есть явная и ощутимая задержка около 5-7 секунд. Если заменить в настройках сетевого адаптера шлюз с LAN IP роутера на LAN IP Debian сервера, все начинает работать адекватно.</p>\n<p>Дайте пожалуйста совет, как наиболее грамотно выйти из этой ситуации?</p>",
        "post_number": 17,
        "post_type": 1,
        "posts_count": 17,
        "updated_at": "2024-06-06T17:20:37.647Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 23,
        "reads": 69,
        "readers_count": 68,
        "score": 128.8,
        "yours": false,
        "topic_id": 5284,
        "topic_slug": "%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-%D1%86%D0%B5%D0%BF%D0%BE%D1%87%D0%BA%D0%B8-wireguardxray",
        "display_username": null,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 2,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
            {
                "url": "http://2ip.ru",
                "internal": false,
                "reflection": false,
                "title": "Узнать IP адрес",
                "clicks": 1
            }
        ],
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 2787,
        "hidden": false,
        "trust_level": 1,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": false,
        "wiki": false,
        "post_url": "/t/%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-%D1%86%D0%B5%D0%BF%D0%BE%D1%87%D0%BA%D0%B8-wireguardxray/5284/17",
        "can_translate": false
    }
]