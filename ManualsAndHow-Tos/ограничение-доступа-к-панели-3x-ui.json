[
    {
        "id": 75562,
        "name": "",
        "username": "allula",
        "avatar_template": "/letter_avatar_proxy/v4/letter/a/ebca7d/{size}.png",
        "created_at": "2024-12-25T21:07:49.248Z",
        "cooked": "<p>Решил написать небольшую инструкцию по ограничению доступа к панели 3X-UI. Мне запрещено создавать темы в категории <a href=\"https://ntc.party/c/manuals/42\">Manuals and How-Tos</a>, поэтому выложу сюда. Если модераторы посчитают нужным, то перенесут тему куда надо.</p>\n<p>Понимаю, что досконально описать каждый шаг трудно, поэтому не ставлю перед собой подобной цели. Третий пункт описан чуть подробнее, потому что только он вызвал у меня проблемы.</p>\n<p>Глобально вижу три варианта.</p>\n<details>\n<summary>\n1. Доступ с любого устройства (используется по умолчанию).</summary>\n<p>Панель торчит в сеть, поэтому доступна с любого устройства. Если панель устанавливается через Docker, то имеет следующие настройки:</p>\n<ul>\n<li>логин: <mark><code>admin</code></mark>;</li>\n<li>пароль: <mark><code>admin</code></mark>;</li>\n<li>порт: <mark><code>2053</code></mark>.</li>\n</ul>\n<p>Если панель устанавливается не через Docker, то эти параметры генерируются случайно. Вариант с Docker особо опасен, поэтому обязательно нужно (некоторые из пунктов касаются и случая без Docker):</p>\n<ul>\n<li>поменять <mark>логин</mark> и <mark>пароль</mark>;</li>\n<li>подключить <mark>сертификат</mark> (хватит и самозаверенного);</li>\n<li>поменять <mark>порт</mark> (далее <mark><code>port</code></mark>);</li>\n<li>придумать или сгенерировать случайный <mark>путь</mark> в адресе панели (далее <mark><code>path</code></mark>).</li>\n</ul>\n<p>Если всё сделано правильно, то зайти в панель можно так, где вместо <mark><code>vps_ip</code></mark> нужно подставить адрес вашего сервера:<br>\n<code>https://</code><mark><code>vps_ip</code></mark><code>:</code><mark><code>port</code></mark><code>/</code><mark><code>path</code></mark><code>/panel</code>.</p>\n<p>Чтобы безопасно настроить панель в первый раз, можно:</p>\n<ul>\n<li>воспользоваться следующим пунктом (в этом случае не нужно ограничивать адрес, на котором слушает панель);</li>\n<li>использовать команду <code>x-ui</code> (не работает, если установка была в Docker);</li>\n<li>найти файл <code>x-ui.db</code> и отредактировать руками:<br>\n<code># sqlite3 /etc/x-ui/x-ui.db</code>.<br>\nВозможное расположение файла:\n<ul>\n<li><code>/etc/x-ui/x-ui.db</code> по умолчанию;</li>\n<li><code>/db/x-ui.db</code>, если установка была через Docker и использовалась команда <code>sudo</code> без дополнительных параметров;</li>\n<li><code>.../3x-ui/db/x-ui.db</code>, если установка была через Docker без <code>sudo</code> (вместо троеточия нужно подставить путь до места, куда вы клонировали репозиторий).</li>\n</ul>\n</li>\n</ul>\n</details>\n<details>\n<summary>\n2. Доступ через ssh.</summary>\n<p>Панель слушает только на адресе <mark><code>127.0.0.1</code></mark>, поэтому подключаться нужно через проброс порта по ssh. В этом случае шаги, необходимые в предыдущем пункте, можно не выполнять. Сперва вам нужно выбрать локальный порт (далее <mark><code>local_port</code></mark>), к которому вы будете обращаться.</p>\n<p>Чтобы пробросить порт до панели, нужно использовать соответствующий флаг:<br>\n<code>$ ssh -L </code><mark><code>local_port</code></mark><code>:localhost:</code><mark><code>port</code></mark><code> ...</code>;<br>\nлибо, если используете файл <code>~/.ssh/config</code>, добавить в раздел <code>Host</code>:<br>\n<code>LocalForward </code><mark><code>local_port</code></mark><code> localhost:</code><mark><code>port</code></mark>.</p>\n<p>В этом случае зайти в панель можно так:<br>\n<code>localhost:</code><mark><code>local_port</code></mark><code>/panel</code>;<br>\nлибо, если вы подключили сертификат и поменяли путь в адресе, так:<br>\n<code>https://localhost:</code><mark><code>local_port</code></mark><code>/</code><mark><code>path</code></mark><code>/panel</code>.</p>\n</details>\n<details>\n<summary>\n3. Доступ через ssh или прокси.</summary>\n<p>Панель слушает частный адрес, поэтому подключаться нужно либо через проброс порта по ssh, либо с включённым прокси. Компромиссный вариант, но советую всё равно поменять настройки по умолчанию, особенно если делаете не только для себя. Этот пункт требует особой настройки.</p>\n<ul>\n<li>Выберите частный адрес (далее <mark><code>private_ip</code></mark>), который вы хотите использовать (список есть тут: <a href=\"https://ru.wikipedia.org/wiki/%D0%A7%D0%B0%D1%81%D1%82%D0%BD%D1%8B%D0%B9_IP-%D0%B0%D0%B4%D1%80%D0%B5%D1%81\" rel=\"noopener nofollow ugc\">Частный IP-адрес</a>).</li>\n<li>Убедитесь, что он ещё не используется в системе (например, Docker создаёт мост с частным адресом):<br>\n<code>$ ip -color=auto a</code>.</li>\n<li>Добавьте выбранный адрес на интерфейс <code>lo</code> через менеджер сети, который используете, либо вручную (будет работать до перезагрузки):<br>\n<code># ip addr add </code><mark><code>private_ip</code></mark><code>/32 dev lo scope host</code>.</li>\n<li>Уберите блокировку с <code>Private IPs</code> в настройках панели. Возможно, потребуется ещё добавить <mark><code>private_ip</code></mark> в маршрутизацию на стороне клиента.</li>\n<li>Настройте панель слушать только <mark><code>private_ip</code></mark>.</li>\n</ul>\n<p>Теперь зайти в панель можно так, если включён прокси:<br>\n<code>https://</code><mark><code>private_ip</code></mark><code>:</code><mark><code>port</code></mark><code>/</code><mark><code>path</code></mark><code>/panel</code>.</p>\n<p>Чтобы зайти в панель не через прокси, а через ssh, нужно пробросить порт:<br>\n<code>$ ssh -L </code><mark><code>local_port</code></mark><code>:</code><mark><code>private_ip</code></mark><code>:</code><mark><code>port</code></mark><code> ...</code>.<br>\nПосле этого можно зайти по адресу:<br>\n<code>https://localhost:</code><mark><code>local_port</code></mark><code>/</code><mark><code>path</code></mark><code>/panel</code>.</p>\n</details>",
        "post_number": 1,
        "post_type": 1,
        "posts_count": 1,
        "updated_at": "2024-12-27T19:03:15.579Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 91,
        "reads": 121,
        "readers_count": 120,
        "score": 479.2,
        "yours": false,
        "topic_id": 14138,
        "topic_slug": "%D0%BE%D0%B3%D1%80%D0%B0%D0%BD%D0%B8%D1%87%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B4%D0%BE%D1%81%D1%82%D1%83%D0%BF%D0%B0-%D0%BA-%D0%BF%D0%B0%D0%BD%D0%B5%D0%BB%D0%B8-3x-ui",
        "display_username": "",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 2,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
            {
                "url": "https://ru.wikipedia.org/wiki/%D0%A7%D0%B0%D1%81%D1%82%D0%BD%D1%8B%D0%B9_IP-%D0%B0%D0%B4%D1%80%D0%B5%D1%81",
                "internal": false,
                "reflection": false,
                "title": "Частный IP-адрес — Википедия",
                "clicks": 7
            },
            {
                "url": "https://ntc.party/c/manuals/42",
                "internal": true,
                "reflection": false,
                "clicks": 6
            }
        ],
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 8568,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": false,
        "wiki": false,
        "post_url": "/t/%D0%BE%D0%B3%D1%80%D0%B0%D0%BD%D0%B8%D1%87%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B4%D0%BE%D1%81%D1%82%D1%83%D0%BF%D0%B0-%D0%BA-%D0%BF%D0%B0%D0%BD%D0%B5%D0%BB%D0%B8-3x-ui/14138/1",
        "can_translate": false
    }
]