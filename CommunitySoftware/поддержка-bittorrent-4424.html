
    <html>
      <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <style>
    th, td {
      border: 1px solid black;
      border-collapse: collapse;
    }
    th, td {
      word-wrap: break-word;
      padding: 5px;
    }
    table {
      width: 100%;
      max-width: 100%;
      border: 1px solid black;
      border-collapse: collapse;
      table-layout: fixed;
      word-wrap: break-word
    }
    code {
      word-wrap: break-word;
    }
    pre {
        white-space: pre-wrap;
    }
    </style>
        <title>поддержка-bittorrent-4424</title>
      </head>
      <body>
        <table border="1" width="100%" cellpadding="5">
          <tr>
            <th style="width: 10%;">Ник</th>
            <th>Пост</th>
            <th style="width: 10%;">Дата</th>
          </tr>
    <tr><td>VasilyGrigoriev378(Василий Григорьев)</td><td><p>Добрый вечер,bolvan! Можете пожалуйста в Zapret добавить  на запас фичу пригодится  обход блокировки протокола DHT и протокола BitTorrent чтоб как на Ubuntu линукс так и на роутере на MIPS процессоре с поддержкой OpenWRT было .Потому как по непроверенной информации  от знакомого так как не чекал вновь пользователи «Ростелекома» в Уральском регионе начали жаловаться на невозможность скачивания файлов через torrent-протокол. Техподдержка якобы отвечает, что торренты это пиратство, поэтому они теперь блокируются и что блокировка торрентов была снята спустя пару дней, но лишь частично. Протокол DHT остаётся заблокированным, то есть пользователи не могут качать торренты, используя magnet-ссылки. И просьба автоскачивание с api Роскомсвободы блок  листа с забаннеными сайтами на TCПУ и просто blacklist реализовать в Zapret пригодится фича.</p></td><td>2023-04-29T19:28:49.201Z</td></tr><tr><td>anon94384997</td><td><aside class="quote no-group" data-username="VasilyGrigoriev378" data-post="1" data-topic="4424">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/v/ce73a5/48.png" class="avatar"> VasilyGrigoriev378:</div>
<blockquote>
<p>торренты это пиратство</p>
</blockquote>
</aside>
<p>Вы скажите им, что через торренты Linux раздают. И почти в каждом линуксе при установке есть bittorrent клиент.</p></td><td>2023-04-29T22:08:55.679Z</td></tr><tr><td>bolvan</td><td><p>DHT работает по udp, и единственный потенциальный метод обхода - это nfqws fake.<br>
Сейчас это уже можно пробовать через custom script или полностью вручную.<br>
Проносить “обход DHT” в основной инсталятор и основные скрипты мне не кажется разумным, потому что это скорее вводит людей в заблуждение, давая ощущение волшебной таблетки.<br>
На самом же деле не факт, что метод будет работать надежно. Например, на QUIC, этим методом удается пробить начальный handshake, но потом сеанс застревает.<br>
К тому же если на http(s) есть возможность проверить работоспособность той или иной стратегии через curl, то как проверять на dht ? Тем более в условиях потенциального застревания сеанса дальше.</p>
<p>Я понимаю, вам хочется чтобы “все просто и удобно”. Но я не преследую целей создать простое решение для всех. zapret - это инструментарий для реализации методов обхода DPI, а не однокнопочное решение.</p>
<p>Сейчас мне было бы интересно, чтобы те, у кого блокируется DHT, попробовали вручную метод nfqws fake и сообщили результаты и своего провайдера/город. Как можно больше, чтобы иметь представление что там происходит. Тогда сделаю готовый custom script</p></td><td>2023-04-30T06:55:40.805Z</td></tr><tr><td>bolvan</td><td><aside class="quote no-group" data-username="VasilyGrigoriev378" data-post="1" data-topic="4424">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/v/ce73a5/48.png" class="avatar"> VasilyGrigoriev378:</div>
<blockquote>
<p>И просьба автоскачивание с api Роскомсвободы блок листа с забаннеными сайтами на TCПУ и просто blacklist реализовать в Zapret пригодится фича.</p>
</blockquote>
</aside>
<p>Забаненных на ТСПУ сайтов там порядка 40 шт.<br>
Какой смысл скачивать лист, который сработает только на них и не сработает на всех остальных ?<br>
Проще добавить в zapret-hosts-user.txt<br>
По поводу blacklist не совсем понял. zapret-hosts-user.txt содержит юзерский список доменов, которые надо обходить. zapret-hosts-user-exclude.txt - которые не надо обходить<br>
Кроме того, и nfqws, и tpws, могут применять неограниченное количество списков как черных, так и белых, если использовать их в ручном режиме без скриптов zapret</p>
<p>И еще такой момент. Стратегия для обхода ТСПУ может отличаться от стратегии обхода реестра РКН. Нужно 2 теста блокчека и потом обьединять стратегии (надо соображать, автомата нет).<br>
Так что это тоже такой вопросик не однокнопочный. Даже если я совмещу 2 списка РКН и ТСПУ, то ТСПУ может не срабатывать, если юзер пошел по пути копи-пасты стратегий <a href="http://rutracker.org">rutracker.org</a> из blockcheck</p>
<p>Ниже процедура преобразования json листов с рублаклист для openwrt и linux/freebsd</p>
<pre><code class="lang-auto">curl -L --fail https://reestr.rublacklist.net/api/v3/dpi | jsonfilter  -e '@[*].domains[*]' | sed -e 's/^https:\/\///' -e 's/^http:\/\///' -e 's/\/$//'
curl -L --fail https://reestr.rublacklist.net/api/v3/domains | jsonfilter  -e '@[*]' | sed -e 's/^https:\/\///' -e 's/^http:\/\///' -e 's/\/$//'

curl -L --fail https://reestr.rublacklist.net/api/v3/dpi | jq -r '.[].domains[]' | sed -e 's/^https:\/\///' -e 's/^http:\/\///' -e 's/\/$//'
curl -L --fail https://reestr.rublacklist.net/api/v3/domains | jq -r '.[]' | sed -e 's/^https:\/\///' -e 's/^http:\/\///' -e 's/\/$//'
</code></pre></td><td>2023-04-30T07:10:12.610Z</td></tr><tr><td>anon94384997</td><td><p>Было бы интересно узнать как именно блокируется DHT. По сигнатурам или просто блокируется домен <a href="http://router.utorrent.com" rel="noopener nofollow ugc">router.utorrent.com</a><br>
Если второе, можно попробовать клиент Tixati, он не использует DNS. Или qBittorrent, он использует много других адресов начальных нод.<br>
Если по сигнатурам, то можно также попробовать пропатчить торрент клиент. Здесь подойдут только opensource клиенты, например qBittorrent. Это будет также полезно, потому что некоторые VPN тоже блочат DHT и патчинг торрент клиента был бы весьма полезным и для них тоже.</p></td><td>2023-04-30T11:34:40.520Z</td></tr><tr><td>VasilyGrigoriev378(Василий Григорьев)</td><td><p>Блокировка вроде если верить что мне говорят люди такая же как была у Уфанет 19 сентября 2021 года где клиенты BitTorrent по крайней мере некоторые, похоже, просто отбрасывают неизвестные пакеты по UDP, поэтому можно отправить какой угодно «мусор» реальным пирам в первом пакете, и DHT начнёт работать.Вы еще писали тогда идея на будущее для доработки nfqws и goodbyedpi<br>
пока видится 2 варианта : fake для QUIC и zero/random для остального,вот такое реализовать бы в Zapret c возможность обхода подходила на операторах Мегафон,Билайн,Теле2,МТС.</p></td><td>2023-05-01T13:05:19.946Z</td></tr><tr><td>bolvan</td><td><aside class="quote no-group" data-username="VasilyGrigoriev378" data-post="6" data-topic="4424">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/v/ce73a5/48.png" class="avatar"> VasilyGrigoriev378:</div>
<blockquote>
<p>вот такое реализовать бы в Zapret c возможность обхода подходила на операторах Мегафон,Билайн,Теле2,МТС</p>
</blockquote>
</aside>
<p>Оно уже реализовано. Можно использовать руками или с помощью custom script.<br>
Фильтр можно использовать такой. udp, поле данных начинается с “d1:”, connbytes 1:1 или cutoff=d2 в nfqws.<br>
Пусть расскажут как работает на таком варианте. Не застревает ли.</p></td><td>2023-05-01T13:50:22.145Z</td></tr><tr><td>VasilyGrigoriev378(Василий Григорьев)</td><td><p>Такой метод очень прост для определения и блокировки насколько мне известно.Может есть стратегия обхода посложнее?</p></td><td>2023-05-01T18:17:31.392Z</td></tr><tr><td>bolvan</td><td><p>Метод fake для udp расчитан исключительно на stateful фильтр. В расчете, что он не анализирует каждый пакет, а видит не-DHT и заносит “connection” в белый список.<br>
Против stateless фильтра это не работает.</p>
<p>Теоретически помогла бы фрагментация на уровне IP, но на практике этот метод для инета фактически не применим, потому что фрагменты практически всегда режутся или склеиваются, не могут пройти NAT</p>
<p>Возможно, какой-то DPI купится на дополнительные хедеры в ipv6, но это тоже сомнительно. Не везде есть ipv6, а если есть, то пакеты с доп хедерами часто режутся</p></td><td>2023-05-01T18:35:31.565Z</td></tr><tr><td>VasilyGrigoriev378(Василий Григорьев)</td><td><p>Адаптировать Zapret для IOS,MacOS пользователей возможно  как-то ,чтоб собрать приложение готовое попробовать по типу GoodbyeDPI?</p></td><td>2023-05-08T18:38:51.309Z</td></tr><tr><td>bolvan</td><td><p>docs/bsd.txt</p></td><td>2023-05-09T07:45:25.523Z</td></tr><tr><td>VasilyGrigoriev378(Василий Григорьев)</td><td><p>Bolvan в репозитории к Zapret я в описании не увидел продолжение,насчет того что если провайдер заворачивать на squid или если соединение проходит через фильтр, способный реконструировать TCP соединение.Как такой обойти DPI к примеру,просто мне кажется такой фильтр стоит у провайдера Дом.ру или тот же ТТК и хотелось бы знать заранее как обход блокировок через Zapret настраивать ,чтоб обходить фильтр, способный реконструировать TCP соединение или же завернутый на squid программный пакет, реализующий функцию кэширующего прокси-сервера для протоколов HTTP, FTP, Gopher и HTTP ?</p></td><td>2023-05-25T18:48:50.931Z</td></tr><tr><td>bolvan</td><td><p>Если TCP проксируется, а проверка выполняется уже после полноценного реконструктора уровня ОС, а не DPI, то вариантов немного.<br>
Для https их вообще нет. Для http теоретически может прокатить изменение собственно данных запроса (–hostcase, --methodleol и тд), но только если соединение дальше прогоняется в неизменном виде, а не вызывает отдельные запросы с кэширующего сервера.</p>
<p>DPI тоже часто реконструируют TCP, но делают они это в упрощенном для них варианте, не учитывая все случаи. Против такого и работают методы десинхронизации типа split, disorder</p>
<p>Собственно, сейчас смысла в кэширующих серверах практически нет, поскольку почти все идет через https. Они требуют огромной вычислительной мощности в рамках крупного провайдера, потому их содержать смысла никакого нет. Потому вряд ли провайдер использует эту технологию.<br>
Проверить достаточно просто. Сделать telnet на любой нерабочий IP адрес, и если соединение устанаваливается, а потом виснет или прерывается, то это оно самое.</p>
<p>Домру проверял не далее , чем полгода назад, в СПБ. Обходилось<br>
Домру подменяет DNS, даже на другие сервера</p></td><td>2023-05-26T07:20:19.048Z</td></tr><tr><td>VasilyGrigoriev378(Василий Григорьев)</td><td><p>Bolvan предложение у меня по развитию программы Zapret, добавьте возможность обхода блокировки по ТСПУ протокола OpenVPN UDP/TCP ,ну и обход блокировки протокола Wireguard. Ну и на всякий пожарный еще обход возможной блокировки в будущем это IKEv2/IPsec</p></td><td>2023-07-02T12:55:48.505Z</td></tr><tr><td>bolvan</td><td><p>Принципиально методы обхода для всех протоколов примерно одинаковы.<br>
По умолчанию nfqws распознает протокол, и применяет дурение только к распознанным элементам протокола (типа TLS ClientHello).</p>
<p>nfqws умеет работать и с любыми протоколами с помощью ключа --dpi-desync-any-protocol .<br>
–dpi-desync-cutoff позволяет задать точку отсечения десинхронизации. Попросту говоря номер пакета или количество данных в соединении, после которого прекращаются любые действия по десинхронизации. Этого же эффекта в linux можно достичь через iptables  -m connbytes, в nftables тоже есть аналог.</p>
<p>Если начнут массово блокировать те или иные протоколы, я добавлю в nfqws/tpws распознавалку, чтобы не использовать cutoff. Пока же говорить еще рано. Тестировать не на чем.</p>
<p>Что касается простой поддержке в сетапе, то посмотрим стоит ли ее делать. VPN это вам не 80,443, а может быть на любом порту, и придется заворачивать весь трафик для анализа , ну или по крайней мере по connbytes. К тому же тут неуместны фильтры по заблокированным сайтам. Выпадает несколько из логики.<br>
Вероятно напишу custom-ы, в которых можно будет указать номера портов. Заранее смысла делать нет. Примерно как сейчас сделано с QUIC</p></td><td>2023-07-02T13:43:12.672Z</td></tr><tr><td>bolvan</td><td><p>update: QUIC переведен в main функционал, протащеный через скрипты</p><aside class="quote quote-modified" data-post="78" data-topic="61">
  <div class="title">
    <div class="quote-controls"></div>
    <img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/b/8e8cbc/48.png" class="avatar">
    <a href="https://ntc.party/t/whats-new/61/78">What's new</a> <a class="badge-category__wrapper " href="/c/community-software/zapret-antidpi/20"><span data-category-id="20" style="--category-badge-color: #9EB83B; --category-badge-text-color: #FFFFFF; --parent-category-badge-color: #BF1E2E;" data-parent-category-id="27" data-drop-close="true" class="badge-category --has-parent" title="Zapret Deep Packet Inspection (DPI) circumvention software discussion and official support forum"><span class="badge-category__name">Zapret</span></span></a>
  </div>
  <blockquote>
    Блокировка QUIC все больше начала оформляться у провайдеров во что-то законченно-логичное вместо хаотических попыток что-то там заткнуть или заткнуть вообще весь протокол или порт. 
На большинстве провайдеров сделана блокировка по SNI (идет расшифровка на DPI) как на ipv4, так и на ipv6, по списку заблокированных доменов. 
Однако, модули распознавания QUIC initial видимо еще старые и кривые, потому могут сечь, например, curl с nghttp3 и chromium, но не сечь curl с quiche или firefox, потому блок…
  </blockquote>
</aside>
</td><td>2023-07-02T16:14:53.594Z</td></tr><tr><td>VasilyGrigoriev378(Василий Григорьев)</td><td><p>Bolvan верно я понимаю на провайдере <a href="http://sknt.ru" rel="noopener nofollow ugc">sknt.ru</a> как вы говорите он сделал качественную блокировку по SNI (идет расшифровка на DPI) как на ipv4, так и на ipv6, по списку заблокированных доменов. Обход ban QUIC через nfqws не проканает,так как хороший качественно настроенный DPI cтоит?</p></td><td>2023-07-02T20:47:34.261Z</td></tr><tr><td>bolvan</td><td><p>Совсем неверно.</p>
<p>DPI вовсе не качественный. Модуль парсинга QUIC плохой. Он не может распознать запросы от curl с quiche и от firefox. Но зато блокирует от curl с nghttp3 и от chrome based browsers.<br>
Получается, что от firefox запросы вообще не блокируются.<br>
Но если все-таки использовать блокируемый клиент, то там картина довольно качественная. Идет выпарсивание SNI и блокировка по нему в stateful mode.</p>
<p>Потому при включении обхода в nfqws начинают работать ранее не работавшие клиенты, а работавшим и так пофигу.<br>
И что самое важное - так стало на большинстве провайдеров.<br>
Раньше был хаос. Блочили непойми как , порой вообще наглухо. А если пробивалось, то потом висло. Сейчас же QUIC становится разрешенным. Значит после обмана не должно быть зависаний</p></td><td>2023-07-03T06:06:31.651Z</td></tr>
    </table>
      </body>
    </html>