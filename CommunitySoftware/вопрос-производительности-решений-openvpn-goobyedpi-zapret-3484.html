
    <html>
      <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <style>
    th, td {
      border: 1px solid black;
      border-collapse: collapse;
    }
    th, td {
      word-wrap: break-word;
      padding: 5px;
    }
    table {
      width: 100%;
      max-width: 100%;
      border: 1px solid black;
      border-collapse: collapse;
      table-layout: fixed;
      word-wrap: break-word
    }
    code {
      word-wrap: break-word;
    }
    pre {
        white-space: pre-wrap;
    }
    </style>
        <title>вопрос-производительности-решений-openvpn-goobyedpi-zapret-3484</title>
      </head>
      <body>
        <table border="1" width="100%" cellpadding="5">
          <tr>
            <th style="width: 10%;">Ник</th>
            <th>Пост</th>
            <th style="width: 10%;">Дата</th>
          </tr>
    <tr><td>4lch3m1st3r</td><td><p><strong>Всем лучей добра!</strong></p>
<p>Итак, что я имею:</p>
<ol>
<li>Keenetic KN-3010</li>
<li>Ноутбук на базе Windows 10</li>
<li>Android TV Box, без рут прав, в интернет ходит через шнурок</li>
<li>Заблокированные торренты, онлайн-кинотеатры и т.п.</li>
<li>Очень хлипкое, но скоростное (&gt;250 Мбит) интернет-соединение</li>
</ol>
<p>Что хотелось бы в идеале:</p>
<ol>
<li>Разблокировать все [удалено роскомподзором] сайты</li>
<li>Не компилировать что-то из исходников с бубном</li>
<li>Не держать 24/7 включенным основной ПК</li>
<li>Не рутовать ATV</li>
<li>Минимально повлиять на скорость интернета</li>
</ol>
<p>На данный момент, ВСЕ нужные мне веб-ресурсы я могу разблокировать на ATV следующим образом:</p>
<ol>
<li>Запустить GoodbyeDPI с параметром <code>goodbyedpi.exe -5</code> на ноутбуке</li>
<li>Запустить 3proxy на ноутбуке</li>
<li>В Android TV Box настроить прокси-сервер для Ethernet соединения<br>
Из минусов данного подхода: нужно постоянно держать ноутбук в рабочем состоянии с запущенными программами. Это мне не нравится по причине того, что он перемещается со мной на работу и ATV остается вообще без доступа к интернету. Вторая причина - настройки прокси-сервера Ethernet слетают из ATV после каждой смены прокси с Вкл на Выкл, и приходится по новой прописывать IP и порт.</li>
</ol>
<p>Также, я настраивал на роутере OpenVPN с файликом конфигурации, который любезно предоставлен antizapret. В целом: всё работает и открывается, но скорость оставляет желать лучшего. Об онлайн просмотре каких-то объемных фильмов можно забыть: буфферизация каждые 1-2 минуты просмотра. Да и в целом все заблокированные сайты грузятся значительно дольше (~в 3 раза), чем при использовании GoodbyeDPI.</p>
<p>И вот встал вопрос. Есть ли какие-то иные пути решения моей проблемы?<br>
Погуглив, я наткнулся на Zapret. И, вроде бы, его даже можно поднять средствами OpenWRT на моём роутере. Чудеса, да, но весь процесс займёт не 5 и не 15 минут, и я задался вопросом - а стоит ли?<br>
Хотелось бы узнать ответ от местных “гуру” на вопрос: насколько Zapret (при условии его поднятии на роутере) будет работать менее/более/одинаково эффективно и быстро с GoodbyeDPI? Не получу ли я срез скорости интернета, как в случае с OpenVPN? И доп. вопрос - а не слетят ли все эти настройки в роутере после его автоматического OTA обновления?</p>
<p>Заранее благодарен за ответы <img src="https://ntc.party/images/emoji/twitter/slightly_smiling_face.png?v=12" title=":slightly_smiling_face:" class="emoji" alt=":slightly_smiling_face:" loading="lazy" width="20" height="20"></p></td><td>2022-11-17T21:16:35.533Z</td></tr><tr><td>bolvan</td><td><blockquote>
<p>Хотелось бы узнать ответ от местных “гуру” на вопрос: насколько Zapret (при условии его поднятии на роутере) будет работать менее/более/одинаково эффективно и быстро с GoodbyeDPI?</p>
</blockquote>
<p>zapret использует практически те же методы, что и goodbyedpi. При одинаковой настройке они равнозначны. Если goodbye работает нормально, то и на zapret можно найти аналогичную стратегию, которая будет работать точно так же.</p>
<blockquote>
<p>И доп. вопрос - а не слетят ли все эти настройки в роутере после его автоматического OTA обновления?</p>
</blockquote>
<p>OTA обновления это область стоковых прошивок. zapret не предназначен для стока. На стоке его можно поднять только танцами с бубном. Хотя, для кинетиковв это не так сложно, как для многих других.</p>
<p>На подходе пулл реквест в openwrt, добавляющий поддержку вашего роутера.</p><aside class="onebox githubpullrequest" data-onebox-src="https://github.com/openwrt/openwrt/pull/11219">
  <header class="source">

      <a href="https://github.com/openwrt/openwrt/pull/11219" target="_blank" rel="noopener">github.com/openwrt/openwrt</a>
  </header>

  <article class="onebox-body">
    <div class="github-row" data-github-private-repo="false">



    <div class="github-icon-container" title="Pull Request">
      <svg width="60" height="60" class="github-icon" viewBox="0 0 12 16" aria-hidden="true"><path fill-rule="evenodd" d="M11 11.28V5c-.03-.78-.34-1.47-.94-2.06C9.46 2.35 8.78 2.03 8 2H7V0L4 3l3 3V4h1c.27.02.48.11.69.31.21.2.3.42.31.69v6.28A1.993 1.993 0 0 0 10 15a1.993 1.993 0 0 0 1-3.72zm-1 2.92c-.66 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2zM4 3c0-1.11-.89-2-2-2a1.993 1.993 0 0 0-1 3.72v6.56A1.993 1.993 0 0 0 2 15a1.993 1.993 0 0 0 1-3.72V4.72c.59-.34 1-.98 1-1.72zm-.8 10c0 .66-.55 1.2-1.2 1.2-.65 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2zM2 4.2C1.34 4.2.8 3.65.8 3c0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2z"></path></svg>
    </div>

  <div class="github-info-container">



      <h4>
        <a href="https://github.com/openwrt/openwrt/pull/11219" target="_blank" rel="noopener">ramips: add support for Keenetic KN-3010</a>
      </h4>

    <div class="branches">
      <code>openwrt:master</code> ← <code>Linaro1985:keenetic_kn3010</code>
    </div>

      <div class="github-info">
        <div class="date">
          opened <span class="discourse-local-date" data-format="ll" data-date="2022-11-11" data-time="11:56:04" data-timezone="UTC">11:56AM - 11 Nov 22 UTC</span>
        </div>

        <div class="user">
          <a href="https://github.com/Linaro1985" target="_blank" rel="noopener">
            <img alt="Linaro1985" src="вопрос-производительности-решений-openvpn-goobyedpi-zapret-3484/d7639e4eebfad30c692b062921d616d1a1878e99.jpeg" class="onebox-avatar-inline" width="20" height="20" data-dominant-color="6E5A42">
            Linaro1985
          </a>
        </div>

        <div class="lines" title="1 commits changed 3 files with 275 additions and 0 deletions">
          <a href="https://github.com/openwrt/openwrt/pull/11219/files" target="_blank" rel="noopener">
            <span class="added">+275</span>
            <span class="removed">-0</span>
          </a>
        </div>
      </div>
  </div>
</div>

  <div class="github-row">
    <p class="github-body-container">Keenetic KN-3010 is a 2.4/5 Ghz band 11ac (Wi-Fi 5) router, based on MT7621DAT.
<span class="show-more-container"><a href="https://github.com/openwrt/openwrt/pull/11219" target="_blank" rel="noopener" class="show-more">…</a></span><span class="excerpt hidden">

Specification:
- System-On-Chip: MT7621DAT
- CPU/Speed: 880 MHz
- Flash-Chip: Winbond w25q256
- Flash size: 32768 KiB
- RAM: 128 MiB
- 5x 10/100/1000 Mbps Ethernet
- 4x external, non-detachable antennas
- UART (J1) header on PCB (115200 8n1)
- Wireless No1 (2T2R): MT7603E 2.4 GHz 802.11bgn
- Wireless No2 (2T2R): MT7613BE 5 GHz 802.11ac
- 4x LED, 2x button, 1x mode switch

Notes:
- The device supports dual boot mode
- The firmware partitions were concatinated into one
- The FN button led indicator has been reassigned as the 2.4GHz wifi indicator.

Flash instruction:
The only way to flash OpenWrt image is to use tftp recovery mode in U-Boot:

1. Configure PC with static IP 192.168.1.2/24 and tftp server.
2. Rename "openwrt-ramips-mt7621-keenetic_kn-3010-squashfs-factory.bin" to "KN-3010_recovery.bin" and place it in tftp server directory.
3. Connect PC with one of LAN ports, press the reset button, power up the router and keep button pressed until power led start blinking.
4. Router will download file from server, write it to flash and reboot.

Signed-off-by: Maxim Anisimov &lt;maxim.anisimov.ua@gmail.com&gt;</span></p>
  </div>

  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>
<p>
пока еще нет готовых билдов, в принципе можно попробовать собрать самому</p></td><td>2022-11-18T07:16:58.296Z</td></tr><tr><td>Bronner(Roman)</td><td><p>При должном желании zapret запускается на KeeneticOS через OPKG. В репозитории есть уже скомпилированные бинарники под этот процессор. Я использую это решение уже почти год на Ultra (KN-1810), в целом стабильно, но в открытый доступ рановато выкладывать, тк есть проблема с утечкой памяти в одном из расширений при запущенном zapret судя по всему.</p></td><td>2022-11-21T15:26:25.763Z</td></tr><tr><td>4lch3m1st3r</td><td><p>Насколько я понимаю, речь идёт про entware? На KN-3010 нет USB портов. Я тоже думал изначально про это решение: например <a href="https://forum.keenetic.com/topic/3078-%D0%BE%D0%B1%D1%85%D0%BE%D0%B4-%D0%B1%D0%BB%D0%BE%D0%BA%D0%B8%D1%80%D0%BE%D0%B2%D0%BE%D0%BA-%D0%BD%D0%B0-%D1%80%D0%BE%D1%83%D1%82%D0%B5%D1%80%D0%B5/#comment-60919" class="inline-onebox" rel="noopener nofollow ugc">Обход блокировок на роутере! - Вопросы по сборке и настройке Opkg - Keenetic Community</a> или <a href="https://forum.keenetic.com/topic/3078-%D0%BE%D0%B1%D1%85%D0%BE%D0%B4-%D0%B1%D0%BB%D0%BE%D0%BA%D0%B8%D1%80%D0%BE%D0%B2%D0%BE%D0%BA-%D0%BD%D0%B0-%D1%80%D0%BE%D1%83%D1%82%D0%B5%D1%80%D0%B5/?do=findComment&amp;comment=146102" class="inline-onebox" rel="noopener nofollow ugc">Обход блокировок на роутере! - Page 19 - Вопросы по сборке и настройке Opkg - Keenetic Community</a><br>
Но насколько понимаю, то именно на Speedster (на данный момент) вариантов никаких нет установить Zapret</p></td><td>2022-11-21T16:41:10.453Z</td></tr><tr><td>bolvan</td><td><aside class="quote no-group" data-username="4lch3m1st3r" data-post="4" data-topic="3484">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/4/bb73d2/48.png" class="avatar"> 4lch3m1st3r:</div>
<blockquote>
<p>Но насколько понимаю, то именно на Speedster (на данный момент) вариантов никаких нет установить Zapret</p>
</blockquote>
</aside>
<p>Почему же нет. У этого роутера аж 32 мб встроенной памяти.<br>
Собрать openwrt - будет полно места.<br>
Или подождать (от недель до месяцев), когда войдет хотя бы в snapshot и начнутся ночные билды</p></td><td>2022-11-21T16:45:26.324Z</td></tr><tr><td>4lch3m1st3r</td><td><p>Насколько вижу, то патч поддержки KN-3010 вчера уже в Master попал</p><aside class="onebox githubcommit" data-onebox-src="https://github.com/openwrt/openwrt/commit/21762e46535d154a2e349ae2d646e2ea6926f365">
  <header class="source">

      <a href="https://github.com/openwrt/openwrt/commit/21762e46535d154a2e349ae2d646e2ea6926f365" target="_blank" rel="noopener nofollow ugc">github.com/openwrt/openwrt</a>
  </header>

  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Commit">
    <svg width="60" height="60" class="github-icon" viewBox="0 0 14 16" aria-hidden="true"><path fill-rule="evenodd" d="M10.86 7c-.45-1.72-2-3-3.86-3-1.86 0-3.41 1.28-3.86 3H0v2h3.14c.45 1.72 2 3 3.86 3 1.86 0 3.41-1.28 3.86-3H14V7h-3.14zM7 10.2c-1.22 0-2.2-.98-2.2-2.2 0-1.22.98-2.2 2.2-2.2 1.22 0 2.2.98 2.2 2.2 0 1.22-.98 2.2-2.2 2.2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="https://github.com/openwrt/openwrt/commit/21762e46535d154a2e349ae2d646e2ea6926f365" target="_blank" rel="noopener nofollow ugc">ramips: add support for Keenetic KN-3010</a>
    </h4>

    <div class="github-info">
      <div class="date">
        committed <span class="discourse-local-date" data-format="ll" data-date="2022-11-20" data-time="15:44:24" data-timezone="UTC">03:44PM - 20 Nov 22 UTC</span>
      </div>

      <div class="user">
        <a href="https://github.com/Linaro1985" target="_blank" rel="noopener nofollow ugc">
          <img alt="Linaro1985" src="вопрос-производительности-решений-openvpn-goobyedpi-zapret-3484/d7639e4eebfad30c692b062921d616d1a1878e99.jpeg" class="onebox-avatar-inline" width="20" height="20" data-dominant-color="6E5A42">
          Linaro1985
        </a>
      </div>

      <div class="lines" title="changed 3 files with 275 additions and 0 deletions">
        <a href="https://github.com/openwrt/openwrt/commit/21762e46535d154a2e349ae2d646e2ea6926f365" target="_blank" rel="noopener nofollow ugc">
          <span class="added">+275</span>
          <span class="removed">-0</span>
        </a>
      </div>
    </div>
  </div>
</div>

  <div class="github-row">
    <p class="github-body-container">Keenetic KN-3010 is a 2.4/5 Ghz band 11ac (Wi-Fi 5) router, based on MT7621DAT.
<span class="show-more-container"><a href="https://github.com/openwrt/openwrt/commit/21762e46535d154a2e349ae2d646e2ea6926f365" target="_blank" rel="noopener nofollow ugc" class="show-more">…</a></span><span class="excerpt hidden">
Specification:
- System-On-Chip: MT7621DAT
- CPU/Speed: 880 MHz
- Flash-Chip: Winbond w25q256
- Flash size: 32768 KiB
- RAM: 128 MiB
- 5x 10/100/1000 Mbps Ethernet
- 4x external, non-detachable antennas
- UART (J1) header on PCB (115200 8n1)
- Wireless No1 (2T2R): MT7603E 2.4 GHz 802.11bgn
- Wireless No2 (2T2R): MT7613BE 5 GHz 802.11ac
- 4x LED, 2x button, 1x mode switch

Notes:
- The device supports dual boot mode
- The firmware partitions were concatinated into one
- The FN button led indicator has been reassigned as the 2.4GHz
  wifi indicator.

Flash instruction:
The only way to flash OpenWrt image is to use tftp recovery mode in U-Boot:

1. Configure PC with static IP 192.168.1.2/24 and tftp server.
2. Rename "openwrt-ramips-mt7621-keenetic_kn-3010-squashfs-factory.bin"
   to "KN-3010_recovery.bin" and place it in tftp server directory.
3. Connect PC with one of LAN ports, press the reset button, power up
   the router and keep button pressed until power led start blinking.
4. Router will download file from server, write it to flash and reboot.

Signed-off-by: Maxim Anisimov &lt;maxim.anisimov.ua@gmail.com&gt;</span></p>
  </div>

  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

<p>p.s. А что на счёт <a href="https://github.com/keenetic/keenetic-sdk" class="inline-onebox" rel="noopener nofollow ugc">GitHub - keenetic/keenetic-sdk: KeeneticOS build system</a> ? На него можно накатить Zapret?</p></td><td>2022-11-21T16:56:15.851Z</td></tr><tr><td>bolvan</td><td><aside class="quote no-group" data-username="4lch3m1st3r" data-post="6" data-topic="3484">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/4/bb73d2/48.png" class="avatar"> 4lch3m1st3r:</div>
<blockquote>
<p>p.s. А что на счёт <a href="https://github.com/keenetic/keenetic-sdk">GitHub - keenetic/keenetic-sdk: KeeneticOS build system</a> ? На него можно накатить Zapret?</p>
</blockquote>
</aside>
<p>У zapret есть 2 варианта развертки</p>
<ol>
<li>
<p>С использованием предлагаемой обертки для управления и запуска. Она предназначена только для openwrt и различных linux, но иногда может использоваться с entware в ограниченном обьеме.</p>
</li>
<li>
<p>Все ручками. Записать куда-то nfqws или tpws, подобрать параметры, засунуть в автозапуск, прописать правила iptables/nftables.</p>
</li>
</ol>
<p>Если вариант 1 недоступен, значит остается 2. Вам придется понять как поднять недостающие модули ядра для NFQUEUE, куда записать бинарики, как прикрутиться к автозапуску.<br>
Это все на вас лежит или на каких-то комьюнити поддержки конкретных прошивок. out of scope основного проекта</p>
<aside class="quote no-group" data-username="4lch3m1st3r" data-post="6" data-topic="3484">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/4/bb73d2/48.png" class="avatar"> 4lch3m1st3r:</div>
<blockquote>
<p>Насколько вижу, то патч поддержки KN-3010 вчера уже в Master попал</p>
</blockquote>
</aside>
<p>Тогда скоро появятся билды snapshot</p></td><td>2022-11-21T17:09:16.875Z</td></tr><tr><td>4lch3m1st3r</td><td><p>Господа, спасибо за ответы! Буду ждать снапшот openwrt, а там уже буду думать.</p>
<p><a class="mention" href="/u/bolvan">@bolvan</a>, ещё один вопросик по теме: стандартный режим <code>goodbyedpi.exe -5</code> нужно будет подбирать для Zapret? Или <code>install_easy</code> поставит примерно такие же стратегии обхода? Я просто ещё не лез в методы, которые стоят за “-5” у gdpi</p></td><td>2022-11-21T17:22:30.851Z</td></tr><tr><td>bolvan</td><td><aside class="quote no-group" data-username="4lch3m1st3r" data-post="8" data-topic="3484">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/4/bb73d2/48.png" class="avatar"> 4lch3m1st3r:</div>
<blockquote>
<p>Или <code>install_easy</code> поставит примерно такие же стратегии обхода? Я просто ещё не лез в методы, которые стоят за “-5” у gdpi</p>
</blockquote>
</aside>
<p>install-easy сам ничего не поставит. для проверки стратегий есть blockcheck.sh<br>
см docs/quick_start.txt</p>
<p>У goodbye dpi есть некоторые функции, которые в zapret намеренно не реализованы, поскольку напрямую реализуются командами iptables/nftables. Вроде борьбы с пассивным dpi через блокировку RST/redirect.<br>
Есть ключ auto-ttl. В zapret он не реализован, но заменяется фиксированным ttl. auto-ttl создан только для упрощения поиска стратегии, чтобы не подбирать. Но иногда такой подход дает нежелательные эффекты</p></td><td>2022-11-21T17:26:11.552Z</td></tr>
    </table>
      </body>
    </html>