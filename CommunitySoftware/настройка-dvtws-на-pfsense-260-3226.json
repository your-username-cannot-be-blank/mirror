[
    {
        "id": 10265,
        "name": "",
        "username": "biveka4392",
        "avatar_template": "/letter_avatar_proxy/v4/letter/b/22d042/{size}.png",
        "created_at": "2022-09-08T15:24:45.591Z",
        "cooked": "<p>Всем доброго времени суток!</p>\n<p>Хотел бы попросить помощи по настройке dvtws на pfSense 2.6.0 от знающих людей.</p>\n<p>Проблема заключается в зацикливании пакетов при обработки их dvtws’ом.</p>\n<p>Инструкция по настройке из (<a href=\"https://github.com/bol-van/zapret/blob/b1b82cb29a84e828bcb86a2db6e970a62ee63619/docs/bsd.eng.md\" rel=\"noopener nofollow ugc\">документации</a>) не сработала из-за выпиливания фаерволла ipfw из pfSense в версии 2.6.0. При следовании инструкции ipfw просто игнорируется и не используется вовсе. Включение captive-portal не помогает так, как его <a href=\"https://github.com/pfsense/pfsense/commit/7c2468c510ea7da6f284a7afad7f62c6c9880717\" rel=\"noopener nofollow ugc\">переделали под pf</a>.</p>\n<p>В связи с этим пришлось изобретать способ перенаправления пакетов на divert-сокет.<br>\nМетодом научного тыка были выработаны следущие правила для фаерволла pf, позволяющие перенаправлять пакеты на divert-сокет:</p>\n<pre><code class=\"lang-auto\">pass in  quick on igc0 proto tcp from port {80,443} divert-to 989 no state\npass out quick on igc0 proto tcp to   port {80,443} divert-to 989 no state\n</code></pre>\n<p>При использовании данных правил пакеты успешно перенаправляются на divert-сокет и даже успешно обрабатываются dvtws’ом (заблокированный сайт открывается), но обработанные пакеты продолжают возвращаться на обработку в dvtws.</p>\n<p>Хотел бы попросить помощи в решении данной проблемы.</p>\n<details>\n<summary>\nВерсия pfSense</summary>\n<p><img src=\"настройка-dvtws-на-pfsense-260-3226/e66309bc0849720c750e78047c2f8c607b97c903.png\" alt=\"pfSense-verison\" data-base62-sha1=\"wS60nOe07NaHbRXVJob5zUiELBN\" width=\"411\" height=\"101\"></p>\n</details>\n<details>\n<summary>\nКоманда запуска dvtws</summary>\n<pre><code class=\"lang-auto\">/opt/zapret/nfq/dvtws --port 989 --dpi-desync=fake,split --dpi-desync-ttl=5 --daemon\n</code></pre>\n<p>(была найдена при помощи <a href=\"https://github.com/bol-van/zapret/blob/master/blockcheck.sh\" rel=\"noopener nofollow ugc\">blockcheck.sh</a>)</p>\n</details>\n<p>Лог работы dvtws:<br>\n<a class=\"attachment\" href=\"настройка-dvtws-на-pfsense-260-3226/17ec5EkBpmvW6fvfRPRhCn4V1as.log\">dvtws.log</a> (60.1 KB)</p>",
        "post_number": 1,
        "post_type": 1,
        "posts_count": 5,
        "updated_at": "2022-09-08T15:24:45.591Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 468,
        "reads": 69,
        "readers_count": 68,
        "score": 2338.8,
        "yours": false,
        "topic_id": 3226,
        "topic_slug": "%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-dvtws-%D0%BD%D0%B0-pfsense-260",
        "display_username": "",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
            {
                "url": "https://github.com/bol-van/zapret/blob/b1b82cb29a84e828bcb86a2db6e970a62ee63619/docs/bsd.eng.md",
                "internal": false,
                "reflection": false,
                "title": "zapret/bsd.eng.md at b1b82cb29a84e828bcb86a2db6e970a62ee63619 · bol-van/zapret · GitHub",
                "clicks": 32
            },
            {
                "url": "https://github.com/bol-van/zapret/blob/master/blockcheck.sh",
                "internal": false,
                "reflection": false,
                "title": "zapret/blockcheck.sh at master · bol-van/zapret · GitHub",
                "clicks": 9
            },
            {
                "url": "https://github.com/pfsense/pfsense/commit/7c2468c510ea7da6f284a7afad7f62c6c9880717",
                "internal": false,
                "reflection": false,
                "title": "Captive Portal ipfw->pf transition. Todo #13100 · pfsense/pfsense@7c2468c · GitHub",
                "clicks": 9
            },
            {
                "url": "/uploads/short-url/17ec5EkBpmvW6fvfRPRhCn4V1as.log",
                "internal": true,
                "reflection": false,
                "clicks": 0
            }
        ],
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 1501,
        "hidden": false,
        "trust_level": 0,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": false,
        "wiki": false,
        "post_url": "/t/%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-dvtws-%D0%BD%D0%B0-pfsense-260/3226/1",
        "can_translate": false
    },
    {
        "id": 10267,
        "name": "",
        "username": "bolvan",
        "avatar_template": "/letter_avatar_proxy/v4/letter/b/8e8cbc/{size}.png",
        "created_at": "2022-09-08T18:32:53.600Z",
        "cooked": "<p>ipfw не выпилен из 2.6.0. Модули ipfw, ipdivert присутствуют, загружаются<br>\nНо ipfw почему-то исключается из обработки.<br>\nВернуть его помогает disable/enable pf</p>\n<p>pfctl -d ; pfctl -e<br>\nи все начинает опять работать</p>",
        "post_number": 2,
        "post_type": 1,
        "posts_count": 5,
        "updated_at": "2022-09-08T18:32:53.600Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 5,
        "reads": 66,
        "readers_count": 65,
        "score": 38.2,
        "yours": false,
        "topic_id": 3226,
        "topic_slug": "%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-dvtws-%D0%BD%D0%B0-pfsense-260",
        "display_username": "",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": "Zapret anti-DPI software staff",
        "title_is_group": false,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": true,
        "admin": false,
        "staff": true,
        "group_moderator": true,
        "user_id": 19,
        "hidden": false,
        "trust_level": 3,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": false,
        "wiki": false,
        "post_url": "/t/%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-dvtws-%D0%BD%D0%B0-pfsense-260/3226/2",
        "can_translate": false
    },
    {
        "id": 10274,
        "name": "",
        "username": "biveka4392",
        "avatar_template": "/letter_avatar_proxy/v4/letter/b/22d042/{size}.png",
        "created_at": "2022-09-09T03:23:21.187Z",
        "cooked": "<p>Действительно помогло.<br>\nСпасибо большое!</p>",
        "post_number": 3,
        "post_type": 1,
        "posts_count": 5,
        "updated_at": "2022-09-09T03:23:21.187Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 1,
        "reads": 58,
        "readers_count": 57,
        "score": 16.6,
        "yours": false,
        "topic_id": 3226,
        "topic_slug": "%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-dvtws-%D0%BD%D0%B0-pfsense-260",
        "display_username": "",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 1501,
        "hidden": false,
        "trust_level": 0,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": false,
        "wiki": false,
        "post_url": "/t/%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-dvtws-%D0%BD%D0%B0-pfsense-260/3226/3",
        "can_translate": false
    },
    {
        "id": 27592,
        "name": "",
        "username": "Elevator",
        "avatar_template": "/letter_avatar_proxy/v4/letter/e/ee59a6/{size}.png",
        "created_at": "2024-07-23T10:36:18.561Z",
        "cooked": "<blockquote>\n<p>для поиска</p>\n</blockquote>\n<p>Такая же проблема на OPNsense 24.1.10_3<br>\nСпособ решения выше</p>",
        "post_number": 4,
        "post_type": 1,
        "posts_count": 5,
        "updated_at": "2024-07-23T10:36:18.561Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 0,
        "reads": 41,
        "readers_count": 40,
        "score": 8.2,
        "yours": false,
        "topic_id": 3226,
        "topic_slug": "%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-dvtws-%D0%BD%D0%B0-pfsense-260",
        "display_username": "",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 581,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": false,
        "wiki": false,
        "post_url": "/t/%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-dvtws-%D0%BD%D0%B0-pfsense-260/3226/4",
        "can_translate": false
    },
    {
        "id": 30805,
        "name": "Dmshel",
        "username": "dmshel",
        "avatar_template": "/user_avatar/ntc.party/dmshel/{size}/6284_2.png",
        "created_at": "2024-08-07T13:45:45.104Z",
        "cooked": "<p>Коллеги, Добрый вечер! А можно пошаговую инструкцию для pfsense. трижды пытался делать по инструкции по ссылке выше, все проделал, финальный выхлоп, как в инструкции, но после этих манипуляций вообще ни один сайт не открывается. делал по доке с момента pfsense.</p>",
        "post_number": 5,
        "post_type": 1,
        "posts_count": 5,
        "updated_at": "2024-08-07T13:46:41.772Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 3,
        "reads": 23,
        "readers_count": 22,
        "score": 19.6,
        "yours": false,
        "topic_id": 3226,
        "topic_slug": "%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-dvtws-%D0%BD%D0%B0-pfsense-260",
        "display_username": "Dmshel",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 4424,
        "hidden": false,
        "trust_level": 1,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": false,
        "wiki": false,
        "post_url": "/t/%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-dvtws-%D0%BD%D0%B0-pfsense-260/3226/5",
        "can_translate": false
    }
]