
    <html>
      <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <style>
    th, td {
      border: 1px solid black;
      border-collapse: collapse;
    }
    th, td {
      word-wrap: break-word;
      padding: 5px;
    }
    table {
      width: 100%;
      max-width: 100%;
      border: 1px solid black;
      border-collapse: collapse;
      table-layout: fixed;
      word-wrap: break-word
    }
    code {
      word-wrap: break-word;
    }
    pre {
        white-space: pre-wrap;
    }
    </style>
        <title>механизмы-обхода-блокировки-vpn</title>
      </head>
      <body>
        <table border="1" width="100%" cellpadding="5">
          <tr>
            <th style="width: 10%;">Ник</th>
            <th>Пост</th>
            <th style="width: 10%;">Дата</th>
          </tr>
    <tr><td>Limtech</td><td><p>Всем привет.<br>
Думаю интересно было бы объединить в одну тему теорию и практику сабжа на фоне начала массовых блокировок vpn в России, дабы почерпнуть всё из одного места, а не искать по кусочкам, раскиданным по всему форуму. Самую ценную информацию можно было бы закрепить в шапке темы.<br>
Начну со своих 5 копеек.<br>
Сталкивался с временной блокировкой личного vps/vpn на 5 пользователей, два раза по кабелю в виде drop всего трафика на нестандартные порты(кроме 22/80/443; причем у знакомого в это время на его однопользовательском личном vpn всё работало) и один раз drop udp dstport у конкретного пользователя. Сейчас всё работает, но, вероятно, это разведка боем и стоит уже принимать меры, чтобы не попасть в постоянные списки.</p>
<p>Самым ультимативным методом мне кажется мимикрия под https и приземление массового трафика всех пользователей в пределах РФ(например wireguard; сомневаюсь, что будут блокировать vpn внутри страны, т.к. это сломает инфраструктуру, да и не зря ТСПУ на магистрали ставят), а далее проброс его через мост(openconnect/shadowsocks ?) на зарубежный сервер под видом https трафика. Опыт товарищей из Китая подсказывает, что ТСПУ могут обратиться на подозрительный адрес, чтобы проанализировать содержимое/результат - в этом случае отдавать простенький сайтик в виде заглушки.  Единственное слабое место, кмк, - соответствие TLS fingerprint https трафику. Интересно было бы послушать специалистов.</p>
<p>Ваши предположения?</p></td><td>2023-08-09T09:18:51.698Z</td></tr><tr><td>Elevator</td><td><p>Рекомендую к прочтению <a href="https://habr.com/ru/articles/731608/" rel="noopener nofollow ugc">https://habr.com/ru/articles/731608/</a></p>
<p>Это самый современный способ обхода блокировок на данный момент<br>
Плюсы:<br>
-Не требуется хостить свой веб-сайт<br>
-шифруется только рукопожатие, остальной трафик идет без двойного шифрования<br>
-решена проблема с fingerprint<br>
-есть клиенты под ios/android/win/mac/linux и т.д<br>
-бонусом удобная настройка роутинга трафика<br>
Минусы:<br>
-это не vpn, можно маршрутизировать только https трафик</p>
<p>Штука настолько мощная что обходит даже китайкий фаервол</p></td><td>2023-08-09T10:03:54.240Z</td></tr><tr><td>Xunlei</td><td><p>Я, например, мечтаю об инструменте, который мог бы устанавливать IP туннель мимикрируясь под https с настраиваемым отпечатком браузера и валидным сертификатом Let’s Encrypt с настраиваемой заглушкой против active probing; с user mode TCP реализацией с отключенным сongestion сontrol и re-transmission; с автоподбором оптимального MTU физических пакетов (виртуальный интерфейс мог бы иметь MTU, например, 64 KiB, но с флагом DF PMTUD выдавал бы MTU выходного интерфейса сервера или не фрагментируемого затуннелированного пакета в зависимости от решаемой задачи); с пересборкой TCP сессии по умолчанию, но и возможностью отправки сырых TCP пакетов при необходимости, с автоконтролем качества связи и добавления помехоустойчивого кодирования при ухудшении канала; возможностью поднять SOCKS5 прокси с поддержкой UDP relay вместо интерфейса, если он не нужен; c policy-based routing; с опциональным кэширующим DNS сервером и transparent HTTP/HTTPS прокси для ускорения загрузки web; с графическим интерфейсом под windows и визуальным программированием; c менеджментом пользователей сервера; с быстродействующими клиентами под мобильные процессоры. А пока приходится извращаться с кучей инструментов и смотреть на высокую нагрузку мобильных CPU.</p></td><td>2023-08-09T11:22:16.363Z</td></tr><tr><td>Xunlei</td><td><p>Ещё необходима возможность дублирования broadcast пакетов на все интерфейсы под windows как в других ОС. Сейчас они идут только на один интерфейс с наименьшей метрикой.</p></td><td>2023-08-09T11:39:07.892Z</td></tr><tr><td>ValdikSS</td><td><aside class="quote no-group" data-username="Limtech" data-post="1" data-topic="5230">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/l/9f8e36/48.png" class="avatar"> Limtech:</div>
<blockquote>
<p>приземление массового трафика всех пользователей в пределах РФ</p>
</blockquote>
</aside>
<p>Самый простой вариант — арендовать сервер в РФ <a href="https://ntc.party/t/list-of-vps-dedicated-server-network-censorship-in-russia/4867/1">без ТСПУ</a> (и убедиться, что <a href="https://ntc.party/t/05-08-2023-08-08-2023/5124/32">AS тоже в РФ</a>), настроить на нём перенаправление портов на сервер за рубежом.<br>
Такой вариант вряд ли продолжит работать в следующем году, так как обещают установить ТСПУ на хостинг-площадках (<a href="https://ntc.party/t/topic/4899">1</a>, <a href="https://roskomsvoboda.org/post/zhiostkoye-regulirovanie-telekoma/">2</a>).</p>
<p>Вариант чуть сложнее и чуть надёжнее, но всё ещё простой: так как на этот раз блокировали только VPN-подключения из РФ за рубеж, можно настроить подключение с сервера за рубежом на сервер в РФ. Гарантий, что такой способ не заблокируют, нет, но всё же он выглядит логически обоснованным.</p>
<p>Вариант получше: то же самое, только с несколькими туннелями по разным протоколам, проверкой их  работоспособности и динамической сменой маршрута на рабочий (например, с помощью keepalived). Можно дополнить инкапсуляцию легко инкапсулируемых туннелей (OpenVPN, L2TP, чистый PPP) в shadowsocks/vmess/другой анти-цензурный протокол.</p>
<p>Также, как было видно по АнтиЗапрету, работали методы нарушения определения протокола на стороне сервера. Их можно применять, если хотя бы первый пакет доходит до сервера (как было в случае OpenVPN, но не WireGuard в сторону OVH/Scaleway). Для этого можно либо применять <a href="https://ntc.party/c/community-software/zapret-antidpi/20">zapret</a>, либо более точечные методы (пришлось пропатчить OpenVPN, чуть изменив протокол, но не нарушив его понимание клиентом, на что потребовалось приличное количество времени).</p>
<p>OpenVPN можно дополнительно обернуть в HTTP или Socks-прокси, у него есть их штатная поддержка. Работа через HTTP-прокси обходила блокировку.</p></td><td>2023-08-10T08:59:48.575Z</td></tr><tr><td>Limtech</td><td><aside class="quote no-group" data-username="ValdikSS" data-post="5" data-topic="5230">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/valdikss/48/2_2.png" class="avatar"> ValdikSS:</div>
<blockquote>
<p>Самый простой вариант — арендовать сервер в РФ <a href="https://ntc.party/t/list-of-vps-dedicated-server-network-censorship-in-russia/4867/1">без ТСПУ</a> (и убедиться, что <a href="https://ntc.party/t/05-08-2023-08-08-2023/5124/32">AS тоже в РФ </a>), настроить на нём перенаправление портов на сервер за рубежом.<br>
Такой вариант вряд ли продолжит работать в следующем году, так как обещают установить ТСПУ на хостинг-площадках (<a href="https://ntc.party/t/topic/4899">1 </a>, <a href="https://roskomsvoboda.org/post/zhiostkoye-regulirovanie-telekoma/" rel="noopener nofollow ugc">2 </a>).</p>
</blockquote>
</aside>
<p>Вероятно уже сейчас устанавливают. Есть VPS у одного хостера из списка, у которого 8 баллов на adguard и meduza, но трафик режется на стадии client hello(SSL handshake has read 0 bytes and written 324 bytes).</p></td><td>2023-08-10T13:07:45.300Z</td></tr><tr><td>Nike(nike)</td><td><p>Практически все это есть в xray, но это не впн.</p></td><td>2023-08-10T16:14:29.779Z</td></tr><tr><td>ValdikSS</td><td><p>VPN можно получить, терминировав трафик в PPP. Можно как по TCP (pppd как pty/socket), так и UDP (L2TP).<br>
<a href="https://github.com/shadowsocks/shadowsocks-org/discussions/244">Вот</a> мои риторические вопросы и возмущения.</p></td><td>2023-08-10T17:38:21.117Z</td></tr><tr><td>Xunlei</td><td><p>Практически ничего нет в xray. Он у меня стоит для scrape запросов трекеров, а VoIP по нему работает очень плохо.</p></td><td>2023-08-10T19:04:58.833Z</td></tr><tr><td>Xunlei</td><td><p><a href="https://habr.com/ru/companies/xeovo/articles/753834/#comment_25846190" rel="noopener nofollow ugc">Продублирую</a> для истории:</p>
<aside class="quote no-group" data-username="ValdikSS">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/valdikss/48/2_2.png" class="avatar"> ValdikSS:</div>
<blockquote>
<p>Китайские комбайны вроде v2ray, xray, sing-box сотоварищи это, конечно, здорово в плане инновационных протоколов и широких возможностей в инкапсуляции трафика и функциональности по маршрутизации, но коммерческую <strong>VPN</strong>-инфраструктуру <em>на них</em> не построишь, они рассчитаны на домашнее использование, максимум на любительский сервис для пары десятков друзей. И это не столько из-за отсутствия унифицированных кросс-платформенных утилит с графическим интерфейсом, скудной документации, кучи протоколов со своими нюансами и недостатками, а из-за отсутствия понятия сессии, нормальной аутентификации, и непосредственно самого VPN — <strong>все</strong> эти программы являются либо туннелями с socks/http-прокси фронт/бэкендом (shadowsocks, v2ray), либо вовсе туннелируют один порт (cloak).<br>
Они не туннелируют протоколы, отличные от TCP и UDP (и то не все), не позволяют принимать входящие соединения, часто нарушают работу VoIP/WebRTC/NAT Punching (т.к. не сохраняют порт UDP), требуют настройки каждой программы на использование прокси отдельно, либо реализуют userspace IP-стек с псевдо-сетевым интерфейсом, что только увеличивает костыльность решения. Сделаны они так из-за того, что программировать прокси, т.е. работать с потоками данных гораздо проще, чем обрабатывать отдельные пакеты, как того требует VPN.</p>
<p>С другой стороны у нас есть великий и могучий PPP, как в его обычном “L2”-виде, так и поверх UDP (L2TP). Он обеспечивает всё то, чего не хватает коммерческому сервису для эффективной инфраструктуры, а конечному пользователю для счастья: сессионность, аутентификация, туннелирование любых IP-протоколов в любые стороны, возможность терминирования на удалённом устройстве (настройка на бытовых роутерах, все поддерживают L2TP). С помощью него можно централизованно терминировать все возможные туннели, независимо от программы и протокола. Для него есть крутые коммерческие системы биллинга и доступа, операторского уровня.<br>
Недоумеваю, почему никто не скрестил эти две вещи.</p>
</blockquote>
</aside>
<p>Я года три назад пытался начать скрещивание, но дальше создания пустого проекта дело не дошло: все ЯП мне противны, на асме слишком рутинно.</p></td><td>2023-08-10T23:46:53.837Z</td></tr><tr><td>Frrienwrvale</td><td><p>При всем уважении, Вы путаете теплое с мягким.<br>
У ВПН своя задача, у средств обхода блокировок другая. Естественно и приоритеты разные.</p></td><td>2023-08-14T08:18:07.088Z</td></tr><tr><td>lamor(lamor)</td><td><p>а можно ваш патч на OpenVPN?</p></td><td>2023-08-14T11:13:46.051Z</td></tr><tr><td>ikev2(ikev2)</td><td><p>Присоединяюсь. Можно как-то получить этот патч?</p></td><td>2023-08-16T10:09:09.935Z</td></tr><tr><td>ValdikSS</td><td><aside class="quote" data-post="161" data-topic="4576">
  <div class="title">
    <div class="quote-controls"></div>
    <img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/valdikss/48/2_2.png" class="avatar">
    <a href="https://ntc.party/t/%D0%BF%D0%B5%D1%80%D0%B8%D0%BE%D0%B4%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B0%D1%8F-%D0%B1%D0%BB%D0%BE%D0%BA%D0%B8%D1%80%D0%BE%D0%B2%D0%BA%D0%B0-openvpn-%D0%BD%D0%B0-%D1%87%D0%B0%D1%81%D1%82%D0%B8-%D0%BE%D0%BF%D0%B5%D1%80%D0%B0%D1%82%D0%BE%D1%80%D0%BE%D0%B2-%D1%81-31052023/4576/161">Периодическая блокировка OpenVPN/Wireguard на ТСПУ (31.05.2023 - 08.2023)</a> <a class="badge-category__wrapper " href="/c/internet-censorship-all-around-the-world/russia/12"><span data-category-id="12" style="--category-badge-color: #BF1E2E; --category-badge-text-color: #FFFFFF; --parent-category-badge-color: #0088CC;" data-parent-category-id="10" data-drop-close="true" class="badge-category --has-parent" title="Информация и обсуждение блокировок ресурсов в Российской Федерации"><span class="badge-category__name">Russia</span></span></a>
  </div>
  <blockquote>
    Нет, этого не планируется.
  </blockquote>
</aside>
</td><td>2023-08-16T11:43:46.272Z</td></tr><tr><td>somebodywashere(Somebodywashere)</td><td><p>Вы не правы насчёт минуса.<br>
На мобильных устройствах по умолчанию включен режим тунеллирования (TUN) на всех приложениях. На пк клиентах также везде сейчас есть свич на VPN/TUN мод, все работает без проблем.</p></td><td>2023-08-21T08:17:45.209Z</td></tr><tr><td>Sheva(Semyon Shevchenko)</td><td><p>Я был бы сильно признателен, если бы подобный патч вышел для контейнера. Сейчас перестал работать OpenVPN и я честно говоря не нашел другой относительно простой альтернативы вашему решению, да еще чтобы она работала на роутере asus.<br>
А идти перепрошивать роутер на мерлина, чтобы установить туда шадоусокс как-то не хочется…</p>
<p>Или не хочешь публиковать патч, чтобы не увидели алгоритм обхода блокировки?</p></td><td>2024-01-01T15:27:55.804Z</td></tr>
    </table>
      </body>
    </html>