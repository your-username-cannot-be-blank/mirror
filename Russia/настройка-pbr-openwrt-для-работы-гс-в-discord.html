
    <html>
      <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <style>
    th, td {
      border: 1px solid black;
      border-collapse: collapse;
    }
    th, td {
      word-wrap: break-word;
      padding: 5px;
    }
    table {
      width: 100%;
      max-width: 100%;
      border: 1px solid black;
      border-collapse: collapse;
      table-layout: fixed;
      word-wrap: break-word
    }
    code {
      word-wrap: break-word;
    }
    pre {
        white-space: pre-wrap;
    }
    </style>
        <title>настройка-pbr-openwrt-для-работы-гс-в-discord</title>
      </head>
      <body>
        <table border="1" width="100%" cellpadding="5">
          <tr>
            <th style="width: 10%;">Ник</th>
            <th>Пост</th>
            <th style="width: 10%;">Дата</th>
          </tr>
    <tr><td>mipeje</td><td><p>Я использую VLESS для обхода блокировок, а также приложение Hiddify в режиме VPN. Через него Discord работает полностью, но только при использовании VPN (в режиме системного прокси работает только чат). Как восстановить полноценную работу Discord через OpenWRT?</p>
<p>Я уже добавил все домены Discord в список PBR, однако по-прежнему работает только чат. При этом VLESS на OpenWRT работает в режиме tun-интерфейса через Sing-box, что, как я понимаю, аналогично VPN-режиму в Hiddify.</p></td><td>2024-10-09T16:09:21.679Z</td></tr><tr><td>0ka(0ka)</td><td><p>диапазоны ip адресов скидывали в другой теме</p></td><td>2024-10-09T16:11:13.037Z</td></tr><tr><td>mipeje</td><td><p>Пытался так сделать, добавил все ip серверов Дискорда, но работает только первое подключение к гс почему то. Потом надо пержапускать pbr</p></td><td>2024-10-09T16:32:07.420Z</td></tr><tr><td>MasterYoba</td><td><p>Вам надо маршрутами заворачивать весь трафик на sing-box, а не конкретные домены дискорда, потому что использование доменов в pbr это кривой костыль какой-то, который работает неизвестно как. А домены дискорда как и все прочие, которые надо гнать через vless описываете в конфиге sing-box в правилах в разделе routes, а весь прочий трафик пойдет уже напрямую в интернет через default outbound.</p>
<p>У меня настроена именно такая схема, только вместо опенврт использую opnsense, но думаю разницы там нет никакой. Голос в дискорде работает.</p></td><td>2024-10-09T19:22:52.731Z</td></tr><tr><td>MasterYoba</td><td><p>Не знаю деталей работы pbr плагина в openwrt, но предполагаю, что он единожды отрезолвил домены и дальше работает с полученными адресами до перезапуска. А адреса очевидно могут меняться.</p></td><td>2024-10-09T19:28:50.882Z</td></tr><tr><td>0ka(0ka)</td><td><p>смотри в wireshark к какому ip идет подключение и действительно ли он есть в списке pbr</p></td><td>2024-10-09T19:32:56.582Z</td></tr>
    </table>
      </body>
    </html>