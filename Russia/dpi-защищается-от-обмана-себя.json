[
    {
        "id": 22463,
        "name": "",
        "username": "bolvan",
        "avatar_template": "/letter_avatar_proxy/v4/letter/b/8e8cbc/{size}.png",
        "created_at": "2024-02-08T09:45:32.712Z",
        "cooked": "<p>Исследуя блокировки на одном из провайдеров , я обнаружил интересную штуку.<br>\nБольшинство блокировок обходится zapret-ом как обычно на других провайдерах.<br>\nОднако, на cloudflare применен какой-то более строгий алгоритм, который сечет попытки обхода, по крайней мере split запроса точно, и в этом случае вне зависимости от домена дает RST.</p>\n<p>Вот так это выглядит :</p>\n<p>Если zapret убрать, то фильтрация идет нормально.</p>\n<pre><code class=\"lang-auto\">$ sudo systemctl stop zapret\n$ curl -4k --resolve bred.com:443:172.67.159.231 https://bred.com\ncurl: (35) OpenSSL/3.0.9: error:0A000410:SSL routines::sslv3 alert handshake failure\n(ЭТО ОШИБКА СО СТОРОНЫ CLOUDFLARE, НЕ БЛОКИРАТОР)\n$ curl -4k --resolve nhentai.net:443:172.67.159.231 https://nhentai.net\ncurl: (35) Recv failure: Connection reset by peer\n$ curl -4k --resolve rutracker.org:443:172.67.159.231 https://rutracker.org\ncurl: (35) Recv failure: Connection reset by peer\n\n</code></pre>\n<p>Однако, при любой фрагментации запроса идет сброс вне зависимости от домена :</p>\n<pre><code class=\"lang-auto\">$ ps xau | grep nfqws\ntpws       21245  0.0  0.0   3028  2080 ?        S    12:07   0:00 /opt/zapret/nfq/nfqws --user=tpws --dpi-desync-fwmark=0x40000000 --qnum=200 --dpi-desync=split2\n\n$ curl -4k --resolve kremlin.ru:443:172.67.159.231 https://kremlin.ru\ncurl: (35) Recv failure: Connection reset by peer\n\n$ curl -4k --resolve lenta.ru:443:172.67.159.231 https://lenta.ru\ncurl: (35) Recv failure: Connection reset by peer\n\n</code></pre>\n<p>Отсюда можно сделать какой вывод.<br>\nУ них есть особый более строгий фильтр для CDN типа cloudflare, который zapret пробить не в состоянии. По той причине, что он сечет попытки обхода (например, через split запроса) и полностью блокирует IP в этом случае.</p>\n<p>/etc/hosts<br>\n104.21.97.11 <a href=\"http://nhentai.net\">nhentai.net</a><br>\n104.21.97.11 <a href=\"http://rutracker.org\">rutracker.org</a></p>\n<p>помогает с zapret-ом обойти блокировку</p>\n<p>Как показывает опыт, не весь cloudflare так заблокирован. В нем есть ряд диапазонов, который заблокирован как описано выше, но если из него выехать, то там все стандартно</p>\n<p>Не исключаю, что там осталась какая-то старая отсебятина от провайдеров. Там стоит минимум 2 DPI, который дают редирект по http на разные URL, но возможно еще какое-то старье</p>\n<p>В спб на нескольких провайдерах ничего подобного (пока ?) нет.</p>\n<p>PS. Обнаружилась дырка в “строгости”. Если резать по 1 байту --dpi-desync-split-pos=1, то это пробивает фильтр</p>",
        "post_number": 1,
        "post_type": 1,
        "posts_count": 6,
        "updated_at": "2024-02-08T11:59:31.068Z",
        "reply_count": 1,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 457,
        "reads": 172,
        "readers_count": 171,
        "score": 2319.4,
        "yours": false,
        "topic_id": 7091,
        "topic_slug": "dpi-%D0%B7%D0%B0%D1%89%D0%B8%D1%89%D0%B0%D0%B5%D1%82%D1%81%D1%8F-%D0%BE%D1%82-%D0%BE%D0%B1%D0%BC%D0%B0%D0%BD%D0%B0-%D1%81%D0%B5%D0%B1%D1%8F",
        "display_username": "",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 2,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
            {
                "url": "http://nhentai.net",
                "internal": false,
                "reflection": false,
                "clicks": 31
            },
            {
                "url": "http://rutracker.org",
                "internal": false,
                "reflection": false,
                "title": "RuTracker.org",
                "clicks": 14
            },
            {
                "url": "https://ntc.party/t/byedpi/4683/51",
                "internal": true,
                "reflection": true,
                "title": "ByeDPI",
                "clicks": 8
            },
            {
                "url": "https://ntc.party/t/%D0%B1%D0%BB%D0%BE%D0%BA%D0%B8%D1%80%D0%BE%D0%B2%D0%BA%D0%B0-ntcparty/7480/15",
                "internal": true,
                "reflection": true,
                "title": "Блокировка ntc.party",
                "clicks": 5
            }
        ],
        "read": true,
        "user_title": "Zapret anti-DPI software staff",
        "title_is_group": false,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": true,
        "admin": false,
        "staff": true,
        "user_id": 19,
        "hidden": false,
        "trust_level": 3,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": false,
        "wiki": false,
        "post_url": "/t/dpi-%D0%B7%D0%B0%D1%89%D0%B8%D1%89%D0%B0%D0%B5%D1%82%D1%81%D1%8F-%D0%BE%D1%82-%D0%BE%D0%B1%D0%BC%D0%B0%D0%BD%D0%B0-%D1%81%D0%B5%D0%B1%D1%8F/7091/1",
        "can_translate": false
    },
    {
        "id": 22469,
        "name": "",
        "username": "m0xfff",
        "avatar_template": "/user_avatar/ntc.party/m0xfff/{size}/2696_2.png",
        "created_at": "2024-02-08T19:14:03.833Z",
        "cooked": "<p>У проводного мтс такая фигня уже давно. Уже года 3, если не больше. Тоже заметил, что там два dpi. Один поумнее, собирает сессию и ищет вначале tls запрос. Другой тупой и просто ищет tls запрос в каждом пакете без анализа сессий. И вот второй dpi находит начало tls запроса, но не находит sni, который переместился в следующий пакет. И срабатывает блокировка. Видимо так решили проблему encrypted sni.</p>",
        "post_number": 2,
        "post_type": 1,
        "posts_count": 6,
        "updated_at": "2024-02-08T19:14:03.833Z",
        "reply_count": 1,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 1,
        "reads": 156,
        "readers_count": 155,
        "score": 41.2,
        "yours": false,
        "topic_id": 7091,
        "topic_slug": "dpi-%D0%B7%D0%B0%D1%89%D0%B8%D1%89%D0%B0%D0%B5%D1%82%D1%81%D1%8F-%D0%BE%D1%82-%D0%BE%D0%B1%D0%BC%D0%B0%D0%BD%D0%B0-%D1%81%D0%B5%D0%B1%D1%8F",
        "display_username": "",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 399,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": false,
        "wiki": false,
        "post_url": "/t/dpi-%D0%B7%D0%B0%D1%89%D0%B8%D1%89%D0%B0%D0%B5%D1%82%D1%81%D1%8F-%D0%BE%D1%82-%D0%BE%D0%B1%D0%BC%D0%B0%D0%BD%D0%B0-%D1%81%D0%B5%D0%B1%D1%8F/7091/2",
        "can_translate": false
    },
    {
        "id": 22480,
        "name": null,
        "username": "anon57137390",
        "avatar_template": "/letter_avatar_proxy/v4/letter/a/258eb7/{size}.png",
        "created_at": "2024-02-08T23:07:52.741Z",
        "cooked": "<p>del</p>",
        "post_number": 3,
        "post_type": 1,
        "posts_count": 6,
        "updated_at": "2024-02-09T09:23:11.222Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 0,
        "reads": 146,
        "readers_count": 145,
        "score": 29.2,
        "yours": false,
        "topic_id": 7091,
        "topic_slug": "dpi-%D0%B7%D0%B0%D1%89%D0%B8%D1%89%D0%B0%D0%B5%D1%82%D1%81%D1%8F-%D0%BE%D1%82-%D0%BE%D0%B1%D0%BC%D0%B0%D0%BD%D0%B0-%D1%81%D0%B5%D0%B1%D1%8F",
        "display_username": null,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 2,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 2803,
        "hidden": false,
        "trust_level": 1,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": false,
        "wiki": false,
        "user_suspended": true,
        "post_url": "/t/dpi-%D0%B7%D0%B0%D1%89%D0%B8%D1%89%D0%B0%D0%B5%D1%82%D1%81%D1%8F-%D0%BE%D1%82-%D0%BE%D0%B1%D0%BC%D0%B0%D0%BD%D0%B0-%D1%81%D0%B5%D0%B1%D1%8F/7091/3",
        "can_translate": false
    },
    {
        "id": 22485,
        "name": "",
        "username": "bolvan",
        "avatar_template": "/letter_avatar_proxy/v4/letter/b/8e8cbc/{size}.png",
        "created_at": "2024-02-09T06:44:53.985Z",
        "cooked": "<aside class=\"quote no-group\" data-username=\"m0xfff\" data-post=\"2\" data-topic=\"7091\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://ntc.party/user_avatar/ntc.party/m0xfff/48/2696_2.png\" class=\"avatar\"> m0xfff:</div>\n<blockquote>\n<p>И вот второй dpi находит начало tls запроса, но не находит sni, который переместился в следующий пакет</p>\n</blockquote>\n</aside>\n<p>Пробовал резать по 516:1 (всего 517). Та же история.<br>\nПричем, как уже написал, это работает только на части адресов cloudflare. Довольно большие дипазоны, типа x.x.0.0-x.x.96.255  , а с x.x.97.0 - норм<br>\nЭто какое-то отдельное правило. Анализируя только 1-й пакет на 443 порту, допускать только TLS, проверяя при этом SNI. TLS считается как полная запись, кусок не считается. Иначе - RST</p>",
        "post_number": 4,
        "post_type": 1,
        "posts_count": 6,
        "updated_at": "2024-02-09T06:46:44.440Z",
        "reply_count": 0,
        "reply_to_post_number": 2,
        "quote_count": 1,
        "incoming_link_count": 2,
        "reads": 138,
        "readers_count": 137,
        "score": 37.6,
        "yours": false,
        "topic_id": 7091,
        "topic_slug": "dpi-%D0%B7%D0%B0%D1%89%D0%B8%D1%89%D0%B0%D0%B5%D1%82%D1%81%D1%8F-%D0%BE%D1%82-%D0%BE%D0%B1%D0%BC%D0%B0%D0%BD%D0%B0-%D1%81%D0%B5%D0%B1%D1%8F",
        "display_username": "",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": "Zapret anti-DPI software staff",
        "title_is_group": false,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": true,
        "admin": false,
        "staff": true,
        "user_id": 19,
        "hidden": false,
        "trust_level": 3,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": false,
        "wiki": false,
        "post_url": "/t/dpi-%D0%B7%D0%B0%D1%89%D0%B8%D1%89%D0%B0%D0%B5%D1%82%D1%81%D1%8F-%D0%BE%D1%82-%D0%BE%D0%B1%D0%BC%D0%B0%D0%BD%D0%B0-%D1%81%D0%B5%D0%B1%D1%8F/7091/4",
        "can_translate": false
    },
    {
        "id": 22499,
        "name": "",
        "username": "hufrea",
        "avatar_template": "/letter_avatar_proxy/v4/letter/h/8c91f0/{size}.png",
        "created_at": "2024-02-09T12:58:08.350Z",
        "cooked": "<p>Обнаружил похожую блокировку с конца января:<br>\n1</p>\n<pre><code class=\"lang-auto\">$ ./ciadpi -m split -s 3 &amp;\n\n$ curl -I --resolve rutracker.org:443:172.67.182.196 https://rutracker.org -x socks5://localhost:1080\ncurl: (35) OpenSSL SSL_connect: SSL_ERROR_SYSCALL in connection to rutracker.org:443\n(Блокировка)\n\n$ curl -I --resolve rutracker.org:443:172.67.159.231 https://rutracker.org -x socks5://localhost:1080\ncurl: (35) OpenSSL SSL_connect: SSL_ERROR_SYSCALL in connection to rutracker.org:443\n(Блокировка)\n\n$ curl -I --resolve bred.ru:443:172.67.159.231 https://bred.ru -x socks5://localhost:1080\ncurl: (35) OpenSSL/3.0.9: error:0A000410:SSL routines::sslv3 alert handshake failure\n(Ошибка Cloudflare)\n</code></pre>\n<p>2</p>\n<pre><code class=\"lang-auto\">$ ./ciadpi -m disorder -s 3 &amp;\n\n$ curl -I --resolve rutracker.org:443:172.67.182.196 https://rutracker.org -x socks5://localhost:1080\nHTTP/2 301...\n\n$ curl -I --resolve rutracker.org:443:172.67.159.231 https://rutracker.org -x socks5://localhost:1080\ncurl: (35) OpenSSL SSL_connect: SSL_ERROR_SYSCALL in connection to rutracker.org:443\n(Блокировка)\n\n$ curl -I --resolve bred.ru:443:172.67.159.231 https://bred.ru -x socks5://localhost:1080\ncurl: (35) OpenSSL SSL_connect: SSL_ERROR_SYSCALL in connection to bred.ru:443\n(Блокировка)\n</code></pre>\n<p>Да, на некоторые адреса действует особая блокировка - если первый пакет не является TLS записью с SNI, то соединение блокируется, независимо от домена.<br>\nОбойти можно, отправив фейковый TLS пакет:</p>\n<pre><code class=\"lang-auto\">$ ./ciadpi -m fake -s 8 -H -t 7 &amp;\n\n$ curl -I --resolve rutracker.org:443:172.67.182.196 https://rutracker.org -x socks5://localhost:1080\nHTTP/2 301...\n\n$ curl -I --resolve rutracker.org:443:172.67.159.231 https://rutracker.org -x socks5://localhost:1080\nHTTP/2 301...\n\n$ curl -I --resolve bred.ru:443:172.67.159.231 https://bred.ru -x socks5://localhost:1080\ncurl: (35) OpenSSL/3.0.9: error:0A000410:SSL routines::sslv3 alert handshake failure\n(Ошибка Cloudflare)\n</code></pre>",
        "post_number": 5,
        "post_type": 1,
        "posts_count": 6,
        "updated_at": "2024-02-09T16:32:00.560Z",
        "reply_count": 1,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 5,
        "reads": 130,
        "readers_count": 129,
        "score": 56.0,
        "yours": false,
        "topic_id": 7091,
        "topic_slug": "dpi-%D0%B7%D0%B0%D1%89%D0%B8%D1%89%D0%B0%D0%B5%D1%82%D1%81%D1%8F-%D0%BE%D1%82-%D0%BE%D0%B1%D0%BC%D0%B0%D0%BD%D0%B0-%D1%81%D0%B5%D0%B1%D1%8F",
        "display_username": "",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 3,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": "ByeDPI anti-DPI software staff",
        "title_is_group": false,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 2167,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": false,
        "wiki": false,
        "post_url": "/t/dpi-%D0%B7%D0%B0%D1%89%D0%B8%D1%89%D0%B0%D0%B5%D1%82%D1%81%D1%8F-%D0%BE%D1%82-%D0%BE%D0%B1%D0%BC%D0%B0%D0%BD%D0%B0-%D1%81%D0%B5%D0%B1%D1%8F/7091/5",
        "can_translate": false
    },
    {
        "id": 22500,
        "name": "",
        "username": "bolvan",
        "avatar_template": "/letter_avatar_proxy/v4/letter/b/8e8cbc/{size}.png",
        "created_at": "2024-02-09T13:23:36.223Z",
        "cooked": "<aside class=\"quote no-group\" data-username=\"hufrea\" data-post=\"5\" data-topic=\"7091\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://ntc.party/letter_avatar_proxy/v4/letter/h/8c91f0/48.png\" class=\"avatar\"> hufrea:</div>\n<blockquote>\n<p>Обойти можно, отправив фейковый TLS пакет:</p>\n</blockquote>\n</aside>\n<p>На том провайдере это не работало.<br>\nblockcheck от zapret не выдавал ни одной рабочей стратегии на https<br>\nи только разбиение на 1 байте дало результат.<br>\nЭто должно быть или ошибка в знаках сравнения в алгоритме DPI, или реакция на первые 2 байта 16 03, точнее на их отсутствие в первом пакете<br>\nНо вопрос остается открытым с какой целью это было сделано, сделано ли это на ТСПУ, и если да, то почему не везде, почему только на cloudflare и только на части диапазонов.<br>\nКакие-то тестилки, которые забыли выключить, а правая рука забыла, что делала левая 2 года назад , так и потонув в бюрократическом омуте ?</p>",
        "post_number": 6,
        "post_type": 1,
        "posts_count": 6,
        "updated_at": "2024-02-09T13:28:15.819Z",
        "reply_count": 0,
        "reply_to_post_number": 5,
        "quote_count": 1,
        "incoming_link_count": 7,
        "reads": 120,
        "readers_count": 119,
        "score": 59.0,
        "yours": false,
        "topic_id": 7091,
        "topic_slug": "dpi-%D0%B7%D0%B0%D1%89%D0%B8%D1%89%D0%B0%D0%B5%D1%82%D1%81%D1%8F-%D0%BE%D1%82-%D0%BE%D0%B1%D0%BC%D0%B0%D0%BD%D0%B0-%D1%81%D0%B5%D0%B1%D1%8F",
        "display_username": "",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 2,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": "Zapret anti-DPI software staff",
        "title_is_group": false,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": true,
        "admin": false,
        "staff": true,
        "user_id": 19,
        "hidden": false,
        "trust_level": 3,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": false,
        "wiki": false,
        "post_url": "/t/dpi-%D0%B7%D0%B0%D1%89%D0%B8%D1%89%D0%B0%D0%B5%D1%82%D1%81%D1%8F-%D0%BE%D1%82-%D0%BE%D0%B1%D0%BC%D0%B0%D0%BD%D0%B0-%D1%81%D0%B5%D0%B1%D1%8F/7091/6",
        "can_translate": false
    }
]