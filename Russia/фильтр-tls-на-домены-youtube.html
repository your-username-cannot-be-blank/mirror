
    <html>
      <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <style>
    th, td {
      border: 1px solid black;
      border-collapse: collapse;
    }
    th, td {
      word-wrap: break-word;
      padding: 5px;
    }
    table {
      width: 100%;
      max-width: 100%;
      border: 1px solid black;
      border-collapse: collapse;
      table-layout: fixed;
      word-wrap: break-word
    }
    code {
      word-wrap: break-word;
    }
    pre {
        white-space: pre-wrap;
    }
    </style>
        <title>фильтр-tls-на-домены-youtube</title>
      </head>
      <body>
        <table border="1" width="100%" cellpadding="5">
          <tr>
            <th style="width: 10%;">Ник</th>
            <th>Пост</th>
            <th style="width: 10%;">Дата</th>
          </tr>
    <tr><td>ValdikSS</td><td><p>В проблемах к альтернативному youtube-плееру NewPipe для Android пишут, что плеер перестал работать в России.</p>
<aside class="onebox githubissue" data-onebox-src="https://github.com/TeamNewPipe/NewPipe/issues/7114">
  <header class="source">

      <a href="https://github.com/TeamNewPipe/NewPipe/issues/7114" target="_blank" rel="noopener">github.com/TeamNewPipe/NewPipe</a>
  </header>

  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Issue" data-github-private-repo="false">
	  <svg width="60" height="60" class="github-icon" viewBox="0 0 14 16" aria-hidden="true"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="https://github.com/TeamNewPipe/NewPipe/issues/7114" target="_blank" rel="noopener">Newpipe (Youtube) not working in Russia (but official YT app works)</a>
    </h4>

    <div class="github-info">
      <div class="date">
        opened <span class="discourse-local-date" data-format="ll" data-date="2021-09-15" data-time="20:54:56" data-timezone="UTC">08:54PM - 15 Sep 21 UTC</span>
      </div>

        <div class="date">
          closed <span class="discourse-local-date" data-format="ll" data-date="2021-09-21" data-time="20:10:53" data-timezone="UTC">08:10PM - 21 Sep 21 UTC</span>
        </div>

      <div class="user">
        <a href="https://github.com/azat11" target="_blank" rel="noopener">
          <img alt="azat11" src="фильтр-tls-на-домены-youtube/26145d82a9a4e590f9e0c93b5325168b056812c8.png" class="onebox-avatar-inline" width="20" height="20" data-dominant-color="AFDED7">
          azat11
        </a>
      </div>
    </div>

    <div class="labels">
        <span style="display:inline-block;margin-top:2px;background-color: #B8B8B8;padding: 2px;border-radius: 4px;color: #fff;margin-left: 3px;">
          youtube
        </span>
    </div>
  </div>
</div>

  <div class="github-row">
    <p class="github-body-container">&lt;!--
Oh no, a bug! It happens. Thanks for reporting an issue with NewPipe. To ma<span class="show-more-container"><a href="" rel="noopener" class="show-more">…</a></span><span class="excerpt hidden">ke it easier for us to help you please enter detailed information in the template we have provided below. If a section isn't relevant, just delete it, though it would be helpful to still provide as much detail as possible.
--&gt;





### Checklist


- [x] I am using the latest version - 0.21.9 
- [x] I checked, but didn't find any duplicates (open OR closed) of this issue in the repo. 
- [x] I have read the contribution guidelines given at https://github.com/TeamNewPipe/NewPipe/blob/HEAD/.github/CONTRIBUTING.md.
- [x] This issue contains only one bug. I will open one issue for every bug report I want to file.

### Steps to reproduce the bug
&lt;!--
1. Go to '...'
2. Press on '....'
3. Swipe down to '....'
--&gt;
1. Open app
2. Try to search or open anything from history, and it's loading endlessly





### Actual behavior

Nothing loads. Tried reinstalling, nothing changes.


### Expected behavior

Everytrhing should load.


### Screenshots/Screen recordings

https://ibb.co/d29FXVt




### Logs



## Exception
* __User Action:__ searched
* __Request:__ lemmino
* __Content Country:__ US
* __Content Language:__ en-US
* __App Language:__ en_US
* __Service:__ YouTube
* __Version:__ 0.21.9
* __OS:__ Linux Android 6.0.1 - 23
&lt;details&gt;&lt;summary&gt;&lt;b&gt;Crash log &lt;/b&gt;&lt;/summary&gt;&lt;p&gt;

```
java.net.ConnectException: Failed to connect to www.youtube.com/2a00:1450:4010:c05::c6:443
	at okhttp3.internal.connection.RealConnection.connectSocket(RealConnection.java:249)
	at okhttp3.internal.connection.RealConnection.connect(RealConnection.java:167)
	at okhttp3.internal.connection.StreamAllocation.findConnection(StreamAllocation.java:258)
	at okhttp3.internal.connection.StreamAllocation.findHealthyConnection(StreamAllocation.java:135)
	at okhttp3.internal.connection.StreamAllocation.newStream(StreamAllocation.java:114)
	at okhttp3.internal.connection.ConnectInterceptor.intercept(ConnectInterceptor.java:42)
	at okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.java:147)
	at okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.java:121)
	at okhttp3.internal.cache.CacheInterceptor.intercept(CacheInterceptor.java:93)
	at okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.java:147)
	at okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.java:121)
	at okhttp3.internal.http.BridgeInterceptor.intercept(BridgeInterceptor.java:93)
	at okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.java:147)
	at okhttp3.internal.http.RetryAndFollowUpInterceptor.intercept(RetryAndFollowUpInterceptor.java:127)
	at okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.java:147)
	at okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.java:121)
	at okhttp3.RealCall.getResponseWithInterceptorChain(RealCall.java:257)
	at okhttp3.RealCall.execute(RealCall.java:93)
	at org.schabi.newpipe.DownloaderImpl.execute(DownloaderImpl.java:264)
	at org.schabi.newpipe.extractor.downloader.Downloader.post(Downloader.java:131)
	at org.schabi.newpipe.extractor.downloader.Downloader.post(Downloader.java:114)
	at org.schabi.newpipe.extractor.services.youtube.YoutubeParsingHelper.areHardcodedClientVersionAndKeyValid(YoutubeParsingHelper.java:342)
	at org.schabi.newpipe.extractor.services.youtube.YoutubeParsingHelper.getClientVersion(YoutubeParsingHelper.java:429)
	at org.schabi.newpipe.extractor.services.youtube.YoutubeParsingHelper.prepareDesktopJsonBuilder(YoutubeParsingHelper.java:814)
	at org.schabi.newpipe.extractor.services.youtube.extractors.YoutubeSearchExtractor.onFetchPage(YoutubeSearchExtractor.java:73)
	at org.schabi.newpipe.extractor.Extractor.fetchPage(Extractor.java:54)
	at org.schabi.newpipe.extractor.search.SearchInfo.getInfo(SearchInfo.java:29)
	at org.schabi.newpipe.util.ExtractorHelper.lambda$searchFor$0(ExtractorHelper.java:81)
	at org.schabi.newpipe.util.-$$Lambda$ExtractorHelper$qyxpuXgomWa-cbONQns-pd7zxm0.call(lambda)
	at io.reactivex.rxjava3.internal.operators.single.SingleFromCallable.subscribeActual(SingleFromCallable.java:43)
	at io.reactivex.rxjava3.core.Single.subscribe(Single.java:4813)
	at io.reactivex.rxjava3.internal.operators.single.SingleSubscribeOn$SubscribeOnObserver.run(SingleSubscribeOn.java:89)
	at io.reactivex.rxjava3.core.Scheduler$DisposeTask.run(Scheduler.java:614)
	at io.reactivex.rxjava3.internal.schedulers.ScheduledRunnable.run(ScheduledRunnable.java:65)
	at io.reactivex.rxjava3.internal.schedulers.ScheduledRunnable.call(ScheduledRunnable.java:56)
	at java.util.concurrent.FutureTask.run(FutureTask.java:237)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:269)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1113)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:588)
	at java.lang.Thread.run(Thread.java:818)
Caused by: java.net.ConnectException: failed to connect to www.youtube.com/2a00:1450:4010:c05::c6 (port 443) after 10000ms: isConnected failed: ENETUNREACH (Network is unreachable)
	at libcore.io.IoBridge.isConnected(IoBridge.java:234)
	at libcore.io.IoBridge.connectErrno(IoBridge.java:171)
	at libcore.io.IoBridge.connect(IoBridge.java:122)
	at java.net.PlainSocketImpl.connect(PlainSocketImpl.java:183)
	at java.net.PlainSocketImpl.connect(PlainSocketImpl.java:452)
	at java.net.Socket.connect(Socket.java:884)
	at okhttp3.internal.platform.AndroidPlatform.connectSocket(AndroidPlatform.java:73)
	at okhttp3.internal.connection.RealConnection.connectSocket(RealConnection.java:247)
	... 39 more
Caused by: android.system.ErrnoException: isConnected failed: ENETUNREACH (Network is unreachable)
	at libcore.io.IoBridge.isConnected(IoBridge.java:223)
	... 46 more

```
&lt;/details&gt;
&lt;hr&gt;





### Device info

 - Android version/Custom ROM version: CyanogenMod 13.1
 - Device model: OnePlus One</span></p>
  </div>

  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

<p><a href="https://github.com/TeamNewPipe/NewPipe/issues/7114#issuecomment-920816603">Последний комментарий</a> с исправлением кода намекает, что на ТСПУ внедрен какой-то фильтр TLS, не полностью совместимый со всем ПО.<br>
Быть может, проблема в отсутствии SNI, а может и в чём-то другом. Жду PCAP’ов от пользователей.</p></td><td>2021-09-16T12:17:18.361Z</td></tr><tr><td>ValdikSS</td><td><p>Это действительно какой-то фильтр TLS.</p>
<p><a class="attachment" href="фильтр-tls-на-домены-youtube/iGGpMi9NKrDQ241xpQTZRBRSmgF.zip">newpipe_youtube_notworking.zip</a> (21.6 KB)<br>
<a class="attachment" href="фильтр-tls-на-домены-youtube/bCdfUdgZ9p5p6hZuNnutJC2qYe8.zip">termux_curl_youtube_working.zip</a> (1.7 MB)</p>
<p>Домен <code>www.youtube.com</code> резолвится в <code>173.194.220.198</code>, но в случае NewPipe с сервера не приходит ответ на ClientHello.<br>
Запрос к <code>https://www.youtube.com</code> на тот же IP-адрес через cURL работает без проблем.</p></td><td>2021-09-16T12:33:25.199Z</td></tr><tr><td>ValdikSS</td><td><p>Еще один PCAP-файл, присланный пользователем программы.</p>
<p>По сообщениям пользователей, смена DNS возвращает работоспособность программе, предположительно, из-за другого IP-адреса домена <code>www.youtube.com</code> — фильтр включён с ограничением по адресу.</p>
<p><a class="attachment" href="фильтр-tls-на-домены-youtube/perXE1HBskuWgjkNTrVE8ZcMQre.zip">NewPipe_dns_issue.zip</a> (1.2 KB)</p></td><td>2021-09-16T12:36:25.945Z</td></tr><tr><td>ValdikSS</td><td><p><a href="https://github.com/TeamNewPipe/NewPipe/issues/7114#issuecomment-920574931">Comment</a></p>
<blockquote>
<p>Phone A<br>
× not working using mobile data (Beeline)<br>
× not working using wifi wired connection (<a href="http://Dom.ru">Dom.ru</a>)</p>
<p>Phone B<br>
✓ working using mobile data (Yota)<br>
× not working using wifi wired connection (<a href="http://Dom.ru">Dom.ru</a>)</p>
<p>When I switch to mobile data (Yota), request channel list or video, it works like it should.<br>
After that if I switch back to wi-fi (<a href="http://Dom.ru">Dom.ru</a>) it keeps working for some time and then stops loading anything again. In one case it worked for about 1 hour, in other for about 30 minutes</p>
</blockquote></td><td>2021-09-16T12:47:07.272Z</td></tr><tr><td>ValdikSS</td><td><p>Команда для проверки:</p>
<pre><code class="lang-auto">echo "1603010200010001fc0303b8fcb545209f995728937006732b2317cac1e7d265623198acdde74d267d9c68205bab4ebc80ebd23b030380212470f549430f8892e37be79ac1f682b52ac25626001e130113021303c02bc02ccca9c02fc030cca8c013c014009c009d002f00350100019500000014001200000f7777772e796f75747562652e636f6d00170000ff01000100000a00080006001d00170018000b00020100002300000010000e000c02683208687474702f312e31000500050100000000000d00140012040308040401050308050501080606010201003300260024001d0020a2ddf4a423d52380e4dbdbd817c8e4ebb714d39961dd144dfcaa9553c2ae0367002d00020101002b0009080304030303020301001500ea000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000" | xxd -ps -r | nc -v 173.194.220.198 443 &gt; /dev/null
</code></pre></td><td>2021-09-16T13:02:50.436Z</td></tr><tr><td>ValdikSS</td><td><p>This is filter works specifically for <code>www.youtube.com</code> domain. Changing SNI to anything other (even <code>wxw.youtube.com</code>) opens the website again.</p></td><td>2021-09-16T13:08:38.969Z</td></tr><tr><td>ValdikSS</td><td><p>TLS filtering is done regardless of IP address.<br>
Here’s how it looks from a server perspective:<br>
<a class="attachment" href="фильтр-tls-на-домены-youtube/94JaeHOiQQoBdcAHTnJ1Gwp3XRY.zip">youtube-tspu-server.zip</a> (4.2 KB)</p>
<p>As you can see, the clients’ TLS ClientHello packet is received, but the ServerHello reply can’t be delivered. The client does not receive ServerHello. <code>www.youtube.com</code> does not work, <code>www.nottube.com</code> works.</p>
<p>NAT session teardown?</p></td><td>2021-09-16T13:37:07.043Z</td></tr><tr><td>ValdikSS</td><td><p>Фильтр настроен на блокировку комбинации TLS Cipher Suites + Supported Groups + Signature Algorithms + SNI. Удаление какого-либо из шифра в любой части, изменение порядка cipher suites или любая другая модификация приводит к доставке пакета и работоспособности сетевой связности.</p></td><td>2021-09-16T14:01:00.424Z</td></tr><tr><td>vanyaindigo</td><td><p>А для чего именно может применяться такая настройка фильтра?</p></td><td>2021-09-16T14:01:44.783Z</td></tr><tr><td>zhenyolka</td><td><p><a class="mention" href="/u/valdikss">@ValdikSS</a> и снова я)<br>
На операторе Tele2 только что заметил отвал newpipe, притом через браузер все нормально( даже <a href="http://www.youtube.com" rel="noopener nofollow ugc">www.youtube.com</a>) открывается, твой тест парой постов выше тоже нормально проходит, хотя newpipe не пашет. Странно… Попробую запустить tcpdump</p></td><td>2021-09-16T14:01:52.488Z</td></tr><tr><td>zhenyolka</td><td><p>Раз уже понятна схема блокировки, остался один вопрос: зачем так геморно и с таким паттерно? Почему нельзя просто заблочить по SNI? Или это специально для андроид клиента?</p></td><td>2021-09-16T14:02:59.496Z</td></tr><tr><td>ValdikSS</td><td><blockquote>
<p>Right now it seems like a TLS Fingerprinting to block an Android application which uses <code>www.youtube.com</code> as a domain fronting (wild guess: Navalny Android/iOS app?).</p>
</blockquote></td><td>2021-09-16T14:03:56.303Z</td></tr><tr><td>darkk(Leonid Evdokimov)</td><td><p>Seems, NewPipe’s fingerprint is quite unique. <a href="https://tlsfingerprint.io/">https://tlsfingerprint.io/</a> does not parse Client Hello from aforementioned pcaps as known fingerprint that was already observed in the campus traffic.</p></td><td>2021-09-16T14:06:52.589Z</td></tr><tr><td>zhenyolka</td><td><p>Its really useless to block NewPipe. Best candidate to block is Google’s Youtube app. Can it be something like tests or preparations for whole youtube block?</p></td><td>2021-09-16T14:11:02.826Z</td></tr><tr><td>darkk(Leonid Evdokimov)</td><td><aside class="quote no-group" data-username="ValdikSS" data-post="12" data-topic="1311">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/valdikss/48/2_2.png" class="avatar"> ValdikSS:</div>
<blockquote>
<p>wild guess: Navalny Android/iOS app</p>
</blockquote>
</aside>
<p>I have no iOS devices, but Navalny’s app (ver. 2.0, one from Google Play Market) gives a <strong>different fingerprint</strong> on my Android:</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="фильтр-tls-на-домены-youtube/a19983009ba7239e1ca54601a86d9bab68e40cff.png" data-download-href="https://ntc.party/uploads/default/a19983009ba7239e1ca54601a86d9bab68e40cff" title="image"><img src="фильтр-tls-на-домены-youtube/a19983009ba7239e1ca54601a86d9bab68e40cff_2_681x500.png" alt="image" data-base62-sha1="n3zLKh2ODlnJ4o6WRZontJabXDV" width="681" height="500" srcset="фильтр-tls-на-домены-youtube/a19983009ba7239e1ca54601a86d9bab68e40cff_2_681x500.png, фильтр-tls-на-домены-youtube/a19983009ba7239e1ca54601a86d9bab68e40cff.png 1.5x, фильтр-tls-на-домены-youtube/a19983009ba7239e1ca54601a86d9bab68e40cff.png 2x" data-dominant-color="DEE2E5"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">866×635 103 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>Fingerprints <a href="https://tlsfingerprint.io/id/f0b2b996867b6380">https://tlsfingerprint.io/id/f0b2b996867b6380</a> and <a href="https://tlsfingerprint.io/id/f278257cdf4a43aa">https://tlsfingerprint.io/id/f278257cdf4a43aa</a> seem to be related, <code>cetpmhjmdf-vizskfsved.global.ssl.fastly.net</code> is Navalny-related domain (see <code>https://archive.md/xgT57</code> for archived content).</p></td><td>2021-09-16T14:36:39.279Z</td></tr><tr><td>ValdikSS</td><td><aside class="quote no-group" data-username="darkk" data-post="13" data-topic="1311">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/darkk/48/470_2.png" class="avatar"> darkk:</div>
<blockquote>
<p>Seems, NewPipe’s fingerprint is quite unique.</p>
</blockquote>
</aside>
<p>They use okhttp3 library with <code>ConnectionSpec.MODERN_TLS.cipherSuites()</code> and 2 additional ones <a href="https://github.com/TeamNewPipe/NewPipe/blob/793b88a7d48bd6ce7b24620c94729d73448fa365/app/src/main/java/org/schabi/newpipe/DownloaderImpl.java#L112">click</a></p>
<pre><code class="lang-auto">// This will try to enable all modern CipherSuites(+2 more)
// that are supported on the device.
// Necessary because some servers (e.g. Framatube.org)
// don't support the old cipher suites.
// https://github.com/square/okhttp/issues/4053#issuecomment-402579554
final List&lt;CipherSuite&gt; cipherSuites =
        new ArrayList&lt;&gt;(ConnectionSpec.MODERN_TLS.cipherSuites());
cipherSuites.add(CipherSuite.TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA);
cipherSuites.add(CipherSuite.TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA);
final ConnectionSpec legacyTLS = new ConnectionSpec.Builder(ConnectionSpec.MODERN_TLS)
        .cipherSuites(cipherSuites.toArray(new CipherSuite[0]))
        .build();

builder.connectionSpecs(Arrays.asList(legacyTLS, ConnectionSpec.CLEARTEXT));
</code></pre>
<hr>
<h3><a name="upd-1" class="anchor" href="#upd-1"></a>UPD</h3>
<p><strong>UPD:</strong> no, they use this cipher set only in this exact case, but in general they have a common okhttp3 cipher list (without 3DES, it is probably filtered by the tls library): <a href="https://github.com/square/okhttp/blob/06644bb0507873e9a3b89d9107da537f1b140e91/okhttp/src/main/java/okhttp3/ConnectionSpec.java#L68" class="inline-onebox">okhttp/okhttp/src/main/java/okhttp3/ConnectionSpec.java at 06644bb0507873e9a3b89d9107da537f1b140e91 · square/okhttp · GitHub</a></p></td><td>2021-09-16T14:43:27.030Z</td></tr><tr><td>ValdikSS</td><td><p>I’ve made a small modification in NewPipe by replacing <code>TLS_RSA_WITH_AES_256_CBC_SHA</code> with <code>TLS_RSA_WITH_AES_128_CBC_SHA</code> in the library cipher list, and the application is now working again.</p><aside class="onebox githubissue" data-onebox-src="https://github.com/TeamNewPipe/NewPipe/issues/7114#issuecomment-921002380">
  <header class="source">

      <a href="https://github.com/TeamNewPipe/NewPipe/issues/7114#issuecomment-921002380" target="_blank" rel="noopener">github.com/TeamNewPipe/NewPipe</a>
  </header>

  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Issue" data-github-private-repo="false">
	  <svg width="60" height="60" class="github-icon" viewBox="0 0 14 16" aria-hidden="true"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="https://github.com/TeamNewPipe/NewPipe/issues/7114#issuecomment-921002380" target="_blank" rel="noopener">Newpipe (Youtube) not working in Russia (but official YT app works)</a>
    </h4>

    <div class="github-info">
      <div class="date">
        opened <span class="discourse-local-date" data-format="ll" data-date="2021-09-15" data-time="20:54:56" data-timezone="UTC">08:54PM - 15 Sep 21 UTC</span>
      </div>

        <div class="date">
          closed <span class="discourse-local-date" data-format="ll" data-date="2021-09-21" data-time="20:10:53" data-timezone="UTC">08:10PM - 21 Sep 21 UTC</span>
        </div>

      <div class="user">
        <a href="https://github.com/azat11" target="_blank" rel="noopener">
          <img alt="azat11" src="фильтр-tls-на-домены-youtube/26145d82a9a4e590f9e0c93b5325168b056812c8.png" class="onebox-avatar-inline" width="20" height="20" data-dominant-color="AFDED7">
          azat11
        </a>
      </div>
    </div>

    <div class="labels">
        <span style="display:inline-block;margin-top:2px;background-color: #B8B8B8;padding: 2px;border-radius: 4px;color: #fff;margin-left: 3px;">
          youtube
        </span>
    </div>
  </div>
</div>

  <div class="github-row">
    <p class="github-body-container">&lt;!--
Oh no, a bug! It happens. Thanks for reporting an issue with NewPipe. To ma<span class="show-more-container"><a href="" rel="noopener" class="show-more">…</a></span><span class="excerpt hidden">ke it easier for us to help you please enter detailed information in the template we have provided below. If a section isn't relevant, just delete it, though it would be helpful to still provide as much detail as possible.
--&gt;





### Checklist


- [x] I am using the latest version - 0.21.9 
- [x] I checked, but didn't find any duplicates (open OR closed) of this issue in the repo. 
- [x] I have read the contribution guidelines given at https://github.com/TeamNewPipe/NewPipe/blob/HEAD/.github/CONTRIBUTING.md.
- [x] This issue contains only one bug. I will open one issue for every bug report I want to file.

### Steps to reproduce the bug
&lt;!--
1. Go to '...'
2. Press on '....'
3. Swipe down to '....'
--&gt;
1. Open app
2. Try to search or open anything from history, and it's loading endlessly





### Actual behavior

Nothing loads. Tried reinstalling, nothing changes.


### Expected behavior

Everytrhing should load.


### Screenshots/Screen recordings

https://ibb.co/d29FXVt




### Logs



## Exception
* __User Action:__ searched
* __Request:__ lemmino
* __Content Country:__ US
* __Content Language:__ en-US
* __App Language:__ en_US
* __Service:__ YouTube
* __Version:__ 0.21.9
* __OS:__ Linux Android 6.0.1 - 23
&lt;details&gt;&lt;summary&gt;&lt;b&gt;Crash log &lt;/b&gt;&lt;/summary&gt;&lt;p&gt;

```
java.net.ConnectException: Failed to connect to www.youtube.com/2a00:1450:4010:c05::c6:443
	at okhttp3.internal.connection.RealConnection.connectSocket(RealConnection.java:249)
	at okhttp3.internal.connection.RealConnection.connect(RealConnection.java:167)
	at okhttp3.internal.connection.StreamAllocation.findConnection(StreamAllocation.java:258)
	at okhttp3.internal.connection.StreamAllocation.findHealthyConnection(StreamAllocation.java:135)
	at okhttp3.internal.connection.StreamAllocation.newStream(StreamAllocation.java:114)
	at okhttp3.internal.connection.ConnectInterceptor.intercept(ConnectInterceptor.java:42)
	at okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.java:147)
	at okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.java:121)
	at okhttp3.internal.cache.CacheInterceptor.intercept(CacheInterceptor.java:93)
	at okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.java:147)
	at okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.java:121)
	at okhttp3.internal.http.BridgeInterceptor.intercept(BridgeInterceptor.java:93)
	at okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.java:147)
	at okhttp3.internal.http.RetryAndFollowUpInterceptor.intercept(RetryAndFollowUpInterceptor.java:127)
	at okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.java:147)
	at okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.java:121)
	at okhttp3.RealCall.getResponseWithInterceptorChain(RealCall.java:257)
	at okhttp3.RealCall.execute(RealCall.java:93)
	at org.schabi.newpipe.DownloaderImpl.execute(DownloaderImpl.java:264)
	at org.schabi.newpipe.extractor.downloader.Downloader.post(Downloader.java:131)
	at org.schabi.newpipe.extractor.downloader.Downloader.post(Downloader.java:114)
	at org.schabi.newpipe.extractor.services.youtube.YoutubeParsingHelper.areHardcodedClientVersionAndKeyValid(YoutubeParsingHelper.java:342)
	at org.schabi.newpipe.extractor.services.youtube.YoutubeParsingHelper.getClientVersion(YoutubeParsingHelper.java:429)
	at org.schabi.newpipe.extractor.services.youtube.YoutubeParsingHelper.prepareDesktopJsonBuilder(YoutubeParsingHelper.java:814)
	at org.schabi.newpipe.extractor.services.youtube.extractors.YoutubeSearchExtractor.onFetchPage(YoutubeSearchExtractor.java:73)
	at org.schabi.newpipe.extractor.Extractor.fetchPage(Extractor.java:54)
	at org.schabi.newpipe.extractor.search.SearchInfo.getInfo(SearchInfo.java:29)
	at org.schabi.newpipe.util.ExtractorHelper.lambda$searchFor$0(ExtractorHelper.java:81)
	at org.schabi.newpipe.util.-$$Lambda$ExtractorHelper$qyxpuXgomWa-cbONQns-pd7zxm0.call(lambda)
	at io.reactivex.rxjava3.internal.operators.single.SingleFromCallable.subscribeActual(SingleFromCallable.java:43)
	at io.reactivex.rxjava3.core.Single.subscribe(Single.java:4813)
	at io.reactivex.rxjava3.internal.operators.single.SingleSubscribeOn$SubscribeOnObserver.run(SingleSubscribeOn.java:89)
	at io.reactivex.rxjava3.core.Scheduler$DisposeTask.run(Scheduler.java:614)
	at io.reactivex.rxjava3.internal.schedulers.ScheduledRunnable.run(ScheduledRunnable.java:65)
	at io.reactivex.rxjava3.internal.schedulers.ScheduledRunnable.call(ScheduledRunnable.java:56)
	at java.util.concurrent.FutureTask.run(FutureTask.java:237)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:269)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1113)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:588)
	at java.lang.Thread.run(Thread.java:818)
Caused by: java.net.ConnectException: failed to connect to www.youtube.com/2a00:1450:4010:c05::c6 (port 443) after 10000ms: isConnected failed: ENETUNREACH (Network is unreachable)
	at libcore.io.IoBridge.isConnected(IoBridge.java:234)
	at libcore.io.IoBridge.connectErrno(IoBridge.java:171)
	at libcore.io.IoBridge.connect(IoBridge.java:122)
	at java.net.PlainSocketImpl.connect(PlainSocketImpl.java:183)
	at java.net.PlainSocketImpl.connect(PlainSocketImpl.java:452)
	at java.net.Socket.connect(Socket.java:884)
	at okhttp3.internal.platform.AndroidPlatform.connectSocket(AndroidPlatform.java:73)
	at okhttp3.internal.connection.RealConnection.connectSocket(RealConnection.java:247)
	... 39 more
Caused by: android.system.ErrnoException: isConnected failed: ENETUNREACH (Network is unreachable)
	at libcore.io.IoBridge.isConnected(IoBridge.java:223)
	... 46 more

```
&lt;/details&gt;
&lt;hr&gt;





### Device info

 - Android version/Custom ROM version: CyanogenMod 13.1
 - Device model: OnePlus One</span></p>
  </div>

  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>
</td><td>2021-09-16T15:28:55.574Z</td></tr><tr><td>Alex01d(Alex)</td><td><p>SmartTubeNext тоже перестал работать, по крайней мере, с теле2.</p></td><td>2021-09-16T15:32:17.010Z</td></tr><tr><td>ValdikSS</td><td><aside class="quote no-group" data-username="darkk" data-post="13" data-topic="1311">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/darkk/48/470_2.png" class="avatar"> darkk:</div>
<blockquote>
<p>Seems, NewPipe’s fingerprint is quite unique.</p>
</blockquote>
</aside>
<p><strong>UPD:</strong> no, they use this cipher set only in this exact case, but in general they have a common okhttp3 cipher list (without 3DES, it is probably filtered by the tls library): <a href="https://github.com/square/okhttp/blob/06644bb0507873e9a3b89d9107da537f1b140e91/okhttp/src/main/java/okhttp3/ConnectionSpec.java#L68" class="inline-onebox">okhttp/okhttp/src/main/java/okhttp3/ConnectionSpec.java at 06644bb0507873e9a3b89d9107da537f1b140e91 · square/okhttp · GitHub</a></p>
<p>So <em>they</em> block HTTPS requests to <code>www.youtube.com</code> via okhttp library.</p></td><td>2021-09-16T15:47:23.618Z</td></tr><tr><td>ValdikSS</td><td><p>Hint: this block could be circumvented by changing SNI case. <code>wWw.youtube.com</code> works.<br>
Hint: other domains, such as <code>docs.google.com</code>, are not blocked with this TLS fingerprint.</p></td><td>2021-09-16T15:54:32.836Z</td></tr><tr><td>ValdikSS</td><td><p>Фильтр убран. Что это такое было — непонятно, у меня нет даже предположений.</p></td><td>2021-09-18T18:53:33.861Z</td></tr><tr><td>zhenyolka</td><td><p>Я тут на днях поизучал последнюю версию приложения Навальный. Okhttp обнаружить не смог. Более того, оно максимуи, что пытается сделать, так это обратится к DnS.GooGle и, вроде как, не использует домены youtube. Блокировки пытается обойти через newnode, а это битторенты и прочие данные по udp протоколу. Соответственно, эта приложуха тут не причем.<br>
При всем при этом, очевидно, это не случайный фильтр и для чего-то он тестировался. Осталось понять, зачем? Другой вопрос, что фильтр убрали, когда гугл согласился сотрудничать и удалить видео с канала Навального, только причем тут newpipe, который, так и так, мало кто использует, а те, кто используют, знают про VPN?</p></td><td>2021-09-18T19:48:20.744Z</td></tr><tr><td>ValdikSS</td><td><p>У меня два предположения, высосанных из пальца:</p>
<ol>
<li>Проводилась демонстрация возможности блокировки конкретной <em>программы</em>, а не сервиса: «Смотрите, в браузере работает, в официальной программе работает, а в NewPipe — не работает».</li>
<li>Перепутали NewNode и NewPipe.</li>
</ol></td><td>2021-09-18T20:08:46.685Z</td></tr><tr><td>tango</td><td><aside class="quote no-group" data-username="zhenyolka" data-post="22" data-topic="1311">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/z/b77776/48.png" class="avatar"> zhenyolka:</div>
<blockquote>
<p>Okhttp обнаружить не смог. Более того, оно максимуи, что пытается сделать, так это обратится к DnS.GooGle и, вроде как, не использует домены youtube.</p>
</blockquote>
</aside>
<p>I had a quick look at an APK I found at <a href="https://www.apkmonk.com/download-app/com.navalny.blog/4_com.navalny.blog_2021-08-15.apk/">https://www.apkmonk.com/download-app/com.navalny.blog/4_com.navalny.blog_2021-08-15.apk/</a> (version 2.0, dated 2021-08-14).</p>
<ol>
<li>There are many references to “OkHttp” in the code. I see <code>okhttp3.</code> which matches <a href="https://ntc.party/t/tls-youtube/1311/16">the major version reported earlier</a>; however there is also <code>okhttp/4.6.0</code>. (Well, looking at the <a href="https://square.github.io/okhttp/changelog/">changelog</a>, it seems these numbers do not have to match and okhttp3 is the correct package name even for later versions.)</li>
<li>In the disassembled code (smali/s/k.smali), there is a list of 4 strings:<pre data-code-wrap="java"><code class="lang-java">{"dns.google", "1.1.1.1", "1.0.0.1", "doh.opendns.com"}
</code></pre>
</li>
<li>The string <code>youtube</code> does not appear.</li>
</ol>
<pre><code class="lang-plaintext">$ apktool d com.navalny.blog_2021-08-15.apk
$ cd com.navalny.blog_2021-08-15

$ grep -ir okhttp
smali/io/ktor/client/engine/okhttp/OkHttpEngineContainer.smali:.class public final Lio/ktor/client/engine/okhttp/OkHttpEngineContainer;
smali/io/ktor/client/engine/okhttp/OkHttpEngineContainer.smali:    const-string v0, "OkHttp"
smali/n/b/k/a.smali:    const-string v4, "OkHttp"
smali/o/y.smali:    const-string v0, "null cannot be cast to non-null type kotlin.collections.List&lt;okhttp3.Interceptor?&gt;"
smali/o/y.smali:    const-string v1, "okHttpClient"
smali/o/i0/c.smali:    const-string v2, "OkHttpClient::class.java.name"
smali/o/i0/c.smali:    const-string v2, "okhttp3."
smali/o/i0/h/e.smali:    sget-object v2, Lokhttp3/internal/publicsuffix/PublicSuffixDatabase;-&gt;d:Lokhttp3/internal/publicsuffix/PublicSuffixDatabase$a;
smali/o/i0/h/e.smali:    sget-object v2, Lokhttp3/internal/publicsuffix/PublicSuffixDatabase;-&gt;c:Lokhttp3/internal/publicsuffix/PublicSuffixDatabase;
smali/o/i0/h/e.smali:    invoke-virtual {v2, v5}, Lokhttp3/internal/publicsuffix/PublicSuffixDatabase;-&gt;a(Ljava/lang/String;)Ljava/lang/String;
smali/o/i0/h/a.smali:    const-string v11, "okhttp/4.6.0"
... many more ...

$ grep -ir -F -A 32 dns.google
smali/s/k.smali:    const-string v7, "dns.google"
smali/s/k.smali-
smali/s/k.smali-    invoke-direct {v6, v7, v4}, Li/g;-&gt;&lt;init&gt;(Ljava/lang/String;Lb/a/a/e;)V
smali/s/k.smali-
smali/s/k.smali-    aput-object v6, v5, v21
smali/s/k.smali-
smali/s/k.smali-    new-instance v6, Li/g;
smali/s/k.smali-
smali/s/k.smali-    const-string v7, "1.1.1.1"
smali/s/k.smali-
smali/s/k.smali-    invoke-direct {v6, v7, v4}, Li/g;-&gt;&lt;init&gt;(Ljava/lang/String;Lb/a/a/e;)V
smali/s/k.smali-
smali/s/k.smali-    aput-object v6, v5, v20
smali/s/k.smali-
smali/s/k.smali-    new-instance v6, Li/g;
smali/s/k.smali-
smali/s/k.smali-    const-string v7, "1.0.0.1"
smali/s/k.smali-
smali/s/k.smali-    invoke-direct {v6, v7, v4}, Li/g;-&gt;&lt;init&gt;(Ljava/lang/String;Lb/a/a/e;)V
smali/s/k.smali-
smali/s/k.smali-    const/4 v7, 0x2
smali/s/k.smali-
smali/s/k.smali-    aput-object v6, v5, v7
smali/s/k.smali-
smali/s/k.smali-    new-instance v6, Li/g;
smali/s/k.smali-
smali/s/k.smali-    const-string v7, "doh.opendns.com"
smali/s/k.smali-
smali/s/k.smali-    invoke-direct {v6, v7, v4}, Li/g;-&gt;&lt;init&gt;(Ljava/lang/String;Lb/a/a/e;)V
smali/s/k.smali-
smali/s/k.smali-    const/4 v4, 0x3
smali/s/k.smali-
smali/s/k.smali-    aput-object v6, v5, v4

$ grep -ir youtube
</code></pre></td><td>2021-09-18T21:17:19.972Z</td></tr><tr><td>ValdikSS</td><td><p>The filter was configured for SNI check. It wasn’t IP-bound.<br>
I also edited SNI in the captured packet to <code>docs.google.com</code>, and it was delivered successfully. Haven’t tried other SNIs.</p></td><td>2021-09-18T21:34:54.868Z</td></tr><tr><td>Neko</td><td><p>Проблема с NewPipe встречалась мне только один раз.</p>
<p>Регулярно встречаю ошибки буферизации при воспроизведении Ютуба с помощью mpv + youtube-dl со следующими ошибками в командной строке:</p>
<pre><code class="lang-auto">    ffmpeg: tls: Error in the pull function.
    ffmpeg: https: Will reconnect at 262144 in 0 second(s), error=Input/output error.
</code></pre>
<p>Получается, ffmpeg тоже блокируют.</p></td><td>2021-09-19T00:33:13.578Z</td></tr><tr><td>Dredd</td><td><p>А патченная версия NewPipe от ValdikSS’a не пишет ли куда-либо обширные логи ? Смущает слово"debug" в названии. Отладка в данном вопросе дело конечно нужное, но для меня этот фикс проблему решил и хотелось бы обойтись без лишних логов, которые будут захламлять память.</p></td><td>2021-09-19T04:34:51.044Z</td></tr><tr><td>darkk(Leonid Evdokimov)</td><td><aside class="quote no-group" data-username="tango" data-post="24" data-topic="1311">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/t/e36b37/48.png" class="avatar"> tango:</div>
<blockquote>
<p>The string <code>youtube</code> does not appear.</p>
</blockquote>
</aside>
<p>The APK <a href="https://github.com/smartvotedocs/votesmart2021/releases/tag/android-app">at GitHub</a> claims to be v2.2 and it mentions <code>www.youtube.com</code>. But the TLS fingerprint of the traffic produced by that APK is slightly different from NewPipe’s fingerprint as well. I take NewPipe’s fingerprint from the aforeposted pcaps.</p>
<p>v2.2 from apkmonk also mentions youtube, but the binary differs from GitHub release.</p></td><td>2021-09-24T21:56:08.886Z</td></tr><tr><td>tango</td><td><aside class="quote no-group" data-username="darkk" data-post="28" data-topic="1311">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/darkk/48/470_2.png" class="avatar"> darkk:</div>
<blockquote>
<p>The APK <a href="https://github.com/smartvotedocs/votesmart2021/releases/tag/android-app">at GitHub </a> claims to be v2.2 and it mentions <code>www.youtube.com</code>. But the TLS fingerprint of the traffic produced by that APK is slightly different from NewPipe’s fingerprint as well. I take NewPipe’s fingerprint from the aforeposted pcaps.</p>
</blockquote>
</aside>
<p>Thanks, great find. I confirm that I find “<a href="http://www.youtube.com">www.youtube.com</a>” in the 2.2 APK.</p>
<pre><code class="lang-plaintext">smali/s/k.smali:    const-string v11, "www.youtube.com"
</code></pre>
<p>Also, the list of DNS resolver names removes “1.1.1.1”.</p>
<pre data-code-wrap="java"><code class="lang-java">{"dns.google", "1.0.0.1", "doh.opendns.com"}
</code></pre>
<blockquote>
<p>v2.2 from apkmonk also mentions youtube, but the binary differs from GitHub release.</p>
</blockquote>
<p>For me, the two binaries are the same.</p>
<pre><code class="lang-plaintext">$ sha256sum *.apk
58913378ea52b6effa28117f201ae73f4ae473fd2aa965627f7b1c07b4350c20  androidApp-release-69_2-2.apk
58913378ea52b6effa28117f201ae73f4ae473fd2aa965627f7b1c07b4350c20  com.navalny.blog_2021-09-14.apk
</code></pre></td><td>2021-09-25T18:10:35.443Z</td></tr><tr><td>darkk(Leonid Evdokimov)</td><td><aside class="quote no-group" data-username="tango" data-post="29" data-topic="1311">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/t/e36b37/48.png" class="avatar"> tango:</div>
<blockquote>
<p>For me, the two binaries are the same.</p>
</blockquote>
</aside>
<p>Indeed, my bad. Seems, I’ve confused the apk from apkmonk with <a href="https://apkcombo.com/navalnyj/com.navalny.blog/">the v2.2 apk from apkcombo.com</a> having sha256 <code>3a2dc36dcaac20e8d52ac91b6290508a3c3209dc4bd81f91b86924304122c699</code>.</p></td><td>2021-09-25T21:45:35.589Z</td></tr>
    </table>
      </body>
    </html>