
    <html>
      <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <style>
    th, td {
      border: 1px solid black;
      border-collapse: collapse;
    }
    th, td {
      word-wrap: break-word;
      padding: 5px;
    }
    table {
      width: 100%;
      max-width: 100%;
      border: 1px solid black;
      border-collapse: collapse;
      table-layout: fixed;
      word-wrap: break-word
    }
    code {
      word-wrap: break-word;
    }
    pre {
        white-space: pre-wrap;
    }
    </style>
        <title>google-cloud-functions</title>
      </head>
      <body>
        <table border="1" width="100%" cellpadding="5">
          <tr>
            <th style="width: 10%;">Ник</th>
            <th>Пост</th>
            <th style="width: 10%;">Дата</th>
          </tr>
    <tr><td>murka(Danil Shaymurzin)</td><td><p>Похоже РКН начал блокировать сервисы Google, столкнулись с отключением сервиса Google Cloud Functions на территории РФ, при использовании прокси или VPN сервис стабильно отвечает.</p>
<p>Для проверки сделал функцию-пустышку на базе данного сервиса, который возвращает <code>{ status: 'ok' }</code> при успешном выполнении.</p>
<p>Локации (если нужен другой регион из списка <a href="https://cloud.google.com/functions/docs/locations" rel="noopener nofollow ugc">Cloud Functions Locations</a>, то пишите, добавлю)<br>
Iowa (USA): <a href="https://us-central1-roskomnadzor-org.cloudfunctions.net/status" rel="noopener nofollow ugc">https://us-central1-roskomnadzor-org.cloudfunctions.net/status</a><br>
Belgium (Europe): <a href="https://europe-west1-roskomnadzor-org.cloudfunctions.net/status" rel="noopener nofollow ugc">https://europe-west1-roskomnadzor-org.cloudfunctions.net/status</a><br>
Frankfurt (Europe): <a href="https://europe-west3-roskomnadzor-org.cloudfunctions.net/status" rel="noopener nofollow ugc">https://europe-west3-roskomnadzor-org.cloudfunctions.net/status</a></p></td><td>2022-04-16T10:06:18.230Z</td></tr><tr><td>murka(Danil Shaymurzin)</td><td><p>GlobalCheck:<br>
<div class="lightbox-wrapper"><a class="lightbox" href="google-cloud-functions/6f650baa1526322aa7269a088f0d31d54286b59f.png" data-download-href="https://ntc.party/uploads/default/6f650baa1526322aa7269a088f0d31d54286b59f" title="Снимок экрана 2022-04-16 в 15.18.34"><img src="google-cloud-functions/6f650baa1526322aa7269a088f0d31d54286b59f_2_690x308.png" alt="Снимок экрана 2022-04-16 в 15.18.34" data-base62-sha1="fTruhbDJbAOhpDChwOC8CSXORAP" width="690" height="308" srcset="google-cloud-functions/6f650baa1526322aa7269a088f0d31d54286b59f_2_690x308.png, google-cloud-functions/6f650baa1526322aa7269a088f0d31d54286b59f_2_1035x462.png 1.5x, google-cloud-functions/6f650baa1526322aa7269a088f0d31d54286b59f.png 2x" data-dominant-color="F0EAEA"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">Снимок экрана 2022-04-16 в 15.18.34</span><span class="informations">1109×496 62.4 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p></td><td>2022-04-16T10:18:50.198Z</td></tr><tr><td>ValdikSS</td><td><p>Недоступен порт 443 на IP-адресе этого домена у провайдеров с ТСПУ. То же самое, что в <a href="https://ntc.party/t/cloudflare-cdn/2245" class="inline-onebox">Не открываются некоторые сайты за Cloudflare CDN</a></p></td><td>2022-04-16T11:35:14.148Z</td></tr><tr><td>ValdikSS</td><td><p>Оба домена (обе локации) резолвятся в один IP-адрес 216.239.36.54. Здесь нет ошибки в настройке?</p></td><td>2022-04-16T13:37:14.590Z</td></tr><tr><td>murka(Danil Shaymurzin)</td><td><p>Добавил ещё одну локацию (Frankfurt, Germany) <a href="https://europe-west3-roskomnadzor-org.cloudfunctions.net" rel="noopener nofollow ugc">https://europe-west3-roskomnadzor-org.cloudfunctions.net/status</a>, также отдает 216.239.36.54</p>
<p>Ошибок в настройке нет.</p></td><td>2022-04-16T13:58:06.235Z</td></tr><tr><td>adinvadim(Vadim Kostin)</td><td><p>Сделал простой прокси сервер, чтобы на коленке быстро поднять прокси чтобы все работало.</p>
<aside class="onebox githubrepo" data-onebox-src="https://github.com/adinvadim/firebase-functions-proxy-server">
  <header class="source">

      <a href="https://github.com/adinvadim/firebase-functions-proxy-server" target="_blank" rel="noopener nofollow ugc">github.com</a>
  </header>

  <article class="onebox-body">
    <div class="github-row" data-github-private-repo="false">
  <img width="690" height="344" src="google-cloud-functions/357502b64f6727b1271a6a07bec57dd2e826e7d0_2_690x344.png" class="thumbnail" data-dominant-color="F6EEEB">

  <h3><a href="https://github.com/adinvadim/firebase-functions-proxy-server" target="_blank" rel="noopener nofollow ugc">GitHub - adinvadim/firebase-functions-proxy-server: Firebase functions proxy server</a></h3>

    <p><span class="github-repo-description">Firebase functions proxy server</span></p>
</div>

  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

<p>Поднять можно самостоятельно.</p>
<p>Вот примеры<br>
<a href="https://firebase-proxy-example.herokuapp.com/functions/us-central1/roskomnadzor-org/status" class="onebox" target="_blank" rel="noopener nofollow ugc">https://firebase-proxy-example.herokuapp.com/functions/us-central1/roskomnadzor-org/status</a><br>
<a href="https://firebase-proxy-example.herokuapp.com/functions/europe-west3/roskomnadzor-org/status" class="onebox" target="_blank" rel="noopener nofollow ugc">https://firebase-proxy-example.herokuapp.com/functions/europe-west3/roskomnadzor-org/status</a></p></td><td>2022-04-16T14:17:13.385Z</td></tr><tr><td>ValdikSS</td><td><p>Документирую: ситуация не изменилась, доступа всё так же нет:</p>
<pre><code class="lang-auto">% curl -v https://europe-west1-roskomnadzor-org.cloudfunctions.net/status -4 --max-time 10
*   Trying 216.239.36.54:443...
* After 4999ms connect time, move on!
* connect to 216.239.36.54 port 443 failed: Connection timed out
* Failed to connect to europe-west1-roskomnadzor-org.cloudfunctions.net port 443 after 5001 ms: Connection timed out
* Closing connection 0
curl: (28) Failed to connect to europe-west1-roskomnadzor-org.cloudfunctions.net port 443 after 5001 ms: Connection timed out
</code></pre></td><td>2022-04-20T18:39:13.763Z</td></tr><tr><td>murka(Danil Shaymurzin)</td><td><p>РКН начал блокировать Firebase Hosting:</p>
<p><a href="https://roskomnadzor-org.web.app/" rel="noopener nofollow ugc">https://roskomnadzor-org.web.app/</a><br>
<a href="https://roskomnadzor-org.firebaseapp.com/" rel="noopener nofollow ugc">https://roskomnadzor-org.firebaseapp.com/</a></p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="google-cloud-functions/a27e3ed49d3fb2de61791d2cdd2755e6b5a5e578.png" data-download-href="https://ntc.party/uploads/default/a27e3ed49d3fb2de61791d2cdd2755e6b5a5e578" title="image"><img src="google-cloud-functions/a27e3ed49d3fb2de61791d2cdd2755e6b5a5e578_2_690x334.png" alt="image" data-base62-sha1="nbtPrLf1v6ONefdTzYUQ8wd26j6" width="690" height="334" srcset="google-cloud-functions/a27e3ed49d3fb2de61791d2cdd2755e6b5a5e578_2_690x334.png, google-cloud-functions/a27e3ed49d3fb2de61791d2cdd2755e6b5a5e578_2_1035x501.png 1.5x, google-cloud-functions/a27e3ed49d3fb2de61791d2cdd2755e6b5a5e578.png 2x" data-dominant-color="F2EAEA"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">1120×543 62.1 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div><br>
<div class="lightbox-wrapper"><a class="lightbox" href="google-cloud-functions/997022f9276d4d660da01a42365bd5d4df81c933.png" data-download-href="https://ntc.party/uploads/default/997022f9276d4d660da01a42365bd5d4df81c933" title="image"><img src="google-cloud-functions/997022f9276d4d660da01a42365bd5d4df81c933_2_690x325.png" alt="image" data-base62-sha1="lTniSKNdEyUonQjx9r52CvJYkhR" width="690" height="325" srcset="google-cloud-functions/997022f9276d4d660da01a42365bd5d4df81c933_2_690x325.png, google-cloud-functions/997022f9276d4d660da01a42365bd5d4df81c933_2_1035x487.png 1.5x, google-cloud-functions/997022f9276d4d660da01a42365bd5d4df81c933.png 2x" data-dominant-color="F1EAEA"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">1139×538 63.9 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p></td><td>2022-04-22T12:04:28.126Z</td></tr><tr><td>ValdikSS</td><td><p>Внереестровая блокировка IP-адреса <code>199.36.158.100</code>.</p></td><td>2022-04-23T02:31:59.646Z</td></tr><tr><td>murka(Danil Shaymurzin)</td><td><p>Похоже разблокировали, провайдер Дом.РУ, всё стабильно резолвится. Облачные функции всё также дропают соединение по таймауту</p></td><td>2022-04-29T06:57:34.270Z</td></tr><tr><td>ValdikSS</td><td><p><code>199.36.158.100</code> (*.web.app) заработал, <code>216.239.36.54</code> (*.cloudfunctions.net) всё ещё нет.</p></td><td>2022-04-29T09:07:52.690Z</td></tr><tr><td>VRSEN(Vrsen)</td><td><p>Есть идеи как можно использовать прокси с Callable functions?</p></td><td>2022-05-02T05:11:30.858Z</td></tr><tr><td>VRSEN(Vrsen)</td><td><h3>
<a name="firebase-hosting-1" class="anchor" href="#firebase-hosting-1"></a>Нашёл быстрое решение <strong>без прокси</strong> через firebase hosting.</h3>
<p>Позволяет вам вызывать ваши функции с кастомного домена или дефолтного web.app<br>
(<a href="https://firebase.google.com/docs/hosting/functions?hl=en#create-test-function" class="inline-onebox" rel="noopener nofollow ugc">Serve dynamic content and host microservices with Cloud Functions  |  Firebase Documentation</a>)</p>
<ol>
<li>Добавляем в firebase.json:</li>
</ol>
<pre><code class="lang-auto">  "hosting": {
    "rewrites": [ {
      "source": "/api/{название вашей функции}",
      "function": "{название вашей функции}"
    } ]
  }
</code></pre>
<ol start="2">
<li>Диполим</li>
</ol>
<pre><code class="lang-auto">firebase deploy --only functions,hosting
</code></pre>
<ol start="3">
<li>Вызываем функции с любого прикреплённого домена по пути <em>/api/{название вашей функции}</em>
</li>
</ol>
<p>Для <em>Callable Functions</em> на клиенте добавляем свой домен:</p>
<pre><code class="lang-auto">export const functions = getFunctions(app, 'us-central1');
functions.customDomain = 'https://{projectId}.web.app/api';
</code></pre>
<p><strong>Решение работает только для функций на us-central1!</strong></p>
<p><a class="mention" href="/u/adinvadim">@adinvadim</a> <a class="mention" href="/u/valdikss">@ValdikSS</a></p></td><td>2022-05-02T06:45:06.514Z</td></tr><tr><td>murka(Danil Shaymurzin)</td><td><p>Разбанили, все регионы резолвятся</p></td><td>2022-05-08T08:21:25.516Z</td></tr><tr><td>ValdikSS</td><td><p>Действительно, и <code>199.36.158.100</code> (*.web.app), и <code>216.239.36.54</code> (*.cloudfunctions.net) теперь работают.</p></td><td>2022-05-08T14:59:52.288Z</td></tr>
    </table>
      </body>
    </html>