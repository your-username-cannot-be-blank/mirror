[
    {
        "id": 166,
        "name": null,
        "username": "ValdikSS",
        "avatar_template": "/user_avatar/ntc.party/valdikss/{size}/2_2.png",
        "created_at": "2019-09-20T11:06:46.974Z",
        "cooked": "<p>У системы блокировки сайтов <strong>Ростелекома</strong> есть интересная деталь: соединения на заблокированные <strong>IP-адреса</strong> успешно устанавливаются, если размер пакета TCP SYN меньше 62 байт. При этом соединение идет через DPI (видно по дополнительному хопу в TTL), разрывается через 10 секунд неактивности, и пакеты TCP RST всё равно присылаются клиенту (их нужно блокировать, чтобы способ сработал). SYN-пакеты размером более 62 байта отбрасываются, ACK на них не приходит. Предполагаю, это какая-то дополнительная система обнаружения трафика, которая перенаправляет соединение через другой маршрут, т.к. до этого у Ростелекома был только «пассивный» (out-of-band) DPI, а это похоже на «активный» (in-band).<br>\nКак бы то ни было, одновременной блокировкой TCP RST от DPI (см. правила ниже) и уменьшением размера TCP SYN можно обойти <em>сетевые</em> блокировки TCP на Ростелекоме, независимо от порта и протокола.</p>\n<p>Чтобы уменьшить TCP SYN до 62 байт <strong>в Linux</strong>, достаточно отключить две TCP-опции: TCP Timestamps и TCP SACK:<br>\nСоздать /etc/sysctl.d/anticensorship.conf с текстом:</p>\n<pre><code class=\"lang-auto\"># Rostelecom anti-censorship\nnet.ipv4.tcp_timestamps=0\nnet.ipv4.tcp_sack=0\n</code></pre>\n<p>И применить:</p>\n<pre><code class=\"lang-auto\"># sysctl --system\n</code></pre>\n<p>Это будет работать только непосредственно на компьютере, с которого устанавливается TCP-соединение. Если добавить эти параметры на маршрутизатор, и попытаться загрузить заблокированный сайт на компьютере, например, с Windows, то ничего не поменяется — сайт не откроется.<br>\nЧтобы настроить всё только на маршрутизаторе, нужно, вероятно, использовать TCP-прокси, чтобы сам маршрутизатор открывал TCP-соединения. Я серьезных проектов TCP-прокси не знаю, но tpws из <a href=\"https://github.com/bol-van/zapret/tree/master/tpws\" rel=\"nofollow noopener\">zapret</a> должен подойти.</p>\n<p>Правила iptables для Linux, для блокировки TCP RST:</p>\n<pre><code class=\"lang-auto\">iptables -t mangle -I FORWARD -p tcp -m tcp --sport 80 -m u32 --u32 \"0x1e&amp;0xffff=0x5010&amp;&amp;0x73=0x7761726e&amp;&amp;0x77=0x696e672e&amp;&amp;0x7B=0x72742e72\" -m comment --comment \"Rostelecom HTTP FORWARD\" -j DROP\niptables -t mangle -I FORWARD -p tcp -m connbytes --connbytes 2: --connbytes-mode packets --connbytes-dir reply -m u32 --u32 \"0x4=0x10000 &amp;&amp; 0x1E&amp;0xffff=0x5004\" -m comment --comment \"Rostelecom non-HTTP FORWARD\" -j DROP\n\niptables -t mangle -I INPUT -p tcp -m tcp --sport 80 -m u32 --u32 \"0x1e&amp;0xffff=0x5010&amp;&amp;0x73=0x7761726e&amp;&amp;0x77=0x696e672e&amp;&amp;0x7B=0x72742e72\" -m comment --comment \"Rostelecom HTTP OUTPUT\" -j DROP\niptables -t mangle -I INPUT -p tcp -m connbytes --connbytes 2: --connbytes-mode packets --connbytes-dir reply -m u32 --u32 \"0x4=0x10000 &amp;&amp; 0x1E&amp;0xffff=0x5004\" -m comment --comment \"Rostelecom non-HTTP OUTPUT\" -j DROP\n</code></pre>\n<p><strong>Windows 7</strong>, после неудачных попыток установки соединения с большим SYN-пакетом, отправляет пакет без TCP SACK, из-за чего он получается равен 62 байтам, и соединение со включенным GoodbyeDPI устанавливается в течение нескольких десятков секунд. <strong>Windows 10</strong> не обладает такой особенностью, и соединение не будет установлено.</p>",
        "post_number": 1,
        "post_type": 1,
        "posts_count": 2,
        "updated_at": "2019-10-26T19:21:13.432Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 1404,
        "reads": 55,
        "readers_count": 54,
        "score": 7031.0,
        "yours": false,
        "topic_id": 85,
        "topic_slug": "%D0%B8%D0%BD%D1%82%D0%B5%D1%80%D0%B5%D1%81%D0%BD%D0%BD%D0%B0%D1%8F-%D0%BE%D1%81%D0%BE%D0%B1%D0%B5%D0%BD%D0%BD%D0%BE%D1%81%D1%82%D1%8C-dpi-%D1%80%D0%BE%D1%81%D1%82%D0%B5%D0%BB%D0%B5%D0%BA%D0%BE%D0%BC%D0%B0",
        "display_username": null,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 2,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
            {
                "url": "https://github.com/bol-van/zapret/tree/master/tpws",
                "internal": false,
                "reflection": false,
                "title": "zapret/tpws at master · bol-van/zapret · GitHub",
                "clicks": 14
            },
            {
                "url": "https://ntc.party/t/dpi/1482/5",
                "internal": true,
                "reflection": true,
                "title": "Сломать оборудование для DPI?",
                "clicks": 6
            },
            {
                "url": "https://ntc.party/t/%D0%BD%D0%BE%D0%B2%D1%8B%D0%B9-dpi-%D0%B2-%D0%BF%D0%B5%D1%80%D0%BC%D0%B8-%D0%B4%D0%BB%D1%8F-%D0%B1%D0%BB%D0%BE%D0%BA%D0%B8%D1%80%D0%BE%D0%B2%D0%BA%D0%B8-telegram/62/11",
                "internal": true,
                "reflection": true,
                "title": "Новый DPI в Перми для блокировки Telegram",
                "clicks": 1
            }
        ],
        "read": true,
        "user_title": "AntiZapret staff",
        "title_is_group": false,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": true,
        "admin": true,
        "staff": true,
        "user_id": 1,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": false,
        "wiki": false,
        "post_url": "/t/%D0%B8%D0%BD%D1%82%D0%B5%D1%80%D0%B5%D1%81%D0%BD%D0%BD%D0%B0%D1%8F-%D0%BE%D1%81%D0%BE%D0%B1%D0%B5%D0%BD%D0%BD%D0%BE%D1%81%D1%82%D1%8C-dpi-%D1%80%D0%BE%D1%81%D1%82%D0%B5%D0%BB%D0%B5%D0%BA%D0%BE%D0%BC%D0%B0/85/1",
        "can_translate": false
    },
    {
        "id": 236,
        "name": "Leonid Evdokimov",
        "username": "darkk",
        "avatar_template": "/user_avatar/ntc.party/darkk/{size}/470_2.png",
        "created_at": "2019-09-24T21:29:49.066Z",
        "cooked": "<p>У РТК есть и другая странная деталь: TCP порты 1-9 у некоторых из заблокированных IP доступны без каких-либо ухищрений.</p>",
        "post_number": 2,
        "post_type": 1,
        "posts_count": 2,
        "updated_at": "2019-10-26T19:24:12.495Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 72,
        "reads": 45,
        "readers_count": 44,
        "score": 369.0,
        "yours": false,
        "topic_id": 85,
        "topic_slug": "%D0%B8%D0%BD%D1%82%D0%B5%D1%80%D0%B5%D1%81%D0%BD%D0%BD%D0%B0%D1%8F-%D0%BE%D1%81%D0%BE%D0%B1%D0%B5%D0%BD%D0%BD%D0%BE%D1%81%D1%82%D1%8C-dpi-%D1%80%D0%BE%D1%81%D1%82%D0%B5%D0%BB%D0%B5%D0%BA%D0%BE%D0%BC%D0%B0",
        "display_username": "Leonid Evdokimov",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": true,
        "admin": false,
        "staff": true,
        "user_id": 8,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": false,
        "wiki": false,
        "post_url": "/t/%D0%B8%D0%BD%D1%82%D0%B5%D1%80%D0%B5%D1%81%D0%BD%D0%BD%D0%B0%D1%8F-%D0%BE%D1%81%D0%BE%D0%B1%D0%B5%D0%BD%D0%BD%D0%BE%D1%81%D1%82%D1%8C-dpi-%D1%80%D0%BE%D1%81%D1%82%D0%B5%D0%BB%D0%B5%D0%BA%D0%BE%D0%BC%D0%B0/85/2",
        "can_translate": false
    }
]