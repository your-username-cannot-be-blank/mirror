
    <html>
      <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <style>
    th, td {
      border: 1px solid black;
      border-collapse: collapse;
    }
    th, td {
      word-wrap: break-word;
      padding: 5px;
    }
    table {
      width: 100%;
      max-width: 100%;
      border: 1px solid black;
      border-collapse: collapse;
      table-layout: fixed;
      word-wrap: break-word
    }
    code {
      word-wrap: break-word;
    }
    pre {
        white-space: pre-wrap;
    }
    </style>
        <title>низкая-скорость-доступа-к-instagram-через-xrayoutlineopenvpn</title>
      </head>
      <body>
        <table border="1" width="100%" cellpadding="5">
          <tr>
            <th style="width: 10%;">Ник</th>
            <th>Пост</th>
            <th style="width: 10%;">Дата</th>
          </tr>
    <tr><td>zbg</td><td><p>Привет всем.</p>
<p>Есть две VPS-ки у провайдера Racknerd. На одной стоял Outline и прекрасно работал до начала февраля. Потом доступ к инстаграму стал настолько медленным, что картинки не загружались. Поскольку срок аренды скоро заканчивается, купил ещё одну VPS, помощнее. Поставил там Xray (с 3X-UI). Но и с этим прокси инста не работает как следует (хотя и получше): картинки грузятся медленно. Есть странная особенность: если подождать 3 минуты после запуска клиента, то скорость более менее вырастает. Но всё равно есть лаги периодические и недогруженные картики.</p>
<p>При этом ютуб прекрасно работает на любом качестве видео. Подозреваю, что это как-то связано с QUIC, на котором работает инста. Клиенты - nekobox на Андроиде и ForXray на иОС.</p>
<p>Пробовал добавлять в nekobox бесплатные ключи чьих-то ss (Outline) серверов - прекрасно работают. Т.е. дело не в клиенте.</p>
<p>Помогите пжл решить проблему. Не разбираюсь в сетевых технологиях, делаю всё по инструкции, сделайте пжл скидку для чайников в ответах )</p></td><td>2024-02-25T14:16:15.501Z</td></tr><tr><td>0ka(0ka)</td><td><p>для блокировки QUIC попробуйте</p>
<pre><code class="lang-auto">iptables -A OUTPUT -p udp --dport 443 -j REJECT
</code></pre></td><td>2024-02-25T15:32:33.616Z</td></tr><tr><td>zbg</td><td><p>Не-а, не помогает.</p></td><td>2024-02-26T07:18:41.801Z</td></tr><tr><td>glpnk</td><td><p>ТСПУ блокирует инстаграм, твиттер и фейсбук при использовании Cloudflare Warp через мобильный билайн. При этом, через мобильный МТС проблем нет. Warp использует DoT.</p>
<p>Могу предположить что DNS запросы могут утекать мимо, но проверить не могу.</p>
<p>При этом с компьютера работает через оба оператора через варп с похожими настройками как на телефоне</p></td><td>2024-02-27T01:15:13.440Z</td></tr><tr><td>pandemus(Alexxk)</td><td><p>Я столкнулся с проблемой ТС, Всё не так короче, почти все дата-центры блокируются инстой, только сейчас с техподдержкой RackNerd общался. Я так понимаю нужны какие, то прокси которые называют “кросовки”, прошу прощения я только начинаю.<br>
Далее переписка AL-я RN-RackNerd<br>
AL - There is one more question: Instagram won’t load on iOS, I haven’t tried it on other operating systems. Is this somehow related to the IP ban on the resource, or is there a problem with QUIC Instagram.<br>
The problems started about 10 days ago. Thank you in advance.<br>
RN - As far as I understand, Instagram blocks all datacenter based IPs.<br>
AL - Replacing the IP will not help, or for a short time? Instagram’s policy is clear. Thanks for your hard work.<br>
RN - I am not really sure, as we do not control or manage Instagram’s policy. I was under the impression that they did a blanket ban for all datacenter IPs.</p></td><td>2024-03-28T18:05:33.474Z</td></tr><tr><td>pandemus(Alexxk)</td><td><aside class="quote no-group" data-username="glpnk" data-post="4" data-topic="7246" data-full="true">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/g/f1d935/48.png" class="avatar"> glpnk:</div>
<blockquote>
<p>ТСПУ блокирует инстаграм, твиттер и фейсбук при использовании Cloudflare Warp через мобильный билайн. При этом, через мобильный МТС проблем нет. Warp использует DoT.</p>
<p>Могу предположить что DNS запросы могут утекать мимо, но проверить не могу.</p>
<p>При этом с компьютера работает через оба оператора через варп с похожими настройками как на телефоне</p>
</blockquote>
</aside>
<p>ТСПУ здесь ни причем, проблема на выходе, само ТСПУ мы уже прошли, это довольно тупенькая машина, Проблема в самом instagrame</p></td><td>2024-03-28T18:33:11.566Z</td></tr><tr><td>User69</td><td><aside class="quote no-group" data-username="glpnk" data-post="4" data-topic="7246">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/g/f1d935/48.png" class="avatar"> glpnk:</div>
<blockquote>
<p>ТСПУ блокирует инстаграм, твиттер и фейсбук при использовании Cloudflare Warp через мобильный билайн</p>
</blockquote>
</aside>
<p>Уверены насчет Twitter?<br>
А с FB и Instagram да, с лета не работает, и это точно не ТСПУ. Тогда бы и остальное не работало, к чему такая избирательность<br>
И DNS не утекают, можно проверить на <a href="http://www.dnssec-or-not.com" rel="noopener nofollow ugc">http://www.dnssec-or-not.com</a> и <a href="https://www.dnsleaktest.com" rel="noopener nofollow ugc">https://www.dnsleaktest.com</a></p>
<aside class="quote no-group" data-username="pandemus" data-post="5" data-topic="7246">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/p/db5fbb/48.png" class="avatar"> pandemus:</div>
<blockquote>
<p>RN - As far as I understand, Instagram blocks all datacenter based IPs.</p>
</blockquote>
</aside>
<p>Не могу согласиться.<br>
С тем же WARP на десктопе FB и Instagram работают без проблем. Там в логах отличаются только IP на одну цифру и порты, так что, IP на десктопе тоже дата-центровский.<br>
Да и как тогда у всех всё работает с VPN в европейских дата-центрах?<br>
Traceroute с телефона, БиЛайн, WARP ON:</p>
<details>
<summary>
Summary</summary>
<pre><code class="lang-auto">traceroute to facebook.com (31.13.72.36)...
 1 172.70.136.70  45,47ms  28,6ms  23,94ms
 2 104.28.0.0  44,98ms  25,9ms  21,06ms
 3 8.20.122.1  23,94ms  20,2ms  26,17ms
 4 81.211.31.248  47,26ms  19,78ms  24,33ms
 5 mx01.stockholm.gldn.net (79.104.235.70)  68,41ms  38,09ms  39,86ms
 6 ae8.pr01.arn1.tfbnw.net (157.240.69.130)  64,84ms  54,61ms  40,74ms
 7 po213.asw03.arn2.tfbnw.net (147.75.212.48)  75,02ms  46,1ms  39,9ms
 8 psw03.arn2.tfbnw.net (74.119.79.149)  74,71ms  38,11ms  44,77ms
 9 173.252.67.143  64,85ms  77,08ms  40,84ms
10 edge-star-mini-shv-01-arn2.facebook.com (31.13.72.36)  73,89ms  40,99ms  40,09ms


traceroute to instagram.com (31.13.72.174)...
 1 172.68.167.70  10,53ms  6,97ms  5,8ms
 2 104.28.0.0  8,18ms  6,78ms  6,21ms
 3 172.68.167.1  8,38ms  8,69ms  6,38ms
 4 172.68.8.52  24,88ms  13,36ms  8,98ms
 5 198.41.140.189  29,72ms  29,57ms  28,18ms
 6 ae10.pr01.arn1.tfbnw.net (157.240.77.142)  36ms  28,51ms  30,42ms
 7 po213.asw03.arn2.tfbnw.net (147.75.212.48)  31,73ms  30,46ms  29,94ms
 8 psw03.arn2.tfbnw.net (74.119.79.149)  28,96ms  29,11ms  28,86ms
 9 157.240.38.189  32,17ms  30,93ms  30,28ms
10 instagram-p42-shv-01-arn2.fbcdn.net (31.13.72.174)  38,13ms  29,49ms  31,58ms
</code></pre>
</details></td><td>2024-03-28T21:27:56.748Z</td></tr><tr><td>pandemus(Alexxk)</td><td><p>Тема давно мусолится <a href="https://qna.habr.com/q/980333" class="inline-onebox" rel="noopener nofollow ugc">Сложности с открытием парсером любого URL Instagram - переадресация на login page. Как решить? — Хабр Q&amp;A</a>, но внятного ответа я пока не нашел.</p></td><td>2024-03-29T05:18:41.954Z</td></tr><tr><td>pandemus(Alexxk)</td><td><p>Жилой прокси — это посредник, который использует IP-адрес, предоставляемый не центром обработки данных, а интернет-провайдером (ISP). Используя резидентный прокси, можно выбрать конкретное местоположение (страну, город или провайдера) и работать в Интернете как реальный пользователь. Благодаря специфике таких прокси гарантируется высокий уровень анонимности и низкий уровень бан-рисков.</p></td><td>2024-03-29T05:24:23.931Z</td></tr><tr><td>User69</td><td><p>WARP-ом в мире пользуются миллионы людей, CF договорился с Метой на этот счет. Парсеры они детектируют и отсекают как-то по-другому, не по IP дата-центров</p>
<p>Человек пишет, что проблема наблюдается только в связке WARP+Билайн, через МТС всё работает<br>
На их <a href="https://community.cloudflare.com/c/zero-trust/warp/87" rel="noopener nofollow ugc">форуме</a> также тихо<br>
Проблема явно локальная</p></td><td>2024-03-29T09:15:08.693Z</td></tr><tr><td>SpecteR</td><td><p>проксирую трафик meta через обычный ss, сначала добавить outbounds, потом в настройках роутинга domain - geosite:meta и указываем созданный outbound. таким образом использую vless, а трафик до меты ходит по ss <img src="https://ntc.party/images/emoji/twitter/slight_smile.png?v=12" title=":slight_smile:" class="emoji" alt=":slight_smile:" loading="lazy" width="20" height="20"></p></td><td>2024-04-01T08:15:45.093Z</td></tr><tr><td>Uporoty(Uporoty)</td><td><blockquote>
<p>Но и с этим прокси инста не работает как следует (хотя и получше): картинки грузятся медленно. Есть странная особенность: если подождать 3 минуты после запуска клиента, то скорость более менее вырастает.</p>
</blockquote>
<p>Это известная проблема Instagram и WhatsApp - у них сломан фоллбэк с IPv6 на IPv4. Браузеры обычно фоллбэкаются быстро, а вот клиенты Инсты и ВА тупят, и им надо от 30 секунд до нескольких минут чтобы осознать что связности по v6 к нужному серверу нет.</p>
<p>Соответственно, если одно из двух: 1). В прокси-клиенте используется TUN-интерфейс, но отключен IPv6, при этом IPv6 есть на любом другом сетевом интерфейсе, но без реальной связности 2) Прокси-клиент используется без TUN, либо IPv6 включен на интерфейсе, но на сервере IPv6 адреса нет, либо есть, но без связности = в этих всех случаях Instagram и WhatsApp будут тупить.</p>
<p>Решений несколько, убедиться что IPv6 работает на сервере и включить его в клиенте, либо отключить IPv6 на всех системных интерфейсах и в клиенте, либо на сервере перехватывать DNS-запросы на 53 порт (оба UDP и TCP), перенаправлять их на встроенный DNS иксрея, и там поставить чтобы он отдавал только A-записи без AAAA</p></td><td>2024-04-01T13:20:30.449Z</td></tr><tr><td>Gel0</td><td><p>Кому-то удалось решить проблему?</p></td><td>2024-05-15T14:59:15.262Z</td></tr><tr><td>Uporoty(Uporoty)</td><td><p>Выше уже написано же, как решить проблему. Ну и на Хабре даже об этом статья была: <a href="https://habr.com/ru/articles/811487/" rel="noopener nofollow ugc">https://habr.com/ru/articles/811487/</a></p></td><td>2024-05-18T14:53:19.071Z</td></tr><tr><td>Gel0</td><td><p>Идиотский вопрос от того кто не шарит. Куда и какую строчку кода надо вписать, чтобы все заработало. Действовал по этой инструкции и даже VPS там же на RackNerd. Насколько понял у них только ipv4.<br>
<a href="https://pikabu.ru/story/obkhod_lyubyikh_blokirovok_10295839" class="onebox" target="_blank" rel="noopener nofollow ugc">https://pikabu.ru/story/obkhod_lyubyikh_blokirovok_10295839</a></p>
<p>Понимаю что слишком много чести, но правда не шарю и был бы очень благодарен.</p></td><td>2024-05-20T05:49:08.148Z</td></tr><tr><td>Uporoty(Uporoty)</td><td><p>Однозначного ответа про “куда и что вписать” нет, случаи могут быть очень разные и решаться по-разному.</p>
<p>Например:</p>
<ol>
<li>Задолбать техподдержку вашего хостера, чтобы вам включили IPv6 и помогли его настроить в системе. Если они не дают IPv6 потому что у них его нет, то можно попробовать туннельный брокер (от HE или Route64).</li>
<li>Смотреть настройки клиентов у пользователей. Там часто есть параметры типа “IPv6-маршруты” (попробовать выключить если включено), или “Query Strategy”/“Routing Strategy”, там выбрать “Prefer IPv4” или “IPv4 only”-</li>
</ol></td><td>2024-05-20T08:39:29.615Z</td></tr><tr><td>0ka(0ka)</td><td><aside class="quote no-group" data-username="Uporoty" data-post="16" data-topic="7246">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/u/ed655f/48.png" class="avatar"> Uporoty:</div>
<blockquote>
<p>можно попробовать туннельный брокер</p>
</blockquote>
</aside>
<p>и получить тормоза уже из-за того что сеть брокера постоянно перегружена…</p></td><td>2024-05-20T16:10:07.610Z</td></tr><tr><td>Uporoty(Uporoty)</td><td><p>Можно проще, вместо туннельного брокера использовать Cloudflare Warp.</p>
<p>Настроить в XRay wireguard outbound для Warp как написано в статье: <a href="https://habr.com/ru/articles/799751/" rel="noopener nofollow ugc">https://habr.com/ru/articles/799751/</a></p>
<p>А потом в routing вписать правило типа такого:</p>
<pre><code class="lang-auto">{
        "domainMatcher": "hybrid",
        "type": "field",
        "ip": ["::/1", "8000::/1"],
        "outboundTag": "warp"
      }
</code></pre>
<p>Ну еще для адреса <a href="http://engage.cloudflare.com" rel="noopener nofollow ugc">engage.cloudflare.com</a> возможно придется ручками отрезолвить и подставить IPv4-адрес, чтобы он тоже не пытался по v6 до него лезть.</p>
<p>А если ух хочется совсем красиво - совместить это с трюком с DNS как описано в другой выше упомянутой <a href="https://habr.com/ru/articles/811487/" rel="noopener nofollow ugc">статье</a>, то есть чтобы по умолчанию клиенты ходили по IPv4, но если уж кому-то очень захотелось IPv6 (например, закэшировались AAAA-записи от предыдущего подключения), то он сможет достучаться до нужного сервера черех Warp.</p></td><td>2024-05-20T19:21:41.652Z</td></tr><tr><td>AnGeliron(Michael Pan)</td><td><p>Заходишь в панель Настройки Xray - Базовый шаблон - Правила IPv4 тыкаешь в строке Мета, сохранить, перезагрузить Xray - профит.</p></td><td>2024-10-29T18:43:53.383Z</td></tr><tr><td>zbg</td><td><p>Подтверждаю, в свежих версиях 3X-UI появилась возможность пускать трафик до меты через WARP. Установил новую версию, работает.</p>
<p>Спасибо за совет <a class="mention" href="/u/angeliron">@AnGeliron</a> ! От души.</p></td><td>2024-11-14T14:43:24.168Z</td></tr><tr><td>REM1X</td><td><p>Что такое SS?</p></td><td>2024-11-18T19:10:30.970Z</td></tr><tr><td>Anonimno(Anonimno)</td><td><p>ShadowSocks</p></td><td>2024-11-18T19:12:34.836Z</td></tr>
    </table>
      </body>
    </html>