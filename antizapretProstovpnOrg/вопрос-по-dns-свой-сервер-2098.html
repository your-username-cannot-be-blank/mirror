
    <html>
      <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <style>
    th, td {
      border: 1px solid black;
      border-collapse: collapse;
    }
    th, td {
      word-wrap: break-word;
      padding: 5px;
    }
    table {
      width: 100%;
      max-width: 100%;
      border: 1px solid black;
      border-collapse: collapse;
      table-layout: fixed;
      word-wrap: break-word
    }
    code {
      word-wrap: break-word;
    }
    pre {
        white-space: pre-wrap;
    }
    </style>
        <title>вопрос-по-dns-свой-сервер-2098</title>
      </head>
      <body>
        <table border="1" width="100%" cellpadding="5">
          <tr>
            <th style="width: 10%;">Ник</th>
            <th>Пост</th>
            <th style="width: 10%;">Дата</th>
          </tr>
    <tr><td>Andy(Andrey)</td><td><p>Здравствуйте.<br>
Успешно установил антизапрет на свой VPS, работает.<br>
При подключении с компьютера (openvpn client) все работает без танцев с бубном.</p>
<p>Далее решил загнать весь домашний трафик путем настройки клиента на роутере Asus AC68-U (чтобы на всех девайсах не париться с клиентами)<br>
Удалось добиться более-менее корректной работы только с отключением dns over https.</p>
<p>Правильно ли я понял, что с включенным DoH корректной работы не добиться (при клиенте на роутере)?</p>
<p>А так же при подключенном vpn-клиенте с роутера, dns сервера перестают пинговаться, корректно ли это или я где то накриворучил? (при подключении клиента с компа такой проблемы нет)</p>
<p>Спасибо за подобный продукт и заранее благодарю за ответ.</p></td><td>2022-03-26T17:20:00.230Z</td></tr><tr><td>User69</td><td><p>Да, DoH, DoT, DNSSEC, DNScrypt и всё подобное надо отключать.<br>
Смысл сервиса как раз в подмене DNS-ответов для заблокированных ресурсов. Все запросы должны идти только на DNS сервер  VPN Антизапрета.<br>
Поэтому в настройках VPN роутера Вы выбрали DNS — Exclusive (надеюсь). И никаких ручных настроек DNS на клиентах.</p>
<p>Теперь Ваш DNS сервер типа</p>
<p><code>Mar 27 16:02:11	daemon	info	dnsmasq[4905]	using nameserver 192.168.104.1#53</code></p>
<p>Посмотрите в логах, какой именно IP у Вас.<br>
Можно попинговать его. 50 — хороший результат. Но в момент нагрузки бывает и 300. Ничего не поделаешь.</p></td><td>2022-03-27T13:27:59.930Z</td></tr><tr><td>Andy(Andrey)</td><td><p>Да, выставлен exclusive конечно.<br>
Смысл работы мне понятен и про назначение dns через dhcp в том числе.</p>
<p>Остается вопрос недоступности dns серверов указанных на роутере (например 8.8.8.8) при подключенном vpn. Я понимаю почему это происходит в принципе, т.к. при подключении vpn срабатывают правила:<br>
pull-filter ignore block-outside-dns<br>
route 8.8.8.8 255.255.255.255 vpn_gateway<br>
route 1.1.1.1 255.255.255.255 vpn_gateway<br>
при отлючении vpn сервера разумеется становятся доступны.</p>
<p>Вопрос был в том, должно ли это быть именно так.</p>
<p>А пинг до dns антизапрета (192.168.104.1) 30-40ms</p></td><td>2022-03-27T13:40:20.558Z</td></tr><tr><td>ValdikSS</td><td><p>У вас нормальный роутер, корректно обрабатывающий DNS-серверы из VPN-туннеля, вам не нужно маршрутизировать эти публичные DNS, достаточно выбрать эксклюзивный режим использования DNS в настройках VPN. Эта функция была сделана для моделей, в которых получение и использование DNS из VPN-туннеля не реализовано или работает не до конца корректно.</p>
<p>По поводу отсутствия пинга серверов — да, это нормально, перехватываются только UDP DNS-запросы, а для ICMP я правил не добавлял.</p></td><td>2022-03-27T21:25:38.851Z</td></tr><tr><td>Andy(Andrey)</td><td><p>Спасибо, теперь всё понял по данному вопросу.</p></td><td>2022-03-28T09:20:20.708Z</td></tr>
    </table>
      </body>
    </html>