
    <html>
      <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <style>
    th, td {
      border: 1px solid black;
      border-collapse: collapse;
    }
    th, td {
      word-wrap: break-word;
      padding: 5px;
    }
    table {
      width: 100%;
      max-width: 100%;
      border: 1px solid black;
      border-collapse: collapse;
      table-layout: fixed;
      word-wrap: break-word
    }
    code {
      word-wrap: break-word;
    }
    pre {
        white-space: pre-wrap;
    }
    </style>
        <title>контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129</title>
      </head>
      <body>
        <table border="1" width="100%" cellpadding="5">
          <tr>
            <th style="width: 10%;">Ник</th>
            <th>Пост</th>
            <th style="width: 10%;">Дата</th>
          </tr>
    <tr><td>ValdikSS</td><td><h1>
<a name="antizapret-vpn-container-1" class="anchor" href="#antizapret-vpn-container-1"></a>AntiZapret VPN Container</h1>
<p>Выложил готовый контейнер VPN АнтиЗапрета и все файлы для его сборки на<br>
<a href="https://bitbucket.org/anticensority/antizapret-vpn-container/src/" class="onebox" target="_blank" rel="noopener">https://bitbucket.org/anticensority/antizapret-vpn-container/src/</a></p>
<p>Последнее обновление: <a href="https://ntc.party/t/vpn/129/61">26.05.2020</a></p>
<p>Для правильной работы <strong>Twitter, Facebook и Instagram</strong> <a href="https://ntc.party/t/vpn/129/127"><strong>требуются дополнительные действия</strong></a>.</p>
<h4>
<a name="vpn-10-2" class="anchor" href="#vpn-10-2"></a>Создайте свой личный VPN АнтиЗапрета за 10 минут!</h4>
<p><strong>Что это?</strong> Это полный аналог сервиса для получения доступа к заблокированным сайтам в Российской Федерации <a href="https://antizapret.prostovpn.org/">АнтиЗапрет VPN</a>, пригодный для установки на личный сервер в интернете.</p>
<p><strong>Какие преимущества перед обычным VPN?</strong> Обычные VPN направляют трафик ко всем сайтам и сервисам через свои серверы, что понижает общую скорость работы интернета. АнтиЗапрет направляет трафик на свои серверы только к сайтам и сервисам, заблокированным на территории Российской Федерации, и не снижает скорость открытия других сайтов.</p>
<p><strong>Зачем нужен этот контейнер?</strong> Он нужен в случаях, если вы не доверяете администратору сервиса АнтиЗапрет, недовольны скоростью работы или просто хотите запустить аналог сервиса для себя на собственном оборудовании.</p>
<hr>
<p><strong>Если получаете ошибки на Ubuntu 18.04 типа</strong>:</p>
<pre><code class="lang-auto">systemd-networkd.service: Failed to set up mount namespacing: Permission denied
</code></pre>
<p>См. сообщение <a href="https://ntc.party/t/vpn/129/57" class="inline-onebox">Контейнер VPN АнтиЗапрета для установки на собственный сервер - #57 by ValdikSS</a></p>
<p><strong>Используете UFW, контейнер не работает на Vultr?</strong> <a href="https://ntc.party/t/vpn/129/76" class="inline-onebox">Контейнер VPN АнтиЗапрета для установки на собственный сервер - #76 by magratsk</a></p></td><td>2019-09-30T02:40:23.860Z</td></tr><tr><td>zald(alex)</td><td><p>А можно пример настройки LXD для данного контейнера?</p></td><td>2019-10-02T17:16:36.996Z</td></tr><tr><td>ValdikSS</td><td><p>Вы про <code>lxd init</code>? Подойдут настройки по умолчанию.</p></td><td>2019-10-02T18:24:08.901Z</td></tr><tr><td>zald(alex)</td><td><p>Да про него, но он запускается так себе. C первого раза по крайней мере не получилось.</p>
<p>Будет ли контейнер для Docker?</p></td><td>2019-10-06T08:30:40.553Z</td></tr><tr><td>ValdikSS</td><td><p>Как может контейнер не запускаться, что вы имеете в виду?<br>
Docker не предназначен для такого.</p></td><td>2019-10-06T14:44:56.969Z</td></tr><tr><td>zald(alex)</td><td><p>Не-не-не. Не так меня поняли. Я просто намучался настраивать LXD. Если какая нибудь инструкция для него, то идеально, но на хабре была если не ошибаюсь.</p>
<p>Я ожидал, что может для Docker есть более простая настройка с Antizapret на своем сервере.</p></td><td>2019-10-06T16:26:26.267Z</td></tr><tr><td>ValdikSS</td><td><p>Я ничего кроме <code>lxd init</code> не выполнял, он всё настроил, я даже никакие инструкции не читал. Настраивал на Ubuntu и ArchLinux. Может, ваш дистрибутив требует какой-то особой настройки? Что у вас за дистрибутив?</p>
<p>Контейнер использует systemd для управления сервисами, а он не совместим с Docker. Docker предназначен для контейнеров приложений, а не для системных контейнеров, каким является контейнер антизапрета. Если вам не подходит LXD, можете использовать другой инструмент для запуска системных контейнеров — systemd-machined (команда <code>machinectl</code>), но его, скорее всего, придётся дольше настраивать (потребуется ручная настройка сети, как минимум).</p></td><td>2019-10-06T16:43:43.922Z</td></tr><tr><td>bt4g(bt4g)</td><td><p>Установил всё по инструкции, использовал Debian 10, так вот вопрос в чём? почему теряется сеть “отваливается” eth0 в самом контейнере?</p>
<p>192.168.104.1 (vpn-tcp) | fd42:44c7:6da4:dac4:216:3eff:fe3e:db2c (eth0)<br>
192.168.100.1 (vpn)<br>
10.92.218.174 (eth0)  &lt;— вот этот отваливается, приходится вручную его поднимать через какое-то время, подскажите что не так?</p></td><td>2019-10-16T18:44:44.377Z</td></tr><tr><td>ValdikSS</td><td><p>Не сталкивался с таким. Как именно отваливается, что при этом происходит в контейнере? Вы смотрели записи в журнале?</p></td><td>2019-10-16T19:48:06.340Z</td></tr><tr><td>bt4g(bt4g)</td><td><p>вошёл в контейнер<br>
lxc exec antizapret-vpn – bash</p>
<p>а журнал как посмотреть, подзабыл уже ))</p></td><td>2019-10-16T20:00:52.403Z</td></tr><tr><td>bt4g(bt4g)</td><td><p>если есть возможность в телеграм напишите, что бы тут не флудить <a href="https://t.me/BT4G2015" rel="nofollow noopener">https://t.me/BT4G2015</a></p></td><td>2019-10-16T20:02:00.507Z</td></tr><tr><td>ValdikSS</td><td><p>Если вы говорите, что связность теряется со временем, то это может быть проблемой с DHCP. Посмотрите, есть ли IP-адрес на интерфейсе командой <code>ip a</code>, когда контейнер недоступен извне.<br>
Также см. журнал через <code>journalctl -e</code>.</p></td><td>2019-10-16T20:25:22.658Z</td></tr><tr><td>bt4g(bt4g)</td><td><p>ifconfig<br>
eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500<br>
inet6 fe80::216:3eff:fe3e:db2c  prefixlen 64  scopeid 0x20<br>
inet6 fd42:44c7:6da4:dac4:216:3eff:fe3e:db2c  prefixlen 64  scopeid 0x0<br>
ether 00:16:3e:3e:db:2c  txqueuelen 1000  (Ethernet)<br>
RX packets 1595  bytes 11880034 (11.3 MiB)<br>
RX errors 0  dropped 0  overruns 0  frame 0<br>
TX packets 546  bytes 40072 (39.1 KiB)<br>
TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</p>
<p>lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536<br>
inet 127.0.0.1  netmask 255.0.0.0<br>
inet6 ::1  prefixlen 128  scopeid 0x10<br>
loop  txqueuelen 1000  (Local Loopback)<br>
RX packets 0  bytes 0 (0.0 B)<br>
RX errors 0  dropped 0  overruns 0  frame 0<br>
TX packets 0  bytes 0 (0.0 B)<br>
TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</p>
<p>vpn: flags=4305&lt;UP,POINTOPOINT,RUNNING,NOARP,MULTICAST&gt;  mtu 1500<br>
inet 192.168.100.1  netmask 255.255.252.0  destination 192.168.100.1<br>
inet6 fe80::fa94:efb:a333:8524  prefixlen 64  scopeid 0x20<br>
unspec 00-00-00-00-00-00-00-00-00-00-00-00-00-00-00-00  txqueuelen 500  (UNSPEC)<br>
RX packets 0  bytes 0 (0.0 B)<br>
RX errors 0  dropped 0  overruns 0  frame 0<br>
TX packets 14  bytes 672 (672.0 B)<br>
TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</p>
<p>vpn-tcp: flags=4305&lt;UP,POINTOPOINT,RUNNING,NOARP,MULTICAST&gt;  mtu 1500<br>
inet 192.168.104.1  netmask 255.255.252.0  destination 192.168.104.1<br>
inet6 fe80::c659:ad4d:2f01:9220  prefixlen 64  scopeid 0x20<br>
unspec 00-00-00-00-00-00-00-00-00-00-00-00-00-00-00-00  txqueuelen 500  (UNSPEC)<br>
RX packets 0  bytes 0 (0.0 B)<br>
RX errors 0  dropped 0  overruns 0  frame 0<br>
TX packets 14  bytes 672 (672.0 B)<br>
TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</p>
<p>отваливается в самом контейнере</p></td><td>2019-10-17T03:26:43.545Z</td></tr><tr><td>ValdikSS</td><td><p>Действительно. <code>ifupdown</code> неправильно работает в такой конфигурации. Переделал контейнер на использование <code>systemd-networkd</code>.<br>
<a href="https://bitbucket.org/anticensority/antizapret-vpn-container/commits/77c859e7058279f67d05589261dc95489aedd05b" class="onebox" target="_blank" rel="noopener">https://bitbucket.org/anticensority/antizapret-vpn-container/commits/77c859e7058279f67d05589261dc95489aedd05b</a></p>
<p>Достаточно обновить образ и запустить новый контейнер. После обновления ваш текущий клиентский конфигурационный файл OpenVPN работать не будет. Если вы хотите сохранить возможность использования текущего файла, вам нужно сначала сделать резервную копию следующих файлов из текущего контейнера:</p>
<pre><code class="lang-auto">/root/easy-rsa-ipsec
/etc/openvpn/server/keys
</code></pre>
<p>А затем скопировать их в новый контейнер.</p></td><td>2019-10-17T14:25:56.881Z</td></tr><tr><td>bt4g(bt4g)</td><td><p>обновил контейнер посмотрим что и как будет, спасибо.</p></td><td>2019-10-18T15:32:28.333Z</td></tr><tr><td>bt4g(bt4g)</td><td><p>Всё отлично, всё работает спасибо что поправили контейнер!</p></td><td>2019-10-20T19:30:31.441Z</td></tr><tr><td>Protey</td><td><p>подскажите как быть<br>
после всех этих команд</p>
<details>
<summary>
Сводка</summary>
<p>sudo lxc image import <a href="https://antizapret.prostovpn.org/container-images/az-vpn" rel="noopener nofollow ugc">https://antizapret.prostovpn.org/container-images/az-vpn</a> --alias antizapret-vpn-img<br>
sudo lxc init antizapret-vpn-img antizapret-vpn<br>
sudo lxc config device add antizapret-vpn proxy_1194 proxy listen=tcp:[::]:1194 connect=tcp:127.0.0.1:1194<br>
sudo lxc start antizapret-vpn<br>
sleep 10</p>
</details>
<p>после этой команды<br>
sudo lxc file pull antizapret-vpn/root/easy-rsa-ipsec/CLIENT_KEY/antizapret-client-tcp.ovpn antizapret-client-tcp.ovpn<br>
выдает ошибку<br>
Error: not found</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/14bbf7ca89d379833a46048ec521c08bc602ddcf.jpeg" data-download-href="https://ntc.party/uploads/default/14bbf7ca89d379833a46048ec521c08bc602ddcf" title="vpn"><img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/14bbf7ca89d379833a46048ec521c08bc602ddcf_2_690x436.jpeg" alt="vpn" data-base62-sha1="2XqgFsFiuWlhbsM0Bbkj1ck2j8z" width="690" height="436" srcset="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/14bbf7ca89d379833a46048ec521c08bc602ddcf_2_690x436.jpeg, контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/14bbf7ca89d379833a46048ec521c08bc602ddcf_2_1035x654.jpeg 1.5x, контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/14bbf7ca89d379833a46048ec521c08bc602ddcf.jpeg 2x" data-dominant-color="181718"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">vpn</span><span class="informations">1100×696 380 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p></td><td>2019-11-05T20:21:35.365Z</td></tr><tr><td>ValdikSS</td><td><p>Зайдите в контейнер командой:<br>
<code>sudo lxc exec antizapret-vpn bash</code><br>
И выполните:<br>
<code>systemctl status openvpn-generate-keys</code></p>
<p>Вывод команды опубликуйте сюда.</p></td><td>2019-11-06T02:25:28.662Z</td></tr><tr><td>Protey</td><td><p><div class="lightbox-wrapper"><a class="lightbox" href="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/4ca24ae9c8ff9103a86e307baea7d62e81f02c16.jpeg" data-download-href="https://ntc.party/uploads/default/4ca24ae9c8ff9103a86e307baea7d62e81f02c16" title="vpn1"><img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/4ca24ae9c8ff9103a86e307baea7d62e81f02c16_2_690x415.jpeg" alt="vpn1" data-base62-sha1="aVVZSJvQl0yZJMUefmk68Lp2xgi" width="690" height="415" srcset="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/4ca24ae9c8ff9103a86e307baea7d62e81f02c16_2_690x415.jpeg, контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/4ca24ae9c8ff9103a86e307baea7d62e81f02c16_2_1035x622.jpeg 1.5x, контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/4ca24ae9c8ff9103a86e307baea7d62e81f02c16.jpeg 2x" data-dominant-color="111111"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">vpn1</span><span class="informations">1150×693 229 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p></td><td>2019-11-06T02:47:03.612Z</td></tr><tr><td>ValdikSS</td><td><p>Видимо, у вас в контейнере нет сети. <code>curl icanhazip.com</code> что-то выводит? <code>ip a</code> показывает IP-адрес?</p></td><td>2019-11-06T02:49:44.757Z</td></tr><tr><td>Protey</td><td><p><div class="lightbox-wrapper"><a class="lightbox" href="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/3df37de91faca021852b6087a916b98651bdb01a.jpeg" data-download-href="https://ntc.party/uploads/default/3df37de91faca021852b6087a916b98651bdb01a" title="vpn2"><img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/3df37de91faca021852b6087a916b98651bdb01a_2_690x416.jpeg" alt="vpn2" data-base62-sha1="8Q2NSI3cFMq4ooin54JKUw2mPR8" width="690" height="416" srcset="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/3df37de91faca021852b6087a916b98651bdb01a_2_690x416.jpeg, контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/3df37de91faca021852b6087a916b98651bdb01a_2_1035x624.jpeg 1.5x, контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/3df37de91faca021852b6087a916b98651bdb01a.jpeg 2x" data-dominant-color="151415"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">vpn2</span><span class="informations">1149×693 321 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p></td><td>2019-11-06T03:00:10.869Z</td></tr><tr><td>ValdikSS</td><td><p>Видимо, сеть медленно поднимается, или еще что. Попробуйте просто позапускать контейнер несколько раз, либо запустите <code>/root/easy-rsa-ipsec/generate.sh</code> вручную.</p></td><td>2019-11-06T03:04:26.638Z</td></tr><tr><td>Protey</td><td><p>может я не так запускаю контейнер, но мне всегда говорится одно и то же, что он уже запущен (The container is already running)</p>
<pre><code>robo@1-23-456-789:~# sudo lxc start antizapret-vpn
Error: Common start logic: The container is already running
robo@1-23-456-789:~#</code></pre></td><td>2019-11-06T03:10:11.998Z</td></tr><tr><td>Protey</td><td><p>robo@1-23-456-789:~# /root/easy-rsa-ipsec/generate.sh<br>
-bash: /root/easy-rsa-ipsec/generate.sh: No such file or directory</p></td><td>2019-11-06T03:11:46.299Z</td></tr><tr><td>ValdikSS</td><td><p>Остановите его командой stop и запустите командой start, или, лучше, запустите <code>/root/easy-rsa-ipsec/generate.sh</code> вручную:</p>
<pre><code class="lang-auto">sudo lxc exec antizapret-vpn bash
cd /root/easy-rsa-ipsec/
./generate.sh
</code></pre>
<p>Скорее всего, с antizapret-update будет такая же проблема.</p></td><td>2019-11-06T03:12:52.886Z</td></tr><tr><td>Protey</td><td><aside class="quote no-group" data-username="Protey" data-post="24" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/p/71e660/48.png" class="avatar"> Protey:</div>
<blockquote>
<p>/root/easy-rsa-ipsec/</p>
</blockquote>
</aside>
<p>и к стати, этой директории<code> /root/easy-rsa-ipsec/</code> действительно нету<br>
<div class="lightbox-wrapper"><a class="lightbox" href="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/b86461d00d64b6347268ee3cf71cdad67addfaad.jpeg" data-download-href="https://ntc.party/uploads/default/b86461d00d64b6347268ee3cf71cdad67addfaad" title="vpn3"><img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/b86461d00d64b6347268ee3cf71cdad67addfaad_2_405x500.jpeg" alt="vpn3" data-base62-sha1="qjcVaR55imT6jMKea090Tkr0s1f" width="405" height="500" srcset="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/b86461d00d64b6347268ee3cf71cdad67addfaad_2_405x500.jpeg, контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/b86461d00d64b6347268ee3cf71cdad67addfaad.jpeg 1.5x, контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/b86461d00d64b6347268ee3cf71cdad67addfaad.jpeg 2x" data-dominant-color="F8F9F9"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">vpn3</span><span class="informations">563×695 73.7 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p></td><td>2019-11-06T03:14:15.627Z</td></tr><tr><td>Protey</td><td><pre><code>robo@1-23-456-789:~# sudo lxc stop antizapret-vpn
robo@1-23-456-789:~# sudo lxc start antizapret-vpn
robo@1-23-456-789:~# /root/easy-rsa-ipsec/generate.sh
-bash: /root/easy-rsa-ipsec/generate.sh: No such file or directory
robo@1-23-456-789:~# sudo lxc exec antizapret-vpn bash
cd /root/easy-rsa-ipsec/
./generate.shroot@antizapret-vpn:~# cd /root/easy-rsa-ipsec/
root@antizapret-vpn:~/easy-rsa-ipsec# ./generate.sh
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0curl: (6) Could not resolve host: icanhazip.com
robo@antizapret-vpn:~/easy-rsa-ipsec#</code></pre></td><td>2019-11-06T03:23:54.199Z</td></tr><tr><td>ValdikSS</td><td><p>Вы выполнили <code>curl icanhazip.com</code> на хосте, а не в контейнере. Я подозреваю, что в контейнере либо нет интернета, либо проблемы с DNS.<br>
Аналогично с вашей попыткой подключения через SFTP — вы видите файлы на хостовой машине, а не файлы контейнера.</p>
<p>Зайдите в контейнер и разберитесь, по какой причине в нём проблемы с интернетом или DNS.</p></td><td>2019-11-06T05:17:41.694Z</td></tr><tr><td>Protey</td><td><p>Сделал проверку через контейнер, и, не буду утверждать, так как плохо разбираюсь в линукс системах, но по моему после <code>ip a</code> показало что интернет есть.</p>
<details>
<summary>
Сводка</summary>
<pre><code>robo@1-23-456-789:~# sudo lxc exec antizapret-vpn bash
root@antizapret-vpn:~# curl icanhazip.com
curl: (6) Could not resolve host: icanhazip.com
root@antizapret-vpn:~# ip a
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host
       valid_lft forever preferred_lft forever
7: eth0@if8: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000
    link/ether 00:46:3e:18:c1:fe brd ff:ff:ff:ff:ff:ff link-netnsid 0
    inet6 fd42:5876:98cb:1eb:587:3eff:fe14:c1fe/64 scope global dynamic mngtmpaddr
       valid_lft 3470sec preferred_lft 3470sec
    inet6 fe80::892:3eff:fe28:c1fe/64 scope link
       valid_lft forever preferred_lft forever
robo@antizapret-vpn:~#
</code></pre>
</details></td><td>2019-11-06T11:58:54.085Z</td></tr><tr><td>ValdikSS</td><td><p>В контейнере нет IPv4-адреса на интерфейсе. Скорее всего, это проблема на стороне хоста, но не знаю, в чем конкретно. Нужно детально смотреть настройки lxd, сети и iptables.</p></td><td>2019-11-06T14:40:20.401Z</td></tr><tr><td>Protey</td><td><p>можете помочь разобраться, а то я даже не знаю куда и как копать, так как с линукс системами можно сказать вообще не знаком?<br>
если вдруг не откажите помочь - где найти эти детальные настройки lxd сети и iptables чтобы вы могли посмотреть и помочь разобраться с проблемой?<br>
на всякий случай - система Ubuntu 18.04 LTS</p></td><td>2019-11-06T16:59:13.494Z</td></tr><tr><td>Protey</td><td><p>к стати что самое интересное, по крайне мере для меня<br>
создал еще один контейнер под именем <code>easy-imp</code> через команду <code>lxc launch ubuntu:16.04</code>, и в нем как не странно есть ipv4, а в antizapret-vpn как не было так и нет<br>
<div class="lightbox-wrapper"><a class="lightbox" href="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/fcad69822ae75e827229108f01ac49348b8f15b4.jpeg" data-download-href="https://ntc.party/uploads/default/fcad69822ae75e827229108f01ac49348b8f15b4" title="lxd"><img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/fcad69822ae75e827229108f01ac49348b8f15b4_2_690x236.jpeg" alt="lxd" data-base62-sha1="A3hR5Pldj3GVnVEsAud0HXwM5Eg" width="690" height="236" srcset="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/fcad69822ae75e827229108f01ac49348b8f15b4_2_690x236.jpeg, контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/fcad69822ae75e827229108f01ac49348b8f15b4_2_1035x354.jpeg 1.5x, контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/fcad69822ae75e827229108f01ac49348b8f15b4.jpeg 2x" data-dominant-color="090809"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">lxd</span><span class="informations">1319×452 227 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p></td><td>2019-11-06T17:17:58.236Z</td></tr><tr><td>ValdikSS</td><td><p>Я не знаю, в чем может быть проблема. Посмотрите статус и журнал демона systemd-networkd, он управляет сетью: <code>systemctl status systemd-networkd</code>, воспользуйтесь <code>networkctl</code>, чтобы посмотреть состояние соединения и перезапустить сетевое подключение. Проверьте общий журнал с помощью команды <code>journalctl -b -e</code>, может, он натолкнет на мысли.<br>
У меня небольшой опыт работы с LXD, тяжело сказать, что может быть не так. Вполне допускаю, что могут быть неправильные настройки в самом контейнере, но я тестировал тоже на Ubuntu 18.04, и у меня работало. Могу предложить вам платно настроить контейнер на вашем сервере.</p></td><td>2019-11-06T18:15:57.577Z</td></tr><tr><td>runalsh(runalsh)</td><td><p>Как на счет добавления wireguard ?</p></td><td>2019-11-12T10:48:41.982Z</td></tr><tr><td>ValdikSS</td><td><p>На текущий момент развития, Wireguard — просто туннель, как GRE или IPIP, который не имеет функциональность передачи настроек клиенту (IP-адрес, маршруты, DNS-сервер, различные опции). Туннель настраивается с обеих сторон, и любые изменения конфигурации (маршрутов, например) будут требовать изменения с обеих сторон. Это совершенно непрактично.<br>
Wireguard не предназначен для VPN-<em>сервисов</em>, и в текущем его виде может быть использован только для создания приватных туннелей.</p></td><td>2019-11-12T14:07:28.081Z</td></tr><tr><td>Dimasmir(Дмитрий Смирнов)</td><td><p>Приветствую.<br>
Насколько я понял, прокси-сервер антизапрета в контейнер не входит. Планируется ли его туда добавить?</p></td><td>2019-11-14T09:57:15.566Z</td></tr><tr><td>Evil_G</td><td><p>Нашел решение тут: <a href="https://serverfault.com/questions/745854/cant-get-systemd-networkd-to-start-successfully" rel="nofollow noopener">https://serverfault.com/questions/745854/cant-get-systemd-networkd-to-start-successfully</a><br>
upd: То же необходимо проделать и с /etc/systemd/system/multi-user.target.wants/openvpn-server@antizapret.service</p></td><td>2019-11-14T18:52:14.360Z</td></tr><tr><td>ValdikSS</td><td><p>Нет, это контейнер с VPN. В прокси антизапрета нет каких-то особенных технологий или настроек, выкладывать его нецелесообразно.</p></td><td>2019-11-14T18:53:08.014Z</td></tr><tr><td>nzkhammatov(Ainur Khammatov)</td><td><aside class="onebox githubrepo" data-onebox-src="https://github.com/AdguardTeam/AdGuardHome">
  <header class="source">

      <a href="https://github.com/AdguardTeam/AdGuardHome" target="_blank" rel="noopener nofollow ugc">github.com</a>
  </header>

  <article class="onebox-body">
    <div class="github-row" data-github-private-repo="false">
  <img width="690" height="344" src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/fc3f37ec5c917a2094e737f7f281aa6938c07d7c_2_690x344.png" class="thumbnail" data-dominant-color="E8EFEF">

  <h3><a href="https://github.com/AdguardTeam/AdGuardHome" target="_blank" rel="noopener nofollow ugc">GitHub - AdguardTeam/AdGuardHome: Network-wide ads &amp; trackers blocking DNS server</a></h3>

    <p><span class="github-repo-description">Network-wide ads &amp; trackers blocking DNS server</span></p>
</div>

  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>
<p>
До начала использования контейнера,использовал только этот продукт по ссылке, для DOH,DOT и фильтрации рекламы. Какое-то, очень недолгое время он помогал обходить некоторые блокировки.<br>
Есть ли возможность не повредив функционал VPN сервера начать использовать их вместе на одном VPS сервере?<br>
Чтобы после подключения к VPN на домашнем компьютере, работал обход, работал фильтр рекламных доменов.</p></td><td>2020-03-28T16:47:54.087Z</td></tr><tr><td>ValdikSS</td><td><p>Полагаю, что можно. В файл <code>/etc/knot-resolver/kresd.conf</code>, в самый конец добавьте следующую строку:</p>
<pre><code class="lang-auto">policy.add(policy.all(policy.FORWARD({'192.0.2.1'})))
</code></pre>
<p>Где <code>192.0.2.1</code> — IP-адрес DNS-сервера AdGuard. Контейнер с VPN антизапрета должен иметь доступ до этого IP-адреса.</p></td><td>2020-03-28T17:04:44.916Z</td></tr><tr><td>nzkhammatov(Ainur Khammatov)</td><td><p>Конструкция заработала, спасибо за помощь.</p></td><td>2020-03-29T12:39:17.520Z</td></tr><tr><td>zald(alex)</td><td><p>Не понимаю как раз с настройкой lxd.<br>
Делаю lxd init. Всё по умолчанию выбрал. После первой команды sudo lxc image import <a href="https://antizapret.prostovpn.org/container-images/az-vpn" rel="nofollow noopener">https://antizapret.prostovpn.org/container-images/az-vpn</a> --alias antizapret-vpn-img<br>
Я получаю Error: Metadata file is required. Что я делаю не так?</p>
<p>Сервер Aruba Cloud. Там реализация VMWare. Ubuntu 18.04 LTS.</p></td><td>2020-04-03T17:26:12.170Z</td></tr><tr><td>ValdikSS</td><td><p>Возможно, у вас слишком старая версия LXD, которой нужно передавать на импорт два файла. Попробуйте установить версию из snap, она новее.</p></td><td>2020-04-03T18:10:55.670Z</td></tr><tr><td>zald(alex)</td><td><p>Я обновил lxd. Прошел дальше первого шага и застопорился на последнем.<br>
Не могу понять почему в конце не хочет создать сам файл.</p>
<p>Мануал то вроде понятнее некуда, но вот ошибки удивляют самого.</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/3b05329d29c8488302199b2b52bbdd51f0b024f1.png" data-download-href="https://ntc.party/uploads/default/3b05329d29c8488302199b2b52bbdd51f0b024f1" title="image"><img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/3b05329d29c8488302199b2b52bbdd51f0b024f1.png" alt="image" data-base62-sha1="8q7j1l3Wq5008OiJ9YstCFhNPbj" width="676" height="500" data-dominant-color="181A1B"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">732×541 42.7 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p></td><td>2020-04-03T18:21:08.886Z</td></tr><tr><td>ValdikSS</td><td><p>Что-то не запустилось, ключи не сгенерировались. Зайдите в контейнер и посмотрите журнал:</p>
<pre><code class="lang-auto">lxc exec antizapret-vpn bash
journalctl -u openvpn-generate-keys -e
</code></pre>
<p>В контейнере должен быть работающий интернет, чтобы ключи сгенерировались (делается запрос на сервис получения внешнего IP-адреса, чтобы добавить его в конфигурационный файл). LXD по умолчанию пробрасывает интернет в контейнер.</p></td><td>2020-04-03T18:34:09.392Z</td></tr><tr><td>zald(alex)</td><td><aside class="quote no-group" data-username="ValdikSS" data-post="45" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/valdikss/48/2_2.png" class="avatar"> ValdikSS:</div>
<blockquote>
<p>journalctl -u openvpn-generate-keys -e</p>
</blockquote>
</aside>
<p><img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/c33380a14adfa00b56d7e68f76bab7cd89d0f658.png" alt="image" data-base62-sha1="rQPrULzpyNn19k4TZXliXKcWwoo" width="667" height="432"></p></td><td>2020-04-04T06:45:07.659Z</td></tr><tr><td>ValdikSS</td><td><p>Что-то не работает. Запустите <code>/root/easy-rsa-ipsec/generate.sh</code> вручную, поотлаживайте.</p></td><td>2020-04-04T07:35:44.458Z</td></tr><tr><td>zald(alex)</td><td><aside class="quote no-group" data-username="ValdikSS" data-post="25" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/valdikss/48/2_2.png" class="avatar"> ValdikSS:</div>
<blockquote>
<p>./generate.sh</p>
</blockquote>
</aside>
<p>Полистав ветку удалось понять, что делают не так. Теперь поднимаю вручную generate.sh в контейнере и получаю это.<br>
<img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/2f51d7d8dc3e65b3a4b256e9ff2429214cf94444.png" alt="image" data-base62-sha1="6KBMVU62gVNiOPL8kUkKOJ3AxEw" width="636" height="212"></p>
<p>Причем если шагать через vpn с этого сервера на <a href="http://icanhazip.com/" rel="noopener nofollow ugc">http://icanhazip.com/</a> получаю свой ип сервера.</p>
<p>Сначала думал, что сеть долго поднимается, но я прождал достаточно долго минут 20 и эта же проблема.</p></td><td>2020-04-04T11:30:13.719Z</td></tr><tr><td>zald(alex)</td><td><p>Опять же я проверял есть ли интернет на контейнере.<br>
По сути есть <img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/287a7a55e64fb7f6860550827a16dd9bd7421a16.png" alt="image" data-base62-sha1="5M5voNu8AJpZvpFF6PKBHcxNVwG" width="658" height="177"></p></td><td>2020-04-04T11:38:50.344Z</td></tr><tr><td>zald(alex)</td><td><p>Пока натолкнуло на мысли, что проблема с правами<br>
<img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/79cf8d9da96ace752893a6ee5de912d24196a150.png" alt="image" data-base62-sha1="hnAsbokrbkBuMBpjf8jmsSoNPOM" width="640" height="307"></p></td><td>2020-04-04T11:41:54.746Z</td></tr><tr><td>ValdikSS</td><td><p>Какая у вас версия ядра на хост-машине?</p></td><td>2020-04-04T11:53:47.081Z</td></tr><tr><td>zald(alex)</td><td><p>4.15.0-91-generic</p></td><td>2020-04-04T12:05:09.056Z</td></tr><tr><td>ValdikSS</td><td><p>По всей видимости, у вас неправильно настроено ядро, или, возможно, вы наткнулись на ошибку в LXD. Самое простое — прописать в <code>/etc/systemd/system/openvpn-server@.service.d/override.conf</code>:</p>
<pre><code class="lang-auto">[Service]
LimitNPROC=infinity
PrivateTmp=false
CapabilityBoundingSet=
DeviceAllow=
ProtectSystem=false
ProtectHome=false
</code></pre>
<p>И перезапустить контейнер.</p></td><td>2020-04-04T12:22:50.086Z</td></tr><tr><td>zald(alex)</td><td><p>Я бы с радостью, но данного пути вообще нет. Много раз переустанавливал уже Ubuntu Server 18.04 пытаясь побороться.<br>
Есть ли вариант запустить на debian?<br>
Может есть список серверов где работа контейнера тестировалась и запускается 100%?<br>
Сколько стоит заплатить Вам, чтоб помогли решить проблему лично?</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/81b0ca4dd5cd30bcc53415b823147a7ef4e62736.png" data-download-href="https://ntc.party/uploads/default/81b0ca4dd5cd30bcc53415b823147a7ef4e62736" title="image"><img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/81b0ca4dd5cd30bcc53415b823147a7ef4e62736.png" alt="image" data-base62-sha1="ivimDg7DVVySvEd42I6P66vP7v0" width="421" height="500" data-dominant-color="EEEDED"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">620×736 41.3 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p></td><td>2020-04-04T12:32:00.855Z</td></tr><tr><td>ValdikSS</td><td><p>Я написал путь внутри контейнера, а вы смотрите файлы на хост-машине. Файлы внутри в принципе можно видеть и редактировать на хосте, но это может вызвать проблемы с правами на файлы.</p>
<p>Зайдите в контейнер командой <code>lxc exec antizapret-vpn bash</code>, и отредактируйте файл редактором nano.</p>
<p>Хост ОС, вообще говоря, не должна влиять на контейнер. То, что у вас появляются ошибки с namespace — исключительный случай, вызванный, вероятно, особенностями Aruba Cloud.</p>
<p>Если не справитесь, отправляйте данные для входа на сервер на <a href="mailto:iam@valdikss.org.ru">iam@valdikss.org.ru</a>. Уверен, всё можно починить за 10 минут. Но сначала попробуйте сами.</p></td><td>2020-04-04T12:44:00.022Z</td></tr><tr><td>zald(alex)</td><td><p>Всё также не резолвится  <a href="http://icanhazip.com" rel="nofollow noopener">icanhazip.com</a>. Но пока помучаю сам, а потом напишу. Почту сохранил.</p></td><td>2020-04-04T13:20:48.011Z</td></tr><tr><td>ValdikSS</td><td><p>Если получаете на Ubuntu 18.04 ошибки типа:</p>
<pre><code class="lang-auto">systemd-networkd.service: Failed to set up mount namespacing: Permission denied
systemd-networkd.service: Failed at step NAMESPACE spawning /lib/systemd/systemd-networkd: Permission denied 
</code></pre>
<p>то варианта два:</p>
<ul>
<li>Установить версию lxd из snap, а не из репозиториев</li>
<li>Применить следующую команду:</li>
</ul>
<pre><code class="lang-auto">lxc config set antizapret-vpn raw.apparmor 'mount options=(ro,nodev,remount,bind), mount options=(ro,nosuid,nodev,remount,bind), mount options=(ro,nosuid,noexec,remount,strictatime), mount options=(ro,nosuid,noexec,remount,bind,strictatime), mount options=(ro,nosuid,nodev,noexec,remount,bind),' 
</code></pre>
<p>Проблема вызвана ошибкой совместимости с AppArmor: <a href="https://bugs.launchpad.net/ubuntu/+source/apparmor/+bug/1811248">https://bugs.launchpad.net/ubuntu/+source/apparmor/+bug/1811248</a></p></td><td>2020-04-15T15:17:00.048Z</td></tr><tr><td>dimez</td><td><p>После применения команды ошибки с NAMESPACE уходят, ip получается, ключ генерится, openvpn запускается.</p></td><td>2020-04-15T15:23:40.566Z</td></tr><tr><td>cerwcrwewre(wexqweqxc)</td><td><p>Вы разобрались с отсутствием IPv4 в контейнере? Я пытаюсь поднять на овх, та же самая проблема. В линуксе ноль.</p></td><td>2020-05-10T19:05:04.100Z</td></tr><tr><td>Protey</td><td><p>увы, нет, так и не разобрался.</p></td><td>2020-05-10T19:41:48.116Z</td></tr><tr><td>ValdikSS</td><td><p>Обновил содержимое контейнера и сам контейнер (26.05.2020):</p>
<ul>
<li>Генератор блеклиста теперь используется из репозитория <a href="https://bitbucket.org/anticensority/antizapret-pac-generator-light/src">antizapret-pac-generator-light</a> (ранее использовался он же, но немного модифицированный и устаревший)</li>
<li>Обновлён knot-resolver до пятой версии</li>
<li>Исправлены ошибки при старте контейнера, связанные с DNS</li>
<li>Полная поддержка systemd-machined, инструкция в репозитории</li>
</ul></td><td>2020-05-25T21:49:09.074Z</td></tr><tr><td>kirill</td><td><p>Доброго времени суток</p>
<p>Почему используется <code>proto tcp</code>, а не <code>udp</code>?</p></td><td>2020-06-09T08:43:49.806Z</td></tr><tr><td>ValdikSS</td><td><p>Потому что для TCP можно сделать keep-alive гораздо реже, что положительно сказывается на заряде аккумулятора мобильных устройств.</p></td><td>2020-06-09T09:04:15.045Z</td></tr><tr><td>kirill</td><td><p>ок</p>
<p>а самостоятельно изменить настройки в контейнере под udp можно?<br>
если Да, то как?</p>
<p>P.s.: я сравнил два конфига в ./easy-rsa-ipsec/CLIENT_KEY/<br>
<code>antizapret-client-tcp.ovpn</code> и <code>antizapret-client-udp.ovpn</code><br>
в одном есть/нет <code>cipher AES-128-CBC</code>, в другом - <code>comp-lzo</code><br>
второй, ессно, не работает</p></td><td>2020-06-09T09:17:44.993Z</td></tr><tr><td>ValdikSS</td><td><p>Что именно у вас не работает? Я тестировал конфигурацию UDP, она рабочая, насколько помню. Конфигурации отличаются, так и должно быть, это не ошибка.</p></td><td>2020-06-09T09:29:10.286Z</td></tr><tr><td>kirill</td><td><p>не знаю, у меня в логах openvpn пишет</p>
<pre><code>Tue Jun 09 12:30:42 2020 read UDP: Unknown error (code=10054)
Tue Jun 09 12:30:43 2020 read UDP: Unknown error (code=10054)
Tue Jun 09 12:30:47 2020 read UDP: Unknown error (code=10054)</code></pre></td><td>2020-06-09T09:31:28.260Z</td></tr><tr><td>ValdikSS</td><td><p>Если вы устанавливали через LXD, я в инструкции забыл написать проброс UDP-порта. Выполните:</p>
<p><code>lxc config device add antizapret-vpn proxy_1194_udp proxy listen=udp:[::]:1194 connect=udp:127.0.0.1:1194</code></p></td><td>2020-06-09T09:32:48.241Z</td></tr><tr><td>kirill</td><td><p>да, теперь всё ОК,<br>
благодарю!</p></td><td>2020-06-09T09:35:13.641Z</td></tr><tr><td>kirill</td><td><p>и да, в логах постоянно предупреждение об отсутствии в конфиге<br>
<code>auth-nocache</code></p>
<p>так задумано?</p></td><td>2020-06-09T09:38:58.473Z</td></tr><tr><td>ValdikSS</td><td><p>Это фиктивное предупреждение, в конфигурационном файле не используется аутентификация по логину и паролю. Добавьте <code>auth-nocache</code> в ваш файл, если вас это предупреждение смущает.</p></td><td>2020-06-09T09:41:14.517Z</td></tr><tr><td>kirill</td><td><p>уже)<br>
но спасибо за пояснение для чайников <img src="https://ntc.party/images/emoji/twitter/handshake.png?v=12" title=":handshake:" class="emoji" alt=":handshake:" loading="lazy" width="20" height="20"></p>
<p>и ещё, чтобы я уже окончательно отстал))<br>
я раньше юзал скрипт автонастройки <a href="https://github.com/angristan/openvpn-install" class="inline-onebox" rel="noopener nofollow ugc">GitHub - angristan/openvpn-install: Set up your own OpenVPN server on Debian, Ubuntu, Fedora, CentOS or Arch Linux.</a><br>
у вас в контейнере используется необходимое/достаточное шифрование (не для параноиков вопрос, а интереса ради)? )))</p></td><td>2020-06-09T09:44:29.925Z</td></tr><tr><td>ValdikSS</td><td><p>Шифрование трафика надёжное. Для TCP используется AES-128, для UDP — Blowfish-64. Последний считается уязвимым, если у злоумышленника есть возможность захвата большого количества трафика, но OpenVPN меняет ключ каждые несколько десятков мегабайт, чтобы предотвратить подобную атаку.</p>
<p>Я не рекомендую использовать UDP-конфигурацию. Она устаревшая и оставлена для совместимости с клиентами, которые много лет не перекачивали конфигурацию с сайта. Актуальная конфигурация — TCP.<br>
Поменяйте настройки шифра и отключите comp-lzo у себя, если хотите использовать UDP.</p></td><td>2020-06-09T10:20:06.465Z</td></tr><tr><td>kirill</td><td><blockquote>
<p>Она устаревшая и оставлена для совместимости с клиентами, которые много лет не перекачивали конфигурацию с сайта</p>
</blockquote>
<p>ну дык это ж контейнер для личного сервера; полагаю, тут такие условности ни к чему</p>
<blockquote>
<p>Поменяйте настройки шифра и отключите comp-lzo у себя, если хотите использовать UDP</p>
</blockquote>
<p>Не знаю, правильно ли я сделал, но я в конфиге контейнера<br>
<code>/etc/openvpn/server/antizapret.conf</code><br>
добавил<br>
<code>cipher AES-128-GCM</code><br>
убрал<br>
<code>comp-lzo</code><br>
изменил<br>
<code>ncp-ciphers AES-128-GCM</code></p>
<p>в конфиге <code>antizapret-client-udp.ovpn</code><br>
добавил<br>
<code>auth-nocache</code><br>
<code>cipher AES-128-GCM</code><br>
убрал<br>
<code>comp-lzo</code></p></td><td>2020-06-09T12:54:11.148Z</td></tr><tr><td>shivam</td><td><p>Здравствуйте! Скачал, запустил контейнер - работает.<br>
Хочу использовать adguard dns, чтобы видеть меньше рекламы<br>
роутер зухель (speedtester без usb=без opkg) корректно работает только в случае указания 192.168.104.1 в качестве единственного dns<br>
в /root/dnsmap/proxy.py<br>
указал p.add_argument("–upstream","-u",default=“94.140.15.15:53”,<br>
в resolv.conf тоже<br>
Всё равно остаётся очучение, что используется google dns<br>
1)как точно это проверить?<br>
2)как и где ещё вписать adguard dns?</p></td><td>2020-10-07T12:12:32.327Z</td></tr><tr><td>ValdikSS</td><td><aside class="quote" data-post="40" data-topic="129">
  <div class="title">
    <div class="quote-controls"></div>
    <img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/valdikss/48/2_2.png" class="avatar">
    <a href="https://ntc.party/t/vpn/129/40">Контейнер VPN АнтиЗапрета для установки на собственный сервер</a> <a class="badge-category__wrapper " href="/c/antizapret-prostovpn-org/az-self-hosted/38"><span data-category-id="38" style="--category-badge-color: #0088CC; --category-badge-text-color: #FFFFFF; --parent-category-badge-color: #8C6238;" data-parent-category-id="5" data-drop-close="true" class="badge-category --has-parent" title="Вопросы и особенности работы контейнера VPN АнтиЗапрета на своих серверах"><span class="badge-category__name">АнтиЗапрет на собственном сервере (self-hosted)</span></span></a>
  </div>
  <blockquote>
    Полагаю, что можно. В файл /etc/knot-resolver/kresd.conf, в самый конец добавьте следующую строку: 
policy.add(policy.all(policy.FORWARD({'192.0.2.1'})))

Где 192.0.2.1 — IP-адрес DNS-сервера AdGuard. Контейнер с VPN антизапрета должен иметь доступ до этого IP-адреса.
  </blockquote>
</aside>
</td><td>2020-10-07T18:53:12.401Z</td></tr><tr><td>magratsk(Mikhail)</td><td><p>Возможно поможет вам, а также другим, у кого проблемы с наличием интернета внутри контейнера. Также потратил какое-то время, пока не нашел решение.</p>
<p>Проблема заключается в использовании ufw в качестве фаервола в Ubuntu. Подробно описано здесь:</p><aside class="onebox discoursetopic" data-onebox-src="https://discuss.linuxcontainers.org/t/lxd-bridge-doesnt-work-with-ipv4-and-ufw-with-nftables/10034/15">
  <header class="source">
      <img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/95a518e9dc52e776282fe18576c8240d2bb1c2a7.png" class="site-icon" data-dominant-color="967569" width="32" height="32">

      <a href="https://discuss.linuxcontainers.org/t/lxd-bridge-doesnt-work-with-ipv4-and-ufw-with-nftables/10034/15" target="_blank" rel="noopener nofollow ugc" title="07:05PM - 25 January 2021">Linux Containers Forum – 25 Jan 21</a>
  </header>

  <article class="onebox-body">
    <img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/c1153376e1c1ae174158de701786c381bfe6e8ea_2_500x500.png" class="thumbnail onebox-avatar" data-dominant-color="967468" width="500" height="500">

<div class="title-wrapper">
  <h3><a href="https://discuss.linuxcontainers.org/t/lxd-bridge-doesnt-work-with-ipv4-and-ufw-with-nftables/10034/15" target="_blank" rel="noopener nofollow ugc">Lxd bridge doesn't work with IPv4 and UFW with nftables</a></h3>
  <div class="topic-category">
      <span class="badge-wrapper bullet">
        <span class="badge-category-bg" style="background-color: #F1592A;"></span>
        <span class="badge-category clear-badge">
          <span class="category-name">LXD</span>
        </span>
      </span>
  </div>
</div>

  <p>@stgraber So for example LXD creates this:  table ip lxd { 	chain in.lxdbr0 { 		type filter hook input priority 0; policy accept; 		iifname "lxdbr0" tcp dport 53 accept 		iifname "lxdbr0" udp dport 53 accept 		iifname "lxdbr0" udp dport 67 accept...</p>


  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>
<p>
Читал по диагонали, но похоже, что ufw по-умолчанию не пробрасывает порты внутрь контейнера.<br>
У меня такое было актуально на Ubuntu 20.04</p>
<p>Самое простое решение - прописать правила для сетевого интерфейса контейнера - lxdbr0:</p>
<pre><code class="lang-auto">sudo ufw allow in on lxdbr0
sudo ufw route allow in on lxdbr0
</code></pre>
<p>Ну и само собой, порт для подключения клиентов должен быть открыт:<br>
<code>sudo ufw allow 1194</code><br>
У меня после этого всё заработало.</p></td><td>2021-12-04T21:11:04.640Z</td></tr><tr><td>mostm</td><td><p>На данный момент, чтобы Knot Resolver принимал ответы от AdGuard Home необходимо так же прописать отключение проверок DNSSEC: <code>trust_anchors.remove('.')</code><br>
Без этого, <code>dig google.com @127.0.0.1</code> внутри контейнера возвращает <code>SERVFAIL</code>, соответственно работать не будет.<br>
(лог запроса в моем случае:</p>
<pre><code class="lang-auto">[plan] plan 'google.com.' type 'A' uid [58041.00]
[iter]   'google.com.' type 'A' new uid was assigned .01, parent uid .00
[cach]   =&gt; skipping exact RR: rank 030 (min. 030), new TTL -9724
[cach]   =&gt; no NSEC* cached for zone: google.com.
[cach]   =&gt; skipping zone: google.com., NSEC, hash 0;new TTL -123456789, ret -2
[plan]   plan '.' type 'DNSKEY' uid [58041.02]
[iter]     '.' type 'DNSKEY' new uid was assigned .03, parent uid .01
[cach]     =&gt; satisfied by exact RRset: rank 060, new TTL 159019
[iter]     &lt;= rcode: NOERROR
[vldr]     &lt;= parent: updating DNSKEY
[vldr]     &lt;= answer valid, OK
[iter]   'google.com.' type 'A' new uid was assigned .04, parent uid .00
[plan]   plan 'com.' type 'DS' uid [58041.05]
[iter]     'com.' type 'DS' new uid was assigned .06, parent uid .04
[cach]     =&gt; satisfied by exact RRset: rank 060, new TTL 72803
[iter]     &lt;= rcode: NOERROR
[vldr]     &lt;= DS: OK
[vldr]     &lt;= parent: updating DS
[vldr]     &lt;= answer valid, OK
[iter]   'google.com.' type 'A' new uid was assigned .07, parent uid .00
[plan]   plan 'com.' type 'DNSKEY' uid [58041.08]
[iter]     'com.' type 'DNSKEY' new uid was assigned .09, parent uid .07
[cach]     =&gt; satisfied by exact RRset: rank 060, new TTL 72803
[iter]     &lt;= rcode: NOERROR
[vldr]     &lt;= parent: updating DNSKEY
[vldr]     &lt;= answer valid, OK
[iter]   'google.com.' type 'A' new uid was assigned .10, parent uid .00
[nsre] score 21 for 185.93.109.76#00053;         cached RTT: -1
[resl]   =&gt; id: '13851' querying: '185.93.109.76#00053' score: 21 zone cut: 'com.' qname: 'gOOgLE.COm.' qtype: 'A' proto: 'udp'
[resl]   =&gt; id: '13851' querying: '185.93.109.76#00053' score: 21 zone cut: 'com.' qname: 'gOOgLE.COm.' qtype: 'A' proto: 'udp'
[iter]   &lt;= ignoring mismatching response from 185.93.109.76#00053
[vldr]   &lt;= bogus proof of DS non-existence
[iter]   'google.com.' type 'A' new uid was assigned .11, parent uid .00
[resl]   =&gt; no valid NS left
[resl]   finished: 8, queries: 3, mempool: 32800 B
</code></pre>
<p>)</p></td><td>2021-12-08T17:09:25.598Z</td></tr><tr><td>Voron-Orel</td><td><p>Приветствую. Может кто объяснить как дать доступ клиенту antizapret-vpn на localhost машины где развернут lxd контейнер, т.е. чтобы клиент vpn смог выйти за рамки lxd контейнера. На localhost развернут небольшой хостинг, работает только в локальной сети, чтобы не городить второй vpn, хотелось чтобы на него можно было ходить через развернутый antizapret-vpn из внешней сети.</p></td><td>2021-12-23T18:51:35.265Z</td></tr><tr><td>ValdikSS</td><td><p><s>Добавьте в <code>/root/antizapret/config/include-ips-custom.txt</code> ваш IP-адрес, по одному на строку, затем запустите <code>/root/antizapret/doall.sh</code> и дождитесь его завершения.</s></p></td><td>2021-12-23T19:11:25.545Z</td></tr><tr><td>Voron-Orel</td><td><p>Сделал, но пинг из под vpn все равно не проходит, из самого контейнера пинг идет. Попробовал добавить в server.conf   push “route 10.0.0.0 255.255.255.0”   Локальный ip сервера 10.0.0.218.  В итоге ответ пинга</p>
<pre><code class="lang-auto">From 192.168.104.1 icmp_seq=1 Destination Port Unreachable
</code></pre></td><td>2021-12-23T19:30:56.438Z</td></tr><tr><td>ValdikSS</td><td><p>Я вас дезинформировал.<br>
Измените <code>/root/antizapret/doall.sh</code>, добавив после <code>./update.sh</code> ваш IP-адрес, обязательно с CIDR. Вот так:</p>
<pre><code class="lang-auto">./update.sh
echo '10.0.0.218/32' &gt;&gt; temp/list.csv
./parse.sh
./process.sh
</code></pre>
<p>Затем запустите <code>doall.sh</code>, с правильной локалью:<br>
<code>LANG=C.UTF-8 /root/antizapret/doall.sh</code></p>
<p>Больше ничего делать не нужно. Изменять конфигурационный файл openvpn тоже не нужно.</p></td><td>2021-12-23T19:59:29.157Z</td></tr><tr><td>Voron-Orel</td><td><p>Спасибо, все заработало.</p></td><td>2021-12-23T20:12:03.176Z</td></tr><tr><td>Voron-Orel</td><td><p>Возникла еще одна необходимость, нужно получить доступ с сервера, где развернут antizapret в lxd, до клиента vpn на определенный порт, на клиенте разрешил доступ, в итоге из контейнера получилось достучатся, за пределами контейнера, с хост машины, не получилось. Попробовал в ручную задать “sudo ip route add 192.168.104.0/22 via 10.83.198.1  dev lxdbr0” Пинг проходит до 192.168.104.1, до клиента 192.168.104.2 нет. думаю надо iptables ковырять.<br>
Заранее спасибо, возможно решение на поверхности, но моих познаний пока не хватает.</p></td><td>2022-01-02T11:04:56.735Z</td></tr><tr><td>Voron-Orel</td><td><p>Вернулся к выше сказанному еще раз, нужно было достучатся на определенный порт клиента. С хост машины. Получилось только так **<code>lxc config device add antizapret-vpn proxy_1880 proxy listen=tcp:[::]:1880 connect=tcp:192.168.104.2:1880**</code>  Возможно это костыль, но другого на ум не чего не пришло.</p></td><td>2022-01-08T15:06:54.300Z</td></tr><tr><td>ValdikSS</td><td><aside class="quote no-group" data-username="Voron-Orel" data-post="83" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/v/53a042/48.png" class="avatar"> Voron-Orel:</div>
<blockquote>
<p>Пинг проходит до 192.168.104.1, до клиента 192.168.104.2 нет. думаю надо iptables ковырять.</p>
</blockquote>
</aside>
<p>В <code>/etc/ferm/ferm.conf</code>, в <code>table filter chain FORWARD</code>, добавить в самый верх:</p>
<pre><code class="lang-auto">interface $EXT_INTERFACE saddr ВАШ_IP_АДРЕС outerface vpn+ ACCEPT;
</code></pre>
<p>После чего перезагрузить контейнер.<br>
Маршрут также нужен, ваша команда похожа на правильную.</p></td><td>2022-01-11T16:29:18.086Z</td></tr><tr><td>Voron-Orel</td><td><p>Попробовал добавить. Как понял нужно указать ip клиента (или хост машины), пробовал то и то, но пинг до клиента так и не проходит.</p></td><td>2022-01-12T15:51:46.343Z</td></tr><tr><td>ValdikSS</td><td><p>Вам нужно еще и на клиенте добавить маршрут до IP-адреса вашего сервера, чтобы он мог вам ответить. Сейчас пакеты с сервера клиенту доходит, но он отвечает на них через ваш домашний маршрутизатор/шлюз провайдера.</p>
<p>Проще сделать так, как вы изначально сделали. Либо же настройте обычный VPN под ваши нужды и маршрутизируйте фиктивный диапазон и DNS-сервер из контейнера АнтиЗапрета.</p></td><td>2022-01-13T21:45:35.798Z</td></tr><tr><td>GaSSiS(GaSSiS)</td><td><p>Здравствуйте. Спасибо за контейнер. Поднял на бесплатном сервере от Oracle, под управлением Ubuntu 20.04. У меня пара вопросов, если вам не трудно:</p>
<ol>
<li>Голый сервер вместе с контейнером занимают 83% от выделенного 1 Гб оперативной памяти. Я, честно говоря, рассчитывал на меньшее потребление. Дело в Ubuntu?</li>
<li>Из коробки не работает) Я добавил правила в ufw, разрешив порты, но это тоже не сработало.  Помогло фактическое разрешение всего в iptables:</li>
</ol>
<pre><code class="lang-auto">iptables -P INPUT ACCEPT
iptables -P OUTPUT ACCEPT
iptables -P FORWARD ACCEPT
iptables -F
iptables --flush
</code></pre>
<p>Но данное решение мне не нравится, а квалификации в настройке iptables у меня 0. Может подскажете, какое правило надо добавить? Сейчас настройки (дефолтные) таковы:</p>
<pre><code class="lang-auto">Chain INPUT (policy ACCEPT)
target     prot opt source               destination
ACCEPT     icmp --  anywhere             anywhere             icmp parameter-problem /* generated for LXD network lxdbr0 */
ACCEPT     icmp --  anywhere             anywhere             icmp time-exceeded /* generated for LXD network lxdbr0 */
ACCEPT     icmp --  anywhere             anywhere             icmp destination-unreachable /* generated for LXD network lxdbr0 */
ACCEPT     tcp  --  anywhere             anywhere             tcp dpt:domain /* generated for LXD network lxdbr0 */
ACCEPT     udp  --  anywhere             anywhere             udp dpt:domain /* generated for LXD network lxdbr0 */
ACCEPT     udp  --  anywhere             anywhere             udp dpt:bootps /* generated for LXD network lxdbr0 */
ACCEPT     all  --  anywhere             anywhere             state RELATED,ESTABLISHED
ACCEPT     icmp --  anywhere             anywhere
ACCEPT     all  --  anywhere             anywhere
ACCEPT     udp  --  anywhere             anywhere             udp spt:ntp
ACCEPT     tcp  --  anywhere             anywhere             state NEW tcp dpt:ssh
REJECT     all  --  anywhere             anywhere             reject-with icmp-host-prohibited

Chain FORWARD (policy ACCEPT)
target     prot opt source               destination
ACCEPT     all  --  anywhere             anywhere             /* generated for LXD network lxdbr0 */
ACCEPT     all  --  anywhere             anywhere             /* generated for LXD network lxdbr0 */
REJECT     all  --  anywhere             anywhere             reject-with icmp-host-prohibited

Chain OUTPUT (policy ACCEPT)
target     prot opt source               destination
ACCEPT     icmp --  anywhere             anywhere             icmp parameter-problem /* generated for LXD network lxdbr0 */
ACCEPT     icmp --  anywhere             anywhere             icmp time-exceeded /* generated for LXD network lxdbr0 */
ACCEPT     icmp --  anywhere             anywhere             icmp destination-unreachable /* generated for LXD network lxdbr0 */
ACCEPT     tcp  --  anywhere             anywhere             tcp spt:domain /* generated for LXD network lxdbr0 */
ACCEPT     udp  --  anywhere             anywhere             udp spt:domain /* generated for LXD network lxdbr0 */
ACCEPT     udp  --  anywhere             anywhere             udp spt:bootps /* generated for LXD network lxdbr0 */
InstanceServices  all  --  anywhere             link-local/16

Chain InstanceServices (1 references)
target     prot opt source               destination
ACCEPT     tcp  --  anywhere             169.254.0.2          owner UID match root tcp dpt:iscsi-target /* See the Oracle-Provided Images section in the Oracle Cloud Infrastructure documentation for security impact of modifying or removing this rule */
ACCEPT     tcp  --  anywhere             169.254.2.0/24       owner UID match root tcp dpt:iscsi-target /* See the Oracle-Provided Images section in the Oracle Cloud Infrastructure documentation for security impact of modifying or removing this rule */
ACCEPT     tcp  --  anywhere             169.254.4.0/24       owner UID match root tcp dpt:iscsi-target /* See the Oracle-Provided Images section in the Oracle Cloud Infrastructure documentation for security impact of modifying or removing this rule */
ACCEPT     tcp  --  anywhere             169.254.5.0/24       owner UID match root tcp dpt:iscsi-target /* See the Oracle-Provided Images section in the Oracle Cloud Infrastructure documentation for security impact of modifying or removing this rule */
ACCEPT     tcp  --  anywhere             169.254.0.2          tcp dpt:http /* See the Oracle-Provided Images section in the Oracle Cloud Infrastructure documentation for security impact of modifying or removing this rule */
ACCEPT     udp  --  anywhere             169.254.169.254      udp dpt:domain /* See the Oracle-Provided Images section in the Oracle Cloud Infrastructure documentation for security impact of modifying or removing this rule */
ACCEPT     tcp  --  anywhere             169.254.169.254      tcp dpt:domain /* See the Oracle-Provided Images section in the Oracle Cloud Infrastructure documentation for security impact of modifying or removing this rule */
ACCEPT     tcp  --  anywhere             169.254.0.3          owner UID match root tcp dpt:http /* See the Oracle-Provided Images section in the Oracle Cloud Infrastructure documentation for security impact of modifying or removing this rule */
ACCEPT     tcp  --  anywhere             169.254.0.4          tcp dpt:http /* See the Oracle-Provided Images section in the Oracle Cloud Infrastructure documentation for security impact of modifying or removing this rule */
ACCEPT     tcp  --  anywhere             169.254.169.254      tcp dpt:http /* See the Oracle-Provided Images section in the Oracle Cloud Infrastructure documentation for security impact of modifying or removing this rule */
ACCEPT     udp  --  anywhere             169.254.169.254      udp dpt:bootps /* See the Oracle-Provided Images section in the Oracle Cloud Infrastructure documentation for security impact of modifying or removing this rule */
ACCEPT     udp  --  anywhere             169.254.169.254      udp dpt:tftp /* See the Oracle-Provided Images section in the Oracle Cloud Infrastructure documentation for security impact of modifying or removing this rule */
ACCEPT     udp  --  anywhere             169.254.169.254      udp dpt:ntp /* See the Oracle-Provided Images section in the Oracle Cloud Infrastructure documentation for security impact of modifying or removing this rule */
REJECT     tcp  --  anywhere             link-local/16        tcp /* See the Oracle-Provided Images section in the Oracle Cloud Infrastructure documentation for security impact of modifying or removing this rule */ reject-with tcp-reset
REJECT     udp  --  anywhere             link-local/16        udp /* See the Oracle-Provided Images section in the Oracle Cloud Infrastructure documentation for security impact of modifying or removing this rule */ reject-with icmp-port-unreachable

</code></pre>
<p>Заранее спасибо за помощь.</p></td><td>2022-01-25T10:40:52.334Z</td></tr><tr><td>ValdikSS</td><td><aside class="quote no-group quote-modified" data-username="GaSSiS" data-post="88" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/g/cdc98d/48.png" class="avatar"> GaSSiS:</div>
<blockquote>
<p>Голый сервер сместе с контейнером занимают 83% от выделенного 1 Гб оперативной памяти. Я, честно говоря, рассчитывал на меньшее потребление. Дело в Ubuntu?</p>
</blockquote>
</aside>
<p>Нет, так и должно быть. Лист блокировок в оперативной памяти в knot-resolver занимает почти 700 мегабайт.</p>
<aside class="quote no-group" data-username="GaSSiS" data-post="88" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/g/cdc98d/48.png" class="avatar"> GaSSiS:</div>
<blockquote>
<p>Из коробки не работает) Я добавил правила в ufw, разрешив порты, но это тоже не сработало. Помогло фактическое разрешение всего в iptables:</p>
</blockquote>
</aside>
<blockquote>
<p>See the Oracle-Provided Images section in the Oracle Cloud Infrastructure documentation for security impact of modifying or removing this rule</p>
</blockquote>
<p>Я не знаю, где настраиваются эти правила, т.е. какая система используется для их начальной установки. Вам лучше прочитать документацию, как пишут в комментарии.</p>
<p>А чтобы решить проблему, скорее всего нужно разрешить пакеты на порт 1194 в цепочке INPUT. Но, опять же, делать это нужно в той системе, где заведены правила.</p></td><td>2022-01-25T11:03:33.782Z</td></tr><tr><td>GaSSiS(GaSSiS)</td><td><aside class="quote no-group" data-username="ValdikSS" data-post="89" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/valdikss/48/2_2.png" class="avatar"> ValdikSS:</div>
<blockquote>
<p>А чтобы решить проблему, скорее всего нужно разрешить пакеты на порт 1194 в цепочке INPUT. Но, опять же, делать это нужно в той системе, где заведены правила.</p>
</blockquote>
</aside>
<p>Спасибо, помогло:</p>
<pre><code class="lang-auto">iptables -I INPUT -p tcp -m tcp --dport 1194 -j ACCEPT
iptables -I INPUT -p udp -m udp --dport 1194 -j ACCEPT
netfilter-persistent save   
</code></pre></td><td>2022-01-25T11:08:17.752Z</td></tr><tr><td>wolfxr</td><td><p>Удалено</p></td><td>2022-02-09T09:45:03.904Z</td></tr><tr><td>max41479</td><td><p>Возможно ли использовать для обхода блокировки twitter <a href="https://ntc.party/t/vpn/129">Контейнер VPN АнтиЗапрета для установки на собственный сервер</a> ?<br>
P.S.: добавление</p>
<pre><code class="lang-auto">twitter.com
t.co
twimg.com
</code></pre>
<p><s>в <s><code>/root/antizapret/config/include-ips-custom.txt</code></s> /root/antizapret/config/include-hosts-custom.txt не помогло</s></p></td><td>2022-02-26T12:16:02.714Z</td></tr><tr><td>ValdikSS</td><td><p>Добавлять домены следует в <code>/root/antizapret/config/include-hosts-custom.txt</code>. Файл <code>include-ips-custom.txt</code> предназначен для IP-адресов.</p></td><td>2022-02-26T12:35:29.966Z</td></tr><tr><td>max41479</td><td><p>Прошу прощения, опечатался, изменения были внесены в /root/antizapret/config/include-hosts-custom.txt</p></td><td>2022-02-26T12:37:01.252Z</td></tr><tr><td>ValdikSS</td><td><p>А должно работать, только что проверил.</p>
<ol>
<li>Добавить в <code>/root/antizapret/config/include-hosts-custom.txt</code>:</li>
</ol>
<pre><code class="lang-auto">twitter.com
t.co
twimg.com
</code></pre>
<ol start="2">
<li>
<code> LANG=C.UTF-8 /root/antizapret/doall.sh</code>, либо просто перезагрузить контейнер и подождать минуты три.</li>
</ol></td><td>2022-02-26T12:42:17.441Z</td></tr><tr><td>max41479</td><td><p>Спасибо за ответ!<br>
Удалил все DNS серверы, кроме одного на роутере.<br>
Возможно зря я дополнительные ipv6 DNS серверы прописывал.<br>
Cпустя какое-то время заработало.</p></td><td>2022-02-26T13:28:52.308Z</td></tr><tr><td>kirill</td><td><p>два вопроса, я “чайник”</p>
<ol>
<li>нужно ли обновлять сам контейнер - я так понимаю, он редко, но обновляется - и если Да, то как?</li>
<li>новые ip-адреса/правила для вновь заблокированных ресурсов подгружаются автоматом, и если Да - то с какой периодичностью; нужно ли ребутить контейнер?</li>
</ol>
<p>спасибо</p></td><td>2022-02-28T19:15:47.630Z</td></tr><tr><td>nzkhammatov(Ainur Khammatov)</td><td><p>Раз в 6 часов список обновляется автоматически.</p></td><td>2022-02-28T20:24:38.074Z</td></tr><tr><td>ValdikSS</td><td><aside class="quote no-group" data-username="kirill" data-post="97" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/k/a9a28c/48.png" class="avatar"> kirill:</div>
<blockquote>
<p>нужно ли обновлять сам контейнер - я так понимаю, он редко, но обновляется - и если Да, то как?</p>
</blockquote>
</aside>
<p>Непосредственно контейнер автоматически не обновляется, как и скрипты антизапрета в нём, однако обновления безопасности системных программ дистрибутива устанавливаются автоматически (unattended-upgrades).<br>
Значимых обновлений с момента первого релиза контейнера не было. Если они будут, их придётся выполнить вручную, я напишу как.</p>
<p>На второй вопрос уже ответили.</p></td><td>2022-02-28T20:30:52.938Z</td></tr><tr><td>drno88</td><td><p>Подскажите пожалуйста, как запустить его на 443 порту?</p></td><td>2022-03-05T11:57:12.240Z</td></tr><tr><td>ValdikSS</td><td><pre><code class="lang-auto">lxc config device add antizapret-vpn proxy_443 proxy listen=tcp:[::]:443 connect=tcp:127.0.0.1:1194
lxc config device add antizapret-vpn proxy_443_udp proxy listen=udp:[::]:443 connect=udp:127.0.0.1:1194
</code></pre>
<p>Если вы планируете таким образом обойти (гипотетическую) блокировку протокола OpenVPN, то это, с большой вероятностью, не поможет.</p></td><td>2022-03-05T12:18:14.148Z</td></tr><tr><td>drno88</td><td><p>Да я уже сам подумал. ИТшник блин… прочитать не прочитал строку нормально))) (это я про себя)</p>
<p>За ответ спасибо.</p>
<p>Нет, это обход корп прокси, там на выход разрешены только ограниченные порты</p>
<p>Если нужна будет тех помощь - обращайтесь.<br>
Спасибо за ответ и за труд)</p></td><td>2022-03-05T12:25:45.655Z</td></tr><tr><td>drfischer</td><td><p>Помогите пожалуйста настроить. На моменте<br>
“lxc file pull antizapret-vpn/root/easy-rsa-ipsec/CLIENT_KEY/antizapret-client-tcp.ovpn antizapret-client-tcp.ovpn”<br>
получаю ошибку (в первых сообщениях темы это обсуждалось):<br>
Error: Not Found</p>
<p>Зашел в контейнер, а там так:</p>
<p>root@drfischer:~# systemctl status openvpn-generate-keys<br>
Unit openvpn-generate-keys.service could not be found.<br>
root@drfischer:~# sudo lxc exec antizapret-vpn bash<br>
root@antizapret-vpn:~# systemctl status openvpn-generate-keys</p>
<p>● openvpn-generate-keys.service - antizapret-vpn generate keys<br>
Loaded: loaded (/etc/systemd/system/openvpn-generate-keys.service; enabled; vendor preset: enabled)<br>
Active: failed (Result: exit-code) since Sat 2022-03-05 17:39:41 MSK; 26min ago<br>
Process: 72 ExecStart=/root/easy-rsa-ipsec/generate.sh (code=exited, status=8)<br>
Main PID: 72 (code=exited, status=8)</p>
<p>Mar 05 17:39:31 antizapret-vpn systemd[1]: Started antizapret-vpn generate keys.<br>
Mar 05 17:39:41 antizapret-vpn generate.sh[72]: Can’t determine global IP address!<br>
Mar 05 17:39:41 antizapret-vpn systemd[1]: openvpn-generate-keys.service: Main process exited, code=exited, status=8/n/a<br>
Mar 05 17:39:41 antizapret-vpn systemd[1]: openvpn-generate-keys.service: Failed with result ‘exit-code’.<br>
root@antizapret-vpn:~# /root/easy-rsa-ipsec/generate.sh<br>
Can’t determine global IP address!<br>
root@antizapret-vpn:~#</p>
<p>В контейнере комманда: systemctl status openvpn-generate-keys</p>
<p>openvpn-generate-keys.service - antizapret-vpn generate keys<br>
Loaded: loaded (/etc/systemd/system/openvpn-generate-keys.service; enabled; v<br>
endor preset: enabled)<br>
Active: failed (Result: exit-code) since Sat 2022-03-05 19:54:42 M<br>
SK; 2min 27s ago<br>
Process: 72 ExecStart=/root/easy-rsa-ipsec/generate.sh (code=exited, s<br>
tatus=8)<br>
Main PID: 72 (code=exited, status=8)</p>
<p>Mar 05 19:54:30 antizapret-vpn systemd[1]: Started antizapret-vpn generate keys.<br>
Mar 05 19:54:42 antizapret-vpn generate.sh[72]: Can’t determine global IP addres<br>
s!<br>
Mar 05 19:54:42 antizapret-vpn systemd[1]: openvpn-gener<br>
ate-keys.service: Main process exited, code=exited, status=8/n/a<br>
Mar 05 19:54:42 antizapret-vpn systemd[1]: openvpn-gener<br>
ate-keys.service: Failed with result ‘exit-code’.</p>
<p>подскажите, куда копать?</p></td><td>2022-03-05T16:32:03.649Z</td></tr><tr><td>ValdikSS</td><td><p>Вероятно, в контейнере нет интернета. Если <code>curl ifconfig.co</code> не возвращает IP-адрес, то нужно разбираться, почему интернет отсутствует.</p></td><td>2022-03-05T17:26:52.162Z</td></tr><tr><td>drfischer</td><td><aside class="quote no-group" data-username="ValdikSS" data-post="104" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/valdikss/48/2_2.png" class="avatar"> ValdikSS:</div>
<blockquote>
<p>Если <code>curl ifconfig.co</code> не возвращает IP-адрес, то нужно разбираться, почему интернет отсутствует.</p>
</blockquote>
</aside>
<p>Попробовал. Вот так получилось:</p>
<p>root@drfischer:~# curl <a href="http://ifconfig.co" rel="noopener nofollow ugc">ifconfig.co</a><br>
185.177.120.9<br>
root@drfischer:~# sudo lxc exec antizapret-vpn bash<br>
root@antizapret-vpn:~# curl <a href="http://ifconfig.co" rel="noopener nofollow ugc">ifconfig.co</a><br>
curl: (6) Could not resolve host: <a href="http://ifconfig.co" rel="noopener nofollow ugc">ifconfig.co</a></p>
<p>А как можно разобраться с отсутствующим интернетом? Помогите пожалуйста.</p></td><td>2022-03-05T19:22:03.555Z</td></tr><tr><td>ValdikSS</td><td><p>Сложно сказать, проверяйте правила firewall’а вашего дистрибутива, или те, что вы добавили вручную. LXD по умолчанию инициализирует сеть автоматически и с ним у меня проблем никогда не возникало, поэтому причину нужно искать в особых настройках сети конкретно у вас.</p></td><td>2022-03-05T20:05:38.863Z</td></tr><tr><td>drfischer</td><td><p>Видимо,проблема была в файерволле,как вы говорили. В результате файл удалось получить, но по факту не работает<br>
подключение.<br>
Подскажите пожалуйста.</p>
<details>
<summary>
Лог подключения</summary>
<p>2022-03-06 10:24:13 TCP/UDP: Preserving recently used remote address: [AF_INET]185.177.120.9:1194<br>
2022-03-06 10:24:13 Socket Buffers: R=[1048576-&gt;1048576] S=[1048576-&gt;1048576]<br>
2022-03-06 10:24:13 Attempting to establish TCP connection with [AF_INET]185.177.120.9:1194 [nonblock]<br>
2022-03-06 10:24:13 New OpenVPN Status (TCP_CONNECT-&gt;LEVEL_CONNECTING_NO_SERVER_REPLY_YET): ,<br>
2022-03-06 10:24:13 New OpenVPN Status (TCP_CONNECT-&gt;LEVEL_CONNECTING_NO_SERVER_REPLY_YET): ,<br>
2022-03-06 10:24:13 MANAGEMENT: &gt;STATE:1646551453,TCP_CONNECT,<br>
2022-03-06 10:24:13 MANAGEMENT: CMD ‘needok ‘PROTECTFD’ ok’<br>
2022-03-06 10:24:15 TCP connection established with [AF_INET]185.177.120.9:1194<br>
2022-03-06 10:24:15 MANAGEMENT: CMD ‘needok ‘PROTECTFD’ ok’<br>
2022-03-06 10:24:15 TCP_CLIENT link local: (not bound)<br>
2022-03-06 10:24:15 TCP_CLIENT link remote: [AF_INET]185.177.120.9:1194<br>
2022-03-06 10:24:15 MANAGEMENT: &gt;STATE:1646551455,WAIT,<br>
2022-03-06 10:24:15 New OpenVPN Status (WAIT-&gt;LEVEL_CONNECTING_NO_SERVER_REPLY_YET): ,<br>
2022-03-06 10:24:15 New OpenVPN Status (WAIT-&gt;LEVEL_CONNECTING_NO_SERVER_REPLY_YET): ,<br>
2022-03-06 10:24:15 MANAGEMENT: &gt;STATE:1646551455,AUTH,<br>
2022-03-06 10:24:15 New OpenVPN Status (AUTH-&gt;LEVEL_CONNECTING_SERVER_REPLIED): ,<br>
2022-03-06 10:24:15 New OpenVPN Status (AUTH-&gt;LEVEL_CONNECTING_SERVER_REPLIED): ,<br>
2022-03-06 10:24:15 TLS: Initial packet from [AF_INET]185.177.120.9:1194, sid=9d6da227 39ef956c<br>
2022-03-06 10:24:16 VERIFY ERROR: depth=1, error=self signed certificate in certificate chain: C=US, ST=CA, L=SanFrancisco, O=Fort-Funston, OU=MyOrganizationalUnit, CN=Fort-Funston CA, name=EasyRSA, emailAddress=me@myhost.mydomain<br>
2022-03-06 10:24:16 OpenSSL: error:14090086:SSL routines:ssl3_get_server_certificate:certificate verify failed<br>
2022-03-06 10:24:16 New OpenVPN Status (RECONNECTING-&gt;LEVEL_CONNECTING_NO_SERVER_REPLY_YET): tls-error,<br>
2022-03-06 10:24:16 New OpenVPN Status (RECONNECTING-&gt;LEVEL_CONNECTING_NO_SERVER_REPLY_YET): tls-error,<br>
2022-03-06 10:24:16 TLS_ERROR: BIO read tls_read_plaintext error<br>
2022-03-06 10:24:16 TLS Error: TLS object → incoming plaintext read error<br>
2022-03-06 10:24:16 TLS Error: TLS handshake failed<br>
2022-03-06 10:24:16 New OpenVPN Status (CONNECTRETRY-&gt;LEVEL_CONNECTING_NO_SERVER_REPLY_YET): 10<br>
2022-03-06 10:24:16 New OpenVPN Status (CONNECTRETRY-&gt;LEVEL_CONNECTING_NO_SERVER_REPLY_YET): 10<br>
2022-03-06 10:24:16 Ожидание 10s секунд между попыткой подключения<br>
2022-03-06 10:24:16 Fatal TLS error (check_tls_errors_co), restarting<br>
2022-03-06 10:24:16 TCP/UDP: Closing socket<br>
2022-03-06 10:24:16 SIGUSR1[soft,tls-error] received, process restarting<br>
2022-03-06 10:24:16 MANAGEMENT: &gt;STATE:1646551456,RECONNECTING,tls-error,</p>
</details>
<p>На винде если использую этот .ovpn - пишет Peer certificate verification failure</p></td><td>2022-03-06T07:37:28.821Z</td></tr><tr><td>ValdikSS</td><td><p>Видимо, у вас на этом IP-адресе, на порту 1194 другой OpenVPN-сервер запущен, проверьте.</p></td><td>2022-03-06T08:42:53.843Z</td></tr><tr><td>drfischer</td><td><p>Прошу прощения, а как это сделать? И отключить лишний, если что? Действительно при установке убунты на сервер отметил еще и openVpn установить.</p>
<p>Но как теперь убрать лишний?</p>
<p>UPD: Удалось выяснить это:</p>
<p>root@drfischer:~# netstat -anp|grep 1194<br>
tcp        0      0 0.0.0.0:1194            0.0.0.0:*               LISTEN      1680/openvpn</p>
<p>Что можно сделать теперь?</p></td><td>2022-03-06T08:47:28.067Z</td></tr><tr><td>ValdikSS</td><td><p>Если у вас OpenVPN не настроен и он вам не нужен, просто удалите его:<br>
<code>sudo apt remove openvpn</code><br>
Возможно, потребуется передобавить маршрутизацию портов в LXD:</p>
<pre><code class="lang-nohighlight">lxc config device add antizapret-vpn proxy_1194 proxy listen=tcp:[::]:1194 connect=tcp:127.0.0.1:1194
lxc config device add antizapret-vpn proxy_1194_udp proxy listen=udp:[::]:1194 connect=udp:127.0.0.1:1194
</code></pre>
<p>После чего перезапустите контейнер:<br>
<code>lxc restart antizapret-vpn</code></p></td><td>2022-03-06T09:42:53.736Z</td></tr><tr><td>drfischer</td><td><p>Сделал. Все равно не выходит.</p>
<p>Обратил внимание(может это имеет значение) если внутри контейнера запускаю curl <a href="http://icanhazip.com" rel="noopener nofollow ugc">icanhazip.com</a> - в ответ получаю ip сервера. Так разве должно быть?</p>
<p>И еще, не знаю на сколько это тоже принципиально, но вот:</p>
<details>
<summary>
udp error</summary>
<p>root@drfischer:~# lxc restart antizapret-vpn<br>
Error: Error when starting proxy device ‘proxy_1194_udp’ for container antizapret-vpn: Proxy device doesn’t support the connection type: udp</p>
</details>
<p>При попытке подключится через приложение получаю такой лог:</p>
<details>
<summary>
Лог подключения OpenVPN</summary>
<p>2022-03-06 15:02:37 P:Initializing Google Breakpad!<br>
2022-03-06 15:02:37 Current Parameter Settings:<br>
2022-03-06 15:02:37   config = ‘/data/user/0/de.blinkt.openvpn/cache/android.conf’<br>
2022-03-06 15:02:37   mode = 0<br>
2022-03-06 15:02:37   show_ciphers = DISABLED<br>
2022-03-06 15:02:37   show_digests = DISABLED<br>
2022-03-06 15:02:37   show_engines = DISABLED<br>
2022-03-06 15:02:37   genkey = DISABLED<br>
2022-03-06 15:02:37   key_pass_file = ‘[UNDEF]’<br>
2022-03-06 15:02:37   show_tls_ciphers = DISABLED<br>
2022-03-06 15:02:37   connect_retry_max = 2<br>
2022-03-06 15:02:37 Connection profiles [0]:<br>
2022-03-06 15:02:37   proto = tcp-client<br>
2022-03-06 15:02:37   local = ‘[UNDEF]’<br>
2022-03-06 15:02:37 Ожидание 0s секунд между попыткой подключения<br>
2022-03-06 15:02:37   local_port = ‘[UNDEF]’<br>
2022-03-06 15:02:37   remote = ‘185.177.120.9’<br>
2022-03-06 15:02:37   remote_port = ‘1194’<br>
2022-03-06 15:02:37   remote_float = DISABLED<br>
2022-03-06 15:02:37   bind_defined = DISABLED<br>
2022-03-06 15:02:37   bind_local = DISABLED<br>
2022-03-06 15:02:37   bind_ipv6_only = DISABLED<br>
2022-03-06 15:02:37   connect_retry_seconds = 3<br>
2022-03-06 15:02:37   connect_timeout = 120<br>
2022-03-06 15:02:37   socks_proxy_server = ‘[UNDEF]’<br>
2022-03-06 15:02:37   socks_proxy_port = ‘[UNDEF]’<br>
2022-03-06 15:02:37   tun_mtu = 1500<br>
2022-03-06 15:02:37   tun_mtu_defined = ENABLED<br>
2022-03-06 15:02:37   link_mtu = 1500<br>
2022-03-06 15:02:37   link_mtu_defined = DISABLED<br>
2022-03-06 15:02:37   tun_mtu_extra = 0<br>
2022-03-06 15:02:37   tun_mtu_extra_defined = DISABLED<br>
2022-03-06 15:02:37   mtu_discover_type = -1<br>
2022-03-06 15:02:37   fragment = 0<br>
2022-03-06 15:02:37   mssfix = 1450<br>
2022-03-06 15:02:37   explicit_exit_notification = 0<br>
2022-03-06 15:02:37 Connection profiles END<br>
2022-03-06 15:02:37   remote_random = DISABLED<br>
2022-03-06 15:02:37   ipchange = ‘[UNDEF]’<br>
2022-03-06 15:02:37   dev = ‘tun’<br>
2022-03-06 15:02:37   dev_type = ‘[UNDEF]’<br>
2022-03-06 15:02:37   dev_node = ‘[UNDEF]’<br>
2022-03-06 15:02:37   lladdr = ‘[UNDEF]’<br>
2022-03-06 15:02:37   topology = 1<br>
2022-03-06 15:02:37   ifconfig_local = ‘[UNDEF]’<br>
2022-03-06 15:02:37   ifconfig_remote_netmask = ‘[UNDEF]’<br>
2022-03-06 15:02:37   ifconfig_noexec = DISABLED<br>
2022-03-06 15:02:37   ifconfig_nowarn = ENABLED<br>
2022-03-06 15:02:37   ifconfig_ipv6_local = ‘[UNDEF]’<br>
2022-03-06 15:02:37   ifconfig_ipv6_netbits = 0<br>
2022-03-06 15:02:37   ifconfig_ipv6_remote = ‘[UNDEF]’<br>
2022-03-06 15:02:37   shaper = 0<br>
2022-03-06 15:02:37   mtu_test = 0<br>
2022-03-06 15:02:37   mlock = DISABLED<br>
2022-03-06 15:02:37   keepalive_ping = 0<br>
2022-03-06 15:02:37   keepalive_timeout = 0<br>
2022-03-06 15:02:37   inactivity_timeout = 0<br>
2022-03-06 15:02:37   ping_send_timeout = 0<br>
2022-03-06 15:02:37   ping_rec_timeout = 0<br>
2022-03-06 15:02:37   ping_rec_timeout_action = 0<br>
2022-03-06 15:02:37   ping_timer_remote = DISABLED<br>
2022-03-06 15:02:37   remap_sigusr1 = 0<br>
2022-03-06 15:02:37   persist_tun = ENABLED<br>
2022-03-06 15:02:37   persist_local_ip = DISABLED<br>
2022-03-06 15:02:37   persist_remote_ip = DISABLED<br>
2022-03-06 15:02:37   persist_key = DISABLED<br>
2022-03-06 15:02:37   passtos = DISABLED<br>
2022-03-06 15:02:37   resolve_retry_seconds = 1000000000<br>
2022-03-06 15:02:37   resolve_in_advance = ENABLED<br>
2022-03-06 15:02:37   username = ‘[UNDEF]’<br>
2022-03-06 15:02:37   groupname = ‘[UNDEF]’<br>
2022-03-06 15:02:37   chroot_dir = ‘[UNDEF]’<br>
2022-03-06 15:02:37   cd_dir = ‘[UNDEF]’<br>
2022-03-06 15:02:37   writepid = ‘[UNDEF]’<br>
2022-03-06 15:02:37   up_script = ‘[UNDEF]’<br>
2022-03-06 15:02:37   down_script = ‘[UNDEF]’<br>
2022-03-06 15:02:37   down_pre = DISABLED<br>
2022-03-06 15:02:37   up_restart = DISABLED<br>
2022-03-06 15:02:37   up_delay = DISABLED<br>
2022-03-06 15:02:37   daemon = DISABLED<br>
2022-03-06 15:02:37   inetd = 0<br>
2022-03-06 15:02:37   log = DISABLED<br>
2022-03-06 15:02:37   suppress_timestamps = DISABLED<br>
2022-03-06 15:02:37   machine_readable_output = ENABLED<br>
2022-03-06 15:02:37   nice = 0<br>
2022-03-06 15:02:37   verbosity = 4<br>
2022-03-06 15:02:37   mute = 0<br>
2022-03-06 15:02:37   gremlin = 0<br>
2022-03-06 15:02:37   status_file = ‘[UNDEF]’<br>
2022-03-06 15:02:37   status_file_version = 1<br>
2022-03-06 15:02:37   status_file_update_freq = 60<br>
2022-03-06 15:02:37   occ = ENABLED<br>
2022-03-06 15:02:37   rcvbuf = 0<br>
2022-03-06 15:02:37   sndbuf = 0<br>
2022-03-06 15:02:37   sockflags = 0<br>
2022-03-06 15:02:37   fast_io = DISABLED<br>
2022-03-06 15:02:37   comp.alg = 0<br>
2022-03-06 15:02:37   comp.flags = 0<br>
2022-03-06 15:02:37   route_script = ‘[UNDEF]’<br>
2022-03-06 15:02:37   route_default_gateway = ‘[UNDEF]’<br>
2022-03-06 15:02:37   route_default_metric = 0<br>
2022-03-06 15:02:37   route_noexec = DISABLED<br>
2022-03-06 15:02:37   route_delay = 0<br>
2022-03-06 15:02:37   route_delay_window = 30<br>
2022-03-06 15:02:37   route_delay_defined = DISABLED<br>
2022-03-06 15:02:37   route_nopull = DISABLED<br>
2022-03-06 15:02:37   route_gateway_via_dhcp = DISABLED<br>
2022-03-06 15:02:37   allow_pull_fqdn = DISABLED<br>
2022-03-06 15:02:37   management_addr = ‘/data/user/0/de.blinkt.openvpn/cache/mgmtsocket’<br>
2022-03-06 15:02:37   management_port = ‘unix’<br>
2022-03-06 15:02:37   management_user_pass = ‘[UNDEF]’<br>
2022-03-06 15:02:37   management_log_history_cache = 250<br>
2022-03-06 15:02:37   management_echo_buffer_size = 100<br>
2022-03-06 15:02:37   management_write_peer_info_file = ‘[UNDEF]’<br>
2022-03-06 15:02:37   management_client_user = ‘[UNDEF]’<br>
2022-03-06 15:02:37   management_client_group = ‘[UNDEF]’<br>
2022-03-06 15:02:37   management_flags = 4390<br>
2022-03-06 15:02:37   shared_secret_file = ‘[UNDEF]’<br>
2022-03-06 15:02:37   key_direction = (null)<br>
2022-03-06 15:02:37   ciphername = ‘AES-128-CBC’<br>
2022-03-06 15:02:37   ncp_enabled = ENABLED<br>
2022-03-06 15:02:37   ncp_ciphers = ‘AES-256-GCM:AES-128-GCM’<br>
2022-03-06 15:02:37   authname = ‘SHA1’<br>
2022-03-06 15:02:37   prng_hash = ‘SHA1’<br>
2022-03-06 15:02:37   prng_nonce_secret_len = 16<br>
2022-03-06 15:02:37   keysize = 0<br>
2022-03-06 15:02:37   engine = DISABLED<br>
2022-03-06 15:02:37   replay = ENABLED<br>
2022-03-06 15:02:37   mute_replay_warnings = DISABLED<br>
2022-03-06 15:02:37   replay_window = 64<br>
2022-03-06 15:02:37   replay_time = 15<br>
2022-03-06 15:02:37   packet_id_file = ‘[UNDEF]’<br>
2022-03-06 15:02:37   test_crypto = DISABLED<br>
2022-03-06 15:02:37   tls_server = DISABLED<br>
2022-03-06 15:02:37   tls_client = ENABLED<br>
2022-03-06 15:02:37   key_method = 2<br>
2022-03-06 15:02:37   ca_file = ‘[[INLINE]]’<br>
2022-03-06 15:02:37   ca_path = ‘[UNDEF]’<br>
2022-03-06 15:02:37   dh_file = ‘[UNDEF]’<br>
2022-03-06 15:02:37   cert_file = ‘[[INLINE]]’<br>
2022-03-06 15:02:37   extra_certs_file = ‘[UNDEF]’<br>
2022-03-06 15:02:37   priv_key_file = ‘[[INLINE]]’<br>
2022-03-06 15:02:37   pkcs12_file = ‘[UNDEF]’<br>
2022-03-06 15:02:37   cipher_list = ‘[UNDEF]’<br>
2022-03-06 15:02:37   tls_verify = ‘[UNDEF]’<br>
2022-03-06 15:02:37   tls_export_cert = ‘[UNDEF]’<br>
2022-03-06 15:02:37   verify_x509_type = 0<br>
2022-03-06 15:02:37   verify_x509_name = ‘[UNDEF]’<br>
2022-03-06 15:02:37   crl_file = ‘[UNDEF]’<br>
2022-03-06 15:02:37   ns_cert_type = 0<br>
2022-03-06 15:02:37   remote_cert_ku[i] = 160<br>
2022-03-06 15:02:37   remote_cert_ku[i] = 136<br>
2022-03-06 15:02:37   remote_cert_ku[i] = 0<br>
2022-03-06 15:02:37   remote_cert_ku[i] = 0<br>
2022-03-06 15:02:37   remote_cert_ku[i] = 0<br>
2022-03-06 15:02:37   remote_cert_ku[i] = 0<br>
2022-03-06 15:02:37   remote_cert_ku[i] = 0<br>
2022-03-06 15:02:37   remote_cert_ku[i] = 0<br>
2022-03-06 15:02:37   remote_cert_ku[i] = 0<br>
2022-03-06 15:02:37   remote_cert_ku[i] = 0<br>
2022-03-06 15:02:37   remote_cert_ku[i] = 0<br>
2022-03-06 15:02:37   remote_cert_ku[i] = 0<br>
2022-03-06 15:02:37   remote_cert_ku[i] = 0<br>
2022-03-06 15:02:37   remote_cert_ku[i] = 0<br>
2022-03-06 15:02:37   remote_cert_ku[i] = 0<br>
2022-03-06 15:02:37   remote_cert_ku[i] = 0<br>
2022-03-06 15:02:37   remote_cert_eku = ‘TLS Web Server Authentication’<br>
2022-03-06 15:02:37   ssl_flags = 0<br>
2022-03-06 15:02:37   tls_timeout = 2<br>
2022-03-06 15:02:37   renegotiate_bytes = -1<br>
2022-03-06 15:02:37   renegotiate_packets = 0<br>
2022-03-06 15:02:37   renegotiate_seconds = 3600<br>
2022-03-06 15:02:37   handshake_window = 60<br>
2022-03-06 15:02:37   transition_window = 3600<br>
2022-03-06 15:02:37   single_session = DISABLED<br>
2022-03-06 15:02:37   push_peer_info = DISABLED<br>
2022-03-06 15:02:37   tls_exit = DISABLED<br>
2022-03-06 15:02:37   tls_auth_file = ‘[UNDEF]’<br>
2022-03-06 15:02:37   tls_crypt_file = ‘[UNDEF]’<br>
2022-03-06 15:02:37   client = ENABLED<br>
2022-03-06 15:02:38   pull = ENABLED<br>
2022-03-06 15:02:38   auth_user_pass_file = ‘[UNDEF]’<br>
2022-03-06 15:02:38 OpenVPN 2.5-icsopenvpn [git:icsopenvpn-5711c5bd3a04f48b] android-14-armeabi-v7a [SSL (OpenSSL)] [LZO] [LZ4] [EPOLL] [MH/PKTINFO] [AEAD] built on Feb  4 2017<br>
2022-03-06 15:02:38 library versions: OpenSSL 1.0.2k  26 Jan 2017, LZO 2.09<br>
2022-03-06 15:02:38 MANAGEMENT: Connected to management server at /data/user/0/de.blinkt.openvpn/cache/mgmtsocket<br>
2022-03-06 15:02:38 MANAGEMENT: CMD ‘hold release’<br>
2022-03-06 15:02:38 MANAGEMENT: CMD ‘bytecount 2’<br>
2022-03-06 15:02:38 MANAGEMENT: CMD ‘proxy NONE’<br>
2022-03-06 15:02:38 MANAGEMENT: CMD ‘state on’<br>
2022-03-06 15:02:38 Control Channel MTU parms [ L:1623 D:1210 EF:40 EB:0 ET:0 EL:3 ]<br>
2022-03-06 15:02:38 Data Channel MTU parms [ L:1623 D:1450 EF:123 EB:406 ET:0 EL:3 ]<br>
2022-03-06 15:02:38 Local Options String (VER=V4): ‘V4,dev-type tun,link-mtu 1559,tun-mtu 1500,proto TCPv4_CLIENT,cipher AES-128-CBC,auth SHA1,keysize 128,key-method 2,tls-client’<br>
2022-03-06 15:02:38 New OpenVPN Status (TCP_CONNECT-&gt;LEVEL_CONNECTING_NO_SERVER_REPLY_YET): ,<br>
2022-03-06 15:02:39 New OpenVPN Status (TCP_CONNECT-&gt;LEVEL_CONNECTING_NO_SERVER_REPLY_YET): ,<br>
2022-03-06 15:02:38 Expected Remote Options String (VER=V4): ‘V4,dev-type tun,link-mtu 1559,tun-mtu 1500,proto TCPv4_SERVER,cipher AES-128-CBC,auth SHA1,keysize 128,key-method 2,tls-server’<br>
2022-03-06 15:02:39 TCP/UDP: Preserving recently used remote address: [AF_INET]185.177.120.9:1194<br>
2022-03-06 15:02:39 Socket Buffers: R=[1048576-&gt;1048576] S=[1048576-&gt;1048576]<br>
2022-03-06 15:02:39 Attempting to establish TCP connection with [AF_INET]185.177.120.9:1194 [nonblock]<br>
2022-03-06 15:02:39 MANAGEMENT: &gt;STATE:1646568158,TCP_CONNECT,<br>
2022-03-06 15:02:39 MANAGEMENT: CMD ‘needok ‘PROTECTFD’ ok’<br>
2022-03-06 15:02:40 TCP connection established with [AF_INET]185.177.120.9:1194<br>
2022-03-06 15:02:40 MANAGEMENT: CMD ‘needok ‘PROTECTFD’ ok’<br>
2022-03-06 15:02:40 TCP_CLIENT link local: (not bound)<br>
2022-03-06 15:02:40 TCP_CLIENT link remote: [AF_INET]185.177.120.9:1194<br>
2022-03-06 15:02:40 MANAGEMENT: &gt;STATE:1646568160,WAIT,<br>
2022-03-06 15:02:40 Connection reset, restarting [0]<br>
2022-03-06 15:02:40 TCP/UDP: Closing socket<br>
2022-03-06 15:02:40 SIGUSR1[soft,connection-reset] received, process restarting<br>
2022-03-06 15:02:40 New OpenVPN Status (WAIT-&gt;LEVEL_CONNECTING_NO_SERVER_REPLY_YET): ,<br>
2022-03-06 15:02:40 New OpenVPN Status (WAIT-&gt;LEVEL_CONNECTING_NO_SERVER_REPLY_YET): ,<br>
2022-03-06 15:02:40 MANAGEMENT: &gt;STATE:1646568160,RECONNECTING,connection-reset,<br>
2022-03-06 15:02:40 New OpenVPN Status (RECONNECTING-&gt;LEVEL_CONNECTING_NO_SERVER_REPLY_YET): connection-reset,<br>
2022-03-06 15:02:40 New OpenVPN Status (RECONNECTING-&gt;LEVEL_CONNECTING_NO_SERVER_REPLY_YET): connection-reset,<br>
2022-03-06 15:02:40 New OpenVPN Status (CONNECTRETRY-&gt;LEVEL_CONNECTING_NO_SERVER_REPLY_YET): 3<br>
2022-03-06 15:02:40 NewOpenVPN Status (CONNECTRETRY-&gt;LEVEL_CONNECTING_NO_SERVER_REPLY_YET): 3<br>
2022-03-06 15:02:40 Ожидание 3s секунд между попыткой подключения<br>
2022-03-06 15:02:43 MANAGEMENT: CMD ‘hold release’<br>
2022-03-06 15:02:43 MANAGEMENT: CMD ‘proxy NONE’<br>
2022-03-06 15:02:43 MANAGEMENT: CMD ‘bytecount 2’<br>
2022-03-06 15:02:43 MANAGEMENT: CMD ‘state on’<br>
2022-03-06 15:02:44 Control Channel MTU parms [ L:1623 D:1210 EF:40 EB:0 ET:0 EL:3 ]<br>
2022-03-06 15:02:44 Data Channel MTU parms [ L:1623 D:1450 EF:123 EB:406 ET:0 EL:3 ]<br>
2022-03-06 15:02:44 Local Options String (VER=V4): ‘V4,dev-type tun,link-mtu 1559,tun-mtu 1500,proto TCPv4_CLIENT,cipher AES-128-CBC,auth SHA1,keysize 128,key-method 2,tls-client’<br>
2022-03-06 15:02:44 Expected Remote Options String (VER=V4): ‘V4,dev-type tun,link-mtu 1559,tun-mtu 1500,proto TCPv4_SERVER,cipher AES-128-CBC,auth SHA1,keysize 128,key-method 2,tls-server’<br>
2022-03-06 15:02:44 TCP/UDP: Preserving recently used remote address: [AF_INET]185.177.120.9:1194<br>
2022-03-06 15:02:44 Socket Buffers: R=[1048576-&gt;1048576] S=[1048576-&gt;1048576]<br>
2022-03-06 15:02:44 New OpenVPN Status (TCP_CONNECT-&gt;LEVEL_CONNECTING_NO_SERVER_REPLY_YET): ,<br>
2022-03-06 15:02:44 New OpenVPN Status (TCP_CONNECT-&gt;LEVEL_CONNECTING_NO_SERVER_REPLY_YET): ,<br>
2022-03-06 15:02:44 Attempting to establish TCP connection with [AF_INET]185.177.120.9:1194 [nonblock]<br>
2022-03-06 15:02:44 MANAGEMENT: &gt;STATE:1646568164,TCP_CONNECT,<br>
2022-03-06 15:02:44 MANAGEMENT: CMD ‘needok ‘PROTECTFD’ ok’<br>
2022-03-06 15:02:45 TCP connection established with [AF_INET]185.177.120.9:1194<br>
2022-03-06 15:02:45 MANAGEMENT: CMD ‘needok ‘PROTECTFD’ ok’<br>
2022-03-06 15:02:45 TCP_CLIENT link local: (not bound)<br>
2022-03-06 15:02:45 New OpenVPN Status (WAIT-&gt;LEVEL_CONNECTING_NO_SERVER_REPLY_YET): ,<br>
2022-03-06 15:02:45 New OpenVPN Status (WAIT-&gt;LEVEL_CONNECTING_NO_SERVER_REPLY_YET): ,<br>
2022-03-06 15:02:45 TCP_CLIENT link remote: [AF_INET]185.177.120.9:1194<br>
2022-03-06 15:02:45 New OpenVPN Status (RECONNECTING-&gt;LEVEL_CONNECTING_NO_SERVER_REPLY_YET): connection-reset,<br>
2022-03-06 15:02:45 New OpenVPN Status (RECONNECTING-&gt;LEVEL_CONNECTING_NO_SERVER_REPLY_YET): connection-reset,<br>
2022-03-06 15:02:45 MANAGEMENT: &gt;STATE:1646568165,WAIT,<br>
2022-03-06 15:02:45 Connection reset, restarting [0]<br>
2022-03-06 15:02:45 TCP/UDP: Closing socket<br>
2022-03-06 15:02:45 SIGUSR1[soft,connection-reset] received, process restarting<br>
2022-03-06 15:02:45 MANAGEMENT: &gt;STATE:1646568165,RECONNECTING,connection-reset,<br>
2022-03-06 15:02:45 New OpenVPN Status (CONNECTRETRY-&gt;LEVEL_CONNECTING_NO_SERVER_REPLY_YET): 3<br>
2022-03-06 15:02:45 New OpenVPN Status (CONNECTRETRY-&gt;LEVEL_CONNECTING_NO_SERVER_REPLY_YET): 3<br>
2022-03-06 15:02:45 Ожидание 3s секунд между попыткой подключения<br>
2022-03-06 15:02:48 MANAGEMENT: CMD ‘hold release’<br>
2022-03-06 15:02:48 MANAGEMENT: CMD ‘proxy NONE’<br>
2022-03-06 15:02:48 MANAGEMENT: CMD ‘bytecount 2’<br>
2022-03-06 15:02:48 MANAGEMENT: CMD ‘state on’<br>
2022-03-06 15:02:49 MGMT: Got unrecognized command&gt;FATAL:All connections have been connect-retry-max (2) times unsuccessful, exiting<br>
2022-03-06 15:02:49 MANAGEMENT: Client disconnected<br>
2022-03-06 15:02:49 All connections have been connect-retry-max (2) times unsuccessful, exiting<br>
2022-03-06 15:02:49 Exiting due to fatal error<br>
2022-03-06 15:02:49 Process exited with exit value 1<br>
2022-03-06 15:02:49 New OpenVPN Status (NOPROCESS-&gt;LEVEL_NOTCONNECTED): No process running.<br>
2022-03-06 15:02:49 New OpenVPN Status (NOPROCESS-&gt;LEVEL_NOTCONNECTED): No process running.</p>
</details></td><td>2022-03-06T12:13:37.451Z</td></tr><tr><td>ValdikSS</td><td><aside class="quote no-group" data-username="drfischer" data-post="111" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/d/e95f7d/48.png" class="avatar"> drfischer:</div>
<blockquote>
<p>Error: Error when starting proxy device ‘proxy_1194_udp’ for container antizapret-vpn: Proxy device doesn’t support the connection type: udp</p>
</blockquote>
</aside>
<p>У вас, видимо, очень старая версия LXD. Подозреваю, что у вас Ubuntu 18.04 или старше, и LXD из репозиториев, она там больше не обновляется. Версия новее есть в Snap.</p>
<aside class="quote no-group" data-username="drfischer" data-post="111" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/d/e95f7d/48.png" class="avatar"> drfischer:</div>
<blockquote>
<p>Обратил внимание(может это имеет значение) если внутри контейнера запускаю curl <a href="http://icanhazip.com">icanhazip.com</a> - в ответ получаю ip сервера. Так разве должно быть?</p>
</blockquote>
</aside>
<p>Да, именно так и должно быть.</p>
<aside class="quote no-group" data-username="drfischer" data-post="111" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/d/e95f7d/48.png" class="avatar"> drfischer:</div>
<blockquote>
<p>При попытке подключится через приложение получаю такой лог</p>
</blockquote>
</aside>
<p>TCP-соединение отвергается, т.е. пакеты не доходят до контейнера (либо OpenVPN внутри контейнера не запустился).</p></td><td>2022-03-06T12:27:18.854Z</td></tr><tr><td>drfischer</td><td><p>Все получилось! Ура!</p>
<ol>
<li>Переустановил вирт машину с Ubuntu 20</li>
<li>Установил LXD из Snap</li>
</ol>
<p>Далее все как по маслу…</p>
<p>Спасибо Вам!!!</p></td><td>2022-03-06T13:33:13.579Z</td></tr><tr><td>VPNX</td><td><p>Добрый день</p>
<ul>
<li>есть VDS в России<br>
можно ли на нем сделать обход запрета ресурсов, запрещенных на территории России?</li>
</ul>
<p>делаю товарищу vpn для доступа к ресурсам на территории России, тк он не может получить к ним доступ<br>
в фаил nano /root/antizapret/config/include-hosts-custom.txt<br>
добавил нужные хосты<br>
<a href="http://vk.com" rel="noopener nofollow ugc">vk.com</a>, <a href="http://mail.ru" rel="noopener nofollow ugc">mail.ru</a> и тп, они открываются у него нормально<br>
а вот например тот же рутрекер уже нет</p></td><td>2022-03-11T04:21:36.612Z</td></tr><tr><td>ValdikSS</td><td><p>Можно попробовать применить <a href="https://github.com/bol-van/zapret">zapret</a>, он эффективен во многих случаях.<br>
Либо на отдельном VPN сервере, к которому и должны подключаться клиенты, маршрутизируйте IP-диапазоны по географическому признаку, в разные VPN.</p></td><td>2022-03-11T07:38:43.373Z</td></tr><tr><td>VPNX</td><td><p>Видел, думал как запасной вариант<br>
получается на хостинге в России не обойти ограничения?</p></td><td>2022-03-11T07:45:38.463Z</td></tr><tr><td>ValdikSS</td><td><p>Я вам написал про zapret, попробуйте его.</p></td><td>2022-03-11T08:27:44.691Z</td></tr><tr><td>kirill</td><td><p>В свете предстоящей блокировки Instagram,<br>
т.к. контент тоже “тяжёлый” и вряд ли будет оперативно добавлен на основной антизапрет,</p>
<p>какие адреса для инстаграма нужно будет прописать на своём антизапрете в<br>
<code>lxc exec antizapret-vpn -- nano /root/antizapret/config/include-hosts-custom.txt</code><br>
кроме основного <code>instagram.com</code>,<br>
по F12 в браузере смотрел, но больше особо ничего не увидел</p>
<p>?</p></td><td>2022-03-11T16:56:52.227Z</td></tr><tr><td>surpriz</td><td><p>Как минимум еще их cdn -  *.cdninstagram.com</p></td><td>2022-03-12T08:34:07.691Z</td></tr><tr><td>sevastianovv(Sevastianovv)</td><td><p>Доброго. Можно подробней, не заходит.</p></td><td>2022-03-14T04:56:42.054Z</td></tr><tr><td>413xk</td><td><p>Подскажите пожалуйста по поводу обновления списков еще раз:<br>
например, 7 марта в “обычный антизапрет” был добавлен домен <a href="http://theins.ru" rel="noopener nofollow ugc">theins.ru</a>.</p>
<p>На своём установленном контейнере делаю ./doall.sh;<br>
Пробую зайти на <a href="http://theins.ru" rel="noopener nofollow ugc">theins.ru</a> - не пускает.</p>
<p>Добавляю домен <a href="http://theins.ru" rel="noopener nofollow ugc">theins.ru</a> ручками в include-hosts-custom.txt и всё работает.</p>
<p>Получается, что если doall-контейнера не подтягивает через три дня домен, который заблочен (и внесен в список доменов для обычного-антизапрета), то как бы получать список доменов “которые надо разблокировать” через include-hosts-custom.txt ?</p></td><td>2022-03-14T06:01:32.403Z</td></tr><tr><td>nzkhammatov(Ainur Khammatov)</td><td><p>include-hosts-custom.txt</p>
<pre><code class="lang-auto">instagram.com
cdninstagram.com
</code></pre></td><td>2022-03-14T06:32:48.807Z</td></tr><tr><td>sevastianovv(Sevastianovv)</td><td><p>Спасибо!!!</p></td><td>2022-03-14T06:39:55.202Z</td></tr><tr><td>surpriz</td><td><p>Не совсем так. В контейнер автоматически (раз в 6-ть часов) подгружаются списки адресов с репозитория <a href="https://github.com/zapret-info/z-i" class="inline-onebox" rel="noopener nofollow ugc">GitHub - zapret-info/z-i: Register of Internet Addresses filtered in Russian Federation</a> , там появляется только то, что официально заблокированно (проверить можно на сайте ркн <a href="https://blocklist.rkn.gov.ru/" rel="noopener nofollow ugc">https://blocklist.rkn.gov.ru/</a>). На примере <a href="http://theins.ru/" rel="noopener nofollow ugc">theins.ru</a> его нет в реестре, он блокируется на ТСПУ незаконно. Поэтому, <a class="mention" href="/u/valdikss">@ValdikSS</a> условно вручную на своем сервере добавил его в include-hosts-custom.txt, этот список не подгружается на серверы которые мы сами себе подняли (нам это тоже нужно делать вручную).</p></td><td>2022-03-14T06:54:04.762Z</td></tr><tr><td>413xk</td><td><aside class="quote no-group" data-username="surpriz" data-post="124" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/s/7c8e57/48.png" class="avatar"> surpriz:</div>
<blockquote>
<p>Поэтому, <a class="mention" href="/u/valdikss">@ValdikSS</a> условно вручную на своем сервере добавил его в include-hosts-custom.txt, этот список не подгружается на серверы которые мы сами себе подняли (нам это тоже нужно делать вручную).</p>
</blockquote>
</aside>
<p>Вот, я тоже всё так понял, я к тому и клоню - можно ли попросить <a class="mention" href="/u/valdikss">@ValdikSS</a> дублировать “список по понятиям” include-hosts-custom.txt…</p></td><td>2022-03-14T07:07:15.636Z</td></tr><tr><td>ValdikSS</td><td><aside class="quote no-group" data-username="413xk" data-post="125" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/4/ee59a6/48.png" class="avatar"> 413xk:</div>
<blockquote>
<p>Вот, я тоже всё так понял, я к тому и клоню - можно ли попросить <a class="mention" href="/u/valdikss">@ValdikSS</a> дублировать “список по понятиям” include-hosts-custom.txt…</p>
</blockquote>
</aside>
<p>В 2019-2020 году, когда я делал этот контейнер для пользователей, внереестровые блокировки условно не существовали. Обновление подобных списков подразумевалось через <code>include-hosts-dist.txt</code>, но сейчас, если обновить скрипты в контейнере, вообще всё сломается. Посмотрю, в чём проблема, позже.</p></td><td>2022-03-14T09:45:55.563Z</td></tr><tr><td>ValdikSS</td><td><p>Часть доменов Твиттера, Фейсбука и Инстаграма заблокирована на ТСПУ, но не добавлена в Реестр Запрещенных Сайтов.<br>
Чтобы эти сайты работали корректно, следует сделать следующее:</p>
<p>А должно работать, только что проверил.</p>
<ol>
<li>Зайти в контейнер: (LXD) <code>lxc shell antizapret-vpn</code> или (machined) <code>machinectl shell antizapret-vpn /bin/bash</code>
</li>
<li>Выполнить:</li>
</ol>
<pre><code class="lang-auto">echo "t.co
twimg.com
fbcdn.net
cdninstagram.com
fb.com
messenger.com
theins.ru" &gt;&gt; /root/antizapret/config/include-hosts-custom.txt
</code></pre>
<ol start="3">
<li>Выполнить <code> LANG=C.UTF-8 /root/antizapret/doall.sh</code>, либо просто перезагрузить контейнер и подождать минуты три.</li>
</ol></td><td>2022-03-14T09:50:05.433Z</td></tr><tr><td>413xk</td><td><p>Может можно тогда не автоматизировано как-то списком делиться? Выложить где-нибудь файл, мы будем сами под свою ответственность синхронить/ручками ctrl+c/ctrl+v фигачить если что.</p></td><td>2022-03-14T16:27:43.827Z</td></tr><tr><td>ValdikSS</td><td><p>В предыдущем сообщении приведен такой список. Намерен его обновлять.</p></td><td>2022-03-14T16:33:32.203Z</td></tr><tr><td>413xk</td><td><ul>
<li><a href="http://tjournal.ru" rel="noopener nofollow ugc">tjournal.ru</a></li>
</ul>
<p>Кстати, а что будет если условно мы вносим домены которые заблокированы на ТСПУ, но не добавлены в реестр, а потом бац, и добавят в реестр?<br>
Контейнер от “двойного налогообложения” не сойдет с ума?</p>
<p>То есть, сейчас <a href="http://theins.ru" rel="noopener nofollow ugc">theins.ru</a> - чисто на ТСПУ.<br>
Завтра РКН бац, и внесет в реестр, реестр выгрузится к нам в контейнеры, и получается будет два theins’а (“тспушный ручной” и “реестровый автоматический”). Всё нормально будет?</p></td><td>2022-03-14T16:42:06.224Z</td></tr><tr><td>ValdikSS</td><td><aside class="quote no-group" data-username="413xk" data-post="130" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/4/ee59a6/48.png" class="avatar"> 413xk:</div>
<blockquote>
<p>Контейнер от “двойного налогообложения” не сойдет с ума?</p>
</blockquote>
</aside>
<p>Нет.</p>
<aside class="quote no-group" data-username="413xk" data-post="130" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/4/ee59a6/48.png" class="avatar"> 413xk:</div>
<blockquote>
<p>То есть, сейчас <a href="http://theins.ru">theins.ru</a> - чисто на ТСПУ.</p>
</blockquote>
</aside>
<p>Уже в Реестре.</p></td><td>2022-03-14T16:43:10.750Z</td></tr><tr><td>Draft(Artem Draft)</td><td><p>Добрый вечер! Спасибо за отличную работу!<br>
Хотел спросить парочку вопросов:</p>
<ol>
<li>Не планируется ли версия с Wireguard?</li>
<li>На машине с 1Гб пару дней назад начал отваливаться DNS резолвер, что вызвало полную потерю интернета в сети. Попав в консоль обнаружил, что свободно около ~30 мб памяти. Я так понимаю 2 ГБ в текущих реалиях это необходимым минимум? Пока ресайзнул дроплет до 2 ГБ - пару дней полет ОК, но не хотелось бы повторения истории, так как сеть офисная )</li>
</ol></td><td>2022-03-14T17:00:29.323Z</td></tr><tr><td>m28688(m286)</td><td><p><a class="mention" href="/u/valdikss">@ValdikSS</a> Добрый день, перестал работать скрипт для установки." Установка на Vultr и Scaleway (с помощью cloud-init)", можешь посмотреть? или подсказать как по другому установить?<br>
<div class="lightbox-wrapper"><a class="lightbox" href="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/eb0192763c12416f28fc912ded5d38453eaf5889.jpeg" data-download-href="https://ntc.party/uploads/default/eb0192763c12416f28fc912ded5d38453eaf5889" title="Снимок экрана 2022-03-15 в 14.28.10"><img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/eb0192763c12416f28fc912ded5d38453eaf5889_2_690x485.jpeg" alt="Снимок экрана 2022-03-15 в 14.28.10" data-base62-sha1="xwXzzGzkpl52qTbcLEeo4l0P2bf" width="690" height="485" srcset="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/eb0192763c12416f28fc912ded5d38453eaf5889_2_690x485.jpeg, контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/eb0192763c12416f28fc912ded5d38453eaf5889_2_1035x727.jpeg 1.5x, контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/eb0192763c12416f28fc912ded5d38453eaf5889_2_1380x970.jpeg 2x" data-dominant-color="404041"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">Снимок экрана 2022-03-15 в 14.28.10</span><span class="informations">2164×1524 604 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p></td><td>2022-03-15T09:12:01.832Z</td></tr><tr><td>ValdikSS</td><td><p>На Vultr нужно отключить ufw:</p>
<pre><code class="lang-nohighlight">systemctl disable --now ufw
machinectl stop antizapret-vpn
machinectl start antizapret-vpn
sleep 20
machinectl copy-from antizapret-vpn /root/easy-rsa-ipsec/CLIENT_KEY/antizapret-client-tcp.ovpn /root/antizapret-client-tcp.ovpn

</code></pre></td><td>2022-03-15T11:50:25.798Z</td></tr><tr><td>m28688(m286)</td><td><p>Спасибо, все заработало. Подскажите, сколько можно максимально подключить устройств через один профиль antizapret? или можно создать несколько antizapret1…2…3…</p></td><td>2022-03-15T12:35:33.778Z</td></tr><tr><td>ValdikSS</td><td><p>Ограничения по количеству подключений с одним конфигурационным файлом условно неограничено (2048, что ли).</p></td><td>2022-03-15T12:41:32.058Z</td></tr><tr><td>ValdikSS</td><td><aside class="quote no-group" data-username="Draft" data-post="132" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/draft/48/1045_2.png" class="avatar"> Draft:</div>
<blockquote>
<p>На машине с 1Гб пару дней назад начал отваливаться DNS резолвер, что вызвало полную потерю интернета в сети. Попав в консоль обнаружил, что свободно около ~30 мб памяти. Я так понимаю 2 ГБ в текущих реалиях это необходимым минимум?</p>
</blockquote>
</aside>
<p>Вроде бы, памяти требуется порядка 600-700 мегабайт. Можете настроить zram на 50-100% RAM, этого должно быть достаточно для работы на VPS с 1 ГБ памяти.</p>
<aside class="quote no-group" data-username="Draft" data-post="132" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/draft/48/1045_2.png" class="avatar"> Draft:</div>
<blockquote>
<p>Не планируется ли версия с Wireguard?</p>
</blockquote>
</aside>
<p>Нет.</p></td><td>2022-03-15T14:17:20.843Z</td></tr><tr><td>mafiacheb(Александр)</td><td><p>Настроил все на свое впс серверы, все сайты работают открываются все ок. Но вот инстграм приложение вообще не грузит картинки, только текст. Почему так? С вашим конфигом для опен впн все ок,а в от когда сам устанавливаю контейнер то инстграм картинки не подгружает. Дополнительные действия проделал. В чем ещё может быть проблема?</p></td><td>2022-03-15T18:54:18.278Z</td></tr><tr><td>ValdikSS</td><td><p>Похоже, что <code>cdninstagram.com</code> не маршрутизируется. Проверьте, что не забыли добавить его. <code>nslookup cdninstagram.com</code> с вашего компьютера должен возвращать IP-адрес из сети <code>10.x.x.x</code>.</p></td><td>2022-03-15T21:00:45.363Z</td></tr><tr><td>finik77(Finik77)</td><td><p>Можно сделать так: контейнер на машине в России, но блокированное заворачивать в tor?</p></td><td>2022-03-16T09:50:19.374Z</td></tr><tr><td>lindex(lindex)</td><td><p>такая же проблема, все сделал по инструкции. <code>nslookup</code> инстаграма не заворачивается через <code>10.x.x.x</code></p></td><td>2022-03-16T15:38:55.657Z</td></tr><tr><td>max41479</td><td><p>попробуйте <code>nslookup scontent-frt3-2.cdninstagram.com</code> вместо <code>nslookup cdninstagram.com</code></p></td><td>2022-03-16T16:11:03.840Z</td></tr><tr><td>m28688(m286)</td><td><p><a class="mention" href="/u/valdikss">@ValdikSS</a> подскажи какие адреса вносить в include host; если заблокируют YouTube сегодня?</p></td><td>2022-03-18T14:32:56.289Z</td></tr><tr><td>ValdikSS</td><td><p>6 posts were split to a new topic: <a href="/t/topic/2015">Как платить?</a></p></td><td>2022-03-20T07:56:08.222Z</td></tr><tr><td>ValdikSS</td><td><p>Как минимум:</p>
<pre><code class="lang-auto">youtube.com
ytimg.com
ggpht.com
googlevideo.com
</code></pre></td><td>2022-03-18T16:40:28.731Z</td></tr><tr><td>ValdikSS</td><td><aside class="quote no-group" data-username="finik77" data-post="141" data-topic="129" data-full="true">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/finik77/48/1067_2.png" class="avatar"> finik77:</div>
<blockquote>
<p>Можно сделать так: контейнер на машине в России, но блокированное заворачивать в tor?</p>
</blockquote>
</aside>
<p>Это возможно, но нетривиально. Используйте redsocks и аналоги.</p></td><td>2022-03-18T16:47:12.994Z</td></tr><tr><td>ValdikSS</td><td><p>Лист обновлён, добавлены:</p>
<pre><code class="lang-auto">messenger.com
fb.com
</code></pre></td><td>2022-03-19T21:53:47.753Z</td></tr><tr><td>alexalex</td><td><p>Обнаружено странное.<br>
flibusta.lib - не резолвится (NXDOMAIN). nx.bit - без проблем. Похоже, если сайт из OpenNIC доменов в списке блокировки - происходит внутренний конфликт в knot-resolver.</p></td><td>2022-03-20T12:07:35.617Z</td></tr><tr><td>rubberducky</td><td><p><div class="lightbox-wrapper"><a class="lightbox" href="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/74feece01bf31e369f61efbc593199072a09a949.jpeg" data-download-href="https://ntc.party/uploads/default/74feece01bf31e369f61efbc593199072a09a949" title="vpn"><img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/74feece01bf31e369f61efbc593199072a09a949_2_690x159.jpeg" alt="vpn" data-base62-sha1="gGZyOor3gh7mG9l3e0BspTyIg7T" width="690" height="159" srcset="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/74feece01bf31e369f61efbc593199072a09a949_2_690x159.jpeg, контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/74feece01bf31e369f61efbc593199072a09a949_2_1035x238.jpeg 1.5x, контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/74feece01bf31e369f61efbc593199072a09a949.jpeg 2x" data-dominant-color="202020"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">vpn</span><span class="informations">1117×258 61 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div><br>
Помогите пожалуйста, vps с kvm ubunutu 20.04 пытаюсь установить с помощью systemd-machined, начиная с команды <strong>systemctl enable --now systemd-networkd.service</strong> чет не так идет</p></td><td>2022-03-20T15:45:00.658Z</td></tr><tr><td>alexalex</td><td><p>У Вас, похоже, systemd-networkd.service маскирован.</p>
<p>Проверка:<br>
sudo systemctl list-unit-files | grep systemd-networkd<br>
не должно быть masked</p>
<p>Убрать маскирование:<br>
sudo systemctl unmask systemd-networkd</p></td><td>2022-03-20T17:30:44.926Z</td></tr><tr><td>alexalex</td><td><p>А из exclude-hosts-dist.txt тогда их убирать надо будет?</p></td><td>2022-03-21T23:46:23.783Z</td></tr><tr><td>rubberducky</td><td><p>Спасибо получилось поднять vpn на собственном vps, а возможно ли сделать чтоб на vps все днс запросы заворачивались в dnscrypt proxy? Хочу именно использовать днс от: <a href="https://kb.adguard.com/ru/general/dns-providers#adguard-dns" class="inline-onebox" rel="noopener nofollow ugc">Популярные DNS-провайдеры | AdGuard Knowledgebase</a><br>
как по мне она хорошо исправляется с блокировкой рекламы</p></td><td>2022-03-22T06:25:49.545Z</td></tr><tr><td>nzkhammatov(Ainur Khammatov)</td><td><aside class="quote" data-post="40" data-topic="129">
  <div class="title">
    <div class="quote-controls"></div>
    <img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/valdikss/48/2_2.png" class="avatar">
    <a href="https://ntc.party/t/vpn/129/40">Контейнер VPN АнтиЗапрета для установки на собственный сервер</a> <a class="badge-category__wrapper " href="/c/antizapret-prostovpn-org/az-self-hosted/38"><span data-category-id="38" style="--category-badge-color: #0088CC; --category-badge-text-color: #FFFFFF; --parent-category-badge-color: #8C6238;" data-parent-category-id="5" data-drop-close="true" class="badge-category --has-parent" title="Вопросы и особенности работы контейнера VPN АнтиЗапрета на своих серверах"><span class="badge-category__name">АнтиЗапрет на собственном сервере (self-hosted)</span></span></a>
  </div>
  <blockquote>
    Полагаю, что можно. В файл /etc/knot-resolver/kresd.conf, в самый конец добавьте следующую строку: 
policy.add(policy.all(policy.FORWARD({'192.0.2.1'})))

Где 192.0.2.1 — IP-адрес DNS-сервера AdGuard. Контейнер с VPN антизапрета должен иметь доступ до этого IP-адреса.
  </blockquote>
</aside>
</td><td>2022-03-22T06:37:30.347Z</td></tr><tr><td>Numstar</td><td><p>Не резолвятся сервисы google (nxdomain) если добавить news в include</p>
<p><a href="http://Mail.google.com" rel="noopener nofollow ugc">Mail.google.com</a> <a href="http://translate.google.com" rel="noopener nofollow ugc">translate.google.com</a> На своём сервере после добавления <a href="http://news.google.com" rel="noopener nofollow ugc">news.google.com</a> в include не резолвятся, где-то в процессе фильтрации news отсоединяется от Google и в конечный список попадает весь гугл. Можно ли исправить, не добавляя весь гугл в список, а только news?</p></td><td>2022-03-25T07:23:59.684Z</td></tr><tr><td>ValdikSS</td><td><p>Скрипты заточены под обработку зон, а не отдельных доменов.<br>
Можете попробовать добавить в файл <code>/root/antizapret/scripts/getzones.awk</code>, в длинную строку с доменами, в конец <code>|google</code>.</p>
<p>Примерно так:<br>
<code>…appspot|my1|hwcdn|google)\.[^.]+$/))</code></p></td><td>2022-03-25T08:47:41.717Z</td></tr><tr><td>Numstar</td><td><p>Где-то я накосячил, после того как я попробовал убрать фильтры doall выдал ошибку, вернул как было, обновил, прошло без ошибок, но теперь не подключается к серверу, в чём может быть проблема?<br>
Контейнер перезапускал, полностью систему перезагружал - не помогает</p></td><td>2022-03-25T09:32:19.693Z</td></tr><tr><td>kirill</td><td><p>и тогда можно в /root/antizapret/config/include-hosts-custom.txt добавить google news как домен третьего уровня,<br>
т.е.</p>
<pre><code class="lang-auto">news.google.com
play.google.com
</code></pre>
<p>?</p></td><td>2022-03-25T15:17:23.584Z</td></tr><tr><td>ValdikSS</td><td><p>Да.</p></td><td>2022-03-25T15:30:45.207Z</td></tr><tr><td>kirill</td><td><p>спасибо,<br>
и play, и news - работают</p>
<p>эдак такими темпами чудачеств ркн <a href="https://ntc.party/t/vpn/129/127">к этому посту</a> скоро понадобится дополнение,<br>
возможно, что не последнее</p></td><td>2022-03-25T17:37:15.123Z</td></tr><tr><td>Andy(Andrey)</td><td><p>Здравствуйте, можете немного прояснить правила iptables внутри контейнера, вида:</p>
<p>-A dnsmap -d 10.224.0.1/32 -j DNAT --to-destination 195.82.146.216<br>
-A dnsmap -d 10.224.0.2/32 -j DNAT --to-destination 196.245.156.18<br>
-A dnsmap -d 10.224.0.3/32 -j DNAT --to-destination 196.245.156.20<br>
и т.д.,</p>
<p>Я так понимаю, что независимо от того, что контейнер устанавливается на своем vps некоторый трафик   все равно заворачивается через ваши серверы?</p>
<p>Большое спасибо!</p></td><td>2022-03-27T06:46:23.082Z</td></tr><tr><td>vovansick</td><td><p>Здравствуйте.<br>
Установил на VPS сервер российского хоста с местоположением в Нидерландах сервер антизапрета.<br>
Устанавливал через systemd-container на ОС Debian 11. Всё заработало, проверял в основном на instagram’e скорость загрузки. Не понравилась скорость, немного долго подгружает, да и в целом скорость скачивания обычно на уровне 500-800 кбайт/сек.<br>
Сначала прописал на хосте ip forwarding, добавил правила iptables как писали в комментариях <a href="https://ntc.party/t/vpn/129/90">тут</a>, сделав перед этим очистку iptables. Также добавил в /root/antizapret/config/include-hosts-custom.txt некоторые домены, о которых здесь писали (в частности <a href="https://ntc.party/t/vpn/129/127">тут</a>). Стало получше, но всё равно.</p>
<p>На хосте загрузка cpu выше 5% не поднимается, если бегать по instagram reels, скорость передачи обычно выше 10 mbit/s тоже не идёт. Сам хост имеет параметры: 1vcpu, 1gb ram, 30gb ssd, 100mbit/s unlim.<br>
Может это и есть нормальное функционирование, а я просто не до конца понимаю принцип действия сервера<br>
UPD: убрал всё добавленное в /root/antizapret/config/include-hosts-custom.txt, с инстаграмом стало получше, но если пробовать добавлять зоны для youtube, то получается что посмотреть видео 4k уже не получится, скорости не хватает<br>
UPD2: Хм, где-то после часа работы скорость выросла, уже где-то 10-20 mbit/s на хосте (через nload смотрю), уже стало комфортно и быстро. Но всё равно не понимаю почему так</p></td><td>2022-03-27T12:19:31.974Z</td></tr><tr><td>m28688(m286)</td><td><p><a class="mention" href="/u/valdikss">@ValdikSS</a>  Наблюдаю проблемы со входом в приложение Сбербанк, при включенном vpn антизапрета<br>
<div class="lightbox-wrapper"><a class="lightbox" href="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/8cf15aa472823100ea0c2ba16322c3c852306057.jpeg" data-download-href="https://ntc.party/uploads/default/8cf15aa472823100ea0c2ba16322c3c852306057" title="photo_2022-03-27 16.47.21"><img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/8cf15aa472823100ea0c2ba16322c3c852306057_2_230x500.jpeg" alt="photo_2022-03-27 16.47.21" data-base62-sha1="k6PWyX657h0jAPOynOmdowgOIQv" width="230" height="500" srcset="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/8cf15aa472823100ea0c2ba16322c3c852306057_2_230x500.jpeg, контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/8cf15aa472823100ea0c2ba16322c3c852306057_2_345x750.jpeg 1.5x, контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/8cf15aa472823100ea0c2ba16322c3c852306057_2_460x1000.jpeg 2x" data-dominant-color="F9F9F9"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">photo_2022-03-27 16.47.21</span><span class="informations">591×1280 20 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p></td><td>2022-03-27T13:47:50.508Z</td></tr><tr><td>ValdikSS</td><td><aside class="quote no-group" data-username="Andy" data-post="165" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/a/aeb1de/48.png" class="avatar"> Andy:</div>
<blockquote>
<p>Здравствуйте, можете немного прояснить правила iptables внутри контейнера, вида:</p>
</blockquote>
</aside>
<p>Это правила, которые перенаправляют запросы из внутреннего диапазона на настоящие IP-адреса заблокированных сайтов. Серверы АнтиЗапрета никаким образом не задействованы в контейнере.</p>
<aside class="quote no-group" data-username="m28688" data-post="167" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/m/e47774/48.png" class="avatar"> m28688:</div>
<blockquote>
<p>Наблюдаю проблемы со входом в приложение Сбербанк, при включенном vpn антизапрета</p>
</blockquote>
</aside>
<p>Возможно, дело в блокировке российских DNS для доступа извне. Попробуйте отключить DNS-резолвер внутри контейнера и задействовать Яндексовский <code>77.88.8.8</code>, может, поможет: <a href="https://ntc.party/t/vpn/129/40" class="inline-onebox">Контейнер VPN АнтиЗапрета для установки на собственный сервер - #40 by ValdikSS</a></p></td><td>2022-03-27T21:18:30.994Z</td></tr><tr><td>ValdikSS</td><td><p>Разобрались с проблемой? В z-i произошли изменения, нарушающие работу скриптов в целом, но конкретно контейнер это, похоже, не затронуло.</p></td><td>2022-03-27T21:19:17.647Z</td></tr><tr><td>Numstar</td><td><p>Так и не понял почему не коннектилось, решил, что проще будет пересобрать скрипт, ибо ещё не успел разослать файл ovpn всем. После сброса контейнера и повторной настройки всё заработало</p></td><td>2022-03-28T05:49:27.611Z</td></tr><tr><td>mafiacheb(Александр)</td><td><p>что то не получается по сфтп найти  папку not-resolver и тем более файл kresd.conf</p></td><td>2022-03-28T07:26:42.366Z</td></tr><tr><td>Andy(Andrey)</td><td><p>Он в контейнере, зайти можно так (если не меняли имя контейнера):<br>
lxc exec antizapret-vpn bash</p></td><td>2022-03-28T08:36:13.884Z</td></tr><tr><td>Andy(Andrey)</td><td><aside class="quote no-group" data-username="ValdikSS" data-post="168" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/valdikss/48/2_2.png" class="avatar"> ValdikSS:</div>
<blockquote>
<p>Это правила, которые перенаправляют запросы из внутреннего диапазона на настоящие IP-адреса заблокированных сайтов. Серверы АнтиЗапрета никаким образом не задействованы в контейнере.</p>
</blockquote>
</aside>
<p>Я правильно понимаю, что они динамически добавляются в зависимости от запросов с клиентов?<br>
Если так, то какое время хранятся данные правила и происходит ли их чистка.<br>
Спасибо!</p></td><td>2022-03-28T09:15:47.619Z</td></tr><tr><td>ValdikSS</td><td><p>Правила хранятся до перезагрузки, чистка не производится.</p></td><td>2022-03-28T09:24:35.972Z</td></tr><tr><td>Andy(Andrey)</td><td><p>Понял.<br>
Еще вопрос, где хранятся правила iptables которые применяются при запуске контейнера по умолчанию.<br>
Спасибо.</p></td><td>2022-03-28T09:27:12.725Z</td></tr><tr><td>ValdikSS</td><td><p><code>/etc/ferm/ferm.conf</code>.</p></td><td>2022-03-28T09:31:48.496Z</td></tr><tr><td>Andy(Andrey)</td><td><p>Спасибо большое.</p></td><td>2022-03-28T09:34:36.987Z</td></tr><tr><td>mafiacheb(Александр)</td><td><p>можно более подробную инструкцию для не очень понимающих пожалуйста? а то тоже проблемы со сбером<br>
а то у меня выходит следующее:<br>
root@VPN:~# lxc exec antizapret-vpn bash<br>
root@antizapret-vpn:~# /etc/knot-resolver/kresd.conf<br>
bash: /etc/knot-resolver/kresd.conf: Permission denied<br>
root@antizapret-vpn:~#</p></td><td>2022-03-28T10:26:36.131Z</td></tr><tr><td>m28688(m286)</td><td><p>nano /etc/knot-resolver/kresd.conf</p>
<p>у меня все заработало</p></td><td>2022-03-28T14:59:21.695Z</td></tr><tr><td>mafiacheb(Александр)</td><td><p>спасибо!</p></td><td>2022-03-28T15:05:32.576Z</td></tr><tr><td>Andy(Andrey)</td><td><p>Попробовал кстати в целях избавления от рекламы использовать adguard dns, работает, однако отображение некоторых сайтов ломает. По крайней мере у меня.</p></td><td>2022-03-28T15:18:32.979Z</td></tr><tr><td>m28688(m286)</td><td><p><a class="mention" href="/u/valdikss">@ValdikSS</a> вчера добавил яндек dns последней строчкой, больше ничего не делал. Работать стало лучше, доступны стали большее количество приложений, но сегодня на утро снова ошибка<br>
<div class="lightbox-wrapper"><a class="lightbox" href="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/4e586f4513f5a4274889027b7e61ce83f9905aec.jpeg" data-download-href="https://ntc.party/uploads/default/4e586f4513f5a4274889027b7e61ce83f9905aec" title="photo_2022-03-29 09.15.15"><img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/4e586f4513f5a4274889027b7e61ce83f9905aec_2_230x500.jpeg" alt="photo_2022-03-29 09.15.15" data-base62-sha1="bb4IcYKZhY7rrlGcL1C4Wzq0Y0Y" width="230" height="500" srcset="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/4e586f4513f5a4274889027b7e61ce83f9905aec_2_230x500.jpeg, контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/4e586f4513f5a4274889027b7e61ce83f9905aec_2_345x750.jpeg 1.5x, контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/4e586f4513f5a4274889027b7e61ce83f9905aec_2_460x1000.jpeg 2x" data-dominant-color="F9F9F9"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">photo_2022-03-29 09.15.15</span><span class="informations">591×1280 21.5 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p></td><td>2022-03-29T06:15:30.514Z</td></tr><tr><td>Numstar</td><td><p>Всё сработало, спасибо!<br>
Было бы ещё хорошо настроить байпас, если возможно, чтобы если результат получается nxdomain он автоматом перенаправлял на прямое соединение, ибо это не первый раз когда я это вижу.</p></td><td>2022-03-31T18:01:22.723Z</td></tr><tr><td>NatRUS(Nat Rus)</td><td><p>Сейчас из коробки и твитер и инст работают (у меня так). Но некоторые хосты, которые работают через расширение (rutracker, nnm и другие), не работают через этот контейнер и вот если их прописать, то работают, а если инст прописать, то не он перестает работать. Наверное накладывается друг на дружку)</p></td><td>2022-04-01T13:44:04.192Z</td></tr><tr><td>vovansick</td><td><p>Я переустановил и прописал по другому iptables. Дополнительно хосты не прописывал, из коробки сейчас тоже всё работает. Но со скоростью не могу разобраться. Дописывал для проверки хосты youtub’а. Иногда работает на полную и всё отлично, скорость на полный канал. Но через какое-то время скорость опять выше 5-10 mbit/s не поднимается, потом может опять восстановится. Почему так происходит не могу понять, даже не понимаю где искать причину</p></td><td>2022-04-02T09:58:05.480Z</td></tr><tr><td>tez</td><td><p>Добрый день!<br>
После запуска контейнера пишет:<br>
<em>Error: Error occurred when starting proxy device: Error: Failed to listen on [::]:1194: listen tcp 0.0.0.0:1194: bind: address already in use</em><br>
<em>------------------------------</em><br>
просмотр ошибки<br>
<em>------------------------------</em><br>
<em>lxc antizapret-vpn 20220404034950.633 WARN     conf - conf.c:lxc_map_ids:3592 - newuidmap binary is missing</em><br>
<em>lxc antizapret-vpn 20220404034950.634 WARN     conf - conf.c:lxc_map_ids:3598 - newgidmap binary is missing</em><br>
<em>lxc antizapret-vpn 20220404034950.634 WARN     conf - conf.c:lxc_map_ids:3592 - newuidmap binary is missing</em><br>
<em>lxc antizapret-vpn 20220404034950.634 WARN     conf - conf.c:lxc_map_ids:3598 - newgidmap binary is missing</em><br>
<em>lxc antizapret-vpn 20220404034950.634 WARN     cgfsng - cgroups/cgfsng.c:fchowmodat:1252 - No such file or directory - Failed to fchownat(40, memory.oom.group, 1000000000, 0, AT_EMPTY_PATH | AT_SYMLINK_NOFOLLOW )</em><br>
<em>lxc antizapret-vpn 20220404034957.378 WARN     conf - conf.c:lxc_map_ids:3592 - newuidmap binary is missing</em><br>
<em>lxc antizapret-vpn 20220404034957.378 WARN     conf - conf.c:lxc_map_ids:3598 - newgidmap binary is missing</em><br>
<em>---------------------------------------</em><br>
В чем может быть проблема?</p></td><td>2022-04-04T03:57:04.496Z</td></tr><tr><td>surpriz</td><td><aside class="quote no-group" data-username="tez" data-post="189" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/t/df788c/48.png" class="avatar"> tez:</div>
<blockquote>
<p>Error: Error occurred when starting proxy device: Error: Failed to listen on [::]:1194: listen tcp 0.0.0.0:1194: bind: address already in use</p>
</blockquote>
</aside>
<p>на хосте отдельно openvpn не устанавливали? или как вариант, вы пытаетесь повторно запустить контейнер, хотя он уже запущен</p>
<p>сделайте: sudo netstat -pna | grep 1194</p></td><td>2022-04-04T07:27:11.445Z</td></tr><tr><td>tez</td><td><aside class="quote no-group" data-username="surpriz" data-post="190" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/s/7c8e57/48.png" class="avatar"> surpriz:</div>
<blockquote>
<p>на хосте отдельно openvpn не устанавливали?</p>
</blockquote>
</aside>
<p>Да, отдельно запущен. Его надо удалить или можно параллельно?</p></td><td>2022-04-04T07:36:31.849Z</td></tr><tr><td>Andy(Andrey)</td><td><p>Параллельно наверное можно, но порты разные надо использовать.<br>
1194 это порт для opevpn по умолчанию.</p></td><td>2022-04-04T08:33:07.183Z</td></tr><tr><td>surpriz</td><td><p><a class="mention" href="/u/andy">@Andy</a> верно написал, можете просто изменить порт подключения, для openvpn который установлен на хосте</p></td><td>2022-04-04T09:19:03.205Z</td></tr><tr><td>ValdikSS</td><td><p>Измените порт OpenVPN:</p>
<blockquote>
<p>lxc config device add antizapret-vpn proxy_<strong>1194</strong> proxy listen=tcp:[::]:<strong>1194</strong> connect=tcp:127.0.0.1:1194</p>
</blockquote>
<p>Также не забудьте поменять в клиентском файле конфигурации, допишите порт в конце строки <code>remote</code>.</p></td><td>2022-04-04T14:02:33.648Z</td></tr><tr><td>m28688(m286)</td><td><p><a class="mention" href="/u/valdikss">@ValdikSS</a> Добрый день, только на iPhone при включённом антизапрете не загружает контент из приложения YouTube, если зайти через браузер на YouTube, то все работает. Не сталкивались с такой проблемой ?</p></td><td>2022-04-05T08:02:03.512Z</td></tr><tr><td>tez</td><td><aside class="quote no-group" data-username="surpriz" data-post="193" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/s/7c8e57/48.png" class="avatar"> surpriz:</div>
<blockquote>
<p>верно написал, можете просто изменить порт подключения, для openvpn который установлен на хосте</p>
</blockquote>
</aside>
<p>Спасибо, переустановил openvpn с другим портом. Ура все заработало!</p></td><td>2022-04-06T05:10:19.755Z</td></tr><tr><td>tez</td><td><p>Еще вопрос.</p>
<ol>
<li>Как сделать дополнительный файл с ключами? или я могу использовать один и тот же на разных роутерах?</li>
<li>куда можно прописать определенный сервер, что бы при подключении к нему трафик шел через VPN?</li>
</ol></td><td>2022-04-06T05:16:37.244Z</td></tr><tr><td>Alexled(alex)</td><td><p>Добрый день. Стал замечать, что при заходе на страницы пользователей ВКонтакте трафик идет через Antizapret (допустим, фото профилей грузятся существенно медленнее при включенном VPN). Это все касается только мобильного приложения, в веб-версии все работает корректно.<br>
Можете подсказать где искать проблему?</p></td><td>2022-04-06T08:48:25.073Z</td></tr><tr><td>ValdikSS</td><td><aside class="quote no-group" data-username="m28688" data-post="195" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/m/e47774/48.png" class="avatar"> m28688:</div>
<blockquote>
<p>только на iPhone при включённом антизапрете не загружает контент из приложения YouTube, если зайти через браузер на YouTube, то все работает.</p>
</blockquote>
</aside>
<p>Не сталкивался. Затрудняюсь предположить, в чём может быть проблема, но пальцем в небо: резолв определённых доменов из контейнера выдаёт «неправильные» адреса, которые, по какой-то причине, заблокированы или фильтруются.<br>
Начните отладку со сбора адресов, это можно сделать через tcpdump:<br>
<code>tcpdump -n -i vpn-tcp port 53</code>.</p>
<aside class="quote no-group" data-username="tez" data-post="197" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/t/df788c/48.png" class="avatar"> tez:</div>
<blockquote>
<p>Как сделать дополнительный файл с ключами? или я могу использовать один и тот же на разных роутерах?</p>
</blockquote>
</aside>
<p>Можете использовать один общий конфигурационный файл. Дополнительные ключи можно создать вручную, например, так (внутри контейнера):</p>
<pre><code class="lang-auto">cd /root/easy-rsa-ipsec/easyrsa3
./easyrsa build-client-full "client2" nopass nodatetime
</code></pre>
<p>Файлы будут расположены в <code>./pki/issued/client2.crt</code> и <code>./pki/private/client2.key</code>. Конфигурационный файл OpenVPN необходимо будет создать вручную (замените сертификат &lt;cert&gt; и ключ &lt;key&gt; в существующем).</p>
<aside class="quote no-group" data-username="tez" data-post="197" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/t/df788c/48.png" class="avatar"> tez:</div>
<blockquote>
<p>куда можно прописать определенный сервер, что бы при подключении к нему трафик шел через VPN?</p>
</blockquote>
</aside>
<p>Не понял вопроса. Если речь о добавлении доменов (не из списка Реестра), которые должны маршрутизироваться через VPN, то вот здесь описано, как это сделать: <a href="https://ntc.party/t/vpn/129/127" class="inline-onebox">Контейнер VPN АнтиЗапрета для установки на собственный сервер - #127 by ValdikSS</a></p>
<aside class="quote no-group quote-modified" data-username="Alexled" data-post="198" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/a/e95f7d/48.png" class="avatar"> Alexled:</div>
<blockquote>
<p>ВКонтакте трафик идет через Antizapret […] Можете подсказать где искать проблему?</p>
</blockquote>
</aside>
<p>Фото профилей могут грузиться не из-за маршрутизации трафика через VPN, а из-за геораспределения IP-адресов на домене: VPN-серверу выдаются адреса, условно, той страны, где расположен сервер, а не Российские IP.<br>
Можно начать отладку с tcpdump, как описано в этом посте выше. Смотрите, на какие домены идёт ответ с адресами 10.224.x.x — адреса из этого диапазона маршрутизируются в VPN.</p></td><td>2022-04-06T22:00:09.979Z</td></tr><tr><td>tez</td><td><aside class="quote no-group" data-username="ValdikSS" data-post="199" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/valdikss/48/2_2.png" class="avatar"> ValdikSS:</div>
<blockquote>
<p>Не понял вопроса</p>
</blockquote>
</aside>
<p>У меня на компьютере под win настроен майнинг через пул <a href="http://ethermine.org" rel="noopener nofollow ugc">ethermine.org</a>, который заблокировал русских пользователей. Он использует сервер <a href="http://eu1.ethermine.org" rel="noopener nofollow ugc">eu1.ethermine.org</a> через порт 4444.<br>
Прописать в host - эффекта нет. Приходиться гнать весь трафик через vpn.<br>
Подскажите как добавить сервер в существующую конфигурацию?</p></td><td>2022-04-06T22:45:41.389Z</td></tr><tr><td>ValdikSS</td><td><p>Если по какой-то причине не работает с доменом, добавьте маршрут: <a href="https://ntc.party/t/vpn/129/81" class="inline-onebox">Контейнер VPN АнтиЗапрета для установки на собственный сервер - #81 by ValdikSS</a></p></td><td>2022-04-06T23:47:29.121Z</td></tr><tr><td>Resquer(Resquer)</td><td><p>Есть проблема.<br>
Не могу скачать lxd контейнер, ругается на версию tls.</p>
<p>root@am:~# lxc image import <a href="https://antizapret.prostovpn.org/container-images/az-vpn" rel="noopener nofollow ugc">https://antizapret.prostovpn.org/container-images/az-vpn</a> --alias antizapret-vpn-img<br>
Error: Head “<a href="https://antizapret.prostovpn.org/container-images/az-vpn" rel="noopener nofollow ugc">https://antizapret.prostovpn.org/container-images/az-vpn</a>”: remote error: tls: protocol version not supported</p>
<p>сам lxd - свежий, поставлен через snap:<br>
root@am:~# lxc version<br>
Client version: 5.0.0<br>
Server version: 5.0.0<br>
root@am:~# snap list lxd<br>
Name  Version        Rev    Tracking       Publisher   Notes<br>
lxd   5.0.0-c5bcb80  22826  latest/stable  canonical✓  -</p>
<p>система - Debian 11:<br>
root@am:~# uname -a<br>
Linux am 5.10.0-13-amd64 <span class="hashtag">#1</span> SMP Debian 5.10.106-1 (2022-03-17) x86_64 GNU/Linux</p></td><td>2022-04-07T10:39:08.257Z</td></tr><tr><td>Resquer(Resquer)</td><td><p>Помогло вот что:<br>
systemctl edit snap.lxd.daemon<br>
Затем сразу ПОД строчками</p>
<pre><code class="lang-auto">### Editing /etc/systemd/system/snap.lxd.daemon.service.d/override.conf
### Anything between here and the comment below will become the new contents of the file
</code></pre>
<p>добавляем это:</p>
<pre><code class="lang-auto">[Service]
Environment=LXD_INSECURE_TLS=true
</code></pre>
<p>(если добавить в конец файла, то изменения не сохранятся)<br>
выполняем systemctl reload snap.lxd.daemon<br>
и проблема уходит</p></td><td>2022-04-07T10:58:28.143Z</td></tr><tr><td>ValdikSS</td><td><p>Может, у вас какие-то устаревшие сертификаты, или еще что-то? На сервере сертификат актуальный, работает в любых браузерах. Вы обновляли систему (<code>apt update &amp;&amp; apt upgrade</code>?)</p></td><td>2022-04-07T11:06:18.312Z</td></tr><tr><td>Resquer(Resquer)</td><td><p>Разумеется, первым делом.</p></td><td>2022-04-07T11:49:38.152Z</td></tr><tr><td>Resquer(Resquer)</td><td><p>Может кому будет полезна идея…<br>
У меня такая ситуация - есть зарубежный vps, откуда есть доступ к заблокированным ресурсам.<br>
Но.<br>
Там мало оперативки, плюс уже крутятся некоторые сервисы, которые её тоже кушают.<br>
То есть ставить дополнительно контейнер, который будет отъёдать ОЗУ - нецелесообразно.</p>
<p>На зарубежном vps уже поднят wireguard сервер.<br>
В общем, не буду ходить вокруг да около - я запустил контейнер на своём сервере, у меня достаточно ресурсов. Затем зашёл в контейнер, установил там wireguard, в конфиге wireguard прописал подключение к своему удалённому vps, указав там в параметрах пира AllowedIPs = 0.0.0.0/0</p>
<p>Таким образом, контейнер ВСЕГДА выходит в интернет через туннель wireguard, любой трафик от него идёт через него, ничего не блокируется. Сам сервер, на котором работает контейнер, об этом ничего не знает, его задача лишь запустить контейнер. И соответственно, значительно снижаются требования к зарубежному vps, от него нужно лишь обеспечить работоспособность wireguard, с чем справится даже самый дохлый комп.<br>
А контейнер с антизапретом можно запускать хоть на домашнем компьютере, главное требование - наличие белого IP адреса, если есть нужда подключаться к нему не только из дома.</p></td><td>2022-04-07T12:30:00.245Z</td></tr><tr><td>mafiacheb(Александр)</td><td><p>у кого нибудь контейнер работает с pi hole на одном впс? никак не получается заставить их совместно работать<br>
по отдельности нормально устанавливаются и работают<br>
но если установлен уже контейнер и при попытке установить pi hole днс не работает(DNS service is NOT running)<br>
если Pi hole установлен, то не получается поставить контейнер, после выполнения команды lxc file pull antizapret-vpn/root/easy-rsa-ipsec/CLIENT_KEY/antizapret-client-tcp.ovpn antizapret-client-tcp.ovpn выходит ошибка error</p></td><td>2022-04-07T13:08:48.672Z</td></tr><tr><td>Resquer(Resquer)</td><td><p><a class="mention" href="/u/valdikss">@ValdikSS</a><br>
knot resolver какие upstream dns использует? Берёт из resolf.conf?<br>
Там прописаны 8.8.8.8 и 9.9.9.9</p>
<p>Хочу добавить upstream серверы в исключения маршрутизации wireguard, чтобы запросы к ним шли не через туннель. Для того, чтобы если вдруг удалённая vps упадёт, чтобы хотя-бы незаблокированные ресурсы работали. Для этого надо знать, какие dns используются kresd для резолвинга.</p></td><td>2022-04-08T05:16:26.746Z</td></tr><tr><td>Resquer(Resquer)</td><td><p>Пофигу)</p>
<p>решил жёстко указать, чтобы не было сюрпризов.<br>
В конфиг kresd.conf дописал:</p>
<pre><code class="lang-auto">policy.add(
   policy.all(
      policy.TLS_FORWARD({{'1.1.1.1@853', hostname='cloudflare-dns.com'}}),
      policy.TLS_FORWARD({{'8.8.8.8@853', hostname='dns.google'}}),
      policy.TLS_FORWARD({{'1.0.0.1@853', hostname='cloudflare-dns.com'}}),
      policy.TLS_FORWARD({{'8.8.4.4@853', hostname='dns.google'}})
   )
)
</code></pre>
<p>И в конфиге wireguard эти адреса исключил. Всё работает, как надо</p>
<p>И да, тут часто спрашивали, как сделать реализацию работы антизапрета для работы через wireguard. Да, это возможно, я у себя сделал, работает без проблем. Для мобильных и слабых устройств wireguard более предпочтителен, т.к. не кушает батарею - он просто не поддерживает коннект, сколько пакетов отправил - столько батареи на это и скушал.<br>
Но тут и минус большой - в конфиге wg жёстко прописывается DNS сервер (который за туннелем wg) - и если какие-то проблемы с удалённым сервером, либо интернет каналом между клиентом и сервером - то вообще никак интернет работать на этом устройстве не будет, т.к. wireguard не предполагает проверки канала (как openvpn - если сервер недоступен, то соединение просто разорвётся и переназначенный удалённый dns просто сбросится). С wg ситуация будет такая - сервер недоступен - значит и dns недоступен.<br>
Для тех, кому всё-же вариант работы через wg интересен, алгоритм такой:</p>
<ol>
<li>на том сепвере, на котором запускаем контейнер (но не в самом контейнере) назначаем доп IP адрес на сетевой карте, статика, адрес брать из диапазона, который не используется в инфраструктуре (далее буду писать на своём примере, у меня дебиан 11), в моём случае в файле /etc/network/interfaces:</li>
</ol>
<pre><code class="lang-auto">#Additional IP
auto ens192:0
iface ens192:0 inet static
address 172.31.31.1
netmask 255.255.255.0
</code></pre>
<ol start="2">
<li>на этом же сервере изменяем dns сервер по умолчанию, в файле /etc/resolf.conf прописываем:</li>
</ol>
<pre><code class="lang-auto">nameserver 172.31.31.1
</code></pre>
<ol start="3">
<li>Делаем маппинг портов сервера dns вовнутрь контейнера:</li>
</ol>
<pre><code class="lang-auto">lxc config device add antizapret-vpn proxy_53_udp proxy listen=udp:172.31.31.1:53 connect=udp:127.0.0.1:53
lxc config device add antizapret-vpn proxy_53_tcp proxy listen=tcp:172.31.31.1:53 connect=tcp:127.0.0.1:53
</code></pre>
<ol start="4">
<li>берём клиентский конфиг openvpn (я взял udp вариант), изменяем там адрес сервера на локалхост, также изменяю имя устройства на tun1 (у меня tun0 на том сервере уже использовалось для других целей) у меня получилось так (показываю лишь фрагмент, без раздела с ключами):</li>
</ol>
<pre><code class="lang-auto">nobind
client

remote 127.0.0.1

remote-cert-tls server

dev tun1
proto udp

resolv-retry infinite
persist-key
persist-tun

setenv FRIENDLY_NAME "AntiZapret VPN UDP"
comp-lzo
status /var/log/openvpn/myvpn-status.log
log         /var/log/openvpn/myvpn-server.log
log-append  /var/log/openvpn/myvpn-server.log

# Keys
</code></pre>
<p>создаём systemd сервис с этим конфигом, ставим в автозагрузку<br>
Перезагружаем.</p>
<p>Этими действиями мы сделали следующее - сам сервер, на котором запущен контейнер - теперь выходит в интернет используя DNS, работающий в этом контейнере.<br>
Доп. IP адрес, который создавали - на нём теперь висит DNS сервер, работающий внутри контейнера. Адес этот нужен для того, чтобы его в дальнейшем указать в качестве DNS в клиентских конфигурациях wireguard.<br>
Ну и wg конфиг сервера (это мой, нужно править под себя):</p>
<pre><code class="lang-auto">[Interface]
Address = 172.30.30.253/24
ListenPort = 443
PrivateKey = 2HzqsLYMf8RMbrhqLVkoMJghjkhBVlyB1+jfsFefO3k=
PostUp = iptables -A FORWARD -i wg1 -j ACCEPT; iptables -t nat -A POSTROUTING -o ens192 -j MASQUERADE; iptables -t nat -A POSTROUTING -o wg1 -j MASQUERADE; iptables -t nat -A POSTROUTING -o tun1 -j MASQUERADE
PostDown = iptables -D FORWARD -i wg1 -j ACCEPT; iptables -t nat -D POSTROUTING -o ens192 -j MASQUERADE; iptables -t nat -D POSTROUTING -o wg1 -j MASQUERADE; iptables -t nat -D POSTROUTING -o tun1 -j MASQUERADE

# client peer config 1
[Peer]
PublicKey = Ad0kcRSdsRjhf7pk7czy87X2o3sFfEpiTmDorZ7PFq0=
AllowedIPs = 172.30.30.251/32
</code></pre>
<p>Конфиг клиента:</p>
<pre><code class="lang-auto">[Interface]
PrivateKey = 3Onw2+iGnbUEoI2HbNys+NkN5d666clZWSw3x1olxHY=
Address = 172.30.30.251/32
DNS = 172.31.31.1

[Peer]
PublicKey = 2aAOFShy1ZjiI02gpAENIh2uvkTT7zZy7zw8xvSEdw3=
AllowedIPs = 10.224.0.0/15, 68.171.224.0/19, 74.82.64.0/19, 103.246.200.0/22, 178.239.88.0/21, 185.104.45.0/24, 193.105.213.36/30, 203.104.128.0/20, 203.104.144.0/21, 203.104.152.0/22, 172.31.31.1/32
Endpoint = vps.servername.zyx:443
</code></pre>
<p>В итоге - всё работает, незаблокированные адреса открываются напрямую, заблокированные резолвятся в фейковые адреса из подсети 10.224.0.0/15 и идут через туннель.<br>
В AllowedIPs  клиента включена подменная подсеть 10.224.0.0/15, адрес DNS 172.31.31.1/32 и остальные подсети, которые выводились в таблице маршрутизации на vps сервере при поднятом туннеле антизапрета. Предназначение их я не знаю, включил в конфиг wireguard просто так как они присутствуют в таблице маршрутизации при включенном туннеле openvpn.</p>
<p>Схема рабочая, но не для всех - для каждого клиента нужно создавать отдельный конфиг руками. Если сервер свой, делается для себя и устройств немного - то такой вариант имеет право на жизнь.</p>
<p>P.S.<br>
п. 2 можно не делать, если сервер vps за бугром. Просто у меня он в РФ  и мне даже для самого сервера надо обходить блокировки. Сам контейнер - на нём тоже поставил wireguard и весь трафик контейнера завернул за бугор, через ещё один vps</p></td><td>2022-04-08T11:50:41.462Z</td></tr><tr><td>ValdikSS</td><td><aside class="quote no-group" data-username="Resquer" data-post="208" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/resquer/48/1207_2.png" class="avatar"> Resquer:</div>
<blockquote>
<p>knot resolver какие upstream dns использует?</p>
</blockquote>
</aside>
<p>Никакие, это рекурсивный резолвер.</p></td><td>2022-04-08T15:32:49.413Z</td></tr><tr><td>wolfxr</td><td><p>Удалено</p></td><td>2022-04-09T07:29:51.832Z</td></tr><tr><td>Alexled(alex)</td><td><p>Добрый день. Очень странный вопрос, но может кому-то тоже пригодится.</p>
<p>Ситуация следующая: развернул свой VPN Антизапрет, раздал друзьям профиль, а те раздали своим друзьям. Сейчас появилась необходимость сменить сервер (не хватает памяти), а полного списка пользователей нет даже у меня.</p>
<p>Возможно ли их как-то уведомить, что профиль нужно будет перекачать? Видел, что бесплатные VPN например встраивают свои баннеры на сайты, может у кого-то есть такой же кейс?</p></td><td>2022-04-12T11:00:20.438Z</td></tr><tr><td>ValdikSS</td><td><p>Если IP-адрес сервера не сменится, то ничего, кроме экспорта работающего контейнера и последующего его импорта в новую виртуальную машину, делать не нужно. Конфигурационные файлы продолжат работу.</p></td><td>2022-04-13T01:00:12.660Z</td></tr><tr><td>vovansick</td><td><p>А можно ли как-то посмотреть подключенных клиентов к серверу? Пока только через jorunalctl вижу подключения, но там не разберешь какой это клиент, если ip и версия клиента одинаковы. Точнее хотябы чтобы hostname можно было увидеть</p></td><td>2022-04-24T15:09:22.826Z</td></tr><tr><td>ValdikSS</td><td><p>Если вы настраивали контейнер с помощью LXD, то нельзя — настройка осуществляется с помощью прокси, который не сохраняет IP-адрес клиента.<br>
Можете перенастроить с помощью маршрутизации (<code>proxy nat=true</code>), но в LXD это сделано не очень удобно, требует статического назначения IP-адреса контейнера. См. <a href="https://linuxcontainers.org/lxd/docs/master/instances/#type-proxy" class="inline-onebox">Instance configuration - LXD documentation</a></p>
<p>Что-то вроде:</p>
<pre><code class="lang-auto">lxc config device set antizapret-vpn eth0 ipv4.address='10.22.33.1'
lxc config device add antizapret-vpn proxy_1194 proxy listen=tcp:ВНЕШНИЙ_IP:1194 connect=tcp:10.22.33.1:1194 nat=true
</code></pre></td><td>2022-04-24T19:03:37.618Z</td></tr><tr><td>Human</td><td><p>Есть для windows вариант? Unix ни на одном компе нет. А виртуалку запускать не охота из-за ограниченых ресурсов машин</p></td><td>2022-05-08T16:21:05.516Z</td></tr><tr><td>ValdikSS</td><td></td><td>2022-05-09T13:52:48.905Z</td></tr><tr><td>TbiHDbiP</td><td><p>Хотел запустить такой сервер в домашней сети, но по описанию понял, что на все домашние устройства необходимо будет установить VPN-клиент. Можно ли сделать так, чтобы сервер являлся для устройств ну как бы просто шлюзом, без необходимости установления VPN?</p></td><td>2022-05-15T20:21:35.221Z</td></tr><tr><td>ValdikSS</td><td><p>Сервер необходимо устанавливать на канале без блокировок. Если в вашей домашней сети нет блокировок, то и контейнер АнтиЗапрета вам не нужен.</p></td><td>2022-05-16T17:39:03.590Z</td></tr><tr><td>ArchimedRT(Ruslan Arkhipov)</td><td><p>Каждый поддомен нужно отдельно добавлять, так и должно быть?<br>
Напр, Twitter не работал, пока не указал:<br>
<a href="http://twimg.com" class="onebox" target="_blank" rel="noopener nofollow ugc">twimg.com</a><br>
<a href="http://abs.twimg.com" class="onebox" target="_blank" rel="noopener nofollow ugc">abs.twimg.com</a></p></td><td>2022-05-17T19:31:15.395Z</td></tr><tr><td>ArchimedRT(Ruslan Arkhipov)</td><td><p>Не знает ли кто, какие домены или ip используются в приложении Strava? (блокировка России со стороны сервиса)<br>
Сам домен <a href="http://strava.com" rel="noopener nofollow ugc">strava.com</a> я добавил include-hosts-custom.txt - через браузер сайт открывается, а вот приложение работать не хочет.</p>
<p>P.S.: Насколько вижу/понимаю, Strava шлет запросы на dns-сервер 8.8.8.8 и получает оттуда резолв своих доменов в обход VPN. Возможно ли это как-то побороть?</p></td><td>2022-05-17T19:34:11.749Z</td></tr><tr><td>ValdikSS</td><td><aside class="quote no-group" data-username="ArchimedRT" data-post="222" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/archimedrt/48/1356_2.png" class="avatar"> ArchimedRT:</div>
<blockquote>
<p>Каждый поддомен нужно отдельно добавлять, так и должно быть?</p>
</blockquote>
</aside>
<p>Нет, нужно добавлять зону, без поддоменов.</p>
<aside class="quote no-group" data-username="ArchimedRT" data-post="223" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/archimedrt/48/1356_2.png" class="avatar"> ArchimedRT:</div>
<blockquote>
<p>Насколько вижу/понимаю, Strava шлет запросы на dns-сервер 8.8.8.8 и получает оттуда резолв своих доменов в обход VPN. Возможно ли это как-то побороть?</p>
</blockquote>
</aside>
<p>Да, добавьте маршрут до 8.8.8.8 через VPN.</p></td><td>2022-05-19T13:55:17.076Z</td></tr><tr><td>zzr</td><td><p>это скорее как днс-сервер выступает, а не как шлюз, если на маршрутизаторе есть понтдержка опенвпн, например на <a href="https://ntc.party/t/mikrotik/666">микротике</a>, то достаточно чтобы клиенты в домашней сети получали по дхцп айпишник днс сервера роутера и сё, не надо на каждом клиенте устанавливать опенвпн</p></td><td>2022-05-27T07:50:59.956Z</td></tr><tr><td>Csalretepman(Ilnur)</td><td><p>Здравствуйте, с сегоднящнего дня netflix начал блокировать пользователей с российским айпи, прописал домены<br>
<strong><a href="http://netflix.com" rel="noopener nofollow ugc">netflix.com</a></strong><br>
<strong><a href="http://nflxext.com" rel="noopener nofollow ugc">nflxext.com</a></strong><br>
<strong><a href="http://assets.nflxext.com" rel="noopener nofollow ugc">assets.nflxext.com</a></strong><br>
<strong><a href="http://codex.nflxext.com" rel="noopener nofollow ugc">codex.nflxext.com</a></strong><br>
в <em>include-hosts-custom.txt</em>, но это не помогло. Может кто-нить знает, как обойти?</p></td><td>2022-05-27T08:53:11.388Z</td></tr><tr><td>kirill</td><td><p>а вы уверены, что<br>
<code>netflix.com</code><br>
и<br>
<code>nflxext.com</code><br>
это все необходимые домены?</p></td><td>2022-05-27T18:27:43.119Z</td></tr><tr><td>tkmw1985(VALLY-VULLY)</td><td><p>Здравствуйте.  Как и от куда  удалить не нужный хлам виде azino, casino, joycasino и.т.п ?</p></td><td>2022-05-27T17:47:47.551Z</td></tr><tr><td>tkmw1985(VALLY-VULLY)</td><td><pre><code class="lang-auto">flxvpn.net
netflix.ca
netflix.com
netflix.com.au
netflixdnstest10.com
netflixdnstest1.com
netflixdnstest2.com
netflixdnstest3.com
netflixdnstest4.com
netflixdnstest5.com
netflixdnstest6.com
netflixdnstest7.com
netflixdnstest8.com
netflixdnstest9.com
netflixinvestor.com
netflix.net
netflixstudios.com
netflixtechblog.com
nflxext.com
nflximg.com
nflximg.net
nflxso.net
nflxvideo.net
btstatic.com
</code></pre>
<p>Может эти помогут</p></td><td>2022-05-28T07:35:10.605Z</td></tr><tr><td>ValdikSS</td><td><aside class="quote no-group" data-username="tkmw1985" data-post="232" data-topic="129" data-full="true">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/tkmw1985/48/2312_2.png" class="avatar"> tkmw1985:</div>
<blockquote>
<p>Здравствуйте. Как и от куда удалить не нужный хлам виде azino, casino, joycasino и.т.п ?</p>
</blockquote>
</aside>
<p>Эти домены содержатся в Реестре. Часть мусорных/неработающих зеркал вычищается скриптом <code>/root/antizapret/config/exclude-regexp-dist.awk</code>.</p></td><td>2022-05-30T20:16:18.760Z</td></tr><tr><td>rubberducky</td><td><p>Всем привет, огромная благодарность автору(ам), у меня арендованный впс, подключен на впн с помощью роутера с прошивкой падаван, все отлично работает, но когда далеко уезжаю на телефоне тоже использую “свой” впн из другой сети, и хочется из телефона получать доступ к роутеру с падаваном, как это можно реализовать? Почему то от телефона до роутера и наоборот пинги не идут.</p></td><td>2022-05-31T04:40:12.369Z</td></tr><tr><td>ValdikSS</td><td><p>Связь между клиентами VPN заблокирована средствами межсетевого экрана.<br>
В файле <code>/etc/ferm/ferm.conf</code> измените строку:<br>
<code>interface vpn+ outerface $EXT_INTERFACE ACCEPT;</code><br>
на<br>
<code>interface vpn+ outerface ($EXT_INTERFACE vpn+) ACCEPT;</code><br>
И перезапустите контейнер.</p></td><td>2022-06-01T09:33:01.477Z</td></tr><tr><td>not4u(Mikhail Gradusov)</td><td><p>Добрый день. Разрабочики Canva ограничили доступ к своему ресурсу для пользователей из РФ. Вопрос - как добавить в правило что б это работало? добавил в файл custom hosts <a href="http://canva.com" rel="noopener nofollow ugc">canva.com</a> но все еще не работает.</p>
<p>Вопрос второй. Как создать файл конфигурации для vpn что бы весь трафик шел через VPN? Находил это но теперь не могу. Спасибо</p></td><td>2022-06-01T09:45:36.136Z</td></tr><tr><td>Csalretepman(Ilnur)</td><td><p>Я добавил канву также, все работает.<br>
А вы не забыли это:</p>
<pre><code class="lang-auto">lxc shell antizapret-vpn
sh -c "LANG=C.UTF-8 /root/antizapret/doall.sh"
</code></pre>
<p>По второму вопросу, рекомендую воспользоваться скриптом <strong>pivpn</strong></p>
<pre><code class="lang-auto">curl -L https://install.pivpn.io | bash
</code></pre></td><td>2022-06-01T10:23:09.075Z</td></tr><tr><td>not4u(Mikhail Gradusov)</td><td><p>даже перезагружал сервер. Спустя сутки все заработало.</p>
<p>Спасибо!</p></td><td>2022-06-03T13:03:59.114Z</td></tr><tr><td>kidu(kir)</td><td><p><div class="lightbox-wrapper"><a class="lightbox" href="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/43d0a62c2b079d26eabaa1c76974347111040219.jpeg" data-download-href="https://ntc.party/uploads/default/43d0a62c2b079d26eabaa1c76974347111040219" title="Снимок экрана 2022-06-04 в 05.36.23"><img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/43d0a62c2b079d26eabaa1c76974347111040219_2_690x466.jpeg" alt="Снимок экрана 2022-06-04 в 05.36.23" data-base62-sha1="9FV1bJ3EpzwlP4lwC7T9CjN2w41" width="690" height="466" srcset="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/43d0a62c2b079d26eabaa1c76974347111040219_2_690x466.jpeg, контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/43d0a62c2b079d26eabaa1c76974347111040219_2_1035x699.jpeg 1.5x, контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/43d0a62c2b079d26eabaa1c76974347111040219_2_1380x932.jpeg 2x" data-dominant-color="131313"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">Снимок экрана 2022-06-04 в 05.36.23</span><span class="informations">1778×1202 271 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div><br>
<div class="lightbox-wrapper"><a class="lightbox" href="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/598950c3a806079f7de981d55e37e8859c17c82a.jpeg" data-download-href="https://ntc.party/uploads/default/598950c3a806079f7de981d55e37e8859c17c82a" title="Снимок экрана 2022-06-04 в 05.35.56"><img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/598950c3a806079f7de981d55e37e8859c17c82a_2_690x476.jpeg" alt="Снимок экрана 2022-06-04 в 05.35.56" data-base62-sha1="cM4GTORu1dZK5i2NjrwcnHosvUu" width="690" height="476" srcset="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/598950c3a806079f7de981d55e37e8859c17c82a_2_690x476.jpeg, контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/598950c3a806079f7de981d55e37e8859c17c82a_2_1035x714.jpeg 1.5x, контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/598950c3a806079f7de981d55e37e8859c17c82a_2_1380x952.jpeg 2x" data-dominant-color="131212"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">Снимок экрана 2022-06-04 в 05.35.56</span><span class="informations">1840×1270 288 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div><br>
Не могу установить на <strong>Vultr</strong> с помощью boot скрипта! да и через LXD та же ошибка!<br>
что я делаю не так?</p></td><td>2022-06-04T02:53:28.540Z</td></tr><tr><td>ValdikSS</td><td><aside class="quote quote-modified" data-post="76" data-topic="129">
  <div class="title">
    <div class="quote-controls"></div>
    <img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/m/ce7236/48.png" class="avatar">
    <a href="https://ntc.party/t/vpn/129/76">Контейнер VPN АнтиЗапрета для установки на собственный сервер</a> <a class="badge-category__wrapper " href="/c/antizapret-prostovpn-org/az-self-hosted/38"><span data-category-id="38" style="--category-badge-color: #0088CC; --category-badge-text-color: #FFFFFF; --parent-category-badge-color: #8C6238;" data-parent-category-id="5" data-drop-close="true" class="badge-category --has-parent" title="Вопросы и особенности работы контейнера VPN АнтиЗапрета на своих серверах"><span class="badge-category__name">АнтиЗапрет на собственном сервере (self-hosted)</span></span></a>
  </div>
  <blockquote>
    Возможно поможет вам, а также другим, у кого проблемы с наличием интернета внутри контейнера. Также потратил какое-то время, пока не нашел решение. 
Проблема заключается в использовании ufw в качестве фаервола в Ubuntu. Подробно описано здесь: 

Читал по диагонали, но похоже, что ufw по-умолчанию не пробрасывает порты внутрь контейнера. 
У меня такое было актуально на Ubuntu 20.04 
Самое простое решение - прописать правила для сетевого интерфейса контейнера - lxdbr0: 
sudo ufw allow in on lxdbr0…
  </blockquote>
</aside>
</td><td>2022-06-04T05:40:45.805Z</td></tr><tr><td>413xk</td><td><p>Подскажите пожалуйста:</p>
<ol>
<li>Контрейнер крутится на виртуалке зарубежом.</li>
<li>На клиентах (Keenetic и маршрутизатор на линуксе с openvpn) прописаны днсы 1.0.0.1 и 8.8.8.8, завернуты на контейнер.<br>
Все заблокированные сайты работают.<br>
Но так же не работают и некоторые российские сайты.<br>
Например, клиент за кинетиком не может отрезолвить некоторые домены (тупо не определяет айпишник).<br>
При этом далеко не у всех сайтов.<br>
Если пинговать проблемный узел с самого контейнера - то всё четко (в /etc/reoslv.conf указаны 8.8.8.8 и 9.9.9.9, нужно ли в моем случае менять девятки на 1.0.0.1?)</li>
</ol>
<p>Как лечить? Где бы логи посмотреть?</p>
<p>То есть итого:<br>
контейнер резолвит ок, клиенты не резолвят.</p>
<p>В моменте <em>policy.add(policy.all(policy.FORWARD({‘77.88.8.8’})))</em> + doall.sh помогло, но такое… У меня же с моей впс домен резолвится, а не резолвится с клиента, то есть имхо не так надо чинить…</p>
<p>UP: нашел <a href="https://ntc.party/t/autodoc-ru-antizapret-vpn/2070">тему с автодоком</a>, чего делать пока не ясно.</p>
<p>Что правильнее, делать policy.FORWARD или же одним из серверов (например 1.0.0.1 в моем случае) заменить на 77.88.8.8?</p></td><td>2022-06-04T08:17:40.293Z</td></tr><tr><td>kidu(kir)</td><td><p>спасибо! всё установилось!</p>
<p>канву добавилась так:<br>
lxc shell antizapret-vpn<br>
echo “<a href="http://canva.com" rel="noopener nofollow ugc">canva.com</a>” &gt;&gt; /root/antizapret/config/include-hosts-custom.txt<br>
LANG=C.UTF-8 /root/antizapret/doall.sh</p></td><td>2022-06-04T11:09:34.005Z</td></tr><tr><td>ValdikSS</td><td><aside class="quote no-group" data-username="413xk" data-post="242" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/4/ee59a6/48.png" class="avatar"> 413xk:</div>
<blockquote>
<p>Как лечить? Где бы логи посмотреть?</p>
</blockquote>
</aside>
<p>Knot-resolver, установленный в контейнер, самостоятельно рекурсивно резолвит домены от своего IP-адреса. Вероятно, на части российских доменов NS-серверы блокируют нероссийские и непопулярные резолверы, поэтому сервер не может к ним достучаться.</p>
<aside class="quote no-group" data-username="413xk" data-post="242" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/4/ee59a6/48.png" class="avatar"> 413xk:</div>
<blockquote>
<p>контейнер резолвит ок, клиенты не резолвят.</p>
</blockquote>
</aside>
<aside class="quote no-group" data-username="413xk" data-post="242" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/4/ee59a6/48.png" class="avatar"> 413xk:</div>
<blockquote>
<p>в /etc/reoslv.conf указаны 8.8.8.8 и 9.9.9.9</p>
</blockquote>
</aside>
<p>С сервера вы резолвите через публичные резолверы, а с VPN-подключения — напрямую с сервера, через knot-resolver.<br>
Либо установите в resolv.conf 127.0.0.1, либо запускайте dig, например, так:<br>
<code>dig something.ru @127.0.0.1</code></p></td><td>2022-06-07T05:52:29.373Z</td></tr><tr><td>413xk</td><td><p>Спасибо!</p>
<p>Но, в связи с тем, что гугл толи шейпят, толи блочат, вообще считаю, что нужно начинать городить другую схему. Допустим:</p>
<ol>
<li>дефолтный сервер за рубежом.</li>
<li>дополнительно поднимаем сервер в РФ, прикручиваем тоннели между серверами.</li>
<li>Сервер за рубежом - дефолтный впн сервер для всего мира.</li>
<li>Трафик с сервера №1 в Россию заворачиваем через тоннель и сервер из пункта 2.</li>
</ol>
<p>В результате у нас “весь мир” и “вся РФ” идет с региональных IP, и всё работает.</p></td><td>2022-06-07T06:04:55.594Z</td></tr><tr><td>tkmw1985(VALLY-VULLY)</td><td><p>На собственном сервере где установлен контейнер Антизапрета  выходят ошибки.<br>
Как можно исправить ошибку и с чем это связана ?</p>
<details>
<summary>
Спойлер</summary>
<p>Jun 12 08:48:47 antizapret-vpn systemd-sysctl[45]: Couldn’t write ‘102400’ to ‘net/netfilter/nf_conntrack_max’, ignoring: No such file or directory<br>
Jun 12 08:48:47 antizapret-vpn systemd-sysctl[45]: Couldn’t write ‘600’ to ‘net/netfilter/nf_conntrack_generic_timeout’, ignoring: No such file or directory<br>
Jun 12 08:48:47 antizapret-vpn systemd-sysctl[45]: Couldn’t write ‘30’ to ‘net/netfilter/nf_conntrack_icmp_timeout’, ignoring: No such file or directory<br>
Jun 12 08:48:47 antizapret-vpn systemd-sysctl[45]: Couldn’t write ‘10’ to ‘net/netfilter/nf_conntrack_tcp_timeout_close’, ignoring: No such file or directory<br>
Jun 12 08:48:47 antizapret-vpn systemd-sysctl[45]: Couldn’t write ‘60’ to ‘net/netfilter/nf_conntrack_tcp_timeout_close_wait’, ignoring: No such file or directory<br>
Jun 12 08:48:47 antizapret-vpn systemd-sysctl[45]: Couldn’t write ‘1800’ to ‘net/netfilter/nf_conntrack_tcp_timeout_established’, ignoring: No such file or directory<br>
Jun 12 08:48:47 antizapret-vpn systemd-sysctl[45]: Couldn’t write ‘120’ to ‘net/netfilter/nf_conntrack_tcp_timeout_fin_wait’, ignoring: No such file or directory<br>
Jun 12 08:48:47 antizapret-vpn systemd-sysctl[45]: Couldn’t write ‘30’ to ‘net/netfilter/nf_conntrack_tcp_timeout_last_ack’, ignoring: No such file or directory<br>
Jun 12 08:48:47 antizapret-vpn systemd-sysctl[45]: Couldn’t write ‘300’ to ‘net/netfilter/nf_conntrack_tcp_timeout_max_retrans’, ignoring: No such file or directory<br>
Jun 12 08:48:47 antizapret-vpn systemd-sysctl[45]: Couldn’t write ‘60’ to ‘net/netfilter/nf_conntrack_tcp_timeout_syn_recv’, ignoring: No such file or directory<br>
Jun 12 08:48:47 antizapret-vpn systemd-sysctl[45]: Couldn’t write ‘120’ to ‘net/netfilter/nf_conntrack_tcp_timeout_syn_sent’, ignoring: No such file or directory<br>
Jun 12 08:48:47 antizapret-vpn systemd-sysctl[45]: Couldn’t write ‘120’ to ‘net/netfilter/nf_conntrack_tcp_timeout_time_wait’, ignoring: No such file or directory<br>
Jun 12 08:48:47 antizapret-vpn systemd[1]: Starting Flush Journal to Persistent Storage…<br>
Jun 12 08:48:47 antizapret-vpn systemd-sysctl[45]: Couldn’t write ‘300’ to ‘net/netfilter/nf_conntrack_tcp_timeout_unacknowledged’, ignoring: No such file or directory<br>
Jun 12 08:48:47 antizapret-vpn systemd-sysctl[45]: Couldn’t write ‘120’ to ‘net/netfilter/nf_conntrack_udp_timeout’, ignoring: No such file or directory<br>
Jun 12 08:48:47 antizapret-vpn systemd-sysctl[45]: Couldn’t write ‘180’ to ‘net/netfilter/nf_conntrack_udp_timeout_stream’, ignoring: No such file or directory<br>
Jun 12 08:48:47 antizapret-vpn systemd-sysctl[45]: Couldn’t write ‘4194304’ to ‘net/core/rmem_max’, ignoring: No such file or directory<br>
Jun 12 08:48:47 antizapret-vpn systemd-sysctl[45]: Couldn’t write ‘262143’ to ‘net/core/rmem_default’, ignoring: No such file or directory<br>
Jun 12 08:48:47 antizapret-vpn systemd-sysctl[45]: Couldn’t write ‘4194304’ to ‘net/core/wmem_max’, ignoring: No such file or directory<br>
Jun 12 08:48:47 antizapret-vpn systemd-sysctl[45]: Couldn’t write ‘262143’ to ‘net/core/wmem_default’, ignoring: No such file or directory<br>
Jun 12 08:48:47 antizapret-vpn systemd-sysctl[45]: Couldn’t write ‘bbr’ to ‘net/ipv4/tcp_congestion_control’, ignoring: No such file or directory<br>
Jun 12 08:48:47 antizapret-vpn systemd-sysctl[45]: Couldn’t write ‘1’ to ‘fs/protected_hardlinks’, ignoring: Permission denied<br>
Jun 12 08:48:47 antizapret-vpn systemd-sysctl[45]: Couldn’t write ‘1’ to ‘fs/protected_symlinks’, ignoring: Permission denied<br>
Jun 12 08:48:47 antizapret-vpn systemd[1]: Started Apply Kernel Variables.<br>
Jun 12 08:48:47 antizapret-vpn systemd-journald[40]: Runtime journal (/run/log/journal/e2f53169f9c0449a88142dfbe8fa0885) is 1.0M, max 8.0M, 7.0M free.</p>
</details></td><td>2022-06-12T07:25:26.826Z</td></tr><tr><td>stek29(Viktor Oreshkin)</td><td><p>Для веб версии и приложений на ТВ достаточно <code>netflix.com</code>.<br>
Для приложений на мобильные устройства нужен еще <code>api.fast.com</code>.</p>
<p>Этих двух доменов достаточно для работы Netflix – при этом контент загружается с других доменов, и будет загружаться напрямую, не через VPN.</p></td><td>2022-06-12T12:51:36.049Z</td></tr><tr><td>ValdikSS</td><td><p>Ваша настройка не позволяет менять sysctl-переменные, относящаяся к сетевым таймаутам. Неприятно, но не критично. Ничего делать не нужно.</p></td><td>2022-06-12T20:13:34.889Z</td></tr><tr><td>Csalretepman(Ilnur)</td><td><p>Да, я так и использую теперь, но для авторизации такой подход не верен, нужно найти домен, который используется для этого.</p>
<p>З.ы. при попытке входа в аккаунт пишет, что пара логин и пароль не верны, хотя это не так</p></td><td>2022-06-13T00:57:42.933Z</td></tr><tr><td>PikNik</td><td><p>Привет, решил написать в эту тему, просьба поправить, если ошибся. Захотел разблокировать себе <a href="http://play.google.com" rel="noopener nofollow ugc">play.google.com</a>, для чего внёс этот домен в include-hosts-custom.txt. Однако побочным эффектом стало то, что трафик к другим сервисам Google и самому <a href="http://google.com" rel="noopener nofollow ugc">google.com</a> стал тоже идти через VPN, чего не очень хотелось бы. Как сделать так, чтобы трафик через VPN шёл только к тому домену, который я указал в конфиге?</p></td><td>2022-06-15T17:17:57.142Z</td></tr><tr><td>kirill</td><td><p><a href="https://ntc.party/t/vpn/129/160">Контейнер VPN АнтиЗапрета для установки на собственный сервер - antizapret.prostovpn.org - NTC</a></p></td><td>2022-06-15T21:56:28.701Z</td></tr><tr><td>Starkey</td><td><p>Некоторые сайты выдают заглушки о недоступности в РФ даже после добавления доменов в include-hosts-custom.txt. Например, <a href="http://netflix.com" rel="noopener nofollow ugc">netflix.com</a> (добавил по совету выше <a href="http://netflix.com" rel="noopener nofollow ugc">netflix.com</a> и <a href="http://fast.com" rel="noopener nofollow ugc">fast.com</a>) и <a href="http://wikidot.com" rel="noopener nofollow ugc">wikidot.com</a>. При этом другие сайты (к примеру, <a href="http://canva.com" rel="noopener nofollow ugc">canva.com</a> и <a href="http://pexels.com" rel="noopener nofollow ugc">pexels.com</a>) после добавления открываются нормально. В чем может быть проблема?</p></td><td>2022-06-16T17:11:25.747Z</td></tr><tr><td>Csalretepman(Ilnur)</td><td><p>Вероятнее всего, нетфликс забанил сам пулл адресов этого впс хостера. У меня именно эта ситуация была. Решил переходом в другой впс. Посмотреть на впс можно так:</p>
<pre><code class="lang-auto">curl -Is https://netflix.com |grep 403
</code></pre>
<p>Если нетфликс сам забанил, ты выйдет строчка, а если вывод будет пустой, то, соответственно, нет)</p></td><td>2022-06-16T18:00:00.380Z</td></tr><tr><td>m28688(m286)</td><td><p>определяется двухсторонний ping, из-за выключенного UFW.Если его включить Антизапрет перестает работать. <a class="mention" href="/u/valdikss">@ValdikSS</a> подскажи как включить ufw на своем сервере, что-бы Антизапрет остался работать</p></td><td>2022-06-16T18:08:17.933Z</td></tr><tr><td>Csalretepman(Ilnur)</td><td><p>Кстати, намедни дебажил отсутствия маршрутизации на опенврт. Выяснил, что опенврт не смог прописать маршруты, что передает опенвпн сервак, в итоге дописал в клиентский конфиг эти строки, все сработало.<br>
<code>route 10.224.0.0 255.254.0.0</code><br>
<code>dhcp-option DNS 192.168.104.1</code></p></td><td>2022-06-16T18:09:35.727Z</td></tr><tr><td>Csalretepman(Ilnur)</td><td><pre><code class="lang-auto">ufw allow 1194/tcp
ufw allow 1194/udp
</code></pre>
<p>Открывайте порты в впс’е, а не в контейнере антизапрета</p></td><td>2022-06-17T07:10:54.214Z</td></tr><tr><td>Nologin(Кирилл)</td><td><p>Добрый день, как побороли? Я уже и согласно рекомендациям сделал в скрипте<br>
sudo ufw allow in on lxdbr0<br>
sudo ufw route allow in on lxdbr0 и 1194, перед командой machinectl enable antizapret-vpn. Не отрабатывают скрипты финальной настройки т.к. нет инета внутри контейнера. А фаерволл совсем выключать не хочется (</p></td><td>2022-06-17T11:33:47.836Z</td></tr><tr><td>ValdikSS</td><td><aside class="quote no-group" data-username="ValdikSS" data-post="1" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/valdikss/48/2_2.png" class="avatar"> ValdikSS:</div>
<blockquote>
<p><strong>Используете UFW, контейнер не работает на Vultr?</strong> <a href="https://ntc.party/t/vpn/129/76">Контейнер VPN АнтиЗапрета для установки на собственный сервер - #76 by magratsk</a></p>
</blockquote>
</aside>
<p>Большим жирным шрифтом. Если у вас интерфейс не lxdbr0, необходимо подправить команды.<br>
Если у вас есть какие-то дополнительные запрещающие правила, необходимо также разобраться с тем, что они запрещают.</p></td><td>2022-06-17T11:47:21.498Z</td></tr><tr><td>semaperepelitsa(Simon Perepelitsa)</td><td><p>У меня не сработало. Новая машина Ubuntu 20.04 на Vultr по инструкции в ридми.</p>
<pre><code class="lang-auto">Last login: Sat Jun 18 16:26:27 2022 from 92.255.102.90
root@vultr:~# systemctl disable --now ufw
Synchronizing state of ufw.service with SysV service script with /lib/systemd/systemd-sysv-install.
Executing: /lib/systemd/systemd-sysv-install disable ufw
root@vultr:~# machinectl stop antizapret-vpn
root@vultr:~# machinectl start antizapret-vpn
root@vultr:~# sleep 20
root@vultr:~# machinectl copy-from antizapret-vpn /root/easy-rsa-ipsec/CLIENT_KEY/antizapret-client-tcp.ovpn /root/antizapret-client-tcp.ovpn
Failed to copy: No such file or directory
</code></pre>
<p>Как это вообще дебажить? Логин в контейнер требует пароль.</p></td><td>2022-06-18T16:46:46.419Z</td></tr><tr><td>kirill</td><td><p>Когда-то ставил себе антизапрет на CentOS 7,<br>
нашёл в своих заметках, может, кому ещё пригодится (на полную правильность всего не претендую, я не профессиональный линуксоид)</p>
<pre><code class="lang-auto">yum -y update
reboot

yum -y install epel-release
yum -y update

yum -y install yum-plugin-copr
yum -y copr enable ngompa/snapcore-el7

yum -y install snapd
systemctl enable --now snapd.socket

yum -y install http://download.zfsonlinux.org/epel/zfs-release.el7_4.noarch.rpm
yum -y install yum-utils
yum-config-manager --disable zfs
yum-config-manager --enable zfs-kmod
yum -y install zfs

grubby --args="user_namespace.enable=1" --update-kernel="$(grubby --default-kernel)"
grubby --args="namespace.unpriv_enable=1" --update-kernel="$(grubby --default-kernel)"
sh -c 'echo "user.max_user_namespaces=3883" &gt; /etc/sysctl.d/99-userns.conf'
reboot

snap search lxd
snap install lxd
ln -s /var/lib/snapd/snap /snap

snap list
snap services

usermod -a -G lxd root

newgrp lxd
id

lxc list

lxd init

nano /etc/systemd/system/snap.lxd.daemon.service

[Service]
Environment=LXD_INSECURE_TLS=true

systemctl restart snap.lxd.daemon.service

lxc image import https://antizapret.prostovpn.org/container-images/az-vpn --alias antizapret-vpn-img
lxc init antizapret-vpn-img antizapret-vpn
lxc config device add antizapret-vpn proxy_1194 proxy listen=tcp:[::]:1194 connect=tcp:127.0.0.1:1194
lxc config device add antizapret-vpn proxy_1194_udp proxy listen=udp:[::]:1194 connect=udp:127.0.0.1:1194
lxc start antizapret-vpn
sleep 10
lxc file pull antizapret-vpn/root/easy-rsa-ipsec/CLIENT_KEY/antizapret-client-tcp.ovpn antizapret-client-tcp.ovpn

</code></pre>
<pre><code class="lang-auto">kscp -P 22 -pw &lt;password&gt; root@&lt;ip_addr&gt;:./antizapret-client-tcp.ovpn antizapret-client-tcp.ovpn

</code></pre></td><td>2022-06-19T00:29:24.641Z</td></tr><tr><td>ValdikSS</td><td><aside class="quote no-group" data-username="semaperepelitsa" data-post="259" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/semaperepelitsa/48/1528_2.png" class="avatar"> semaperepelitsa:</div>
<blockquote>
<p>У меня не сработало. Новая машина Ubuntu 20.04 на Vultr по инструкции в ридми.</p>
</blockquote>
</aside>
<p>Только что попробовал, взяв скрипт и добавив в самое его начало правила ufw — сработало. Обратите внимание, что по ссылке правила для LXD, а для systemd-machined необходимо изменить название интерфейса на “ve-antizapr+”. Вот полный текст скрипта (но у меня, почему-то, он не выполнился до конца, пришлось запускать вручную):</p>
<details>
<summary>
Спойлер</summary>
<pre><code class="lang-auto">#!/bin/bash
ufw allow in on ve-antizapr+
ufw route allow in on ve-antizapr+
export DEBIAN_FRONTEND=noninteractive
export APT_LISTCHANGES_FRONTEND=none
apt update
apt -y install systemd-container dirmngr
mkdir -p /root/.gnupg/
gpg --no-default-keyring --keyring /etc/systemd/import-pubring.gpg --keyserver hkps://keyserver.ubuntu.com --receive-keys 0xEF2E2223D08B38D4B51FFB9E7135A006B28E1285

machinectl pull-tar https://antizapret.prostovpn.org/container-images/az-vpn/rootfs.tar.xz antizapret-vpn
mkdir -p /etc/systemd/nspawn/
echo -e "[Network]\nVirtualEthernet=yes\nPort=tcp:1194:1194\nPort=udp:1194:1194" &gt; /etc/systemd/nspawn/antizapret-vpn.nspawn

systemctl enable --now systemd-networkd.service
machinectl enable antizapret-vpn
machinectl start antizapret-vpn
sleep 20
machinectl copy-from antizapret-vpn /root/easy-rsa-ipsec/CLIENT_KEY/antizapret-client-tcp.ovpn /root/antizapret-client-tcp.ovpn
</code></pre>
</details>
<aside class="quote no-group" data-username="semaperepelitsa" data-post="259" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/semaperepelitsa/48/1528_2.png" class="avatar"> semaperepelitsa:</div>
<blockquote>
<p>Как это вообще дебажить? Логин в контейнер требует пароль.</p>
</blockquote>
</aside>
<p><code>machinectl shell antizapret-vpn</code> для доступа внутрь контейнера.</p></td><td>2022-06-19T00:31:03.924Z</td></tr><tr><td>semaperepelitsa(Simon Perepelitsa)</td><td><p>Спасибо, уже прошло дальше, файл .ovpn появился, правда пришлось заново переустановить машину. Но VPN не подключается, таймаут. Подключается с выключенным файерволом:</p>
<p><code>systemctl disable --now ufw</code></p>
<p>Пробовал порт разрешать, но не помогло:</p>
<p><code>ufw allow 1194</code></p>
<p>Хорошо было бы обновить в итоге инструкцию в ридми для Vultr, а то она не рабочая получается.</p></td><td>2022-06-19T20:27:34.517Z</td></tr><tr><td>xtrime</td><td><p>Всем привет!</p>
<p>Не нашел готового докер контейнера, а по инструкции отсюда <a href="https://bitbucket.org/anticensority/antizapret-vpn-container/src/master/" class="inline-onebox">Bitbucket</a> внутри контейнеров для LXD и systemd-machined небыло интернета.</p>
<p>Разбираться не стал и конвертнул образ LXD в docker. Через него все завелось!</p>
<p>Закинул на гитхаб:</p><aside class="onebox githubrepo" data-onebox-src="https://github.com/xtrime-ru/antizapret-vpn-docker">
  <header class="source">

      <a href="https://github.com/xtrime-ru/antizapret-vpn-docker" target="_blank" rel="noopener">github.com</a>
  </header>

  <article class="onebox-body">
    <div class="github-row" data-github-private-repo="false">
  <img width="690" height="344" src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/3f4178cf7cc0e54e77da75dbf645e8b493f49c39_2_690x344.png" class="thumbnail" data-dominant-color="EBEDED">

  <h3><a href="https://github.com/xtrime-ru/antizapret-vpn-docker" target="_blank" rel="noopener">GitHub - xtrime-ru/antizapret-vpn-docker: Docker container with antizapret-vpn for...</a></h3>

    <p><span class="github-repo-description">Docker container with antizapret-vpn for selfhosting.</span></p>
</div>

  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

<p>Имхо старт получился проще, чем в LXD или systemd-machined. Если бы еще нативный Dockerfile сделать, а не конвертить, было бы шикарно…</p>
<p><a class="mention" href="/u/valdikss">@ValdikSS</a> буду признателен за фидбэк! Если все ок, то мб можно перенести мой код в основной репо или добавить инструкцию в readme?</p></td><td>2022-06-19T22:40:44.610Z</td></tr><tr><td>ValdikSS</td><td><aside class="quote no-group" data-username="xtrime" data-post="263" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/xtrime/48/1524_2.png" class="avatar"> xtrime:</div>
<blockquote>
<p>буду признателен за фидбэк!</p>
</blockquote>
</aside>
<p>Docker предназначен для контейнеров приложений (application container): в контейнере, как правило, запускается единственная программа как init 1, образ не может самостоятельно обновляться (его необходимо коммитить), и т.п.<br>
LXD и machined — системные контейнеры (system container) — предназначены для контейнеризации всей системы, по принципу виртуальной машины.<br>
Я удивлён, что у вас в принципе запускается systemd (<code>/usr/sbin/init</code>) внутри — все эти годы Docker не поддерживал systemd. Docker — неподходящий инструмент для целей контейнеризации антизапрета.</p></td><td>2022-06-20T06:21:08.936Z</td></tr><tr><td>netwalker(A.)</td><td><p>Всем доброго времени!<br>
Установил контейнер, но столкнулся с проблемой - при подключении к VPS с ОС Ubuntu 20.04, на котором поднят контейнер, страницы не открываются. Браузер весело посылает в тухес с сообщением “ERR_NAME_NOT_RESOLVED”.<br>
В самом контейнере интернет есть.<br>
Connected to machine antizapret-vpn. Press ^] three times within 1s to exit session.<br>
root@antizapret-vpn:~# ping <a href="http://ya.ru" rel="noopener nofollow ugc">ya.ru</a><br>
PING <a href="http://ya.ru" rel="noopener nofollow ugc">ya.ru</a> (87.250.250.242): 56 data bytes<br>
64 bytes from 87.250.250.242: icmp_seq=0 ttl=241 time=68.027 ms<br>
64 bytes from 87.250.250.242: icmp_seq=1 ttl=241 time=68.049 ms<br>
64 bytes from 87.250.250.242: icmp_seq=2 ttl=241 time=68.065 ms<br>
64 bytes from 87.250.250.242: icmp_seq=3 ttl=241 time=67.992 ms<br>
64 bytes from 87.250.250.242: icmp_seq=4 ttl=241 time=67.960 ms<br>
64 bytes from 87.250.250.242: icmp_seq=5 ttl=241 time=67.998 ms<br>
64 bytes from 87.250.250.242: icmp_seq=6 ttl=241 time=68.017 ms<br>
^C— <a href="http://ya.ru" rel="noopener nofollow ugc">ya.ru</a> ping statistics —<br>
7 packets transmitted, 7 packets received, 0% packet loss<br>
round-trip min/avg/max/stddev = 67.960/68.015/68.065/0.033 ms<br>
root@antizapret-vpn:~# nslookup <a href="http://ya.ru" rel="noopener nofollow ugc">ya.ru</a><br>
Server:         8.8.8.8<br>
Address:        8.8.8.8#53</p>
<p>Non-authoritative answer:<br>
Name:   <a href="http://ya.ru" rel="noopener nofollow ugc">ya.ru</a><br>
Address: 87.250.250.242<br>
Name:   <a href="http://ya.ru" rel="noopener nofollow ugc">ya.ru</a><br>
Address: 2a02:6b8::2:242</p>
<p>root@antizapret-vpn:~#<br>
Подскажите, куда ковырнуть?<br>
UFW отключен и не используется. Пробовал включать, в порядке бреда пробрасывать порт 1194 - то же самое. Голову сломал</p></td><td>2022-06-21T13:11:17.675Z</td></tr><tr><td>ValdikSS</td><td><aside class="quote no-group" data-username="netwalker" data-post="266" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/n/bbce88/48.png" class="avatar"> netwalker:</div>
<blockquote>
<p>“ERR_NAME_NOT_RESOLVED”.<br>
В самом контейнере интернет есть.</p>
</blockquote>
</aside>
<p>Убедитесь, что DNS knot-resolver’а внутри контейнера работает:<br>
<code>dig ya.ru @127.0.0.1</code><br>
<code>systemctl status kresd@1</code></p></td><td>2022-06-21T21:36:48.852Z</td></tr><tr><td>flameshikari(Evgeny)</td><td><p>Привет!</p>
<p>Во-первых, всегда хотел сказать спасибо за антизапрет. Пользуюсь уже долгое время, никаких проблем не возникало.</p>
<p>Во-вторых, я потестил Docker-контейнер от xtrime, и он прекрасно работает,  но я не совсем понял что под самостоятельным обновлением образа ты имел в виду. Мол, нужно будет поддерживать Docker-образ и обновлять его после новых коммитов в репо на Bitbucket или что-то другое?</p></td><td>2022-06-21T23:36:52.341Z</td></tr><tr><td>ValdikSS</td><td><p>В контейнере настроены автоматические обновления безопасности компонентов ОС, что позволяет не беспокоиться об актуальности софта без его пересборки. С Docker такое не получится, его концепция подразумевает «заморозку» образа, что несёт прямо противоположный эффект.</p></td><td>2022-06-22T06:48:38.350Z</td></tr><tr><td>kirill</td><td><p>можно подробней пояснить про безопасность?</p>
<p>мне не совсем понятно, для чего в самом lxd-контейнере нужны эти обновления безопасности?<br>
по сути – если обновляются только сами нужные для работы функционала списки,<br>
проброшен только нужный порт,<br>
к чему обновлять сам контейнер, не достаточно ли обновлять по безопасности только сам хост-сервер?</p></td><td>2022-06-22T09:51:39.245Z</td></tr><tr><td>Nologin(Кирилл)</td><td><p>Добрый день, работало перу дней стабильно и без нареканий, вчера заметил что вечером не коннектится. Начал копать, выяснил что doall.sh ругается на закончившееся свободное место.<br>
<img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/f918a8cac3c38600935bed9a1f36f0d415eaa561.png" alt="image" data-base62-sha1="zxBINs7xFqAPKp4fI99XN0W05AR" width="647" height="304"></p></td><td>2022-06-23T08:42:06.264Z</td></tr><tr><td>ValdikSS</td><td><details>
<summary>
Безопасность контейнеров приложений</summary>
<p>Основной целью атаки и потенциальным местом наличия уязвимостей является софт внутри контейнера, ведь именно c ПО внутри контейнера ведётся взаимодействие пользователя, оно содержит и обрабатывает ваши данные, и именно к этому ПО злоумышленник имеет прямой сетевой доступ. Его защита и обновление является первостепенной задачей обеспечения безопасности.<br>
Системы контейнеризации обеспечивают изоляцию одного контейнера от другого и от хост-системы, но каких-либо дополнительных методов защиты ПО внутри контейнера не предоставляют. В этом плане работа ПО внутри контейнера не отличаются от его работы просто в хост-системе, без контейнеризации.</p>
<p>Если злоумышленнику удалось взломать ПО и получить доступ внутрь контейнера, он может применять атаки к хост-системе (на ПО контейнеризации и к ядру системы), чтобы повысить привилегии и выйти из контейнера, поэтому также важно обновлять и ПО хост-системы.</p>
<p>Системные контейнеры, вроде АнтиЗапрета, содержат полноценную операционную систему и пакеты, установленные из официальных репозиториев дистрибутива. В VPN-контейнере есть только два нештатных компонента: DNS-ремаппер и скрипт обновления списка заблокированных сайтов. Всё остальное ПО внутри контейнера стандартное, что позволяет настроить автоматические обновления безопасности дистрибутива, переложив ответственность за это на мейнтейнеров дистрибутива — людей, которые лучше всего в этом разбираются. Причем в Debian, на котором построен контейнер, автообновления реализованы гибко и надёжно — можно настроить обновления пакетов только в случае исправлений безопасности, а не всех подряд.</p>
<p>Контейнеры приложений, в отличие от системных, подразумевают миниатюрную файловую систему из минимально необходимых компонентов для запуска ПО, а также заморозку образа в состоянии на момент сборки. Это удобно на этапе разработки, для ПО вне репозитория или для устаревшего, которому нужны определённые версии библиотек, но перекладывает ответственность за поддержание сторонних компонентов внутри контейнера в актуальном состоянии и на создателя этого контейнера (компоненты необходимо обновлять, а контейнер пересобирать), и на пользователей (контейнер необходимо обновлять), чего я стремлюсь избегать — лучше доверить эту работу более компетентным и ответственным мейнтейнерам дистрибутива.</p>
<p>Как сказал системный администратор Amarao:</p>
<blockquote>
<p>Docker — это отличная возможность переложить проблемы поддержания  актуальных версий системных библиотек (того же самого openssl) с  поставщиков ОС и системных администраторов на никого. После того, как  проблемы безопасности окружения переложены на никого, скорость внедрения  и эксплуатации заметно возрастает, ведь производительность никого  ограничена только супремумом пофигизма, а он, в свою очередь, верхней  границы не имеет</p>
</blockquote>
</details></td><td>2022-06-23T08:51:39.838Z</td></tr><tr><td>rubberducky</td><td><aside class="quote no-group" data-username="ValdikSS" data-post="236" data-topic="129" data-full="true">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/valdikss/48/2_2.png" class="avatar"> ValdikSS:</div>
<blockquote>
<p>Связь между клиентами VPN заблокирована средствами межсетевого экрана.<br>
В файле <code>/etc/ferm/ferm.conf</code> измените строку:<br>
<code>interface vpn+ outerface $EXT_INTERFACE ACCEPT;</code><br>
на<br>
<code>interface vpn+ outerface ($EXT_INTERFACE vpn+) ACCEPT;</code><br>
И перезапустите контейнер.</p>
</blockquote>
</aside>
<p>Сделал как вы сказали, но все равно пинги не идут</p></td><td>2022-06-24T05:56:37.919Z</td></tr><tr><td>Nologin(Кирилл)</td><td><p>Отвечу сам на свой вопрос. 10Gb SSD не хватает на хост и контейнер. Может зря обновил ОС. Каталог cuda (в /usr/local/cuda/lib64) весит под 2.8 Gb, думаю, надо ли он? Тесновато под систему, работает пару дней, потом сама себя логами перегружает и все. Нет места. Делать апгред пакета за 3.5 уе до 5, в котором 25 гиг на SSD? Или можно почистить ручками ненужное?<br>
<img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/fa3feaea3465d2325320f00038ed7a0eb9e7f15e.png" alt="image" data-base62-sha1="zHOjfCHLPi6Rb1YUh4TkixK4UP4" width="640" height="475"></p></td><td>2022-06-24T11:43:44.940Z</td></tr><tr><td>vovansick</td><td><p>10 хватает. Помимо антизапрета стоит еще один vpn-сервер на самом хосте, 2 месяца уже спокойно всё работает</p>
<p>UPD: полная конфигурация: 1 ядро, 1гб RAM, 10гб SSD, Debian 11, контейнер systemd, в общем всё занимает почти 4гб<br>
<img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/c17a30a86fd451b2da278726026f89750e0b0c0a.png" alt="Screenshot 2022-06-24 172601" data-base62-sha1="rBzWsb70Jo6CNVZsaBcVGDDzkWS" width="654" height="460"></p></td><td>2022-06-24T14:31:44.975Z</td></tr><tr><td>netwalker(A.)</td><td><p>Доброго времени! Спасибо за ответ.</p>
<pre><code class="lang-plaintext">root@antizapret-vpn:~# dig ya.ru @127.0.0.1

; &lt;&lt;&gt;&gt; DiG 9.11.5-P4-5.1+deb10u1-Debian &lt;&lt;&gt;&gt; ya.ru @127.0.0.1
;; global options: +cmd
;; Got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 21058
;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 4096
;; QUESTION SECTION:
;ya.ru.                         IN      A

;; ANSWER SECTION:
ya.ru.                  600     IN      A       87.250.250.242

;; Query time: 299 msec
;; SERVER: 127.0.0.1#53(127.0.0.1)
;; WHEN: Wed Jun 22 12:57:28 MSK 2022
;; MSG SIZE  rcvd: 50

root@antizapret-vpn:~#

root@antizapret-vpn:~# systemctl status kresd@1
● kresd@1.service - Knot Resolver daemon
   Loaded: loaded (/lib/systemd/system/kresd@.service; enabled; vendor preset: e
nabled)
  Drop-In: /etc/systemd/system/kresd@.service.d
           └─override.conf
   Active: active (running) since Wed 2022-06-22 12:57:01 MSK; 2min 1
6s ago
     Docs: man:kresd.systemd(7)
           man:kresd(8)
 Main PID: 381 (kresd)
   CGroup: /system.slice/system-kresd.slice/kresd@1.service
           └─381 /usr/sbin/kresd -c /usr/lib/knot-resolver/distro-preconfig.lua
-c /etc/knot-resolver/kresd.conf -n

Jun 22 12:56:59 antizapret-vpn systemd[1]: Starting Knot Resolver daemon...
Jun 22 12:56:59 antizapret-vpn kresd[381]: [system] warning: hard limit for numb
er of file-descriptors is only 4096 but recommended value is 524288
Jun 22 12:57:01 antizapret-vpn systemd[1]: Started Knot Resolver daemon.
root@antizapret-vpn:~#
</code></pre>
<p>Судя по ответам - внутри контейнера все работает.<br>
Что еще посмотреть? Влияют ли как то на работоспособность DNS сервера, которые я использую? Использую не провайдерские, а публичные.<br>
<a href="https://imageup.ru/img89/3959929/izobrazhenie_2022-06-22_130232483.png.html" target="_blank" rel="noopener nofollow ugc"><img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/2fda8ec24fa25ee7ed915b127724e9861dee58a8.png" data-base62-sha1="6PkHjSZB3LROJevsM5eOJee11Co" alt="бесплатный хостинг фотографий" width="690" height="388"></a><br>
Ссылку на скриншот из настроек роутера прилагаю.<br>
Спасибо еще раз за Ваш труд</p></td><td>2022-06-24T18:15:55.683Z</td></tr><tr><td>xtrime</td><td><aside class="quote no-group" data-username="ValdikSS" data-post="269" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/valdikss/48/2_2.png" class="avatar"> ValdikSS:</div>
<blockquote>
<p>В контейнере настроены автоматические обновления безопасности компонентов ОС</p>
</blockquote>
</aside>
<p>Обновление unattended upgrades запускается в моем контейнере автоматически. Я чекнул docker diff и в списке измененных файлов есть лог. Правда apt ругается:</p>
<pre><code class="lang-auto">W: An error occurred during the signature verification. The repository is not updated and the previous index files will be used. GPG error: http://download.opensuse.org/repositories/home:/CZ-NIC:/knot-resolver-latest/Debian_10  InRelease: The following signatures were invalid: EXPKEYSIG 74062DB36A1F4009 home:CZ-NIC OBS Project &lt;home:CZ-NIC@build.opensuse.org&gt;
</code></pre>
<p>apt update &amp;&amp; apt upgrade руками выдает туже ошибку. Это точно проблема в докере, а не в самом образе? Если есть какая то команда, что бы прописать эту signature, то я добавлю ее в entrypoint и автообновление все будет работать.</p></td><td>2022-06-24T21:57:47.259Z</td></tr><tr><td>xtrime</td><td><aside class="quote no-group" data-username="ValdikSS" data-post="265" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/valdikss/48/2_2.png" class="avatar"> ValdikSS:</div>
<blockquote>
<p>Docker — неподходящий инструмент для целей контейнеризации антизапрета.</p>
</blockquote>
</aside>
<p>Спасибо за критику! Согласен, что запуск нескольких приложений внутри одного контейнера противоречит docker-way концепции.<br>
Но инструкции из readme у меня не сработали. А докер многим привычнее и запуск гораздо проще. И заработал сразу…<br>
Из проблем которые вижу: если какой то процесс упадет - то докер не перезапустит контейнер. Нужно делать какой нибудь healthcheck. Хотя не уверен, что lxd как то решает эту проблему…<br>
Хотя у меня все работает стабильно уже неделю, так что пока не горит <img src="https://ntc.party/images/emoji/twitter/slight_smile.png?v=12" title=":slight_smile:" class="emoji" alt=":slight_smile:" loading="lazy" width="20" height="20"></p></td><td>2022-06-24T22:04:14.507Z</td></tr><tr><td>xtrime</td><td><aside class="quote no-group" data-username="xtrime" data-post="277" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/xtrime/48/1524_2.png" class="avatar"> xtrime:</div>
<blockquote>
<p>Если есть какая то команда, что бы прописать эту signature, то я добавлю ее в entrypoint и автообновление все будет работать.</p>
</blockquote>
</aside>
<p>Починил apt update и запушил фикс в свой репо. Теперь система обновляется при сборке образа и автоматически при работе контейнера.</p>
<p><a href="/u/ValdikSS">ValdikSS</a>, <a href="/u/flameshikari">flameshikari</a>, спасибо за фидбек.</p>
<hr>
<aside class="quote no-group" data-username="ValdikSS" data-post="269" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/valdikss/48/2_2.png" class="avatar"> ValdikSS:</div>
<blockquote>
<p>С Docker такое не получится, его концепция подразумевает «заморозку» образа, что несёт прямо противоположный эффект.</p>
</blockquote>
</aside>
<p>Ссори за холивар, но тут не соглашусь. Почему не получится? Образ это просто “основа” для контейнера. А контейнер никак не ограничивает работу с диском. Система в контейнере будет обновляться, и данные из файловой системы контейнера никуда не денутся даже при перезагрузках. Конечно, изменения записываются в отдельный “слой” файловой системы докера, но на практике это почти ни на что не влияет.</p>
<p>Согласен, что концепция докера не приветствует такие вещи, но на практике используется часто…</p></td><td>2022-06-25T01:07:45.751Z</td></tr><tr><td>ValdikSS</td><td><aside class="quote no-group" data-username="netwalker" data-post="276" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/n/bbce88/48.png" class="avatar"> netwalker:</div>
<blockquote>
<p>Влияют ли как то на работоспособность DNS сервера, которые я использую? Использую не провайдерские, а публичные.</p>
</blockquote>
</aside>
<p><a href="https://antizapret.prostovpn.org/help.html" class="onebox" target="_blank" rel="noopener">https://antizapret.prostovpn.org/help.html</a></p>
<h4><a name="vpn-1" class="anchor" href="#vpn-1"></a>‣ VPN АнтиЗапрета подключается, но заблокированные сайты не открываются</h4>
<p><strong>Убедитесь, что используете DNS-сервер внутри VPN-соединения, а не сторонний или провайдерский. Проверьте, что не используете DNS over HTTPS в браузере («Защищенный DNS»), Private DNS в Android, Private Relay в iOS.</strong><br>
Требование вызвано <a href="https://antizapret.prostovpn.org/tech.html#vpn">особенностями маршрутизации в VPN АнтиЗапрета</a>.</p></td><td>2022-06-26T06:08:47.773Z</td></tr><tr><td>Aleksei</td><td><p>У меня на Centos 7 появляется проблема с ferm, соответсвенно ничего не работает. Может подскажете как с этим быть:</p>
<p>Jun 30 14:40:39 antizapret-vpn ferm[199]: Starting Firewall: fermiptables-restore v1.8.2 (nf_tables):<br>
Jun 30 14:40:39 antizapret-vpn ferm[199]: line 3: CHAIN_UPDATE failed (No such file or directory): chain FORWARD<br>
Jun 30 14:40:39 antizapret-vpn ferm[199]: Failed to run /sbin/iptables-restore<br>
Jun 30 14:40:39 antizapret-vpn ferm[199]: iptables-restore v1.8.2 (nf_tables):<br>
Jun 30 14:40:39 antizapret-vpn ferm[199]: line 2: CHAIN_UPDATE failed (No such file or directory): chain FORWARD<br>
Jun 30 14:40:39 antizapret-vpn ferm[199]: Failed to run /sbin/iptables-restore<br>
Jun 30 14:40:39 antizapret-vpn systemd-journald[208]: Runtime journal (/run/log/journal/5b6e10df4f7b4a2b90bbb0a257aa5010) is 1.0M, max 8.0M, 7.0M free.<br>
Jun 30 14:40:39 antizapret-vpn ferm[199]:  failed!<br>
Jun 30 14:40:39 antizapret-vpn systemd[1]: ferm.service: Main process exited, code=exited, status=4/NOPERMISSION<br>
Jun 30 14:40:39 antizapret-vpn systemd[1]: ferm.service: Failed to kill control group /lxc.payload.antizapret-vpn/system.slice/ferm.service, ignoring: Invalid argument<br>
Jun 30 14:40:39 antizapret-vpn systemd[1]: ferm.service: Failed to kill control group /lxc.payload.antizapret-vpn/system.slice/ferm.service, ignoring: Invalid argument<br>
Jun 30 14:40:39 antizapret-vpn systemd[1]: ferm.service: Failed to kill control group /lxc.payload.antizapret-vpn/system.slice/ferm.service, ignoring: Invalid argument<br>
Jun 30 14:40:39 antizapret-vpn systemd[1]: ferm.service: Failed to kill control group /lxc.payload.antizapret-vpn/system.slice/ferm.service, ignoring: Invalid argument<br>
Jun 30 14:40:39 antizapret-vpn systemd[1]: ferm.service: Failed with result ‘exit-code’.<br>
Jun 30 14:40:39 antizapret-vpn systemd[1]: Failed to start ferm firewall configuration.</p></td><td>2022-07-01T08:27:55.176Z</td></tr><tr><td>xtrime</td><td><aside class="quote no-group" data-username="Aleksei" data-post="281" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/a/7c8e57/48.png" class="avatar"> Aleksei:</div>
<blockquote>
<p>соответсвенно ничего не работает</p>
</blockquote>
</aside>
<p>Можно попробовать мой докер образ: <a href="https://github.com/xtrime-ru/antizapret-vpn-docker" class="inline-onebox" rel="noopener nofollow ugc">GitHub - xtrime-ru/antizapret-vpn-docker: Docker container with antizapret-vpn for selfhosting.</a></p></td><td>2022-07-01T10:39:32.250Z</td></tr><tr><td>Nologin(Кирилл)</td><td><p>Доброго дня! 5 простых правил UFW, имена интерфейсов правильные, порт открывал и на конкретном адаптере, и на всех сразу. Толку 0. В лог все равно падает UFW_BLOCK:<br>
<img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/fea9a0448badd5800040bc37030f5bc68c3fb7e5.png" alt="image" data-base62-sha1="AkQHnlmmpI2Wv4SGc8CcSJ3e2Ox" width="619" height="173"><br>
<div class="lightbox-wrapper"><a class="lightbox" href="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/a12eba34e20d5f404fc2732126ee291e719cd783.png" data-download-href="https://ntc.party/uploads/default/a12eba34e20d5f404fc2732126ee291e719cd783" title="image"><img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/a12eba34e20d5f404fc2732126ee291e719cd783.png" alt="image" data-base62-sha1="mZSZ6UF0gvht0rzZfHBpK6CRDkn" width="690" height="16" data-dominant-color="1219BA"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">1442×34 3.75 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div><br>
Правило номер 3 поидее даже не нужно, ибо по дефолту UFW на OUT открыт.<br>
С выключенный UFW все работает, всю голову уже сломал, что ему еще нужно?</p></td><td>2022-07-04T07:58:47.695Z</td></tr><tr><td>ValdikSS</td><td><p>В вашей хост-системе, вероятно, нет поддержки nftables. Можете попробовать переключиться на обычный iptables/netfilter, для этого внутри контейнера наберите:</p>
<pre><code class="lang-auto">update-alternatives --set iptables /usr/sbin/iptables-legacy
update-alternatives --set ip6tables /usr/sbin/ip6tables-legacy
update-alternatives --set arptables /usr/sbin/arptables-legacy
update-alternatives --set ebtables /usr/sbin/ebtables-legacy
</code></pre></td><td>2022-07-04T11:08:31.616Z</td></tr><tr><td>ValdikSS</td><td><p>У вас нет разрешающего forward-правила в интерфейс контейнера.</p></td><td>2022-07-04T11:10:12.224Z</td></tr><tr><td>Oleg(oleg)</td><td><p>Здравствуйте. Установлен свой сервер антизапрета вне России.<br>
Многие сайты делал обход блокировок через include-hosts-custom.txt в контейнере.<br>
Но <a href="http://download.microsoft.com" rel="noopener nofollow ugc">download.microsoft.com</a> и <a href="http://microsoft.com" rel="noopener nofollow ugc">microsoft.com</a> это не работает. Возможно кто то сможет подсказать как сделать что бы можно было скачивать ISO образ, с сайта разработчика.<br>
Методом добавления в include-hosts-custom.txt<br>
Спасибо.</p></td><td>2022-07-03T09:29:19.768Z</td></tr><tr><td>ValdikSS</td><td><p>Вы делаете правильные действия. Убедитесь, что вы запустили обновление списка после добавления сайта и дождались его завершения.</p></td><td>2022-07-04T11:46:08.817Z</td></tr><tr><td>Oleg(oleg)</td><td><p>Да спасибо, не знаю помогло или нет но с добавлением <a href="http://go.microsoft.com" rel="noopener nofollow ugc">go.microsoft.com</a> Всё начало качать. Возможно просто раньше не дождался обновления списка.</p></td><td>2022-07-04T17:51:32.206Z</td></tr><tr><td>413xk</td><td><p>Подскажите пожалуйста, как правильно с точки зрения производительности добавлять новых клиентов?</p>
<p>Допустим, есть антизапрет-сервер и дефолтная пара ключей/конфигов.<br>
И есть пять клиентов, которые нужно подключить к этому антизапрету.</p>
<p>Как лучше делать, цеплять всех по одному сертификату или генерировать под каждого пользователя новые?<br>
Так-то, вроде и с одним все работает, айпишники получают разные… Но чот хз как корректно сделать.</p></td><td>2022-07-05T05:03:31.614Z</td></tr><tr><td>Nologin(Кирилл)</td><td><aside class="quote no-group" data-username="ValdikSS" data-post="285" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/valdikss/48/2_2.png" class="avatar"> ValdikSS:</div>
<blockquote>
<p>решающего forward-правила</p>
</blockquote>
</aside>
<p>Добавил <strong>ufw route allow proto tcp from any to any port 1194</strong> и все заработало.<br>
UPD: в ЛДНР начали блочить Вайбер. Я добавил пару правил <a href="http://amazonaws.com" rel="noopener nofollow ugc">amazonaws.com</a> и <a href="http://viber.com" rel="noopener nofollow ugc">viber.com</a> - забегали. Правда на телефоне работает, а вот на кампе не хотело, подключенного по WiFi к тому же телефону.</p></td><td>2022-07-05T08:00:42.737Z</td></tr><tr><td>Kimb</td><td><p>Приветствую!<br>
Существует ли инструкция, как запустить этот впн без контейнера?</p>
<p>ЗЫ<br>
ValdikSS, у Вас есть возможность связаться со мной через лс или иным способом?</p></td><td>2022-07-15T17:57:19.746Z</td></tr><tr><td>ValdikSS</td><td><p>Такой инструкции нет. Я бы не советовал вам запусакть всё вне контейнера, так как, во-первых, демону <code>dnsmap</code> требуются root-привилегии для добавления правил iptables, а он был написан за очень короткое время и наверняка в нём есть ошибки, также он добавляет очень большое количество правил iptables (на каждый IP-адрес), что вы, с большой вероятностью, не хотите видеть на хост-машине.</p>
<aside class="quote no-group" data-username="Kimb" data-post="291" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/k/edb3f5/48.png" class="avatar"> Kimb:</div>
<blockquote>
<p>ValdikSS, у Вас есть возможность связаться со мной через лс или иным способом?</p>
</blockquote>
</aside>
<p>Напишите мне самостоятельно, если у вас есть вопросы. А лучше задавайте их в этой теме.</p></td><td>2022-07-15T19:49:45.490Z</td></tr><tr><td>tkmw1985(VALLY-VULLY)</td><td><p>Как отключить скачивание списка и оставить только свои маршруты и домены на собственном сервере ?</p></td><td>2022-07-19T18:08:12.472Z</td></tr><tr><td>ValdikSS</td><td><p>Такой возможности нет, только хакать скрипты.</p></td><td>2022-07-19T21:07:48.861Z</td></tr><tr><td>tkmw1985(VALLY-VULLY)</td><td><p>Понял спасибо</p></td><td>2022-07-20T10:48:10.439Z</td></tr><tr><td>413xk</td><td><p>Подскажите пожалуйста, может у кого идеи есть.<br>
Антизапрет в Ubuntu 20/22 через lxc/snap.<br>
По TCP всё работает чётко.<br>
По UDP клиент (в моем случае либо опенвпн коннект для андроида, либо кинетик) подключается, трафик в тоннель уходит, но обратно не приходит, то есть “односторонний линк” получается.<br>
ufw отключен, iptables/firewalld тоже.</p>
<p>Имхо, трафик не форвардится, но где копать в lxc/ubuntu в упор не понимаю.</p>
<p>UP: разобрался, всё таки косяк в конфиге с моей стороны, пытался использовать конфигурацию от tcp, когда надо было udp с правками (не удалил cipher, не добавил comp-lzo)</p></td><td>2022-07-21T18:02:41.675Z</td></tr><tr><td>biliboba(biliboba)</td><td><p>не могу понять как изменить dns сервер? в resolv поменял на 1.1.1.1 но почему-то выдает что у меня установлен dns как ip адрес сервера (на dnsleak проверке)</p>
<p>ubuntu 20.04</p>
<p>на сервере:<br>
nslookup <a href="http://ya.ru" rel="noopener nofollow ugc">ya.ru</a><br>
Server:		1.1.1.1<br>
Address:	1.1.1.1#53</p>
<p>из контейнера antizapret:<br>
root@antizapret-vpn:~# nslookup <a href="http://ya.ru" rel="noopener nofollow ugc">ya.ru</a><br>
Server:		8.8.8.8<br>
Address:	8.8.8.8#53</p></td><td>2022-07-25T21:30:21.260Z</td></tr><tr><td>biliboba(biliboba)</td><td><p>с сервера</p>
<pre><code class="lang-auto">resolvectl status
Global
       LLMNR setting: no
MulticastDNS setting: no
  DNSOverTLS setting: no
      DNSSEC setting: no
    DNSSEC supported: no
  Current DNS Server: 1.1.1.1
         DNS Servers: 1.1.1.1
Fallback DNS Servers: 1.0.0.1
          DNSSEC NTA: 10.in-addr.arpa
                      16.172.in-addr.arpa
                      168.192.in-addr.arpa
                      17.172.in-addr.arpa
                      18.172.in-addr.arpa
                      19.172.in-addr.arpa
                      20.172.in-addr.arpa
                      21.172.in-addr.arpa
                      22.172.in-addr.arpa
                      23.172.in-addr.arpa
                      24.172.in-addr.arpa
                      25.172.in-addr.arpa
                      26.172.in-addr.arpa
                      27.172.in-addr.arpa
                      28.172.in-addr.arpa
                      29.172.in-addr.arpa
                      30.172.in-addr.arpa
                      31.172.in-addr.arpa
                      corp
                      d.f.ip6.arpa
                      home
                      internal
                      intranet
                      lan
                      local
                      private
                      test

Link 7 (vethb042b929)
      Current Scopes: none
DefaultRoute setting: no
       LLMNR setting: yes
MulticastDNS setting: no
  DNSOverTLS setting: no
      DNSSEC setting: no
    DNSSEC supported: no

Link 3 (lxdbr0)
      Current Scopes: none
DefaultRoute setting: no
       LLMNR setting: yes
MulticastDNS setting: no
  DNSOverTLS setting: no
</code></pre></td><td>2022-07-25T21:41:55.027Z</td></tr><tr><td>ValdikSS</td><td><aside class="quote no-group" data-username="biliboba" data-post="297" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/b/f9ae1b/48.png" class="avatar"> biliboba:</div>
<blockquote>
<p>не могу понять как изменить dns сервер? в resolv поменял на 1.1.1.1 но почему-то выдает что у меня установлен dns как ip адрес сервера (на dnsleak проверке)</p>
</blockquote>
</aside>
<p>В контейнере установлен рекурсивный кеширующий dns-резолвер knot-resolver, самостоятельно и автономно занимающийся разрешением имён. Его настройки находятся в <code>/etc/knot-resolver/kresd.conf</code>, а то, что вы ищете, описано в сообщении <a href="https://ntc.party/t/vpn/129/40" class="inline-onebox">Контейнер VPN АнтиЗапрета для установки на собственный сервер - #40 by ValdikSS</a>.</p>
<p>Не нужно менять настройки без веской причины и добавлять внешние сущности без необходимости — ни к чему использовать внешний рекурсивный резолвер, когда уже есть точно такой же, настроенный и рабочий.</p></td><td>2022-07-25T22:24:26.055Z</td></tr><tr><td>biliboba(biliboba)</td><td><p>спасибо прописал</p>
<p>policy.add(policy.all(policy.FORWARD({‘1.1.1.1’})))</p></td><td>2022-07-26T05:27:49.849Z</td></tr><tr><td>bokov333(Bokov333)</td><td><p>Подскажите, как разрешить доступ клиентов подключённых к контейнеру друг к другу? И если возможно, назначить им статические ip.</p></td><td>2022-07-27T07:40:28.801Z</td></tr><tr><td>ValdikSS</td><td><aside class="quote" data-post="236" data-topic="129">
  <div class="title">
    <div class="quote-controls"></div>
    <img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/valdikss/48/2_2.png" class="avatar">
    <a href="https://ntc.party/t/vpn/129/236">Контейнер VPN АнтиЗапрета для установки на собственный сервер</a> <a class="badge-category__wrapper " href="/c/antizapret-prostovpn-org/az-self-hosted/38"><span data-category-id="38" style="--category-badge-color: #0088CC; --category-badge-text-color: #FFFFFF; --parent-category-badge-color: #8C6238;" data-parent-category-id="5" data-drop-close="true" class="badge-category --has-parent" title="Вопросы и особенности работы контейнера VPN АнтиЗапрета на своих серверах"><span class="badge-category__name">АнтиЗапрет на собственном сервере (self-hosted)</span></span></a>
  </div>
  <blockquote>
    Связь между клиентами VPN заблокирована средствами межсетевого экрана. 
В файле /etc/ferm/ferm.conf измените строку: 
interface vpn+ outerface $EXT_INTERFACE ACCEPT; 
на 
interface vpn+ outerface ($EXT_INTERFACE vpn+) ACCEPT; 
И перезапустите контейнер.
  </blockquote>
</aside>
</td><td>2022-07-27T07:49:23.348Z</td></tr><tr><td>Csalretepman(Ilnur)</td><td><p>А есть в контейнере скрипт, для создания новых конфигов опенвпн, чтобы не юзать один и тот же? (Хочу иметь связанность между клиентами при помощи опенвпн с контейнера)</p></td><td>2022-07-27T09:33:49.042Z</td></tr><tr><td>HarryPotter</td><td><p>Дико извиняюсь что не по теме, в прошлом году вы писали пост о блокировке в Туркмении, и давали ссылку на CLOACK с помощью которой можно обходить эти блокировки, т.к от сферы IT я максимально далек, то я просто умоляю вас помочь мне разобраться с ней(</p></td><td>2022-07-28T12:25:28.002Z</td></tr><tr><td>WyrmZ</td><td><p>Помогите разобраться - в lxc контейнере  на ubuntu 20.4 нет интернета (ping 8.8.8.8 не проходит) до тех пор, пока на основной виртуалке не ввести команду<br>
iptables -P FORWARD ACCEPT</p>
<p>Мало понимаю в правилах iptables.<br>
Но я так понимаю - это не совсем хорошая практика. Как правильно включить интернет на lxc?</p>
<p>Спасибо.</p>
<p>Вывод <strong>iptables -L -n -v</strong></p>
<pre><code class="lang-auto">Chain INPUT (policy ACCEPT 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination                                                                                        

Chain FORWARD (policy DROP 174 packets, 10508 bytes)
 pkts bytes target     prot opt in     out     source               destination                                                                                        
  174 10508 DOCKER-USER  all  --  *      *       0.0.0.0/0            0.0.0.0/0                                                                                        
  174 10508 DOCKER-ISOLATION-STAGE-1  all  --  *      *       0.0.0.0/0                                                                                                   0.0.0.0/0
    0     0 ACCEPT     all  --  *      docker0  0.0.0.0/0            0.0.0.0/0                                                                                                   ctstate RELATED,ESTABLISHED
    0     0 DOCKER     all  --  *      docker0  0.0.0.0/0            0.0.0.0/0                                                                                         
    0     0 ACCEPT     all  --  docker0 !docker0  0.0.0.0/0            0.0.0.0/0                                                                                       
    0     0 ACCEPT     all  --  docker0 docker0  0.0.0.0/0            0.0.0.0/0                                                                                        

Chain OUTPUT (policy ACCEPT 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination                                                                                        

Chain DOCKER (1 references)
 pkts bytes target     prot opt in     out     source               destination                                                                                        

Chain DOCKER-ISOLATION-STAGE-1 (1 references)
 pkts bytes target     prot opt in     out     source               destination                                                                                        
    0     0 DOCKER-ISOLATION-STAGE-2  all  --  docker0 !docker0  0.0.0.0/0                                                                                                   0.0.0.0/0
  174 10508 RETURN     all  --  *      *       0.0.0.0/0            0.0.0.0/0                                                                                          

Chain DOCKER-ISOLATION-STAGE-2 (1 references)
 pkts bytes target     prot opt in     out     source               destination                                                                                        
    0     0 DROP       all  --  *      docker0  0.0.0.0/0            0.0.0.0/0                                                                                         
    0     0 RETURN     all  --  *      *       0.0.0.0/0            0.0.0.0/0                                                                                          

Chain DOCKER-USER (1 references)
 pkts bytes target     prot opt in     out     source               destination                                                                                        
  174 10508 RETURN     all  --  *      *       0.0.0.0/0            0.0.0.0/0
</code></pre></td><td>2022-07-28T12:40:56.663Z</td></tr><tr><td>ValdikSS</td><td><aside class="quote no-group" data-username="Csalretepman" data-post="303" data-topic="129" data-full="true">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/c/f17d59/48.png" class="avatar"> Csalretepman:</div>
<blockquote>
<p>А есть в контейнере скрипт, для создания новых конфигов опенвпн, чтобы не юзать один и тот же? (Хочу иметь связанность между клиентами при помощи опенвпн с контейнера)</p>
</blockquote>
</aside>
<p>Такого скрипта нет, контейнер заточен под использование одного конфигурационного файла. Связность между клиентами можно настроить и с одним конфигурационным файлом, она заблокирована на уровне межсетевого экрана.</p></td><td>2022-07-30T13:33:09.596Z</td></tr><tr><td>ValdikSS</td><td><aside class="quote no-group" data-username="WyrmZ" data-post="305" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/w/e9bcb4/48.png" class="avatar"> WyrmZ:</div>
<blockquote>
<p>Помогите разобраться - в lxc контейнере на ubuntu 20.4 нет интернета</p>
</blockquote>
</aside>
<p>Проверьте правила NAT: <code>iptables -t nat -vnL</code>. Если там есть хоть какое-то упоминание LXD, то необходимо добавить разрешающее правило в таблицу filter FORWARD.<br>
Если же там нет упоминаний LXD, то, вероятно, у вас используется комбинация iptables-nft и iptables-legacy, либо же nft + iptables, что гарантированно вызовет проблемы с приоритетами правил. В таком случае нужно оставить что-то одно.</p></td><td>2022-07-30T13:35:29.390Z</td></tr><tr><td>WyrmZ</td><td><p>Спасибо!<br>
В итоге перешел на Debian 11 и проблема ушла сама. На убунту так и не удалось достичь стабильной работы.</p>
<p>Также на обоих дистрибутивах (Ubuntu 20.04 и Debian 11) возникает ошибка:</p>
<p>lxc image import <a href="https://antizapret.prostovpn.org/container-images/az-vpn" rel="noopener nofollow ugc">https://antizapret.prostovpn.org/container-images/az-vpn</a> --alias antizapret-vpn-img<br>
Error: Head “<a href="https://antizapret.prostovpn.org/container-images/az-vpn%E2%80%9D:" rel="noopener nofollow ugc">https://antizapret.prostovpn.org/container-images/az-vpn”:</a> remote error: tls: protocol version not supported</p>
<p>Как тут писали выше - решается отключением проверки сертификатов.</p>
<pre><code class="lang-auto">systemctl edit snap.lxd.daemon

Затем сразу ПОД строчкой (Важно!! Не в конец файла. Если добавить в конец файла, то изменения не сохранятся)
### Anything between here and the comment below will become the new contents of the file

добавляем это:
[Service]
Environment=LXD_INSECURE_TLS=true

Рестартим демона
systemctl reload snap.lxd.daemon
</code></pre>
<p>Я это к тому, что проблема действительно есть и как ее поправить без отключения проверки сертификата - не понятно.</p></td><td>2022-07-31T19:21:02.012Z</td></tr><tr><td>ValdikSS</td><td><p>A post was split to a new topic: <a href="/t/ip/2939">Списки заблокированных IP-адресов для роутера</a></p></td><td>2022-08-02T19:48:53.772Z</td></tr><tr><td>Resquer(Resquer)</td><td><p>По поводу настройки knot на вышестоящие dns серверы.<br>
Выяснилось, что публичные dns серверы google и cloudflare подменяют  IP адреса сервиса tmdb на 127.0.0.1, если запрос приходит из РФ.<br>
DoT и DoH - не помогают, это именно они подменяют, а не промежуточный провайдер с оборудованием от роскомпозора.</p>
<p>Также выяснилось, что публичные серверы от Quad9 такой фигнёй не страдают.<br>
Так что, кому актуально, в конфиг knot  нужно дописать вот это и всё будет хорошо:</p>
<pre><code class="lang-auto">policy.add(
   policy.all(
      policy.TLS_FORWARD({{'9.9.9.9@853', hostname='dns.quad9.net'}}),
      policy.TLS_FORWARD({{'149.112.112.112@853', hostname='dns.quad9.net'}})
   )
)
</code></pre></td><td>2022-08-04T15:25:51.830Z</td></tr><tr><td>ValdikSS</td><td><aside class="quote no-group" data-username="Resquer" data-post="310" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/resquer/48/1207_2.png" class="avatar"> Resquer:</div>
<blockquote>
<p>Выяснилось, что публичные dns серверы google и cloudflare подменяют IP адреса сервиса tmdb на 127.0.0.1, если запрос приходит из РФ.</p>
</blockquote>
</aside>
<p>DNS-резолверы Google и Cloudflare ничего не подменяют в ответах, это NS <code>www.themoviedb.org</code> отдаёт <code>127.0.0.1</code> для российских IP-адресов.</p>
<pre><code class="lang-auto">$ dig +short +subnet=155.70.44.0/24 www.themoviedb.org @ns-1186.awsdns-20.org # US Centurylink subnet
65.8.243.116
65.8.243.55
65.8.243.89
65.8.243.8

$ dig +short +subnet=87.226.162.0/24 www.themoviedb.org @ns-1186.awsdns-20.org # Russia Rostelecom subnet
127.0.0.1
</code></pre></td><td>2022-08-05T08:26:43.359Z</td></tr><tr><td>Resquer(Resquer)</td><td><aside class="quote no-group" data-username="ValdikSS" data-post="311" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/valdikss/48/2_2.png" class="avatar"> ValdikSS:</div>
<blockquote>
<p>DNS-резолверы Google и Cloudflare ничего не подменяют в ответах, это NS <code>www.themoviedb.org</code> отдаёт <code>127.0.0.1</code> для российских IP-адресов.</p>
</blockquote>
</aside>
<p>Да, я сегодня тоже к такому же выводу пришёл.<br>
пробовал dig с разных подсетей, с разных стран и удивлялся.<br>
А гугл с клаудфларом - у них же резолверы тоже в РФ имеются - по CDN их и цепляет.</p>
<p>В итоге развернул 2 персональных резолвера для себя на 2-х зарубежных vps, т.к.  не нравится мне такой подход…<br>
Quad9 тоже рано или поздно могут разместить сервер в РФ, и они отвалятся получается…</p></td><td>2022-08-05T12:24:26.454Z</td></tr><tr><td>cloud(Vadim)</td><td><p>Настроил контейнер на своей vps, подключился роутером, все отлично. Вопрос, как добавить сайт который не заблочен в РФ,соответственно его нет в списке заблокированных,  но владелец сайта блочит доступ с IP в РФ ?<br>
зашел в контейнер добавил домен <a href="http://intel.com" rel="noopener nofollow ugc">intel.com</a> в файл config\include-hosts-custom.txt<br>
запустил doall.sh<br>
Не помогло, судя по скриптам адрес добавленного домена сверяется со списком заблокированных доменов?</p></td><td>2022-08-13T16:52:07.832Z</td></tr><tr><td>ValdikSS</td><td><p>Ваши действия правильны. Вероятно, вы не дождались выполнения doall.sh.</p></td><td>2022-08-14T14:00:16.511Z</td></tr><tr><td>413xk</td><td><p><a class="mention" href="/u/valdikss">@ValdikSS</a> и знатоки.</p>
<p>Хочу обсудить такую идею.<br>
Вот, у нас получается есть два возможных вида подключения - tcp &amp; udp.<br>
tcp мы не трогаем, оставляем его “под мобилки с 3G”.</p>
<p>Что если, мы udp будем использовать под проводной интернет?</p>
<p>Выдвигаю на обсуждение следующие твики antizapret.conf</p>
<ol>
<li>Убираем <em>comp-lzo</em>
</li>
<li>
<em>txqueuelen</em> поднимаем с 250 до 2000</li>
<li>Добавляем<br>
<em>fast-io</em><br>
<em>sndbuf 512000</em><br>
<em>rcvbuf 512000</em><br>
<em>push “sndbuf 512000”</em><br>
<em>push “rcvbuf 512000”</em><br>
<em>ncp-disable</em>
</li>
</ol>
<p>на клиенте так же убираем <em>comp-lzo</em>.</p>
<p>Как в цифрах измерить изменения хз, субьективно стало быстрее.</p>
<p>Но, может я чушь порю, поэтому и предлагаю обсудить.</p></td><td>2022-08-15T04:51:53.623Z</td></tr><tr><td>fageoner</td><td><p><div class="lightbox-wrapper"><a class="lightbox" href="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/97f57825da681fd71081df6e109e6e08dc940270.png" data-download-href="https://ntc.party/uploads/default/97f57825da681fd71081df6e109e6e08dc940270" title="2022-08-15 15_29_58-VNC _ 17304_vm2302885"><img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/97f57825da681fd71081df6e109e6e08dc940270.png" alt="2022-08-15 15_29_58-VNC _ 17304_vm2302885" data-base62-sha1="lGi0QsnUsKQU2tZjN3RJJCLSJ20" width="690" height="346" data-dominant-color="121212"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">2022-08-15 15_29_58-VNC _ 17304_vm2302885</span><span class="informations">1023×513 5.27 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div><br>
Всем привет, а не подскажите - можно ли это как-то программно решить?<br>
vds на ubuntu 20.04, 512mb/5gb</p></td><td>2022-08-15T12:32:07.092Z</td></tr><tr><td>cloud(Vadim)</td><td><p><a class="mention" href="/u/fageoner">@fageoner</a>  в системных требованиях сказано, что нужен 1гиг RAM, у вас 512m</p>
<p><a class="mention" href="/u/valdikss">@ValdikSS</a> Добавил вчера еще один сайт (goplay.tools), он стал открывать, а <a href="http://intel.com" rel="noopener nofollow ugc">intel.com</a> по прежнему не открывается, перенаправляет на страницу <a href="https://www.intel.com/content/www/us/en/support/ru-banner-inside.html" class="inline-onebox" rel="noopener nofollow ugc">Communications</a><br>
Как на компе проверить что запрос правильно идет и резолвится через vpn ?</p></td><td>2022-08-15T13:48:18.675Z</td></tr><tr><td>fageoner</td><td><p><a class="mention" href="/u/cloud">@cloud</a>, в требованиях немного меньше 1 гб - цитата с bitbucket:</p>
<blockquote>
<p>минимум 384 МБ оперативной памяти</p>
</blockquote></td><td>2022-08-15T16:27:20.102Z</td></tr><tr><td>surpriz</td><td><p>nslookup <a href="http://intel.com" rel="noopener nofollow ugc">intel.com</a> что выдает?</p></td><td>2022-08-15T17:43:51.932Z</td></tr><tr><td>cloud(Vadim)</td><td><p>выдает</p>
<p>╚ь :     <a href="http://intel.com" rel="noopener nofollow ugc">intel.com</a><br>
Address:  10.224.0.113</p>
<p>как и другой сайт, добавление которого в список помогает, только с <a href="http://intel.com" rel="noopener nofollow ugc">intel.com</a> беда</p>
<p>╚ь :     <a href="http://keepsolid.com" rel="noopener nofollow ugc">keepsolid.com</a><br>
Addresses:  10.224.0.110<br>
10.224.0.111<br>
10.224.0.112</p></td><td>2022-08-15T19:08:45.602Z</td></tr><tr><td>surpriz</td><td><p>Настроенно все верно. Вообще если переходить именно на рускоязычную версию сайта, то будет плажка. Попробуйте перейти на американскую <a href="https://www.intel.com/content/www/us/en/homepage.html" class="inline-onebox" rel="noopener nofollow ugc">Intel | Data Center Solutions, IoT, and PC Innovation</a> будет у вас открываться?</p></td><td>2022-08-15T19:43:28.785Z</td></tr><tr><td>cloud(Vadim)</td><td><p>Я на русскоязычную разве перехожу? При переходе по вашей ссылке также переадресует на ту же страницу ru-banner-inside</p></td><td>2022-08-15T19:56:51.419Z</td></tr><tr><td>drfischer</td><td><p>Тоже с этим столкнулся. Настроен и антизапрет на своем vps в Нидерландах и отдельно для wireguard конфиг есть, но при попытке открыть <a href="http://Intel.com" rel="noopener nofollow ugc">Intel.com</a>, <a href="http://intellicast.com" rel="noopener nofollow ugc">intellicast.com</a>, <a href="http://Netflix.com" rel="noopener nofollow ugc">Netflix.com</a> почему-то сайты эти не открываются.<br>
upd в include-hosts-custom.txt сайты добавлены</p></td><td>2022-08-15T21:49:01.274Z</td></tr><tr><td>ValdikSS</td><td><p>Зайдите на страницу непосредственно с VPS. У вас либо проблема в браузерном кеше, либо в IP-адресе VPS.</p></td><td>2022-08-16T08:37:42.422Z</td></tr><tr><td>cloud(Vadim)</td><td><p>непосредственно с vps   curl <a href="http://netflix.com" rel="noopener nofollow ugc">netflix.com</a>  также показывает “Not Available”. Выходит IP vps-ки также забанен, других вариантов нет?</p></td><td>2022-08-17T06:10:00.695Z</td></tr><tr><td>surpriz</td><td><p>Похоже на то, а какое гео ip впски?<br>
Что выдаст команда <code>curl ipinfo.io</code> ?</p></td><td>2022-08-17T07:54:49.647Z</td></tr><tr><td>cloud(Vadim)</td><td><p><code>curl ipinfo.io</code> выдает</p>
<p>“city”: “Amsterdam”,<br>
“region”: “North Holland”,<br>
“country”: “NL”,<br>
“loc”: “52.3740,4.8897”,<br>
“org”: “AS207651 Hosting technology LTD”,<br>
“postal”: “1012”,<br>
“timezone”: “Europe/Amsterdam”,<br>
“readme”: “<a href="https://ipinfo.io/missingauth" class="inline-onebox" rel="noopener nofollow ugc">Get the full potential of IPinfo - IPinfo.io</a>”</p>
<p>у кого curl <a href="http://netflix.com" rel="noopener nofollow ugc">netflix.com</a>  проходит, скиньте где vps брали с беспроблемной оплатой в РФ.</p></td><td>2022-08-19T16:24:45.103Z</td></tr><tr><td>surpriz</td><td><aside class="quote no-group" data-username="cloud" data-post="327" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/cloud/48/1708_2.png" class="avatar"> cloud:</div>
<blockquote>
<p>AS207651</p>
</blockquote>
</aside>
<p>Собственно, это и ответ на ваш вопрос, данная AS - AS207651 российскому провайдеру, в гео RU</p><aside class="onebox allowlistedgeneric" data-onebox-src="https://bgp.he.net/AS207651#_whois">
  <header class="source">

      <a href="https://bgp.he.net/AS207651#_whois" target="_blank" rel="noopener nofollow ugc">bgp.he.net</a>
  </header>

  <article class="onebox-body">
    

<h3><a href="https://bgp.he.net/AS207651#_whois" target="_blank" rel="noopener nofollow ugc">AS207651 Hosting technology LTD - bgp.he.net</a></h3>

  <p>AS207651 Hosting technology LTD Network Information</p>


  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>
</td><td>2022-08-19T17:50:44.447Z</td></tr><tr><td>ValdikSS</td><td><aside class="quote no-group" data-username="fageoner" data-post="316" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/fageoner/48/1628_2.png" class="avatar"> fageoner:</div>
<blockquote>
<p>Всем привет, а не подскажите - можно ли это как-то программно решить?</p>
</blockquote>
</aside>
<p>Как вариант — добавить swap, оптимальнее всего — в виде zram.</p>
<pre><code class="lang-auto">apt install zram-tools
</code></pre>
<p>Затем поправить <code>/etc/default/zramswap</code>, увеличив значение в процентах до 70, и <code>systemctl restart zramswap</code>.</p></td><td>2022-08-20T14:15:36.002Z</td></tr><tr><td>fageoner</td><td><p>Спасибо! Вроде помогло)</p></td><td>2022-08-22T06:38:31.399Z</td></tr><tr><td>xDealer</td><td><p>Помогите решить проблему с доступом на сайт <a href="http://meta.com" rel="noopener nofollow ugc">meta.com</a>, имеется шлем VR, который необходимо привязать к аккаунту META, установлен собственный сервер с помощью LXD, всё работает хорошо, но вот сайт <a href="http://meta.com" rel="noopener nofollow ugc">meta.com</a> никак не хочет открываться, подскажите куда копать. Заранее спасибо.</p></td><td>2022-08-26T22:04:16.628Z</td></tr><tr><td>xDealer</td><td><p>Вопрос решился после добавления домена в include-hosts-custom.txt, правда пришлось подождать некоторое время, чтобы он начал пропускать.</p></td><td>2022-08-28T15:35:32.688Z</td></tr><tr><td>Numstar</td><td><p>Добрый день, есть ли возможность как нибудь использовать днс резолвер как сервер, а не тунельный с блокировкой днс компьютера? Но при этом чтобы впн так же работал только на заблокированных сайтах. из-за этого windows постоянно говорит что нет сети, хотя она есть. Это на работоспособность в основном не влияет, но раздражает немного, особенно когда приложения доверяют винде в определении доступности интернета.</p></td><td>2022-09-01T11:19:07.263Z</td></tr><tr><td>413xk</td><td><p>Коллеги, как диагностировать такое поведение:</p>
<ol>
<li>Ночью пропал интернет на VPS на полчаса.</li>
<li>С утра проснулся, смотрю - был даунтайм. Лезу проверять сайты - работают частично (например инстач пашет, твиттер-тижорнал не пашет, пишет Could not resolve DNS, пинги и в правду не резолвят имя).</li>
<li>Начал смотреть клиентскую часть - по перетыкал соединение, по перезагружал роутер. Не помогло.</li>
<li>Подключился с OpenVPN клиента с телефона через 4G / tcp - тоже сайты открываются частично. То есть, проблема не на клиенте, а на сервере.</li>
</ol>
<p>Смотрю на сервер, там с аптаймом все в порядке, curl / telnet по запрещенным ресурсам без проблем ходит. Перезагрузил виртуалку, всё заработало.</p>
<p>Может ли быть, что kresd как то отваливается из-за долгого отсутствия интернета? Как добиться его (кресда) стабильной работы?</p></td><td>2022-09-03T02:47:10.732Z</td></tr><tr><td>ArchimedRT(Ruslan Arkhipov)</td><td><p>Перестал отдаваться контент гугл-фото ( <a href="http://lh3.googleusercontent.com" rel="noopener nofollow ugc">lh3.googleusercontent.com</a> )<br>
Прописал домен в include-hosts-custom.txt, но, видимо, блокируется как-то по-другому.</p>
<pre><code class="lang-auto">PS C:\Users\ArchimedRT&gt; tracert lh3.googleusercontent.com

Трассировка маршрута к googlehosted.l.googleusercontent.com [142.250.185.65]
с максимальным числом прыжков 30:

  1     4 ms     1 ms     1 ms  MI-R3G [192.168.1.1]
  2     1 ms     1 ms     1 ms  10.16.255.135
  3     1 ms     1 ms     1 ms  10.16.248.225
  4     3 ms     3 ms     3 ms  10.16.248.218
  5     *        *        *     Превышен интервал ожидания для запроса.
  6     3 ms     3 ms     3 ms  10.16.248.253
  7    53 ms    53 ms    54 ms  ae10-493.rt.itp.kzn.ru.retn.net [87.245.231.206]
  8    60 ms    61 ms    65 ms  ae5-9.rt.sl.spb.ru.retn.net [87.245.233.13]
  9    26 ms    27 ms    26 ms  gw-google.retn.net [87.245.228.199]
 10    26 ms    26 ms    27 ms  74.125.244.132
 11    39 ms    31 ms    30 ms  142.251.61.219
 12    32 ms    32 ms    32 ms  72.14.232.87
 13     *       64 ms    63 ms  142.251.239.32
 14    66 ms    63 ms    62 ms  209.85.245.31
 15    61 ms    59 ms    60 ms  108.170.251.193
 16    63 ms    62 ms    62 ms  142.250.62.151
 17    61 ms    61 ms    60 ms  fra16s48-in-f1.1e100.net [142.250.185.65]

Трассировка завершена.
</code></pre>
<p>Как понять, где проблема, и как ее исправить?</p></td><td>2022-09-03T17:15:41.345Z</td></tr><tr><td>ValdikSS</td><td><aside class="quote no-group" data-username="413xk" data-post="334" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/4/ee59a6/48.png" class="avatar"> 413xk:</div>
<blockquote>
<p>Может ли быть, что kresd как то отваливается из-за долгого отсутствия интернета? Как добиться его (кресда) стабильной работы?</p>
</blockquote>
</aside>
<p>Такое может быть, попробуйте очистить кеш резолвера:<br>
<code>echo "cache.clear()" | socat - /run/knot-resolver/control/1</code></p>
<p>В контейнере версия kresd старая, но насколько помню, версии новее требовали перенастройки для корректной работы со stub-резолвером, перезаписывающим адреса, коим является репамминг-резолвер, так что лучше его не обновлять.<br>
В свободное время соберу обновлённую версию контейнера, где такой проблемы, надеюсь, не будет.</p></td><td>2022-09-04T00:52:33.090Z</td></tr><tr><td>ValdikSS</td><td><aside class="quote no-group" data-username="ArchimedRT" data-post="335" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/archimedrt/48/1356_2.png" class="avatar"> ArchimedRT:</div>
<blockquote>
<p>Как понять, где проблема, и как ее исправить?</p>
</blockquote>
</aside>
<p>Удалите домен googleusercontent из <code>config/exclude-hosts-dist.txt</code>.<br>
Когда скрипты АнтиЗапрета создавались, они резолвили IP-адреса заблокированных доменов и добавляли IP’шники в список. На тот момент были вредоносные домены, устанавливающие себе IP-адреса легитимных, поэтому был создан такой список. С тех пор многое изменилось, а список остался. В то время не предполагалось, что такие крупные домены могут блокироваться гос. структурой.</p></td><td>2022-09-04T00:55:26.406Z</td></tr><tr><td>413xk</td><td><aside class="quote no-group" data-username="ValdikSS" data-post="336" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/valdikss/48/2_2.png" class="avatar"> ValdikSS:</div>
<blockquote>
<p>В контейнере версия kresd старая, но насколько помню, версии новее требовали перенастройки для корректной работы со stub-резолвером, перезаписывающим адреса, коим является репамминг-резолвер, так что лучше его не обновлять.</p>
</blockquote>
</aside>
<p>Кстати, описаная мной проблема если что есть и на старой (из коробки версии антизапрета), так и на новой.</p>
<p>Под новой я вот что понимаю:<br>
внутри LXC контейнера прописал свежие ключи и запустил apt update &amp;&amp; apt-upgrade.<br>
В итоге, сейчас у меня kresd 5.5.2, всё работает, но вот такая канитель случается.</p>
<p>Спасибо за очистку кэша, как-нить выцеплю и попробую полечить (а может есть даже смысл в крон прописать, нехай он каждую ночь чистит)</p></td><td>2022-09-04T05:23:44.722Z</td></tr><tr><td>ArchimedRT(Ruslan Arkhipov)</td><td><p>Не помогло.<br>
А вот когда подключаюсь через альтернативный конфиг (пуск всего трафика по <a href="https://ntc.party/t/vpn-vpn/2040/2">инструкции</a>), то все работает корректно.</p></td><td>2022-09-04T17:45:14.264Z</td></tr><tr><td>ValdikSS</td><td><p>Вероятно, вы забыли обновить лист после редактирования файла исключений, либо же googleusercontent еще где-то присутствует в качестве исключения.</p></td><td>2022-09-05T19:42:58.792Z</td></tr><tr><td>413xk</td><td><aside class="quote no-group" data-username="ArchimedRT" data-post="339" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/archimedrt/48/1356_2.png" class="avatar"> ArchimedRT:</div>
<blockquote>
<p>Не помогло.</p>
</blockquote>
</aside>
<p>Присоединяюсь, тоже не грузят гуглфото и аватарки в гуглтаблицах.</p>
<p>Удаление <a href="http://googleusercontent.com" rel="noopener nofollow ugc">googleusercontent.com</a> из exclude-hosts-dist.txt и добавление в include-hosts-custom.txt (после этого естественно был выполнен doall, сброшен кэш кнота и выждано время) - не помогло.<br>
Симптомы - пинги до *.googleusercontent.com не заворачиваются в тоннель (а идут через интернет как у Архимеда).</p>
<p>но в exclude-regexp-dist.awk был обнаружен еще <em>(/googleusercontent.com/) {next}</em>.<br>
и вот удаление его вопросики порешало, то есть итого:</p>
<ol>
<li>Удаляем строку гуглюзерконтент из exclude-hosts-dist.txt;</li>
<li>Добавляем строку в include-hosts-custom.txt;</li>
<li>Удаляем строку из exclude-regexp-dist.awk<br>
Затем doall, и погнали <img src="https://ntc.party/images/emoji/twitter/sunglasses.png?v=12" title=":sunglasses:" class="emoji" alt=":sunglasses:" loading="lazy" width="20" height="20"></li>
</ol></td><td>2022-09-06T05:08:37.785Z</td></tr><tr><td>ArchimedRT(Ruslan Arkhipov)</td><td><p>Я пробовал удалять и из файла exclude-regexp-dist.awk, но после этого у меня даже пинг до <a href="http://lh3.googleusercontent.com" rel="noopener nofollow ugc">lh3.googleusercontent.com</a> не идет.<br>
Причем, с альтернативным конфигом с пуском всего трафика тоже перестает открываться</p></td><td>2022-09-06T19:18:58.519Z</td></tr><tr><td>ValdikSS</td><td><p>Убедитесь, что после изменения не забыли запустить doall, а также очистите кеш knot-resolver (если домен резолвится в настоящий IP-адрес, а не в 10.224.x.x, то дело в кеше либо knot, либо ОС).</p></td><td>2022-09-06T19:57:08.333Z</td></tr><tr><td>413xk</td><td><aside class="quote no-group" data-username="ArchimedRT" data-post="342" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/archimedrt/48/1356_2.png" class="avatar"> ArchimedRT:</div>
<blockquote>
<p>Я пробовал удалять и из файла exclude-regexp-dist.awk, но после этого у меня даже пинг до <a href="http://lh3.googleusercontent.com" rel="noopener nofollow ugc">lh3.googleusercontent.com</a> не идет.</p>
</blockquote>
</aside>
<p>может вы прям <a href="http://lh3.googleusercontent.com" rel="noopener nofollow ugc">lh3.googleusercontent.com</a> добавляете в include-hosts-custom.txt?<br>
я все фигачил без сабдомена (ведь они меняются).</p>
<p>То есть, еще раз:</p>
<ol>
<li>exclude-hosts-dist.txt - удаляем <a href="http://googleusercontent.com" rel="noopener nofollow ugc">googleusercontent.com</a>;</li>
<li>include-hosts-custom.txt - добавляем <a href="http://googleusercontent.com" rel="noopener nofollow ugc">googleusercontent.com</a>;</li>
<li>exclude-exclude-regexp-dist.awk - удаляем <em>(/googleusercontent.com/) {next}</em></li>
<li>Дальше <em>LANG=C.UTF-8 /root/antizapret/doall.sh</em> и <em>echo “cache.clear()” | socat - /run/knot-resolver/control/1</em><br>
И пинговать <a href="http://lh3.googleusercontent.com" rel="noopener nofollow ugc">lh3.googleusercontent.com</a> с компьютера-клиента, должен резольвиться 10.224.х.х. Если резольвится и пинги идут, то всё огонь.</li>
</ol></td><td>2022-09-07T03:15:36.778Z</td></tr><tr><td>ArchimedRT(Ruslan Arkhipov)</td><td><p>Да все так и делал, и, наконец, после очередной попытки завелось.<br>
Не знаю, что это было, возможно, помогла перезагрузка всех узлов сервер/роутер/комп. Хотя обычно правки применялись без таких заморочек</p></td><td>2022-09-08T18:36:59.528Z</td></tr><tr><td>mafiacheb(Александр)</td><td><p>Скажите пожалуйста как заставить работать <a href="http://photos.google.com" rel="noopener nofollow ugc">photos.google.com</a> ?<br>
в список include-hosts-custom.txt добавил, на телефоне приложение начало показывать фото и видео, но в веб версии на компьютере по прежнему нет<br>
может еще какие то адреса нужно добавить?</p></td><td>2022-09-14T10:25:47.469Z</td></tr><tr><td>413xk</td><td><aside class="quote no-group" data-username="mafiacheb" data-post="346" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/m/aca169/48.png" class="avatar"> mafiacheb:</div>
<blockquote>
<p>Скажите пожалуйста как заставить работать <a href="http://photos.google.com" rel="noopener nofollow ugc">photos.google.com</a> ?</p>
</blockquote>
</aside>
<p>мы тут 11 дней это обсуждаем, проскрольте вверх.</p></td><td>2022-09-14T14:42:39.860Z</td></tr><tr><td>mafiacheb(Александр)</td><td><p>я в точности проделал все что вы написали в комментарии, но что то у меня в веб версии не показывает картинки все равно. у вас работает?</p></td><td>2022-09-14T15:21:52.973Z</td></tr><tr><td>413xk</td><td><p>у меня рабоатет. Подождите какое-то время, возможно закэшировалось на компе/роутере.</p>
<p>я бы на компе с виндой уже сделал ipconfig /flushdns, перегрузился бы и иконгнито чекнул гугл-фото.<br>
(ну и пинг <a href="http://lh3.googleusercontent.com" rel="noopener nofollow ugc">lh3.googleusercontent.com</a> само собой)</p></td><td>2022-09-14T15:30:13.724Z</td></tr><tr><td>Alexled(alex)</td><td><p>Проблема правда есть, помогите пожалуйста разобраться:</p>
<ol>
<li>На MacOS и iOS все отлично – сразу же заработало и стало грузить фото и домен <a href="http://lh3.googleusercontent.com" rel="noopener nofollow ugc">lh3.googleusercontent.com</a> резольвится с 10.224</li>
<li>На Windows и Android не работает вообще, при попытке пингануть “При проверке связи не удалось обнаружить узел <a href="http://lh3.googleusercontent.com" rel="noopener nofollow ugc">lh3.googleusercontent.com</a>”</li>
</ol>
<p>Перезагружал и ПК, и роутер, и VPN, и сервер)</p></td><td>2022-09-15T12:00:48.000Z</td></tr><tr><td>413xk</td><td><p>Вестимо дело в кэше конкретных устройств.</p>
<p>Подождите часик.</p></td><td>2022-09-15T12:10:57.648Z</td></tr><tr><td>Alexled(alex)</td><td><p>Что удивительно, все также, даже на компьютере без кэша<br>
А на MacOS и iOS все работает на нескольких разных устройствах</p>
<p>Домен не пингуется с VPN, сразу выдается ошибка “При проверке связи не удалось обнаружить узел <a href="http://lh3.googleusercontent.com/" rel="noopener nofollow ugc">lh3.googleusercontent.com</a>”</p></td><td>2022-09-15T13:13:52.229Z</td></tr><tr><td>kirill</td><td><p>то же самое на win desktop</p></td><td>2022-09-15T13:30:19.220Z</td></tr><tr><td>413xk</td><td><aside class="quote no-group" data-username="Alexled" data-post="352" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/a/e95f7d/48.png" class="avatar"> Alexled:</div>
<blockquote>
<p>сразу выдается</p>
</blockquote>
</aside>
<p>Ну дак чекайте шаг за шагом.<br>
Раз винда не пингует, а с соседних устройств при подключении к тому же роутеру все ок, то дело в винде.<br>
Флушайте днс, проверяйте днс серверы (что бы не было публичных внешних днс), попробуйте принудительно выдать компу с виндой другой айпишник в локальной сети (если антизапрет на роутере).</p></td><td>2022-09-15T13:33:37.778Z</td></tr><tr><td>kirill</td><td><p>так а чего там чекать-то?<br>
правки внесены,<br>
сервер перезагружен,<br>
десктоп перезагружен</p>
<p>PS C:\Users\pc&gt; nslookup <a href="http://lh3.googleusercontent.com" rel="noopener nofollow ugc">lh3.googleusercontent.com</a><br>
╤хЁтхЁ:  UnKnown<br>
Address:  192.168.1.1</p>
<p>Не заслуживающий доверия ответ:<br>
Не заслуживающий доверия ответ:<br>
╚ь :     <a href="http://lh3.googleusercontent.com" rel="noopener nofollow ugc">lh3.googleusercontent.com</a></p>
<p>фсё</p>
<p>остальные правки по нетфликсу,<br>
гугломаркету,<br>
и проч…<br>
прекрасно заводились с полпинка,</p>
<p>метод где-то недоделанный</p></td><td>2022-09-15T13:38:24.235Z</td></tr><tr><td>kirill</td><td><p>хе-хе,</p>
<p>а вот</p>
<p>PS C:\Users\pc&gt; nslookup <a href="http://lh4.googleusercontent.com" rel="noopener nofollow ugc">lh4.googleusercontent.com</a><br>
╤хЁтхЁ:  UnKnown<br>
Address:  192.168.1.1</p>
<p>Не заслуживающий доверия ответ:<br>
╚ь :     <a href="http://googlehosted.l.googleusercontent.com" rel="noopener nofollow ugc">googlehosted.l.googleusercontent.com</a><br>
Address:  10.224.0.3<br>
Aliases:  <a href="http://lh4.googleusercontent.com" rel="noopener nofollow ugc">lh4.googleusercontent.com</a></p>
<p>прогружается</p></td><td>2022-09-15T13:44:04.753Z</td></tr><tr><td>413xk</td><td><p>о чем я и говорю - дело в кэше.<br>
у вас кинетик? выдайте принудительно конечному устройству другой айпишник, что бы кинетик (или любой другой роутер) сбросил привязку конечное устройство &lt;&gt; узел назначения. Можете на компе вбить статикой какой-нибудь рандомный ип из 192.168.1.х и чекнуть.</p></td><td>2022-09-15T13:46:32.198Z</td></tr><tr><td>kirill</td><td><p>кстати, линуксоиды,<br>
как сделать правильно команду<br>
lxc exec antizapret-vpn – <em>“<em>echo “cache.clear()” | socat - /run/knot-resolver/control/1</em>”</em></p>
<p>если делать так – ругается на кавычки</p></td><td>2022-09-15T13:49:19.773Z</td></tr><tr><td>kirill</td><td><p>хз,<br>
при чём здесь кэш именно в этом случае,<br>
раньше роутер у меня больше месяца иногда работал, ничё с ним не делал,<br>
только правки на сервер вносил,<br>
для гарантии сервер рестартил и комп – хватало всегда</p>
<p>но спорить не буду</p></td><td>2022-09-15T13:51:33.112Z</td></tr><tr><td>413xk</td><td><p>Смена айпишника внутри сети помогла?</p></td><td>2022-09-15T14:12:36.845Z</td></tr><tr><td>Alexled(alex)</td><td><p>Мне - нет<br>
VPN приложение на ПК, роутер не поддерживает</p></td><td>2022-09-15T14:17:24.032Z</td></tr><tr><td>413xk</td><td><aside class="quote no-group" data-username="kirill" data-post="358" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/k/a9a28c/48.png" class="avatar"> kirill:</div>
<blockquote>
<p>lxc exec antizapret-vpn – <em>“<em>echo “cache.clear()” | socat - /run/knot-resolver/control/1</em>”</em></p>
</blockquote>
</aside>
<p>перед кавычками около кэш.клира поставить бэкслеши \ <code>( \"cache.clear()\" )</code></p></td><td>2022-09-15T15:45:31.303Z</td></tr><tr><td>413xk</td><td><aside class="quote no-group" data-username="Alexled" data-post="361" data-topic="129" data-full="true">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/a/e95f7d/48.png" class="avatar"> Alexled:</div>
<blockquote>
<p>Мне - нет<br>
VPN приложение на ПК, роутер не поддерживает</p>
</blockquote>
</aside>
<p>обычно, в такие моменты когда все настроено корректно (а у вас настроено верно, т.к с мака проблем нет) - я обычно забиваю на вопрос до завтра, и с утра всё работает. ))</p>
<p>Хз короче что делать, если перезагрузка всего не помогла. Только имхо ждать</p></td><td>2022-09-15T15:48:02.651Z</td></tr><tr><td>413xk</td><td><p><a class="mention" href="/u/valdikss">@ValdikSS</a> я в курсе, что ipv6 вырезан в контейнере… Может есть какой-то способ включить его? Понятно, что на свой страх и риск, но все же… Потестить бы интересно было.</p></td><td>2022-09-15T18:00:55.382Z</td></tr><tr><td>Alexled(alex)</td><td><p>Подтверждаю, на всех устройствах с Windows заработало спустя сутки<br>
Видимо на них есть какой-то кэш, который не сбрасывается ни с ребутом, ни с ipconfig /flushdns</p></td><td>2022-09-16T10:43:48.051Z</td></tr><tr><td>kirill</td><td><p>а сюда<br>
lxc exec antizapret-vpn – nano /root/antizapret/scripts/getzones.awk<br>
…appspot|my1|hwcdn|googleusercontent).[^.]+$/))<br>
не надо было добавлять?<br>
спрашиваю потому, что не разбираюсь во внутренней логике</p></td><td>2022-09-16T12:59:00.663Z</td></tr><tr><td>413xk</td><td><p>нет.<br>
Пользуйтесь <code>lxc exec antizapret-vpn -- /bin/bash</code>, удобней же.</p></td><td>2022-09-16T17:18:08.114Z</td></tr><tr><td>h7n14(H7n14je)</td><td><p>Доброго времени суток! В связи с тем что на впске и так много чего у меня крутится, и того мало свободных ресурсов на нем. Сработает ли такая схема. Дома ставлю сервак, протягиваю тунель до впски(Wireguard, Zerotier или какойнить ipsec), и весь его трафик кидаю туда. И если оно так сработает, мб получиться тогда завести контейнер под rpi3?</p></td><td>2022-09-18T17:11:56.430Z</td></tr><tr><td>h7n14(H7n14je)</td><td><p>Как ни странно схема сработала. Только в ovpn файле поменять айпишник на локальный надо. Думаю можно любой платный/безплатный впн под это дело включить. Осталось все это дело под малинкой запустить</p></td><td>2022-09-19T09:23:05.894Z</td></tr><tr><td>Resquer(Resquer)</td><td><p>Да, сработает. У меня так настроено.<br>
wg туннель из контейнера на удалённую vps всего трафика, в исключение нужно поставить ip адрес vps.<br>
Калькулятор AllowedIP для wireguard легко гуглится</p></td><td>2022-09-22T16:35:08.935Z</td></tr><tr><td>ryogis(Sergey)</td><td><p>Привет. Использую контейнер АнтиЗапрета на сервере Oracle Cloud. Подключение настроено на роутере. В пятницу заметил, что при поднятом VPN не резолвится <a href="http://citilink.ru" rel="noopener nofollow ugc">citilink.ru</a>. На всякий случай переустановил контейнер. Из контейнера <a href="http://citilink.ru" rel="noopener nofollow ugc">citilink.ru</a> нормально резолвится, а вот с хоста Oracle Cloud почему-то нет.<br>
ubuntu@instance:~$ nslookup <a href="http://citilink.ru" rel="noopener nofollow ugc">citilink.ru</a><br>
Server:         127.0.0.53<br>
Address:        127.0.0.53#53</p>
<p>** server can’t find <a href="http://citilink.ru" rel="noopener nofollow ugc">citilink.ru</a>: SERVFAIL<br>
Странная ситуация, но насколько я понимаю, проблемы хоста не должны мешать, или я не прав?<br>
Пробовал добавить <a href="http://citilink.ru" rel="noopener nofollow ugc">citilink.ru</a> в exclude-hosts-custom.txt (запускал doall, очищал кэш) не помогло. Есть идеи почему такая проблем возникла и как с ней побороться?</p></td><td>2022-09-26T19:28:42.096Z</td></tr><tr><td>ValdikSS</td><td><p>Вероятно, NS-серверы домена заблокировали сетевой доступ для IP-адреса вашего сервера.<br>
Можно настроить резолв конкретно этого домена через публичный DNS-резолвер. Добавьте в конец конфигурационного файла <code>/etc/knot-resolver/kresd.conf</code>:</p>
<pre><code class="lang-auto">policy.add(
    policy.suffix(
        policy.FORWARD(
            {'77.88.8.8'}
        ),
        policy.todnames({'citilink.ru.'})
    )
)
</code></pre></td><td>2022-09-27T04:44:31.094Z</td></tr><tr><td>413xk</td><td><aside class="quote no-group quote-modified" data-username="ValdikSS" data-post="336" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/valdikss/48/2_2.png" class="avatar"> ValdikSS:</div>
<blockquote>
<aside class="quote no-group" data-username="413xk" data-post="334" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/4/ee59a6/48.png" class="avatar"> 413xk:</div>
<blockquote>
<p>Может ли быть, что kresd как то отваливается из-за долгого отсутствия интернета? Как добиться его (кресда) стабильной работы?</p>
</blockquote>
</aside>
<p>Такое может быть, попробуйте очистить кеш резолвера:</p>
</blockquote>
</aside>
<p>Этой ночью опять отпадал провайдер VPS на десять минут, и опять с утра когда я полез проверять обнаружил следующее:<br>
0. Отпадала именно сеть на VPS, аптайм ништяк.</p>
<ol>
<li>OpenVPN-соединение восстановилось без проблем и сразу как появился инет.</li>
<li>“Легальные” сайты грузились и резольвились так же ок.</li>
<li>А вот все что заворачивается внутрь контейнера не работали. Клиенты просто получали Could not resolve <a href="http://www.instagram.com" rel="noopener nofollow ugc">www.instagram.com</a></li>
</ol>
<p>Очистка кэша не помогла. На всякий случай пересоединил OpenVPN и тоже не помогло. Помогла перезагрузка VPS.</p>
<p>Всё это странно (странно, что условный <a href="http://ya.ru" rel="noopener nofollow ugc">ya.ru</a> продолжает резольвиться нормально, а запрещенка нет. У нас же все DNS-запросы идут через kresd. И вот он, легальное пропускает, а нелегальное даже не резольвит до ребута…</p>
<p>Может я путаю конечно, и на самом деле DNS запросы шли через условные 1.0.0.1 (который прописан в антизапрете у меня), но фиг знает.<br>
В любом случае, как бы это всё  покрасивее исправить? Что бы не топорный ребут “раз в сутки/по потере сети”, а как-нибудь элегантнее бы…</p></td><td>2022-10-04T06:53:13.130Z</td></tr><tr><td>ValdikSS</td><td><p>Возможно, dnsmap-сервер перестаёт отвечать.<br>
В следующий раз, когда пропадёт интернет на сервере, запустите:<br>
<code>dig ya.ru @127.0.0.4</code>.</p></td><td>2022-10-05T05:00:07.518Z</td></tr><tr><td>m28688(m286)</td><td><p><a class="mention" href="/u/valdikss">@ValdikSS</a><br>
Добрый день, подскажите как устранить утечку dns внутри контейнера антизапрета?</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/02787b958b9dde0def66b249169ddcc742feaf19.png" data-download-href="https://ntc.party/uploads/default/02787b958b9dde0def66b249169ddcc742feaf19" title="Снимок экрана 2022-10-07 в 15.50.01"><img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/02787b958b9dde0def66b249169ddcc742feaf19_2_690x293.png" alt="Снимок экрана 2022-10-07 в 15.50.01" data-base62-sha1="lR5srgeVno59Z649cyw78hAxRf" width="690" height="293" srcset="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/02787b958b9dde0def66b249169ddcc742feaf19_2_690x293.png, контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/02787b958b9dde0def66b249169ddcc742feaf19_2_1035x439.png 1.5x, контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/02787b958b9dde0def66b249169ddcc742feaf19_2_1380x586.png 2x" data-dominant-color="F6F6F8"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">Снимок экрана 2022-10-07 в 15.50.01</span><span class="informations">1562×664 38.8 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p></td><td>2022-10-07T12:51:51.317Z</td></tr><tr><td>ValdikSS</td><td><p>Утечки DNS нет, это IP-адрес вашего сервера.</p></td><td>2022-10-07T13:49:30.000Z</td></tr><tr><td>wolfxr</td><td><p>Удалено</p></td><td>2022-10-10T14:45:56.463Z</td></tr><tr><td>faligor</td><td><p>Прошу прощения, если вопрос глупый и/или уже явно задавался, но подскажите, работает ли контейнер на arm архитектуре?</p></td><td>2022-10-10T16:42:40.937Z</td></tr><tr><td>mvrvntn(Mvrvntn)</td><td><p>Тоже интересно.<br>
Хочу развернуть на Armbian. Был ли у кого опыт?<br>
Сам не имею опыта, настроил PiVPN и хотел бы дополнительно использовать “Антизапрет” для использования на своем VPN.</p>
<p>Спасибо!</p></td><td>2022-10-12T00:43:01.309Z</td></tr><tr><td>ValdikSS</td><td><p><a class="mention" href="/u/faligor">@faligor</a>, <a class="mention" href="/u/mvrvntn">@mvrvntn</a>, код должен работать на ARM, но готовый образ контейнера не собирался под эту архитектуру. Можете попробовать собрать его самостоятельно.</p></td><td>2022-10-12T08:02:05.318Z</td></tr><tr><td>Sblack</td><td><p>айфон и андроид openvpn - инстаграм не может загрузить часть постов и видео<br>
они не открываются по ссылке, а в ленте профиля вообще отсутствуют<br>
если подключить любой бесплатный впн, то проблема пропадает</p>
<ul>
<li>
<p>я пробовал делать  2 сервера на разных впс на разных локациях (hetzner)<br>
один сервер LXD и второй systemd-machined, не помогает</p>
</li>
<li>
<p>я настроил outline vpn на том же хостинге и локации и через него все посты видно</p>
</li>
<li>
<p>я пробовал добавлять вручную в include hosts custom</p>
</li>
<li>
<p>проблема не только в приложении инстаграм но и через браузер</p>
</li>
</ul>
<p>не понимаю как такое возможно?<br>
вот пример такого видео <a href="https://www.instagram.com/reel/CjxYKmII0Sz/?igshid=YmMyMTA2M2Y=" rel="noopener nofollow ugc">https://www.instagram.com/reel/CjxYKmII0Sz/?igshid=YmMyMTA2M2Y=</a></p></td><td>2022-10-16T09:00:33.659Z</td></tr><tr><td>ValdikSS</td><td><p>Откройте инструменты разработчика браузера (F12), перейдите во вкладку “сеть” и посмотрите, на какие домены отправляются запросы.</p></td><td>2022-10-18T13:53:56.820Z</td></tr><tr><td>h7n14(H7n14je)</td><td><p>Я полный нуб в юниксах и компилировании из реп. Такой вопрос,<br>
если я хочу чтоб антизапрет работал из под малинки 3B+ то мне достаточно просто запустить build.sh из репозитория?({стоит убунту серв 22.10}понятно что надо еще установить нечто mkosi и вроде все?  ну и после lxd или по machinectl уому что больше нравится)<br>
Просто для RPi3B+ это скорее всего будет ну ооочень долго компилиться, можно ли как-то на своем компе собрать для малинки?(желательно с картинками для таких как я)<br>
А может кто-то собрал для такой малинки? Не поделитесь опытом, что, да как там все? <img src="https://ntc.party/images/emoji/twitter/point_right.png?v=12" title=":point_right:" class="emoji" alt=":point_right:" loading="lazy" width="20" height="20"> <img src="https://ntc.party/images/emoji/twitter/point_left.png?v=12" title=":point_left:" class="emoji" alt=":point_left:" loading="lazy" width="20" height="20"> (тоже с картинками пояснениями)</p></td><td>2022-10-22T17:52:16.240Z</td></tr><tr><td>h7n14(H7n14je)</td><td><p>Выходит такая ошибка, кажется ему не хватает некоторых пакетов<br>
I: Base system installed successfully.<br>
Reading package lists… Done<br>
Building dependency tree… Done<br>
Note, selecting ‘bind9-host’ instead of ‘host’<br>
E: Unable to locate package knot-resolver<br>
‣ Error: Workspace command /usr/bin/apt-get --assume-yes --no-install-recommends  --auto-remove install inetutils-ping vim-tiny sipcalc idn dbus gawk wget dnsuti ls ipcalc iptables knot-resolver systemd ferm ca-certificates unattended-upgrade s openvpn openssl host bash systemd-sysv python3-dnslib procps git bsdmainutils  libpam-systemd nano curl returned non-zero exit code 100.<br>
‣  (Unmounting Package Cache)<br>
‣  (Unmounting image)</p></td><td>2022-10-22T19:05:03.781Z</td></tr><tr><td>bokov333(Bokov333)</td><td><p>Подскажите, как изменить время обновления списков блокировки?  Сервер слабенький, раз в шесть часов интернет зависает на продолжительное время.</p></td><td>2022-10-24T11:13:19.155Z</td></tr><tr><td>Kebu</td><td><p>А можно узнать насколько слабый сервер и в какое время суток обновляются базы?</p></td><td>2022-10-26T17:09:51.361Z</td></tr><tr><td>bokov333(Bokov333)</td><td><p>Процессор: 1 ядро, Память: 512 Mb, Диск: 5 GB SSD. Базы обновляются каждые шесть часов начиная с момента запуска контейнера. Проблему решил переустановкой.</p></td><td>2022-10-26T17:27:41.973Z</td></tr><tr><td>Kebu</td><td><p>Хорошо, спасибо, а то я установил на такую же конфигурацию, посмотрю как будет работать)</p></td><td>2022-10-26T17:35:29.962Z</td></tr><tr><td>413xk</td><td><aside class="quote no-group" data-username="ValdikSS" data-post="244" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/valdikss/48/2_2.png" class="avatar"> ValdikSS:</div>
<blockquote>
<p>С сервера вы резолвите через публичные резолверы, а с VPN-подключения — напрямую с сервера, через knot-resolver.<br>
Либо установите в resolv.conf 127.0.0.1, либо запускайте dig, например, так:<br>
<code>dig something.ru @127.0.0.1</code></p>
</blockquote>
</aside>
<p>Возвращаясь к непонятной проблеме с пропаданием кнота (точнее резольвинга через туннель).<br>
dig <a href="http://www.instagram.com" rel="noopener nofollow ugc">www.instagram.com</a> <span class="mention">@127.0.0.1</span></p>
<blockquote>
<p>; &lt;&lt;&gt;&gt; DiG 9.11.5-P4-5.1+deb10u8-Debian &lt;&lt;&gt;&gt; <a href="http://www.instagram.com" rel="noopener nofollow ugc">www.instagram.com</a> <span class="mention">@127.0.0.1</span><br>
;; global options: +cmd<br>
;; Got answer:<br>
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: SERVFAIL, id: 56723<br>
;; flags: qr rd ra; QUERY: 1, ANSWER: 0, AUTHORITY: 0, ADDITIONAL: 1</p>
<p>;; OPT PSEUDOSECTION:<br>
; EDNS: version: 0, flags:; udp: 1232<br>
;; QUESTION SECTION:<br>
;<a href="http://www.instagram.com" rel="noopener nofollow ugc">www.instagram.com</a>.             IN      A</p>
<p>;; Query time: 0 msec<br>
;; SERVER: 127.0.0.1#53(127.0.0.1)<br>
;; WHEN: Wed Nov 02 13:36:15 UTC 2022<br>
;; MSG SIZE  rcvd: 46</p>
</blockquote>
<p>Диг делаю изнутри lxc контейнера, то есть контейнер не может отрезольвить инстач.</p>
<p>После ребута виртуалки, тот же самый диг изнутри контейнера четко резольвит всё.</p></td><td>2022-11-02T13:42:09.095Z</td></tr><tr><td>Kebu</td><td><p>Контейнер крутится на впске с 1гб рам и за две недели аптайма с 833мб занимает уже 918. Это нормальная работа, или через несколько дней он уткнется в нехватку места?</p></td><td>2022-11-09T10:54:17.201Z</td></tr><tr><td>vovansick</td><td><p>У меня на debian 11 с 1gb ram уже больше полугода аптайм</p>
<blockquote>
<p>top -i<br>
MiB Mem :    976.4 total,    162.4 free,    462.7 used,    351.3 buff/cache</p>
</blockquote>
<p>Надо еще понимать что какая-то часть памяти уходит под кэш, то что её мало в free еще ни о чем не говорит</p></td><td>2022-11-10T09:01:12.274Z</td></tr><tr><td>Kebu</td><td><p>Я тоже подумал что возможен такой вариант, поэтому и хотел спросить как у других работает на таком объеме памяти, спасибо!</p>
<p><em>MiB Mem : <strong>991.4</strong> total, <strong>75.8</strong> free, <strong>751.3</strong> used, <strong>164.3</strong> buff/cache</em></p></td><td>2022-11-10T09:13:09.990Z</td></tr><tr><td>pbppds</td><td><p>Добрый день.<br>
Решил разгрузить свой роутер и поднять отдельный контейнер на сервере, чтобы гонять через него трафик. Решил поделиться решением, возможно у кого-то какие-то дополнения ещё будут.</p>
<p>НАТить всё это дело оказалось неправильным решением, поэтому я анонсировал свою локальную сеть в контейнере антизапрета банально через <code>ip r add 192.168.1.0/24 dev vpn-tcp</code>. На роутере прописал маршрут до <code>192.168.104.0/22</code> через свой контейнер, всё пингуется, супер.<br>
Захожу в контейнер антизапрета, открываю <code>/etc/ferm/ferm.conf</code>, добавляю переменную для своей сети и видоизменяю правила по аналогии с существующими, у меня получилось вот так:</p>
<pre><code class="lang-auto">table nat {
        chain dnsmap {}
        chain PREROUTING {
                # DNS redirection
                saddr $VPNUDP_RANGE daddr ! $VPNUDP_DNS proto udp dport 53 mod u32 u32 '0x1C &amp; 0xFFCF = 0x0100 &amp;&amp; 0x1E &amp; 0xFFFF = 0x0001' REDIRECT to-ports 53;
                saddr $VPNTCP_RANGE daddr ! $VPNTCP_DNS proto udp dport 53 mod u32 u32 '0x1C &amp; 0xFFCF = 0x0100 &amp;&amp; 0x1E &amp; 0xFFFF = 0x0001' REDIRECT to-ports 53;
                saddr $LOCAL_NET daddr ! $VPNTCP_DNS proto udp dport 53 mod u32 u32 '0x1C &amp; 0xFFCF = 0x0100 &amp;&amp; 0x1E &amp; 0xFFFF = 0x0001' REDIRECT to-ports 53;

                # dnsmap
                saddr $VPNUDP_RANGE daddr $VPNUDP_DNS ACCEPT;
                saddr $VPNTCP_RANGE daddr $VPNTCP_DNS ACCEPT;
                saddr $LOCAL_NET daddr $VPNTCP_DNS ACCEPT;

                saddr ($VPNUDP_RANGE $VPNTCP_RANGE $LOCAL_NET) daddr ! $DNSMAP_RANGE CONNMARK set-mark 1;
                saddr ($VPNUDP_RANGE $VPNTCP_RANGE $LOCAL_NET) daddr $DNSMAP_RANGE jump dnsmap;
        }
        chain POSTROUTING {
                saddr ($VPNUDP_RANGE $VPNTCP_RANGE $LOCAL_NET) MASQUERADE;
        }
}
</code></pre>
<p>Сохраняю, перезапускаю контейнер антизапрета, захожу на роутер, прописываю маршрут до <code>10.224.0.0/15</code> через айпи своего контейнера, пингую <a href="http://rutracker.org" rel="noopener nofollow ugc">rutracker.org</a>:</p>
<pre><code class="lang-auto">[admin@home-01] &gt; ping rutracker.org
  SEQ HOST                                     SIZE TTL TIME       STATUS        
    0 10.224.0.2                                 56  56 50ms329us 
    1 10.224.0.2                                 56  56 49ms718us 
    2 10.224.0.2                                 56  56 49ms510us 
    3 10.224.0.2                                 56  56 49ms713us 
    4 10.224.0.2                                 56  56 49ms914us 
    sent=5 received=5 packet-loss=0% min-rtt=49ms510us avg-rtt=49ms836us 
   max-rtt=50ms329us
</code></pre>
<p>И наконец:</p>
<pre><code class="lang-auto">[admin@home-01] &gt; /tool/fetch https://rutracker.org
  status: failed

failure: closing connection: &lt;301 Moved Permanently location="https://rutracker.or
g/forum/index.php"&gt; 10.224.0.1:443 (5)
</code></pre>
<p>Редиректит куда надо, а значит всё супер.</p>
<p>Нюанс - из-за duplicate-cn могут возникнуть проблемы, если вашим конфигом овпн пользуются много людей. В моём случае, у контейнера в 99% случаев айпи адрес не изменяется</p>
<p>upd.<br>
Всё-таки не совсем всё супер.<br>
С роутера адреса прекрасно прогружаются и всё работает, но с компьютера всё равно работает процентов на 20. Пытаюсь открыть рутрекер - не грузится, но пингуется. Пингую компьютер с контейнера антизапрета - не пингуется. Проходит какое-то время - начинает пинговаться и открываться. Открываю другой заблоченый сайт - не открывает и перестаёт пинговаться. Роутер, при этом, с контейнера стабильно отвечает. Мистика какая-то.</p></td><td>2022-11-10T10:15:20.425Z</td></tr><tr><td>413xk</td><td><aside class="quote no-group" data-username="413xk" data-post="390" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/4/ee59a6/48.png" class="avatar"> 413xk:</div>
<blockquote>
<p>После ребута виртуалки, тот же самый диг изнутри контейнера четко резольвит всё.</p>
</blockquote>
</aside>
<p>Короче, ровно 15 суток без падений и контейнер перестает резольвить.<br>
15 дней 28 минут аптайм, при том что сама виртуалка за эти 15 суток имеет 100% аптайм.</p>
<p><a class="mention" href="/u/valdikss">@ValdikSS</a> , там в конфигах ничего не происходит на 15 суток 30 минут случайно? Например каждые 360 часов что-то должно произойти, или типа того…</p></td><td>2022-11-17T18:09:36.281Z</td></tr><tr><td>Kebu</td><td><p>В итоге у меня осталось 2% оперативки и работать вся эта конструкция перестала)) перезагрузил вирт машину, заработала, но все равно занимает места больше заявленного: 850 мб озу и 5,5гб. С чем мб связано? Если это какой-то кэш, разве он должен сам очищаться?</p></td><td>2022-11-19T07:28:31.583Z</td></tr><tr><td>lord(Savely Krasovsky)</td><td><p>Список актуален?</p></td><td>2022-11-26T23:30:43.585Z</td></tr><tr><td>lord(Savely Krasovsky)</td><td><p>Подскажите, какие минимальные разрешения нужно выдать на файрволле для работы контейнера на базе nspawn? На сервере из коробки, где вообще никакого файрволла не стояло всё работало. Теперь написал простенький конфиг, ограничив input и forward (разумеется разрешив 1194 по TCP/UDP) всё сломалось.</p></td><td>2022-11-28T07:54:32.359Z</td></tr><tr><td>lord(Savely Krasovsky)</td><td><p>Кажется разобрался. Для работы потребовалось добавить два правила:</p>
<ol>
<li>
<code>iifname ve-antizaprBO3Q accept</code> в <code>input</code> цепочку.</li>
<li>
<code>iifname ve-antizaprBO3Q accept</code> в <code>forward</code> цепочку.</li>
</ol>
<p>И теперь важно перезапустить ещё и systemd-nspawn@antizapret-vpn.service:</p>
<pre><code class="lang-auto">$ sudo systemctl restart systemd-nspawn@antizapret-vpn.service
</code></pre>
<p>Так как systemd сверху накидывает NAT-правила для <code>systemd-nspawn</code>.</p></td><td>2022-11-28T09:21:09.472Z</td></tr><tr><td>vmatrixx</td><td><p>Всем привет. Совершенно неожиданно сервис стал считать страницу входа в ЛК налоговой заблокированной: <a href="http://lkfl2.nalog.ru" rel="noopener nofollow ugc">lkfl2.nalog.ru</a><br>
Несмотря на то, что через мобильный интернет спокойно можно войти.<br>
Но это полбеды, указанный домен просто отказывается резолвиться:<br>
dig <a href="http://lkfl2.nalog.ru" rel="noopener nofollow ugc">lkfl2.nalog.ru</a> <span class="mention">@127.0.0.1</span> выдаёт SERVFAIL, хотя<br>
dig <a href="http://lkfl2.nalog.ru" rel="noopener nofollow ugc">lkfl2.nalog.ru</a> <span class="mention">@127.0.0.4</span> работает.<br>
Добавление доменов в exclude-hosts-custom.txt не помогло. Кто-нибудь может объяснить, что вообще произошло и что нужно сделать?</p></td><td>2022-11-28T10:39:29.125Z</td></tr><tr><td>xirrurg(Xirrurg)</td><td><p>Сутки скачать не могу , скорость около 64 кб  и после 5% ошибка</p>
<p><a href="https://antizapret.prostovpn.org/container-images/az-vpn/rootfs.tar.xz" class="onebox" target="_blank" rel="noopener nofollow ugc">https://antizapret.prostovpn.org/container-images/az-vpn/rootfs.tar.xz</a></p></td><td>2022-12-08T16:30:33.574Z</td></tr><tr><td>Gmarapet</td><td><p>Тоже не скачивается. Ни rootfs.tar.xz, ни container-images/az-vpn<br>
Сейчас какие-то проблемы на серверах с образами?</p></td><td>2022-12-10T14:01:42.319Z</td></tr><tr><td>Ulta(Ulta)</td><td><p>HTTP request to <a href="https://antizapret.prostovpn.org/container-images/az-vpn/rootfs.nspawn" rel="noopener nofollow ugc">https://antizapret.prostovpn.org/container-images/az-vpn/rootfs.nspawn</a> failed with code 404.</p></td><td>2022-12-15T22:40:20.947Z</td></tr><tr><td>ValdikSS</td><td><aside class="quote no-group" data-username="vmatrixx" data-post="400" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/vmatrixx/48/1963_2.png" class="avatar"> vmatrixx:</div>
<blockquote>
<p>Всем привет. Совершенно неожиданно сервис стал считать страницу входа в ЛК налоговой заблокированной: <a href="http://lkfl2.nalog.ru">lkfl2.nalog.ru</a></p>
</blockquote>
</aside>
<p>Это налоговая заблокировала не-российские резолверы DNS.</p>
<aside class="quote no-group quote-modified" data-username="vmatrixx" data-post="400" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/vmatrixx/48/1963_2.png" class="avatar"> vmatrixx:</div>
<blockquote>
<p>Кто-нибудь может объяснить, … что нужно сделать?</p>
</blockquote>
</aside>
<p>Добавьте в конфигурационный файл правило, переадресующие резолв этого домена через Яндекс DNS, например: <a href="https://ntc.party/t/vpn/129/372" class="inline-onebox">Контейнер VPN АнтиЗапрета для установки на собственный сервер - #372 by ValdikSS</a></p></td><td>2022-12-15T23:29:14.201Z</td></tr><tr><td>ValdikSS</td><td><p><a class="mention" href="/u/xirrurg">@xirrurg</a>, <a class="mention" href="/u/gmarapet">@Gmarapet</a>, сейчас должно быть нормально. Хостинг-провайдер ограничивает скорость канала сервера из-за нарушение fair use policy.</p>
<p><a class="mention" href="/u/ulta">@Ulta</a>, так и должно быть, это не ошибка.</p></td><td>2022-12-15T23:30:49.021Z</td></tr><tr><td>ValdikSS</td><td><aside class="quote no-group" data-username="Kebu" data-post="396" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/k/8797f3/48.png" class="avatar"> Kebu:</div>
<blockquote>
<p>С чем мб связано? Если это какой-то кэш, разве он должен сам очищаться?</p>
</blockquote>
</aside>
<p>Не могу сказать. Можете добавить zram на ваш сервер, в качестве временной меры.</p></td><td>2022-12-15T23:31:32.400Z</td></tr><tr><td>ValdikSS</td><td><aside class="quote no-group" data-username="413xk" data-post="395" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/4/ee59a6/48.png" class="avatar"> 413xk:</div>
<blockquote>
<p>там в конфигах ничего не происходит на 15 суток 30 минут случайно? Например каждые 360 часов что-то должно произойти, или типа того…</p>
</blockquote>
</aside>
<p>Нет, ничего такого.</p></td><td>2022-12-15T23:31:55.577Z</td></tr><tr><td>413xk</td><td><aside class="quote no-group" data-username="ValdikSS" data-post="407" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/valdikss/48/2_2.png" class="avatar"> ValdikSS:</div>
<blockquote>
<p>Нет, ничего такого.</p>
</blockquote>
</aside>
<p>ну, короче у меня как по расписанию, на каждые 14 сутки нафиг все работает перестает.<br>
В итоге ребутаю виртуалку по крону раз в неделю ночью, так работает стабильно <img src="https://ntc.party/images/emoji/twitter/slight_smile.png?v=12" title=":slight_smile:" class="emoji" alt=":slight_smile:" loading="lazy" width="20" height="20"></p></td><td>2022-12-16T06:18:27.863Z</td></tr><tr><td>SergI</td><td><p>Добрый день. Не получается выполнить первый шаг</p>
<pre><code class="lang-auto">root@xxxxxxx:~# lxc image import https://antizapret.prostovpn.org/container-images/az-vpn --alias antizapret-vpn-img
Error: read tcp x.xxx.xx.xx:60516-&gt;195.123.208.131:443: read: connection reset by peer
</code></pre>
<p>lxc --version<br>
5.9</p>
<pre><code class="lang-auto">Distributor ID: Ubuntu
Description:    Ubuntu 22.04.1 LTS
Release:        22.04
Codename:       jammy
</code></pre></td><td>2022-12-19T13:31:10.964Z</td></tr><tr><td>nzkhammatov(Ainur Khammatov)</td><td><aside class="quote no-group" data-username="SergI" data-post="409" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/sergi/48/2099_2.png" class="avatar"> SergI:</div>
<blockquote>
<pre><code class="lang-auto">root@xxxxxxx:~# lxc image import https://antizapret.prostovpn.org/container-images/az-vpn --alias antizapret-vpn-img
Error: read tcp x.xxx.xx.xx:60516-&gt;195.123.208.131:443: read: connection reset by peer
</code></pre>
</blockquote>
</aside>
<p><a class="mention" href="/u/valdikss">@ValdikSS</a></p></td><td>2022-12-19T16:04:49.466Z</td></tr><tr><td>nzkhammatov(Ainur Khammatov)</td><td><p><strong>Первый этап заменить на это:</strong></p>
<p><code>curl -OLC - https://raw.githubusercontent.com/nzkhammatov/container-images/main/az-vpn/lxd.tar.xz</code></p>
<p><code>lxc image import lxd.tar.xz --alias antizapret-vpn-img</code></p>
<p><strong>Скачает со стороннего ресурса. Сравните отпечатки с файлом:</strong><br>
<code>https://antizapret.prostovpn.org/container-images/az-vpn/lxd/lxd.tar.xz</code></p></td><td>2022-12-21T07:55:36.453Z</td></tr><tr><td>SergI</td><td><p>Спасибо. Вчера вечером получилось скачать с <a href="https://antizapret.prostovpn.org/container-images/az-vpn/lxd/lxd.tar.xz" rel="noopener nofollow ugc">https://antizapret.prostovpn.org/container-images/az-vpn/lxd/lxd.tar.xz</a> и импортировать как локальный образ</p></td><td>2022-12-21T08:01:03.158Z</td></tr><tr><td>onemantooo(Yury)</td><td><p>Привет. Развернул на scaleway инстанс с антизапретом, все работает, супер. Но подскажите - как добавить доменное имя в список проксируемых через VPN? Конкретно хочется ChatGPT попробовать, а в РФ как известно не дают.</p></td><td>2022-12-25T13:06:31.805Z</td></tr><tr><td>nzkhammatov(Ainur Khammatov)</td><td><aside class="quote" data-post="9" data-topic="1271">
  <div class="title">
    <div class="quote-controls"></div>
    <img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/valdikss/48/2_2.png" class="avatar">
    <a href="https://ntc.party/t/topic/1271/9">Обновление списка сайтов заблокированных РКН на собственном сервере</a> <a class="badge-category__wrapper " href="/c/antizapret-prostovpn-org/5"><span data-category-id="5" style="--category-badge-color: #8C6238; --category-badge-text-color: #FFFFFF;" data-drop-close="true" class="badge-category " title="Proxy and VPN service for Russian censorship circumvention, discussion and official support forum. Обсуждение работы сервиса обхода блокировок России АнтиЗапрет. Новости, уведомления о проблемах и помощь в настройке."><span class="badge-category__name">antizapret.prostovpn.org</span></span></a>
  </div>
  <blockquote>
    Эти файлы находятся внутри контейнера, а не на хост-системе. Если пользуетесь lxd, войдите в контейнер через lxc shell antizapret-vpn, если systemd-machined — machinectl shell antizapret-vpn.
  </blockquote>
</aside>

<aside class="quote no-group quote-modified" data-username="onemantooo" data-post="413" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/onemantooo/48/2145_2.png" class="avatar"> onemantooo:</div>
<blockquote>
<p>Как добавить доменное имя в список проксируемых через VPN?</p>
</blockquote>
</aside>
<p><strong>Ваш вариант наверное вот этот:</strong> <code>machinectl shell antizapret-vpn</code></p>
<p><strong>Списки находятся здесь:</strong> <code>cd /root/antizapret/config</code></p>
<p><strong>Добавить сюда:</strong> <code>nano include-hosts-custom.txt</code></p>
<p><strong>Применить изменения:</strong> <code>/root/antizapret/doall.sh</code></p></td><td>2022-12-25T15:19:24.744Z</td></tr><tr><td>nedden(Денис)</td><td><p>Добрый день. Установил контейнер на сервер с помощью systemd-machined по инструкции. Все хорошо работает, но результат работы по инструкции это один файл ovpn. Как сделать несколько для разных устройств/друзей/родственников? Если я буду делиться этим единственным файлом, то будут проблемы так как все начнут под одной учеткой долбиться на сервер.</p></td><td>2023-01-01T00:57:57.538Z</td></tr><tr><td>dartraiden(Alexander Gavrilov)</td><td><p>Не будет проблем, там в конфиге OpenVPN на сервере включена поддержка множественных подключений.</p>
<blockquote>
<p>Multiple clients are allowed to connect to the OpenVPN server using the same pair of cert/key if <code>duplicate-cn</code> (allowing duplicate common name) is present in OpenVPN server’s configuration file.</p>
</blockquote></td><td>2023-01-01T12:47:44.275Z</td></tr><tr><td>nedden(Денис)</td><td><aside class="quote no-group" data-username="dartraiden" data-post="416" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/dartraiden/48/15299_2.png" class="avatar"> dartraiden:</div>
<blockquote>
<p>Multiple clients are allowed to connect to the OpenVPN server using the same pair of cert/key if <code>duplicate-cn</code> (allowing duplicate common name) is present in OpenVPN server’s configuration file</p>
</blockquote>
</aside>
<p>Я делал по этой инструкции <a href="https://bitbucket.org/anticensority/antizapret-vpn-container/src/master/" class="inline-onebox" rel="noopener nofollow ugc">Bitbucket</a><br>
Не знаю как он настроен и есть ли там duplicate-cn</p>
<p>То есть я просто ввел нужные команды и все заработало, но по опыту знаю, что одним файлом для всех пользоваться плохая затея.</p>
<p>Если изначально контейнер настроен так, что одним файлом можно пользоваться, то вопрос снимается.</p></td><td>2023-01-01T15:50:49.381Z</td></tr><tr><td>fageoner</td><td><p>всем привет,<br>
кто может подсказать в чем проблем - на padavan’е не хочет подключаться в личному серверу antizapret’а, при том с подключением к <a href="http://vpn.antizapret.prostovpn.org" rel="noopener nofollow ugc">vpn.antizapret.prostovpn.org</a> проблем нет<br>
в теории же достаточно заменить адрес и сертификаты с ключом, правильно? но никак не работает(</p>
<p>лог:</p>
<pre><code class="lang-auto">openvpn-cli[1346]: DEPRECATED OPTION: --cipher set to 'AES-128-CBC' but missing in --data-ciphers (AES-128-GCM). Future OpenVPN version will ignore --cipher for cipher negotiations. Add 'AES-128-CBC' to --data-ciphers or change --cipher 'AES-128-CBC' to --data-ciphers-fallback 'AES-128-CBC' to silence this warning.

openvpn-cli[1347]: NOTE: the current --script-security setting may allow this configuration to call user-defined scripts
</code></pre>
<p>с <a href="http://vpn.antizapret.prostovpn.org" rel="noopener nofollow ugc">vpn.antizapret.prostovpn.org</a> тоже бывают такие ошибки, но подключается без проблем<br>
конфиг: <a href="https://ibb.co/chxC5gF" class="inline-onebox" rel="noopener nofollow ugc">2023-01-07-13-37-06 — ImgBB</a></p>
<p>доп параметры:</p>
<pre><code class="lang-auto">### If your server certificates with the nsCertType field set to "server"
remote-cert-tls server

### Process priority level (0..19)
nice 0

### Syslog verbose level
verb 0
mute 10

auth-nocache
ignore-unknown-option block-outside-dns

#adguard home
route 9.9.9.10
route 149.112.112.10
</code></pre></td><td>2023-01-07T10:40:19.693Z</td></tr><tr><td>fageoner</td><td><p>а не, сейчас подкючился, спустя 40 минут после ребута<br>
магия какая-то</p>
<p>upd<br>
оказалось, что личный сервак чувствителен к точности времени, в отличии от <a href="http://vpn.antizapret.prostovpn.org/" rel="noopener nofollow ugc">vpn.antizapret.prostovpn.org</a><br>
роутер не коннектилсяя ко старым ntp сервакам, поменял их и всё взлетело</p></td><td>2023-01-07T10:58:59.241Z</td></tr><tr><td>WhattaSkilL(WhattaSkill)</td><td><p>Всем привет, развернул LXC на VPS ВДСины. При попытке присоедениться к некоторым сайтам (например insta) появляется ошибка с таймаутом, другой сайт лицокнижной компании, грузится и пишет “Error” в title. Кто нибудь сталкивался с этой проблемой? Некоторые сайты работают нормально. По IP видно что резолвятся VPNские имена. Когда использовал общий сервис то по этим сайтам запросы проходили.</p>
<details>
<summary>
Скрин</summary>
<p><div class="lightbox-wrapper"><a class="lightbox" href="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/897d54575be0cb0e44002e41ab14c7983a137020.png" data-download-href="https://ntc.party/uploads/default/897d54575be0cb0e44002e41ab14c7983a137020" title="Зависание"><img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/897d54575be0cb0e44002e41ab14c7983a137020.png" alt="Зависание" data-base62-sha1="jChVH8wCTNPOdsxmIn76R0xTLUY" width="690" height="415" data-dominant-color="171717"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">Зависание</span><span class="informations">1097×660 29.4 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
</details>
<p>Ubuntu 22.04 Процессор: <strong>1 core</strong> Память: <strong>1 ГБ</strong></p></td><td>2023-01-09T02:47:16.495Z</td></tr><tr><td>Kamareka(Kamareka)</td><td><p>Проверьте: <a href="https://ntc.party/t/vpn/129/327" class="inline-onebox">Контейнер VPN АнтиЗапрета для установки на собственный сервер - #327 by cloud</a></p></td><td>2023-01-09T03:04:09.112Z</td></tr><tr><td>nzkhammatov(Ainur Khammatov)</td><td><aside class="quote no-group" data-username="WhattaSkilL" data-post="421" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/whattaskill/48/2162_2.png" class="avatar"> WhattaSkilL:</div>
<blockquote>
<p>При попытке присоедениться к некоторым сайтам (например insta) появляется ошибка с таймаутом, другой сайт лицокнижной компании, грузится и пишет “Error” в title.</p>
</blockquote>
</aside>
<p>…</p>
<aside class="quote no-group" data-username="ValdikSS" data-post="1" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/valdikss/48/2_2.png" class="avatar"> ValdikSS:</div>
<blockquote>
<p>Для правильной работы <strong>Twitter, Facebook и Instagram</strong> <a href="https://ntc.party/t/vpn/129/127"><strong>требуются дополнительные действия</strong></a>.</p>
</blockquote>
</aside></td><td>2023-01-09T06:29:24.176Z</td></tr><tr><td>WhattaSkilL(WhattaSkill)</td><td><p>Большое спасибо, извиняюсь за то что потревожил, по ошибке создал VPS в РУ сегменте. А я ещё удивлялся почему это пинг 3</p></td><td>2023-01-09T13:30:55.368Z</td></tr><tr><td>nedden(Денис)</td><td><p>Добрый день. А инстаграм у всех работает? Ранее настроил контейнер на своем сервере и добавил соц. сети по инструкции <a href="https://ntc.party/t/vpn/129/127" class="inline-onebox">Контейнер VPN АнтиЗапрета для установки на собственный сервер - #127 by ValdikSS</a></p>
<p>Все работало несколько дней, а сегодня инстаграм перестал работать. Другие заблокированные сайты работают.</p></td><td>2023-01-10T18:04:59.438Z</td></tr><tr><td>nedden(Денис)</td><td><p>Сегодня все само заработало)</p></td><td>2023-01-11T15:42:38.664Z</td></tr><tr><td>maksuy(Max)</td><td><p>А можно как нибудь в контейнере добавить поддержку AES-256-CBC ?</p></td><td>2023-01-15T20:12:57.944Z</td></tr><tr><td>Ser23(Валерий)</td><td><p>Добрый день, а не поделитесь своими настройкам для openvpn ? В идеале если есть compose для Docker <img src="https://ntc.party/images/emoji/twitter/pray.png?v=12" title=":pray:" class="emoji" alt=":pray:" loading="lazy" width="20" height="20"></p></td><td>2023-01-16T08:41:35.285Z</td></tr><tr><td>Ser23(Валерий)</td><td><p>Ответа не получил, но нашел compose файл для docker <a href="https://github.com/xtrime-ru/antizapret-vpn-docker/blob/master/docker-compose.yml" class="inline-onebox" rel="noopener nofollow ugc">antizapret-vpn-docker/docker-compose.yml at master · xtrime-ru/antizapret-vpn-docker · GitHub</a>. Теперь уже проблема при установке - вылетает с ошибкой. Никто не подскажет что надо поправить?</p>
<blockquote>
<p>rpc error: code = Unknown desc = failed to solve with frontend dockerfile.v0: failed to read dockerfile: open /var/lib/docker/tmp/buildkit-mount1393985058/Dockerfile: no such file or directory</p>
</blockquote></td><td>2023-01-20T14:33:56.051Z</td></tr><tr><td>toxi(Roman)</td><td><p>Добрый день.<br>
Подскажите, какие значения используются в модуле c32 для iptables и что они “выделяют” и для чего?<br>
Не могу найти описание именно этих параметров, так как никогда с ними не работал <img src="https://ntc.party/images/emoji/twitter/slight_smile.png?v=12" title=":slight_smile:" class="emoji" alt=":slight_smile:" loading="lazy" width="20" height="20"></p>
<pre><code class="lang-auto"># DNS redirection
saddr $VPNUDP_RANGE daddr ! $VPNUDP_DNS proto udp dport 53 mod u32 u32 '0x1C &amp; 0xFFCF = 0x0100 &amp;&amp; 0x1E &amp; 0xFFFF = 0x0001' REDIRECT to-ports 53;
saddr $VPNTCP_RANGE daddr ! $VPNTCP_DNS proto udp dport 53 mod u32 u32 '0x1C &amp; 0xFFCF = 0x0100 &amp;&amp; 0x1E &amp; 0xFFFF = 0x0001' REDIRECT to-ports 53;
</code></pre></td><td>2023-01-26T14:11:03.390Z</td></tr><tr><td>soulja(Serano)</td><td><p>Подскажите пожалуйста.<br>
Signature verification succeeded.<br>
<code>Failed to rename to final image name to /var/lib/machines/.tar-https:\x2f\x2fantizapret\x2eprostovpn\x2eorg\x2fcontainer-images\x2faz-vpn\x2frootfs\x2etar\x2exz.\x225eebbbf7-38c92f8\x22: Operation not permitted</code></p></td><td>2023-01-31T05:42:34.831Z</td></tr><tr><td>maksuy(Max)</td><td><p>В ubuntu 22.04 не работает shell</p>
<p>root@antizapret:/# machinectl shell antizapret-vpn<br>
Connected to machine antizapret-vpn. Press ^] three times within 1s to exit session.</p>
<p>Connection to machine antizapret-vpn terminated.</p></td><td>2023-02-05T21:17:00.391Z</td></tr><tr><td>kidu(kir)</td><td><p>никак не могу побороть нерабочий инстаграм на компьютерах! причем на мобильных устройствах работает через приложение - работает, а через браузер - белый экран везде. Что посоветуете?</p></td><td>2023-02-06T13:44:11.097Z</td></tr><tr><td>ilyaigpetrov(ilyaigpetrov)</td><td><p>Попробуйте это, напимер: <a href="https://ntc.party/t/instagram/3312/22" class="inline-onebox">Не работает Instagram - #22 by ValdikSS</a>.<br>
И не пишите свой вопрос в первую попавшуюся тему, используйте поиск.</p></td><td>2023-02-06T14:04:06.851Z</td></tr><tr><td>nanoflooder</td><td><p>Здравствуйте! Огромное спасибо за проделанную вами работу.</p>
<p>Развернул по инструкции контейнер на VPS, всё работает, захотел в список сайтов добавить youtube:</p>
<pre><code class="lang-auto">root@antizapret-vpn:~# cat antizapret/config/include-hosts-custom.txt
ytimg.com
ggpht.com
googlevideo.com
youtube.com
</code></pre>
<p>Это работает:</p>
<pre><code class="lang-auto">C:\Windows\system32&gt;ping youtube.com

Обмен пакетами с youtube.com [10.224.0.1] с 32 байтами данных:
Ответ от 10.224.0.1: число байт=32 время=271мс TTL=114
Ответ от 10.224.0.1: число байт=32 время=195мс TTL=114
Ответ от 10.224.0.1: число байт=32 время=195мс TTL=114
Ответ от 10.224.0.1: число байт=32 время=195мс TTL=114

Статистика Ping для 10.224.0.1:
    Пакетов: отправлено = 4, получено = 4, потеряно = 0
    (0% потерь)
Приблизительное время приема-передачи в мс:
    Минимальное = 195мсек, Максимальное = 271 мсек, Среднее = 214 мсек
</code></pre>
<p>Но youtube не загружается до конца: открывается его главная страница с ошибкой “Нет доступа к интернету” (скриншот во вложении)</p>
<p>Добавлял найденный в интернете “полный список доменов youtube” - не помогло.</p>
<p>Подскажите, как починить?<br>
<div class="lightbox-wrapper"><a class="lightbox" href="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/243f52a8acbb8b48ed8a516df72277fcaab3fe24.png" data-download-href="https://ntc.party/uploads/default/243f52a8acbb8b48ed8a516df72277fcaab3fe24" title="screenshot"><img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/243f52a8acbb8b48ed8a516df72277fcaab3fe24_2_690x423.png" alt="screenshot" data-base62-sha1="5aERaAJDbSdpJ3NxQW05hOxg308" width="690" height="423" srcset="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/243f52a8acbb8b48ed8a516df72277fcaab3fe24_2_690x423.png, контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/243f52a8acbb8b48ed8a516df72277fcaab3fe24_2_1035x634.png 1.5x, контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/243f52a8acbb8b48ed8a516df72277fcaab3fe24.png 2x" data-dominant-color="1B1A1D"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">screenshot</span><span class="informations">1101×675 34.2 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p></td><td>2023-02-07T19:10:16.187Z</td></tr><tr><td>nzkhammatov(Ainur Khammatov)</td><td><p><strong>Добавить сюда</strong></p>
<p><code>/root/antizapret/config/include-hosts-custom.txt</code></p>
<pre><code class="lang-auto">youtube.com
youtu.be
ytimg.com
ggpht.com
googleusercontent.com
googlevideo.com
google.com
googleapis.com
</code></pre>
<p><strong>Удалить отсюда</strong><br>
<em>В скобках количество записей требующих удаления.</em></p>
<p><code>/root/antizapret/config/exclude-hosts-dist.txt</code></p>
<pre><code class="lang-auto">youtube.com (2)
youtu.be (1)
ytimg.com (3)
ggpht.com (2)
googleusercontent.com (1)
googlevideo.com (0)
google.com (0)
googleapis.com (0)
</code></pre>
<p><strong>Тоже удалить</strong></p>
<p><code>/root/antizapret/config/exclude-regexp-dist.awk</code></p>
<blockquote>
<p>(/googleusercontent.com/) {next}</p>
</blockquote>
<p><strong>Выполнить</strong></p>
<pre><code class="lang-auto">
/root/antizapret/doall.sh
</code></pre></td><td>2023-02-08T00:07:01.725Z</td></tr><tr><td>fageoner</td><td><p>никак не хочет открываться <a href="http://rt.ru" rel="noopener nofollow ugc">rt.ru</a><br>
добавление в exclude-host(s)-custom.txt не помогает<br>
в чем может быть проблема?</p></td><td>2023-02-08T07:33:50.543Z</td></tr><tr><td>nanoflooder</td><td><p>Большое спасибо, всё получилось! Youtube работает корректно и страну определяет правильно.</p></td><td>2023-02-09T21:04:17.198Z</td></tr><tr><td>onemantooo(Yury)</td><td><p>Подскажите, а можно как-то весь траффик пустить через АнтиЗапрет?</p></td><td>2023-02-09T22:48:42.252Z</td></tr><tr><td>fageoner</td><td><p>если кто тоже столкнулся с проблемой с доступом к <a href="http://rt.ru" rel="noopener nofollow ugc">rt.ru</a>, как у меня, то всё решилось добавлением вот этих строчек в конце файла /etc/knot-resolver/kresd.conf</p>
<pre><code class="lang-auto">policy.add(
    policy.suffix(
        policy.FORWARD(
            {'77.88.8.8'}
        ),
        policy.todnames({'rt.ru'})
    )
)
</code></pre></td><td>2023-02-10T09:45:47.800Z</td></tr><tr><td>dartraiden(Alexander Gavrilov)</td><td><p>Если речь о вашем сервере (в этом топике обсуждается именно установка на свой сервер), то настройте OpenVPN по любому мануалу с пропуском всего трафика, зачем вам Антизапрет? Мануалов как настроить на своём сервере OpenVPN в интернете просто уйма.</p>
<p>Если речь об <a href="http://antizapret.prostovpn.org" rel="noopener nofollow ugc">antizapret.prostovpn.org</a>, то нет, нельзя, трафик у хостера не бесплатный и пока трафика сравнительно немного, то расходы покрываются донатами. Если пропускать весь трафик (один ютуб генерирует уйму трафика), то расходы на трафик и нагрузка на серверы заметно вырастут.</p></td><td>2023-02-10T18:35:11.368Z</td></tr><tr><td>cal0r1c(Алексей Кочетков)</td><td><p>Установил контейнер АнтиЗапрет на свой VPS Нидерланды. Работает норм, но захожу на <a href="http://deviantart.com" rel="noopener nofollow ugc">deviantart.com</a> сайт открывает, а вот картинки нет. Кто нибудь сталкивался? Подскажите ребят?</p></td><td>2023-02-11T11:28:55.759Z</td></tr><tr><td>fageoner</td><td><p>привет, добавь <a href="http://wixmp.com" rel="noopener nofollow ugc">wixmp.com</a> в include-hosts-custom.txt</p></td><td>2023-02-11T11:45:54.979Z</td></tr><tr><td>cal0r1c(Алексей Кочетков)</td><td><p>Заработало! Спасибо)</p></td><td>2023-02-12T11:39:39.065Z</td></tr><tr><td>Kebu</td><td><p>Глупый вопрос: при редактировании в нано например include-hosts-custom.txt после перезапуска все домены сливаются в одну строчку и перестают работать. Через «echo…» все работает понятное дело. Что я делаю не так?)</p></td><td>2023-02-15T05:50:56.248Z</td></tr><tr><td>cal0r1c(Алексей Кочетков)</td><td><p>Парни проверьте пожалуйста на личном Анизапрете сайт почта ру открывает не? На общем норм и если у кого работает, то какие домены вписывали в include…?</p></td><td>2023-02-15T09:26:56.376Z</td></tr><tr><td>onemantooo(Yury)</td><td><p>Речь о моем сервере. Но, я не хочу постоянно проксировать весь трафик, антизапрет включен всегда, но иногда возникает необходимость попасть на какой-то сайт через VPN, например если он сам блокирует российские адреса. Поэтому возможность быстро переключиться на проксирование всего трафика была бы достаточно удобна.</p></td><td>2023-02-16T10:14:40.726Z</td></tr><tr><td>ValdikSS</td><td><aside class="quote no-group" data-username="toxi" data-post="430" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/toxi/48/4_2.png" class="avatar"> toxi:</div>
<blockquote>
<p>Подскажите, какие значения используются в модуле c32 для iptables и что они “выделяют” и для чего?<br>
Не могу найти описание именно этих параметров, так как никогда с ними не работал <img src="https://ntc.party/images/emoji/twitter/slight_smile.png?v=12" title=":slight_smile:" class="emoji" alt=":slight_smile:" loading="lazy" width="20" height="20"></p>
</blockquote>
</aside>
<p>Это выделение байтов, характерных для DNS-запроса. Конкретно — Flags: recursion и questions: 1</p></td><td>2023-02-18T20:29:26.699Z</td></tr><tr><td>ValdikSS</td><td><aside class="quote no-group" data-username="Kebu" data-post="445" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/k/8797f3/48.png" class="avatar"> Kebu:</div>
<blockquote>
<p>после перезапуска все домены сливаются в одну строчку и перестают работать</p>
</blockquote>
</aside>
<p>Вы точно редактируете в nano, а не в Windows, через SFTP? Может, вы вставляете из блокнота из Windows? Похоже на несовместимость в переносах строки.</p></td><td>2023-02-18T20:31:52.604Z</td></tr><tr><td>kidu(kir)</td><td><p>Помогите пожалуйста, при использовании общедоступного антизапрета - инстаграм работает отлично везде.<br>
Но тот, который собрал я - не дает работать инстаграму в браузере на всех устройствах! только в приложении.<br>
в сафари белый экран, в хроме HTTP ERROR 429</p>
<p>вот это решение помогает. но нужно на всех браузерах же это делать? <a href="https://ntc.party/t/instagram/3312/21" class="inline-onebox">Не работает Instagram - #21 by ValdikSS</a></p>
<p>может есть глобальное решение? в обычном антизапрете же как то сделали!</p></td><td>2023-02-06T16:41:18.017Z</td></tr><tr><td>ValdikSS</td><td><p>У вас сам веб-сервер ответ возвращает? Соединение устанавливается, HTTPS-сертификат корректный?<br>
Если да — вас блокирует сам сервис.</p></td><td>2023-02-18T21:38:54.019Z</td></tr><tr><td>Kebu</td><td><p>Точно не винда – делал в терминале мака. Потом попробовал то же самое в Термиусе, там все отлично)<br>
Спасибо вам за работу! <img src="https://ntc.party/images/emoji/twitter/slight_smile.png?v=12" title=":slight_smile:" class="emoji" alt=":slight_smile:" loading="lazy" width="20" height="20"></p></td><td>2023-02-19T07:22:52.356Z</td></tr><tr><td>cloud(Vadim)</td><td><p>Нет готового списка для include-hosts тех сайтов что запрещают доступ из рф? Каждый сам сейчас добавляет в  свой список, но так замучаешься.</p></td><td>2023-02-19T11:34:26.027Z</td></tr><tr><td>413xk</td><td><p>Подскажите пожалуйста:</p>
<p><a href="http://google.com" rel="noopener nofollow ugc">google.com</a> почему-то заворачивается через антизапрет-контейнер, а <a href="http://google.ru" rel="noopener nofollow ugc">google.ru</a> при этом всё ок.<br>
<a href="http://gofile.io" rel="noopener nofollow ugc">gofile.io</a> аналогично заворачивается в контейнер.<br>
добавление в exclude-hosts-custom помогло, но вопрос: из-за каких правил оно вообще туда попало?</p>
<p>UP: по <a href="http://gofile.io" rel="noopener nofollow ugc">gofile.io</a> понятно, заблокирован.<br>
Тогда усложню вопрос, как в контейнере оставить <a href="http://gofile.io" rel="noopener nofollow ugc">gofile.io</a>, но исключить *.gofile.io, ибо на файлообменнике все файлы лежат на субдоменах, и заблокирована, наверное, только морда</p></td><td>2023-02-19T15:31:51.152Z</td></tr><tr><td>sevastianovv(Sevastianovv)</td><td><p><img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/82b89c45cdb9ed2971d621aab213d32932af8b71.png" alt="image" data-base62-sha1="iEpB1E08FJyeJwDSe6fQPAxZ9N7" width="681" height="371"><br>
такой ответ нормально?</p></td><td>2023-02-23T17:33:20.336Z</td></tr><tr><td>sevastianovv(Sevastianovv)</td><td><p>Доброго! Кому не сложно можете посмотреть что не так <a href="https://firstbyte.ru" rel="noopener nofollow ugc">https://firstbyte.ru</a> тариф MSK-KVM-SSD-START да в России но работает единственное инста притормаживает приложение пишет что нет инета но потом работает и так постоянно</p></td><td>2023-02-23T17:39:31.274Z</td></tr><tr><td>ValdikSS</td><td><p>Не занимайтесь мазохизмом и используйте VPS не в России.</p></td><td>2023-02-24T07:37:55.069Z</td></tr><tr><td>ValdikSS</td><td><aside class="quote no-group" data-username="413xk" data-post="454" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/4/ee59a6/48.png" class="avatar"> 413xk:</div>
<blockquote>
<p>Тогда усложню вопрос, как в контейнере оставить <a href="http://gofile.io">gofile.io </a>, но исключить *.gofile.io</p>
</blockquote>
</aside>
<p>Такой возможности в существующих скриптах нет.</p>
<aside class="quote no-group" data-username="413xk" data-post="454" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/4/ee59a6/48.png" class="avatar"> 413xk:</div>
<blockquote>
<p>ибо на файлообменнике все файлы лежат на субдоменах, и заблокирована, наверное, только морда</p>
</blockquote>
</aside>
<p>Часть провайдеров блокируют всю зону. Иными словами, блокировка <code>gofile.io</code> равнозначна блокировке <code>*.gofile.io</code>.</p></td><td>2023-02-24T07:39:44.975Z</td></tr><tr><td>vitfunk(Виталий)</td><td><p>добрый день! удалось решить проблему? у меня такая же проблема именно при работе со своим сервером, причем указанное по ссылке решение тоже не работает, решение работает только если сам сайт Instagram открывается, но не проходит авторизация, у меня не грузится ничего - сайт сразу выдает ошибку 429</p></td><td>2023-03-12T15:08:40.210Z</td></tr><tr><td>ValdikSS</td><td><p>Проблема в сервере, а не софте. Сам сайт блокирует доступ с IP-адреса вашего сервера.</p></td><td>2023-03-12T15:20:09.369Z</td></tr><tr><td>vitfunk(Виталий)</td><td><p>Перенес сервер на другой IP, проблема осталась, все та же 429 ошибка, не может Instagram блокировать свежий IP, который не использовался ещё, так что, думаю, все же проблема не в блокировке  IP, может, по какой-то причине происходит многократное обращение к серверам instagram?</p></td><td>2023-03-12T18:16:42.557Z</td></tr><tr><td>_sokol2007(Дмитрий)</td><td><p>Добрый. Какие то манипуляции надо делать на сервере в связи с этой новостью? <a href="https://ntc.party/t/vpn/3990" class="inline-onebox">Необходимо обновить файл VPN</a></p></td><td>2023-03-12T18:59:29.688Z</td></tr><tr><td>nzkhammatov(Ainur Khammatov)</td><td><p>Не</p></td><td>2023-03-12T19:14:50.177Z</td></tr><tr><td>ValdikSS</td><td><p>Нет.</p></td><td>2023-03-12T19:15:31.000Z</td></tr><tr><td>zzr</td><td><p>не пора ли обновить контейнер?<br>
<div class="lightbox-wrapper"><a class="lightbox" href="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/3c8e5fe66f2edf803c4adf5b04de3ddb8216dcf5.jpeg" data-download-href="https://ntc.party/uploads/default/3c8e5fe66f2edf803c4adf5b04de3ddb8216dcf5" title="Screenshot 2023-03-16 181532"><img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/3c8e5fe66f2edf803c4adf5b04de3ddb8216dcf5_2_690x24.jpeg" alt="Screenshot 2023-03-16 181532" data-base62-sha1="8DHGqUT3yxMrXRgquxEUJ5SALOZ" width="690" height="24" srcset="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/3c8e5fe66f2edf803c4adf5b04de3ddb8216dcf5_2_690x24.jpeg, контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/3c8e5fe66f2edf803c4adf5b04de3ddb8216dcf5_2_1035x36.jpeg 1.5x, контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/3c8e5fe66f2edf803c4adf5b04de3ddb8216dcf5.jpeg 2x" data-dominant-color="101011"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">Screenshot 2023-03-16 181532</span><span class="informations">1287×46 19.9 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div><br>
а то с последними весриями openvpn чёт не работает толком то block ouside dns failed то ещё чего нето не хватает</p></td><td>2023-03-16T15:17:02.872Z</td></tr><tr><td>sevastianovv(Sevastianovv)</td><td><p>Доброго. Подскажите как пересоздать конфиг для клиентов с новыми ключами?</p></td><td>2023-03-17T06:04:42.487Z</td></tr><tr><td>activio(Denis)</td><td><p>Добрый день.<br>
Давно замечал, но уже прям совсем плохо стал работать инстаграм на антизапрете (не публичный, свой). Еле грузится, подвисает и т.д причем когда как, но в основном плохо. Ну стоит переключиться на этом же сервере на wireguard, когда весь трафик гоняется через впн, то там летает инста. С чем это может связано? Установлен через systemd-machined.</p></td><td>2023-03-18T05:04:56.487Z</td></tr><tr><td>activio(Denis)</td><td><p>А иногда бывает, приходится start stop контейнера делать, чтобы стали открываться хоть какие то закрытые сайты. Но это другая думаю история.</p></td><td>2023-03-18T05:30:37.800Z</td></tr><tr><td>activio(Denis)</td><td><p>Хотя вот кажется после ребута сервиса, инстаграм прям отлично работать начинает.</p></td><td>2023-03-18T05:32:45.473Z</td></tr><tr><td>Joyz</td><td><p>Возможно я ошибаюсь, но в имидже контейнера отсутствует файл /root/easy-rsa-ipsec/CLIENT_KEY/antizapret-client-tcp.ovpn и установка ломается.</p></td><td>2023-03-20T19:02:41.889Z</td></tr><tr><td>zzr</td><td><p>fine, i’ll do it myself (c)</p>
<p>кароч попытался самолично обновить контейнер - поменял source.list на “свежий” дебиан 11, итого теперь не работает сеть в контейнере, куча демонов в состоянии failed и проч, как говорится - “не пытайтесь повторить это дома”, сейчас буду из бэкапа разворачивать…</p></td><td>2023-03-22T16:12:14.555Z</td></tr><tr><td>ValdikSS</td><td><p>Этот файл создаётся автоматически при первом запуске контейнера. Если у вас он не создаётся, скорее всего, у вас нет интернета в контейнере.</p></td><td>2023-03-23T10:58:50.072Z</td></tr><tr><td>holyshock</td><td><pre><code class="lang-auto">Mar 27 16:08:04 antizapret-vpn systemd[1]: Failed to start Knot Resolver daemon.
root@antizapret-vpn:~# systemctl status kresd@1.service
● kresd@1.service - Knot Resolver daemon
   Loaded: loaded (/lib/systemd/system/kresd@.service; enabled; vendor preset: enabled)
  Drop-In: /etc/systemd/system/kresd@.service.d
           └─override.conf
   Active: failed (Result: signal) since Mon 2023-03-27 16:08:04 UTC; 1min 13s ago
     Docs: man:kresd.systemd(7)
           man:kresd(8)
  Process: 480 ExecStart=/usr/sbin/kresd -c /usr/lib/knot-resolver/distro-preconfig.lua -c /etc/knot-resolver/kresd.conf -n (code=killed, signal=KILL)
 Main PID: 480 (code=killed, signal=KILL)

Mar 27 16:08:04 antizapret-vpn systemd[1]: kresd@1.service: Service RestartSec=100ms expired, scheduling restart.
Mar 27 16:08:04 antizapret-vpn systemd[1]: kresd@1.service: Scheduled restart job, restart counter is at 5.
Mar 27 16:08:04 antizapret-vpn systemd[1]: Stopped Knot Resolver daemon.
Mar 27 16:08:04 antizapret-vpn systemd[1]: kresd@1.service: Start request repeated too quickly.
Mar 27 16:08:04 antizapret-vpn systemd[1]: kresd@1.service: Failed with result 'signal'.
Mar 27 16:08:04 antizapret-vpn systemd[1]: Failed to start Knot Resolver daemon.
</code></pre>
<p>Что не так?</p></td><td>2023-03-27T16:16:53.269Z</td></tr><tr><td>ValdikSS</td><td><p>Возможно, oom-killer убивает процесс. Проверьте <code>dmesg</code>.</p></td><td>2023-03-27T16:17:14.370Z</td></tr><tr><td>holyshock</td><td><p>root@antizapret-vpn:~# dmesg<br>
dmesg: read kernel buffer failed: Operation not permitted</p>
<p>root@antizapret-vpn:~# /usr/sbin/kresd -c /usr/lib/knot-resolver/distro-preconfig.lua -c /etc/knot-resolver/kresd.conf -n<br>
[system] warning: hard limit for number of file-descriptors is only 4096 but recommended value is 524288<br>
environment variable $SYSTEMD_INSTANCE not set<br>
Killed</p>
<p>ubuntu 20.04<br>
Cores 1 / RAM 0.5 Gb / Disk 5 Gb<br>
machinectl</p>
<p>Update:<br>
[ 4209.874638] Out of memory: Killed process 4944 (kresd) total-vm:407996kB, anon-rss:274432kB, file-rss:0kB, shmem-rss:0kB, UID:1237450857 pgtables:688kB oom_score_adj:0</p></td><td>2023-03-27T16:19:26.166Z</td></tr><tr><td>ValdikSS</td><td><p>Необходим минимум гигабайт RAM. Описание в репозитории касательно требований устарели.</p></td><td>2023-03-27T16:31:49.215Z</td></tr><tr><td>holyshock</td><td><p>Понятненько, обидно. Спасибо за помощь. Попробую тариф обновить до гига.</p>
<p>Update:<br>
Все сразу завелось.</p></td><td>2023-03-27T16:33:10.977Z</td></tr><tr><td>kirill</td><td><p>а контейнер по адресу<br>
<a href="https://antizapret.prostovpn.org/container-images/az-vpn" class="onebox" target="_blank" rel="noopener nofollow ugc">https://antizapret.prostovpn.org/container-images/az-vpn</a><br>
доступен?</p>
<p>не могу скачать</p>
<p>upd: была проблема у провайдера vps с маршрутами</p></td><td>2023-03-29T20:49:00.073Z</td></tr><tr><td>nzkhammatov(Ainur Khammatov)</td><td><p><code>https://antizapret.prostovpn.org/container-images/az-vpn/lxd/lxd.tar.xz</code><br>
<code>https://antizapret.prostovpn.org/container-images/az-vpn/rootfs.tar.xz</code></p></td><td>2023-03-30T02:43:53.684Z</td></tr><tr><td>Alexled(alex)</td><td><p>Добрый день.<br>
Проблема с <a href="http://chat.openai.com" rel="noopener nofollow ugc">chat.openai.com</a></p>
<ol>
<li>Добавил ссылку в include-hosts-custom.txt</li>
<li>Пингую, заворачивает в 10.224</li>
<li>Захожу на сайт по ссылке, Access denied и ниже мой реальный IP адрес</li>
</ol>
<p>В чем может быть проблема?</p></td><td>2023-03-30T11:22:57.390Z</td></tr><tr><td>Kebu</td><td><p>Сегодня была такая же фигня — первый раз. До этого месяцы работало как часы. Тупо рестартнул контейнер и всё опять заработало.</p></td><td>2023-03-30T11:30:42.249Z</td></tr><tr><td>kirill</td><td><p>доброго времени суток</p>
<p>прошу помощи<br>
на днях потребовалось переустановить контейнер на CentOS 7 по этой инструкции</p><aside class="quote quote-modified" data-post="260" data-topic="129">
  <div class="title">
    <div class="quote-controls"></div>
    <img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/k/a9a28c/48.png" class="avatar">
    <a href="https://ntc.party/t/vpn/129/260">Контейнер VPN АнтиЗапрета для установки на собственный сервер</a> <a class="badge-category__wrapper " href="/c/antizapret-prostovpn-org/az-self-hosted/38"><span data-category-id="38" style="--category-badge-color: #0088CC; --category-badge-text-color: #FFFFFF; --parent-category-badge-color: #8C6238;" data-parent-category-id="5" data-drop-close="true" class="badge-category --has-parent" title="Вопросы и особенности работы контейнера VPN АнтиЗапрета на своих серверах"><span class="badge-category__name">АнтиЗапрет на собственном сервере (self-hosted)</span></span></a>
  </div>
  <blockquote>
    Когда-то ставил себе антизапрет на CentOS 7, 
нашёл в своих заметках, может, кому ещё пригодится (на полную правильность всего не претендую, я не профессиональный линуксоид) 
yum -y update
reboot

yum -y install epel-release
yum -y update

yum -y install yum-plugin-copr
yum -y copr enable ngompa/snapcore-el7

yum -y install snapd
systemctl enable --now snapd.socket

yum -y install http://download.zfsonlinux.org/epel/zfs-release.el7_4.noarch.rpm
yum -y install yum-utils
yum-config-manager --disab…
  </blockquote>
</aside>
<p>
но что-то пошло не так,<br>
по-моему я забыл ещё какие-то манипуляции записать сюда,<br>
и теперь суть такая:<br>
openvpn подключается,<br>
домены резолвятся,<br>
на незаблокированные с компа хожу, на заблокированные “десятки” – нет, пинга тоже нет</p>
<p>захожу на сам контейнер – с него все ресурсы тоже пингуются (заблокированные – по своим реальным ip) и трасировка ходит</p>
<p>что-то с “десятками” какая-то проблема на выход из контейнера</p>
<p>что-то с сетевыми интерфейсами там,<br>
маршрутизацию между интерфейсами подкрутить,<br>
бридж создать/прописать,…</p>
<p>я не помню…</p></td><td>2023-03-31T07:14:36.326Z</td></tr><tr><td>kirill</td><td><p>В общем,<br>
поставил пока на Ubuntu 20.04</p>
<p>apt-get update</p>
<p>apt-get -y upgrade</p>
<p>apt-get -y install nano mc lxd<br>
• v.4</p>
<p>reboot</p>
<p>apt-get -y autoremove</p>
<p>lxd init<br>
• What IPv6 address should be used? (CIDR subnet notation, “auto” or “none”) [default=auto]: none</p>
<p>reboot</p>
<p>lxc image import <a href="https://antizapret.prostovpn.org/container-images/az-vpn" rel="noopener nofollow ugc">https://antizapret.prostovpn.org/container-images/az-vpn</a> --alias antizapret-vpn-img<br>
lxc init antizapret-vpn-img antizapret-vpn<br>
lxc config device add antizapret-vpn proxy_1194 proxy listen=tcp:[::]:1194 connect=tcp:127.0.0.1:1194<br>
lxc config device add antizapret-vpn proxy_1194_udp proxy listen=udp:[::]:1194 connect=udp:127.0.0.1:1194<br>
lxc start antizapret-vpn<br>
sleep 20<br>
lxc file pull antizapret-vpn/root/easy-rsa-ipsec/CLIENT_KEY/antizapret-client-tcp.ovpn antizapret-client-tcp.ovpn</p>
<p>ufw default deny incoming<br>
ufw default allow outgoing<br>
ufw allow ssh<br>
ufw allow 1194/tcp<br>
ufw allow 1194/udp<br>
ufw allow in on lxdbr0<br>
ufw route allow in on lxdbr0</p>
<p>ufw enable</p>
<p>ufw status numbered</p>
<p>так сразу работает</p>
<p>пробовал с другими разными дистрибутивами ubuntu, и debian в т.ч., где в т.ч. lxd через snap ставится – везде какой-то геморрой,<br>
надо пилить,<br>
я недопилил</p>
<p>на machinectl с брандмауэром и так и эдак – победить тоже так и не смог</p>
<p>применил пока только эти твики:<br>
• <a href="https://ntc.party/t/vpn/129/329" class="inline-onebox">Контейнер VPN АнтиЗапрета для установки на собственный сервер - #329 by ValdikSS</a><br>
• <a href="https://ntc.party/t/vpn-vpn/2040/2" class="inline-onebox">Контейнер VPN АнтиЗапрета + опциональный пуск всего трафика через VPN (на личном сервере) - #2 by ValdikSS</a><br>
насчёт актуальности остальных надо посмотреть</p>
<p>p.s.: по CentOS</p><aside class="quote quote-modified" data-post="485" data-topic="129">
  <div class="title">
    <div class="quote-controls"></div>
    <img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/k/a9a28c/48.png" class="avatar">
    <a href="https://ntc.party/t/vpn/129/485">Контейнер VPN АнтиЗапрета для установки на собственный сервер</a> <a class="badge-category__wrapper " href="/c/antizapret-prostovpn-org/az-self-hosted/38"><span data-category-id="38" style="--category-badge-color: #0088CC; --category-badge-text-color: #FFFFFF; --parent-category-badge-color: #8C6238;" data-parent-category-id="5" data-drop-close="true" class="badge-category --has-parent" title="Вопросы и особенности работы контейнера VPN АнтиЗапрета на своих серверах"><span class="badge-category__name">АнтиЗапрет на собственном сервере (self-hosted)</span></span></a>
  </div>
  <blockquote>
    доброго времени суток 
прошу помощи 
на днях потребовалось переустановить контейнер на CentOS 7 по этой инструкции 
<a href="https://ntc.party/t/vpn/129/260" class="onebox" target="_blank" rel="noopener">https://ntc.party/t/vpn/129/260</a> 
но что-то пошло не так, 
по-моему я забыл ещё какие-то манипуляции записать сюда, 
и теперь суть такая: 
openvpn подключается, 
домены резолвятся, 
на незаблокированные с компа хожу, на заблокированные “десятки” – нет, пинга тоже нет 
захожу на сам контейнер – с него все ресурсы тоже пингуются (заблокированные – по своим реальным ip) и трасировка хо…
  </blockquote>
</aside>
<p>
всё же если кто-то что-то подскажет – для меня актуально остаётся</p>
<p>p.p.s: всё-таки нужны доп. твики по google и fb (твиттор)</p>
<p>lxc exec antizapret-vpn – nano /root/antizapret/config/include-hosts-custom.txt</p>
<p><a href="http://t.co" class="onebox" target="_blank" rel="noopener nofollow ugc">t.co</a><br>
<a href="http://twimg.com" target="_blank" rel="noopener nofollow ugc">twimg.com</a><br>
<a href="http://fbcdn.net" target="_blank" rel="noopener nofollow ugc">fbcdn.net</a><br>
<a href="http://cdninstagram.com" target="_blank" rel="noopener nofollow ugc">cdninstagram.com</a><br>
<a href="http://fb.com" target="_blank" rel="noopener nofollow ugc">fb.com</a><br>
<a href="http://messenger.com" target="_blank" rel="noopener nofollow ugc">messenger.com</a><br>
<a href="http://theins.ru" target="_blank" rel="noopener nofollow ugc">theins.ru</a><br>
<a href="http://news.google.com" target="_blank" rel="noopener nofollow ugc">news.google.com</a><br>
<a href="http://play.google.com" target="_blank" rel="noopener nofollow ugc">play.google.com</a><br>
<a href="http://photos.google.com" target="_blank" rel="noopener nofollow ugc">photos.google.com</a><br>
<a href="http://netflix.com" target="_blank" rel="noopener nofollow ugc">netflix.com</a><br>
<a href="http://api.fast.com" target="_blank" rel="noopener nofollow ugc">api.fast.com</a><br>
<a href="http://googleusercontent.com" target="_blank" rel="noopener nofollow ugc">googleusercontent.com</a></p>
<p>lxc exec antizapret-vpn – nano /root/antizapret/scripts/getzones.awk</p>
<p>…appspot|my1|hwcdn|google|fast).[^.]+$/))</p>
<p>lxc exec antizapret-vpn – nano /root/antizapret/config/exclude-hosts-dist.txt<br>
удаляем<br>
<a href="http://googleusercontent.com" target="_blank" rel="noopener nofollow ugc">googleusercontent.com</a></p>
<p>lxc exec antizapret-vpn – nano /root/antizapret/config/include-hosts-custom.txt<br>
добавляем<br>
<a href="http://googleusercontent.com" target="_blank" rel="noopener nofollow ugc">googleusercontent.com</a></p>
<p>lxc exec antizapret-vpn – nano /root/antizapret/config/exclude-regexp-dist.awk<br>
#(/googleusercontent.com/) {next}</p>
<p>lxc exec antizapret-vpn – bash<br>
apt-get update<br>
apt-get install socat -y<br>
LANG=C.UTF-8 /root/antizapret/doall.sh<br>
echo ‘cache.clear()’|socat - /run/knot-resolver/control/1<br>
exit</p></td><td>2023-03-31T18:20:54.367Z</td></tr><tr><td>Yarprogress</td><td><p>Добрый день. Подскажите, как с минимальным вмешательством настроить контейнер антизапрета, чтоб он выступал локальным днс сервером в домашней сети и прозрачно для клиентских устройств обходил блокировки без использования openvpn?<br>
p.s. подключить контейнер к VDS в Европе у меня получилось uplink в интернет без ограничений у контейнера есть, вопрос именно в том, чтоб другие пк в локальной сети могли к нему обращаться и маршрутизировать запрещенный трафик через него</p></td><td>2023-04-01T10:54:32.864Z</td></tr><tr><td>kirill</td><td><p>Конфиг в роутер (например, keenetic) с поддержкой OpenVPN</p>
<p>самый простой и очевидный способ</p></td><td>2023-04-01T13:43:34.592Z</td></tr><tr><td>Joyz</td><td><p>Запустил контейнер с антизапретом на своем VPS, подключил на роутере и столкнулся с тем, что некоторые сайты не подподающие под запрет перестали открываться. Браузер ругается на DNS_PROBE_FINISHED_NXDOMAIN.<br>
Например <a href="http://www.synology.com" rel="noopener nofollow ugc">www.synology.com</a> на компьютере не резолвиться<br>
nslookup <a href="http://www.synology.com" rel="noopener nofollow ugc">www.synology.com</a><br>
Address: 192.168.1.1<br>
DNS request timed out.<br>
timeout was 2 seconds.</p>
<p>Попробовал на самой VPS, там все нормально.<br>
nslookup <a href="http://www.synology.com" rel="noopener nofollow ugc">www.synology.com</a><br>
Server:         127.0.0.53<br>
Address:        127.0.0.53#53<br>
Non-authoritative answer:<br>
Name:   <a href="http://www.synology.com" rel="noopener nofollow ugc">www.synology.com</a><br>
Address: 52.85.49.76</p>
<p>В /etc/systemd/resolved.conf прописано DNS=94.140.14.14 149.112.112.112<br>
В /etc/network/interfaces тоже прописано dns-nameservers 94.140.14.14 149.112.112.112</p>
<p>На команду systemd-resolve --status | grep ‘DNS Servers’ -A2<br>
Выдает<br>
DNS Servers: 94.140.14.14<br>
149.112.112.112<br>
DNSSEC NTA: 10.in-addr.arpa</p>
<p>Пробовал указывать другие сервера, результат не меняется.<br>
В чем может быть проблема и где копать ?</p></td><td>2023-04-05T05:25:44.687Z</td></tr><tr><td>ValdikSS</td><td><p>В контейнере установлен рекурсивный резолвер, сторонние DNS-резолверы используются разве что для обновления листа и других системных целей.</p>
<p>Чтобы выполнить команду через резолвер, используйте:</p>
<pre><code class="lang-bash">host www.synology.com 127.0.0.1
dig www.synology.com @127.0.0.1
</code></pre>
<p>Возможно, с вашего IP-адреса недоступны NS-серверы этого домена.</p></td><td>2023-04-05T17:59:50.359Z</td></tr><tr><td>Joyz</td><td><aside class="quote no-group" data-username="ValdikSS" data-post="490" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/valdikss/48/2_2.png" class="avatar"> ValdikSS:</div>
<blockquote>
<p><code>dig www.synology.com @127.0.0.1</code></p>
</blockquote>
</aside>
<p>host <a href="http://www.synology.com" rel="noopener nofollow ugc">www.synology.com</a> 127.0.0.1<br>
;; connection timed out; no servers could be reached</p>
<p>Ответ есть только при указании 127.0.0.53</p>
<p>host <a href="http://www.synology.com" rel="noopener nofollow ugc">www.synology.com</a> 127.0.0.53<br>
Using domain server:<br>
Name: 127.0.0.53<br>
Address: 127.0.0.53#53<br>
Aliases:<br>
<a href="http://www.synology.com" rel="noopener nofollow ugc">www.synology.com</a> has address 143.204.215.4<br>
<a href="http://www.synology.com" rel="noopener nofollow ugc">www.synology.com</a> has address 143.204.215.73<br>
<a href="http://www.synology.com" rel="noopener nofollow ugc">www.synology.com</a> has address 143.204.215.27<br>
<a href="http://www.synology.com" rel="noopener nofollow ugc">www.synology.com</a> has address 143.204.215.53</p>
<p>dig <a href="http://www.synology.com" rel="noopener nofollow ugc">www.synology.com</a> <span class="mention">@127.0.0.53</span><br>
; &lt;&lt;&gt;&gt; DiG 9.16.1-Ubuntu &lt;&lt;&gt;&gt; <a href="http://www.synology.com" rel="noopener nofollow ugc">www.synology.com</a> <span class="mention">@127.0.0.53</span><br>
;; global options: +cmd<br>
;; Got answer:<br>
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 53375<br>
;; flags: qr rd ra; QUERY: 1, ANSWER: 4, AUTHORITY: 0, ADDITIONAL: 1</p>
<p>;; OPT PSEUDOSECTION:<br>
; EDNS: version: 0, flags:; udp: 65494<br>
;; QUESTION SECTION:<br>
;<a href="http://www.synology.com" rel="noopener nofollow ugc">www.synology.com</a>.              IN      A<br>
;; ANSWER SECTION:<br>
<a href="http://www.synology.com" rel="noopener nofollow ugc">www.synology.com</a>.       49      IN      A       143.204.215.53<br>
<a href="http://www.synology.com" rel="noopener nofollow ugc">www.synology.com</a>.       49      IN      A       143.204.215.27<br>
<a href="http://www.synology.com" rel="noopener nofollow ugc">www.synology.com</a>.       49      IN      A       143.204.215.73<br>
<a href="http://www.synology.com" rel="noopener nofollow ugc">www.synology.com</a>.       49      IN      A       143.204.215.4<br>
;; Query time: 0 msec<br>
;; SERVER: 127.0.0.53#53(127.0.0.53)<br>
;; WHEN: Wed Apr 05 23:47:37 MSK 2023<br>
;; MSG SIZE  rcvd: 109</p></td><td>2023-04-05T20:52:06.905Z</td></tr><tr><td>Technocat(Konstantin)</td><td><p>Доброго времени суток! Не знаю, может быть не по адресу.<br>
Установил свой сервак на <a href="http://vdsina.ru" rel="noopener nofollow ugc">vdsina.ru</a> (ubuntu 22.04, 30 гигов места, гиг оперативки), есть проблема: ровно раз в месяц сервак просто отваливается. Нет соединения по адресу, хотя всё пингуется. Перезагрузка, в том числе и жёсткая, не помогает. Приходится восстанавливать из резервной копии, тогда начинает работать, но только на месяц. Раньше было меньше места под сервак, так он работал пару-тройку дней, и отваливался. Такое чувство, что просто место забивается, возможно логами, и сервак даёт дуба. Есть ли какие-нибудь советы? Заранее благодарен.</p></td><td>2023-04-06T07:59:19.224Z</td></tr><tr><td>nzkhammatov(Ainur Khammatov)</td><td><aside class="quote no-group" data-username="Technocat" data-post="492" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/t/87869e/48.png" class="avatar"> Technocat:</div>
<blockquote>
<p><a href="http://vdsina.ru" rel="noopener nofollow ugc">vdsina.ru</a></p>
</blockquote>
</aside>
<p><strong>Меняйте поставщика услуг.</strong></p></td><td>2023-04-06T08:48:43.870Z</td></tr><tr><td>Technocat(Konstantin)</td><td><p>Спасибо. Можете что-нибудь посоветовать? Главное, чтобы хостинг за рубежом был, и платить можно было без проблем.</p></td><td>2023-04-06T11:55:08.826Z</td></tr><tr><td>Kebu</td><td><p>Inferno</p></td><td>2023-04-06T12:04:53.469Z</td></tr><tr><td>nzkhammatov(Ainur Khammatov)</td><td><aside class="quote no-group" data-username="Technocat" data-post="494" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/t/87869e/48.png" class="avatar"> Technocat:</div>
<blockquote>
<p>Главное, чтобы хостинг за рубежом был, и платить можно было без проблем.</p>
</blockquote>
</aside>
<aside class="quote no-group" data-username="Kebu" data-post="495" data-topic="129" data-full="true">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/k/8797f3/48.png" class="avatar"> Kebu:</div>
<blockquote>
<p>Inferno</p>
</blockquote>
</aside>
<p><code>https://cp.inferno.name/knowledgebase/12/Oplata-uslug</code><br>
<code>https://cp.inferno.name/cart.php?gid=37</code></p>
<p>Попробуйте, несколько раз упоминали здесь.<br>
Сам их услугами пока не пользуюсь.</p>
<details>
<summary>
Такой конфигурации будет достаточно</summary>
<p><div class="lightbox-wrapper"><a class="lightbox" href="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/73c42f0c1d891e51b47c7dad82e49c0233790151.png" data-download-href="https://ntc.party/uploads/default/73c42f0c1d891e51b47c7dad82e49c0233790151" title="Inferno Solutions"><img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/73c42f0c1d891e51b47c7dad82e49c0233790151_2_517x276.png" alt="Inferno Solutions" data-base62-sha1="gw7ejC2ll4aXijvMAegTFsFN0oV" width="517" height="276" srcset="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/73c42f0c1d891e51b47c7dad82e49c0233790151_2_517x276.png, контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/73c42f0c1d891e51b47c7dad82e49c0233790151.png 1.5x, контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/73c42f0c1d891e51b47c7dad82e49c0233790151.png 2x" data-dominant-color="DFE5F1"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">Inferno Solutions</span><span class="informations">765×410 50.1 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
</details></td><td>2023-04-06T12:08:32.507Z</td></tr><tr><td>Technocat(Konstantin)</td><td><p>Спасибо большое, попробую.</p></td><td>2023-04-06T21:18:06.280Z</td></tr><tr><td>stupidityIsntCrime</td><td><p>а что с етими не так? я взял себе дешман варикант якобы в нигерландах, только почему то половину сайтов палят етот айпишник как российский и не пускают соответсвенно на сайт(<a href="http://dell.com" rel="noopener nofollow ugc">dell.com</a>, <a href="http://intel.com" rel="noopener nofollow ugc">intel.com</a>, <a href="http://cisco.com" rel="noopener nofollow ugc">cisco.com</a>), а 2ip ваще показывает что провайдер некий “точка доступа”, я что то сомневаюсь что в нигерландах есть такие), тем не менее по whois показывает что country NL, а в тех. понтдержке говорят что ето прост админисраторы сайтов не обновили свои geoipdb</p></td><td>2023-04-07T17:07:08.316Z</td></tr><tr><td>kirill</td><td><p>сегодня обратил внимание,<br>
что в twitter не прогружаются видео: “Содержимое недоступно” на белом фоне<br>
при этом фото – всё ок<br>
настройки в include-hosts-custom.txt как тут <a href="https://ntc.party/t/vpn/129/486" class="inline-onebox">Контейнер VPN АнтиЗапрета для установки на собственный сервер - #486 by kirill</a><br>
как пофиксить?</p>
<p>upd. на домашнем проводном интернете всё ок,<br>
какая-то борода на “мобилке”<br>
буду разбираться</p>
<p>вопрос в принципе снят</p></td><td>2023-04-07T22:48:18.727Z</td></tr><tr><td>maxpain(Maxim Makarov)</td><td><p>Подскажите, пожалуйста, как сбросить кэш в DNS-сервере?<br>
Команда <code>/root/antizapret/doall.sh</code> этого не делает.<br>
Зашел на заблокированный домен, он попал в кэш с TTL 3600 секунд, далее добавил его в <code>/root/antizapret/config/include-hosts-custom.txt</code> и сделал <code>LANG=C.UTF-8 /root/antizapret/doall.sh</code>. И всё-равно отдаётся оригинальный IP-адрес.</p></td><td>2023-04-09T19:35:36.604Z</td></tr><tr><td>ValdikSS</td><td><p><code>echo "cache.clear()" | socat - /run/knot-resolver/control/1</code></p></td><td>2023-04-10T10:36:02.251Z</td></tr><tr><td>maxpain(Maxim Makarov)</td><td><p><a class="mention" href="/u/valdikss">@ValdikSS</a> спасибо. Теперь другой вопрос. Как создать дополнительные .ovpn профили для других устройств?</p></td><td>2023-04-10T15:38:11.694Z</td></tr><tr><td>ValdikSS</td><td><hr>
<aside class="quote no-group quote-modified" data-username="ValdikSS" data-post="199" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/valdikss/48/2_2.png" class="avatar"> ValdikSS:</div>
<blockquote>
<p>Можете использовать один общий конфигурационный файл. Дополнительные ключи можно создать вручную, например, так (внутри контейнера):</p>
<pre><code class="lang-auto">cd /root/easy-rsa-ipsec/easyrsa3
./easyrsa build-client-full "client2" nopass nodatetime
</code></pre>
<p>Файлы будут расположены в <code>./pki/issued/client2.crt</code> и <code>./pki/private/client2.key</code>. Конфигурационный файл OpenVPN необходимо будет создать вручную (замените сертификат  и ключ  в существующем).</p>
</blockquote>
</aside></td><td>2023-04-10T19:30:16.683Z</td></tr><tr><td>maxpain(Maxim Makarov)</td><td><p>Спасибо большое. Поставил своим родным и друзьям профиль на роутер, всё работает как часы <img src="https://ntc.party/images/emoji/twitter/slight_smile.png?v=12" title=":slight_smile:" class="emoji" alt=":slight_smile:" loading="lazy" width="20" height="20"></p></td><td>2023-04-11T08:39:33.431Z</td></tr><tr><td>Aleksei</td><td><p><a class="mention" href="/u/valdikss">@ValdikSS</a> клиент twitter на ios с недавнего времени использует dns-запрос типа ‘HTTPS’ для CDN-ов с картинками. Подозреваю, что клиенты Instagram и Facebook работают так же. В логе имеется вот это:</p>
<p>|Type|Domain|Client|Status|Reply|<br>
|HTTPS|api-0-4-6.twitter.com|10.6.0.2|OK, answered by 192.168.104.1#53|SERVFAIL (1939.6ms)|</p>
<p>Как результат картинки не грузятся. Мой локальный контейнер не умеет обрабатывать тип dns-запроса ‘HTTPS’. Публичный конетйнер антизапрета успешно резолвит эти запросы. Помогите, пожалуйста.</p></td><td>2023-04-13T14:02:55.455Z</td></tr><tr><td>kirill</td><td><p>так вот оно что,<br>
а то я <a href="https://ntc.party/t/vpn/129/499">тут</a> голову сломал</p>
<p>устал уже в инстаграме ленту по двадцать раз обновлять,<br>
чтобы что-то на iOS прогрузилось,<br>
да и в твиттер видео через раз – содержимое недоступно пишет</p></td><td>2023-04-13T16:53:26.420Z</td></tr><tr><td>Technocat(Konstantin)</td><td><p>Не работает. Хорошо, что на месяц заплатил. Проблема в установке LXD, на последних этапах он ругается, что не может соединиться к серверам Ubuntu. Соответственно, не устанавливается контейнер Антизапрета.<br>
Пробовал скрипт установки от YouROK, вроде бы кубатурит что-то, но в итоге не выдаёт файл конфига OpenVPN на последнем этапе.<br>
Так что пока остаюсь на прежнем хостинге, буду раз в месяц его восстанавливать из архива… <img src="https://ntc.party/images/emoji/twitter/frowning.png?v=12" title=":frowning:" class="emoji" alt=":frowning:" loading="lazy" width="20" height="20"></p></td><td>2023-04-14T09:16:34.796Z</td></tr><tr><td>Kebu</td><td><p>Проблема где-то у вас — никаких проблем с инстой на iOs не появилось, всё работает как и раньше.</p></td><td>2023-04-14T09:27:32.747Z</td></tr><tr><td>kirill</td><td><p>такой многозначительный вывод вы сделали лишь на основе того, что <em>именно у вас</em> всё работает?</p></td><td>2023-04-15T08:23:40.693Z</td></tr><tr><td>ValdikSS</td><td><aside class="quote no-group" data-username="Aleksei" data-post="505" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/a/7c8e57/48.png" class="avatar"> Aleksei:</div>
<blockquote>
<p>клиент twitter на ios с недавнего времени использует dns-запрос типа ‘HTTPS’ для CDN-ов с картинками. Подозреваю, что клиенты Instagram и Facebook работают так же.</p>
</blockquote>
</aside>
<aside class="quote no-group" data-username="Aleksei" data-post="505" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/a/7c8e57/48.png" class="avatar"> Aleksei:</div>
<blockquote>
<p>SERVFAIL</p>
</blockquote>
</aside>
<p>Предоставьте вывод обеих команд:</p>
<pre><code class="lang-auto">dig TYPE65 api-0-4-6.twitter.com @127.0.0.1
dig TYPE65 api-0-4-6.twitter.com @127.0.0.4
</code></pre></td><td>2023-04-18T17:22:09.141Z</td></tr><tr><td>kirill</td><td><p>iphone + megafon + vpn</p>
<pre><code class="lang-auto">$ dig TYPE65 api-0-4-6.twitter.com @127.0.0.1
; &lt;&lt;&gt;&gt; DiG 9.9.7-P3 &lt;&lt;&gt;&gt; TYPE65 api-0-4-6.twitter.com @127.0.0.1
;; connection timed out; no servers could be reached
$ dig TYPE65 api-0-4-6.twitter.com @127.0.0.4
; &lt;&lt;&gt;&gt; DiG 9.9.7-P3 &lt;&lt;&gt;&gt; TYPE65 api-0-4-6.twitter.com @127.0.0.4
;; connection timed out; no servers could be reached
$
</code></pre></td><td>2023-04-18T17:51:50.611Z</td></tr><tr><td>ValdikSS</td><td><p>Эти команды необходимо выполнить в контейнере.</p></td><td>2023-04-18T17:58:55.463Z</td></tr><tr><td>kirill</td><td><pre><code class="lang-auto">root@antizapret-vpn:~# dig TYPE65 api-0-4-6.twitter.com @127.0.0.1

; &lt;&lt;&gt;&gt; DiG 9.11.5-P4-5.1+deb10u8-Debian &lt;&lt;&gt;&gt; TYPE65 api-0-4-6.twitter.com @127.0.0.1
;; global options: +cmd
;; Got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: SERVFAIL, id: 31244
;; flags: qr rd ra; QUERY: 1, ANSWER: 0, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 4096
;; QUESTION SECTION:
;api-0-4-6.twitter.com.		IN	TYPE65

;; Query time: 1833 msec
;; SERVER: 127.0.0.1#53(127.0.0.1)
;; WHEN: Tue Apr 18 21:39:01 UTC 2023
;; MSG SIZE  rcvd: 50

root@antizapret-vpn:~# dig TYPE65 api-0-4-6.twitter.com @127.0.0.4

; &lt;&lt;&gt;&gt; DiG 9.11.5-P4-5.1+deb10u8-Debian &lt;&lt;&gt;&gt; TYPE65 api-0-4-6.twitter.com @127.0.0.4
;; global options: +cmd
;; connection timed out; no servers could be reached
root@antizapret-vpn:~#
</code></pre></td><td>2023-04-18T21:41:37.571Z</td></tr><tr><td>ValdikSS</td><td><p>А если<br>
<code>dig TYPE65 api-0-4-6.twitter.com @8.8.8.8</code></p></td><td>2023-04-19T07:16:03.069Z</td></tr><tr><td>Aleksei</td><td><p>у меня так:</p>
<pre><code class="lang-auto">root@antizapret-vpn:~# dig TYPE65 api-0-4-6.twitter.com @127.0.0.1

; &lt;&lt;&gt;&gt; DiG 9.11.5-P4-5.1+deb10u1-Debian &lt;&lt;&gt;&gt; TYPE65 api-0-4-6.twitter.com @127.0.0.1
;; global options: +cmd
;; Got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: SERVFAIL, id: 56688
;; flags: qr rd ra; QUERY: 1, ANSWER: 0, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 4096
;; QUESTION SECTION:
;api-0-4-6.twitter.com.         IN      TYPE65

;; Query time: 1835 msec
;; SERVER: 127.0.0.1#53(127.0.0.1)
;; WHEN: Wed Apr 19 10:23:47 MSK 2023
;; MSG SIZE  rcvd: 50

root@antizapret-vpn:~# dig TYPE65 api-0-4-6.twitter.com @127.0.0.4

; &lt;&lt;&gt;&gt; DiG 9.11.5-P4-5.1+deb10u1-Debian &lt;&lt;&gt;&gt; TYPE65 api-0-4-6.twitter.com @127.0.0.4
;; global options: +cmd
;; connection timed out; no servers could be reached
root@antizapret-vpn:~# dig TYPE65 api-0-4-6.twitter.com @8.8.8.8

; &lt;&lt;&gt;&gt; DiG 9.11.5-P4-5.1+deb10u1-Debian &lt;&lt;&gt;&gt; TYPE65 api-0-4-6.twitter.com @8.8.8.8
;; global options: +cmd
;; Got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 49662
;; flags: qr rd ra; QUERY: 1, ANSWER: 0, AUTHORITY: 1, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 512
;; QUESTION SECTION:
;api-0-4-6.twitter.com.         IN      TYPE65

;; AUTHORITY SECTION:
twitter.com.            289     IN      SOA     a.u06.twtrdns.net. noc\@twitter.com. 2023041201 3600 600 604800 180

;; Query time: 4 msec
;; SERVER: 8.8.8.8#53(8.8.8.8)
;; WHEN: Wed Apr 19 10:24:12 MSK 2023
;; MSG SIZE  rcvd: 115

</code></pre></td><td>2023-04-19T07:34:04.178Z</td></tr><tr><td>Kebu</td><td><p>Аналогично и у меня</p></td><td>2023-04-19T07:42:31.430Z</td></tr><tr><td>sevastianovv(Sevastianovv)</td><td><p>доброго. а нас коснется?</p><aside class="quote quote-modified" data-post="1" data-topic="4269">
  <div class="title">
    <div class="quote-controls"></div>
    <img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/valdikss/48/2_2.png" class="avatar">
    <a href="https://ntc.party/t/topic/4269">Блокировка АнтиЗапрета</a> <a class="badge-category__wrapper " href="/c/antizapret-prostovpn-org/5"><span data-category-id="5" style="--category-badge-color: #8C6238; --category-badge-text-color: #FFFFFF;" data-drop-close="true" class="badge-category " title="Proxy and VPN service for Russian censorship circumvention, discussion and official support forum. Обсуждение работы сервиса обхода блокировок России АнтиЗапрет. Новости, уведомления о проблемах и помощь в настройке."><span class="badge-category__name">antizapret.prostovpn.org</span></span></a>
  </div>
  <blockquote>
    <a name="h-1" class="anchor" href="#h-1"></a>Что случилось
Сервис АнтиЗапрет заблокировали в РФ. 
Сегодня (2023-04-10T00:00:00Z (UTC)) в 9 утра по московскому времени домен antizapret.prostovpn.org был заблокирован средствами оборудования ТСПУ, из-за чего сайт проекта перестал открываться из России, листы блокировки перестали скачиваться, расширение сообщало об ошибке обновления у большинства провайдеров интернета. 
Домен не вносили в официальный реестр запрещённой информации, каких-либо уведомлений от Роскомнадзора или ГРЧЦ не поступало. …
  </blockquote>
</aside>
</td><td>2023-04-20T08:21:43.000Z</td></tr><tr><td>ValdikSS</td><td><pre><code class="lang-auto">apt remove python3-dnslib &amp;&amp; apt -y install python3-pip
pip3 install dnslib
</code></pre></td><td>2023-04-20T09:36:58.150Z</td></tr><tr><td>Kebu</td><td><p>Установил, перезагрузил, всё равно так:</p>
<pre><code class="lang-auto">root@antizapret-vpn:~# dig TYPE65 api-0-4-6.twitter.com @127.0.0.4

; &lt;&lt;&gt;&gt; DiG 9.11.5-P4-5.1+deb10u1-Debian &lt;&lt;&gt;&gt; TYPE65 api-0-4-6.twitter.com @127.0.0.4
;; global options: +cmd
;; connection timed out; no servers could be reached
</code></pre></td><td>2023-04-20T09:57:54.888Z</td></tr><tr><td>Aleksei</td><td><p>У меня теперь работает. Большое спасибо!</p>
<pre><code class="lang-auto">root@antizapret-vpn:~# dig TYPE65 api-0-4-6.twitter.com @127.0.0.1

; &lt;&lt;&gt;&gt; DiG 9.11.5-P4-5.1+deb10u1-Debian &lt;&lt;&gt;&gt; TYPE65 api-0-4-6.twitter.com @127.0.0.1
;; global options: +cmd
;; Got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 24827
;; flags: qr rd ra; QUERY: 1, ANSWER: 0, AUTHORITY: 1, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 4096
;; QUESTION SECTION:
;api-0-4-6.twitter.com.         IN      TYPE65

;; AUTHORITY SECTION:
twitter.com.            95      IN      SOA     a.u06.twtrdns.net. noc.twitter.com. 2023041201 3600 600 604800 180

;; Query time: 60 msec
;; SERVER: 127.0.0.1#53(127.0.0.1)
;; WHEN: Thu Apr 20 15:11:00 MSK 2023
;; MSG SIZE  rcvd: 118

</code></pre></td><td>2023-04-20T12:12:14.338Z</td></tr><tr><td>Kebu</td><td><pre><code class="lang-auto">dig TYPE65 api-0-4-6.twitter.com @127.0.0.4
</code></pre>
<p>Тоже работает?</p></td><td>2023-04-20T12:21:40.634Z</td></tr><tr><td>Aleksei</td><td><p>работает</p>
<pre><code class="lang-auto">root@antizapret-vpn:~# dig TYPE65 api-0-4-6.twitter.com @127.0.0.4

; &lt;&lt;&gt;&gt; DiG 9.11.5-P4-5.1+deb10u1-Debian &lt;&lt;&gt;&gt; TYPE65 api-0-4-6.twitter.com @127.0.0.4
;; global options: +cmd
;; Got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 40030
;; flags: qr rd ra; QUERY: 1, ANSWER: 0, AUTHORITY: 1, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 512
;; QUESTION SECTION:
;api-0-4-6.twitter.com.         IN      TYPE65

;; AUTHORITY SECTION:
twitter.com.            38      IN      SOA     a.u06.twtrdns.net. noc.twitter.com. 2023041201 3600 600 604800 180

;; Query time: 15 msec
;; SERVER: 127.0.0.4#53(127.0.0.4)
;; WHEN: Thu Apr 20 15:30:36 MSK 2023
;; MSG SIZE  rcvd: 107

</code></pre></td><td>2023-04-20T12:31:08.418Z</td></tr><tr><td>kirill</td><td><p>да,<br>
теперь<br>
<code>dig TYPE65 api-0-4-6.twitter.com @127.0.0.4</code><br>
отрабатывает успешно,</p>
<p>да и instagrem и twitter субъективно (точнее сказать не могу – мне непонятно, что это было и как повлияло) открываются теперь влёт</p>
<p><strong>ValdikSS</strong>, можно вкратце пояснить?</p></td><td>2023-04-20T20:18:05.115Z</td></tr><tr><td>Chiffa(Chiffa)</td><td><p>есть вопрос по работе контейнера, нужно ли его перезапускать периодически для стабильной работы? или все должно работать максимально долго без каких либо проблем</p></td><td>2023-04-22T06:07:19.157Z</td></tr><tr><td>nzkhammatov(Ainur Khammatov)</td><td><aside class="quote no-group" data-username="Chiffa" data-post="525" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/chiffa/48/2495_2.png" class="avatar"> Chiffa:</div>
<blockquote>
<p>вопрос по работе контейнера, нужно ли его перезапускать периодически для стабильной работы?</p>
</blockquote>
</aside>
<p>Чуть более 3 лет использую, ни разу не приходилось таким заниматься.</p></td><td>2023-04-22T11:05:29.396Z</td></tr><tr><td>mejorcorreo</td><td><p>Доброго времени суток. Добавил в include-hosts-custom.txt нужные мне хосты, а именно: <a href="http://6pm.com" rel="noopener nofollow ugc">6pm.com</a> и <a href="http://netflix.com" rel="noopener nofollow ugc">netflix.com</a>, через какое-то время сайты стали открываться, потом опять перестали. И вот так периодечски то начинают работать “волшебным” образом, то опять перестают. В чем может быть проблема?<br>
Заранее спасибо за ответ</p></td><td>2023-04-26T10:47:56.478Z</td></tr><tr><td>413xk</td><td><p>Как проверить почему не работают OpenNIC домены?<br>
Та же flibusta.lib не пингуется прям из контейнера (unknow host), dig <span class="mention">@127.0.0.4</span> то же не знает о данном адресе ничего.</p>
<p>Кусок</p>
<pre><code class="lang-auto">policy.add(
    policy.suffix(
        policy.STUB(
            {'172.104.136.243', '176.126.70.119', '87.98.175.85', '193.183.98.66'}
        ),
        policy.todnames({'bbs.', 'chan.', 'cyb.', 'dyn.', 'geek.', 'gopher.',
                         'indy.', 'libre.', 'neo.', 'null.', 'o.', 'oss.', 'oz.',
                         'parody.', 'pirate.', 'free.', 'bazar.', 'coin.',
                         'emc.', 'lib.', 'fur.', 'bit.', 'ku.', 'te.', 'ti.', 'uu.'
                         }
        )

</code></pre>
<p>на месте.</p></td><td>2023-05-03T04:24:01.561Z</td></tr><tr><td>Kebu</td><td><p>Перестал работать инстаграм, хотя ничего не менял в настройках. Перезагружал, результата нет. Еще у кого-нибудь появились проблемы?</p>
<p>И gpt через раз открывается, периодически показывает сообщение  «доступ запрещен»</p></td><td>2023-05-10T18:37:22.641Z</td></tr><tr><td>ValdikSS</td><td><p>Все перечисленные в конфигурационном файле резолверы мертвы.</p></td><td>2023-05-16T14:32:10.848Z</td></tr><tr><td>kirill</td><td><aside class="quote" data-post="30" data-topic="40">
  <div class="title">
    <div class="quote-controls"></div>
    <img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/valdikss/48/2_2.png" class="avatar">
    <a href="https://ntc.party/t/topic/40/30">Новости АнтиЗапрета</a> <a class="badge-category__wrapper " href="/c/antizapret-prostovpn-org/5"><span data-category-id="5" style="--category-badge-color: #8C6238; --category-badge-text-color: #FFFFFF;" data-drop-close="true" class="badge-category " title="Proxy and VPN service for Russian censorship circumvention, discussion and official support forum. Обсуждение работы сервиса обхода блокировок России АнтиЗапрет. Новости, уведомления о проблемах и помощь в настройке."><span class="badge-category__name">antizapret.prostovpn.org</span></span></a>
  </div>
  <blockquote>
    На VPN-серверах с сегодняшнего дня фильтруются (блокируются) запросы DNS типа <a href="https://blog.cloudflare.com/speeding-up-https-and-http-3-negotiation-with-dns/" rel="noopener nofollow ugc">SVCB/HTTPS (Type 65)</a>. 
Это должно решить проблемы с некоторыми сайтами на iOS. 
<a href="https://ntc.party/t/ios-macos-openvpn/4468" class="onebox" target="_blank" rel="noopener">https://ntc.party/t/ios-macos-openvpn/4468</a>
  </blockquote>
</aside>

<p>а на своём сервере как эту опцию применить?</p></td><td>2023-05-18T20:12:52.226Z</td></tr><tr><td>Mr.Alex</td><td><p>Как применить на свой сервер?</p></td><td>2023-05-23T17:19:13.390Z</td></tr><tr><td>ValdikSS</td><td><p><a class="mention" href="/u/kirill">@kirill</a>, <a class="mention" href="/u/mr.alex">@Mr.Alex</a></p>
<p>Примените патч:</p>
<pre><code class="lang-auto">cd /root/dnsmap
patch -i p.patch
</code></pre>
<p><a class="attachment" href="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/qcZkhfK3hMdQtOGLD64orMd810D.patch">p.patch</a> (1.4 KB)</p></td><td>2023-05-23T19:18:11.056Z</td></tr><tr><td>Mr.Alex</td><td><p>bash: cd: /root/dnsmap: No such file or directory</p></td><td>2023-05-23T20:23:53.676Z</td></tr><tr><td>nzkhammatov(Ainur Khammatov)</td><td><p><strong>Список необходимых патчей для сохранения работоспособности частного контейнера АнтиЗапрет</strong></p>
<p><strong>Выполнять внутри контейнера</strong></p>
<pre data-code-wrap="bash"><code class="lang-bash">root@antizapret-vpn:~#
</code></pre>
<p><strong>Для входа в lxd</strong></p>
<pre data-code-wrap="bash"><code class="lang-bash">lxc exec antizapret-vpn bash
</code></pre>
<p><strong>Для входа в systemd-machined (cloud-init)</strong></p>
<pre data-code-wrap="bash"><code class="lang-bash">machinectl shell antizapret-vpn /bin/bash
</code></pre>
<p><strong>Обновить пакет <code>dnslib</code></strong></p>
<pre data-code-wrap="bash"><code class="lang-bash">apt update
apt remove --purge python3-dnslib -y
apt autoremove -y
apt install python3-pip socat patch -y
pip3 install dnslib
</code></pre>
<p><strong>Применить патч файл</strong></p>
<pre data-code-wrap="bash"><code class="lang-bash">wget https://raw.githubusercontent.com/nzkhammatov/antizapret_ios_patch/main/p.patch -O /root/dnsmap/p.patch
cd /root/dnsmap
patch -i p.patch
</code></pre>
<p><strong>Заменить выделенную строку</strong></p>
<pre data-code-wrap="bash"><code class="lang-bash">https://bitbucket.org/anticensority/antizapret-pac-generator-light/src/c73e0d901feb5b862a14f6e0f13670e590fb49ea/parse.sh#lines-10
</code></pre>
<pre data-code-wrap="bash"><code class="lang-bash">nano /root/antizapret/parse.sh
</code></pre>
<p><strong>На вот это</strong></p>
<pre data-code-wrap="bash"><code class="lang-bash">awk -F ';' '{print $2}' temp/list.csv | sort -u | awk '/^$/ 
{next} /\\/ {next} /^[а-яА-Яa-zA-Z0-9\-\_\.\*]*+$/ {gsub(/\*\./, ""); 
gsub(/\.$/, ""); print}' | grep -Fv 'bеllonа' | CHARSET=UTF-8 idn &gt; 
result/hostlist_original.txt
</code></pre>
<p><strong>Выполнить</strong></p>
<pre data-code-wrap="bash"><code class="lang-bash">/root/antizapret/doall.sh
</code></pre>
<pre data-code-wrap="bash"><code class="lang-bash">echo "cache.clear()" | socat - /run/knot-resolver/control/1
</code></pre>
<p><strong>Перезагрузить контейнер</strong></p></td><td>2023-05-23T20:38:30.896Z</td></tr><tr><td>Mr.Alex</td><td><p>bash: patch: command not found</p></td><td>2023-05-23T20:50:37.826Z</td></tr><tr><td>kirill</td><td><pre><code class="lang-auto">lxc file push /root/p.patch antizapret-vpn/root/dnsmap/p.patch
lxc exec antizapret-vpn -- bash
chmod 755 /root/dnsmap/p.patch
cd /root/dnsmap
patch -i p.patch
&gt;&gt; patching file proxy.py
</code></pre></td><td>2023-05-23T21:07:32.132Z</td></tr><tr><td>Joyz</td><td><aside class="quote no-group" data-username="ValdikSS" data-post="535" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/valdikss/48/2_2.png" class="avatar"> ValdikSS:</div>
<blockquote>
<p>Примените патч:</p>
</blockquote>
</aside>
<p>А контейнеры на bitbucket уже с патчем и если нет, то будет ли он туда добавлен?</p></td><td>2023-05-24T08:43:14.333Z</td></tr><tr><td>Lapa(Lapa)</td><td><p>После применения данного патча перестаёт резолвить домены из блок листа. Незаблокированные резолвит <img src="https://ntc.party/images/emoji/twitter/frowning.png?v=12" title=":frowning:" class="emoji" alt=":frowning:" loading="lazy" width="20" height="20"></p></td><td>2023-05-24T13:45:40.689Z</td></tr><tr><td>kirill</td><td><p>у меня такой проблемы не наблюдается</p>
<pre><code class="lang-auto">C:\Users\kirill&gt;chcp 65001
Active code page: 65001

C:\Users\kirill&gt;nslookup rutracker.org
Server:  UnKnown
Address:  192.168.1.1

Non-authoritative answer:
Name:    rutracker.org
Addresses:  10.224.0.96
          10.224.0.97
</code></pre></td><td>2023-05-24T17:42:09.116Z</td></tr><tr><td>Lapa(Lapa)</td><td><p>У меня на этом месте нет ответа от сервера, к сожалению. С самого контейнера все, само собой, резолвится. Пробовал на двух контейнерах на разных серверах. Результат идентичный.</p></td><td>2023-05-24T18:08:45.355Z</td></tr><tr><td>stupidityIsntCrime</td><td><p>у мен в конфиге все форвардится на клоудфларевские днсы, всё работает безо всяких патчей ЧЯДНТ?!</p></td><td>2023-05-24T18:45:06.361Z</td></tr><tr><td>kirill</td><td><p><code>&gt;&gt; ЧЯДНТ?!</code><br>
не вникаешь в тему перед тем, как что-то про неё написать</p>
<p><code>&gt;&gt; всё работает безо всяких патчей</code><br>
можно поздравить</p></td><td>2023-05-24T18:58:30.563Z</td></tr><tr><td>bokov333(Bokov333)</td><td><p>Подтверждаю, после накатывания патча не резолвит заблокированные домены.</p></td><td>2023-05-24T21:16:42.350Z</td></tr><tr><td>nzkhammatov(Ainur Khammatov)</td><td><p>Может в этом дело,</p><aside class="quote" data-post="519" data-topic="129">
  <div class="title">
    <div class="quote-controls"></div>
    <img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/valdikss/48/2_2.png" class="avatar">
    <a href="https://ntc.party/t/vpn/129/519">Контейнер VPN АнтиЗапрета для установки на собственный сервер</a> <a class="badge-category__wrapper " href="/c/antizapret-prostovpn-org/az-self-hosted/38"><span data-category-id="38" style="--category-badge-color: #0088CC; --category-badge-text-color: #FFFFFF; --parent-category-badge-color: #8C6238;" data-parent-category-id="5" data-drop-close="true" class="badge-category --has-parent" title="Вопросы и особенности работы контейнера VPN АнтиЗапрета на своих серверах"><span class="badge-category__name">АнтиЗапрет на собственном сервере (self-hosted)</span></span></a>
  </div>
  <blockquote>
    apt remove python3-dnslib &amp;&amp; apt -y install python3-pip
pip3 install dnslib
  </blockquote>
</aside>
</td><td>2023-05-24T23:58:28.723Z</td></tr><tr><td>Lapa(Lapa)</td><td><p>Блин, а после этого перестаёт пинговаться 10.224.0.1 <img src="https://ntc.party/images/emoji/twitter/frowning.png?v=12" title=":frowning:" class="emoji" alt=":frowning:" loading="lazy" width="20" height="20"></p></td><td>2023-05-25T04:09:06.048Z</td></tr><tr><td>Lapa(Lapa)</td><td><p>Ради интереса развернул новый контейнер и проделал в нём всё вышеуказанные изменения. На новом контейнере всё сработало и без проблем резолвит. Отличия нового от текущего только в том, что в текущем я добавлял</p>
<p>policy.add(<br>
policy.all(<br>
policy.TLS_FORWARD({{‘94.140.14.14@853’, hostname=‘<a href="http://dns.adguard-dns.com" rel="noopener nofollow ugc">dns.adguard-dns.com</a>’}}),<br>
policy.TLS_FORWARD({{‘1.1.1.1@853’, hostname=‘<a href="http://cloudflare-dns.com" rel="noopener nofollow ugc">cloudflare-dns.com</a>’}}),<br>
policy.TLS_FORWARD({{‘8.8.8.8@853’, hostname=‘dns.google’}}),<br>
policy.TLS_FORWARD({{‘1.0.0.1@853’, hostname=‘<a href="http://cloudflare-dns.com" rel="noopener nofollow ugc">cloudflare-dns.com</a>’}}),<br>
policy.TLS_FORWARD({{‘8.8.4.4@853’, hostname=‘dns.google’}})<br>
)<br>
)</p>
<p>policy.add(policy.all(policy.FORWARD({‘94.140.14.14’})))</p></td><td>2023-05-25T04:41:09.203Z</td></tr><tr><td>ValdikSS</td><td><p>Это тоже нужно проделать, да.</p></td><td>2023-05-25T08:45:10.857Z</td></tr><tr><td>bokov333(Bokov333)</td><td><p>Получилось:<br>
<span class="hashtag-raw">#apt</span> remove python3-dnslib &amp;&amp; apt -y install python3-pip<br>
<span class="hashtag-raw">#pip3</span> install dnslib</p>
<p>Затем<br>
применение патча:<br>
положить файл p.patch в /root/dnsmap<br>
<span class="hashtag-raw">#cd</span> /root/dnsmap<br>
<span class="hashtag-raw">#patch</span> -i p.patch</p>
<p>Спасибо <a href="https://ntc.party/u/ValdikSS">ValdikSS</a><br>
<a class="attachment" href="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/qcZkhfK3hMdQtOGLD64orMd810D.patch">p.patch</a> (1,4 КБ)</p></td><td>2023-05-25T09:43:32.338Z</td></tr><tr><td>mejorcorreo</td><td><p><a class="mention" href="/u/valdikss">@ValdikSS</a> Подскажите, пожалуйста.<br>
Установил на 2 vps, оба территориально Нидерланды. Настройки на обоих одинаковые, но при подключении к одному прекрасно с устройств открывает <a href="http://image.tmdb.org" rel="noopener nofollow ugc">image.tmdb.org</a>, ко второму то работает, то перестает работать, причем само.<br>
Chrome выдает ошибку ERR_CONNECTION_TIMED_OUT<br>
При подключении с устройств nslookup <a href="http://image.tmdb.org" rel="noopener nofollow ugc">image.tmdb.org</a> на обоих выдает 10.224.0.1, что, как я понимаю, говорит о том, что запросы идут через туннель.<br>
В какую сторону копать?</p></td><td>2023-05-25T11:28:06.820Z</td></tr><tr><td>zzr</td><td><p>ах ета тема, сам напарывался - на ббс картинки не грузило т.е. один сраный домен не проходил хотя всё шло через туннелль вроде как. решил - сменой хостера) у того айпишник какойто мутный был - вроде нидерланды а куча сайтов всё равно палило что якобы российский айпишниг</p></td><td>2023-05-26T07:13:54.994Z</td></tr><tr><td>maxpain(Maxim Makarov)</td><td><p><a class="mention" href="/u/valdikss">@ValdikSS</a> Добрый день. Как добавить кастомные IP-адреса, чтобы они проксировались через antizapret container?</p></td><td>2023-05-29T16:35:13.313Z</td></tr><tr><td>ValdikSS</td><td><aside class="quote no-group" data-username="mejorcorreo" data-post="553" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/m/d78d45/48.png" class="avatar"> mejorcorreo:</div>
<blockquote>
<p>Установил на 2 vps, оба территориально Нидерланды. Настройки на обоих одинаковые, но при подключении к одному прекрасно с устройств открывает <a href="http://image.tmdb.org">image.tmdb.org</a>, ко второму то работает, то перестает работать, причем само.</p>
</blockquote>
</aside>
<p>Сперва проверьте, что это не сетевая проблема. Иными словами, проверьте с самого сервера, не используя АнтиЗапрет.</p>
<aside class="quote no-group" data-username="maxpain" data-post="556" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/maxpain/48/1828_2.png" class="avatar"> maxpain:</div>
<blockquote>
<p>Как добавить кастомные IP-адреса, чтобы они проксировались через antizapret container?</p>
</blockquote>
</aside>
<aside class="quote" data-post="81" data-topic="129">
  <div class="title">
    <div class="quote-controls"></div>
    <img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/valdikss/48/2_2.png" class="avatar">
    <a href="https://ntc.party/t/vpn/129/81">Контейнер VPN АнтиЗапрета для установки на собственный сервер</a> <a class="badge-category__wrapper " href="/c/antizapret-prostovpn-org/az-self-hosted/38"><span data-category-id="38" style="--category-badge-color: #0088CC; --category-badge-text-color: #FFFFFF; --parent-category-badge-color: #8C6238;" data-parent-category-id="5" data-drop-close="true" class="badge-category --has-parent" title="Вопросы и особенности работы контейнера VPN АнтиЗапрета на своих серверах"><span class="badge-category__name">АнтиЗапрет на собственном сервере (self-hosted)</span></span></a>
  </div>
  <blockquote>
    Я вас дезинформировал. 
Измените /root/antizapret/doall.sh, добавив после ./update.sh ваш IP-адрес, обязательно с CIDR. Вот так: 
./update.sh
echo '10.0.0.218/32' &gt;&gt; temp/list.csv
./parse.sh
./process.sh

Затем запустите doall.sh, с правильной локалью: 
LANG=C.UTF-8 /root/antizapret/doall.sh 
Больше ничего делать не нужно. Изменять конфигурационный файл openvpn тоже не нужно.
  </blockquote>
</aside>
</td><td>2023-05-30T13:09:17.896Z</td></tr><tr><td>cal0r1c(Алексей Кочетков)</td><td><p>Привет ребята! Установил антизапрет на вновь приобретённый vps, а чего то блокированные сайты не хочет открывать. Пару месяцев назад арендовал на aeza vds и ещё на другом хостере так же установил антизапрет и всё работает, даже несколько доменов добавил в include-hosts-custom работают отлично. На новом vps на том же хостере aeza уже не хочет, но устанавливается антизапрет без проблем и ошибок. Есть какое решение?</p></td><td>2023-06-04T16:17:39.344Z</td></tr><tr><td>sasa1978(sasa1978)</td><td><p>После скачивания почему то вылетает ошибка парсера, может быть подскажите как починить?.</p>
<p>root@antizapret-vpn:~/antizapret$ ./parse.sh<br>
idn: tld_check_4z (position 5): Code points prohibited by top-level domain</p>
<p>Скачивается вроде как без проблем:<br>
root@antizapret-vpn:~/antizapret$ ./update.sh<br>
% Total    % Received % Xferd  Average Speed   Time    Time     Time  Current<br>
Dload  Upload   Total   Spent    Left  Speed<br>
100 15.3M  100 15.3M    0     0   372k      0  0:00:42  0:00:42 --:–:-- 3707k<br>
% Total    % Received % Xferd  Average Speed   Time    Time     Time  Current<br>
Dload  Upload   Total   Spent    Left  Speed<br>
100  491k  100  491k    0     0  9836k      0 --:–:-- --:–:-- --:–:-- 9836k</p></td><td>2023-06-04T18:39:09.422Z</td></tr><tr><td>ValdikSS</td><td><p>В Реестр попали домены с кириллическими именами в названии, которые не соответствуют правилам наименования. Вероятно, кто-то распознал домен с бумаги и скопировал распознанные символы, либо еще что-то.</p>
<p><a href="https://reestr.rublacklist.net/ru/?q=b%D0%B5llon%D0%B0" class="onebox" target="_blank" rel="noopener">https://reestr.rublacklist.net/ru/?q=bеllonа</a></p>
<p>В качестве временной меры вот эту строку:<br>
<a href="https://bitbucket.org/anticensority/antizapret-pac-generator-light/src/c73e0d901feb5b862a14f6e0f13670e590fb49ea/parse.sh#lines-9:10" class="onebox" target="_blank" rel="noopener">https://bitbucket.org/anticensority/antizapret-pac-generator-light/src/c73e0d901feb5b862a14f6e0f13670e590fb49ea/parse.sh#lines-9:10</a></p>
<p>Замените на<br>
<code>awk -F ';' '{print $2}' temp/list.csv | sort -u | awk '/^$/ {next} /\\/ {next} /^[а-яА-Яa-zA-Z0-9\-\_\.\*]*+$/ {gsub(/\*\./, ""); gsub(/\.$/, ""); print}' | grep -Fv 'bеllonа' | CHARSET=UTF-8 idn &gt; result/hostlist_original.txt</code></p></td><td>2023-06-05T17:07:54.841Z</td></tr><tr><td>sasa1978(sasa1978)</td><td><p>Спасибо. Я видел, что затыкается на белоне, но не подумал, что там домен в перемешку с кириллицей записали.</p></td><td>2023-06-05T17:24:00.954Z</td></tr><tr><td>stupidityIsntCrime</td><td><p>ане проще прост в конфиг /root/antizapret/config/include-ips-custom.txt прописать?</p></td><td>2023-06-06T04:14:17.870Z</td></tr><tr><td>stupidityIsntCrime</td><td><p>домемы с керилицей?! свят-свят-свят)</p></td><td>2023-06-06T04:19:24.326Z</td></tr><tr><td>abugray(Georgy)</td><td><p>Ошибка</p>
<p>lxc file pull antizapret-vpn/root/easy-rsa-ipsec/CLIENT_KEY/antizapret-client-tcp.ovpn antizapret-client-tcp.ovpn<br>
Error: Not Found</p>
<p>Тоже самое, пробовал в контейнере запустить скрипт через /root/easy-rsa-ipsec/generate.sh</p>
<p>выдает</p>
<pre><code class="lang-auto">generate.sh: 14: generate.sh: [[: not found
generate.sh: 14: generate.sh: [[: not found
generate.sh: 14: generate.sh: [[: not found
generate.sh: 14: generate.sh: [[: not found
generate.sh: 14: generate.sh: [[: not found
generate.sh: 17: generate.sh: [[: not found
generate.sh: 26: generate.sh: Syntax error: "(" unexpected (expecting "do")
</code></pre>
<p>Интернет в контейнере есть</p>
<pre><code class="lang-auto">root@antizapret-vpn:~# ping 8.8.8.8
PING 8.8.8.8 (8.8.8.8): 56 data bytes
64 bytes from 8.8.8.8: icmp_seq=0 ttl=120 time=1.147 ms
64 bytes from 8.8.8.8: icmp_seq=1 ttl=120 time=1.465 ms
64 bytes from 8.8.8.8: icmp_seq=2 ttl=120 time=1.467 ms
64 bytes from 8.8.8.8: icmp_seq=3 ttl=120 time=1.164 ms
64 bytes from 8.8.8.8: icmp_seq=4 ttl=120 time=1.139 ms
</code></pre>
<p>Переустановил контейнер, файл создался, но впн не работает <img src="https://ntc.party/images/emoji/twitter/confused.png?v=12" title=":confused:" class="emoji" alt=":confused:" loading="lazy" width="20" height="20"> после подключения интернет отваливается, что на роутере (Прошивка ASUSWRT Merlin) что на клиентской машине, надо ли устанавливать дополнительно apt install lxc-utils ?</p></td><td>2023-06-07T13:43:56.553Z</td></tr><tr><td>mejorcorreo</td><td><aside class="quote no-group" data-username="ValdikSS" data-post="557" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/valdikss/48/2_2.png" class="avatar"> ValdikSS:</div>
<blockquote>
<p>Сперва проверьте, что это не сетевая проблема. Иными словами, проверьте с самого сервера, не используя АнтиЗапрет.</p>
</blockquote>
</aside>
<p>Подскажите, пожалуйста, как правильно проверить.<br>
Команда с самого сервера curl -Is <a href="http://image.tmdb.org/" rel="noopener nofollow ugc">http://image.tmdb.org/</a> |grep 403 ничего не выдает.<br>
Также на сервере поднят Wireguard, если с утройств подключаться к нему, то <a href="http://image.tmdb.org" rel="noopener nofollow ugc">image.tmdb.org</a> открывается нормально (видимо тогда проблема не сетевая?), а просто антизапрет, то открывается, то нет. Чаще не работает.</p></td><td>2023-06-10T07:49:10.030Z</td></tr><tr><td>helcoder</td><td><p>Помогите пожалуйста завести, настроил всё по инструкции через lxd, только порт поменял на 1195, т.к. докером уже занят стандартный порт. Пробую через телефон на Андроиде, приложение “OpenVPN для Android”, всё замечательно коннектится, но заблокированные ресурсы не открываются. При этом если использовать общедоступный антизапрет профиль, то всё точно также коннектится и заблокированные ресурсы прекрасно открываются. Выглядит так что проблема в том что девайс не использует DNS контейнера. VPS находится в штатах. Подскажите куда копать? Может быть дело в кастомном порте?</p>
<p>UPDATE:<br>
Проверил на ПК, ситуация та же. Если выполнить nslookup, то пишет что используется адрес моего VPS, но адреса возвращаются внешние, а не 10.* как должно.</p></td><td>2023-06-12T05:25:42.525Z</td></tr><tr><td>ValdikSS</td><td><p>Раз:</p><aside class="quote quote-modified" data-post="560" data-topic="129">
  <div class="title">
    <div class="quote-controls"></div>
    <img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/valdikss/48/2_2.png" class="avatar">
    <a href="https://ntc.party/t/vpn/129/560">Контейнер VPN АнтиЗапрета для установки на собственный сервер</a> <a class="badge-category__wrapper " href="/c/antizapret-prostovpn-org/az-self-hosted/38"><span data-category-id="38" style="--category-badge-color: #0088CC; --category-badge-text-color: #FFFFFF; --parent-category-badge-color: #8C6238;" data-parent-category-id="5" data-drop-close="true" class="badge-category --has-parent" title="Вопросы и особенности работы контейнера VPN АнтиЗапрета на своих серверах"><span class="badge-category__name">АнтиЗапрет на собственном сервере (self-hosted)</span></span></a>
  </div>
  <blockquote>
    В Реестр попали домены с кириллическими именами в названии, которые не соответствуют правилам наименования. Вероятно, кто-то распознал домен с бумаги и скопировал распознанные символы, либо еще что-то. 


В качестве временной меры вот эту строку: 
<a href="https://bitbucket.org/anticensority/antizapret-pac-generator-light/src/c73e0d901feb5b862a14f6e0f13670e590fb49ea/parse.sh#lines-9:10" class="onebox" target="_blank" rel="noopener">https://bitbucket.org/anticensority/antizapret-pac-generator-light/src/c73e0d901feb5b862a14f6e0f13670e590fb49ea/parse.sh#lines-9:10</a> 
Замените на 
awk -F ';' '{print $2}' temp/list.csv | sort -u | awk '/^$/ {next} /\\/ {next} /^[а-яА-Яa-zA-Z0-9\-\_\.\*]…
  </blockquote>
</aside>

<p>Два:<br>
<code>LANG=C.UTF-8 /root/antizapret/doall.sh</code></p></td><td>2023-06-13T12:37:52.047Z</td></tr><tr><td>Sblack</td><td><p>возьму платную консультацию по установке и настройке контейнера, пишите в личку - дам прямой контакт</p></td><td>2023-06-13T14:52:27.241Z</td></tr><tr><td>helcoder</td><td><p>Завелось, спасибо!</p></td><td>2023-06-14T03:54:16.449Z</td></tr><tr><td>timer</td><td><p>Привет всем.<br>
Ни в какую не хочет гонять через vpn хосты из /root/antizapret/config/include-hosts-custom.txt<br>
Вроде по инструкции всё<br>
echo “cache.clear()” | socat - /run/knot-resolver/control/1<br>
LANG=C.UTF-8 /root/antizapret/doall.sh<br>
Вшитые хосты - например <a href="http://linkedin.com" rel="noopener nofollow ugc">linkedin.com</a> работает прекрасно<br>
А вот например <a href="http://2ip.ru" rel="noopener nofollow ugc">2ip.ru</a> не хочет.</p>
<p>Сунулся логи посмотреть - в /var/log/ нет ничё. Как включить логи резолвинга чтобы проследить за процессом и понять что не так.</p></td><td>2023-06-14T07:40:46.817Z</td></tr><tr><td>flurmind(Flurmind)</td><td><p>Добрый день. Прошу подсказать: есть роутер, за ним NAS на дебиан - оба в зоне блокировок, есть слабенький VPS вне зоны блокировок, тоже на дебиан. Желание поставить у себя на NAS Антизапрет и уже из контейнера отправлять только блокированный трафик на VPS, остальное обратно через роутер в сеть. Можно реализовать?</p></td><td>2023-06-20T11:42:31.383Z</td></tr><tr><td>ValdikSS</td><td><p>См. конфиги в /etc/knot-resolver</p></td><td>2023-06-20T15:02:02.942Z</td></tr><tr><td>ValdikSS</td><td><p>Настройте VPN-соединение внутри контейнера на вашу VPS.</p></td><td>2023-06-20T15:02:45.026Z</td></tr><tr><td>abugray(Georgy)</td><td><p>Может кто нибудь подскажет куда копать?</p></td><td>2023-06-20T15:29:54.469Z</td></tr><tr><td>ValdikSS</td><td><p>Могу предположить, что вы каким-то образом пытаетесь запустить скрипт не через bash, а через другой шелл. Запускайте штатным образом, через bash.</p></td><td>2023-06-20T16:39:17.262Z</td></tr><tr><td>Ernieleo(Max)</td><td><p>Подскажите, как можно заново сгенерировать ovpn конфиг? Поменялся IP, да, можно просто подставить в уже полученный конфиг актуальный адрес, но заинтересовало как правильно сгенерировать заново с новым публичным IP и с новыми ключами, при ситуации что конфиг окажется в сети - может понадобится.</p></td><td>2023-06-21T00:05:22.383Z</td></tr><tr><td>abugray(Georgy)</td><td><p>Не совсем понял что я не так запустил, контейнер работает, подключение идет, но интернет отрубается сразу после подключения к антизапрету.</p></td><td>2023-06-22T14:23:58.450Z</td></tr><tr><td>kirill</td><td><p>либо этот метод</p><aside class="quote" data-post="39" data-topic="129">
  <div class="title">
    <div class="quote-controls"></div>
    <img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/nzkhammatov/48/4650_2.png" class="avatar">
    <a href="https://ntc.party/t/vpn/129/39">Контейнер VPN АнтиЗапрета для установки на собственный сервер</a> <a class="badge-category__wrapper " href="/c/antizapret-prostovpn-org/az-self-hosted/38"><span data-category-id="38" style="--category-badge-color: #0088CC; --category-badge-text-color: #FFFFFF; --parent-category-badge-color: #8C6238;" data-parent-category-id="5" data-drop-close="true" class="badge-category --has-parent" title="Вопросы и особенности работы контейнера VPN АнтиЗапрета на своих серверах"><span class="badge-category__name">АнтиЗапрет на собственном сервере (self-hosted)</span></span></a>
  </div>
  <blockquote>
    До начала использования контейнера,использовал только этот продукт по ссылке, для DOH,DOT и фильтрации рекламы. Какое-то, очень недолгое время он помогал обходить некоторые блокировки. 
Есть ли возможность не повредив функционал VPN сервера начать использовать их вместе на одном VPS сервере? 
Чтобы после подключения к VPN на домашнем компьютере, работал обход, работал фильтр рекламных доменов.
  </blockquote>
</aside>
<p>
не работает, либо я что-то не так сделал</p>
<p>совершенно случайно провёл эксперимент,<br>
зашёл на <a href="http://flibusta.site" rel="noopener nofollow ugc">http://flibusta.site</a> качнуть книгу</p>
<p>там на главной странице ссылка на зеркало<br>
<a href="https://flibusta.lib" class="onebox" target="_blank" rel="noopener nofollow ugc">https://flibusta.lib</a><br>
которое не резолвится ничем, кроме</p><aside class="onebox allowlistedgeneric" data-onebox-src="https://www.opennic.org">
  <header class="source">
      <img class="site-icon">

      <a href="https://www.opennic.org" target="_blank" rel="noopener nofollow ugc">opennic.org</a>
  </header>

  <article class="onebox-body">
    

<h3><a href="https://www.opennic.org" target="_blank" rel="noopener nofollow ugc">OpenNIC Project</a></h3>

  <p>An organization of hobbyists who run an alternative DNS network, also provides access to domains not administered by ICANN.
</p>


  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

<p>вписал я, значит,<br>
policy.add(policy.all(policy.FORWARD({‘195.10.195.195’})))<br>
перезагрузил контейнер<br>
сконнектился с компа по openvpn – и не резолвится flibusta.lib</p>
<p>причём если дать на компе<br>
nslookup flibusta.lib 195.10.195.195<br>
то всё резолвится</p>
<p>иначе говоря, при изменении в конфиге на свой днс с помощью текущей конфигурационной строки<br>
полный форвардинг всех запросов всё-таки на этот днс не осуществляется,<br>
хотя должен, если я правильно всё понял, как этто должно работать<br>
я так это понимаю</p>
<p>upd.<br>
разобрался</p>
<p>просто в разделе<br>
– Resolve OpenNIC, EMCDNS and Namecoin domains<br>
перечисленные ip нерабочие</p>
<p>поменял – и резолвинг пошёл</p></td><td>2023-06-23T21:03:54.261Z</td></tr><tr><td>dark321985(Александр)</td><td><p>Подскажите пожалуйста. Такая проблема.<br>
Установил контейнер, все завелось, подключаюсь спокойно. Но ни один из запрещенных сайтов не открывается через браузер, приэтом пингается все корректно. Посмотрел Nslookup DNS используется из виртуальной сети все в порядке, отвечает вроде корректно</p>
<blockquote>
<p><a href="http://instagram.com" rel="noopener nofollow ugc">instagram.com</a><br>
╤хЁтхЁ:  UnKnown<br>
Address:  192.168.104.1</p>
</blockquote>
<p>Не заслуживающий доверия ответ:<br>
╚ь :     <a href="http://instagram.com" rel="noopener nofollow ugc">instagram.com</a><br>
Addresses:  2a03:2880:f276:e8:face:b00c:0:4420<br>
157.240.251.174</p>
<p>При этом если я добавляю в спиcок include-hosts-custom то он тоже соответственно перестает открываться в браузере</p>
<p>использовал фикс о котором говорилось выше и после шага 2 вот что выдает<br>
root@antizapret-vpn:~# LANG=C.UTF-8 /root/antizapret/doall.sh<br>
% Total    % Received % Xferd  Average Speed   Time    Time     Time  Current<br>
Dload  Upload   Total   Spent    Left  Speed<br>
100 15.3M  100 15.3M    0     0  14.6M      0  0:00:01  0:00:01 --:–:-- 14.6M<br>
% Total    % Received % Xferd  Average Speed   Time    Time     Time  Current<br>
Dload  Upload   Total   Spent    Left  Speed<br>
100  470k  100  470k    0     0  3922k      0 --:–:-- --:–:-- --:–:-- 3922k<br>
<strong>awk: cmd. line:1: error: Invalid range end: /<sup class="footnote-ref"><a href="#footnote-14552-1" id="footnote-ref-14552-1">[1]</a></sup>*+$/</strong><br>
Blocked domains: 21 result/hostlist_zones.txt<br>
iplist_all: 48431 result/iplist_all.txt<br>
iplist_special_range: 9 result/iplist_special_range.txt<br>
iplist_blockedbyip: 1167 result/iplist_blockedbyip.txt<br>
iplist_blockedbyip_noid2971: 1167 result/iplist_blockedbyip_noid2971.txt</p>
<hr class="footnotes-sep">

<ol class="footnotes-list">
<li id="footnote-14552-1" class="footnote-item"><p>а-▒▒-Яa-zA-Z0-9-_.* <a href="#footnote-ref-14552-1" class="footnote-backref">↩︎</a></p>
</li>
</ol></td><td>2023-06-26T17:21:15.200Z</td></tr><tr><td>ValdikSS</td><td><aside class="quote no-group" data-username="dark321985" data-post="580" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/d/b5e925/48.png" class="avatar"> dark321985:</div>
<blockquote>
<p><strong>awk: cmd. line:1: error: Invalid range end: /<sup class="footnote-ref"><a href="#footnote-14555-1" id="footnote-ref-14555-1">[1]</a></sup>*+$/</strong></p>
</blockquote>
</aside>
<p>Вы что-то не так скопировали, добавились непечатаемые символы.</p>
<hr class="footnotes-sep">

<ol class="footnotes-list">
<li id="footnote-14555-1" class="footnote-item"><p>а-▒▒-Яa-zA-Z0-9-_.* <a href="#footnote-ref-14555-1" class="footnote-backref">↩︎</a></p>
</li>
</ol></td><td>2023-06-27T04:07:57.774Z</td></tr><tr><td>Lapa(Lapa)</td><td><p>IPv6 отключи…</p></td><td>2023-06-27T06:07:51.740Z</td></tr><tr><td>dark321985(Александр)</td><td><p>Крче все снес переделал заново, получилось, извиняюсь за беспокойство</p></td><td>2023-06-27T08:47:24.594Z</td></tr><tr><td>Joyz</td><td><p><a class="mention" href="/u/valdikss">@ValdikSS</a> общедоступный vpn antizapret развивается и дополняется, а планитуется ли обновление и дальнейшее развитие контейнера, а так же обновление приложений внутри контейнера? А то ему уже 3 года исполнилось <img src="https://ntc.party/images/emoji/twitter/wink.png?v=12" title=":wink:" class="emoji" alt=":wink:" loading="lazy" width="20" height="20"></p></td><td>2023-06-28T23:59:37.032Z</td></tr><tr><td>zzr</td><td><p>i tried this before, no luck <a href="https://ntc.party/t/vpn/129/474">https://ntc.party/t/vpn/129/474</a></p></td><td>2023-06-30T06:16:58.772Z</td></tr><tr><td>Joyz</td><td><p>Ага. И <a class="mention" href="/u/valdikss">@ValdikSS</a> поему то игнорирует такие вопросы…</p></td><td>2023-06-30T20:29:09.499Z</td></tr><tr><td>abugray(Georgy)</td><td><p>Вопросы так и остались без ответа. К серверу подключение проходит успешно, но интернет тогда вообще не работает.</p></td><td>2023-07-04T12:29:50.221Z</td></tr><tr><td>nzkhammatov(Ainur Khammatov)</td><td><p><strong>Все перечисленное проделали внутри контейнера?</strong></p>
<p><strong>Для начала исполните эту команду:</strong> <code>apt update</code><br>
<strong>И далее по списку…</strong></p><aside class="quote" data-post="519" data-topic="129">
  <div class="title">
    <div class="quote-controls"></div>
    <img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/valdikss/48/2_2.png" class="avatar">
    <a href="https://ntc.party/t/vpn/129/519">Контейнер VPN АнтиЗапрета для установки на собственный сервер</a> <a class="badge-category__wrapper " href="/c/antizapret-prostovpn-org/az-self-hosted/38"><span data-category-id="38" style="--category-badge-color: #0088CC; --category-badge-text-color: #FFFFFF; --parent-category-badge-color: #8C6238;" data-parent-category-id="5" data-drop-close="true" class="badge-category --has-parent" title="Вопросы и особенности работы контейнера VPN АнтиЗапрета на своих серверах"><span class="badge-category__name">АнтиЗапрет на собственном сервере (self-hosted)</span></span></a>
  </div>
  <blockquote>
    apt remove python3-dnslib &amp;&amp; apt -y install python3-pip
pip3 install dnslib
  </blockquote>
</aside>

<aside class="quote" data-post="535" data-topic="129">
  <div class="title">
    <div class="quote-controls"></div>
    <img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/valdikss/48/2_2.png" class="avatar">
    <a href="https://ntc.party/t/vpn/129/535">Контейнер VPN АнтиЗапрета для установки на собственный сервер</a> <a class="badge-category__wrapper " href="/c/antizapret-prostovpn-org/az-self-hosted/38"><span data-category-id="38" style="--category-badge-color: #0088CC; --category-badge-text-color: #FFFFFF; --parent-category-badge-color: #8C6238;" data-parent-category-id="5" data-drop-close="true" class="badge-category --has-parent" title="Вопросы и особенности работы контейнера VPN АнтиЗапрета на своих серверах"><span class="badge-category__name">АнтиЗапрет на собственном сервере (self-hosted)</span></span></a>
  </div>
  <blockquote>
    <a class="mention" href="/u/kirill">@kirill</a>, <a class="mention" href="/u/mr.alex">@Mr.Alex</a> 
Примените патч: 
cd /root/dnsmap
patch -i p.patch

<a class="attachment" href="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/qcZkhfK3hMdQtOGLD64orMd810D.patch">p.patch</a> (1.4 KB)
  </blockquote>
</aside>

<aside class="quote no-group quote-modified" data-username="ValdikSS" data-post="560" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/valdikss/48/2_2.png" class="avatar"> ValdikSS:</div>
<blockquote>
<p>В качестве временного решения заменить выделенную строку</p>
<p><a href="https://bitbucket.org/anticensority/antizapret-pac-generator-light/src/c73e0d901feb5b862a14f6e0f13670e590fb49ea/parse.sh#lines-10" rel="noopener nofollow ugc">https://bitbucket.org/anticensority/antizapret-pac-generator-light/src/c73e0d901feb5b862a14f6e0f13670e590fb49ea/parse.sh#lines-10 </a></p>
<p><code>nano /root/antizapret/parse.sh</code></p>
<p>На вот это</p>
<p><code>awk -F ';' '{print $2}' temp/list.csv | sort -u | awk '/^$/ {next} /\\/ {next} /^[а-яА-Яa-zA-Z0-9\-\_\.\*]*+$/ {gsub(/\*\./, ""); gsub(/\.$/, ""); print}' | grep -Fv 'bеllonа' | CHARSET=UTF-8 idn &gt; result/hostlist_original.txt</code></p>
</blockquote>
</aside>
<p><strong>Выполнить</strong><br>
<code> /root/antizapret/doall.sh</code></p></td><td>2023-07-04T13:13:39.939Z</td></tr><tr><td>Oleg(oleg)</td><td><p>Внутрм контейнера прописал:<br>
policy.add(<br>
policy.all(<br>
policy.TLS_FORWARD({{‘хх.хх.хх.1@853’, hostname=‘,мой днс’}}),<br>
policy.TLS_FORWARD({{‘хх.хх.хх.2@853’, hostname=‘мой днс’}}),<br>
policy.TLS_FORWARD({{‘хх.хх.хх.3@853’,<br>
hostname=‘мой днс’}})<br>
)<br>
)<br>
Когда первая строчка к примеру умирает, то впн перестает функционировать и все клиенты точки доступа(VPN) без интернета. Это можно как то побороть? Но если первая строчка работает она выполнят большую часть резольва, а две другие резольват меньший объём запросов (тоже работают пока работае первый сервер) когда первая строчка умирает(тех обслуживание), сервер не обращается ко втрой и третьей строчке, а просто отрубается весь интернет всем клиентам VPN</p></td><td>2023-07-06T10:23:29.630Z</td></tr><tr><td>nzkhammatov(Ainur Khammatov)</td><td><p><em><strong>Может так?</strong></em></p>
<p><code>https://knot-resolver.readthedocs.io/en/stable/quickstart-config.html#forwarding-to-multiple-targets</code></p>
<blockquote>
<p>With the use of policy.slice function, it is possible to split the entire DNS namespace into distinct “slices”. When used in conjunction with policy.TLS_FORWARD, it’s possible to forward different queries to different remote resolvers. As a result no single remote resolver will get complete list of all queries performed by this client.</p>
</blockquote></td><td>2023-07-07T19:25:15.000Z</td></tr><tr><td>soulja(Serano)</td><td><p>Здравствуйте, подскажите пожалуйста как происходит маршрутизация dnsmap. Фейк адрес перенаправляется таким образом</p>
<pre><code class="lang-auto">iptables -w -t nat -A dnsmap -d "$fake_addr" -j DNAT --to "$real_addr"
</code></pre>
<p>А как его потом маскарадить или SNAT’ить?)</p></td><td>2023-07-08T11:46:18.069Z</td></tr><tr><td>Oleg(oleg)</td><td><p>Спасибо получилось.</p></td><td>2023-07-08T13:33:29.486Z</td></tr><tr><td>ValdikSS</td><td><aside class="quote no-group" data-username="soulja" data-post="591" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/s/958977/48.png" class="avatar"> soulja:</div>
<blockquote>
<p>А как его потом маскарадить или SNAT’ить?)</p>
</blockquote>
</aside>
<p>Ничего дополнительно делать не нужно, всё уже настроено.</p></td><td>2023-07-10T18:31:58.709Z</td></tr><tr><td>pikapikapikaaa(Pikapikapikaaa)</td><td><p><a class="mention" href="/u/valdikss">@ValdikSS</a> Даёшь обновление народу! …пожалуйста <img src="https://ntc.party/images/emoji/twitter/smiling_face_with_tear.png?v=12" title=":smiling_face_with_tear:" class="emoji" alt=":smiling_face_with_tear:" loading="lazy" width="20" height="20"></p></td><td>2023-07-11T12:36:18.082Z</td></tr><tr><td>Ko6ra(Sergey)</td><td><p>Здравствуйте, как удалить контейнер который установлен на vps? Хочу все переустановить.</p></td><td>2023-07-12T22:58:43.701Z</td></tr><tr><td>soulja(Serano)</td><td><p>Если не затруднит, можете ответить в лс)</p></td><td>2023-07-13T04:37:20.633Z</td></tr><tr><td>kidu(kir)</td><td><p>внезапно вчера перестал работать instagram на собственном сервере. ничего не делали, до этого год все было нормально. остальные сайты открываются<br>
не подскажете куда копать?</p></td><td>2023-07-13T16:31:35.359Z</td></tr><tr><td>Oleg(oleg)</td><td><p>Извините ещё раз, столкнулся с тем что мой сервер с 2 гига памяти полностью перестал работать из-за нехватки памяти<br>
<div class="lightbox-wrapper"><a class="lightbox" href="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/3cf752aae089f5c361ca6bc5252dd7ae6c78e3a8.jpeg" data-download-href="https://ntc.party/uploads/default/3cf752aae089f5c361ca6bc5252dd7ae6c78e3a8" title="20230719_150904"><img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/3cf752aae089f5c361ca6bc5252dd7ae6c78e3a8_2_690x150.jpeg" alt="20230719_150904" data-base62-sha1="8Hkxb4Bd7O2Nu1vkuXztmE01YjC" width="690" height="150" srcset="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/3cf752aae089f5c361ca6bc5252dd7ae6c78e3a8_2_690x150.jpeg, контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/3cf752aae089f5c361ca6bc5252dd7ae6c78e3a8_2_1035x225.jpeg 1.5x, контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/3cf752aae089f5c361ca6bc5252dd7ae6c78e3a8_2_1380x300.jpeg 2x" data-dominant-color="4D2223"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">20230719_150904</span><span class="informations">1920×419 44.4 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div><br>
,  сейчас увеличил файл подкачки (4 гига) пока работает. В связи с этим два вопроса:<br>
1 Какие сейчас актуальные требования к контейнеру (на Ваш взгляд) если искать новый сервер.<br>
2 можно ли сделать два сервера антизапрет что бы не менять входной IP адрес в маршрутизаторх, но при этом разделить как либо нагрузку на сервер…</p></td><td>2023-07-19T11:10:23.842Z</td></tr><tr><td>Kebu</td><td><p>Работает на 1гб, плюс своп на 2 гига, без сбоев</p></td><td>2023-07-19T11:18:59.884Z</td></tr><tr><td>ValdikSS</td><td><p>Проверяйте, что именно вызвало нехватку памяти. См. <code>dmesg</code>, там должны быть записи <code>out-of-memory</code>.</p>
<p>На АнтиЗапрете под VPN используются VPS c 2 ГБ RAM, не помню, чтобы что-то падало из-за нехватки памяти.</p></td><td>2023-07-20T12:06:51.993Z</td></tr><tr><td>maxpain(Maxim Makarov)</td><td><p>Перестал работать скрипт <img src="https://ntc.party/images/emoji/twitter/frowning.png?v=12" title=":frowning:" class="emoji" alt=":frowning:" loading="lazy" width="20" height="20"></p>
<pre><code class="lang-auto">root@antizapret-vpn:~# LANG=C.UTF-8 /root/antizapret/doall.sh
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100 14.2M  100 14.2M    0     0  32.9M      0 --:--:-- --:--:-- --:--:-- 32.9M
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100  424k  100  424k    0     0  13.3M      0 --:--:-- --:--:-- --:--:-- 13.3M
List 2 size differs
</code></pre></td><td>2023-07-20T12:23:18.690Z</td></tr><tr><td>ValdikSS</td><td><p>Еще раз запустите, какой-то из внутренних запросов, который не видно, неудачный.</p></td><td>2023-07-20T12:31:50.390Z</td></tr><tr><td>maxpain(Maxim Makarov)</td><td><p>Сработало, ничего не менял. Благодарю.</p></td><td>2023-07-20T12:37:53.616Z</td></tr><tr><td>Kebu</td><td><p>После добавления сайта в include-hosts-custom.txt и выполнения LANG=C.UTF-8 /root/antizapret/doall.sh получаю ошибку:</p>
<p>idn: tld_check_4z (position 5): Code points prohibited by top-level domain</p>
<p>Раньше не было такого, с чем мб связано?</p></td><td>2023-07-23T16:48:27.017Z</td></tr><tr><td>ilyaigpetrov(ilyaigpetrov)</td><td><blockquote>
<p>Раньше не было такого, с чем мб связано?</p>
</blockquote>
<p>С юникод-символами в доменном имени. <code>.рф</code>, например. Возможно, требуется кодирование доменного имени в punycode.</p></td><td>2023-07-23T17:16:54.231Z</td></tr><tr><td>Kebu</td><td><aside class="quote no-group" data-username="ilyaigpetrov" data-post="606" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/i/5fc32e/48.png" class="avatar"> ilyaigpetrov:</div>
<blockquote>
<p>С юникод-символами в доменном имени. <code>.рф</code>,</p>
</blockquote>
</aside>
<p>Неа, не добавлял таких…</p></td><td>2023-07-23T18:43:29.597Z</td></tr><tr><td>ValdikSS</td><td><p>Несколько сообщений выше</p>
<aside class="quote quote-modified" data-post="560" data-topic="129">
  <div class="title">
    <div class="quote-controls"></div>
    <img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/valdikss/48/2_2.png" class="avatar">
    <a href="https://ntc.party/t/vpn/129/560">Контейнер VPN АнтиЗапрета для установки на собственный сервер</a> <a class="badge-category__wrapper " href="/c/antizapret-prostovpn-org/az-self-hosted/38"><span data-category-id="38" style="--category-badge-color: #0088CC; --category-badge-text-color: #FFFFFF; --parent-category-badge-color: #8C6238;" data-parent-category-id="5" data-drop-close="true" class="badge-category --has-parent" title="Вопросы и особенности работы контейнера VPN АнтиЗапрета на своих серверах"><span class="badge-category__name">АнтиЗапрет на собственном сервере (self-hosted)</span></span></a>
  </div>
  <blockquote>
    В Реестр попали домены с кириллическими именами в названии, которые не соответствуют правилам наименования. Вероятно, кто-то распознал домен с бумаги и скопировал распознанные символы, либо еще что-то. 


В качестве временной меры вот эту строку: 
<a href="https://bitbucket.org/anticensority/antizapret-pac-generator-light/src/c73e0d901feb5b862a14f6e0f13670e590fb49ea/parse.sh#lines-9:10" class="onebox" target="_blank" rel="noopener">https://bitbucket.org/anticensority/antizapret-pac-generator-light/src/c73e0d901feb5b862a14f6e0f13670e590fb49ea/parse.sh#lines-9:10</a> 
Замените на 
awk -F ';' '{print $2}' temp/list.csv | sort -u | awk '/^$/ {next} /\\/ {next} /^[а-яА-Яa-zA-Z0-9\-\_\.\*]…
  </blockquote>
</aside>
</td><td>2023-07-24T04:14:20.266Z</td></tr><tr><td>namerx</td><td><p>Почему-то на собственном сервере перестал открываться <a href="http://alfabank.ru" rel="noopener nofollow ugc">alfabank.ru</a>, приложение тоже не грузит. пробовал с нуля заново создать, то же самое. Но на публичном профиле все работает как надо. Пробовал добавить в exclude-hosts-custom, не помогло.</p>
<pre><code class="lang-auto">C:\Program Files (x86)\VMware\VMware Player\bin&gt;ping alfabank.ru
При проверке связи не удалось обнаружить узел alfabank.ru.
Проверьте имя узла и повторите попытку.

Трассировка маршрута к 217.12.104.100 с максимальным числом прыжков 30

  1    &lt;1 мс    &lt;1 мс    &lt;1 мс  KEENETIC-6256 [192.168.2.1]
  2    &lt;1 мс    &lt;1 мс    &lt;1 мс  192.168.3.254
  3     6 ms     3 ms     4 ms  100.117.0.1
  4     3 ms     1 ms     3 ms  mpts-ss-51.msk.mts-internet.net [212.188.1.6]
  5     *        *        4 ms  mag9-cr03-be12.51.msk.mts-internet.net [212.188.1.5]
  6     *        *        *     Превышен интервал ожидания для запроса.
  7     4 ms     4 ms     4 ms  as20764.asbr.router [212.188.11.11]
  8     4 ms     4 ms     4 ms  msk-m9-cr5.ae2-171.rascom.as20764.net [80.64.98.149]
  9    16 ms     4 ms     4 ms  equant-gw.msk.rascom.as20764.net [80.64.98.150]
 10    26 ms     4 ms     5 ms  umbrella-pe01-ae0-0.rosprint.net [195.151.234.228]
 11    23 ms     5 ms     6 ms  moscow-gin-pe11-ae2-0.rosprint.net [195.151.241.161]
 12     *        *        *     Превышен интервал ожидания для запроса.
 13     *        *        *     Превышен интервал ожидания для запроса.
 14     *        *        *     Превышен интервал ожидания для запроса.
 15     *        *        *     Превышен интервал ожидания для запроса.
 16     *        *        *     Превышен интервал ожидания для запроса.
 17     *        *        *     Превышен интервал ожидания для запроса.
 18     *        *        *     Превышен интервал ожидания для запроса.

Статистика Ping для 217.12.104.100:
    Пакетов: отправлено = 4, получено = 0, потеряно = 4
    (100% потерь)
</code></pre></td><td>2023-07-29T01:19:22.990Z</td></tr><tr><td>nzkhammatov(Ainur Khammatov)</td><td><aside class="quote" data-post="372" data-topic="129">
  <div class="title">
    <div class="quote-controls"></div>
    <img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/valdikss/48/2_2.png" class="avatar">
    <a href="https://ntc.party/t/vpn/129/372">Контейнер VPN АнтиЗапрета для установки на собственный сервер</a> <a class="badge-category__wrapper " href="/c/antizapret-prostovpn-org/az-self-hosted/38"><span data-category-id="38" style="--category-badge-color: #0088CC; --category-badge-text-color: #FFFFFF; --parent-category-badge-color: #8C6238;" data-parent-category-id="5" data-drop-close="true" class="badge-category --has-parent" title="Вопросы и особенности работы контейнера VPN АнтиЗапрета на своих серверах"><span class="badge-category__name">АнтиЗапрет на собственном сервере (self-hosted)</span></span></a>
  </div>
  <blockquote>
    Вероятно, NS-серверы домена заблокировали сетевой доступ для IP-адреса вашего сервера. 
Можно настроить резолв конкретно этого домена через публичный DNS-резолвер. Добавьте в конец конфигурационного файла /etc/knot-resolver/kresd.conf: 
policy.add(
    policy.suffix(
        policy.FORWARD(
            {'77.88.8.8'}
        ),
        policy.todnames({'citilink.ru.'})
    )
)
  </blockquote>
</aside>
<aside class="quote" data-post="440" data-topic="129">
  <div class="title">
    <div class="quote-controls"></div>
    <img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/fageoner/48/1628_2.png" class="avatar">
    <a href="https://ntc.party/t/vpn/129/440">Контейнер VPN АнтиЗапрета для установки на собственный сервер</a> <a class="badge-category__wrapper " href="/c/antizapret-prostovpn-org/az-self-hosted/38"><span data-category-id="38" style="--category-badge-color: #0088CC; --category-badge-text-color: #FFFFFF; --parent-category-badge-color: #8C6238;" data-parent-category-id="5" data-drop-close="true" class="badge-category --has-parent" title="Вопросы и особенности работы контейнера VPN АнтиЗапрета на своих серверах"><span class="badge-category__name">АнтиЗапрет на собственном сервере (self-hosted)</span></span></a>
  </div>
  <blockquote>
    если кто тоже столкнулся с проблемой с доступом к <a href="http://rt.ru" rel="noopener nofollow ugc">rt.ru</a>, как у меня, то всё решилось добавлением вот этих строчек в конце файла /etc/knot-resolver/kresd.conf 
policy.add(
    policy.suffix(
        policy.FORWARD(
            {'77.88.8.8'}
        ),
        policy.todnames({'rt.ru'})
    )
)
  </blockquote>
</aside>
</td><td>2023-07-29T01:33:03.948Z</td></tr><tr><td>namerx</td><td><p>Спасибо, заработало!</p></td><td>2023-07-29T10:40:21.422Z</td></tr><tr><td>Assemble1337</td><td><p>Купил vps с убунту 20.04, поставил snapd, через него curl и lxd, сделал lxd init по дефолту, затем установил антизапрет по инструкции, переустановил dnslib, добавил домены в include-hosts-custom.txt, добавил беллону. OpenVPN на пк подключается к vps, интернет работает; curl <a href="http://icanhazip.com" rel="noopener nofollow ugc">icanhazip.com</a> выдаёт ip-адрес vps в Нидерландах, с моего пк мой российский ip, dnsleaktest тоже показывает Нидерланды (не знаю, насколько это важно), но заблокированные сайты так и не открываются, сейчас вот выдаёт ERR_NAME_NOT_RESOLVED, видимо проблема с днс, но хрен знает куда копать</p>
<p>UPD: сейчас попытался подключить OVPN на роутере, если выбирать “направлять весь трафик через впн”, то интернет не работает вообще, если не выбирать эту опцию, то так же не открываются заблокированные сайты, только с DNS_PROBE_FINISHED_NXDOMAIN</p>
<p>UPD2: снёс систему, сделал всё заново, без понятия как, но заработало</p></td><td>2023-08-01T18:25:46.373Z</td></tr><tr><td>dark321985(Александр)</td><td><p>Доброго дня. Подскажите пожалуйста!<br>
Пытаюсь добавить свои сайты в Include Hosts далее запускаю скрипт<br>
LANG=C.UTF-8 /root/antizapret/doall.sh<br>
после чего выдается ошибка ну и соответственно сайты через ВПН не ходятся</p>
<p>% Total    % Received % Xferd  Average Speed   Time    Time     Time  Current<br>
Dload  Upload   Total   Spent    Left  Speed<br>
100 14.3M  100 14.3M    0     0  14.3M      0  0:00:01  0:00:01 --:–:-- 14.3M</p>
<p><strong>iconv: relocation error: iconv: symbol __gconv_create_spec version GLIBC_PRIVATE not defined in file libc.so.6 with link time reference</strong></p></td><td>2023-08-02T09:10:46.075Z</td></tr><tr><td>flameshikari(Evgeny)</td><td><p>Мне не помогло; пробовал даже на новом контейнере. В итоге в parse.sh после <code>awk -F ';' '{print $2}' temp/list.csv</code> добавил через пайп <code>grep -vP '[ЁёА-я]'</code> и заработало.</p>
<p>В итоге такая строка: <code>awk -F ';' '{print $2}' temp/list.csv | grep -vP '[ЁёА-я]' | sort -u | awk '/^$/ {next} /\\/ {next} /^[а-яА-Яa-zA-Z0-9\-\_\.\*]*+$/ {gsub(/\*\./, ""); gsub(/\.$/, ""); print}' | idn &gt; result/hostlist_original.txt</code></p></td><td>2023-08-02T14:53:24.214Z</td></tr><tr><td>namerx</td><td><p>Подскажите еще пожалуйста, с включенным собственным антизапретом не открываются картинки по адресу:<br>
_<a href="https://ak.picdn.net/shutterstock/videos/1107009801/thumb/1.jpg" rel="noopener nofollow ugc">https://ak.picdn.net/shutterstock/videos/1107009801/thumb/1.jpg</a></p>
<p>пишет</p>
<h1><a name="h-403-error-1" class="anchor" href="#h-403-error-1"></a>403 ERROR</h1>
<h2><a name="the-request-could-not-be-satisfied-2" class="anchor" href="#the-request-could-not-be-satisfied-2"></a>The request could not be satisfied.</h2>
<hr>
<p>Request blocked. We can’t connect to the server for this app or website at this time. There might be too much traffic or a configuration error. Try again later, or contact the app or website owner.<br>
If you provide content to customers through CloudFront, you can find steps to troubleshoot and help prevent this error by reviewing the CloudFront documentation.</p>
<pre><code class="lang-auto">C:\Program Files (x86)\VMware\VMware Player\bin&gt;tracert ak.picdn.net

Трассировка маршрута к d1vkbdka4exaka.cloudfront.net [10.224.0.213]
с максимальным числом прыжков 30:

  1    &lt;1 мс    &lt;1 мс    &lt;1 мс  KEENETIC-6256 [192.168.2.1]
  2    50 ms    49 ms    51 ms  10.224.0.213
  3    50 ms    50 ms    51 ms  10.224.0.213
</code></pre>
<p>пробовал в exclude добавлять <a href="http://ak.picdn.net" rel="noopener nofollow ugc">ak.picdn.net</a> и <a href="http://cloudfront.net" rel="noopener nofollow ugc">cloudfront.net</a>, не помогает. на публичном конфиге проблем нет</p></td><td>2023-08-05T10:54:07.338Z</td></tr><tr><td>ValdikSS</td><td><p>Если с сервера такая же ошибка, то адрес вашего сервера заблокирован на сайте. Проверьте curl’ом.</p></td><td>2023-08-05T12:40:56.000Z</td></tr><tr><td>namerx</td><td><p>curl выдает тоже 403… но без vpn все открывается, почему может не срабатывать exclude? <img src="https://ntc.party/images/emoji/twitter/melting_face.png?v=12" title=":melting_face:" class="emoji" alt=":melting_face:" loading="lazy" width="20" height="20"></p></td><td>2023-08-05T14:42:58.286Z</td></tr><tr><td>nzkhammatov(Ainur Khammatov)</td><td><p>Я попробовал исключить их вот так<br>
<code>/root/antizapret/scripts/getzones.awk</code></p>
<p><img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/6c329b8a0bf03e23e974428152edcf703f710b88.png" alt="Screenshot from 2023-08-06 13-05-26" data-base62-sha1="fr9ZzeOSEQQwDGAcSpyHXjYVhig" width="360" height="202"></p>
<pre><code class="lang-auto">(/picdn/) {next}
(/cloudfront/) {next}
</code></pre>
<p><code>/root/antizapret/doall.sh</code></p>
<p>Результат такой</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/631af726d884c6e58d6ef169829ff53aa768949e.png" data-download-href="https://ntc.party/uploads/default/631af726d884c6e58d6ef169829ff53aa768949e" title="Screenshot from 2023-08-06 13-11-12"><img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/631af726d884c6e58d6ef169829ff53aa768949e_2_517x219.png" alt="Screenshot from 2023-08-06 13-11-12" data-base62-sha1="e8J2ElSptv7Ys1NksCDnUbq3g74" width="517" height="219" srcset="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/631af726d884c6e58d6ef169829ff53aa768949e_2_517x219.png, контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/631af726d884c6e58d6ef169829ff53aa768949e.png 1.5x, контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/631af726d884c6e58d6ef169829ff53aa768949e.png 2x" data-dominant-color="080A09"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">Screenshot from 2023-08-06 13-11-12</span><span class="informations">759×322 37.7 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>Оба хоста теперь не отсвечивают здесь и имеют одинаковые наборы адресов<br>
<code>/etc/knot-resolver/knot-aliases-alt.conf</code></p></td><td>2023-08-06T08:24:44.807Z</td></tr><tr><td>ArchimedRT(Ruslan Arkhipov)</td><td><p>Со вчерашнего вечера постоянно идет переподключение к серверу.<br>
Думал, опять начали блочить протокол, но почему-то <a href="http://vpn.antizapret.prostovpn.org" rel="noopener nofollow ugc">vpn.antizapret.prostovpn.org</a> продолжает работать.<br>
<a class="mention" href="/u/valdikss">@ValdikSS</a> в чем секрет?</p></td><td>2023-08-06T09:58:16.149Z</td></tr><tr><td>namerx</td><td><p>спасибо большое! заработало добавив только<br>
<code>(/picdn/) {next}</code><br>
в /root/antizapret/scripts/getzones.awk</p></td><td>2023-08-06T11:39:55.527Z</td></tr><tr><td>namerx</td><td><p>А подскажите еще пожалуйста, не открываются картинки bbc<br>
_<a href="https://ichef.bbc.co.uk/wwhp/304/cpsprodpb/1F65/production/_130673080_gettyimages-1581269141.jpg" rel="noopener nofollow ugc">https://ichef.bbc.co.uk/wwhp/304/cpsprodpb/1F65/production/_130673080_gettyimages-1581269141.jpg</a><br>
пробовал добавить<code> bbc.co.uk</code> в <code>include-hosts-custom.txt</code> - не помогло</p></td><td>2023-08-06T21:21:14.513Z</td></tr><tr><td>nzkhammatov(Ainur Khammatov)</td><td><p>Удалить отсюда<br>
<code>/root/antizapret/config/exclude-hosts-dist.txt</code></p>
<pre><code class="lang-auto">akamaiedge.net
</code></pre>
<p>Добавить сюда<br>
<code>/root/antizapret/config/include-hosts-custom.txt</code></p>
<pre><code class="lang-auto">bbc.co.uk
akamaiedge.net
edgekey.net
</code></pre>
<p><code>/root/antizapret/doall.sh</code></p>
<p>Добавление CDN может вредить другим ресурсам, имейте в виду.</p></td><td>2023-08-07T01:37:49.084Z</td></tr><tr><td>Oleg(oleg)</td><td><p>Тоже мегафон-волга стал блочить мойсервер, идут переподключения каждые 2 секунды.<br>
Не понятно что нужно сделать</p></td><td>2023-08-07T05:46:40.750Z</td></tr><tr><td>namerx</td><td><p>сделал как написали, не помогает(((<br>
<div class="lightbox-wrapper"><a class="lightbox" href="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/697602a41fc56ce25a4ad844908a2d9296d8e78a.png" data-download-href="https://ntc.party/uploads/default/697602a41fc56ce25a4ad844908a2d9296d8e78a" title="image"><img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/697602a41fc56ce25a4ad844908a2d9296d8e78a.png" alt="image" data-base62-sha1="f2WY9XYyDlWKE99CwNvRRCImEwq" width="690" height="375" data-dominant-color="202121"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">825×449 16.8 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div><br>
<div class="lightbox-wrapper"><a class="lightbox" href="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/fe86f1485a6d378615f7e4795126b9c234cc05d6.png" data-download-href="https://ntc.party/uploads/default/fe86f1485a6d378615f7e4795126b9c234cc05d6" title="image"><img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/fe86f1485a6d378615f7e4795126b9c234cc05d6.png" alt="image" data-base62-sha1="AjEod2rPVsBrgMCAleKoJDLdOBM" width="690" height="375" data-dominant-color="202020"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">825×449 15.6 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div><br>
<div class="lightbox-wrapper"><a class="lightbox" href="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/2bcb929ef42eb5b70b553c79e250c0443525d1a3.png" data-download-href="https://ntc.party/uploads/default/2bcb929ef42eb5b70b553c79e250c0443525d1a3" title="image"><img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/2bcb929ef42eb5b70b553c79e250c0443525d1a3.png" alt="image" data-base62-sha1="6fqGoyN9uXmU3VDN2HoLA0SUPrJ" width="690" height="399" data-dominant-color="1C1C1C"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">1103×639 13.2 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p></td><td>2023-08-07T09:09:45.802Z</td></tr><tr><td>nzkhammatov(Ainur Khammatov)</td><td><p>Покажите результаты из контейнера</p>
<pre><code class="lang-auto">cat /etc/knot-resolver/knot-aliases-alt.conf | grep bbc.co.uk
cat /etc/knot-resolver/knot-aliases-alt.conf | grep edgekey.net
cat /etc/knot-resolver/knot-aliases-alt.conf | grep akamaiedge.net
</code></pre>
<p>И со стороны клиента</p>
<pre><code class="lang-auto">nslookup ichef.bbc.co.uk
nslookup ichef.bbc.co.uk.edgekey.net
nslookup e3891.dscf.akamaiedge.net
</code></pre></td><td>2023-08-07T10:31:48.329Z</td></tr><tr><td>namerx</td><td><p><div class="lightbox-wrapper"><a class="lightbox" href="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/5ae898c1043aa27568df96d36f5c60336a90cc4e.png" data-download-href="https://ntc.party/uploads/default/5ae898c1043aa27568df96d36f5c60336a90cc4e" title="image"><img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/5ae898c1043aa27568df96d36f5c60336a90cc4e.png" alt="image" data-base62-sha1="cYdj7J1SVkpkwTq8qLXy8cWsh7o" width="690" height="376" data-dominant-color="191919"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">825×450 8.83 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div><br>
<div class="lightbox-wrapper"><a class="lightbox" href="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/02987cb523e24650637d39587b49947cebabad1c.png" data-download-href="https://ntc.party/uploads/default/02987cb523e24650637d39587b49947cebabad1c" title="image"><img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/02987cb523e24650637d39587b49947cebabad1c.png" alt="image" data-base62-sha1="mXEK0ldBxVMcdBiURCKtChcGGo" width="690" height="399" data-dominant-color="1E1E1E"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">1103×639 23 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p></td><td>2023-08-07T13:58:28.180Z</td></tr><tr><td>nzkhammatov(Ainur Khammatov)</td><td><p>Все в порядке за исключением этого хоста <code>ichef.bbc.co.uk</code><br>
Его не ресолвит вовсе.</p>
<p>У меня вот так</p>
<p><img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/8469a1021d7e97cfe9271eb57aba95f5e733f849.png" alt="Screenshot from 2023-08-07 19-04-51" data-base62-sha1="iTnkLXj3XdDEEBZPlQmZjJa2waJ" width="324" height="58"></p>
<p>Сложность в этом полагаю.</p>
<p>Из контейнера этот хост доступен?<br>
<code>dig +short ichef.bbc.co.uk</code></p>
<p>И из самой машины, где запущен контейнер тоже.</p></td><td>2023-08-07T14:06:37.991Z</td></tr><tr><td>namerx</td><td><pre><code class="lang-auto">root@antizapret-ams3-02:~# lxc shell antizapret-vpn
root@antizapret-vpn:~# dig +short ichef.bbc.co.uk
ichef.bbc.co.uk.edgekey.net.
e3891.dscf.akamaiedge.net.
23.209.236.241
root@antizapret-vpn:~# logout
root@antizapret-ams3-02:~# dig +short ichef.bbc.co.uk
ichef.bbc.co.uk.edgekey.net.
e3891.dscf.akamaiedge.net.
23.46.75.239
root@antizapret-ams3-02:~#
</code></pre></td><td>2023-08-07T14:31:59.306Z</td></tr><tr><td>nzkhammatov(Ainur Khammatov)</td><td><p>Сложность на стороне клиента возможно, я сдаюсь<br>
<img src="https://ntc.party/images/emoji/twitter/upside_down_face.png?v=12" title=":upside_down_face:" class="emoji only-emoji" alt=":upside_down_face:" loading="lazy" width="20" height="20"></p>
<p>Можете эту ерунду еще попробовать добавить сюда<br>
<code>/etc/knot-resolver/kresd.conf</code></p>
<pre><code class="lang-auto">policy.add(
    policy.suffix(
        policy.FORWARD(
            {'77.88.8.8'}
        ),
        policy.todnames({'bbc.co.uk'})
    )
)
</code></pre></td><td>2023-08-07T14:39:44.960Z</td></tr><tr><td>namerx</td><td><p>удивительно, но само заработало через полдня <img src="https://ntc.party/images/emoji/twitter/rofl.png?v=12" title=":rofl:" class="emoji" alt=":rofl:" loading="lazy" width="20" height="20"> спасибо большое за помощь!</p></td><td>2023-08-07T17:20:07.967Z</td></tr><tr><td>Oleg(oleg)</td><td><aside class="quote" data-post="289" data-topic="666">
  <div class="title">
    <div class="quote-controls"></div>
    <img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/valdikss/48/2_2.png" class="avatar">
    <a href="https://ntc.party/t/mikrotik/666/289">Обход блокировки на mikrotik</a> <a class="badge-category__wrapper " href="/c/antizapret-prostovpn-org/5"><span data-category-id="5" style="--category-badge-color: #8C6238; --category-badge-text-color: #FFFFFF;" data-drop-close="true" class="badge-category " title="Proxy and VPN service for Russian censorship circumvention, discussion and official support forum. Обсуждение работы сервиса обхода блокировок России АнтиЗапрет. Новости, уведомления о проблемах и помощь в настройке."><span class="badge-category__name">antizapret.prostovpn.org</span></span></a>
  </div>
  <blockquote>
    Еще раз немного изменил настройки, напишите, у кого заработало (если не работало), а у кого наоборот перестало работать (если работало).
  </blockquote>
</aside>

<p>Извините, а можно тоже чуток настроек для своего сервера ? а то второй день мегафон не даёт подключаться к впн, при этом Ваш файл работает без проблем.</p></td><td>2023-08-08T02:44:00.545Z</td></tr><tr><td>mafiacheb(Александр)</td><td><p>Для тех у кого установлен контейнер будет какое-то решение в связи с последними событиями?</p></td><td>2023-08-08T13:20:48.382Z</td></tr><tr><td>dark321985(Александр)</td><td><p>Присоединяюсь к вышестоящему вопросу</p></td><td>2023-08-08T18:51:17.785Z</td></tr><tr><td>ValdikSS</td><td><p><a class="mention" href="/u/oleg">@Oleg</a>, <a class="mention" href="/u/mafiacheb">@mafiacheb</a>, <a class="mention" href="/u/dark321985">@dark321985</a>, см. <a href="https://ntc.party/t/%D0%BC%D0%B5%D1%85%D0%B0%D0%BD%D0%B8%D0%B7%D0%BC%D1%8B-%D0%BE%D0%B1%D1%85%D0%BE%D0%B4%D0%B0-%D0%B1%D0%BB%D0%BE%D0%BA%D0%B8%D1%80%D0%BE%D0%B2%D0%BA%D0%B8-vpn/5230/5" class="inline-onebox">Механизмы обхода блокировки vpn - #5 by ValdikSS</a></p></td><td>2023-08-10T12:02:52.163Z</td></tr><tr><td>stek29(Viktor Oreshkin)</td><td><p>Похоже, что это не единственный случай – просто именно в этом случае idn падает.<br>
как минимум есть ещё пара случаев, когда tld .cc записан кириллицей:</p>
<pre><code class="lang-auto"># awk -F ';' '$2~/[a-z]+[а-я]+/{print$2}' temp/list.csv
dog-house.cс
mine-money.cс
p2p4x.cс
s1.dog-house.cс
www.bеllonа.no
www.bеllonа.ru
www.bеllonа.оrg

# awk -F ';' '$2~/[a-z]+[а-я]+/{print$2}' temp/list.csv | CHARSET=utf-8 idn --no-tld
dog-house.xn--c-7tbmine-money.xn--c-7tb
p2p4x.xn--c-7tb
s1.dog-house.xn--c-7tb
www.xn--bllon-8ve4a.no
www.xn--bllon-8ve4a.ru
www.xn--bllon-8ve4a.xn--rg-emc
</code></pre>
<p>Предлагаю добавить в вызов idn флаг <code>--no-tld</code>, чтобы он не проверял правила tld для каждой зоны (и не падал на зоне .no, например)</p>
<p>Оно, кстати, работает ещё в два раза быстрее, если эти проверки отключить (проверял несколько раз в разном порядке, дело именно во флаге)</p>
<pre><code class="lang-auto"># &lt;temp.txt CHARSET=utf-8 time idn &gt;/dev/null
1.48user 0.40system 0:01.90elapsed 98%CPU (0avgtext+0avgdata 2176maxresident)k
0inputs+0outputs (0major+130minor)pagefaults 0swaps

# &lt;temp.txt CHARSET=utf-8 time idn --no-tld &gt;/dev/null
0.71user 0.32system 0:01.05elapsed 97%CPU (0avgtext+0avgdata 2176maxresident)k
0inputs+0outputs (0major+116minor)pagefaults 0swaps
</code></pre></td><td>2023-08-14T04:04:46.259Z</td></tr><tr><td>kyzima-spb(Kirill Vercetti)</td><td><p>Добрый день.</p>
<p>Уже имел опыт установки антизапрета с помощью systemd-machined и все работало. Приходится переезжать =(</p>
<p>Настраивал все также, но не резолвит заблокированные ресурсы. На прошлом сервере если делать ping <a href="http://instagram.com" rel="noopener nofollow ugc">instagram.com</a> (любой другой), то выдавал IP 10.224.1.102, теперь выдает <a href="http://instagram-p42-shv-01-hel3.fbcdn.net" rel="noopener nofollow ugc">instagram-p42-shv-01-hel3.fbcdn.net</a>, ping любого ресурса: заблокированного РКН или добавленного вручную, выдает оригинальный dns (не впн-а). Можете подсказать, в чем проблема?</p>
<p>Debian 11, KVM, если я верно понимаю стоит nftables</p>
<p>p.s. Взял сервер у ruweb в Нидерландах, если поднять wireguard или socks5 через ssh, то заходит на все заблокированные ресурсы за исключением, что 2ip показывает локацию РФ, другие сервисы определения геолокации по IP выдают Нидерланды.</p>
<p>upd. Команда dig <a href="http://instagram.com" rel="noopener nofollow ugc">instagram.com</a> <span class="mention">@127.0.0.1</span> внутри контейнера выдает</p>
<pre><code class="lang-auto">; &lt;&lt;&gt;&gt; DiG 9.11.5-P4-5.1+deb10u1-Debian &lt;&lt;&gt;&gt; instagram.com @127.0.0.1
;; global options: +cmd
;; Got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 49463
;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 4096
;; QUESTION SECTION:
;instagram.com.			IN	A

;; ANSWER SECTION:
instagram.com.		300	IN	A	157.240.214.174

;; Query time: 8 msec
;; SERVER: 127.0.0.1#53(127.0.0.1)
;; WHEN: Tue Aug 15 23:01:15 MSK 2023
;; MSG SIZE  rcvd: 58
</code></pre></td><td>2023-08-15T09:45:52.786Z</td></tr><tr><td>kyzima-spb(Kirill Vercetti)</td><td><p>Разобрался и нашел случайно ответ среди комментариев, дело в “В Реестр попали домены с кириллическими именами в названии”. Как удалить сообщение не нашел, прошу прощения за беспокойство =)</p></td><td>2023-08-15T22:44:44.870Z</td></tr><tr><td>mafiacheb(Александр)</td><td><p>Подскажите пожалуйста, как удалить контейнер антизапрета, без переустановки всей виртуальной машины? Интересно для общего познания, нигде просто не нашел информации в этой теме</p></td><td>2023-08-17T20:03:40.803Z</td></tr><tr><td>Lapa(Lapa)</td><td><aside class="quote no-group" data-username="mafiacheb" data-post="639" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/m/aca169/48.png" class="avatar"> mafiacheb:</div>
<blockquote>
<p>ак удалить контейнер антизапрета</p>
</blockquote>
</aside>
<aside class="onebox allowlistedgeneric" data-onebox-src="https://habr.com/ru/articles/496492/#udalenie-konteynera-navigaciya">
  <header class="source">
      <img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/e8fc7b34a1237fbc93fd62548efc1a4df1f7fa72.png" class="site-icon" data-dominant-color="97BFD2" width="16" height="16">

      <a href="https://habr.com/ru/articles/496492/#udalenie-konteynera-navigaciya" target="_blank" rel="noopener nofollow ugc">Хабр</a>
  </header>

  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:690/361;"><img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/b7c94ddd0685bf954b05a2acd75ff509d1f52622.png" class="thumbnail" data-dominant-color="C3D0C9" width="372" height="343"></div>

<h3><a href="https://habr.com/ru/articles/496492/#udalenie-konteynera-navigaciya" target="_blank" rel="noopener nofollow ugc">Базовые возможности LXD — системы контейнеров в Linux</a></h3>

  <p>LXD — это системный менеджер контейнеров следующего поколения, так гласит источник . Он предлагает пользовательский интерфейс, похожий на виртуальные машины, но использующий вместо этого контейнеры...</p>


  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>
</td><td>2023-08-18T04:40:56.087Z</td></tr><tr><td>Technocat(Konstantin)</td><td><p>Наконец то получилось установить, по совету форумчан, на хостинг от Inferno. Взял сервер в Японии, от меня не далеко, да и оптика туда идёт с Находки. По началу долго не мог понять, почему не работает, пока не полистал сообщения за последние полгода. Вроде бы не палится, что российский, <a href="http://weather.com" rel="noopener nofollow ugc">weather.com</a> открывается, завёл скрипт на роутер Asus, чтобы светодиоды включались и включались по данным от weather. com. Всем большое спасибо.<br>
Ранее, был сервер от хостинга Vdsina, но он раз в месяц тупо зависал, приходилось восстанавливать из бэкапа. Да и ценник у них стал не детский, плюс комиссия дикая.</p></td><td>2023-08-23T10:10:33.442Z</td></tr><tr><td>namerx</td><td><p>А подскажите, пожалуйста, как можно подключиться непосредственно к файловой системе контейнера через WinSCP?</p></td><td>2023-08-23T23:15:10.553Z</td></tr><tr><td>Technocat(Konstantin)</td><td><p>Обыкновенно. Прописать в WinSCP адрес, логин (root) и пароль супер пользователя от своего сервака. Протокол SFTP,  22 порт</p></td><td>2023-08-25T02:31:45.314Z</td></tr><tr><td>mafiacheb(Александр)</td><td><p>подскажите пожалуйста, если так получиться что протокол опен впн будет заблокирован, как можно восстановить работоспособность контейнера через прокси? т.е на впс установлен контейнер антизапрет и 3X-UI(там есть протоколы влес, шадосокс, сокс итд) Можно ли как то в конфиге опенвпн антизапрета подшаманить чтобы он выходит в инет через прокси?</p></td><td>2023-08-25T08:42:53.599Z</td></tr><tr><td>nzkhammatov(Ainur Khammatov)</td><td><aside class="quote no-group" data-username="namerx" data-post="642" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/n/22d042/48.png" class="avatar"> namerx:</div>
<blockquote>
<p>как можно подключиться непосредственно к файловой системе контейнера через WinSCP?</p>
</blockquote>
</aside>
<p><strong>Внутри контейнера</strong></p>
<pre><code class="lang-auto">apt update
apt install net-tools openssh-server -y
</code></pre>
<pre><code class="lang-auto">netstat -npl | grep ":22"
</code></pre>
<p>Добавить это в файл<br>
<code>nano /etc/ssh/sshd_config</code></p>
<pre><code class="lang-auto">Port 25545
AddressFamily inet
PasswordAuthentication yes
PermitRootLogin yes
</code></pre>
<p>Перезапуск сервиса</p>
<pre><code class="lang-auto">systemctl restart ssh
systemctl status ssh
netstat -npl | grep ":25545"
</code></pre>
<p>Задать новый пароль для пользователя <code>root</code><br>
<code>passwd root</code></p>
<p><strong>На хостовой машине - не внутри контейнера</strong></p>
<p><strong>lxd</strong></p>
<pre><code class="lang-auto">lxc config device add antizapret-vpn proxy_25545_ssh proxy listen=tcp:[::]:25545 connect=tcp:127.0.0.1:25545
lxc config device list antizapret-vpn
</code></pre>
<p><strong>systemd-machined &amp; cloud-init</strong></p>
<pre><code class="lang-auto">echo -e "[Network]\nVirtualEthernet=yes\nPort=tcp:1194:1194\nPort=udp:1194:1194\nPort=tcp:25545:25545" &gt; /etc/systemd/nspawn/antizapret-vpn.nspawn
</code></pre>
<p><code>iptables -A INPUT -p tcp -m tcp --dport 25545 -j ACCEPT</code></p>
<p><code>ssh -p 25545 root@127.0.0.1</code><br>
Пароль пользователя <code>root</code></p></td><td>2023-08-25T09:46:02.774Z</td></tr><tr><td>ValdikSS</td><td><aside class="quote no-group" data-username="mafiacheb" data-post="644" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/m/aca169/48.png" class="avatar"> mafiacheb:</div>
<blockquote>
<p>Можно ли как то в конфиге опенвпн антизапрета подшаманить чтобы он выходит в инет через прокси?</p>
</blockquote>
</aside>
<p>OpenVPN поддерживает HTTP и SOCKS-прокси: опции <code>http-proxy</code> и <code>socks-proxy</code> соответственно.<br>
Также можно настроить локальный клиент на «проброс порта» до конкретного удалённого хоста и порта, в этом случае в конфигурационном файле OpenVPN нужно подключаться к localhost и настроенному порту, без прокси. Не забудьте в таком случае добавить маршрут до настоящего IP-адреса сервера директивой <code>route</code>, а то получите петлю маршрутизации.</p></td><td>2023-08-25T12:06:43.022Z</td></tr><tr><td>mafiacheb(Александр)</td><td><p>не затруднит ли вас, написать подробный гайд как это делается для не очень опытных людей? ну т.е по аналогии с инструкций по установки контейнера. пытался самостоятельно найти видео на ютубе или статью как это делается, но что-то ничего не смог найти понятного для простых людей</p></td><td>2023-08-25T14:03:54.028Z</td></tr><tr><td>nzkhammatov(Ainur Khammatov)</td><td><p>Добавить в файл <code>antizapret-tcp.ovpn</code><br>
Строку <code>http-proxy 51.75.70.203 3128</code></p>
<blockquote>
<p><a href="https://openvpn.net/community-resources/connecting-to-an-openvpn-server-via-an-http-proxy/" class="inline-onebox" rel="noopener nofollow ugc">Connecting To An OpenVPN Server Via An HTTP Proxy. | OpenVPN</a></p>
</blockquote></td><td>2023-08-26T14:46:45.662Z</td></tr><tr><td>mafiacheb(Александр)</td><td><p>спасибо получилось<br>
засунул в конфиг антизапрета вот так:</p>
<p><code>http-proxy 192.192.192.192 3456 auto</code><br>
<code>&lt;http-proxy-user-pass&gt;</code><br>
<code>ЛОГИН</code><br>
<code>ПАРОЛЬ</code><br>
<code>&lt;/http-proxy-user-pass&gt;</code></p>
<p>вместо 192.192.192.192 3456 вводите свои данные т.е IP и порт<br>
ну логин и пароль вроде понятно(вставляете туда логин и пароль который создали при создании http прокси), решил себя ими обезопасить</p></td><td>2023-08-26T18:45:21.207Z</td></tr><tr><td>abugray(Georgy)</td><td><p>Первая команда выдает</p>
<p>W: GPG error: <a href="http://download.opensuse.org/repositories/home:/CZ-NIC:/knot-resolver-latest/Debian_10" class="inline-onebox" rel="noopener nofollow ugc">/repositories/home:/CZ-NIC:/knot-resolver-latest/Debian_10 - openSUSE Download</a>  InRelease: The following signatures were invalid: EXPKEYSIG 74062DB36A1F4009 home:CZ-NIC OBS Project <a>home:CZ-NIC@build.opensuse.org</a><br>
E: The repository ‘<a href="http://download.opensuse.org/repositories/home:/CZ-NIC:/knot-resolver-latest/Debian_10" class="inline-onebox" rel="noopener nofollow ugc">/repositories/home:/CZ-NIC:/knot-resolver-latest/Debian_10 - openSUSE Download</a>  InRelease’ is not signed.<br>
N: Updating from such a repository can’t be done securely, and is therefore disabled by default.<br>
N: See apt-secure(8) manpage for repository creation and user configuration details.</p>
<p>Вторая</p>
<p>E: Unable to locate package pip3<br>
E: Unable to locate package install<br>
E: Unable to locate package dnslib<br>
Третья</p>
<p>bash: cd: too many arguments</p>
<p>В общем не работает никак этот контейнер.</p>
<p>Что то мне подсказывает что контейнер пора обновить чтобы все работало как и задумано (Потрать 5 минут и все работает). Но так как это бесплатное решение ничего требовать не могу.</p></td><td>2023-08-27T15:55:34.638Z</td></tr><tr><td>nzkhammatov(Ainur Khammatov)</td><td><aside class="quote" data-post="1" data-topic="5457">
  <div class="title">
    <div class="quote-controls"></div>
    <img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/xperts/48/9920_2.png" class="avatar">
    <a href="https://ntc.party/t/5457/1">Подключаюсь к антизапрету на своем сервере, но заблокированные сайты не открываются</a> <a class="badge-category__wrapper " href="/c/antizapret-prostovpn-org/az-self-hosted/38"><span data-category-id="38" style="--category-badge-color: #0088CC; --category-badge-text-color: #FFFFFF; --parent-category-badge-color: #8C6238;" data-parent-category-id="5" data-drop-close="true" class="badge-category --has-parent" title="Вопросы и особенности работы контейнера VPN АнтиЗапрета на своих серверах"><span class="badge-category__name">АнтиЗапрет на собственном сервере (self-hosted)</span></span></a>
  </div>
  <blockquote>
    Добрый день 
Арендовал VPS на timeweb в Нидерландах. Поднял на нем антизапрет по инструкции - <a href="https://bitbucket.org/anticensority/antizapret-vpn-container/src/master/" class="inline-onebox" rel="noopener nofollow ugc">Bitbucket</a> 
Так вот, я без проблем подключаюсь к антизапрету, DNS определяется как внутри VPN, но не открываются сайты, заблокированные в РФ. При этом все остальные сайты работают. DoT/DoH отключены 
Подскажите, пожалуйста, что можно сюда скинуть и что можно сделать?
  </blockquote>
</aside>
</td><td>2023-08-27T17:14:42.260Z</td></tr><tr><td>abugray(Georgy)</td><td><p>Применить cd /root/dnsmap patch -i p.patch</p>
<p>cd /root/dnsmap patch -i p.patch<br>
bash: cd: too many arguments</p>
<p>Не работает…</p></td><td>2023-08-27T17:26:05.072Z</td></tr><tr><td>Xperts</td><td><p>Работает<br>
Попробуйте выполнять действия в контейнере через lxc exec antizapret-vpn –</p>
<p>Пример:<br>
lxc exec antizapret-vpn – wget <a href="https://raw.githubusercontent.com/nzkhammatov/antizapret_ios_patch/main/p.patch" rel="noopener nofollow ugc">https://raw.githubusercontent.com/nzkhammatov/antizapret_ios_patch/main/p.patch</a> -O /root/dnsmap/p.patch<br>
lxc exec antizapret-vpn – patch -i /root/dnsmap/p.patch<br>
И т.д.</p>
<p>Символ “–” - это два дефиса</p></td><td>2023-08-27T17:48:51.234Z</td></tr><tr><td>abugray(Georgy)</td><td><p>lxc exec antizapret-vpn – patch -i /root/dnsmap/p.patch<br>
Error: unknown shorthand flag: ‘i’ in -i</p>
<p>Тоже не работает</p></td><td>2023-08-27T17:50:20.048Z</td></tr><tr><td>Xperts</td><td><p>А подскажите, пожалуйста, ответ на пару вопросов:</p>
<ol>
<li>Один конфиг - одно устройство? Или один конфиг OpenVPN со своего сервера можно пушить на весь парк девайсов?</li>
<li>После перезагрузки сервера контейнер с антизапретом поднимается сам или нужно стартовать вручную?</li>
</ol></td><td>2023-08-28T08:09:19.840Z</td></tr><tr><td>nzkhammatov(Ainur Khammatov)</td><td><aside class="quote no-group" data-username="Xperts" data-post="655" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/xperts/48/9920_2.png" class="avatar"> Xperts:</div>
<blockquote>
<p>один конфиг OpenVPN со своего сервера можно пушить на весь парк девайсов</p>
</blockquote>
</aside>
<aside class="quote no-group quote-modified" data-username="Xperts" data-post="655" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/xperts/48/9920_2.png" class="avatar"> Xperts:</div>
<blockquote>
<p>после перезагрузки сервера контейнер с антизапретом поднимается сам</p>
</blockquote>
</aside>
<p>Да, верно</p></td><td>2023-08-28T10:26:37.124Z</td></tr><tr><td>old_dick</td><td><p>что-то не могу сообразить как в kresd.conf добавить в net.listen условный 192.168.104.1:5353 который будет всегда отдавать адреса вида 10.224.X.X не зависимо от содержимого списков, как это происходит при обращении к 127.0.0.4</p></td><td>2023-08-29T14:29:33.705Z</td></tr><tr><td>Xperts</td><td><p>Никто, случаем, не знает список доменов bbc для добавления в include-hosts-custom ?</p></td><td>2023-09-03T22:24:21.617Z</td></tr><tr><td>LeonMskRu(Leon MskRu)</td><td><p>как то так.<br>
<a href="https://urlscan.io/result/c4c85fc2-b680-4853-b56c-2bc045353dda/#summary" class="inline-onebox" rel="noopener nofollow ugc">www.bbc.com - urlscan.io</a> смотреть domain tree<br>
<a href="https://urlscan.io/result/c4c85fc2-b680-4853-b56c-2bc045353dda/#transactions" class="inline-onebox" rel="noopener nofollow ugc">www.bbc.com - urlscan.io</a></p></td><td>2023-09-04T07:17:12.541Z</td></tr><tr><td>Xperts</td><td><p>Спасибо. С вебом вопрос решился. Не могли бы еще подсказать, как посмотреть хосты для мобильного приложения на iOS? BBC Russian не хочет заводиться</p></td><td>2023-09-04T08:43:03.213Z</td></tr><tr><td>LeonMskRu(Leon MskRu)</td><td><p>как вариант <a href="https://www.charlesproxy.com/documentation/ios/" class="inline-onebox" rel="noopener nofollow ugc">Charles for iOS • Charles Web Debugging Proxy</a> или другие прокси<br>
via <a href="https://apple.stackexchange.com/questions/331630/how-to-find-the-urls-accessed-by-ios-apps" class="inline-onebox" rel="noopener nofollow ugc">network - How to find the URLs accessed by iOS Apps? - Ask Different</a></p></td><td>2023-09-04T09:53:30.693Z</td></tr><tr><td>Xperts</td><td><p>Прикол в том, что чарликом я уже поснифал и добавил домен, связанный с bbc. Пуши airship и фаирбейс не стал добавлять</p>
<p>Видимо после вызова <a href="http://news-app.api.bbc.co.uk" rel="noopener nofollow ugc">news-app.api.bbc.co.uk</a> должны быть еще редиректы, которые я почему-то не вижу</p>
<p>Кажется проще пустить все приложение по другой VPN целиком. Так и сделаю, спасибо за советы</p></td><td>2023-09-04T10:01:19.577Z</td></tr><tr><td>pikapikapikaaa(Pikapikapikaaa)</td><td><p>Подскажите, есть какой-нибудь способ завернуть antizapret с vps сервера через ShadowSocks (ну или что там сейчас не блокируется))?<br>
Рабочие схемы по подобной работе в связке с mikrotik мб?</p></td><td>2023-09-07T11:42:26.544Z</td></tr><tr><td>Xperts</td><td><p>Подскажите плз, для чего нужен exclude-hosts-dist.txt ?<br>
Я в нем вижу 4 хоста, с которых прилетают обложки и превьюшки в ютуб:<br>
<a href="http://yt3.ggpht.com" class="onebox" target="_blank" rel="noopener nofollow ugc">yt3.ggpht.com</a><br>
<a href="http://yt4.ggpht.com" class="onebox" target="_blank" rel="noopener nofollow ugc">yt4.ggpht.com</a><br>
<a href="http://s.ytimg.com" class="onebox" target="_blank" rel="noopener nofollow ugc">s.ytimg.com</a><br>
<a href="http://i.ytimg.com" class="onebox" target="_blank" rel="noopener nofollow ugc">i.ytimg.com</a></p>
<p><a href="http://yt3.ggpht.com" rel="noopener nofollow ugc">yt3.ggpht.com</a> и <a href="http://i.ytimg.com" rel="noopener nofollow ugc">i.ytimg.com</a> заблокированы и есть в реестре. Про <a href="http://yt4.ggpht.com" rel="noopener nofollow ugc">yt4.ggpht.com</a> и <a href="http://s.ytimg.com" rel="noopener nofollow ugc">s.ytimg.com</a> не нашел информацию, И, что интересно, <a href="http://yt3.ggpht.com" rel="noopener nofollow ugc">yt3.ggpht.com</a> и <a href="http://yt4.ggpht.com" rel="noopener nofollow ugc">yt4.ggpht.com</a> ходят через антизапрет. А <a href="http://s.ytimg.com" rel="noopener nofollow ugc">s.ytimg.com</a> и <a href="http://i.ytimg.com" rel="noopener nofollow ugc">i.ytimg.com</a> ходят через обычный интернет. И у меня периодически перестают прилетать превьюшки в YouTube mob app под антизапретом. Думаю из за того, что <a href="http://i.ytimg.com" rel="noopener nofollow ugc">i.ytimg.com</a> ходит через обычный интернет</p>
<p>Я могу выпилить хосты из exclude-hosts-dist.txt и добавить в include-hosts-custom.txt ?</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/577ce559c22f4f4675ea99835c6467b26b551564.png" data-download-href="https://ntc.party/uploads/default/577ce559c22f4f4675ea99835c6467b26b551564" title="Снимок экрана 2023-09-11 в 11.24.56"><img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/577ce559c22f4f4675ea99835c6467b26b551564_2_690x118.png" alt="Снимок экрана 2023-09-11 в 11.24.56" data-base62-sha1="ctX7WEIT1g6nbYc52v5yG0tMPZ2" width="690" height="118" srcset="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/577ce559c22f4f4675ea99835c6467b26b551564_2_690x118.png, контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/577ce559c22f4f4675ea99835c6467b26b551564.png 1.5x, контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/577ce559c22f4f4675ea99835c6467b26b551564.png 2x" data-dominant-color="3D3D3D"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">Снимок экрана 2023-09-11 в 11.24.56</span><span class="informations">885×152 46.9 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div><br>
<div class="lightbox-wrapper"><a class="lightbox" href="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/02ef11e75a60f37835025b32ae2f017380381b0d.png" data-download-href="https://ntc.party/uploads/default/02ef11e75a60f37835025b32ae2f017380381b0d" title="Снимок экрана 2023-09-11 в 11.25.15"><img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/02ef11e75a60f37835025b32ae2f017380381b0d.png" alt="Снимок экрана 2023-09-11 в 11.25.15" data-base62-sha1="pX9UINlXLIcISEPwuKqsMEA8vb" width="690" height="94" data-dominant-color="383838"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">Снимок экрана 2023-09-11 в 11.25.15</span><span class="informations">895×122 32.6 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div><br>
<div class="lightbox-wrapper"><a class="lightbox" href="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/33d000331e654f3a3f6d53caae706106952a139c.png" data-download-href="https://ntc.party/uploads/default/33d000331e654f3a3f6d53caae706106952a139c" title="Снимок экрана 2023-09-11 в 11.24.36"><img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/33d000331e654f3a3f6d53caae706106952a139c.png" alt="Снимок экрана 2023-09-11 в 11.24.36" data-base62-sha1="7olZpTOy79gQvefBkfCh6FdrWMY" width="690" height="94" data-dominant-color="383838"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">Снимок экрана 2023-09-11 в 11.24.36</span><span class="informations">865×118 30.8 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div><br>
<div class="lightbox-wrapper"><a class="lightbox" href="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/ae01494b0ab09b187fc83f7871c04d2d561f5159.png" data-download-href="https://ntc.party/uploads/default/ae01494b0ab09b187fc83f7871c04d2d561f5159" title="Снимок экрана 2023-09-11 в 11.24.14"><img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/ae01494b0ab09b187fc83f7871c04d2d561f5159.png" alt="Снимок экрана 2023-09-11 в 11.24.14" data-base62-sha1="oPjPOBF0o1npYrtYQbP8BXXWv4B" width="690" height="94" data-dominant-color="424242"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">Снимок экрана 2023-09-11 в 11.24.14</span><span class="informations">844×115 37.8 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p></td><td>2023-09-11T08:30:55.188Z</td></tr><tr><td>nzkhammatov(Ainur Khammatov)</td><td><aside class="quote quote-modified" data-post="436" data-topic="129">
  <div class="title">
    <div class="quote-controls"></div>
    <img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/nzkhammatov/48/4650_2.png" class="avatar">
    <a href="https://ntc.party/t/129/436">Контейнер VPN АнтиЗапрета для установки на собственный сервер</a> <a class="badge-category__wrapper " href="/c/antizapret-prostovpn-org/az-self-hosted/38"><span data-category-id="38" style="--category-badge-color: #0088CC; --category-badge-text-color: #FFFFFF; --parent-category-badge-color: #8C6238;" data-parent-category-id="5" data-drop-close="true" class="badge-category --has-parent" title="Вопросы и особенности работы контейнера VPN АнтиЗапрета на своих серверах"><span class="badge-category__name">АнтиЗапрет на собственном сервере (self-hosted)</span></span></a>
  </div>
  <blockquote>
    Добавить сюда 
/root/antizapret/config/include-hosts-custom.txt 
youtube.com
youtu.be
ytimg.com
ggpht.com
googleusercontent.com
googlevideo.com
google.com
googleapis.com

Удалить отсюда 
В скобках количество записей требующих удаления. 
/root/antizapret/config/exclude-hosts-dist.txt 
youtube.com (2)
youtu.be (1)
ytimg.com (3)
ggpht.com (2)
googleusercontent.com (1)
googlevideo.com (0)
google.com (0)
googleapis.com (0)

Тоже удалить 
/root/antizapret/config/exclude-regexp-dist.awk 

(/googleuserc…
  </blockquote>
</aside>
</td><td>2023-09-11T15:35:11.886Z</td></tr><tr><td>Xperts</td><td><p>Заработало. Спасибо</p>
<p>P.S. С проигрыванием ютуба даже лучше стало. Раньше из за отключения кеш серверов были проблемы с автокачеством. Оно не выбиралось автоматически на максимально доступное, очень медленно повышалось, могло остановиться на fhd</p>
<p>Сейчас изи ставится на максимально доступное <img src="https://ntc.party/images/emoji/twitter/slight_smile.png?v=12" title=":slight_smile:" class="emoji" alt=":slight_smile:" loading="lazy" width="20" height="20"></p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/cf3ac359c555822ac8b9ef7814f57f52b1b446cd.png" data-download-href="https://ntc.party/uploads/default/cf3ac359c555822ac8b9ef7814f57f52b1b446cd" title="Снимок экрана 2023-09-12 в 09.27.56"><img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/cf3ac359c555822ac8b9ef7814f57f52b1b446cd_2_690x242.png" alt="Снимок экрана 2023-09-12 в 09.27.56" data-base62-sha1="tzeJC6yO1YAwJiw9z12BWle67DL" width="690" height="242" srcset="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/cf3ac359c555822ac8b9ef7814f57f52b1b446cd_2_690x242.png, контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/cf3ac359c555822ac8b9ef7814f57f52b1b446cd.png 1.5x, контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/cf3ac359c555822ac8b9ef7814f57f52b1b446cd.png 2x" data-dominant-color="242323"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">Снимок экрана 2023-09-12 в 09.27.56</span><span class="informations">774×272 75.9 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p></td><td>2023-09-11T19:25:42.465Z</td></tr><tr><td>Alexled(alex)</td><td><p>Добрый день<br>
Перестал подключаться на провайдере Дом.ру, бесконечно реконнектит к VPN. Кто нибудь сталкивался с подобным?</p></td><td>2023-09-12T18:47:22.939Z</td></tr><tr><td>mafiacheb(Александр)</td><td><p>У меня тоже, хотя у меня выход настроен через прокси</p></td><td>2023-09-12T18:50:12.736Z</td></tr><tr><td>alexunderrrqw(Alex)</td><td><p>Добрый день, тема обширная, быстро поискал по запросу DNS в теме, и искал в интернете по запросу DNS Антизапрет.<br>
Пытаюсь понять рациональность, и нужен ли мне Антизапрет на собственном сервере<br>
Сейчас все настроено в роутере и работает без нареканий. Но в качестве резолвера я вижу<br>
51.75.75.245 anticensorship-proxy.antizapret.prostovpn.org.OVH SASGermany<br>
а иногда французские сервера.</p>
<p>Мой вопрос, если я настрою антизапрет на своем сервере, у меня в качестве ДНС резолвера будет другой сервер?  - тот на котором у меня установлен контейнер…<br>
Можно ли как то сделать при работающем Антизапрет, что бы при проверке на сайтах, таких как <a href="http://dnsleaktest.com" rel="noopener nofollow ugc">dnsleaktest.com</a> например, я получал в результатах другие адреса DNS, например гугл?</p>
<p>Спасибо</p></td><td>2023-09-13T08:28:00.678Z</td></tr><tr><td>ilyaigpetrov(ilyaigpetrov)</td><td><aside class="quote no-group" data-username="dartraiden" data-post="5" data-topic="1652">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/dartraiden/48/15299_2.png" class="avatar"><a href="https://ntc.party/t/antizapret-pihole/1652/5">Antizapret + PiHole</a></div>
<blockquote>
<p>Таким образом, клиенты обращаются с DNS-запросами к роутеру, тот к Pi-hole, Pi-hole в качестве апстрима обращается к 8.8.8.8 и 77.88.8.8, трафик до которых (благодаря созданным с помощью конфига маршрутам) улетает в туннель, где его перехватывает DNS Antizapret.</p>
</blockquote>
</aside>
<p>8.8.8.8 – это Google.<br>
77.88.8.8 – это Яндекс.</p>
<aside class="quote no-group" data-username="alexunderrrqw" data-post="669" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/alexunderrrqw/48/3119_2.png" class="avatar"> alexunderrrqw:</div>
<blockquote>
<p>если я настрою антизапрет на своем сервере, у меня в качестве ДНС резолвера будет другой сервер? - тот на котором у меня установлен контейнер…</p>
</blockquote>
</aside>
<p>Думаю, что тот, который будет работать внутри контейнера на сервере. К нему VPN заврочивает все DNS-запросы.</p>
<p>Из <a href="https://bitbucket.org/anticensority/antizapret-vpn-container/src/master/README.md">README</a>:</p>
<blockquote>
<p>На VPN-сервере запущен специальный DNS-резолвер, устанавливающий отображение (соответствие, маппинг) настоящего IP-адреса домена в свободный IP-адрес большой внутренней подсети, и отдающий запрашиваемому клиенту адрес из внутренней подсети.</p>
</blockquote></td><td>2023-09-13T08:54:01.017Z</td></tr><tr><td>Kebu</td><td><p>Несколько дней стал очень медленно загружаться инстаграм в ios-приложении. Перезагружал и контейнер, и сервер целиком. На других ресурсах падения скорости не наблюдаю.</p></td><td>2023-09-13T10:28:13.094Z</td></tr><tr><td>Xperts</td><td><aside class="quote no-group" data-username="alexunderrrqw" data-post="669" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/alexunderrrqw/48/3119_2.png" class="avatar"> alexunderrrqw:</div>
<blockquote>
<p>Пытаюсь понять рациональность, и нужен ли мне Антизапрет на собственном сервере</p>
</blockquote>
</aside>
<p>На собственном сервере скорость выше + работает стабильнее + возможность кастомно заворачивать доменные зоны на свой антизапрет</p>
<aside class="quote no-group" data-username="alexunderrrqw" data-post="669" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/alexunderrrqw/48/3119_2.png" class="avatar"> alexunderrrqw:</div>
<blockquote>
<p>Но в качестве резолвера я вижу<br>
51.75.75.245 anticensorship-proxy.antizapret.prostovpn.org.OVH SASGermany<br>
а иногда французские сервера.</p>
</blockquote>
</aside>
<p>Это нормально для публичного конфига. Так понимаю, что владелец антизапрета хостится на тех серверах</p>
<aside class="quote no-group" data-username="alexunderrrqw" data-post="669" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/alexunderrrqw/48/3119_2.png" class="avatar"> alexunderrrqw:</div>
<blockquote>
<p>Мой вопрос, если я настрою антизапрет на своем сервере, у меня в качестве ДНС резолвера будет другой сервер? - тот на котором у меня установлен контейнер…</p>
</blockquote>
</aside>
<p>Все верно. Читать про особенности маршрутизации - <a href="https://bitbucket.org/anticensority/antizapret-vpn-container/src/master/" class="inline-onebox" rel="noopener nofollow ugc">Bitbucket</a></p>
<aside class="quote no-group" data-username="alexunderrrqw" data-post="669" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/alexunderrrqw/48/3119_2.png" class="avatar"> alexunderrrqw:</div>
<blockquote>
<p>Можно ли как то сделать при работающем Антизапрет, что бы при проверке на сайтах, таких как <a href="http://dnsleaktest.com" rel="noopener nofollow ugc">dnsleaktest.com </a> например, я получал в результатах другие адреса DNS, например гугл?</p>
</blockquote>
</aside>
<p>Тогда антизапрет не будет работать</p></td><td>2023-09-13T16:41:59.525Z</td></tr><tr><td>dartraiden(Alexander Gavrilov)</td><td><aside class="quote no-group" data-username="alexunderrrqw" data-post="669" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/alexunderrrqw/48/3119_2.png" class="avatar"> alexunderrrqw:</div>
<blockquote>
<p>Можно ли как то сделать при работающем Антизапрет, что бы при проверке на сайтах, таких как <a href="http://dnsleaktest.com">dnsleaktest.com </a> например, я получал в результатах другие адреса DNS, например гугл?</p>
</blockquote>
</aside>
<p>Вы можете сделать так, что ваш сервер, на котором запущен контейнер, будет в качестве апстрима использовать Google DNS. При посещении <a href="http://dnsleaktest.com">dnsleaktest.com</a> с клиента вы будете видеть адрес своего сервера (потому что клиент резолвит через ваш сервер, где поднят контейнер), но по факту, это будет Google (т.к. ваш сервер использует Google DNS как апстрим). Тут как в анекдоте “что вам важнее: шашечки или ехать”.</p></td><td>2023-09-16T14:31:54.160Z</td></tr><tr><td>Xperts</td><td><p>Подскажите плз, я получу какой-то реальный прирост производительности резолвера если повыкидывать все из exclude файлов? Или даже заморачиваться не стоит?</p></td><td>2023-09-16T20:11:13.278Z</td></tr><tr><td>Egorovna</td><td><p>Здравствуйте. Развернул антизапрет на сервере в Казахстане. Работает вроде всё норм, но замечаю что через какое-то время адреса становятся недоступны. Если подождать минуту и пару раз перезагрузить страницу, то снова всё открывается. Подключаюсь через openwrt на роутере. Подскажите, что может быть за проблема?</p></td><td>2023-09-17T16:40:15.627Z</td></tr><tr><td>Unauthorized(Gleb)</td><td><p>Здравствуйте! Хотелось бы узнать где вы списки берете?</p></td><td>2023-09-18T16:00:25.985Z</td></tr><tr><td>rubberducky</td><td><p>Здравствуйте, помогите пожалуйста, использую “собственный” сервер, все было хорошо, не знаю что случилось, заметил проблему 3-5д. назад, клиенты к серверу без проблем подключаются но обход перестал работать, заблокированные ресурсы не открываются</p>
<p>Мой сервер днс резолвит из adguard-dns, при проверке через <a href="http://dnsleaktest.com" rel="noopener nofollow ugc">dnsleaktest.com</a> днс от адгуарда отображается</p></td><td>2023-09-24T13:39:06.425Z</td></tr><tr><td>rubberducky</td><td><p>не знаю что случилось, после ребута сервера начала работать как положено</p></td><td>2023-09-25T00:15:36.325Z</td></tr><tr><td>maxpain(Maxim Makarov)</td><td><p>Всем привет. На мегафоне и МТС через iOS приложение OpenVPN постоянное переподключение происходит. Можно ли как-то пофиксить?</p></td><td>2023-09-29T06:54:38.320Z</td></tr><tr><td>Xperts</td><td><p>Все претензии в РКН</p></td><td>2023-09-30T21:35:19.131Z</td></tr><tr><td>xtrime</td><td><p>Хочу поблагодарить за совет с --no-tld!</p>
<p>Последние пару дней чинил свой контейнер с антизапретом. Вот, что получилось.</p>
<p>Без удаление интернациональных доменов knot начинал работать, но быстро переставал. В журнале ошибок не увидел. Без таких доменов работает. Добавил в сборку:</p>
<pre><code class="lang-bash">sed -i -E "s/(CHARSET=UTF-8 idn)/\1 --no-tld | grep -Fv 'xn--'/g" /root/antizapret/parse.sh
</code></pre>
<p>Так же почему то отвалился системный DNS в контейнере, пришлось хотфиксить с помощью добавления в entrypoint:</p>
<pre><code class="lang-auto">echo "nameserver 1.1.1.1" &gt;&gt; /etc/resolv.conf
</code></pre>
<p>Еще заметил, что мои провайдеры начали резать udp: проходит несколько пакетов и все. tcp пока работает.</p></td><td>2023-10-03T19:52:27.613Z</td></tr><tr><td>timer</td><td><p>Ребята подскажите плз какие домены пустить через VPN чтобы заработал Copilot на W11 23H2</p></td><td>2023-10-05T09:58:11.672Z</td></tr><tr><td>mrplap</td><td><p>Его и без впн можно запустить.<br>
через dns от <a href="http://comss.ru" rel="noopener nofollow ugc">comss.ru</a><br>
<a href="https://www.comss.ru/page.php?id=12015" class="inline-onebox" rel="noopener nofollow ugc">Как включить Windows Copilot с чатом Bing в Windows 11</a><br>
(в моём случае, прописывал эти dns не в системе, а в браузере edge)</p></td><td>2023-10-05T12:10:40.040Z</td></tr><tr><td>Ernieleo(Max)</td><td><p>Здравствуйте.<br>
Стабильно раз в месяц отваливается обход блокировок, перестает выдавать IP сайтов " DNS request timed out. timeout was 2 seconds", такое может произойти даже сразу после чистой установки с применением всех требуемых ручных изменений (патч, правка строки), достаточно сделать перезагрузку контейнера lxc либо всей системы.<br>
Базируется на EC 2 от Amazon на Ubuntu 22 и пробовал на 20, ничего от версии не меняется.</p>
<p>В чем может быть проблема? Если это из-за хостинга, то хотелось бы понять причину.</p></td><td>2023-10-19T19:21:18.349Z</td></tr><tr><td>preha</td><td><p>Почему-то начал отваливаться туннель. Если пинговать запрещённые домены, то всё в порядке, трасса идёт через контейнер, но если попытаться на этот же домен через браузер, то туннель тут же падает. p.patch на кириллицу в доменах и dnsmap накатил, как писали выше, но это не помогло. Да и не понятно, почему всё прекрасно обновлялось и работало столько времени, а буквально вчера сломалось с концами. Причём, если идти через АнтиЗапрет, то всё в порядке, так что, думаю, проблема именно с конфигурацией контейнера</p></td><td>2023-10-20T07:47:13.331Z</td></tr><tr><td>Bilexes(Dmitriy Kulakov)</td><td><p>Подскажите пожалуйста как отключить автообновление списка доменов или настроить это обновление в определенное время… Сервер с 1 процом и 1Гб оперативки (которая забивается &gt;90%) при обновлении списка грузит процессор но 100% от 5 до 20 минут, при этом интернет почти не работает. Кстати если перезагрузить сервер при этом, то оживает и обновляет все в разы быстрее. Очень напрягает, хочется поставить это обновление например в 4 часа ночи, или вообще отключить и запускать вручную по необходимости…<br>
Причем раньше такое замечал раз, два в месяц, а последнее время 3-4 раза в неделю. Патч применял, без него вообще не обновлял список, но и работал почти без отвалов ))</p></td><td>2023-10-21T18:03:40.433Z</td></tr><tr><td>DoplerEffect</td><td><p>Перестало работать приложение XBox для Windows, так же вообще не заходит в клиент League of legends при работающем антизапрет на роутере, не могу понять куда копать , потому что замена днс на провайдерские или на те которые не идут через туннель антизапрета, решает проблему. Патчи последние применены. Самое интересное что все обходы или простые сайты работают нормально</p>
<p>Дня два назад еще все работало нормально , не понимаю что случилось , ничего не трогал<br>
Через “Общий” антизапрет такая же беда</p></td><td>2023-10-22T14:37:11.131Z</td></tr><tr><td>bokov333(Bokov333)</td><td><p>lxc shell antizapret-vpn nano “/etc/systemd/system/antizapret-update.timer”</p></td><td>2023-10-22T15:59:13.765Z</td></tr><tr><td>ValdikSS</td><td><p>Продиагностировать можно вот так, там же написана и возможная причина.</p>
<aside class="quote quote-modified" data-post="21" data-topic="6042">
  <div class="title">
    <div class="quote-controls"></div>
    <img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/valdikss/48/2_2.png" class="avatar">
    <a href="https://ntc.party/t/%D0%BD%D0%B5-%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D0%B0%D0%B5%D1%82-%D1%81%D0%B0%D0%B9%D1%82-valorant-%D0%B8-steam/6042/21">Не работает сайт Valorant и Steam</a> <a class="badge-category__wrapper " href="/c/antizapret-prostovpn-org/5"><span data-category-id="5" style="--category-badge-color: #8C6238; --category-badge-text-color: #FFFFFF;" data-drop-close="true" class="badge-category " title="Proxy and VPN service for Russian censorship circumvention, discussion and official support forum. Обсуждение работы сервиса обхода блокировок России АнтиЗапрет. Новости, уведомления о проблемах и помощь в настройке."><span class="badge-category__name">antizapret.prostovpn.org</span></span></a>
  </div>
  <blockquote>
    Установите <a href="https://www.wireshark.org/download.html">WireShark</a>
Выберите в нём сетевой интерфейс и укажите в строке filter: port 53 or port 443
Запустите захват
Запустите игру
Посмотрите, по-первых, идёт ли какой-либо трафик на адреса 10.x.x.x, а во-вторых, есть ли какие-то адреса, на которые не удаётся подключение (много красных строк TCP SYN).

Наиболее вероятно, что резолверам антизапрета выдаются геобалансированные IP-адреса для какого-то конкретного домена, которые заблокированы в РФ. А для DNS-запросов из России выдаётся другой на…
  </blockquote>
</aside>
</td><td>2023-10-22T16:48:31.439Z</td></tr><tr><td>DoplerEffect</td><td><p><a class="attachment" href="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/cqFKjfGmNFGVvUNTSSmsip3Z4lJ.pcapng">xbox.pcapng</a> (1,5 МБ)<br>
ничего красного нет почти, но не грузятся картинки и приложение не работает</p></td><td>2023-10-22T18:59:01.717Z</td></tr><tr><td>ValdikSS</td><td><p>Блокируется доступ к <code>catalog.gamepass.com (104.109.143.31)</code>.<br>
Любые HTTPS-запросы к этому IP-адресу блокируются на ТСПУ, независимо от домена.</p></td><td>2023-10-22T19:06:58.312Z</td></tr><tr><td>DoplerEffect</td><td><p>Проблемы оказались не только с xbox и лигой , так же внезапно перестали открываться картинки в додопицце<br>
CNAME: <a href="http://dodopizza-a.akamaihd.net.edgesuite.net" rel="noopener nofollow ugc">dodopizza-a.akamaihd.net.edgesuite.net</a>.<br>
CNAME: <a href="http://a1211.dscd.akamai.net" rel="noopener nofollow ugc">a1211.dscd.akamai.net</a>.<br>
A: 104.109.143.21<br>
A: 104.109.143.27<br>
Почти все проблемы которые у меня возникли это с этим akamai, мой сервер в нидерландах резолвит для него 104.109.143.* которые судя по всему в рф не работают.</p></td><td>2023-10-23T05:57:47.024Z</td></tr><tr><td>nzkhammatov(Ainur Khammatov)</td><td><p><strong>Выполнять внутри контейнера</strong><br>
<code>root@antizapret-vpn:~#</code></p>
<aside class="quote no-group" data-username="Bilexes" data-post="686" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/b/34f0e0/48.png" class="avatar"> Bilexes:</div>
<blockquote>
<p>как отключить автообновление списка доменов</p>
</blockquote>
</aside>
<pre><code class="lang-auto">systemctl stop antizapret-update.timer
systemctl disable antizapret-update.timer
</code></pre>
<aside class="quote no-group" data-username="Bilexes" data-post="686" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/b/34f0e0/48.png" class="avatar"> Bilexes:</div>
<blockquote>
<p>или настроить это обновление в определенное время</p>
</blockquote>
</aside>
<p><code>nano /etc/systemd/system/antizapret-update.timer</code></p>
<pre><code class="lang-auto">[Unit]
Description=Run antizapret-vpn update at 5:00:00

[Timer]
OnCalendar=*-*-* 5:00:00 Asia/Yekaterinburg
Persistent=true

[Install]
WantedBy=timers.target
</code></pre>
<details>
<summary>
miscellaneous</summary>
<pre><code class="lang-auto">timedatectl list-timezones | grep "Yekaterinburg"
timedatectl list-timezones | grep "Moscow"
</code></pre>
</details>
<pre><code class="lang-auto">systemctl enable antizapret-update.timer
systemctl restart antizapret-update.timer
</code></pre></td><td>2023-10-29T05:44:04.224Z</td></tr><tr><td>Anton111111(Anton Potekhin)</td><td><p>Вчера пытался по инструкции  поднять антизапрет на своем впс и уперся в то что нет инета внутри контенера. Как не мучался так и не понял как заставить его работать и плюнул. Далее на гитхабе увидел докер с антизапретом. И он сразу завелся и работает. Так вот вопрос есть какие-то подводные камни при использование докера?</p></td><td>2023-11-01T08:18:22.061Z</td></tr><tr><td>maxpain(Maxim Makarov)</td><td><p>Настроил antizapret на mikrotik роутере в офисе, всё работало шикарно, но через неделю перестали резолвиться адреса Google, а через пару дней начались проблемы с Apple App Store. Перезагрузка контейнера помогла. Можно ли как-то исправить этот баг? Заметил что такое происходит при большом количестве клиентов (у нас в офисе 60 устройств)</p></td><td>2023-11-03T01:44:40.316Z</td></tr><tr><td>nzkhammatov(Ainur Khammatov)</td><td><aside class="quote no-group" data-username="maxpain" data-post="695" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/maxpain/48/1828_2.png" class="avatar"> maxpain:</div>
<blockquote>
<p>antizapret на mikrotik</p>
</blockquote>
</aside>
<aside class="quote no-group" data-username="maxpain" data-post="695" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/maxpain/48/1828_2.png" class="avatar"> maxpain:</div>
<blockquote>
<p>перестали резолвиться адреса</p>
</blockquote>
</aside>
<aside class="quote no-group" data-username="maxpain" data-post="695" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/maxpain/48/1828_2.png" class="avatar"> maxpain:</div>
<blockquote>
<p>Перезагрузка контейнера помогла</p>
</blockquote>
</aside>
<p>Пробуйте</p><aside class="quote quote-modified" data-post="241" data-topic="666">
  <div class="title">
    <div class="quote-controls"></div>
    <img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/nzkhammatov/48/4650_2.png" class="avatar">
    <a href="https://ntc.party/t/666/241">Обход блокировки на mikrotik</a> <a class="badge-category__wrapper " href="/c/antizapret-prostovpn-org/5"><span data-category-id="5" style="--category-badge-color: #8C6238; --category-badge-text-color: #FFFFFF;" data-drop-close="true" class="badge-category " title="Proxy and VPN service for Russian censorship circumvention, discussion and official support forum. Обсуждение работы сервиса обхода блокировок России АнтиЗапрет. Новости, уведомления о проблемах и помощь в настройке."><span class="badge-category__name">antizapret.prostovpn.org</span></span></a>
  </div>
  <blockquote>
    <a href="https://ntc.party/t/mikrotik/666/175">Сборник ссылок</a> 

Сценарий для произвольного использования на ваше усмотрение. 
:global Resolver "192.168.104.1";
:global Hostname1 "linode.com";
:global Hostname2 "ovh.com";
:global Hostname3 "hetzner.com";
:global Final "0";
:global Compare "1";
:global Result1 "0";
:global Result2 "0";
:global Result3 "0";
:do {:resolve $Hostname1 server=$Resolver; :global Result1 "1"} on-error={:global Result1 "0"};
:do {:resolve $Hostname2 server=$Resolver; :global Result2 "1"} on-error={:global Result2 "0"…
  </blockquote>
</aside>

<p>Если речь про свой контейнер</p><aside class="quote quote-modified" data-post="8" data-topic="4089">
  <div class="title">
    <div class="quote-controls"></div>
    <img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/nzkhammatov/48/4650_2.png" class="avatar">
    <a href="https://ntc.party/t/4089/8">Dns антизапрета перестает резолвить</a> <a class="badge-category__wrapper " href="/c/antizapret-prostovpn-org/5"><span data-category-id="5" style="--category-badge-color: #8C6238; --category-badge-text-color: #FFFFFF;" data-drop-close="true" class="badge-category " title="Proxy and VPN service for Russian censorship circumvention, discussion and official support forum. Обсуждение работы сервиса обхода блокировок России АнтиЗапрет. Новости, уведомления о проблемах и помощь в настройке."><span class="badge-category__name">antizapret.prostovpn.org</span></span></a>
  </div>
  <blockquote>
    <a href="https://ntc.party/t/mikrotik/666/175">Сборник ссылок</a> 

В моем случае со своим АнтиЗапрет контейнером помогло добавление вот этих настроек 
push "sndbuf 524288"
push "rcvbuf 524288"

В два конфигурационных файла внутри контейнера 
/etc/openvpn/server/antizapret.conf
/etc/openvpn/server/antizapret-tcp.conf

Мой АнтиЗапрет работает на маршрутизаторе, и при подключении сразу нескольких клиентов, которые используют одновременно разные приложения (instagram, youtube), пропадала возможность ресолва адресов 
Если на телевизоре работал yout…
  </blockquote>
</aside>
</td><td>2023-11-03T03:02:13.938Z</td></tr><tr><td>abugray(Georgy)</td><td><p>Поделись ссылкой на докер контейнер, потому что здешний антизапрет у меня точно так же как у тебя не работает. Нет инета и все. Копался копался и точно так же как ты плюнул на это дело.</p></td><td>2023-11-03T11:55:52.617Z</td></tr><tr><td>Anton111111(Anton Potekhin)</td><td><aside class="onebox githubrepo" data-onebox-src="https://github.com/xtrime-ru/antizapret-vpn-docker">
  <header class="source">

      <a href="https://github.com/xtrime-ru/antizapret-vpn-docker" target="_blank" rel="noopener nofollow ugc">github.com</a>
  </header>

  <article class="onebox-body">
    <div class="github-row" data-github-private-repo="false">
  <img width="690" height="344" src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/3f4178cf7cc0e54e77da75dbf645e8b493f49c39_2_690x344.png" class="thumbnail" data-dominant-color="EBEDED">

  <h3><a href="https://github.com/xtrime-ru/antizapret-vpn-docker" target="_blank" rel="noopener nofollow ugc">GitHub - xtrime-ru/antizapret-vpn-docker: Docker container with antizapret-vpn for...</a></h3>

    <p><span class="github-repo-description">Docker container with antizapret-vpn for selfhosting.</span></p>
</div>

  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>
</td><td>2023-11-03T12:07:03.165Z</td></tr><tr><td>donnyg</td><td><aside class="quote no-group" data-username="Anton111111" data-post="694" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/anton111111/48/1793_2.png" class="avatar"> Anton111111:</div>
<blockquote>
<p>Вчера пытался по инструкции поднять антизапрет на своем впс и уперся в то что нет инета внутри контенера</p>
</blockquote>
</aside>
<aside class="onebox allowlistedgeneric" data-onebox-src="https://documentation.ubuntu.com/lxd/en/latest/howto/network_bridge_firewalld/#prevent-connectivity-issues-with-lxd-and-docker">
  <header class="source">
      <img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/896ad64ba2e6bcfe765edc2983a9a878f3753080.png" class="site-icon" data-dominant-color="EE7A51" width="48" height="48">

      <a href="https://documentation.ubuntu.com/lxd/en/latest/howto/network_bridge_firewalld/#prevent-connectivity-issues-with-lxd-and-docker" target="_blank" rel="noopener nofollow ugc">LXD documentation</a>
  </header>

  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:255/400;"><img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/f98fee0554bb8e6248d77486b57858cf9ae3e426.png" class="thumbnail" data-dominant-color="EB693C" width="255" height="400"></div>

<h3><a href="https://documentation.ubuntu.com/lxd/en/latest/howto/network_bridge_firewalld/#prevent-connectivity-issues-with-lxd-and-docker" target="_blank" rel="noopener nofollow ugc">How to configure your firewall</a></h3>

  <p>Linux firewalls are based on netfilter. LXD uses the same subsystem, which can lead to connectivity issues. If you run a firewall on your system, you might need to configure it to allow network tra...</p>


  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>
</td><td>2023-11-03T14:43:42.761Z</td></tr><tr><td>maxpain(Maxim Makarov)</td><td><p>Снова возникла проблема с сервисами Apple (App Store, Apple Music).<br>
Почему-то домены <a href="http://aod.itunes.apple.com" rel="noopener nofollow ugc">aod.itunes.apple.com</a>, <a href="http://mvod.itunes.apple.com" rel="noopener nofollow ugc">mvod.itunes.apple.com</a>, <a href="http://apptrailers.itunes.apple.com" rel="noopener nofollow ugc">apptrailers.itunes.apple.com</a>, <a href="http://apptrailers.itunes.g.aaplimg.com" rel="noopener nofollow ugc">apptrailers.itunes.g.aaplimg.com</a> и другие резолвятся на какой-то украинский IP-адрес, а не на IP-адрес Apple:</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/619c6c4c7a9376c433e72e9ac378a19d3ac525e6.jpeg" data-download-href="https://ntc.party/uploads/default/619c6c4c7a9376c433e72e9ac378a19d3ac525e6" title="image"><img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/619c6c4c7a9376c433e72e9ac378a19d3ac525e6_2_449x500.jpeg" alt="image" data-base62-sha1="dVvrRHNrYzpbchTYfos1XfUF1Cm" width="449" height="500" srcset="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/619c6c4c7a9376c433e72e9ac378a19d3ac525e6_2_449x500.jpeg, контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/619c6c4c7a9376c433e72e9ac378a19d3ac525e6_2_673x750.jpeg 1.5x, контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/619c6c4c7a9376c433e72e9ac378a19d3ac525e6_2_898x1000.jpeg 2x" data-dominant-color="1C1B1B"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">1268×1410 111 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>Перезагрузка antizapret контейнера не помогает.</p>
<p>Кстати, этот IP-адрес 193.57.46.176, AS60159 (EUROLINE UKRAINE LLC) отдаётся DNS-сервером Hetzner в Финляндии и из России не пингуется.</p>
<p>Другие же DNS-сервера отдают IP-адреса 17.253.15.196, 151.101.131.8 и тому подобные, они пингуются при этом.</p>
<p>Получается нельзя использовать Hetzner DNS, попробую 1.1.1.1.</p></td><td>2023-11-13T10:15:24.817Z</td></tr><tr><td>maxpain(Maxim Makarov)</td><td><p>Пришлось в /etc/dnsmap/proxy.py поменять default upstream dns с 8.8.8.8 на 1.1.1.1</p></td><td>2023-11-13T11:33:13.958Z</td></tr><tr><td>Lyapnev(Lyapnev)</td><td><p>Подскажите поставил на vps контейнер lxc. Подключаюсь к серверу vps по tcp. С подключенного ПК делаю запросы с запрещенным сайтам и получаю адрес реального ip а не ip в туннель vpn.<br>
Ответ DNS:<br>
nslookup <a href="http://instagram.com" rel="noopener nofollow ugc">instagram.com</a><br>
╤хЁтхЁ:  UnKnown<br>
Address:  192.168.104.1</p>
<p>Не заслуживающий доверия ответ:<br>
╚ь :     <a href="http://instagram.com" rel="noopener nofollow ugc">instagram.com</a><br>
Addresses:  2a03:2880:f213:e4:face:b00c:0:4420<br>
157.240.205.174</p>
<p>Подскажите, что исправить.</p>
<p>p.s. патч применял<br>
выполнял как в посте 552</p></td><td>2023-11-14T13:00:50.244Z</td></tr><tr><td>Xirurg</td><td><p>Отлично работает , почему-то  в разы быстрее  чем поднимать  по инструкции с сайта.</p></td><td>2023-11-15T00:06:33.806Z</td></tr><tr><td>maxpain(Maxim Makarov)</td><td><p>antizapret-container все-равно почему-то использует рандомные DNS сервера в качестве апстрима, судя по tcpdump. Как явно указать какие upstream dns сервера использовать? <a class="mention" href="/u/valdikss">@ValdikSS</a></p></td><td>2023-11-15T13:30:52.937Z</td></tr><tr><td>maxpain(Maxim Makarov)</td><td><p>Получилось пофиксить это. Прописал в <code>/etc/knot-resolver/kresd.conf</code> следующую строчку в самом конце:<br>
<code>policy.add(policy.all(policy.FORWARD({'77.88.8.8'})))</code></p>
<p>Это решило проблему с geo-балансировкой сайтов, когда в разных регионах отдаются разные IP-адреса DNS-серверами. Но это также создало две проблемы:</p>
<ol>
<li>Увеличилось время резолва, поскольку моему VPN-серверу в Финляндии приходится обращаться к DNS-серверу в Москве. В идеале бы DNS-сервер антизапрета разместить в РФ, а сам VPN-сервер оставить в Финляндии.</li>
<li>Для сайтов, которые открываются через VPN, по-хорошему нужно использовать рекурсивный резолвер. Как этого добиться?</li>
</ol></td><td>2023-11-15T14:04:21.808Z</td></tr><tr><td>kyzima-spb(Kirill Vercetti)</td><td><p>Доброго времени суток. Возможно ли сделать так, чтобы определенный домен открывался через vpn? Пример, антизапрет стоит на vps в Германии, а домены ChatGPT открываются через vpn в США?</p></td><td>2023-11-16T18:11:26.972Z</td></tr><tr><td>Anton111111(Anton Potekhin)</td><td><p>Подскажите вот перестал работать <a href="http://image.tmdb.org" rel="noopener nofollow ugc">image.tmdb.org</a>.<br>
Проверяю nslookup <a href="http://image.tmdb.org" rel="noopener nofollow ugc">image.tmdb.org</a> и вижу Address: 10.224.0.1. Но в браузере вижу ошибку от cloudfare как будто идет запрос не через антизпрет.<br>
Подрубаю через wg к этому же серверу и начинает работать.<br>
Что-то можно сделать чтобы заработало ?</p></td><td>2023-11-18T16:33:19.131Z</td></tr><tr><td>ValdikSS</td><td><aside class="quote no-group" data-username="Anton111111" data-post="708" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/anton111111/48/1793_2.png" class="avatar"> Anton111111:</div>
<blockquote>
<p>Но в браузере вижу ошибку от cloudfare как будто идет запрос не через антизпрет.</p>
</blockquote>
</aside>
<p>Возможно, у вас в браузере используется не системный DNS. Нажмите F12 - Network и посмотрите, на какой адрес уходит запрос.</p></td><td>2023-11-23T00:17:13.195Z</td></tr><tr><td>lHumaNl(Aleksandr)</td><td><p>Коллеги, возникли проблемы со Steam’ом. Почему-то траффик идет через контейнер, из-за чего не могу открыть главную. Главная html открывается, хоть и тянется явно из другого ip, но вот остальные реквесты вообще не отвечают (как например <a href="http://store.akamai.steamstatic.com" rel="noopener nofollow ugc">store.akamai.steamstatic.com</a> или <a href="http://avatars.akamai.steamstatic.com" rel="noopener nofollow ugc">avatars.akamai.steamstatic.com</a>). Все патчи и правку кириллицы ставил.</p>
<p>В nslookup с подключением к antizapret и без.</p>
<p>При этом, я все необходимые хосты добавил в:<br>
/root/antizapret/config/exclude-regexp-dist.awk<br>
/root/antizapret/config/exclude-hosts-dist.txt<br>
/root/antizapret/config/exclude-hosts-custom.txt</p>
<p><img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/e907689d50e04cfcacd195e2cef60e0667b9d711.png" alt="Снимок экрана 2023-11-28 195540" data-base62-sha1="xft7F1nVGwdj0SXyMEpVX732f5v" width="436" height="323"><br>
<img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/d616c7cabb88fb9c229592810eb1bf5ec8e62700.png" alt="Снимок экрана 2023-11-28 195902" data-base62-sha1="uxUZ6pelUJnbgpGCVE61VUFCjU4" width="550" height="153"><br>
<img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/2d77e7aa0983fa0e9349da096b47bd160a0ddadf.png" alt="Снимок экрана 2023-11-28 195918" data-base62-sha1="6uenDMdFsuaHu9RYs5VWnib80Rp" width="559" height="174"><br>
<img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/a805c83ac51c3147d79a5a7f06855afeb32bded2.png" alt="Снимок экрана 2023-11-28 195943" data-base62-sha1="nYoBoO3J98CLDeVznd5AYm0gxY6" width="554" height="314"></p></td><td>2023-11-28T17:00:12.948Z</td></tr><tr><td>d3nisov(Alexey)</td><td><p>Добрый день, сделал всё строго по инструкции “С помощью LXD” под Ubuntu 20.24.</p>
<p>Скармливаю файл кинетику, включаю соединение, пишет “Нет соединения”. Настройки следующие:<br>
<div class="lightbox-wrapper"><a class="lightbox" href="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/8f280e82a156bb6f77d7972f3e16ecdcc9d0a32d.png" data-download-href="https://ntc.party/uploads/default/8f280e82a156bb6f77d7972f3e16ecdcc9d0a32d" title="Снимок экрана 2023-11-30 в 03.45.04"><img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/8f280e82a156bb6f77d7972f3e16ecdcc9d0a32d_2_680x500.png" alt="Снимок экрана 2023-11-30 в 03.45.04" data-base62-sha1="kqq69M0scmyhPIzDvF0XpYCeQtD" width="680" height="500" srcset="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/8f280e82a156bb6f77d7972f3e16ecdcc9d0a32d_2_680x500.png, контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/8f280e82a156bb6f77d7972f3e16ecdcc9d0a32d_2_1020x750.png 1.5x, контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/8f280e82a156bb6f77d7972f3e16ecdcc9d0a32d_2_1360x1000.png 2x" data-dominant-color="F5F5F6"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">Снимок экрана 2023-11-30 в 03.45.04</span><span class="informations">1388×1020 81.6 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>Я же правильно понимаю, что в случае с self-hosted антизапретом (поставил на vps в Нидерландах), никакие настройки DNS на роутере делать не следует? Возможно, есть ли какой-то чуть более развёрнутый гайд?</p>
<p>Заранее простите за возможное невежество.</p></td><td>2023-11-30T00:48:03.132Z</td></tr><tr><td>bolvan</td><td><p>Недавно развертывал для изучения этот контейнер<br>
Он не встанет как надо сразу. Там ошибка скрипта идет, без правки ничего не получилось.<br>
Если не можете разбить “черный ящик” на части и проверить работу каждого по отдельности (например, хотя бы подключиться БЕЗ роутера с клиента виндовс могли же ? проверить , что есть процесс openvpn на сервере, что порт прослушивается ) . А вот так взять скопипастить команды и чтобы сразу. Не начинайте лучше. Или готовьтесь разбираться</p>
<p>Мне пришлось закомментировать “set -e” в /root/antizapret/parse.sh, потому что IDN выдавал ошибку, и это завершало скрипт. Он не генерил файлы, необходимые для запуска openvpn сервер</p>
<p>#!/bin/bash<br>
<span class="hashtag-raw">#set</span> -e</p></td><td>2023-11-30T07:01:54.507Z</td></tr><tr><td>d3nisov(Alexey)</td><td><p>Могу только в клиенте под iOS проверить. Вот такой лог, если есть возможность направить приблизительно куда копать, буду крайне благодарен.</p>
<pre><code class="lang-auto">[Nov 30, 2023, 12:34:57] START CONNECTION

[Nov 30, 2023, 12:34:57] ----- OpenVPN Start -----
OpenVPN core 3.8.3connect1 ios arm64 64-bit

[Nov 30, 2023, 12:34:57] OpenVPN core 3.8.3connect1 ios arm64 64-bit

[Nov 30, 2023, 12:34:57] Frame=512/2112/512 mssfix-ctrl=1250

[Nov 30, 2023, 12:34:57] NOTE: This configuration contains options that were not used:

[Nov 30, 2023, 12:34:57] Unsupported option (ignored)

[Nov 30, 2023, 12:34:57] 7 [resolv-retry] [infinite]

[Nov 30, 2023, 12:34:57] 8 [persist-key]

[Nov 30, 2023, 12:34:57] 9 [persist-tun]

[Nov 30, 2023, 12:34:57] EVENT: RESOLVE

[Nov 30, 2023, 12:34:57] Contacting 178.208.90.43:1194 via TCP

[Nov 30, 2023, 12:34:57] EVENT: WAIT

[Nov 30, 2023, 12:34:57] Connecting to [178.208.90.43]:1194 (178.208.90.43) via TCP

[Nov 30, 2023, 12:34:57] EVENT: CONNECTING

[Nov 30, 2023, 12:34:57] Tunnel Options:V4,dev-type tun,link-mtu 1559,tun-mtu 1500,proto TCPv4_CLIENT,cipher AES-128-CBC,auth SHA1,keysize 128,key-method 2,tls-client

[Nov 30, 2023, 12:34:57] Creds: UsernameEmpty/PasswordEmpty

[Nov 30, 2023, 12:34:57] Sending Peer Info:
IV_VER=3.8.3connect1
IV_PLAT=ios
IV_NCP=2
IV_TCPNL=1
IV_PROTO=990
IV_MTU=1600
IV_CIPHERS=AES-128-CBC:AES-192-CBC:AES-256-CBC:AES-128-GCM:AES-192-GCM:AES-256-GCM:CHACHA20-POLY1305
IV_AUTO_SESS=1
IV_GUI_VER=net.openvpn.connect.ios_3.4.1-5463
IV_SSO=webauth,openurl,crtext


[Nov 30, 2023, 12:34:57] VERIFY FAIL: depth=1, /CN=AntiZapret CA, signature: RSA-SHA256 [self-signed certificate in certificate chain]

[Nov 30, 2023, 12:34:57] Transport Error: OpenSSLContext::SSL::read_cleartext: BIO_read failed, cap=2640 status=-1: error:0A000086:SSL routines::certificate verify failed

[Nov 30, 2023, 12:34:57] EVENT: CERT_VERIFY_FAIL OpenSSLContext::SSL::read_cleartext: BIO_read failed, cap=2640 status=-1: error:0A000086:SSL routines::certificate verify failed [ERR]

[Nov 30, 2023, 12:34:57] EVENT: DISCONNECTED

[Nov 30, 2023, 12:34:57] EVENT: CORE_THREAD_DONE

[Nov 30, 2023, 12:34:58] EVENT: DISCONNECT_PENDING

[Nov 30, 2023, 12:34:58] Raw stats on disconnect:
  BYTES_IN : 2531
  BYTES_OUT : 349
  PACKETS_IN : 3
  PACKETS_OUT : 3
  SSL_ERROR : 1
  CERT_VERIFY_FAIL : 1


[Nov 30, 2023, 12:34:58] Performance stats on disconnect:
  CPU usage (microseconds): 34556
  Network bytes per CPU second: 83342
  Tunnel bytes per CPU second: 0
</code></pre></td><td>2023-11-30T09:47:52.554Z</td></tr><tr><td>bolvan</td><td><p>Копать в сторону неправильного конфига с неверным сертификатом CA<br>
Там в /root есть easy_rsa, где есть скрипт, создающий готовый конфиг для клиентов. Вот оттуда и надо брать конфиг, а не править в стандартном антизапрет конфиге IP адрес<br>
После прогона generate.sh может понадобится перезапустить openvpn сервер внутри контейнера или сам контейнер целиком, чтобы точно ключи совпадали</p></td><td>2023-11-30T12:43:12.328Z</td></tr><tr><td>mafiacheb(Александр)</td><td><p>Здравствуйте <a class="mention" href="/u/valdikss">@ValdikSS</a> в связи с этой новостью <a href="https://ntc.party/t/%D0%BD%D1%83%D0%B6%D0%B5%D0%BD-%D0%B0%D0%BD%D1%82%D0%B8%D0%B7%D0%B0%D0%BF%D1%80%D0%B5%D1%82-%D0%B2-2024-%D0%B3%D0%BE%D0%BB%D0%BE%D1%81%D1%83%D0%B9/6370" class="inline-onebox">Нужен АнтиЗапрет в 2024? Голосуй!</a><br>
если уж так вдруг случиться что сервис перестанет существовать, на своем впс он продолжит работу и просто списки не будут обновляться? или тоже ничего работать не будет?</p></td><td>2023-12-05T06:53:16.545Z</td></tr><tr><td>vid(Vid)</td><td><p>Обнаружил, что длинные хосты из файла include-hosts-custom.txt, похоже не перенаправляются через свой DNS. Например, nslookup <a href="http://chat.openai.com.cdn.cloudflare.net" rel="noopener nofollow ugc">chat.openai.com.cdn.cloudflare.net</a> или <a href="http://api.app.prod.grazie.aws.intellij.net" rel="noopener nofollow ugc">api.app.prod.grazie.aws.intellij.net</a> возвращает “родные” ip-шники.</p>
<p>А nslookup <a href="http://chat.openai.com" rel="noopener nofollow ugc">chat.openai.com</a> – отрабатывает нормально. Есть какое-то ограничение по длине хоста? Патч установил, doall выполнился без ошибок, кэш очистил. Куда копать?</p></td><td>2023-12-08T07:04:47.661Z</td></tr><tr><td>mejorcorreo</td><td><p>Доброго времени суток.<br>
Ни с того ни с сего перестал работать антизапрет.<br>
Хостинг - Perfect Quality. Страна - Нидерланды.<br>
Контейнер живой. Соединение с ним есть, но не открываются сайты даже не из списка, т.е. вообще никакие. Контейнер перезагружал, сам сервер тоже.</p></td><td>2023-12-10T06:53:41.438Z</td></tr><tr><td>lxd_user(Vik)</td><td><p>Приветствую.<br>
Подскажите как завернуть весь трафик pornhub через контейнер для страны откуда он запрещен полностью?<br>
Удалял домены из exclude, добавлял <a href="http://pornhub.com" rel="noopener nofollow ugc">pornhub.com</a>, <a href="http://rt.pornhub.com" rel="noopener nofollow ugc">rt.pornhub.com</a> и другие домены в include, но в итоге перестает резолвиться rt.pornhub.<br>
Спасибо.</p></td><td>2023-12-14T12:40:23.093Z</td></tr><tr><td>Kebu</td><td><p>Доброго времени суток! Сталкивался кто-нибудь с проблемой загрузки превьюшек в ютубе? Причем то грузит без проблем, то частями, то все пустые. Можно ли завернуть какие-то из адресов в список антизапрета?</p></td><td>2023-12-21T12:42:19.864Z</td></tr><tr><td>Anonimno(Anonimno)</td><td><p>На личном VPN, помогло с отображением привью это добавление обращений к <a href="http://play.google.com">play.google.com</a> через туннель.</p></td><td>2023-12-21T15:04:51.609Z</td></tr><tr><td>Kebu</td><td><p>Перестали открываться сайты НЕ из include-host — до этого месяца работало как часы, безо всяких замен.</p></td><td>2023-12-21T16:59:59.850Z</td></tr><tr><td>Kebu</td><td><p>В итоге удалил контейнер, переустановил заново, отредактировал parse.sh для доменов с кириллицей, но не могу установить патч:</p>
<pre><code class="lang-auto">root@v684041628:~# lxc exec antizapret-vpn -- bash
root@antizapret-vpn:~# cd /root/dnsmap
root@antizapret-vpn:~/dnsmap# patch -i p.patch
bash: patch: command not found
</code></pre>
<p>Никакие заблокированные сайты при этом не открываются — ни из include-list, ни из общего списка.</p></td><td>2023-12-22T10:45:55.121Z</td></tr><tr><td>Sheva(Semyon Shevchenko)</td><td><p>Аналогичная проблема на Vultr. Не могу понять, в чем проблем и как продиагностировать. При этом к коммунальному все подключается и загружается… РКН что-ли накрутил чего…</p></td><td>2023-12-22T22:07:18.286Z</td></tr><tr><td>stupidityIsntCrime</td><td><p>спрашивал <a href="https://ntc.party/t/%D0%B1%D0%BB%D0%BE%D0%BA%D0%B8%D1%80%D0%BE%D0%B2%D0%BA%D0%B0-%D0%B0%D0%B4%D1%80%D0%B5%D1%81%D0%BE%D0%B2-ua-%D0%B2-%D1%80%D1%84-01122023/6386/50">там</a> заблочили тогда спрошу здесь можит кто нить знает как насроеть коньтэйнер чтобы все домемы по маске (например <code>*.ua</code>) шли через его ане по одному закидывать в <code>include-hosts-customs</code>?!</p></td><td>2023-12-23T10:55:53.699Z</td></tr><tr><td>Lapa(Lapa)</td><td><p>Внутри контейнера нужно установить patch.<br>
Типа apt install patch</p></td><td>2023-12-25T06:56:32.278Z</td></tr><tr><td>Kebu</td><td><p>Спасибо!</p></td><td>2023-12-25T15:57:38.810Z</td></tr><tr><td>Wosh</td><td><p>Люди добрые помогите.<br>
Пробовал поднимать lxc на трех серверах (2 российских и 1 во франции)<br>
Убунта 20.4<br>
Установка проходит без ошибок. lxc ставил через snap<br>
ovpn файл создается, подключается с ip 192.168.104.2. С компа на 192.168.104.1 пинг проходит.<br>
Из контейнера antizapret-vpn на 192.168.104.2 пинг так же проходит.<br>
но рутрекер не открывается как и другие сайты из запрещенки.<br>
В контейнере интернет есть соответственно.</p></td><td>2024-01-03T13:37:44.269Z</td></tr><tr><td>zzr</td><td><p>каким обранизом понтключаешетсь? как днс контэйнера на сроутэре\компе или через опенвпн программа? если днс как используется то надо проверить если оно работает должно возвращать например <code>nslookup rutracker.org</code> заблокированые который как из 10.хх.ххх понтсети если оно работает если опенвпн программу то надо чтоб версия самой программы старая была ане самая новая у меня такая тема была возьмиете какую нето 2.5.1 не выше тогда проканает ето потому что оно даже пре понтключении предупреждает что некторые опции которые заданы в конфиге deprecated а чтобы было всё збс надо сам контейнер обнволять а валидкасс не хочет)</p>
<p>ps<br>
а может ваще провайдер блочит етот палевный опенвпн протокол?<br>
у меня например по ночам отваличается контейнер на микротеке логи видно что оно отваливается ночью днём всё збс</p></td><td>2024-01-10T06:28:40.273Z</td></tr><tr><td>maxpain(Maxim Makarov)</td><td><p><a class="mention" href="/u/valdikss">@ValdikSS</a> Добавил <a href="http://yt3.ggpht.com" rel="noopener nofollow ugc">yt3.ggpht.com</a> в <code>include-hosts-custom.txt</code>, иногда резолвятся оба адреса сразу: Локальный 10.224.5.178 и публичный 74.125.131.198.</p>
<p>В чём может быть проблема?</p>
<p>Если добавить <a href="http://wide-youtube.l.google.com" rel="noopener nofollow ugc">wide-youtube.l.google.com</a> в <code>include-hosts-custom.txt</code> то весь трафик до <a href="http://google.com" rel="noopener nofollow ugc">google.com</a> начинает идти через VPN, а мне это не нужно. Можно ли это как-то исправить?</p>
<p>Похожая история с <a href="http://play.google.com" rel="noopener nofollow ugc">play.google.com</a>, хочется только этот домен зароутить в VPN, а роутится весь <a href="http://google.com" rel="noopener nofollow ugc">google.com</a> целиком</p></td><td>2024-01-11T11:17:23.474Z</td></tr><tr><td>stupidityIsntCrime</td><td><p>он уже отвечел про ето <a href="https://ntc.party/t/%D0%BA%D0%BE%D0%BD%D1%82%D0%B5%D0%B9%D0%BD%D0%B5%D1%80-vpn-%D0%B0%D0%BD%D1%82%D0%B8%D0%B7%D0%B0%D0%BF%D1%80%D0%B5%D1%82%D0%B0-%D0%B4%D0%BB%D1%8F-%D1%83%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B8-%D0%BD%D0%B0-%D1%81%D0%BE%D0%B1%D1%81%D1%82%D0%B2%D0%B5%D0%BD%D0%BD%D1%8B%D0%B9-%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80/129/160">тут</a> я так сделаль на свойём контэйнере и стало норм тока невс и плэй прокидыватся ане весь гугол</p></td><td>2024-01-12T17:04:45.388Z</td></tr><tr><td>Alexled(alex)</td><td><p>Добрый вечер. Появилась проблема с доступностью Антизапрета через мобильный МТС. У кого-нибудь есть решение этой проблемы?</p>
<p>При подключении бесконечные попытки подключиться и реконнект.</p></td><td>2024-01-16T19:01:11.371Z</td></tr><tr><td>maxpain(Maxim Makarov)</td><td><p>топ, помогло.<br>
Но вот с <a href="http://wide-youtube.l.google.com" rel="noopener nofollow ugc">wide-youtube.l.google.com</a> проблема, он резолвит иногда публичный адрес, иногда приватный. Не понимаю в чем проблема.</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/76708dbe88f74d068b6b5d4c03c24535dd87c26e.png" data-download-href="https://ntc.party/uploads/default/76708dbe88f74d068b6b5d4c03c24535dd87c26e" title="image"><img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/76708dbe88f74d068b6b5d4c03c24535dd87c26e.png" alt="image" data-base62-sha1="gTLuaN8WWRSFRVrHEveJTOIdG5U" width="690" height="390" data-dominant-color="222222"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">1040×588 31.4 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>А иногда вовсе резолвит только публичный IP:</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/41d1b194604036a9a8d407551712aabfe2e2d730.jpeg" data-download-href="https://ntc.party/uploads/default/41d1b194604036a9a8d407551712aabfe2e2d730" title="image"><img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/41d1b194604036a9a8d407551712aabfe2e2d730_2_690x404.jpeg" alt="image" data-base62-sha1="9ogiJDIrXOyAm8Vi85FSWLsTE3K" width="690" height="404" srcset="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/41d1b194604036a9a8d407551712aabfe2e2d730_2_690x404.jpeg, контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/41d1b194604036a9a8d407551712aabfe2e2d730_2_1035x606.jpeg 1.5x, контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/41d1b194604036a9a8d407551712aabfe2e2d730.jpeg 2x" data-dominant-color="1D1D1D"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">1068×626 108 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p></td><td>2024-01-17T11:13:59.166Z</td></tr><tr><td>rubberducky</td><td><p>Всем привет, можно ли как то настроить контейнер чтоб TOR browser тоже работал?</p></td><td>2024-01-20T13:39:30.603Z</td></tr><tr><td>dennis(denis)</td><td><p>Всем привет. Подскажите, есть варианты реализации контейнера на Shadowsocks? OpenVPN у нас все чаще блокируется…</p></td><td>2024-01-20T18:22:50.595Z</td></tr><tr><td>ValdikSS</td><td><aside class="quote no-group" data-username="mafiacheb" data-post="715" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/m/aca169/48.png" class="avatar"> mafiacheb:</div>
<blockquote>
<p>в связи с этой новостью <a href="https://ntc.party/t/%D0%BD%D1%83%D0%B6%D0%B5%D0%BD-%D0%B0%D0%BD%D1%82%D0%B8%D0%B7%D0%B0%D0%BF%D1%80%D0%B5%D1%82-%D0%B2-2024-%D0%B3%D0%BE%D0%BB%D0%BE%D1%81%D1%83%D0%B9/6370">Нужен АнтиЗапрет в 2024? Голосуй! </a><br>
если уж так вдруг случиться что сервис перестанет существовать, на своем впс он продолжит работу и просто списки не будут обновляться? или тоже ничего работать не будет?</p>
</blockquote>
</aside>
<p>Всё продолжит работать, контейнер автономен и не скачивает никакую информацию с веб-сайта.</p>
<aside class="quote no-group" data-username="mejorcorreo" data-post="717" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/m/d78d45/48.png" class="avatar"> mejorcorreo:</div>
<blockquote>
<p>Ни с того ни с сего перестал работать антизапрет.</p>
</blockquote>
</aside>
<p>Проверяйте работу DNS, в первую очередь. Если домены разолвятся через VPN, то смотрите маршрутизацию — возможно, что-то сломалось на хосте, например.<br>
Если домены не резолвятся, см. kresd, его конфигурационные файлы и логи. Возможно, его убил oom-killer из-за перерасхода памяти.<br>
Для работы контейнера нужно применять охапку патчей, если вы его только установили.</p>
<aside class="quote no-group" data-username="lxd_user" data-post="718" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/l/a6a055/48.png" class="avatar"> lxd_user:</div>
<blockquote>
<p>Удалял домены из exclude, добавлял <a href="http://pornhub.com">pornhub.com </a>, <a href="http://rt.pornhub.com">rt.pornhub.com </a> и другие домены в include, но в итоге перестает резолвиться rt.pornhub.</p>
</blockquote>
</aside>
<p>А с вашего сервера он вообще резолвится напрямую? Некоторые NS’ы блокируют диапазоны хостингов.<br>
<code>$ dig +short rt.pornhub.com @ns13.digicertdns.net.</code></p>
<aside class="quote no-group" data-username="maxpain" data-post="730" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/maxpain/48/1828_2.png" class="avatar"> maxpain:</div>
<blockquote>
<p><a class="mention" href="/u/valdikss">@ValdikSS</a> Добавил <a href="http://yt3.ggpht.com">yt3.ggpht.com </a> в <code>include-hosts-custom.txt</code>, иногда резолвятся оба адреса сразу: Локальный 10.224.5.178 и публичный 74.125.131.198.</p>
</blockquote>
</aside>
<aside class="quote no-group" data-username="maxpain" data-post="733" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/maxpain/48/1828_2.png" class="avatar"> maxpain:</div>
<blockquote>
<p>Но вот с <a href="http://wide-youtube.l.google.com">wide-youtube.l.google.com </a> проблема, он резолвит иногда публичный адрес, иногда приватный. Не понимаю в чем проблема.</p>
</blockquote>
</aside>
<p>Возможно, в кеше. Хотя TTL низкие, кеш бы давно протух. Не знаю, нужно разбираться.</p>
<aside class="quote no-group" data-username="rubberducky" data-post="735" data-topic="129" data-full="true">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/r/e9bcb4/48.png" class="avatar"> rubberducky:</div>
<blockquote>
<p>Всем привет, можно ли как то настроить контейнер чтоб TOR browser тоже работал?</p>
</blockquote>
</aside>
<p>А что с ним? Он и так работает.</p>
<aside class="quote no-group" data-username="dennis" data-post="736" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/d/e56c9b/48.png" class="avatar"> dennis:</div>
<blockquote>
<p>Подскажите, есть варианты реализации контейнера на Shadowsocks?</p>
</blockquote>
</aside>
<p>На «голом» прокси такое сделать не получится. В комбайнах вроде v2ray можно реализовать, но с оговорками.</p></td><td>2024-01-22T06:46:11.820Z</td></tr><tr><td>rubberducky</td><td><aside class="quote no-group" data-username="ValdikSS" data-post="737" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/valdikss/48/2_2.png" class="avatar"> ValdikSS:</div>
<blockquote>
<p>А что с ним? Он и так работает.</p>
</blockquote>
</aside>
<p>Tor не подключается, бесконечно стоит на bootstrapped 5%, для tor приходится использовать сторонние ВПН, а не “свою”</p></td><td>2024-01-22T10:48:00.465Z</td></tr><tr><td>Mr.Alex</td><td><p>Сделал как вы сказали, но так и не работает<br>
<div class="lightbox-wrapper"><a class="lightbox" href="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/790fc37c242e3d995782cb3216443998262c9a7d.png" data-download-href="https://ntc.party/uploads/default/790fc37c242e3d995782cb3216443998262c9a7d" title="image"><img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/790fc37c242e3d995782cb3216443998262c9a7d.png" alt="image" data-base62-sha1="hgXxVR9RXUUr24L1K6vPee1Gygl" width="690" height="385" data-dominant-color="171717"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">1110×620 24.5 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div><br>
<div class="lightbox-wrapper"><a class="lightbox" href="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/a004b15d61fe7dbca0a4e94eec4b80c5697de541.png" data-download-href="https://ntc.party/uploads/default/a004b15d61fe7dbca0a4e94eec4b80c5697de541" title="image"><img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/a004b15d61fe7dbca0a4e94eec4b80c5697de541.png" alt="image" data-base62-sha1="mPArSk8yDrLjMHe6DGTSSYKqvE5" width="690" height="387" data-dominant-color="111111"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">1109×623 25.3 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p></td><td>2024-01-26T11:06:52.421Z</td></tr><tr><td>kirill</td><td><p>как используя эту конструкцию заворачивать резолвинг всех доменов .ru, .рф, .su (вроде все?) на один днс,<br>
а всех остальных – на другой<br>
?</p>
<p>так<br>
добавить в конце<br>
/etc/knot-resolver/kresd.conf</p>
<pre><code class="lang-auto">-- *.ru, *.рф, *.su
policy.add(
    policy.suffix(
        policy.STUB(
            {'77.88.8.1', '77.88.8.8'}
        ),
        policy.todnames(
            {'ru.', 'рф.', 'su.'}
        )
    )
)

-- OpenDNS
policy.add(policy.all(policy.FORWARD({'208.67.222.222', '208.67.220.220'})))

</code></pre>
<p>?</p></td><td>2024-01-30T18:35:31.564Z</td></tr><tr><td>Alexled(alex)</td><td><p>Актуализирую вопрос, не получил ответа</p></td><td>2024-02-03T09:33:46.850Z</td></tr><tr><td>ValdikSS</td><td><aside class="quote no-group" data-username="kirill" data-post="744" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/k/a9a28c/48.png" class="avatar"> kirill:</div>
<blockquote>
<p>как используя эту конструкцию заворачивать резолвинг всех доменов .ru, .рф, .su (вроде все?) на один днс,</p>
</blockquote>
</aside>
<p>Похоже на правду.</p>
<aside class="quote no-group" data-username="Alexled" data-post="732" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/a/e95f7d/48.png" class="avatar"> Alexled:</div>
<blockquote>
<p>Появилась проблема с доступностью Антизапрета через мобильный МТС. У кого-нибудь есть решение этой проблемы?</p>
</blockquote>
</aside>
<aside class="quote quote-modified" data-post="5" data-topic="5230">
  <div class="title">
    <div class="quote-controls"></div>
    <img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/valdikss/48/2_2.png" class="avatar">
    <a href="https://ntc.party/t/%D0%BC%D0%B5%D1%85%D0%B0%D0%BD%D0%B8%D0%B7%D0%BC%D1%8B-%D0%BE%D0%B1%D1%85%D0%BE%D0%B4%D0%B0-%D0%B1%D0%BB%D0%BE%D0%BA%D0%B8%D1%80%D0%BE%D0%B2%D0%BA%D0%B8-vpn/5230/5">Механизмы обхода блокировки vpn</a> <a class="badge-category__wrapper " href="/c/internet-censorship-all-around-the-world/russia/12"><span data-category-id="12" style="--category-badge-color: #BF1E2E; --category-badge-text-color: #FFFFFF; --parent-category-badge-color: #0088CC;" data-parent-category-id="10" data-drop-close="true" class="badge-category --has-parent" title="Информация и обсуждение блокировок ресурсов в Российской Федерации"><span class="badge-category__name">Russia</span></span></a>
  </div>
  <blockquote>
    Самый простой вариант — арендовать сервер в РФ <a href="https://ntc.party/t/list-of-vps-dedicated-server-network-censorship-in-russia/4867/1">без ТСПУ</a> (и убедиться, что <a href="https://ntc.party/t/05-08-2023-08-08-2023/5124/32">AS тоже в РФ</a>), настроить на нём перенаправление портов на сервер за рубежом. 
Такой вариант вряд ли продолжит работать в следующем году, так как обещают установить ТСПУ на хостинг-площадках (<a href="https://ntc.party/t/topic/4899">1</a>, <a href="https://roskomsvoboda.org/post/zhiostkoye-regulirovanie-telekoma/">2</a>). 
Вариант чуть сложнее и чуть надёжнее, но всё ещё простой: так как на этот раз блокировали только VPN-подключения из РФ за рубеж, можно настроить подключение с сервера за рубежом на сервер в РФ. Гарантий, что такой способ не за…
  </blockquote>
</aside>
</td><td>2024-02-04T16:22:19.969Z</td></tr><tr><td>ValdikSS</td><td><p>Попробуйте прописать эту строку в самый (или почти самый) верх конфигурационного файла.<br>
И не забудьте очистить кеш:<br>
<code>echo "cache.clear()" | socat - /run/knot-resolver/control/1</code></p></td><td>2024-02-04T16:24:11.255Z</td></tr><tr><td>Mr.Alex</td><td><p>Так и не заработал<br>
<div class="lightbox-wrapper"><a class="lightbox" href="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/54f8cda5eee01c1ddbe65620dabcddc57790d701.png" data-download-href="https://ntc.party/uploads/default/54f8cda5eee01c1ddbe65620dabcddc57790d701" title="image"><img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/54f8cda5eee01c1ddbe65620dabcddc57790d701.png" alt="image" data-base62-sha1="c7HaiI3hi38udRIyAyCsjdPfWSJ" width="690" height="383" data-dominant-color="1A1A1A"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">1112×618 35.6 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div><br>
<div class="lightbox-wrapper"><a class="lightbox" href="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/1c46bb5002de58a452f69fc4ea4a2d9f472741a7.png" data-download-href="https://ntc.party/uploads/default/1c46bb5002de58a452f69fc4ea4a2d9f472741a7" title="image"><img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/1c46bb5002de58a452f69fc4ea4a2d9f472741a7.png" alt="image" data-base62-sha1="428Uul5SZDyzdGjg4DUgEOsCrNd" width="690" height="384" data-dominant-color="141414"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">1115×622 32.5 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p></td><td>2024-02-04T20:54:58.734Z</td></tr><tr><td>ValdikSS</td><td><p>Адрес <code>192.168.104.1</code> разве не назначен VPN-интерфейсу внутри контейнера? Вы в knot-resolver указываете апстримом сам же knot-resolver, создавая кольцо запросов.</p></td><td>2024-02-05T05:41:22.744Z</td></tr><tr><td>Mr.Alex</td><td><p>Просто понять не могу какой ip прописать в knot-resolver<br>
<div class="lightbox-wrapper"><a class="lightbox" href="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/dca76361a829f27efaddea3ed6b918ce0b80be01.png" data-download-href="https://ntc.party/uploads/default/dca76361a829f27efaddea3ed6b918ce0b80be01" title="image"><img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/dca76361a829f27efaddea3ed6b918ce0b80be01.png" alt="image" data-base62-sha1="vtZFBDI4zu1ALRdqlrhXHT5pXhf" width="690" height="363" data-dominant-color="292829"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">933×491 29.9 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div><br>
<div class="lightbox-wrapper"><a class="lightbox" href="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/650d6640d8d80c924478769c3738f320b594b9a9.jpeg" data-download-href="https://ntc.party/uploads/default/650d6640d8d80c924478769c3738f320b594b9a9" title="image"><img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/650d6640d8d80c924478769c3738f320b594b9a9_2_690x317.jpeg" alt="image" data-base62-sha1="epWVP7RHKWPA2JuPUhzj8aTYfaN" width="690" height="317" srcset="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/650d6640d8d80c924478769c3738f320b594b9a9_2_690x317.jpeg, контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/650d6640d8d80c924478769c3738f320b594b9a9.jpeg 1.5x, контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/650d6640d8d80c924478769c3738f320b594b9a9.jpeg 2x" data-dominant-color="272627"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">1021×470 64.9 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p></td><td>2024-02-06T00:53:51.948Z</td></tr><tr><td>xtrime</td><td><p>У меня тоже были рандомные проблемы с серверами apple. Очень нестабильно работали обновления, apple music.</p>
<p>Добавил в /root/antizapret/config/include-hosts-custom.txt <a href="http://apple.com" rel="noopener nofollow ugc">apple.com</a> и <a href="http://mzstatic.com" rel="noopener nofollow ugc">mzstatic.com</a></p></td><td>2024-02-09T17:27:25.685Z</td></tr><tr><td>ValdikSS</td><td><aside class="quote" data-post="11" data-topic="6119">
  <div class="title">
    <div class="quote-controls"></div>
    <img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/valdikss/48/2_2.png" class="avatar">
    <a href="https://ntc.party/t/%D0%BD%D0%B5-%D0%BE%D0%B1%D0%BD%D0%BE%D0%B2%D0%BB%D1%8F%D1%8E%D1%82%D1%81%D1%8F-%D0%BF%D1%80%D0%B8%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D1%8F-%D0%B2-app-store/6119/11">Не обновляются приложения в app store</a> <a class="badge-category__wrapper " href="/c/antizapret-prostovpn-org/5"><span data-category-id="5" style="--category-badge-color: #8C6238; --category-badge-text-color: #FFFFFF;" data-drop-close="true" class="badge-category " title="Proxy and VPN service for Russian censorship circumvention, discussion and official support forum. Обсуждение работы сервиса обхода блокировок России АнтиЗапрет. Новости, уведомления о проблемах и помощь в настройке."><span class="badge-category__name">antizapret.prostovpn.org</span></span></a>
  </div>
  <blockquote>
    193.57.46.176, в который резолвится <a href="http://osxapps.itunes.apple.com">osxapps.itunes.apple.com</a>, заблокирован на ТСПУ.
  </blockquote>
</aside>
</td><td>2024-02-09T17:34:31.453Z</td></tr><tr><td>ValdikSS</td><td><aside class="quote no-group" data-username="Mr.Alex" data-post="750" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/m/db5fbb/48.png" class="avatar"> Mr.Alex:</div>
<blockquote>
<p>Просто понять не могу какой ip прописать в knot-resolver</p>
</blockquote>
</aside>
<p>У вас запущен AdGuard в качестве DNS-сервера на этом же сервере? На хосте (не в контейнере)?<br>
Если он запущен в контейнере, который создаёт свой сетевой интерфейс, то укажите IP-адрес этого интерфейса (но он может меняться, см. настройки системы контейнеризации, в котором запускаете).<br>
Если вы запускаете на хосте, то попробуйте указать внешний IP-адрес сервера.</p></td><td>2024-02-09T17:36:53.387Z</td></tr><tr><td>xtrime</td><td><p>Спасибо за ссылку. А что в итоге надо сделать? Из коробки у меня не работало. Даже на свежем rootfs.tar.xz. Сейчас apple music работает, а вот приложения из app store не скачиваются.</p>
<p>UP: прописал 1.1.1.1 в proxy.py, перезапустил контейнер - вроде стало лучше.</p></td><td>2024-02-09T17:40:37.299Z</td></tr><tr><td>ValdikSS</td><td><p>Нужно добавить исключение, как описано, например, здесь:</p><aside class="quote" data-post="372" data-topic="129">
  <div class="title">
    <div class="quote-controls"></div>
    <img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/valdikss/48/2_2.png" class="avatar">
    <a href="https://ntc.party/t/%D0%BA%D0%BE%D0%BD%D1%82%D0%B5%D0%B9%D0%BD%D0%B5%D1%80-vpn-%D0%B0%D0%BD%D1%82%D0%B8%D0%B7%D0%B0%D0%BF%D1%80%D0%B5%D1%82%D0%B0-%D0%B4%D0%BB%D1%8F-%D1%83%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B8-%D0%BD%D0%B0-%D1%81%D0%BE%D0%B1%D1%81%D1%82%D0%B2%D0%B5%D0%BD%D0%BD%D1%8B%D0%B9-%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80/129/372">Контейнер VPN АнтиЗапрета для установки на собственный сервер</a> <a class="badge-category__wrapper " href="/c/antizapret-prostovpn-org/az-self-hosted/38"><span data-category-id="38" style="--category-badge-color: #0088CC; --category-badge-text-color: #FFFFFF; --parent-category-badge-color: #8C6238;" data-parent-category-id="5" data-drop-close="true" class="badge-category --has-parent" title="Вопросы и особенности работы контейнера VPN АнтиЗапрета на своих серверах"><span class="badge-category__name">АнтиЗапрет на собственном сервере (self-hosted)</span></span></a>
  </div>
  <blockquote>
    Вероятно, NS-серверы домена заблокировали сетевой доступ для IP-адреса вашего сервера. 
Можно настроить резолв конкретно этого домена через публичный DNS-резолвер. Добавьте в конец конфигурационного файла /etc/knot-resolver/kresd.conf: 
policy.add(
    policy.suffix(
        policy.FORWARD(
            {'77.88.8.8'}
        ),
        policy.todnames({'citilink.ru.'})
    )
)
  </blockquote>
</aside>

<p>proxy.py править не нужно!</p></td><td>2024-02-09T17:59:49.975Z</td></tr><tr><td>kirill</td><td><p>тоже не совсем понятно, что нужно сделать, чтобы пускать этот домен через проксю</p>
<p>тут<br>
<a href="https://ntc.party/t/%D0%BA%D0%BE%D0%BD%D1%82%D0%B5%D0%B9%D0%BD%D0%B5%D1%80-vpn-%D0%B0%D0%BD%D1%82%D0%B8%D0%B7%D0%B0%D0%BF%D1%80%D0%B5%D1%82%D0%B0-%D0%B4%D0%BB%D1%8F-%D1%83%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B8-%D0%BD%D0%B0-%D1%81%D0%BE%D0%B1%D1%81%D1%82%D0%B2%D0%B5%D0%BD%D0%BD%D1%8B%D0%B9-%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80/129/160">Контейнер VPN АнтиЗапрета для установки на собственный сервер - antizapret.prostovpn.org / АнтиЗапрет на собственном сервере (self-hosted) - NTC</a><br>
я так понимаю схема для домена третьего уровня, а<br>
<a href="http://osxapps.itunes.apple.com" class="onebox" target="_blank" rel="noopener nofollow ugc">osxapps.itunes.apple.com</a><br>
домен четвёртого</p>
<p>как было исправлено</p><aside class="quote" data-post="12" data-topic="6119">
  <div class="title">
    <div class="quote-controls"></div>
    <img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/valdikss/48/2_2.png" class="avatar">
    <a href="https://ntc.party/t/%D0%BD%D0%B5-%D0%BE%D0%B1%D0%BD%D0%BE%D0%B2%D0%BB%D1%8F%D1%8E%D1%82%D1%81%D1%8F-%D0%BF%D1%80%D0%B8%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D1%8F-%D0%B2-app-store/6119/12">Не обновляются приложения в app store</a> <a class="badge-category__wrapper " href="/c/antizapret-prostovpn-org/5"><span data-category-id="5" style="--category-badge-color: #8C6238; --category-badge-text-color: #FFFFFF;" data-drop-close="true" class="badge-category " title="Proxy and VPN service for Russian censorship circumvention, discussion and official support forum. Обсуждение работы сервиса обхода блокировок России АнтиЗапрет. Новости, уведомления о проблемах и помощь в настройке."><span class="badge-category__name">antizapret.prostovpn.org</span></span></a>
  </div>
  <blockquote>
    Исправлено.
  </blockquote>
</aside>
<p>
?</p></td><td>2024-02-09T23:28:15.263Z</td></tr><tr><td>ValdikSS</td><td><aside class="quote no-group" data-username="kirill" data-post="756" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/k/a9a28c/48.png" class="avatar"> kirill:</div>
<blockquote>
<p>тоже не совсем понятно, что нужно сделать, чтобы пускать этот домен через проксю</p>
</blockquote>
</aside>
<p>Если вам нужно решить проблему с <a href="http://apple.com">apple.com</a>, то его не нужно для этого добавлять в список проксирования.<br>
См. сообщение выше.</p></td><td>2024-02-10T07:50:29.812Z</td></tr><tr><td>maxpain(Maxim Makarov)</td><td><p>Проблема в том, что мы хостим DNS сервер в другой стране, что создает большое количество проблем с сайтами, которые используют DNS-based Geo-балансировку (а не anycast, что более логично), то есть такие домены резолвятся на ближайшие IP-адреса к вашему DNS-серверу за границей а не к вам, что может в целом замедлять работу даже незаблокированных сайтов.</p>
<p>Я в итоге пришел к такой конфигурации. В Москве (где я живу) я взял виртуалку и поднял там knot-resolver, который для незаблокированных сайтов форвардит DNS запросы на 1.1.1.1, а для заблокированных сайтов форвардит всё на мой собственный DNS сервер в Финляндию (самая ближайшая локация к Москве с пингом около 16мс), с него уже отдаются фейковые IP-адреса для заблокированных сайтов.</p>
<p>Иными словами нужно резолвить адреса там, где вы будете к ним обращаться.</p></td><td>2024-02-10T09:29:44.781Z</td></tr><tr><td>borouhin(Alexander Borouhin)</td><td><aside class="quote no-group" data-username="maxpain" data-post="758" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/maxpain/48/1828_2.png" class="avatar"> maxpain:</div>
<blockquote>
<p>поднял там knot-resolver, который для незаблокированных сайтов форвардит DNS запросы на 1.1.1.1, а для заблокированных сайтов форвардит всё на мой собственный DNS сервер</p>
</blockquote>
</aside>
<p>Сейчас в списке заблокированных <a href="https://reestr.rublacklist.net/api/v3/domains/" rel="noopener nofollow ugc">больше 400 000 доменов</a>, у Вас knot нормально справляется с маршрутизацией каждого DNS-запроса по такой немаленькой таблице?<br>
Сам эту задачку решаю, но пока что планировал в фоне логи запросов к своему DNS-серверу обрабатывать и корректировать маршруты, т.к. был уверен, что в real time не взлетит.</p></td><td>2024-02-10T09:43:53.078Z</td></tr><tr><td>maxpain(Maxim Makarov)</td><td><p>Работает хорошо, подгрузил через RPZ.<br>
Правда при запуске около 20 секунд лагает)</p>
<pre><code class="lang-auto">workers: auto
logging:
  level: info
network:
  listen:
    - interface: wg0@53

cache:
  prediction: true

lua:
  script: |
    policy.add(
      policy.rpz(
        policy.FLAGS({'NO_EDNS', 'NO_0X20'}),
        '/config/domains.rpz',
        true
      )
    )

    policy.add(
      policy.rpz(
        policy.STUB('fd86:ea04:1116::1'),
        '/config/domains.rpz',
        true
      )
    )

    policy.add(policy.all(policy.STUB('1.1.1.1')))
</code></pre></td><td>2024-02-10T09:49:30.166Z</td></tr><tr><td>maxpain(Maxim Makarov)</td><td><p>Я по итогу сделал свой antizapret на wireguard и NAT64 (Jool в kernel mode), а мой DNS64 сервер резолвит Embedded IPv4 in IPv6 адреса вместо фейковых IPv4, таким образом не нужно поддерживать маппинг fake ip → real ip в iptables, архитектура получилась stateless и очень прозрачной и эффективной.<br>
Можно даже маршрутизирующий knot-resolver разместить на своём домашнем роутере для отказоустойчивости и околонулевого latency.</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/155110be56bd4eb6522e1d361eb62734d27d9aa8.png" data-download-href="https://ntc.party/uploads/default/155110be56bd4eb6522e1d361eb62734d27d9aa8" title="image"><img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/155110be56bd4eb6522e1d361eb62734d27d9aa8.png" alt="image" data-base62-sha1="32zHWgLXmO7rM4NnMBmhQaB57BK" width="690" height="326" data-dominant-color="101010"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">1066×504 19.7 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>Единственный минус такой схемы, вам нужны IPv6 адреса на ваших устройствах в вашей сети. Но если публичных IPv6 адресов нет то можно заанонсить ULA IPv6-префикс через RA.</p></td><td>2024-02-10T09:56:17.773Z</td></tr><tr><td>borouhin(Alexander Borouhin)</td><td><p>Спасибо за подробные пояснения, но, честно говоря, не понял, зачем Вам вообще фейковые адреса и IPv6. Разве не достаточно просто использовать для каждого доменного имени ресолвер в той стране, через которую мы предполагаем маршрутизировать трафик к соотв. серверу?<br>
Или Вы таким образом решаете не только проблему, когда для разных геолокаций отдаются разные адреса, но и проблему, когда в рамках одной геолокации рандомно отдаются разные адреса из некоего пула?</p></td><td>2024-02-10T10:10:11.279Z</td></tr><tr><td>maxpain(Maxim Makarov)</td><td><aside class="quote no-group" data-username="borouhin" data-post="762" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/borouhin/48/3734_2.png" class="avatar"> borouhin:</div>
<blockquote>
<p>зачем Вам вообще фейковые адреса</p>
</blockquote>
</aside>
<p>Под фейковыми адресами я подразумевал то, что отдает antizapret dns (10.241.x.x).</p>
<aside class="quote no-group" data-username="borouhin" data-post="762" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/borouhin/48/3734_2.png" class="avatar"> borouhin:</div>
<blockquote>
<p>и IPv6</p>
</blockquote>
</aside>
<p>Долго задавался вопросом как переделать antizapret на wireguard и при этом решить проблему резолва адресов для НЕзаблокированных сайтов там, где я нахожусь, в итоге пришел к такому архитектурно простому решению дабы не заморачиваться со скриптами, которые поддерживают состояние iptables <img src="https://ntc.party/images/emoji/twitter/slight_smile.png?v=12" title=":slight_smile:" class="emoji" alt=":slight_smile:" loading="lazy" width="20" height="20"></p>
<blockquote>
<p>Разве не достаточно просто использовать для каждого доменного имени ресолвер в той стране, через которую мы предполагаем маршрутизировать трафик к соотв. серверу?</p>
</blockquote>
<p>Если я правильно понял вы предполагаете использовать, например, Yandex DNS в качестве резолвера, который будет использоваться в антизапрете, (если мы предполагаем что антизапрет находится в другой стране). То есть Antizapret будет обращаться к DNS серверу яндекса в Москве.<br>
В таком случае будет достаточно высокий latency на резолв для ЛЮБЫХ сайтов. Ваш компьютер в Москве будет обращаться к антизапрету в Финляндии (допустим), а он в свою очередь будет посылать запрос к DNS серверу яндекса в Москве, затем получать ответ и возвращать вам.<br>
Гораздо лучше будет если DNS запросы не будут улетать за пределы Москвы и будут оставаться в пределах пары миллисекунд.</p></td><td>2024-02-10T10:21:03.628Z</td></tr><tr><td>borouhin(Alexander Borouhin)</td><td><p>Сорри, я в эту тему подключился исключительно после Вашего комментария про распределение DNS-запросов, что для меня тоже актуально. Продукт от antizapret не использую и откуда и зачем в нём берутся фейковые адреса - не знаю <img src="https://ntc.party/images/emoji/twitter/frowning.png?v=12" title=":frowning:" class="emoji" alt=":frowning:" loading="lazy" width="20" height="20"> <em>(P.S. Почитал, понял, хитроумное решение, но очень уж нишевое <img src="https://ntc.party/images/emoji/twitter/slight_smile.png?v=12" title=":slight_smile:" class="emoji" alt=":slight_smile:" loading="lazy" width="20" height="20"> )</em></p>
<p>У меня своя VPN-сеть с точками в нескольких странах и маршрутизацией через эти точки по правилам, специфичным для каждой страны (скажем, из России заблокированные IP через Голландию, а из-за пределов России российские IP через Россию и т.п.) Списки префиксов для маршрутизации, в т.ч. путём ресолвинга доменных имён, формирует свой сервер и раздаёт всем остальным узлам сети по BGP в отдельных community. Все пользователи моей сети используют мои DNS-ресолверы (для уменьшения latency и отказоустойчивости у меня их 2 - в России и в Голландии).</p>
<p>И вот тут я сталкиваюсь с аналогичной проблемой - при построении списка маршрутов сервер может получить для доменного имени один IP, а пользователь при обращении по этому имени - другой, к которому правильный маршрут не построен. Я эту проблему планировал решать, написав работающий в фоне парсер логов DNS-ресолвера, который проверяет все запросы на соответствие доменам из списка и обновляет маршруты при появлении для этих доменов новых IP. В этом случае пользователь с первого раза всё равно получит проблему, но хотя бы при повторном обращении (обновлении страницы) через некоторое время нужный маршрут уже успеет появиться. Но вот если можно действительно расикдать и DNS-запросы, сохранив приемлемую производительность ресолвера, то часть проблем (вызванные несоответствием геолокации, а не балансировкой нагрузки) это сняло бы сразу.</p>
<p>По поводу latency DNS я вообще не переживаю. У меня сейчас вообще рекурсивные ресолверы, которые ходят по всей цепочке от корневых серверов, и никакой особой latency это не привносит, затраты времени же только на первый запрос, дальше всё в кэше. Медианное время выполнения рекурсивного запроса для российского ресолвера около 80 мс, для европейского - около 30 мс. Переход от собственных ресолверов к сторонним, где бы они ни находились, эти цифры только улучшит. И мой компьютер в Москве не ходит к иностранному серверу без нужды, как и иностранный к российскому.</p></td><td>2024-02-10T10:36:08.376Z</td></tr><tr><td>kirill</td><td><p>благодарю, прочитал внимательно, в чём дело</p><aside class="quote quote-modified" data-post="700" data-topic="129">
  <div class="title">
    <div class="quote-controls"></div>
    <img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/maxpain/48/1828_2.png" class="avatar">
    <a href="https://ntc.party/t/%D0%BA%D0%BE%D0%BD%D1%82%D0%B5%D0%B9%D0%BD%D0%B5%D1%80-vpn-%D0%B0%D0%BD%D1%82%D0%B8%D0%B7%D0%B0%D0%BF%D1%80%D0%B5%D1%82%D0%B0-%D0%B4%D0%BB%D1%8F-%D1%83%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B8-%D0%BD%D0%B0-%D1%81%D0%BE%D0%B1%D1%81%D1%82%D0%B2%D0%B5%D0%BD%D0%BD%D1%8B%D0%B9-%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80/129/700">Контейнер VPN АнтиЗапрета для установки на собственный сервер</a> <a class="badge-category__wrapper " href="/c/antizapret-prostovpn-org/az-self-hosted/38"><span data-category-id="38" style="--category-badge-color: #0088CC; --category-badge-text-color: #FFFFFF; --parent-category-badge-color: #8C6238;" data-parent-category-id="5" data-drop-close="true" class="badge-category --has-parent" title="Вопросы и особенности работы контейнера VPN АнтиЗапрета на своих серверах"><span class="badge-category__name">АнтиЗапрет на собственном сервере (self-hosted)</span></span></a>
  </div>
  <blockquote>
    Снова возникла проблема с сервисами Apple (App Store, Apple Music). 
Почему-то домены <a href="http://aod.itunes.apple.com" rel="noopener nofollow ugc">aod.itunes.apple.com</a>, <a href="http://mvod.itunes.apple.com" rel="noopener nofollow ugc">mvod.itunes.apple.com</a>, <a href="http://apptrailers.itunes.apple.com" rel="noopener nofollow ugc">apptrailers.itunes.apple.com</a>, <a href="http://apptrailers.itunes.g.aaplimg.com" rel="noopener nofollow ugc">apptrailers.itunes.g.aaplimg.com</a> и другие резолвятся на какой-то украинский IP-адрес, а не на IP-адрес Apple: 
 <a class="lightbox" href="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/619c6c4c7a9376c433e72e9ac378a19d3ac525e6.jpeg" data-download-href="https://ntc.party/uploads/default/619c6c4c7a9376c433e72e9ac378a19d3ac525e6" title="image">[image]</a> 
Перезагрузка antizapret контейнера не помогает. 
Кстати, этот IP-адрес 193.57.46.176, AS60159 (EUROLINE UKRAINE LLC) отдаётся DNS-сервером Hetzner в Финляндии и из России не пингуется. 
Другие же DNS-сервера отдают IP-…
  </blockquote>
</aside>

<p>действительно, для <a href="http://osxapps.itunes.apple.com/" rel="noopener nofollow ugc">osxapps.itunes.apple.com</a> это рабочее решение</p>
<p>ну раз уж задал вопрос про проксирование конкретных доменов четвёртого уровня (мало ли, пригодится), то метод для доменов третьего уровня<br>
<a href="https://ntc.party/t/%D0%BA%D0%BE%D0%BD%D1%82%D0%B5%D0%B9%D0%BD%D0%B5%D1%80-vpn-%D0%B0%D0%BD%D1%82%D0%B8%D0%B7%D0%B0%D0%BF%D1%80%D0%B5%D1%82%D0%B0-%D0%B4%D0%BB%D1%8F-%D1%83%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B8-%D0%BD%D0%B0-%D1%81%D0%BE%D0%B1%D1%81%D1%82%D0%B2%D0%B5%D0%BD%D0%BD%D1%8B%D0%B9-%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80/129/160">Контейнер VPN АнтиЗапрета для установки на собственный сервер - antizapret.prostovpn.org / АнтиЗапрет на собственном сервере (self-hosted) - NTC</a><br>
вероятно нерабочий</p>
<p>можно этот вопрос осветить?<br>
спасибо</p></td><td>2024-02-10T13:30:37.654Z</td></tr><tr><td>MadHypnofrog</td><td><p>День добрый! А никто не в курсе, у нас могут как-то трекать впны, расположенные в близлежащих странах (конкретно Финляндия), или это админы самого сайта делают такие интересные вещи? Имею впску в Финляндии, на которой крутится контейнер антизапрета, сегодня наткнулся на один сайт из реестра, который при попытке его открыть перекидывает на сайт <a href="http://fsb.ru" rel="noopener nofollow ugc">fsb.ru</a>, в нетворке пролетает NS_BINDING_ABORTED (Firefox); пытался включить “полный” впн (решение через добавление bypass-dhcp в конфиг) - не работает, включаю отдельный впн в браузере на условную Австрию (пробовал несколько разных стран) - работает, включаю на Финляндию - не работает, снова редирект. Или, может, где-то произошло какое-то условное кэширование и меня теперь по геоайпи как-то блочит? С контейнера сайт пингуется, доступ есть.</p></td><td>2024-02-11T14:41:03.254Z</td></tr><tr><td>Xunlei</td><td><p>Ответы HTTP 301, 302, 303, 307 выдаёт веб сервер, настроенный администратором сайта. Фильтрация доступа может осуществлятся например по данным GeoIP, размеру MTU, разнице времени браузера и локации IP.</p></td><td>2024-02-11T15:19:48.288Z</td></tr><tr><td>MadHypnofrog</td><td><p>Я, конечно, немного дилетант в плане сетей и прочего, но в какой момент в этой всей системе вылезает редирект на сайт фсб? Я даже раньше, кажется, такого не видел - обычно при попытке доступа либо заглушка с баннером была про то, что сайт заблокирован, либо относительно недавно начала вылетать PR_CONNECT_RESET_ERROR и никакого редиректа. В моем понимании если идет блок какого-либо вида со стороны сайта, то там будет опять же либо какая-то заглушка (как делают сейчас многие сайты, блокирующие доступ пользователям из РФ), либо редирект на условный гугл, но уж никак не на сайт российского фсб - тем более что без впна я на этот сайт даже не заходил. Пробовал включить Эстонию/Латвию/Литву/Норвегию (что близко географически) - с ними все замечательно открывается, ощущение что “виноват” был именно первый коннект через антизапрет, который по каким-то причинам был где-то задетекчен.</p></td><td>2024-02-11T15:59:06.326Z</td></tr><tr><td>Xunlei</td><td><p>В браузере открываете Web Developer Tools, владку Network и должны увидеть код HTTP редиректа на первом запросе страницы. “Виноват” скорее всего администратор веб сервера, который добавил IP в блок лист.</p></td><td>2024-02-11T16:49:38.746Z</td></tr><tr><td>borouhin(Alexander Borouhin)</td><td><p>Что-то я сомневаюсь, что там админ сервера <em>так</em> заморочился. Может, просто Ваш финский VPS по GeoIP бьётся как российский? Такое, вроде, встречалось в отношении площадок, которые наши хостеры арендуют (или в недавнем прошлом арендовали) за рубежом.</p></td><td>2024-02-11T16:51:15.225Z</td></tr><tr><td>Xunlei</td><td><p>Ну вот <a href="https://ntc.party/t/%D0%B7%D0%B0%D0%B1%D0%BB%D0%BE%D0%BA%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BB%D0%B8-mymusclevideocom/3836/8">пример</a> где содомитов мужеложцев перенаправляли.</p></td><td>2024-02-11T17:01:10.607Z</td></tr><tr><td>MadHypnofrog</td><td><p>Сайт, как оказалось, принадлежит той же компании, что и в этом треде. Проверил этот, симптомы абсолютно такие же - без впна нет коннекта, с финским впном/финской прокси из UrbanVPN (мой хостится на Aeza, прокся на Creanova) 302 + редирект на фсб, с финской проксей <a href="http://hide.me" rel="noopener nofollow ugc">hide.me</a> (Hetzner) или с другими странами все работает. Видимо, все-таки владельцы шаманят на своей стороне. Не до конца, правда, понятно, что это за магический геоблок такой, который отработал на два разных хостинга в пределах одной страны и не отработал на третий, ну да ладно.</p></td><td>2024-02-11T17:45:28.538Z</td></tr><tr><td>borouhin(Alexander Borouhin)</td><td><p>Вы проверьте свои IP, например, <a href="https://www.maxmind.com/en/geoip-web-services-demo" rel="noopener nofollow ugc">тут</a>, <a href="https://www.ip2location.com/demo" rel="noopener nofollow ugc">тут</a> и <a href="https://ipinfo.io/products/ip-geolocation-api" rel="noopener nofollow ugc">тут</a>, - может, магия и разоблачится…</p></td><td>2024-02-11T17:55:32.521Z</td></tr><tr><td>MadHypnofrog</td><td><p>На мою впску первые два указывают Финляндию, третий по каким-то причинам Швецию (хотя, кажется, когда у меня был рабочий Хецнер, с ним была похожая история - периодически выдавало Германию вместо Финляндии), на втором при этом есть упоминание <a href="http://runexis.ru" rel="noopener nofollow ugc">runexis.ru</a> в качестве домена - единственная зацепка? На урбанвпновской проксе три честных Финляндии.</p></td><td>2024-02-11T18:00:27.172Z</td></tr><tr><td>borouhin(Alexander Borouhin)</td><td><p>Не знаю. Вариантов много. Или они берут GeoIP из какого-то другого источника, на котором светится Россия (если там упомянут российский домен - возможно, раньше этот блок IP числился напрямую за российской компанией, а базы GeoIP могут быть древние необновлённые). Или какой-то российский пользователь/бот с VPN у этого же провайдера засветился индивидуально так, что заставил админов соотв. диапазон добавить вручную.</p>
<p>В любом случае, версия, что они как-то детектят именно Антизапрет и добавляют “засветившиеся” адреса в вечный бан, кажется самой маловероятной. Во-первых, не видно со стороны сервера никаких критериев, по которым можно так определять. Во-вторых, Антизапрет - точно не самый популярный способ обхода блокировок для россиян. В-третьих, ну это до какой степени надо упороться <img src="https://ntc.party/images/emoji/twitter/slight_smile.png?v=12" title=":slight_smile:" class="emoji" alt=":slight_smile:" loading="lazy" width="20" height="20"></p></td><td>2024-02-11T19:24:24.134Z</td></tr><tr><td>Mr.Alex</td><td><p>Большое спасибо)</p></td><td>2024-02-13T11:17:44.631Z</td></tr><tr><td>sevastianovv(Sevastianovv)</td><td><p>Доброго.<br>
ПОдскажите что за ошибки<br>
Job for kresd@1.service failed because a fatal signal was delivered to the control process.<br>
See “systemctl status kresd@1.service” and “journalctl -xe” for details.</p></td><td>2024-02-22T12:39:35.304Z</td></tr><tr><td>Anonimno(Anonimno)</td><td><p>Данные об ошибке по сервису увидите, набрав journalctl -xe в терминале</p></td><td>2024-02-22T13:29:08.491Z</td></tr><tr><td>ShiGhost(ShiGhost)</td><td><p>Здравствуйте <a class="mention" href="/u/valdikss">@ValdikSS</a>. А как на своём сервере можно сменить время обновления списков?</p></td><td>2024-02-23T12:53:26.698Z</td></tr><tr><td>ValdikSS</td><td><p><code>/etc/systemd/system/antizapret-update.timer</code></p></td><td>2024-02-23T13:15:25.467Z</td></tr><tr><td>ShiGhost(ShiGhost)</td><td><p>Спасибо.</p></td><td>2024-02-23T13:39:42.738Z</td></tr><tr><td>kirill</td><td><p><a href="https://ntc.party/t/%D0%BA%D0%BE%D0%BD%D1%82%D0%B5%D0%B9%D0%BD%D0%B5%D1%80-vpn-%D0%B0%D0%BD%D1%82%D0%B8%D0%B7%D0%B0%D0%BF%D1%80%D0%B5%D1%82%D0%B0-%D0%B4%D0%BB%D1%8F-%D1%83%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B8-%D0%BD%D0%B0-%D1%81%D0%BE%D0%B1%D1%81%D1%82%D0%B2%D0%B5%D0%BD%D0%BD%D1%8B%D0%B9-%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80/129/693">Контейнер VPN АнтиЗапрета для установки на собственный сервер - antizapret.prostovpn.org / АнтиЗапрет на собственном сервере (self-hosted) - NTC</a></p></td><td>2024-02-23T17:00:22.895Z</td></tr><tr><td>alexans(alexansemyachkin)</td><td><p>Здравствуйте, возникла проблема: резко перестал работать обход блокировок. Текущий конфиг: lxd контейнер на арендованном сервере в Германии, настроен OpenVPN на роутере Keenetic, причем сам роутер уверяет, что с соединением все в порядке и оно работает. С чем может быть связана проблема, кто сталкивался?</p></td><td>2024-02-23T21:14:05.560Z</td></tr><tr><td>dartraiden(Alexander Gavrilov)</td><td><p>С чем угодно, от изменившегося типа подключения к провайдеру (например, начиная с прошивки 3.8, нужно задействовать интернет-фильтры, иначе, при использовании PPPoE или добавлении на роутер ещё одного VPN-туннеля всё ломается) до внесения изменений в сетевые настройки на клиенте (в настройках сетевого адаптера указали кастомные DNS, включили DoH в браузере и так далее).</p></td><td>2024-02-26T00:17:26.914Z</td></tr><tr><td>antizapretlover</td><td><p>Долго мучался и перебирал различные варианты. Оказывается достаточно просто добавить строку<br>
<code>ua</code><br>
в include-hosts-customs.txt.<br>
Теперь все сайты вида *.ua открываются через антизапрет. Кстати так же сделал со всеми доменами стран ЕС. Может тоже пригодится:</p>
<pre><code class="lang-auto">at
be
bg
uk
hu
de
gr
dk
ie
es
it
cy
lv
lt
lu
mt
nl
pl
pt
ro
sk
si
fi
fr
hr
cz
se
ee
</code></pre></td><td>2024-03-04T22:34:58.069Z</td></tr><tr><td>mafiacheb(Александр)</td><td><p>Del</p></td><td>2024-03-05T07:06:01.849Z</td></tr><tr><td>Kebu</td><td><p>Заметил странное — часть доменов, добавленных в include-hosts-custom.txt не заворачиваются через контейнер, например:</p>
<pre><code class="lang-auto">--@Mini ~ % nslookup abobe.com       
Server:		192.168.104.1
Address:	192.168.104.1#53

Non-authoritative answer:
Name:	abobe.com
Address: 3.33.243.145
Name:	abobe.com
Address: 15.197.204.56
</code></pre>
<p>Твики, связанные с добавлением символом кириллицы давно применил, никаких ошибок в процессе не показывало. С чем мб связано, кто сталкивался?</p></td><td>2024-03-05T07:46:23.300Z</td></tr><tr><td>ShiGhost(ShiGhost)</td><td><p>Здравствуйте <a class="mention" href="/u/valdikss">@ValdikSS</a>. Как можно это сделать на своём сервере? И можно ли всю AS16625 или 104.109.143.0/24 пропустить через VPN?</p></td><td>2024-03-05T06:03:29.819Z</td></tr><tr><td>ValdikSS</td><td><p>В листе, который в result, домен имеется? Если да, то нужно сбросить кеш knot-resolver. Если нет, то нужно отлаживать.</p></td><td>2024-03-06T10:08:14.689Z</td></tr><tr><td>ValdikSS</td><td><aside class="quote" data-post="81" data-topic="129">
  <div class="title">
    <div class="quote-controls"></div>
    <img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/valdikss/48/2_2.png" class="avatar">
    <a href="https://ntc.party/t/%D0%BA%D0%BE%D0%BD%D1%82%D0%B5%D0%B9%D0%BD%D0%B5%D1%80-vpn-%D0%B0%D0%BD%D1%82%D0%B8%D0%B7%D0%B0%D0%BF%D1%80%D0%B5%D1%82%D0%B0-%D0%B4%D0%BB%D1%8F-%D1%83%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B8-%D0%BD%D0%B0-%D1%81%D0%BE%D0%B1%D1%81%D1%82%D0%B2%D0%B5%D0%BD%D0%BD%D1%8B%D0%B9-%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80/129/81">Контейнер VPN АнтиЗапрета для установки на собственный сервер</a> <a class="badge-category__wrapper " href="/c/antizapret-prostovpn-org/az-self-hosted/38"><span data-category-id="38" style="--category-badge-color: #0088CC; --category-badge-text-color: #FFFFFF; --parent-category-badge-color: #8C6238;" data-parent-category-id="5" data-drop-close="true" class="badge-category --has-parent" title="Вопросы и особенности работы контейнера VPN АнтиЗапрета на своих серверах"><span class="badge-category__name">АнтиЗапрет на собственном сервере (self-hosted)</span></span></a>
  </div>
  <blockquote>
    Я вас дезинформировал. 
Измените /root/antizapret/doall.sh, добавив после ./update.sh ваш IP-адрес, обязательно с CIDR. Вот так: 
./update.sh
echo '10.0.0.218/32' &gt;&gt; temp/list.csv
./parse.sh
./process.sh

Затем запустите doall.sh, с правильной локалью: 
LANG=C.UTF-8 /root/antizapret/doall.sh 
Больше ничего делать не нужно. Изменять конфигурационный файл openvpn тоже не нужно.
  </blockquote>
</aside>
</td><td>2024-03-06T10:12:50.487Z</td></tr><tr><td>ShiGhost(ShiGhost)</td><td><p>Спасибо <a class="mention" href="/u/valdikss">@ValdikSS</a>. А как вы сделали так?</p>
<blockquote>
<p>Добавил перенаправление с отдельных проблемных IP-адресов (<code>104.109.143.31</code>, <code>104.109.143.4</code>, <code>104.109.143.28</code>) на почти что случайные другие</p>
</blockquote>
<p>Я как понял, вы из dns ответа исключили эти ip адреса и сделали так, чтобы выдавались другие?</p></td><td>2024-03-06T15:03:02.443Z</td></tr><tr><td>ShiGhost(ShiGhost)</td><td><p><a class="mention" href="/u/valdikss">@ValdikSS</a> попробовал сделать как вы написали, но не сработало. В файле iplist_special_range.txt присутствует подсеть <code>104.109.143.0/24</code>. При nslookup к домену выдаёт <code>104.109.143.77</code>. В контейнере изменён только DNS адрес, но я не думаю, что из - за этого могут быть проблемы.</p></td><td>2024-03-06T15:48:16.674Z</td></tr><tr><td>ValdikSS</td><td><p>Так и должно быть. Переподключитесь к VPN, вам придёт маршрут для этой сети.</p></td><td>2024-03-06T15:55:53.907Z</td></tr><tr><td>ShiGhost(ShiGhost)</td><td><p>Спасибо. Заработало, но странно, обычно домены выдавали ip адреса из под сети 10.224.0.0/24, а в этот раз без подмены ip адреса. А как <a href="https://ntc.party/t/%D0%BD%D0%B5-%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D0%B0%D0%B5%D1%82-%D1%81%D0%B0%D0%B9%D1%82-valorant-%D0%B8-steam/6042/35">вы исключили</a> из ответа dns заблокированную подсеть?</p></td><td>2024-03-06T16:14:55.168Z</td></tr><tr><td>ValdikSS</td><td><aside class="quote" data-post="40" data-topic="2245">
  <div class="title">
    <div class="quote-controls"></div>
    <img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/valdikss/48/2_2.png" class="avatar">
    <a href="https://ntc.party/t/%D0%BD%D0%B5-%D0%BE%D1%82%D0%BA%D1%80%D1%8B%D0%B2%D0%B0%D1%8E%D1%82%D1%81%D1%8F-%D0%BD%D0%B5%D0%BA%D0%BE%D1%82%D0%BE%D1%80%D1%8B%D0%B5-%D1%81%D0%B0%D0%B9%D1%82%D1%8B-%D0%B7%D0%B0-cloudflare-cdn/2245/40">Не открываются некоторые сайты за Cloudflare CDN</a> <a class="badge-category__wrapper " href="/c/internet-censorship-all-around-the-world/russia/12"><span data-category-id="12" style="--category-badge-color: #BF1E2E; --category-badge-text-color: #FFFFFF; --parent-category-badge-color: #0088CC;" data-parent-category-id="10" data-drop-close="true" class="badge-category --has-parent" title="Информация и обсуждение блокировок ресурсов в Российской Федерации"><span class="badge-category__name">Russia</span></span></a>
  </div>
  <blockquote>
    Конкретно на АнтиЗапрете реализовано с помощью модуля <a href="https://knot-resolver.readthedocs.io/en/stable/modules-policy.html?highlight=rewrite#policy.REROUTE">reroute</a> knot-resolver так: 
-- Reroute Cloudflare
policy.add(policy.all(policy.REROUTE({
     ['188.114.96.0/24'] = '104.16.132.0',
     ['188.114.97.0/24'] = '104.16.133.0'
})), true)
  </blockquote>
</aside>
</td><td>2024-03-06T17:50:27.510Z</td></tr><tr><td>ShiGhost(ShiGhost)</td><td><p>Спасибо.</p></td><td>2024-03-07T03:42:48.152Z</td></tr><tr><td>bync(Ole)</td><td><p>Добрый день! Развернул контейнер на забугорном vps по инструкции, создал подключение на роутере аналогично обычному антизапрету, все подключается, dnsleaktest показывает ip моего vps, но заблокированные сайты не открываются. Также заметил что в папке root нет ничего касающегося антизапрета кроме текстового файла antizapret-client-tcp.ovpn. Подскажите пожалуйста куда копать?</p></td><td>2024-03-11T15:54:18.043Z</td></tr><tr><td>ilshat94(Ilshat94)</td><td><p>Доброго времени суток! Возможно задавался данный вопрос, но к сожалению не нашел по поиску. Дело вот в чем: Развернул антизапрет на своем сервере. Внес необходимые правки и применил патч. Все работает на всех устройствах. До этого не обращал внимания но в логе присутствует данная строка:</p>
<blockquote>
<p>21:05 DEPRECATED OPTION: --cipher set to ‘AES-128-CBC’ but missing in --data-ciphers (AES-256-GCM:AES-128-GCM:CHACHA20-POLY1305). OpenVPN ignores --cipher for cipher negotiations.</p>
</blockquote>
<p>Все работает как надо. Проблем нет. Но данное уведомление меня все таки заинтересовало. В итоге заменил метод шифрования предложенный в уведомлении(AES-128-GCM). Все так же работает нормально, но уведомление пропало.<br>
Правильно ли я понимаю что шифрование не работало? Или это не столь важно?</p></td><td>2024-03-11T16:17:40.922Z</td></tr><tr><td>bync(Ole)</td><td><p>Подскажи пожалуйста о каких правках и патче речь?</p></td><td>2024-03-12T07:58:24.378Z</td></tr><tr><td>bync(Ole)</td><td><aside class="quote no-group" data-username="ValdikSS" data-post="737" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/valdikss/48/2_2.png" class="avatar"> ValdikSS:</div>
<blockquote>
<p>Для работы контейнера нужно применять охапку патчей, если вы его только установили.</p>
</blockquote>
</aside>
<p>Подскажите, пожалуйста, какие патчи нужно применять?</p></td><td>2024-03-12T09:07:56.117Z</td></tr><tr><td>ilshat94(Ilshat94)</td><td><p>Для запуска помогло:</p>
<ol>
<li><a href="https://ntc.party/t/%D0%BA%D0%BE%D0%BD%D1%82%D0%B5%D0%B9%D0%BD%D0%B5%D1%80-vpn-%D0%B0%D0%BD%D1%82%D0%B8%D0%B7%D0%B0%D0%BF%D1%80%D0%B5%D1%82%D0%B0-%D0%B4%D0%BB%D1%8F-%D1%83%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B8-%D0%BD%D0%B0-%D1%81%D0%BE%D0%B1%D1%81%D1%82%D0%B2%D0%B5%D0%BD%D0%BD%D1%8B%D0%B9-%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80/129/560">Это</a>.</li>
</ol>
<p>Для работы на устройствах IOS:</p>
<ol>
<li><a href="https://ntc.party/t/%D0%BA%D0%BE%D0%BD%D1%82%D0%B5%D0%B9%D0%BD%D0%B5%D1%80-vpn-%D0%B0%D0%BD%D1%82%D0%B8%D0%B7%D0%B0%D0%BF%D1%80%D0%B5%D1%82%D0%B0-%D0%B4%D0%BB%D1%8F-%D1%83%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B8-%D0%BD%D0%B0-%D1%81%D0%BE%D0%B1%D1%81%D1%82%D0%B2%D0%B5%D0%BD%D0%BD%D1%8B%D0%B9-%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80/129/535">Это</a>.</li>
</ol>
<p>Ну для редактирования всего этого ещё пару манипуляций провести надо. Там все описано если читать далее по комментариям.</p></td><td>2024-03-12T09:34:31.912Z</td></tr><tr><td>bync(Ole)</td><td><p>Применить патч</p>
<pre><code class="lang-auto">wget https://raw.githubusercontent.com/nzkhammatov/antizapret_ios_patch/main/p.patch -O /root/dnsmap/p.patch
cd /root/dnsmap
patch -i p.patch
</code></pre>
<p>Сделал это, не помогло</p></td><td>2024-03-12T10:19:11.309Z</td></tr><tr><td>bync(Ole)</td><td><p>Разобрался, патч применять не потребовалось, переустановил контейнер и отредактировал parse.sh</p><aside class="quote quote-modified" data-post="560" data-topic="129">
  <div class="title">
    <div class="quote-controls"></div>
    <img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/valdikss/48/2_2.png" class="avatar">
    <a href="https://ntc.party/t/%D0%BA%D0%BE%D0%BD%D1%82%D0%B5%D0%B9%D0%BD%D0%B5%D1%80-vpn-%D0%B0%D0%BD%D1%82%D0%B8%D0%B7%D0%B0%D0%BF%D1%80%D0%B5%D1%82%D0%B0-%D0%B4%D0%BB%D1%8F-%D1%83%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B8-%D0%BD%D0%B0-%D1%81%D0%BE%D0%B1%D1%81%D1%82%D0%B2%D0%B5%D0%BD%D0%BD%D1%8B%D0%B9-%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80/129/560">Контейнер VPN АнтиЗапрета для установки на собственный сервер</a> <a class="badge-category__wrapper " href="/c/antizapret-prostovpn-org/az-self-hosted/38"><span data-category-id="38" style="--category-badge-color: #0088CC; --category-badge-text-color: #FFFFFF; --parent-category-badge-color: #8C6238;" data-parent-category-id="5" data-drop-close="true" class="badge-category --has-parent" title="Вопросы и особенности работы контейнера VPN АнтиЗапрета на своих серверах"><span class="badge-category__name">АнтиЗапрет на собственном сервере (self-hosted)</span></span></a>
  </div>
  <blockquote>
    В Реестр попали домены с кириллическими именами в названии, которые не соответствуют правилам наименования. Вероятно, кто-то распознал домен с бумаги и скопировал распознанные символы, либо еще что-то. 


В качестве временной меры вот эту строку: 
<a href="https://bitbucket.org/anticensority/antizapret-pac-generator-light/src/c73e0d901feb5b862a14f6e0f13670e590fb49ea/parse.sh#lines-9:10" class="onebox" target="_blank" rel="noopener nofollow ugc">https://bitbucket.org/anticensority/antizapret-pac-generator-light/src/c73e0d901feb5b862a14f6e0f13670e590fb49ea/parse.sh#lines-9:10</a> 
Замените на 
awk -F ';' '{print $2}' temp/list.csv | sort -u | awk '/^$/ {next} /\\/ {next} /^[а-яА-Яa-zA-Z0-9\-\_\.\*]…
  </blockquote>
</aside>
<p>
после этого все заработало.</p></td><td>2024-03-12T10:21:49.038Z</td></tr><tr><td>ilshat94(Ilshat94)</td><td><p>Патч, если я правильно помню, для возможности запуска на iOS устройствах. Так на этих устройствах не работало у меня. Но после тоже в самом приложении одну галочку убрать надо.</p></td><td>2024-03-13T10:49:07.316Z</td></tr><tr><td>bync(Ole)</td><td><p>Доброго дня! Может кто-нибудь скинуть оригинальные файлы:<br>
<code>/root/antizapret/config/include-hosts-custom.txt</code><br>
<code>/root/antizapret/config/exclude-hosts-dist.txt</code><br>
<code>/root/antizapret/config/exclude-regexp-dist.awk</code><br>
А то я там намудрил, а бекапов не делал…</p></td><td>2024-03-14T11:42:47.076Z</td></tr><tr><td>bync(Ole)</td><td><p>Подскажите пожалуйста, почему может не работать следующее:</p>
<ul>
<li>антизапрет у меня на vps</li>
<li>в include-hosts-custom.txt добавил ntc.party</li>
<li>сделал doall.sh и очистку кеша, перезапустил контейнер, но на форум не пускает.<br>
Может нужно что-то другое еще сделать?</li>
</ul></td><td>2024-03-19T09:12:19.153Z</td></tr><tr><td>Anonimno(Anonimno)</td><td><aside class="quote no-group" data-username="ValdikSS" data-post="560" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/valdikss/48/2_2.png" class="avatar"> ValdikSS:</div>
<blockquote>
<p>Замените на<br>
<code>awk -F ';' '{print $2}' temp/list.csv | sort -u | awk '/^$/ {next} /\\/ {next} /^[а-яА-Яa-zA-Z0-9\-\_\.\*]*+$/ {gsub(/\*\./, ""); gsub(/\.$/, ""); print}' | grep -Fv 'bеllonа' | CHARSET=UTF-8 idn &gt; result/hostlist_original.txt</code></p>
</blockquote>
</aside>
<p>На эту строчку предупреждение выводит скрипт:</p>
<pre><code class="lang-auto">awk: командная строка:1: предупреждение: regexp escape sequence `\_' is not a known regexp operator
</code></pre>
<p>Так и должно быть?</p></td><td>2024-03-19T21:46:20.008Z</td></tr><tr><td>Mr.Alex</td><td><p>Здравстуйте! Какая конфигурация лучше для роутера? TCP или UDP?</p></td><td>2024-03-21T18:56:46.414Z</td></tr><tr><td>ValdikSS</td><td><aside class="quote no-group" data-username="Mr.Alex" data-post="813" data-topic="129" data-full="true">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/m/db5fbb/48.png" class="avatar"> Mr.Alex:</div>
<blockquote>
<p>Здравстуйте! Какая конфигурация лучше для роутера? TCP или UDP?</p>
</blockquote>
</aside>
<p>Любая.</p>
<aside class="quote no-group" data-username="Anonimno" data-post="812" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/a/a88e57/48.png" class="avatar"> Anonimno:</div>
<blockquote>
<p>Так и должно быть?</p>
</blockquote>
</aside>
<p>Да.</p>
<aside class="quote no-group" data-username="bync" data-post="811" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/b/e56c9b/48.png" class="avatar"> bync:</div>
<blockquote>
<p>почему может не работать следующее</p>
</blockquote>
</aside>
<p>Отлаживайте. Смотрите, какие домены попали в результирующий файл, какие отсеялись. Проверяйте директории temp и result.</p>
<aside class="quote no-group" data-username="bync" data-post="810" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/b/e56c9b/48.png" class="avatar"> bync:</div>
<blockquote>
<p>Может кто-нибудь скинуть оригинальные файлы</p>
</blockquote>
</aside>
<p>Оригинальные файлы есть в репозитории. Так как git-репозиторий есть в самой директории, можно выполнить <code>git checkout</code> с нужными путями файлов. Либо скачать их из интернета заново.</p>
<aside class="quote no-group" data-username="ilshat94" data-post="803" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/ilshat94/48/2382_2.png" class="avatar"> ilshat94:</div>
<blockquote>
<p>Все работает как надо. Проблем нет. Но данное уведомление меня все таки заинтересовало.</p>
</blockquote>
</aside>
<p>Это, если правильно помню, было сделано для совместимости со старыми клиентами OpenVPN (2.4), которые не поддерживают data-ciphers.</p></td><td>2024-03-25T08:39:10.618Z</td></tr><tr><td>bync(Ole)</td><td><aside class="quote no-group" data-username="ValdikSS" data-post="814" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/valdikss/48/2_2.png" class="avatar"> ValdikSS:</div>
<blockquote>
<p>Оригинальные файлы есть в репозитории. Так как git-репозиторий есть в самой директории, можно выполнить <code>git checkout</code> с нужными путями файлов. Либо скачать их из интернета заново.</p>
</blockquote>
</aside>
<p>Сорри, я ламер, можно поподробнее порядок действий? Заранее благодарен.<br>
З.Ы. А почему сайт стал открываться без впн?</p></td><td>2024-03-25T08:46:25.219Z</td></tr><tr><td>nzkhammatov(Ainur Khammatov)</td><td><aside class="quote no-group" data-username="bync" data-post="810" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/b/e56c9b/48.png" class="avatar"> bync:</div>
<blockquote>
<p>оригинальные файлы:<br>
<code>/root/antizapret/config/include-hosts-custom.txt</code><br>
<code>/root/antizapret/config/exclude-hosts-dist.txt</code><br>
<code>/root/antizapret/config/exclude-regexp-dist.awk</code></p>
</blockquote>
</aside>
<pre><code class="lang-auto">https://bitbucket.org/anticensority/antizapret-pac-generator-light/src/master/config/
</code></pre></td><td>2024-03-27T01:40:59.751Z</td></tr><tr><td>bync(Ole)</td><td><p>Большое спасибо!</p></td><td>2024-03-27T07:11:05.865Z</td></tr><tr><td>HoroshoVse(Horosho Vse)</td><td><p>установил все по инструкции, патчи и изменения применил, но при открытии заблокированных сайтов в барузере DNS_PROBE_FINISHED_NXDOMAIN</p></td><td>2024-04-04T13:40:08.283Z</td></tr><tr><td>Mr.Alex</td><td><p>Могут ли через UDP быть потери в онлайн играх? Потеря пакетов и телепорт персонажей. Почему то когда использую UDP как раз это все и происходит в игре PUBG MOBILE. Возможно мне просто так везет на нестабильные сервера</p></td><td>2024-04-07T15:28:52.409Z</td></tr><tr><td>Xunlei</td><td><p>Сравни PCAP дампы с антизапретом и без (выполняя перед этим ipconfig /flushdns). Возможно это происходит из-за сломанного GeoDNS — в ответе на разрешение имени приходит ближайший IP к VPS, а не к вам, тогда необходимо посмотреть какие домены игра запрашивает и добавить для них отдельные forward правила для восстановления работоспособности.</p></td><td>2024-04-07T16:17:16.852Z</td></tr><tr><td>Mr.Alex</td><td><p>Вы сказали возможно это происходит из-за сломанного GeoDNS. У меня стоят на роутере адреса 1.1.1.1 и 8.8.8.8 и на сайте DNS leak test с отключеным АнтиЗапретом DNS подключается к этим локациям. Смена на Яндекс допустим может решить проблему?<br>
<div class="lightbox-wrapper"><a class="lightbox" href="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/af850e30c86773c0842df04b982d5d6f4aef4b03.png" data-download-href="https://ntc.party/uploads/default/af850e30c86773c0842df04b982d5d6f4aef4b03" title="image"><img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/af850e30c86773c0842df04b982d5d6f4aef4b03.png" alt="image" data-base62-sha1="p2ICTfAg0SPBFr1ZcjOHRnjNPUv" width="690" height="223" data-dominant-color="EFEEEE"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">993×322 9.94 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p></td><td>2024-04-07T16:32:47.468Z</td></tr><tr><td>Xunlei</td><td><p>Нет. Во-первых необходимо убедится что проблема в этом (для этого сравнить нужно дампы). Во вторых, правила нужно добавить в локальный DNS сервер вашей LAN именно для имён используемых в игре, и форвардить их на DNS IPS либо на второй инстанс DNS сервера работающий в режиме recursive resolution, чтобы NS сервер игры выдавал ближайшие игровые сервера к вашей ASN.</p></td><td>2024-04-07T17:12:27.284Z</td></tr><tr><td>ValdikSS</td><td><p>У вас маршрутизируется трафик игры через контейнер? Речь о каком IP-адресе, каком домене?</p></td><td>2024-04-09T10:02:11.984Z</td></tr><tr><td>Mr.Alex</td><td><p>Да, у меня происходит маршрут через АнтиЗапрет. Изучаю WireShark чтобы предоставить более подробную информацию</p></td><td>2024-04-10T12:20:07.733Z</td></tr><tr><td>zzr</td><td><p>спасибо за информацию!</p></td><td>2024-04-11T06:21:16.268Z</td></tr><tr><td>nzkhammatov(Ainur Khammatov)</td><td><aside class="quote no-group" data-username="antizapretlover" data-post="788" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/antizapretlover/48/4543_2.png" class="avatar"> antizapretlover:</div>
<blockquote>
<p>Теперь все сайты вида *.ua открываются через антизапрет. Кстати так же сделал со всеми доменами стран ЕС.</p>
</blockquote>
</aside>
<p><a class="mention" href="/u/zzr">@zzr</a></p>
<h2><a name="h-1" class="anchor" href="#h-1"></a></h2>
<p><strong>Дополнение для интересантов</strong></p>
<h2><a name="h-2" class="anchor" href="#h-2"></a></h2>
<details>
<summary>
List Info</summary>
<h2><a name="european-union-member-countries-3" class="anchor" href="#european-union-member-countries-3"></a>European Union member countries</h2>
<p><code>https://european-union.europa.eu/principles-countries-history/country-profiles_en</code></p>
<h2><a name="h-4" class="anchor" href="#h-4"></a></h2>
<h2><a name="nato-member-countries-5" class="anchor" href="#nato-member-countries-5"></a>NATO member countries</h2>
<p><code>https://www.nato.int/cps/en/natohq/topics_52044.htm</code></p>
<h2><a name="h-6" class="anchor" href="#h-6"></a></h2>
<h2><a name="ukraine-7" class="anchor" href="#ukraine-7"></a>Ukraine</h2>
<p><code>https://ukraine.ua</code></p>
<h2><a name="h-8" class="anchor" href="#h-8"></a></h2>
<h3><a name="internet-country-domains-list-tlds-9" class="anchor" href="#internet-country-domains-list-tlds-9"></a>Internet country domains list (TLDs)</h3>
<p><code>https://www.worldstandards.eu/other/tlds/</code></p>
</details>
<h2><a name="h-10" class="anchor" href="#h-10"></a></h2>
<details>
<summary>
Insert List</summary>
<pre><code class="lang-auto">al
be
bg
ca
hr
cz
dk
ee
fi
fr
de
gr
hu
is
it
lv
lt
lu
me
nl
mk
no
pl
pt
ro
sk
si
es
se
tr
uk
us
at
cy
ie
mt
ua
</code></pre>
</details></td><td>2024-04-16T05:24:13.950Z</td></tr><tr><td>Kebu</td><td><p>Первый раз с таким столкнулся, куда смотреть?</p>
<pre><code class="lang-auto">root@v684041628:~# lxc shell antizapret-vpn
Error: LXD unix socket "/var/snap/lxd/common/lxd-user/unix.socket" not accessible: Get "http://unix.socket/1.0": dial unix /var/snap/lxd/common/lxd-user/unix.socket: connect: connection refused
</code></pre>
<p>При этом впн работает</p></td><td>2024-04-16T10:43:34.409Z</td></tr><tr><td>nzkhammatov(Ainur Khammatov)</td><td><h2><a name="h-1" class="anchor" href="#h-1"></a></h2>
<p><strong>Попробуйте так</strong></p>
<h2><a name="h-2" class="anchor" href="#h-2"></a></h2>
<pre><code class="lang-auto">lxc stop antizapret-vpn
lxc list
lxc delete antizapret-vpn
lxc image list
lxc image delete antizapret-vpn-img
lxc network list
lxc network detach-profile lxdbr0 default
lxc network delete lxdbr0
echo '{"config": {}}' | lxc profile edit default
lxc storage delete default
</code></pre>
<h2><a name="h-3" class="anchor" href="#h-3"></a></h2>
<pre><code class="lang-auto">apt remove --purge lxd* -y
snap remove --purge lxd
apt autoremove -y
</code></pre>
<h2><a name="h-4" class="anchor" href="#h-4"></a></h2>
<pre><code class="lang-auto">snap install core; snap refresh core
snap install --classic lxd
snap refresh lxd --channel=5.20/stable
snap refresh --hold lxd
</code></pre>
<h2><a name="h-5" class="anchor" href="#h-5"></a></h2>
<p><code>shutdown -r 0</code></p>
<h2><a name="h-6" class="anchor" href="#h-6"></a></h2>
<p><code>lxd --version</code></p>
<h2><a name="h-7" class="anchor" href="#h-7"></a></h2>
<blockquote>
<p>5.20</p>
</blockquote>
<h2><a name="h-8" class="anchor" href="#h-8"></a></h2>
<p><code>lxd init</code></p>
<h2><a name="h-9" class="anchor" href="#h-9"></a></h2></td><td>2024-04-16T11:07:13.638Z</td></tr><tr><td>Kebu</td><td><p>Это получается все с нуля настроить? А почему поломалось, с чем мб связано?</p></td><td>2024-04-16T11:14:47.684Z</td></tr><tr><td>nzkhammatov(Ainur Khammatov)</td><td><h2><a name="h-1" class="anchor" href="#h-1"></a></h2>
<p><strong>Патчи для контейнера</strong></p>
<h2><a name="h-2" class="anchor" href="#h-2"></a></h2>
<p><code>https://ntc.party/t/129/537</code></p>
<h2><a name="h-3" class="anchor" href="#h-3"></a></h2></td><td>2024-04-16T11:25:06.120Z</td></tr><tr><td>Kebu</td><td><p>Благодарю!</p></td><td>2024-04-16T13:23:05.401Z</td></tr><tr><td>bync(Ole)</td><td><p>Я так понимаю не только у меня сегодня антизапрет сломался? А что случилось то?</p></td><td>2024-04-16T13:52:30.890Z</td></tr><tr><td>Mr.Alex</td><td><p>Есть ли смысл в обновлении lxd контернера с выходом новой версии?</p></td><td>2024-04-16T14:55:30.862Z</td></tr><tr><td>tunivi</td><td><p>Как я понял, дело было в очередном обновлении ядра Linux на VPS. У меня Ubuntu 20.04 LTS. LXD пытается запуститься, но в итоге бесконечно сыплет ошибками типа <em>couldn’t find the CGroup blkio.weight</em> в логах. Долго копался, но разобраться с проблемой так и не удалось. Пока откатился на бэкап и отключил автообновление в Ubuntu. Кстати, обновление релиза на 22.04 решает вопрос работоспособности LXD, но внутри контейнера пропадает интернет, так как не назначается IPv4-адрес. Здесь разобраться тоже не получилось: <em>lxd init</em> с перенастройкой bridge не помог.</p></td><td>2024-04-17T20:03:45.357Z</td></tr><tr><td>nzkhammatov(Ainur Khammatov)</td><td><aside class="quote no-group" data-username="tunivi" data-post="837" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/tunivi/48/4829_2.png" class="avatar"> tunivi:</div>
<blockquote>
<p>обновление релиза на 22.04 решает вопрос работоспособности LXD, но внутри контейнера пропадает интернет, так как не назначается IPv4-адрес. Здесь разобраться тоже не получилось: <em>lxd init</em> с перенастройкой bridge не помог.</p>
</blockquote>
</aside>
<p><strong>А так ?</strong><br>
<code>lxc network create lxdbr0 ipv4.address=10.10.10.1/24</code></p>
<p><code>lxd init</code></p>
<pre><code class="lang-auto">Would you like to configure LXD to use an existing bridge or host interface? (yes/no) [default=no]: yes
</code></pre>
<pre><code class="lang-auto">Name of the existing bridge or host interface: lxdbr0
</code></pre>
<details>
<summary>
couldn’t find the CGroup blkio.weight</summary>
<aside class="quote no-group" data-username="tunivi" data-post="837" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/tunivi/48/4829_2.png" class="avatar"> tunivi:</div>
<blockquote>
<p>У меня Ubuntu 20.04 LTS. LXD пытается запуститься, но в итоге бесконечно сыплет ошибками типа <em>couldn’t find the CGroup blkio.weight</em> в логах.</p>
</blockquote>
</aside>
<pre><code class="lang-auto">echo 'GRUB_CMDLINE_LINUX=systemd.unified_cgroup_hierarchy=false' &gt; /etc/default/grub.d/cgroup.cfg
</code></pre>
<pre><code class="lang-auto">update-grub
</code></pre>
<p><code>shutdown -r 0</code></p>
</details></td><td>2024-04-17T20:21:41.311Z</td></tr><tr><td>tunivi</td><td><aside class="quote no-group" data-username="nzkhammatov" data-post="838" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/nzkhammatov/48/4650_2.png" class="avatar"> nzkhammatov:</div>
<blockquote>
<p><code>echo 'GRUB_CMDLINE_LINUX=systemd.unified_cgroup_hierarchy=false' &gt; /etc/default/grub.d/cgroup.cfg</code></p>
</blockquote>
</aside>
<p>Не помогло, к сожалению</p>
<aside class="quote no-group" data-username="nzkhammatov" data-post="838" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/nzkhammatov/48/4650_2.png" class="avatar"> nzkhammatov:</div>
<blockquote>
<p><strong>А так ?</strong><br>
<code>lxc network create lxdbr0 ipv4.address=10.10.10.1/24</code></p>
<p><code>lxd init</code></p>
<pre><code class="lang-auto">Would you like to configure LXD to use an existing bridge or host interface? (yes/no) [default=no]: yes
</code></pre>
<pre><code class="lang-auto">Name of the existing bridge or host interface: lxdbr0
</code></pre>
</blockquote>
</aside>
<p>Сделал так после обновления на 22.04. После прохождения всех этапов <em>lxd init</em> получил такую ошибку:<br>
<em><strong>Error: Failed to update profile “default”: Device validation failed for “eth0”: Cannot use “nictype” property in conjunction with “network” property</strong></em></p></td><td>2024-04-18T10:11:15.678Z</td></tr><tr><td>tunivi</td><td><p>Бридж настроен, lxd init прошёл успешно, но IP-адрес из подсети бриджа контейнер всё равно не получает. Идей пока нет. Наверное, придётся удалять всё полностью и ставить LXD заново</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/f3838888e77b2b1f4fdc3021dcfa3eac9cb56747.jpeg" data-download-href="https://ntc.party/uploads/default/f3838888e77b2b1f4fdc3021dcfa3eac9cb56747" title="1"><img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/f3838888e77b2b1f4fdc3021dcfa3eac9cb56747_2_517x101.jpeg" alt="1" data-base62-sha1="yKdPIENevrljRJiQoCEWrpqB2d1" width="517" height="101" srcset="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/f3838888e77b2b1f4fdc3021dcfa3eac9cb56747_2_517x101.jpeg, контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/f3838888e77b2b1f4fdc3021dcfa3eac9cb56747.jpeg 1.5x, контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/f3838888e77b2b1f4fdc3021dcfa3eac9cb56747.jpeg 2x" data-dominant-color="0B0B0C"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">1</span><span class="informations">706×139 30.3 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div><br>
<div class="lightbox-wrapper"><a class="lightbox" href="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/59fbfa6d98caa690b92f556b383ce8cbbc020822.jpeg" data-download-href="https://ntc.party/uploads/default/59fbfa6d98caa690b92f556b383ce8cbbc020822" title="3"><img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/59fbfa6d98caa690b92f556b383ce8cbbc020822_2_316x375.jpeg" alt="3" data-base62-sha1="cQ2m3uLBxhVIhYlneaDfddjCszo" width="316" height="375" srcset="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/59fbfa6d98caa690b92f556b383ce8cbbc020822_2_316x375.jpeg, контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/59fbfa6d98caa690b92f556b383ce8cbbc020822.jpeg 1.5x, контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/59fbfa6d98caa690b92f556b383ce8cbbc020822.jpeg 2x" data-dominant-color="070A09"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">3</span><span class="informations">450×532 48.5 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div><br>
<img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/172551001a1d801f936d68c79f0173b6ece55e05.jpeg" alt="2" data-base62-sha1="3iKVM3dqRCF3LdxYdfrUT5WdIB7" width="439" height="74"></p></td><td>2024-04-18T12:44:03.744Z</td></tr><tr><td>nzkhammatov(Ainur Khammatov)</td><td><aside class="quote no-group quote-modified" data-username="tunivi" data-post="840" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/tunivi/48/4829_2.png" class="avatar"> tunivi:</div>
<blockquote>
<p><div class="lightbox-wrapper"><a class="lightbox" href="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/f3838888e77b2b1f4fdc3021dcfa3eac9cb56747.jpeg" data-download-href="https://ntc.party/uploads/default/f3838888e77b2b1f4fdc3021dcfa3eac9cb56747" title="1"><img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/f3838888e77b2b1f4fdc3021dcfa3eac9cb56747.jpeg" alt="1" data-base62-sha1="yKdPIENevrljRJiQoCEWrpqB2d1" width="690" height="135" data-dominant-color="0B0B0C"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">1</span><span class="informations">706×139 30.3 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
</blockquote>
</aside>
<pre><code class="lang-auto">lxc info | grep firewall
</code></pre>
<p>Что показывает?</p></td><td>2024-04-18T15:34:06.293Z</td></tr><tr><td>tunivi</td><td><p>Вот это</p>
<pre><code class="lang-auto">- network_firewall_filtering
- firewall_driver
  firewall: nftables
</code></pre></td><td>2024-04-18T15:53:01.413Z</td></tr><tr><td>nzkhammatov(Ainur Khammatov)</td><td><aside class="quote no-group" data-username="tunivi" data-post="842" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/tunivi/48/4829_2.png" class="avatar"> tunivi:</div>
<blockquote>
<p><code>firewall: nftables</code></p>
</blockquote>
</aside>
<p>Попробуйте <code>docker</code> удалить</p>
<pre><code class="lang-auto">apt remove --purge docker.io -y
apt autoremove -y
</code></pre>
<p>И <code>firewall</code> почистить от правил <code>docker</code>, которые могли быть сохранены ранее с целью восстановления после перезагрузки.</p>
<p>Или вовсе все правила убрать, для теста.</p>
<pre><code class="lang-auto">shutdown -r 0
</code></pre>
<p>Получит ли контейнер после этого адрес?</p></td><td>2024-04-18T16:03:26.126Z</td></tr><tr><td>tunivi</td><td><p>Спасибо, что натолкнули на верный путь) Дело было в <code>docker</code> и файерволле <code>ufw</code>. <code>Docker</code> мне нужен, поэтому удалять не стал. Решение обнаружилось в <a href="https://documentation.ubuntu.com/lxd/en/latest/howto/network_bridge_firewalld/#network-bridge-firewall" rel="noopener nofollow ugc">официальной документации.</a><br>
Настроил правила <code>ufw</code> для <code>lxdbr0</code> по инструкции, а потом прописал настройку <code>sysctl</code> для IPv4-форвардинга, которая начинает действовать до старта сервиса <code>docker</code>:</p>
<pre><code class="lang-auto">echo "net.ipv4.conf.all.forwarding=1" &gt; /etc/sysctl.d/99-forwarding.conf
systemctl restart systemd-sysctl
</code></pre>
<p>Теперь всё выглядит вот так:<br>
<img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/5225306f786f8219cb408a3264da53af2dde5ed8.jpeg" alt="1" data-base62-sha1="bIGPsNt4spcFIBKlmHtYU0DAXQ4" width="324" height="75"><br>
Настройки проводил на обновлённом дистрибутиве Ubuntu 22.04.4 LTS.</p></td><td>2024-04-18T16:44:45.261Z</td></tr><tr><td>runalsh(runalsh)</td><td><p>Несмотря на то что докер не очень подходит, попытался собрать <a href="https://github.com/runalsh/antizapret-openvpn-docker-alpine" rel="noopener nofollow ugc">контейнер нативно на alpine</a>.<br>
Чем можно заменить dnsmap ? Сбилдить <a href="https://github.com/resurrecting-open-source-projects/dnsmap" rel="noopener nofollow ugc">этот</a> или переделать под dnsmasq?</p>
<p>Не совсем понимаю для чего он</p></td><td>2024-04-18T21:59:11.107Z</td></tr><tr><td>bync(Ole)</td><td><p>обновил убунту в надежде на решение проблем, но при попытке установки контейнера, получил следующее, помогите плиз:<br>
lxc image import <a href="https://antizapret.prostovpn.org/container-images/az-vpn" rel="noopener nofollow ugc">https://antizapret.prostovpn.org/container-images/az-vpn</a> --alias antizapret-vpn-img<br>
lxc init antizapret-vpn-img antizapret-vpn<br>
lxc config device add antizapret-vpn proxy_1194 proxy listen=tcp:[::]:1194 connect=tcp:127.0.0.1:1194<br>
lxc config device add antizapret-vpn proxy_1194_udp proxy listen=udp:[::]:1194 connect=udp:127.0.0.1:1194<br>
lxc start antizapret-vpn<br>
sleep 10<br>
lxc file pull antizapret-vpn/root/easy-rsa-ipsec/CLIENT_KEY/antizapret-client-tcp.ovpn antizapret-client-tcp.ovpn<br>
To start your first container, try: lxc launch ubuntu:22.04<br>
Or for a virtual machine: lxc launch ubuntu:22.04 --vm</p>
<p>Image imported with fingerprint: 05c09dfe5e7f843b150bdaa65832f1e253b90b35cbc505b5a1283aadab12b51f<br>
Creating antizapret-vpn<br>
Device proxy_1194 added to antizapret-vpn<br>
Device proxy_1194_udp added to antizapret-vpn<br>
Error: Not Found</p></td><td>2024-04-19T11:15:35.959Z</td></tr><tr><td>bync(Ole)</td><td><p>Можете показать как произвели настройку?</p></td><td>2024-04-19T11:35:44.588Z</td></tr><tr><td>tunivi</td><td><p>Я заново не переустанавливал контейнер. На Ubuntu 20.04 lxd внезапно вообще перестал запускаться, но после обновления на 22.04 завёлся. Осталось только решить проблему с отсутствием интернета внутри контейнера, что и было сделано</p></td><td>2024-04-20T08:27:12.707Z</td></tr><tr><td>zugov</td><td><p>Поставил контейнер, применил патчи, почитал ветку. Вроде все ок, но сервер постоянно пока что под 100% нагружен. Взял слабый? По спецификации подходит, 500 оперативка и 1 ядро. Или надо подождать? В htop parse.sh обычно половину ЦП отбирает и knot, всё ок или нужен сервер мощнее? Ставил lxd, если что. Поставил конфиг на кинетик роутер по инструкции, добавлял нужные строчки, которых нет в оригинальном конфиге (на паблик версии у меня работает всё), но пока ничего не работает. Что мог сделать не так?</p></td><td>2024-04-21T03:46:11.706Z</td></tr><tr><td>zugov</td><td><p>UPD: нагрузка не падает, 100%+. впн так и не работает</p></td><td>2024-04-21T16:15:18.923Z</td></tr><tr><td>Lapa(Lapa)</td><td><p>Требования старые указаны. В текущем исполнении от 1гб.</p></td><td>2024-04-22T05:48:38.648Z</td></tr><tr><td>bync(Ole)</td><td><p>Так я и спрашивал как решить проблему, у меня была такая же…</p></td><td>2024-04-22T09:36:48.309Z</td></tr><tr><td>Lapa(Lapa)</td><td><p>А вот это кто то без сноса контейнера победил?</p></td><td>2024-04-25T05:12:35.734Z</td></tr><tr><td>bync(Ole)</td><td><p>Выше же чувак писал</p>
<aside class="quote no-group" data-username="tunivi" data-post="848" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/tunivi/48/4829_2.png" class="avatar"> tunivi:</div>
<blockquote>
<p>Я заново не переустанавливал контейнер.</p>
</blockquote>
</aside>
<p>что просто обновил убунту и донастроил.</p></td><td>2024-04-25T07:53:35.919Z</td></tr><tr><td>intega33(ankind90)</td><td><p>Полностью переустанавливал контейнер и систему ни на Ubuntu 20.04 ни на 22 не завелся, патчи не ставятся пишет</p>
<blockquote>
<p>root@antizapret-vpn:~/dnsmap# patch -i p.patch<br>
bash: patch: command not found</p>
</blockquote>
<p>Очень обидно, пока просто опен впн установил, не знаю даже как описать свою проблему почему у меня вдруг перестал работать</p></td><td>2024-04-25T07:54:13.708Z</td></tr><tr><td>ilyaigpetrov(ilyaigpetrov)</td><td><aside class="onebox stackexchange" data-onebox-src="https://askubuntu.com/questions/493030/how-to-install-a-patch-program/493057#493057">
  <header class="source">

      <a href="https://askubuntu.com/questions/493030/how-to-install-a-patch-program/493057#493057" target="_blank" rel="noopener">askubuntu.com</a>
  </header>

  <article class="onebox-body">
    
<h4>
  <a href="https://askubuntu.com/questions/493030/how-to-install-a-patch-program/493057#493057" target="_blank" rel="noopener">How to install a 'patch' program?</a>
</h4>

<div class="tags">
  <strong>software-sources, patch</strong>
</div>

<div class="date">
  
  answered by
  <a href="" rel="noopener">
    user308564
  </a>
  on <a href="https://askubuntu.com/questions/493030/how-to-install-a-patch-program/493057#493057" target="_blank" rel="noopener">07:49AM - 08 Jul 14 UTC</a>
</div>

  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>
</td><td>2024-04-25T08:18:36.776Z</td></tr><tr><td>Mr.Alex</td><td><aside class="quote quote-modified" data-post="537" data-topic="129">
  <div class="title">
    <div class="quote-controls"></div>
    <img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/nzkhammatov/48/4650_2.png" class="avatar">
    <a href="https://ntc.party/t/129/537">Контейнер VPN АнтиЗапрета для установки на собственный сервер</a> <a class="badge-category__wrapper " href="/c/antizapret-prostovpn-org/az-self-hosted/38"><span data-category-id="38" style="--category-badge-color: #0088CC; --category-badge-text-color: #FFFFFF; --parent-category-badge-color: #8C6238;" data-parent-category-id="5" data-drop-close="true" class="badge-category --has-parent" title="Вопросы и особенности работы контейнера VPN АнтиЗапрета на своих серверах"><span class="badge-category__name">АнтиЗапрет на собственном сервере (self-hosted)</span></span></a>
  </div>
  <blockquote>
    Список необходимых патчей для сохранения работоспособности частного контейнера АнтиЗапрет. 
Выполнять внутри контейнера 
root@antizapret-vpn:~# 
Для входа в lxd 
lxc exec antizapret-vpn bash 
Для входа в systemd-machined (cloud-init) 
machinectl shell antizapret-vpn /bin/bash 
Обновить пакет dnslib 
apt update
apt remove --purge python3-dnslib -y
apt autoremove -y
apt install python3-pip socat -y
pip3 install dnslib

Применить патч файл 
wget https://raw.githubusercontent.com/nzkhammatov/antizap…
  </blockquote>
</aside>
</td><td>2024-04-25T08:45:53.801Z</td></tr><tr><td>Lapa(Lapa)</td><td><p>sudo apt install patch…</p></td><td>2024-04-25T09:35:51.360Z</td></tr><tr><td>intega33(ankind90)</td><td><p>Спасибо, вроде всё сделал по инструкции кроме</p>
<blockquote>
<p>Заменить выделенную строку</p>
<p><code>https://bitbucket.org/anticensority/antizapret-pac-generator-light/src/c73e0d901feb5b862a14f6e0f13670e590fb49ea/parse.sh#lines-10</code></p>
<p><code>nano /root/antizapret/parse.sh</code></p>
<p>На это</p>
<p><code>awk -F ';' '{print $2}' temp/list.csv | sort -u | awk '/^$/   {next} /\\/ {next} /^[а-яА-Яa-zA-Z0-9\-\_\.\*]*+$/ {gsub(/\*\./, "");   gsub(/\.$/, ""); print}' | grep -Fv 'bеllonа' | CHARSET=UTF-8 idn &gt;   result/hostlist_original.txt</code></p>
</blockquote>
<p>не могу найти такую строку в файле и всё равно не работает</p></td><td>2024-04-25T11:35:27.500Z</td></tr><tr><td>Lapa(Lapa)</td><td><p>Вот эту строку (десятая строка):</p>
<p><code>awk -F ';' '{print $2}' temp/list.csv | sort -u | awk '/^$/ {next} /\\/ {next} /^[а-яА-Яa-zA-Z0-9\-\_\.\*]*+$/ {gsub(/\*\./, ""); gsub(/\.$/, ""); print}' | CHARSET=UTF-8 idn &gt; result/hostlist_original.txt</code></p>
<p>На вот эту:</p>
<p><code>awk -F ';' '{print $2}' temp/list.csv | sort -u | awk '/^$/ {next} /\\/ {next} /^[а-яА-Яa-zA-Z0-9\-\_\.\*]*+$/ {gsub(/\*\./, ""); gsub(/\.$/, ""); print}' | grep -Fv 'bеllonа' | CHARSET=UTF-8 idn &gt; result/hostlist_original.txt</code></p></td><td>2024-04-25T11:41:41.454Z</td></tr><tr><td>intega33(ankind90)</td><td><p><a class="attachment" href="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/hZqaTHein5bmsrM9J1piPG1Lu3r.txt">parse.txt</a> (2,5 КБ)</p>
<p>У меня вот такой файл</p></td><td>2024-04-25T12:13:52.924Z</td></tr><tr><td>Lapa(Lapa)</td><td><aside class="quote no-group quote-modified" data-username="Lapa" data-post="860" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/l/f08c70/48.png" class="avatar"> Lapa:</div>
<blockquote>
<p>awk -F ‘;’ ‘{print $2}’ temp/list.csv | sort -u | awk ‘/^$/ {next} /\/ {next} /<sup class="footnote-ref"><a href="#footnote-25201-1" id="footnote-ref-25201-1">[1]</a></sup>*+$/ {gsub(/*./, “”); gsub(/.$/, “”); print}’ | grep -Fv ‘bеllonа’ | CHARSET=UTF-8 idn &gt; result/hostlist_original.txt</p>
</blockquote>
</aside>
<p>Вот исправил.<br>
<a class="attachment" href="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/6QUi3s6tBObakouemMJsJlSezqy.txt">parse.txt</a> (2,5 КБ)</p>
<hr class="footnotes-sep">

<ol class="footnotes-list">
<li id="footnote-25201-1" class="footnote-item"><p>а-яА-Яa-zA-Z0-9-_.* <a href="#footnote-ref-25201-1" class="footnote-backref">↩︎</a></p>
</li>
</ol></td><td>2024-04-25T12:24:22.226Z</td></tr><tr><td>intega33(ankind90)</td><td><p>Спасибо! Всё заработало</p></td><td>2024-04-25T12:32:32.090Z</td></tr><tr><td>helcoder</td><td><p>Подскажите, почему может не резолвиться домен <a href="http://browser.events.data.msn.com" rel="noopener nofollow ugc">browser.events.data.msn.com</a> когда добавляешь <a href="http://msn.com" rel="noopener nofollow ugc">msn.com</a> в include-hosts-custom.txt? Притом просто <a href="http://msn.com" rel="noopener nofollow ugc">msn.com</a> резолвится нормально на antizapret.</p></td><td>2024-04-26T14:13:12.920Z</td></tr><tr><td>ValdikSS</td><td><p>Возможно, из-за dnssec</p><aside class="quote quote-modified" data-post="77" data-topic="129">
  <div class="title">
    <div class="quote-controls"></div>
    <img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/mostm/48/816_2.png" class="avatar">
    <a href="https://ntc.party/t/%D0%BA%D0%BE%D0%BD%D1%82%D0%B5%D0%B9%D0%BD%D0%B5%D1%80-vpn-%D0%B0%D0%BD%D1%82%D0%B8%D0%B7%D0%B0%D0%BF%D1%80%D0%B5%D1%82%D0%B0-%D0%B4%D0%BB%D1%8F-%D1%83%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B8-%D0%BD%D0%B0-%D1%81%D0%BE%D0%B1%D1%81%D1%82%D0%B2%D0%B5%D0%BD%D0%BD%D1%8B%D0%B9-%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80/129/77">Контейнер VPN АнтиЗапрета для установки на собственный сервер</a> <a class="badge-category__wrapper " href="/c/antizapret-prostovpn-org/az-self-hosted/38"><span data-category-id="38" style="--category-badge-color: #0088CC; --category-badge-text-color: #FFFFFF; --parent-category-badge-color: #8C6238;" data-parent-category-id="5" data-drop-close="true" class="badge-category --has-parent" title="Вопросы и особенности работы контейнера VPN АнтиЗапрета на своих серверах"><span class="badge-category__name">АнтиЗапрет на собственном сервере (self-hosted)</span></span></a>
  </div>
  <blockquote>
    На данный момент, чтобы Knot Resolver принимал ответы от AdGuard Home необходимо так же прописать отключение проверок DNSSEC: trust_anchors.remove('.') 
Без этого, dig google.com @127.0.0.1 внутри контейнера возвращает SERVFAIL, соответственно работать не будет. 
(лог запроса в моем случае: 
[plan] plan 'google.com.' type 'A' uid [58041.00]
[iter]   'google.com.' type 'A' new uid was assigned .01, parent uid .00
[cach]   =&gt; skipping exact RR: rank 030 (min. 030), new TTL -9724
[cach]   =&gt; no NSE…
  </blockquote>
</aside>
</td><td>2024-04-26T14:33:29.702Z</td></tr><tr><td>helcoder</td><td><p>Попробовал добавить trust_anchors.remove(‘.’) в /etc/knot-resolver/kresd.conf , потом сделал echo “cache.clear()” | socat - /run/knot-resolver/control/1 и LANG=C.UTF-8 /root/antizapret/doall.sh но как-то не помогло. Или с этим в принципе ничего не поделать?</p></td><td>2024-04-26T14:48:55.803Z</td></tr><tr><td>ValdikSS</td><td><aside class="quote no-group" data-username="helcoder" data-post="866" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/h/57b2e6/48.png" class="avatar"> helcoder:</div>
<blockquote>
<p>Или с этим в принципе ничего не поделать?</p>
</blockquote>
</aside>
<p>Отлаживайте средствами dig, tcpdump и самого knot-resolver. Сходу вряд ли кто-то что-то подскажет, причин может быть множество.</p></td><td>2024-04-26T18:09:08.795Z</td></tr><tr><td>lHumaNl(Aleksandr)</td><td><p>Коллеги, не подскажите, у кого-нибудь проявляется последние два дня проблема с chatGPT? Они перенесли отправку сообщений на wss с http и теперь при отправке сообщения он пишет, что возникла проблема. Если перезайти в чат через минуту, то ответ от нейронки будет сформирован.</p>
<p>Через F12 в wss коннекте от сервера ничего не поступает и через 5 секунд соединение закрывается. Проверил, хост для wss в VPN “заворачивается”. Думал, что может проблема именно с заворачиванием при использовании wss, но накидав скрипт на Python, хост все также корректно “заворачивается” в VPN и даже корректно отвечает, правда с 403(но это нормально, тк я использовал “протухший” токен).</p></td><td>2024-04-27T10:38:50.205Z</td></tr><tr><td>ilyaigpetrov(ilyaigpetrov)</td><td><p>Неверную ссылку прислал, вот тут ещё жаловались:</p><aside class="quote quote-modified" data-post="47" data-topic="7216">
  <div class="title">
    <div class="quote-controls"></div>
    <img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/m/db5fbb/48.png" class="avatar">
    <a href="https://ntc.party/t/%D0%B4%D0%BE%D0%B1%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5-chatgpt-%D0%B2-antizapret/7216/47">Добавление chatGPT в antizapret</a> <a class="badge-category__wrapper " href="/c/antizapret-prostovpn-org/az-self-hosted/38"><span data-category-id="38" style="--category-badge-color: #0088CC; --category-badge-text-color: #FFFFFF; --parent-category-badge-color: #8C6238;" data-parent-category-id="5" data-drop-close="true" class="badge-category --has-parent" title="Вопросы и особенности работы контейнера VPN АнтиЗапрета на своих серверах"><span class="badge-category__name">АнтиЗапрет на собственном сервере (self-hosted)</span></span></a>
  </div>
  <blockquote>
    По каким то причинам перестал работать ChatGPT. Вот такие использую домены 

<a href="http://chat.openai.com" rel="noopener nofollow ugc">chat.openai.com</a> 
<a href="http://intercomcdn.com" rel="noopener nofollow ugc">intercomcdn.com</a> 
<a href="http://oaistatic.com" rel="noopener nofollow ugc">oaistatic.com</a> 
<a href="http://oaiusercontent.com" rel="noopener nofollow ugc">oaiusercontent.com</a> 
[image]
  </blockquote>
</aside>
</td><td>2024-04-27T11:00:26.844Z</td></tr><tr><td>Mr.Alex</td><td><p>Это верные ссылки. ChatGPT перестал работать как раз пару дней назад как у человека выше</p></td><td>2024-04-27T11:06:48.949Z</td></tr><tr><td>bync(Ole)</td><td><aside class="quote no-group" data-username="Контейнер VPN АнтиЗапрета для установки на собственный сервер" data-post="77" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
 Контейнер VPN АнтиЗапрета для установки на собственный сервер:</div>
<blockquote>
<p>прописать отключение проверок DNSSEC: <code>trust_anchors.remove('.')</code></p>
</blockquote>
</aside>
<p>эту строку нужно добавить в конце файла?</p></td><td>2024-05-01T11:21:09.100Z</td></tr><tr><td>ValdikSS</td><td><aside class="quote no-group" data-username="bync" data-post="872" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/b/e56c9b/48.png" class="avatar"> bync:</div>
<blockquote>
<p>эту строку нужно добавить в конце файла?</p>
</blockquote>
</aside>
<p>Лучше ближе к началу, после объявления портов (директивы listen). Я добавляю после modules.</p></td><td>2024-05-02T17:50:23.071Z</td></tr><tr><td>preha</td><td><p>Здравствуйте. Устанавливал туннель, который ведёт на мой сервер в Нидерландах, на Mikrotik по инструкциям с этого форума и всё прекрасно работало уже больше года. В последнее время стали отваливаться некоторые домены, которые не попадают под блокировку (например, <a href="http://gentoo.org" rel="noopener nofollow ugc">gentoo.org</a>, <a href="http://reddit.com" rel="noopener nofollow ugc">reddit.com</a> и другие). Если отключить VPN, то на сайты заходит без проблем. С включенным VPN сайты нормально пингуются, трафик идёт напрямую, но все HTTP/HTTPS запросы падают по таймауту без какого-либо ответа. В плане софта для обхода блокировок ещё не силён, так что попробовал прописать отваливающиеся домены в exclude-*.txt и в getzones.awk, но ни один вариант не сработал. Прошу подсказки, как это можно поправить</p></td><td>2024-05-03T09:32:24.826Z</td></tr><tr><td>ValdikSS</td><td><p>8 posts were split to a new topic: <a href="/t/dns-%D1%80%D0%B5%D0%B7%D0%BE%D0%BB%D0%B2-%D0%BF%D1%80%D0%B8-%D0%BD%D0%B5%D1%81%D0%BA%D0%BE%D0%BB%D1%8C%D0%BA%D0%B8%D1%85-vpn-%D0%BF%D0%BE%D0%B4%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%BD%D0%B8%D1%8F%D1%85-%D0%B2-windows/7810">DNS-резолв при нескольких VPN-подключениях в Windows</a></p></td><td>2024-05-03T18:12:18.919Z</td></tr><tr><td>bync(Ole)</td><td><p>Спасибо!</p></td><td>2024-05-06T10:22:14.715Z</td></tr><tr><td>bync(Ole)</td><td><p>Забыл уточнить - эту строку надо добавлять только если AGH установлен на том же VPS что и антизапрет? Если AGH стоит на роутере, то не надо добавлять? У меня какая-то странная ситуация, я уже устал искать проблему - если подключить ваш антизапрет, то рутрекер грузится нормально, если “мой” то в яндекс.браузере грузит без картинок, какой-то полусайт и он не работает нормально, мог бы стерпеть что картинок нет, а в Edge все ок! Если я отключаю AGH, то грузится везде? но в яндексе все равно некоторых картинок не хватает, хотя уже гораздо лучше все и сайт рабочий. Отсюда я сделал вывод что проблема то ли в их сочетании, то ли в настройках моего антизапрета, но тут я уже не знаю что еще можно сделать… может кто подскажет куда копать?</p></td><td>2024-05-07T09:41:20.121Z</td></tr><tr><td>ValdikSS</td><td><aside class="quote no-group" data-username="preha" data-post="874" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/p/bc79bd/48.png" class="avatar"> preha:</div>
<blockquote>
<p>Если отключить VPN, то на сайты заходит без проблем. С включенным VPN сайты нормально пингуются, трафик идёт напрямую, но все HTTP/HTTPS запросы падают по таймауту без какого-либо ответа.</p>
</blockquote>
</aside>
<p>Вероятно, резолверу сервера отдаются адреса, заблокированные в РФ.</p><aside class="quote" data-post="630" data-topic="129">
  <div class="title">
    <div class="quote-controls"></div>
    <img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/nzkhammatov/48/4650_2.png" class="avatar">
    <a href="https://ntc.party/t/%D0%BA%D0%BE%D0%BD%D1%82%D0%B5%D0%B9%D0%BD%D0%B5%D1%80-vpn-%D0%B0%D0%BD%D1%82%D0%B8%D0%B7%D0%B0%D0%BF%D1%80%D0%B5%D1%82%D0%B0-%D0%B4%D0%BB%D1%8F-%D1%83%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B8-%D0%BD%D0%B0-%D1%81%D0%BE%D0%B1%D1%81%D1%82%D0%B2%D0%B5%D0%BD%D0%BD%D1%8B%D0%B9-%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80/129/630">Контейнер VPN АнтиЗапрета для установки на собственный сервер</a> <a class="badge-category__wrapper " href="/c/antizapret-prostovpn-org/az-self-hosted/38"><span data-category-id="38" style="--category-badge-color: #0088CC; --category-badge-text-color: #FFFFFF; --parent-category-badge-color: #8C6238;" data-parent-category-id="5" data-drop-close="true" class="badge-category --has-parent" title="Вопросы и особенности работы контейнера VPN АнтиЗапрета на своих серверах"><span class="badge-category__name">АнтиЗапрет на собственном сервере (self-hosted)</span></span></a>
  </div>
  <blockquote>
    Сложность на стороне клиента возможно, я сдаюсь 
<img width="20" height="20" src="https://ntc.party/images/emoji/twitter/upside_down_face.png?v=12" title="upside_down_face" alt="upside_down_face" class="emoji"> 
Можете эту ерунду еще попробовать добавить сюда 
/etc/knot-resolver/kresd.conf 
policy.add(
    policy.suffix(
        policy.FORWARD(
            {'77.88.8.8'}
        ),
        policy.todnames({'bbc.co.uk'})
    )
)
  </blockquote>
</aside>

<aside class="quote no-group" data-username="bync" data-post="877" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/b/e56c9b/48.png" class="avatar"> bync:</div>
<blockquote>
<p>Если я отключаю AGH, то грузится везде? но в яндексе все равно некоторых картинок не хватает, хотя уже гораздо лучше все и сайт рабочий.</p>
</blockquote>
</aside>
<p>Что-то конкретное сказать можно только по выяснении причины проблемы. Разобраться в ней вам поможет F12 - Network в браузере и nslookup на проблемные домены.</p></td><td>2024-05-12T20:30:49.948Z</td></tr><tr><td>bync(Ole)</td><td><p>Проблема как раз в том что F12 ничего криминального не показывает, как и AGH, ничего не блокируется, а nslookup выдает все ок, два ip  - 10.224…</p></td><td>2024-05-13T10:58:29.615Z</td></tr><tr><td>Kebu</td><td><p>Перестал открываться рутрекер. И org, и net. Доьавил на всякий случай оба адреса в include-list, безрезультатно. При этом DIG показывает правильные ответы, с 10.224….<br>
Куда копать, кто сталкивался?</p></td><td>2024-05-14T18:10:36.068Z</td></tr><tr><td>ValdikSS</td><td><aside class="quote no-group" data-username="Kebu" data-post="880" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/k/8797f3/48.png" class="avatar"> Kebu:</div>
<blockquote>
<p>Куда копать, кто сталкивался?</p>
</blockquote>
</aside>
<p>Диагностировать проблему на сервере. Если с сервера не открывается сайт, то это не проблема контейнера.</p></td><td>2024-05-15T01:35:21.465Z</td></tr><tr><td>Mr.Alex</td><td><p>Пробовали добавить домен rutracker.cc?</p></td><td>2024-05-15T05:22:39.311Z</td></tr><tr><td>Kebu</td><td><p>Спасибо большое! Заработало)</p></td><td>2024-05-15T07:11:47.900Z</td></tr><tr><td>bync(Ole)</td><td><p>блин, а почему мне раньше никто не сказал этого, хотя я тут в разных ветках про руткрекер ныл)</p></td><td>2024-05-15T08:58:25.148Z</td></tr><tr><td>Aleksei</td><td><p>Я пошел дальше и добавил домен com в include-hosts-custom.txt Все хорошо, но появилась побочка в виде рекламы на youtube по понятным причинам( Добавление <a href="http://youtube.com" rel="noopener nofollow ugc">youtube.com</a> и его вспомогательных хостов в exclude-hosts-custom.txt не дает нужного результата - <a href="http://youtube.com" rel="noopener nofollow ugc">youtube.com</a> уходит на 10.224… Есть ли решение для этой задачи? Нужно исключение на исключение.</p></td><td>2024-05-28T07:14:05.343Z</td></tr><tr><td>runalsh(runalsh)</td><td><p>Но предупреждаю что это сломает резолвинг в скрипте, если его не используете - ок.</p>
<aside class="quote no-group" data-username="Aleksei" data-post="885" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/a/7c8e57/48.png" class="avatar"> Aleksei:</div>
<blockquote>
<p>добавил домен com в include-hosts-custom.txt</p>
</blockquote>
</aside></td><td>2024-05-28T07:22:16.649Z</td></tr><tr><td>eliondel(Eliondel)</td><td><p>Настроил по инструкции <a href="https://bitbucket.org/anticensority/antizapret-vpn-container/src/master/" class="inline-onebox" rel="noopener nofollow ugc">Bitbucket</a><br>
с помощью LXD. Ubunto 20.04 LTS. Ошибок не было.<br>
Заблокированные сайты не открываются. Что можно проверить?</p>
<p>Починилось после применения патча</p></td><td>2024-06-05T11:55:12.041Z</td></tr><tr><td>Kebu</td><td><p>А никто не сталкивался с проблемой загрузки яндекс-карт при подключении через аз? Либо просто нет картинки, либо появляется после очень длинной паузы. И в приложении, и в браузере, и в embedded картах в других приложениях.</p></td><td>2024-06-05T14:14:27.028Z</td></tr><tr><td>mafiacheb(Александр)</td><td><p>У меня тоже самое. Карта в Авито приложении на телефоне и карта в ютеке не подгружается. Стоит выключить антизапрет, все норм. Кто знает какие адреса нужно добавить или как то решить проблему?</p></td><td>2024-06-12T10:39:41.335Z</td></tr><tr><td>eliondel(Eliondel)</td><td><p>Почему не открывается <a href="http://rutracker.org" rel="noopener nofollow ugc">rutracker.org</a>? С публичного antizapret все прекрасно работает</p></td><td>2024-06-23T12:50:16.021Z</td></tr><tr><td>Lapa(Lapa)</td><td><p>Добавь rutracker.cc в include</p></td><td>2024-06-24T11:32:25.184Z</td></tr><tr><td>eliondel(Eliondel)</td><td><p>Не подскажешь как?</p></td><td>2024-06-24T11:59:16.999Z</td></tr><tr><td>kirill</td><td><p><code>lxc exec antizapret-vpn -- nano /root/antizapret/config/include-hosts-custom.txt</code></p></td><td>2024-06-24T15:22:50.371Z</td></tr><tr><td>kirill</td><td><p>я хз,<br>
помимо всевозможных правок файлов, которые уже и не вспомнить все толком,<br>
я для себя сделал так (можете кидаться тапками)</p>
<p><code>lxc exec antizapret-vpn -- nano /etc/knot-resolver/kresd.conf</code></p>
<pre><code class="lang-auto">-- *.ru, *.рф, *.su
policy.add(
    policy.suffix(
        policy.STUB(
            {'195.208.5.1', '195.208.4.1'}
        ),
        policy.todnames(
            {'ru.', 'рф.', 'su.'}
        )
    )
)

-- Quad9 resolver
policy.add(policy.all(policy.FORWARD({'149.112.112.10', '9.9.9.10'})))
</code></pre>
<p>и у меня всё резолвится как надо</p></td><td>2024-06-24T15:28:10.410Z</td></tr><tr><td>bync(Ole)</td><td><p>добрый день! а что это дает?</p></td><td>2024-06-27T08:36:04.503Z</td></tr><tr><td>Lapa(Lapa)</td><td><p>Все домены зон  ‘ru.’, ‘рф.’, ‘su.’ будут напрямую отправляться на НСДИ</p></td><td>2024-06-27T13:45:22.794Z</td></tr><tr><td>bync(Ole)</td><td><p>А можете рассказать чуть подробнее, в чем преимущество?</p></td><td>2024-06-28T09:57:34.076Z</td></tr><tr><td>elkcl(Elk Cloner)</td><td><p>Насколько реально заменить в этом контейнере OpenVPN на какой-нибудь OpenConnect например? Просто смущает, что OpenVPN постепенно блокируют, и видимо скоро придётся переходить на более устойчивые альтернативы</p></td><td>2024-07-01T15:26:24.772Z</td></tr><tr><td>preha</td><td><aside class="quote no-group" data-username="ValdikSS" data-post="878" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/valdikss/48/2_2.png" class="avatar"> ValdikSS:</div>
<blockquote>
<p>Вероятно, резолверу сервера отдаются адреса, заблокированные в РФ.</p>
</blockquote>
</aside>
<p>Не совсем понимаю, в чём проблема. Сервер же и так получает адреса и, если они оказываются заблокированными, отдаёт свой IP вместо настоящего IP сайта</p></td><td>2024-07-09T09:08:24.035Z</td></tr><tr><td>h7n14(H7n14je)</td><td><p>А тут рф. в punycode не надо переводить? Или он и так его поймет?</p></td><td>2024-07-13T13:23:08.318Z</td></tr><tr><td>kirill</td><td><p>хороший, кстати, вопрос</p>
<p>я не в курсе</p>
<p>upd. но на всякий случай себе поменял, спасибо</p>
<pre><code class="lang-auto">-- *.ru, *.рф, *.su
policy.add(
    policy.suffix(
        policy.STUB(
            {'195.208.5.1', '195.208.4.1'}
        ),
        policy.todnames(
            {'ru.', 'xn--p1ai.', 'su.'}
        )
    )
)
</code></pre></td><td>2024-07-13T15:40:15.552Z</td></tr><tr><td>kirill</td><td><p>можно ли и как в рамках существующего контейнера создать ещё одну (или несколько), параллельно работающую конфигурацию со своим собственным .ovpn-файликом,<br>
как при необходимости её удалить</p>
<p>а если нет – как удалить текущую конфигурацию и создать новую</p></td><td>2024-07-15T18:53:06.422Z</td></tr><tr><td>ValdikSS</td><td><p>В <code>/root/easy-rsa-ipsec</code> находится <a href="https://github.com/OpenVPN/easy-rsa">easy-rsa</a>, следуйте его инструкциям.</p></td><td>2024-07-19T12:23:35.102Z</td></tr><tr><td>Mr.Alex</td><td><p>Здравствуйте! Переехал на другого хостера и при создании антизапрета вот такая ошибка внутри контейнера когда ввожу командку apt update<br>
<div class="lightbox-wrapper"><a class="lightbox" href="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/f06f6c37b3bf2807026099ff57df3ca3bdca82a1.png" data-download-href="https://ntc.party/uploads/default/f06f6c37b3bf2807026099ff57df3ca3bdca82a1" title="image"><img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/f06f6c37b3bf2807026099ff57df3ca3bdca82a1.png" alt="image" data-base62-sha1="yiZjwQ7V6rfVaDPehsQsEvTPORb" width="690" height="159" data-dominant-color="292929"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">1353×312 16.3 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p></td><td>2024-07-23T17:16:39.254Z</td></tr><tr><td>nzkhammatov(Ainur Khammatov)</td><td><aside class="quote no-group quote-modified" data-username="Mr.Alex" data-post="904" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/m/db5fbb/48.png" class="avatar"> Mr.Alex:</div>
<blockquote>
<p><div class="lightbox-wrapper"><a class="lightbox" href="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/f06f6c37b3bf2807026099ff57df3ca3bdca82a1.png" data-download-href="https://ntc.party/uploads/default/f06f6c37b3bf2807026099ff57df3ca3bdca82a1" title="image"><img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/f06f6c37b3bf2807026099ff57df3ca3bdca82a1.png" alt="image" data-base62-sha1="yiZjwQ7V6rfVaDPehsQsEvTPORb" width="690" height="159" data-dominant-color="292929"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">1353×312 16.3 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
</blockquote>
</aside>
<pre><code class="lang-auto">sed -i 's/^/#/' /etc/apt/sources.list.d/knot-resolver-latest.list
clear
apt update
</code></pre></td><td>2024-07-23T22:12:49.724Z</td></tr><tr><td>nzkhammatov(Ainur Khammatov)</td><td><aside class="quote no-group" data-username="preha" data-post="874" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/p/bc79bd/48.png" class="avatar"> preha:</div>
<blockquote>
<p>В последнее время стали отваливаться некоторые домены, которые не попадают под блокировку (например, <a href="http://gentoo.org" rel="noopener nofollow ugc">gentoo.org </a>, <a href="http://reddit.com" rel="noopener nofollow ugc">reddit.com </a> и другие). Если отключить VPN, то на сайты заходит без проблем. С включенным VPN сайты нормально пингуются, трафик идёт напрямую, но все HTTP/HTTPS запросы падают по таймауту без какого-либо ответа.</p>
</blockquote>
</aside>
<hr>
<p>Похожая ситуация разрешилась так</p>
<details>
<summary>
Добавить через пробел, если что-то уже есть в строке</summary>
<pre><code class="lang-auto">GRUB_CMDLINE_LINUX_DEFAULT="quiet splash ipv6.disable=1"
GRUB_CMDLINE_LINUX="ipv6.disable=1"
</code></pre>
</details>
<p><code>nano /etc/default/grub</code></p>
<blockquote>
<p>ipv6.disable=1</p>
</blockquote>
<pre><code class="lang-auto">GRUB_CMDLINE_LINUX_DEFAULT="ipv6.disable=1"
GRUB_CMDLINE_LINUX="ipv6.disable=1"
</code></pre>
<p><code>update-grub</code></p>
<p><code>shutdown -r 0</code></p>
<hr></td><td>2024-07-24T03:24:39.192Z</td></tr><tr><td>Mr.Alex</td><td><p>Не подскажите для Debian 12, чтобы установить lxd нужно просто выполнить команду apt install lxd -y и ввести команду lxd init? Больше не каких действий не нужно?</p></td><td>2024-07-24T07:27:23.043Z</td></tr><tr><td>spong(spong)</td><td><p>Подскажите как решить проблему при запуске контейнера с</p>
<blockquote>
<p>time=“2024-07-26T07:37:38Z” level=error msg=“Failed initializing network” err=“Failed starting: Network has ipv6.address but kernel IPv6 support is missing” network=lxdbr0 project=default</p>
</blockquote>
<p>После отключения ipv6? Зачем вообще в контейнере там ipv6?</p>
<p>При инициализации lxd то же самое</p>
<blockquote>
<p>Error: Failed to create local member network “lxdbr0” in project “default”: Network has ipv6.address but kernel IPv6 support is missing</p>
</blockquote></td><td>2024-07-26T07:43:49.253Z</td></tr><tr><td>fo511(Fo511)</td><td><p>Добрый день.<br>
Установить антизапрет на VDS в Selectel Казахстан. Коннект к VPN устанавливается. Патч применил.<br>
Роутер keenetic. Роут для DNS серверов 77.88.8.8 и 9.9.9.10 прописан.<br>
Но при этом ни один из заблокированных доменов не резолвится в антизапретовский адрес.<br>
Подскажите пожалуйста, в какую сторону копать?</p></td><td>2024-07-26T21:17:56.533Z</td></tr><tr><td>spong(spong)</td><td><p>Сам недавно выбирал у селектела, остановился на сервере в Найроби, у казахов тоже часть заблокировано и некоторые сайты которые не заблокированы очень долго и не с 1 раза грузятся, в найроби хоть и выше пинг но для ютуба и сайтов в целом пофиг.<br>
Касательно вашего вопроса, сначала проверьте что VPN на роутере подключился, затем проверьте что в подключении стоит галка получать маршруты, а затем проверьте что вы не забыли добавить в конфиг строки route и pull-filter (ну из темы про кинетик)</p>
<p>От себя хочу поблагодарить <a class="mention" href="/u/valdikss">@ValdikSS</a> за работу, и хотел спросить, а почему выбор пал на работу openvpn по tcp а не udp? Который вроде бы как стандарт и быстрее? У меня пока не получилось сделать чтобы видео в 4к на ютубе не тормозило, хотя канала более чем достаточно, с компа в целом 2к тянет, с телека нет.</p></td><td>2024-07-27T09:19:21.518Z</td></tr><tr><td>fo511(Fo511)</td><td><p>Все сделано. В роутере вижу что маршрут до ДНСов уходит в ВПН-интерфейс. Но когда делаю nslookup - получаю реальный адрес того же рутрекера и др.</p></td><td>2024-07-27T09:40:03.364Z</td></tr><tr><td>spong(spong)</td><td><p>Ну если у тебя опенвпн коннектится и ты видишь что запросы идут в тунель, то это либо у тебя сломан резолвер в контейнере либо эти сайты по какой-то причине не указаны как заблокированные. Инструкция по кинетику + контейнеру полностью рабочая (злючением что надо применить патч + поправить ключ внутри чтобы кнот резолвер обновился). Ну или ты там doall скрипт не сделал + не перезапустил контейнер после всех изменений</p></td><td>2024-07-27T12:32:55.321Z</td></tr><tr><td>fo511(Fo511)</td><td><p>Патч применял и контейнер рестартил. Думаю как раз на резолвер.<br>
Нужна помощь чтобы понять как дебажить работу DNS-сервера, куда смотреть?</p></td><td>2024-07-27T13:00:43.755Z</td></tr><tr><td>spong(spong)</td><td><p>Я не понимаю зачем тебе его дебажить, ну сломал контейнер и черт с ним, пересоздай vps, настройка нового контейнера и применения всех патчей буквально занимает 10-20 минут времени и это уже с перетаскиванием нового конфига в роутер</p></td><td>2024-07-27T13:22:33.333Z</td></tr><tr><td>fo511(Fo511)</td><td><p>В том то и дело что я его не ломал. Он не работает изначально. Пытался дважды.</p></td><td>2024-07-27T13:33:47.082Z</td></tr><tr><td>dddennnisss</td><td><p>Здравствуйте.</p>
<p>Антизапрет стоит на личном серваке в зоне РФ. Есть вириуалка не в зоне РФ.<br>
Хочу установить wiguard клиент и соединить антизапрет с виртуалкой.</p>
<p>Где правильно установить клиент? На серваке за контейнером и внутри контейнера?<br>
Если ставлю за контейнером, то при поднятие соединения wg перестаёт коннектится клиенты к openvpn антизапрета.<br>
А установить в контейнере не получается - ошибка про то что не удаётся найти установочный пакет.<br>
Подскажите, пожалуйста, как правильно сделать и как исправить проблемы описанные выше.</p></td><td>2024-07-27T19:16:11.270Z</td></tr><tr><td>fo511(Fo511)</td><td><p>Продолжаю пытаться дебажить. Выяснил что внутри контейнера заблокированные домены резолвятся верно. Но не снаружи со стороны моего роутера. Куда еще можно посмотреть чтобы понять в чем дело?</p></td><td>2024-07-27T19:21:37.382Z</td></tr><tr><td>Tyman</td><td><p>Подскажите, создал свой сервер по инструкции через LXD (На последней убунте 24 через systemd-machined не работает, gpg не нравится ключ)</p>
<p>Все создалось, подключаюсь, но DNS не подменяет IP для разблокировки:</p>
<p>C:\Users\User&gt;nslookup <a href="http://rutracker.org" rel="noopener nofollow ugc">rutracker.org</a><br>
╤хЁтхЁ:  UnKnown<br>
Address:  <strong>192.168.104.1</strong></p>
<p>Не заслуживающий доверия ответ:<br>
╚ь :     <a href="http://rutracker.org" rel="noopener nofollow ugc">rutracker.org</a><br>
Addresses:  2606:4700:3031::6815:2027<br>
2606:4700:3034::ac43:b6c4<br>
104.21.32.39<br>
172.67.182.196</p>
<p>Помогите пожалуйста, я не большой спец убунты, спасибо!</p></td><td>2024-07-29T16:31:35.472Z</td></tr><tr><td>abrikman(Alexander K)</td><td><p>Привет! Давно слежу за форумом, не регистрировался и только читал.<br>
В общем-то у меня:<br>
SelfHosted Антизапрет, версия последняя, на днях обновлял<br>
Кинетик Ультра, который подключается до Антизапрет<br>
DigitalOcean с хорошим инстансом - 2 ЦПУ, 2 Гб памяти, премиум интел.<br>
500 мегабитный канал дома</p>
<p>Пинг до DO окло 52 мс, скорость прямой передачи от дома до DO и обратно - около 400-450 мегабит, то есть торренты я качаю на скорости домашнего канала, по сути вообще если сидеть чисто под впн - разницы особо нет.</p>
<p>Но я как-то не очень могу найти решения, как пустить весь трафик из домашней сети для YouTube через Антизапрет, где живу только я один,</p>
<p>Нашел вот этот мануал, все сделал по нему - <a href="https://ntc.party/t/%D0%BA%D0%BE%D0%BD%D1%82%D0%B5%D0%B9%D0%BD%D0%B5%D1%80-vpn-%D0%B0%D0%BD%D1%82%D0%B8%D0%B7%D0%B0%D0%BF%D1%80%D0%B5%D1%82%D0%B0-%D0%B4%D0%BB%D1%8F-%D1%83%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B8-%D0%BD%D0%B0-%D1%81%D0%BE%D0%B1%D1%81%D1%82%D0%B2%D0%B5%D0%BD%D0%BD%D1%8B%D0%B9-%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80/129/436" class="inline-onebox">Контейнер VPN АнтиЗапрета для установки на собственный сервер - #436 by nzkhammatov</a></p>
<p>Подскажите, люди знающие, на сегодняшний момент это исчепрывающая инструкция?<br>
Почему не могу проверить - я не до конца понимаю, в какие моменты мой провайдер снижает скорость.<br>
Вот прямо сейчас настроен по инструкции - с десктопа скорость на ютуб низкая, хотя определяется как NL - Нидерланды, где и живет инстанс.</p>
<p>Или что-то ещё нужно подшаманить?</p></td><td>2024-07-29T16:56:35.542Z</td></tr><tr><td>Tyman</td><td><p>Разобрался… Надо было накатить патчи, жаль про них нет в инструкции, может обновите?<br>
И лучше с 1Гб ставить 20 убунту, в 24 памяти не хватает(</p></td><td>2024-07-29T21:03:53.081Z</td></tr><tr><td>Tyman</td><td><p>Патчи надо ставить, править скрипт ручками… тут есть <a href="https://ntc.party/t/%D0%BA%D0%BE%D0%BD%D1%82%D0%B5%D0%B9%D0%BD%D0%B5%D1%80-vpn-%D0%B0%D0%BD%D1%82%D0%B8%D0%B7%D0%B0%D0%BF%D1%80%D0%B5%D1%82%D0%B0-%D0%B4%D0%BB%D1%8F-%D1%83%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B8-%D0%BD%D0%B0-%D1%81%D0%BE%D0%B1%D1%81%D1%82%D0%B2%D0%B5%D0%BD%D0%BD%D1%8B%D0%B9-%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80/129/537" class="inline-onebox">Контейнер VPN АнтиЗапрета для установки на собственный сервер - #537 by nzkhammatov</a></p></td><td>2024-07-29T21:05:46.192Z</td></tr><tr><td>abrikman(Alexander K)</td><td><p>Разобрался. Почему-то DigitalOcean (AMS2, AMS3) шейпил мне именно ютуб. Сменил хостинг - полетело всё.</p></td><td>2024-07-30T18:53:35.597Z</td></tr><tr><td>Tyman</td><td><p>ютуб направляет на свои сервера в зависимости от ип<br>
надо смотреть на какой кластер серверов перенаправляет так<br>
<a href="https://redirector.googlevideo.com/report_mapping?di=no" class="onebox" target="_blank" rel="noopener nofollow ugc">https://redirector.googlevideo.com/report_mapping?di=no</a><br>
у меня на 3х впс - разные сервера, на одной впс используются сервера ютуба даже в россии, но не заметно чтобы блокировали входящий в рф трафик<br>
на одной тормозит ютуб - там сервера ютуба в англии, а впс в нидерландах<br>
на третей - сервера по видимому даже на украине</p></td><td>2024-07-30T20:09:19.353Z</td></tr><tr><td>abrikman(Alexander K)</td><td><p>Ого, не знал даже. Видимо что-то с маршрутизацией с DO что-то пошло не так.<br>
Но видимо, прислушаюсь, к совету про несколько VPS и понаблюдаю, спасибо.</p>
<p>У меня просто Амстердам самый быстрый из дома и из Москвы, привык уже к нему как-то.</p></td><td>2024-07-30T20:16:24.389Z</td></tr><tr><td>sevastianovv(Sevastianovv)</td><td><p>Привет. Покажи что куда дописывал. Спасибо</p></td><td>2024-07-31T10:42:00.275Z</td></tr><tr><td>Tyman</td><td><p>Уважаемый ValdikSS, огромное вам спасибо за созданный контейнер!</p>
<p>Хотел спросить, почему контейнер не обновляется с 2020 года, ведь antizapret-pac-generator-light обновляется регулярно.</p>
<p>Надеюсь вы не будете против, но хочу спросить, написал скрипт устанавливающий и применяющий патчи а так же разблокирующий ютуб, могу ли его выложить?</p>
<p>И еще вопрос, а где то ведутся внесудебные блокировки, типа заблокированных ua, <a href="http://digitalocean.com" rel="noopener nofollow ugc">digitalocean.com</a> и тд… мне кажется, я где то находил список, на гитхабе, но теперь не могу найти, подскажите если знаете, хочу адекватно наполнить include-hosts-custom.txt, спасибо!</p></td><td>2024-08-01T00:08:26.420Z</td></tr><tr><td>Xirurg</td><td><p>Вот тут все есть и youtube тоже<br>
<a href="https://github.com/xtrime-ru/antizapret-vpn-docker" rel="noopener nofollow ugc">Тык</a></p></td><td>2024-08-01T00:46:04.995Z</td></tr><tr><td>Tyman</td><td><aside class="quote no-group" data-username="Tyman" data-post="926" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/tyman/48/6894_2.png" class="avatar"> Tyman:</div>
<blockquote>
<p>antizapret-pac-generator-light</p>
</blockquote>
</aside>
<p>это видел, ну я без докера сделал</p></td><td>2024-08-01T00:51:39.149Z</td></tr><tr><td>DoplerEffect</td><td><p>будет как раз кстати , нужно переставить на новый хост антизапрет</p></td><td>2024-08-01T05:52:56.654Z</td></tr><tr><td>xtrime</td><td><p>У меня кстати проблема с youtube. Добавил <a href="http://youtube.com" rel="noopener nofollow ugc">youtube.com</a> и <a href="http://googlevideo.com" rel="noopener nofollow ugc">googlevideo.com</a> в include-hosts-custom.txt.<br>
На клиенте проверяю:</p>
<p><a href="http://googlevideo.com" rel="noopener nofollow ugc">googlevideo.com</a> - ок</p>
<pre><code class="lang-auto">nslookup googlevideo.com
Server:    192.168.1.1
Address 1: 192.168.1.1 RT-AX55-ABB8

Name:      googlevideo.com
Address 1: 10.224.2.250
</code></pre>
<p><a href="http://youtube.com" rel="noopener nofollow ugc">youtube.com</a> - не ок</p>
<pre><code class="lang-auto">nslookup youtube.com
Server:    192.168.1.1
Address 1: 192.168.1.1 RT-AX55-ABB8

Name:      youtube.com
Address 1: 216.58.212.142 fra16s46-in-f14.1e100.net
Address 2: 2a00:1450:4001:801::200e fra07s28-in-x200e.1e100.net
</code></pre>
<p>Как можно пофиксить такое поведение?</p>
<p>UPDATE: нашел, что <a href="http://youtube.com" rel="noopener nofollow ugc">youtube.com</a> исключается в exclude-hosts-dist.txt. Убрал оттуда - заработало!</p></td><td>2024-08-01T13:33:51.992Z</td></tr><tr><td>paweca</td><td><p>Насчет ChatGPT. Сайт работает. Приложение под Андроид нет. Может еще что-то нужно добавить?</p></td><td>2024-08-02T17:51:42.383Z</td></tr><tr><td>eliondel(Eliondel)</td><td><ol>
<li>А как убрать домены из exclude-hosts-dist.txt?<br>
Если убирать, то при рестарте контейнера домены там снова появляются.</li>
<li>Подскажите еще команду как применить настройки конфигов, а то я хост сейчас перезагружаю, что совсем не удобно.</li>
</ol></td><td>2024-08-03T06:51:43.177Z</td></tr><tr><td>gcetera(gcetera)</td><td><p>Попробовал поднять LXC  контейнер по инструкции на VPS Debian 11 c 2CPU 1Gb<br>
Все патчи поставил.<br>
и падает kresd</p>
<p>Stopped Knot Resolver daemon.<br>
kresd@1.service: Consumed 1.182s CPU time.<br>
kresd@1.service: Start request repeated too quickly.<br>
kresd@1.service: Failed with result ‘signal’.<br>
Failed to start Knot Resolver daemon.</p>
<p>Вот с такими настройками<br>
<a class="attachment" href="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/8hoJpQV3k0sEnaP8JoRds51mgh9.conf">kresd.conf</a> (1,5 КБ)</p>
<p>Есть обновить kresd он сбросит конфиг на дефолтный, и все запускается.</p></td><td>2024-08-03T09:50:08.556Z</td></tr><tr><td>mastrikGit(Mastrik Git)</td><td><p>чуть больше оперативы или своп на этапе инициализации контейнера</p></td><td>2024-08-03T19:57:07.799Z</td></tr><tr><td>sdbsm</td><td><p>всем привет, помогите разобраться плз. не открываются заблокированные сайты. пробую и из клиента ovpn и на микротике.<br>
если использую общедоступный антизапрет то все ок, и там и там. а вот на своем сервере - не работает почему-то.<br>
когда поднимаю соединение на микротике, то  вижу, что не поднимаются многие маршруты, как это происходит на общедоступном контейнере.<br>
интернет внутри контейнера проверил - есть, dns вроде резолвятся отовусюду</p></td><td>2024-08-04T18:27:25.114Z</td></tr><tr><td>spong(spong)</td><td><p>Я до сих пор не понимаю почему TCP поставили протоколом по умолчанию в openvpn в контейнере, его обычно используют когда udp блокируется, сами разработчики рекомендуют ставить UDP по-умолчанию. Если кто-то обладает сим тайным знанием прошу поделиться.</p></td><td>2024-08-05T10:23:29.868Z</td></tr><tr><td>Oless</td><td><p>Вечер добрый! Подскажите, плиз, есть у кого-то актуальный список хостов для Инстаграма, чтоб в include-hosts-custom.txt подкинуть?</p></td><td>2024-08-05T17:01:10.802Z</td></tr><tr><td>Anonimno(Anonimno)</td><td><aside class="quote no-group" data-username="Oless" data-post="937" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/o/b5ac83/48.png" class="avatar"> Oless:</div>
<blockquote>
<p>список хостов для Инстаграма</p>
</blockquote>
</aside>
<p>Можете брать <a href="https://github.com/StevenBlack/hosts/blob/8bb5a4f6e2a9f902f44623d1cdf533428bfa10b2/alternates/social-only/hosts#L1779C1-L1779C12">здесь</a>, правда это список для блокировки, ip 0.0.0.0 не копировать себе в конфиги.</p></td><td>2024-08-05T17:09:32.167Z</td></tr><tr><td>kirill</td><td><p>Вот и мне пришлось модифицировать для проксирования Youtube,<br>
причём исключительно потому, что все мои яндекс-модули вчера начали крутить ролики youtube в каком-то абсолютно шакальем качестве, хотя на смартфонах и домашнем компе у провайдера никаких проблем не наблюдается, а яндексовский саппорт отмораживается, что они там в своём приложении накуролесили, но не суть,</p>
<p>за основу взял этот пост</p><aside class="quote quote-modified" data-post="436" data-topic="129">
  <div class="title">
    <div class="quote-controls"></div>
    <img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/nzkhammatov/48/4650_2.png" class="avatar">
    <a href="https://ntc.party/t/%D0%BA%D0%BE%D0%BD%D1%82%D0%B5%D0%B9%D0%BD%D0%B5%D1%80-vpn-%D0%B0%D0%BD%D1%82%D0%B8%D0%B7%D0%B0%D0%BF%D1%80%D0%B5%D1%82%D0%B0-%D0%B4%D0%BB%D1%8F-%D1%83%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B8-%D0%BD%D0%B0-%D1%81%D0%BE%D0%B1%D1%81%D1%82%D0%B2%D0%B5%D0%BD%D0%BD%D1%8B%D0%B9-%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80/129/436">Контейнер VPN АнтиЗапрета для установки на собственный сервер</a> <a class="badge-category__wrapper " href="/c/antizapret-prostovpn-org/az-self-hosted/38"><span data-category-id="38" style="--category-badge-color: #0088CC; --category-badge-text-color: #FFFFFF; --parent-category-badge-color: #8C6238;" data-parent-category-id="5" data-drop-close="true" class="badge-category --has-parent" title="Вопросы и особенности работы контейнера VPN АнтиЗапрета на своих серверах"><span class="badge-category__name">АнтиЗапрет на собственном сервере (self-hosted)</span></span></a>
  </div>
  <blockquote>
    Добавить сюда 
/root/antizapret/config/include-hosts-custom.txt 
youtube.com
youtu.be
ytimg.com
ggpht.com
googleusercontent.com
googlevideo.com
google.com
googleapis.com

Удалить отсюда 
В скобках количество записей требующих удаления. 
/root/antizapret/config/exclude-hosts-dist.txt 
youtube.com (2)
youtu.be (1)
ytimg.com (3)
ggpht.com (2)
googleusercontent.com (1)
googlevideo.com (0)
google.com (0)
googleapis.com (0)

Тоже удалить 
/root/antizapret/config/exclude-regexp-dist.awk 

(/googleuserc…
  </blockquote>
</aside>
<p>
но чутка поправил с тем условием, что <a href="https://ntc.party/c/community-software/goodbyedpi/8">GoodbyeDPI</a> для этого использует лишь часть адресов исходного поста</p>
<p>итого получилось что:<br>
<code>lxc exec antizapret-vpn -- nano /root/antizapret/config/include-hosts-custom.txt</code></p>
<p>add:</p>
<pre><code class="lang-auto">youtube.com
youtu.be
googlevideo.com
ytimg.com
</code></pre>
<p><code>lxc exec antizapret-vpn -- nano /root/antizapret/config/exclude-hosts-dist.txt</code></p>
<p>было (но может я уже ранее чего и правил тут, не помню):</p>
<pre><code class="lang-auto">youtube.com
pornhub.com
navalny.zta.lk
youtube.com
youtu.be
ytimg.com
cloudfront.net
yt3.ggpht.com
yt4.ggpht.com
s.ytimg.com
i.ytimg.com
article31.club
akamaiedge.net
akamai.net
soupcdn.com
mediafire.com
pro100farma.net
segodel.com
15yo.ru
bethaze.ru
dabet.ru
zerkalo-tv.ru
nudism.ga
zenitbet44.com
leninjiv.com
1sx522.com
www.rutinadew.com
fespal.website
igrovyeavtomatynadengi.com
1-x520.com
e3b227af32e4d25d50.xyz
db534bb0cc17aa05bc.xyz
4f42f3b6338a06de4c.xyz
telemax-net.ru
ural.ru
coldfilm.ws
coldfilm.cc
coldfilm.ru
rt.pornhub.com
ru.pornhub.com
www.pornhub.com
</code></pre>
<p>стало:</p>
<pre><code class="lang-auto">pornhub.com
navalny.zta.lk
cloudfront.net
yt3.ggpht.com
yt4.ggpht.com
article31.club
akamaiedge.net
akamai.net
soupcdn.com
mediafire.com
pro100farma.net
segodel.com
15yo.ru
bethaze.ru
dabet.ru
zerkalo-tv.ru
nudism.ga
zenitbet44.com
leninjiv.com
1sx522.com
www.rutinadew.com
fespal.website
igrovyeavtomatynadengi.com
1-x520.com
e3b227af32e4d25d50.xyz
db534bb0cc17aa05bc.xyz
4f42f3b6338a06de4c.xyz
telemax-net.ru
ural.ru
coldfilm.ws
coldfilm.cc
coldfilm.ru
rt.pornhub.com
ru.pornhub.com
www.pornhub.com
</code></pre>
<p><code>lxc exec antizapret-vpn -- nano /root/antizapret/config/exclude-regexp-dist.awk</code><br>
<code>#(/googleusercontent\.com/) {next}</code><br>
но это у меня уже было сделано для какого-то твика уже ранее</p>
<p><code>lxc exec antizapret-vpn -- sh -c "LANG=C.UTF-8 /root/antizapret/doall.sh"</code><br>
<code>lxc exec antizapret-vpn -- sh -c "echo 'cache.clear()' | socat - /run/knot-resolver/control/1"</code></p>
<p>и теперь всё вроде ок, если можно так назвать,<br>
имея гигабитный интернет и пускать поток через проксю, но уж так и живём, что делать</p></td><td>2024-08-06T20:45:43.645Z</td></tr><tr><td>nzkhammatov(Ainur Khammatov)</td><td><aside class="quote" data-post="906" data-topic="129">
  <div class="title">
    <div class="quote-controls"></div>
    <img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/nzkhammatov/48/4650_2.png" class="avatar">
    <a href="https://ntc.party/t/129/906">Контейнер VPN АнтиЗапрета для установки на собственный сервер</a> <a class="badge-category__wrapper " href="/c/antizapret-prostovpn-org/az-self-hosted/38"><span data-category-id="38" style="--category-badge-color: #0088CC; --category-badge-text-color: #FFFFFF; --parent-category-badge-color: #8C6238;" data-parent-category-id="5" data-drop-close="true" class="badge-category --has-parent" title="Вопросы и особенности работы контейнера VPN АнтиЗапрета на своих серверах"><span class="badge-category__name">АнтиЗапрет на собственном сервере (self-hosted)</span></span></a>
  </div>
  <blockquote>
    Похожая ситуация разрешилась так 
<details><summary>Добавить через пробел, если что-то уже есть в строке</summary>GRUB_CMDLINE_LINUX_DEFAULT="quiet splash ipv6.disable=1"
GRUB_CMDLINE_LINUX="ipv6.disable=1"</details>
nano /etc/default/grub 

ipv6.disable=1 

GRUB_CMDLINE_LINUX_DEFAULT="ipv6.disable=1"
GRUB_CMDLINE_LINUX="ipv6.disable=1"

update-grub 
shutdown -r 0
  </blockquote>
</aside>

<p><strong>Блокировать quic, если плохо работает Instagram.</strong></p>
<pre><code class="lang-auto">iptables -A OUTPUT -p udp -m udp --dport 80 -j DROP
iptables -A OUTPUT -p udp -m udp --dport 443 -j DROP
</code></pre>
<div class="spoiler">
<p>Тормозит Instagram, Лагает Instagram, Тупит Instagram.</p>
</div></td><td>2024-08-07T04:24:20.231Z</td></tr><tr><td>xtrime</td><td><p>Оптимизировал старт своего контейнера, теперь он отвечает на запросы примерно через 2-3 секунды после запуска/перезапуска, а не через пару минут.</p>
<ol>
<li>При сборке образа сразу генерирую правила для kresd, что бы можно было запускать kresd на старте контейнера: <a href="https://github.com/xtrime-ru/antizapret-vpn-docker/commit/bb182cf53ed41ed0528b756558b1734080cdeb2b" class="inline-onebox" rel="noopener nofollow ugc">Opt: container ready immediately after start · xtrime-ru/antizapret-vpn-docker@bb182cf · GitHub</a></li>
<li>Выключил проверку сети, так как она в контейнере падает по таймауту и только тормозит запуск остальных процессов: <a href="https://github.com/xtrime-ru/antizapret-vpn-docker/commit/f857023a6e5d02c0ab8ebaa24f8da6f0470e53dc#diff-222623b6a29fdea6e66ad25d2e60a0d2d3002c374c1b08f3f6890345400222c4R22" class="inline-onebox" rel="noopener nofollow ugc">Opt: Speedup container start · xtrime-ru/antizapret-vpn-docker@f857023 · GitHub</a></li>
</ol>
<p>Наверное можно перенести в основной образ, думаю полезно будет.</p></td><td>2024-08-08T19:25:11.346Z</td></tr><tr><td>Lodeon(Lodeon)</td><td><p>Не резолвятся заблокированные домены</p>
<p>патч ставил</p>
<pre><code class="lang-auto">nslookup linkedin.com
╤хЁтхЁ:  UnKnown
Address:  192.168.104.1

DNS request timed out.
    timeout was 2 seconds.
*** UnKnown не удалось найти linkedin.com: Server failed

C:\Users\Den&gt;nslookup linkedin.com
╤хЁтхЁ:  UnKnown
Address:  192.168.104.1

DNS request timed out.
    timeout was 2 seconds.
DNS request timed out.
    timeout was 2 seconds.
DNS request timed out.
    timeout was 2 seconds.
*** Превышено время ожидания запроса UnKnown
</code></pre>
<p>из контейнера diag до яндекса в пределах нормы, до заблокированных SERVFAIL</p>
<pre><code class="lang-auto">dig ya.ru @127.0.0.1

; &lt;&lt;&gt;&gt; DiG 9.11.5-P4-5.1+deb10u1-Debian &lt;&lt;&gt;&gt; ya.ru @127.0.0.1
;; global options: +cmd
;; Got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 38233
;; flags: qr rd ra; QUERY: 1, ANSWER: 3, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 4096
;; QUESTION SECTION:
;ya.ru.                         IN      A

;; ANSWER SECTION:
ya.ru.                  600     IN      A       5.255.255.242
ya.ru.                  600     IN      A       77.88.44.242
ya.ru.                  600     IN      A       77.88.55.242

;; Query time: 86 msec
;; SERVER: 127.0.0.1#53(127.0.0.1)
;; WHEN: Fri Aug 09 04:44:54 MSK 2024
;; MSG SIZE  rcvd: 82


dig linkedin.com @127.0.0.1

; &lt;&lt;&gt;&gt; DiG 9.11.5-P4-5.1+deb10u1-Debian &lt;&lt;&gt;&gt; linkedin.com @127.0.0.1
;; global options: +cmd
;; Got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: SERVFAIL, id: 15433
;; flags: qr rd ra; QUERY: 1, ANSWER: 0, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 4096
;; QUESTION SECTION:
;linkedin.com.                  IN      A

;; Query time: 1838 msec
;; SERVER: 127.0.0.1#53(127.0.0.1)
;; WHEN: Fri Aug 09 04:45:57 MSK 2024
;; MSG SIZE  rcvd: 41

</code></pre>
<p>systemctl status kresd@1</p>
<pre><code class="lang-auto">systemctl status kresd@1
● kresd@1.service - Knot Resolver daemon
   Loaded: loaded (/lib/systemd/system/kresd@.service; enabled; vendor preset: enabled)
  Drop-In: /etc/systemd/system/kresd@.service.d
           └─override.conf
   Active: active (running) since Fri 2024-08-09 04:37:07 MSK; 9min ago
     Docs: man:kresd.systemd(7)
           man:kresd(8)
 Main PID: 204 (kresd)
    Tasks: 1 (limit: 19118)
   Memory: 496.6M
   CGroup: /system.slice/system-kresd.slice/kresd@1.service
           └─204 /usr/sbin/kresd -c /usr/lib/knot-resolver/distro-preconfig.lua -c /etc/knot-resolver/
kresd.conf -n

Aug 09 04:36:48 antizapret-vpn systemd[1]: Starting Knot Resolver daemon...
Aug 09 04:36:48 antizapret-vpn kresd[204]: [system] warning: hard limit for number of file-descriptors
 is only 65535 but recommended value is 524288
Aug 09 04:37:07 antizapret-vpn systemd[1]: Started Knot Resolver daemon.

</code></pre></td><td>2024-08-09T01:48:02.792Z</td></tr><tr><td>h7n14(H7n14je)</td><td><p>А имеет ли смысл в config.sh ставить RESOLVE_NXDOMAIN=“yes”?<br>
Да, конечно оно кратно дольше обрабатывает, но при этом у меня примерно от 850мб до 710мб упало общее потребление оперативки🤔. Пишет что Finally, got 73996 broken domains из 214275.<br>
Или может он как-то неправильно у меня работает?</p>
<p>И еще один вопрос появился😅.<br>
Я не силен в баше, просто вижу что есть комменты в списках исключения например в  exclude-hosts-dist.txt</p>
<pre><code class="lang-auto"># NOTE: only ZONES should be here. Not subdomains.
</code></pre>
<p>Но таких не вижу в списках включения. Да и беглым взглядом на parse.sh и getzone.awk с exclude-regexp-dist.awk не вижу удаление строк начинающихся на #. т.е. я правильно понимаю что если в include-hosts-custom.txt я начну делать комменты то оно сломается/неправильно обработает и все будет плохо?</p></td><td>2024-08-09T04:09:14.728Z</td></tr><tr><td>Lodeon(Lodeon)</td><td><p>Ситуация с тем что у меня не работает Knot Resolver не разрешилась</p>
<p>Пробовал и вместо  Ubuntu 20.04. - Ubuntu 22.04</p>
<p>Вместо LXD -  systemd-container</p>
<p>затык всегда один</p>
<p>root@antizapret-vpn:~# nslookup <a href="http://instagram.com" rel="noopener nofollow ugc">instagram.com</a> 127.0.0.1<br>
Server:         127.0.0.1<br>
Address:        127.0.0.1#53</p>
<p>** server can’t find <a href="http://instagram.com" rel="noopener nofollow ugc">instagram.com</a>: SERVFAIL</p>
<p>а демон Knot Resolver живой, как в моем посте выше</p>
<p>Как его диагностировать? уже все перепробовал</p>
<p>из полезного, может кому пригодиться <strong>при простом apt update Knot Resolver не обновится</strong></p>
<p>the package signing key for our upstream repositories has expired and Debian and Ubuntu users with existing installation need to manually update the knot-resolver-release package to fix the issue:</p>
<pre><code class="lang-auto">wget https://secure.nic.cz/files/knot-resolver/knot-resolver-release.deb 
dpkg -i knot-resolver-release.deb 
apt update
</code></pre></td><td>2024-08-09T11:33:26.509Z</td></tr><tr><td>xtrime</td><td><aside class="quote no-group" data-username="Lodeon" data-post="944" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/l/13edae/48.png" class="avatar"> Lodeon:</div>
<blockquote>
<p>Ситуация с тем что у меня не работает Knot Resolver не разрешилась</p>
</blockquote>
</aside>
<p>А почему ты думаешь что он не работает? Внутри контейнера dig <a href="http://linkedin.com" rel="noopener nofollow ugc">linkedin.com</a> <span class="mention">@127.0.0.1</span> что выдает?</p></td><td>2024-08-09T15:45:22.042Z</td></tr><tr><td>Lodeon(Lodeon)</td><td><aside class="quote no-group" data-username="Lodeon" data-post="942" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/l/13edae/48.png" class="avatar"> Lodeon:</div>
<blockquote>
<pre><code class="lang-auto">dig linkedin.com @127.0.0.1

; &lt;&lt;&gt;&gt; DiG 9.11.5-P4-5.1+deb10u1-Debian &lt;&lt;&gt;&gt; linkedin.com @127.0.0.1
;; global options: +cmd
;; Got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: SERVFAIL, id: 15433
;; flags: qr rd ra; QUERY: 1, ANSWER: 0, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 4096
;; QUESTION SECTION:
;linkedin.com.                  IN      A

;; Query time: 1838 msec
;; SERVER: 127.0.0.1#53(127.0.0.1)
;; WHEN: Fri Aug 09 04:45:57 MSK 2024
;; MSG SIZE  rcvd: 41
</code></pre>
</blockquote>
</aside>
<p>потому что вот так отдает -  SERVFAIL</p>
<p>dig <a href="http://linkedin.com" rel="noopener nofollow ugc">linkedin.com</a> <span class="mention">@127.0.0.1</span></p>
<p>; &lt;&lt;&gt;&gt; DiG 9.11.5-P4-5.1+deb10u1-Debian &lt;&lt;&gt;&gt; <a href="http://linkedin.com" rel="noopener nofollow ugc">linkedin.com</a> <span class="mention">@127.0.0.1</span><br>
;; global options: +cmd<br>
;; Got answer:<br>
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: SERVFAIL, id: 15433<br>
;; flags: qr rd ra; QUERY: 1, ANSWER: 0, AUTHORITY: 0, ADDITIONAL: 1</p>
<p>;; OPT PSEUDOSECTION:<br>
; EDNS: version: 0, flags:; udp: 4096<br>
;; QUESTION SECTION:<br>
;<a href="http://linkedin.com" rel="noopener nofollow ugc">linkedin.com</a>.                  IN      A</p>
<p>;; Query time: 1838 msec<br>
;; SERVER: 127.0.0.1#53(127.0.0.1)<br>
;; WHEN: Fri Aug 09 04:45:57 MSK 2024<br>
;; MSG SIZE  rcvd: 41</p></td><td>2024-08-09T16:04:17.154Z</td></tr><tr><td>xtrime</td><td><p>А, я не проскролил в оригинальном сообщении лог.</p>
<p>А заблокированные сайты на сервере открываются?</p>
<pre><code class="lang-auto">dig linkedin.com @8.8.8.8
</code></pre></td><td>2024-08-09T16:07:53.109Z</td></tr><tr><td>Lodeon(Lodeon)</td><td><p>да, открываются</p></td><td>2024-08-09T16:08:56.499Z</td></tr><tr><td>xtrime</td><td><p>В /etc/knot-resolver/knot-aliases-alt.conf есть список вида</p>
<pre><code class="lang-auto">blocked_hosts = {
   'example.ru.',
   ...
}
</code></pre>
<p>?</p></td><td>2024-08-09T16:12:34.728Z</td></tr><tr><td>Lodeon(Lodeon)</td><td><p>есть</p>
<p>я сейчас попробую скриптом поставить от Tyman’a</p></td><td>2024-08-09T16:14:07.419Z</td></tr><tr><td>xtrime</td><td><aside class="quote no-group" data-username="Lodeon" data-post="950" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/l/13edae/48.png" class="avatar"> Lodeon:</div>
<blockquote>
<p>я сейчас попробую скриптом поставить от Tyman’a</p>
</blockquote>
</aside>
<p>Ну уж тогда мой докер попробуй. Там базовая система ubuntu24.04 вместо старого debian 10 и докер вместо lxc. Хоть какая то разница.</p>
<aside class="onebox githubrepo" data-onebox-src="https://github.com/xtrime-ru/antizapret-vpn-docker">
  <header class="source">

      <a href="https://github.com/xtrime-ru/antizapret-vpn-docker" target="_blank" rel="noopener">github.com</a>
  </header>

  <article class="onebox-body">
    <div class="github-row" data-github-private-repo="false">
  <img width="690" height="344" src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/3f4178cf7cc0e54e77da75dbf645e8b493f49c39_2_690x344.png" class="thumbnail" data-dominant-color="EBEDED">

  <h3><a href="https://github.com/xtrime-ru/antizapret-vpn-docker" target="_blank" rel="noopener">GitHub - xtrime-ru/antizapret-vpn-docker: Docker container with antizapret-vpn for...</a></h3>

    <p><span class="github-repo-description">Docker container with antizapret-vpn for selfhosting.</span></p>
</div>

  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>
</td><td>2024-08-09T16:16:27.077Z</td></tr><tr><td>FyZzyss(FyZzyss)</td><td><p>Спасибо! У меня заработало хорошо на ASUS AX88U, но только tcp версия. Udp не работает</p></td><td>2024-08-10T16:25:09.278Z</td></tr><tr><td>xtrime</td><td><p>А что в логах?</p>
<pre data-code-wrap="shell"><code class="lang-shell">docker exec antizapret-vpn systemctl restart openvpn-server@antizapret
docker exec antizapret-vpn journalctl -u openvpn-server@antizapret
</code></pre>
<p>И в логи роутера тоже нужны</p></td><td>2024-08-10T16:47:53.007Z</td></tr><tr><td>spong(spong)</td><td><p>Подскажите а где взять раздельные файлы для микротика client-shared.crt и client-shared.key? А то по умолчанию в одном конфиге всё?</p></td><td>2024-08-12T13:07:05.863Z</td></tr><tr><td>alexalex</td><td><p>2 варианта -</p>
<ol>
<li>Импортировать конфиг в микротик.</li>
<li>Ctr-C → Ctrl-V из конфига в файлы и сохранить</li>
</ol></td><td>2024-08-12T16:12:09.227Z</td></tr><tr><td>Mr.Alex</td><td><p>Когда будет следующее обновление контейнера? knot-resolver уже жалуется на старые ключи</p></td><td>2024-08-12T18:20:11.297Z</td></tr><tr><td>Vazelinchik</td><td><p>Я вытаскивал с сервера сначала на комп через FileZilla, потом импортировал на микрот. Файлы находятся в antizapret-vpn/root/easy-rsa-ipsec/CLIENT_KEY/antizapret-client-udp.ovpn или antizapret-vpn/root/easy-rsa-ipsec/CLIENT_KEY/antizapret-client-tcp.ovpn (разумеется внутри контейнера, добавить команду для переноса в хостовую систему, я делал через sudo lxc file pull). В целом можно было бы как товарищ <a class="mention" href="/u/alexalex">@alexalex</a> описал через файл конфига, но я решил все усложнить</p></td><td>2024-08-12T20:34:22.831Z</td></tr><tr><td>alexalex</td><td><p>Издалека тащили )) Если ставить контейнер по инструкции отсюда - <a href="https://bitbucket.org/anticensority/antizapret-vpn-container/src/" class="inline-onebox" rel="noopener nofollow ugc">Bitbucket</a> - конфиг openvpn оказывается там, откуда запускали установку. В моем случае в /root VPSки</p></td><td>2024-08-12T22:35:42.874Z</td></tr><tr><td>dennis(denis)</td><td><p>Господа, а можно в контейнер пропихнуть версию openvpn-сервера с поддержкой xor (Tunnelblick obfuscation patch)?</p></td><td>2024-08-17T05:47:28.061Z</td></tr><tr><td>xtrime</td><td><aside class="quote no-group" data-username="dennis" data-post="959" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/d/e56c9b/48.png" class="avatar"> dennis:</div>
<blockquote>
<p>ропихнуть версию openvpn-сервера с поддержкой xor</p>
</blockquote>
</aside>
<p>Речь про эти патчи? Ща попробую добавить к себе в образ установку. <a href="https://github.com/Tunnelblick/Tunnelblick/tree/master/third_party/sources/openvpn/openvpn-2.6.12/patches" class="inline-onebox">Tunnelblick/third_party/sources/openvpn/openvpn-2.6.12/patches at master · Tunnelblick/Tunnelblick · GitHub</a></p></td><td>2024-08-18T15:50:31.413Z</td></tr><tr><td>Xirurg</td><td><p>Вопрос , vps в Хельсинки  , 99% заблокированных сайтов работает , НО<br>
<a href="http://game.brawlstarsgame.com" class="onebox" target="_blank" rel="noopener nofollow ugc">game.brawlstarsgame.com</a><br>
*<a href="http://ingest.sentry.io" rel="noopener nofollow ugc">ingest.sentry.io</a><br>
<a href="http://game-assets.clashofclans.com" rel="noopener nofollow ugc">game-assets.clashofclans.com</a><br>
<a href="http://gamea.clashofclans.com" rel="noopener nofollow ugc">gamea.clashofclans.com</a><br>
<a href="http://clashofclans.inbox.supercell.com" rel="noopener nofollow ugc">clashofclans.inbox.supercell.com</a><br>
<a href="http://supercell.com" rel="noopener nofollow ugc">supercell.com</a><br>
<a href="http://game.clashroyaleapp.com" rel="noopener nofollow ugc">game.clashroyaleapp.com</a><br>
<a href="http://brawlstars.com" rel="noopener nofollow ugc">brawlstars.com</a></p>
<p>Сую в include-hosts-custom.txt  , толку нет , заблокированно  для России . Если ip vps не полностью светится  как Хельсинки , антизапрет не поможет  обмануть  местонахождение ?</p></td><td>2024-08-18T18:16:02.518Z</td></tr><tr><td>dennis(denis)</td><td><p>Да, он самый. На непропатченном клиенте openvpn не меняет поведение, на патченном - по идее должен меньше ловиться DPI (но это не точно, хочу проверить).</p>
<aside class="onebox allowlistedgeneric" data-onebox-src="https://tunnelblick.net/cOpenvpn_xorpatch.html">
  <header class="source">
      <img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/e66bbe1b2771eb2c3ce655fdf18c5c4d178e91db.png" class="site-icon" data-dominant-color="000000" width="32" height="32">

      <a href="https://tunnelblick.net/cOpenvpn_xorpatch.html" target="_blank" rel="noopener nofollow ugc">tunnelblick.net</a>
  </header>

  <article class="onebox-body">
    

<h3><a href="https://tunnelblick.net/cOpenvpn_xorpatch.html" target="_blank" rel="noopener nofollow ugc">Tunnelblick and openvpn_xorpatch - Tunnelblick | Free open source OpenVPN VPN...</a></h3>

  <p>Tunnelblick and openvpn_xorpatch - Tunnelblick | Free open source OpenVPN VPN client server software GUI for Mac OS X.. Includes OpenVPN, OpenSSL, easy-rsa, and drivers.</p>


  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>
</td><td>2024-08-18T19:08:54.937Z</td></tr><tr><td>Silent</td><td><p>хостинг случаем не с оплатой ру-картами? похоже есть как-то geoip база, где подобные “нерусские” хостеры присутствуют<br>
<div class="lightbox-wrapper"><a class="lightbox" href="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/d24d354533cf67a5316c7dbc4b0d0b034aa9a7da.png" data-download-href="https://ntc.party/uploads/default/d24d354533cf67a5316c7dbc4b0d0b034aa9a7da" title="image"><img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/d24d354533cf67a5316c7dbc4b0d0b034aa9a7da.png" alt="image" data-base62-sha1="u0pGymnDT987Ph5RwIgmARfuHjQ" width="376" height="500" data-dominant-color="F5F5EB"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">453×601 5.12 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div><br>
например hostvds…аля фино-чешские казахи с регистрацией в гонконге)</p></td><td>2024-08-18T19:39:30.827Z</td></tr><tr><td>Xirurg</td><td><p>Он самый. Взял у них амстердам , теперь все ок , Хельсинки  подвели.</p></td><td>2024-08-18T20:22:08.309Z</td></tr><tr><td>xtrime</td><td><p>Добавил в dev ветку: <a href="https://github.com/xtrime-ru/antizapret-vpn-docker/commit/e48c20bcdbddc9f29a21a945f8dacfa9124239db" class="inline-onebox">Feat: xor patches for openvpn · xtrime-ru/antizapret-vpn-docker@e48c20b · GitHub</a></p>
<p>Надеюсь завтра протестирую и релизну. А что в конфиги сервера и клиента надо прописать?</p></td><td>2024-08-18T21:48:44.014Z</td></tr><tr><td>dennis(denis)</td><td><h2><a name="p-33938-scramble-option-syntax-1" class="anchor" href="#p-33938-scramble-option-syntax-1"></a>Scramble Option Syntax</h2>
<p>Note: The “scramble” option and parameters in the server and client configuration files must match.</p>
<p>scramble <em>xor_string</em><br>
scramble xormask <em>xor_string</em><br>
These options XOR the bytes in each buffer with <em>xor_string</em>.</p>
<p>scramble reverse<br>
The “reverse” option reverses order of the bytes in each buffer (except that the first byte is unchanged). So “abcde” becomes “aedcb”.</p>
<p>scramble xorptrpos<br>
The “xorptrpos” option XORs each byte of the buffer of traffic with the position in the buffer.</p>
<p>scramble obfuscate <em>password</em><br>
The “obfuscate” option performs several of the above steps, using <em>password</em> as the <em>xor_string</em> in one of the steps.</p></td><td>2024-08-19T04:27:50.152Z</td></tr><tr><td>xtrime</td><td><aside class="quote no-group" data-username="dennis" data-post="966" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/d/e56c9b/48.png" class="avatar"> dennis:</div>
<blockquote>
<p>Scramble Option Syntax</p>
</blockquote>
</aside>
<p>Спасибо! Так что именно из этого выбирать? И стоит ли включать по умолчанию для всех или ENV параметр добавлять?</p></td><td>2024-08-19T09:31:54.464Z</td></tr><tr><td>dennis(denis)</td><td><aside class="quote no-group" data-username="dennis" data-post="966" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/d/e56c9b/48.png" class="avatar"> dennis:</div>
<blockquote>
<p>scramble xorma</p>
</blockquote>
</aside>
<p>Экспериментировать надо)<br>
Я думаю ничего по умолчанию включать не надо, т.к. включение может повлиять на способность соединяться на непатченных клиентах.<br>
Знающие сами зайдут в контейнер и поправят конфиги в /etc/openvpn/server</p></td><td>2024-08-19T09:35:41.810Z</td></tr><tr><td>xtrime</td><td><aside class="quote no-group" data-username="dennis" data-post="966" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/d/e56c9b/48.png" class="avatar"> dennis:</div>
<blockquote>
<p>Scramble Option Syntax</p>
</blockquote>
</aside>
<p>Добавили <a href="https://github.com/xtrime-ru/antizapret-vpn-docker/releases/tag/v3.1.0" class="inline-onebox">Release v3.1.0 · xtrime-ru/antizapret-vpn-docker · GitHub</a><br>
Включать ENV переменной SCRUMBLE=1<br>
У <a class="mention" href="/u/flameshikari">@flameshikari</a> на мобильном интернете заработал openvpn с этой штукой!</p></td><td>2024-08-19T22:21:39.804Z</td></tr><tr><td>vlacek(Vlacek)</td><td><p>Всем привет! Self-Hosted сервер. Исключения.</p>
<p>Столкнулся со странным.<br>
Люблю читать зеркало двача - архивач, и у нас оно забанено, но не забанены его хранилища медиа. В общем, одна часть медиа лежит на arhivach.xyz, другая на i.arhivach.xyz. Добавил и тот и другой домен в include-hosts-custom.txt, и один начал отвечать через 10.224.x.x, а второй ни в какую - всегда пингуется публичный 141.105.130.22. Что я делаю не так? <img src="https://ntc.party/images/emoji/twitter/slight_smile.png?v=12" title=":slight_smile:" class="emoji" alt=":slight_smile:" loading="lazy" width="20" height="20"></p></td><td>2024-08-19T22:37:09.479Z</td></tr><tr><td>xtrime</td><td><p>Проблема может быть в кеше. Он хранится 2 минуты и не сбрасывается при перезапуске.</p>
<p>Еще один вариант: для доменов третьего уровня плохо работают правила в txt файлах. Там какая то логика в скриптах, по которой только домены 2 и 1 уровней вытаскиваются.</p>
<p>Надежнее напрямую править kresd.conf.</p>
<p>В своем контейнере сделал поддержку regex правил которые напрямую передаются в kresd.conf и там обрабатываются в коллбеке: <a href="https://github.com/xtrime-ru/antizapret-vpn-docker/blob/master/rootfs/etc/knot-resolver/kresd.conf#L71" class="inline-onebox">antizapret-vpn-docker/rootfs/etc/knot-resolver/kresd.conf at master · xtrime-ru/antizapret-vpn-docker · GitHub</a></p>
<p>Работает с доменами третьего уровня без неожиданностей:<br>
<div class="lightbox-wrapper"><a class="lightbox" href="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/361e433853c1aa558e57d5597c2bb65c786fd247.png" data-download-href="https://ntc.party/uploads/default/361e433853c1aa558e57d5597c2bb65c786fd247" title="image"><img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/361e433853c1aa558e57d5597c2bb65c786fd247_2_690x469.png" alt="image" data-base62-sha1="7IKCtTcMnUbR1tq41J701qzXWNF" width="690" height="469" srcset="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/361e433853c1aa558e57d5597c2bb65c786fd247_2_690x469.png, контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/361e433853c1aa558e57d5597c2bb65c786fd247_2_1035x703.png 1.5x, контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/361e433853c1aa558e57d5597c2bb65c786fd247.png 2x" data-dominant-color="26282D"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">1050×714 42.1 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div><br>
<div class="lightbox-wrapper"><a class="lightbox" href="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/fd79a9d474fc727685cae05314d397c363d1bf7a.png" data-download-href="https://ntc.party/uploads/default/fd79a9d474fc727685cae05314d397c363d1bf7a" title="Снимок экрана 2024-08-20 в 01.00.41"><img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/fd79a9d474fc727685cae05314d397c363d1bf7a_2_690x478.png" alt="Снимок экрана 2024-08-20 в 01.00.41" data-base62-sha1="AalsGqT8JWYxi48TqvvtG9WHVii" width="690" height="478" srcset="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/fd79a9d474fc727685cae05314d397c363d1bf7a_2_690x478.png, контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/fd79a9d474fc727685cae05314d397c363d1bf7a.png 1.5x, контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/fd79a9d474fc727685cae05314d397c363d1bf7a.png 2x" data-dominant-color="27292E"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">Снимок экрана 2024-08-20 в 01.00.41</span><span class="informations">970×672 40.6 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p></td><td>2024-08-19T22:45:35.799Z</td></tr><tr><td>bync(Ole)</td><td><aside class="quote no-group" data-username="xtrime" data-post="951" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/xtrime/48/1524_2.png" class="avatar"> xtrime:</div>
<blockquote>
<p>тогда мой докер попробуй</p>
</blockquote>
</aside>
<p>спасибо тебе мил человек за работу! очень удобно ставить все “в один клик”</p></td><td>2024-08-20T10:31:27.689Z</td></tr><tr><td>bync(Ole)</td><td><aside class="quote no-group" data-username="xtrime" data-post="969" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/xtrime/48/1524_2.png" class="avatar"> xtrime:</div>
<blockquote>
<p>Включать ENV переменной SCRUMBLE=1</p>
</blockquote>
</aside>
<p>А где это нужно проделать?</p></td><td>2024-08-20T10:38:29.690Z</td></tr><tr><td>xtrime</td><td><aside class="quote no-group" data-username="bync" data-post="973" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/b/e56c9b/48.png" class="avatar"> bync:</div>
<blockquote>
<p>А где это нужно проделать?</p>
</blockquote>
</aside>
<p><a href="https://github.com/xtrime-ru/antizapret-vpn-docker/blob/master/docker-compose.yml#L13" class="inline-onebox">antizapret-vpn-docker/docker-compose.yml at master · xtrime-ru/antizapret-vpn-docker · GitHub</a> - в этой строке дописать <code>=1</code>, перезапустить контейнер, скачать новые конфиги для подключения. Но нужен клиент tunnelblick.</p></td><td>2024-08-20T11:38:01.834Z</td></tr><tr><td>morpheus11(Morpheus)</td><td><p>Дядя Саша, скачал  Ваш дистрибутив поднял контейнер все заработало - зашел во внутрь - начал искать файлы ovpn, и не нашел(((<br>
Где их искать, подскажи пжл - я просто из деревни))</p></td><td>2024-08-20T22:25:20.435Z</td></tr><tr><td>xtrime</td><td><aside class="quote no-group" data-username="morpheus11" data-post="975" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/morpheus11/48/6962_2.png" class="avatar"> morpheus11:</div>
<blockquote>
<p>Где их искать, подскажи пжл - я просто из деревни))</p>
</blockquote>
</aside>
<p>У нас все для людей. Внутрь лезьть не надо. Они в папке <code>./keys/client</code>. Списки для ручного добавления доменов в папке <code>./config</code><br>
<div class="lightbox-wrapper"><a class="lightbox" href="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/fe56b8b8201a77f9d168d051f6c1e6a6194f7ffe.png" data-download-href="https://ntc.party/uploads/default/fe56b8b8201a77f9d168d051f6c1e6a6194f7ffe" title="Снимок экрана 2024-08-21 в 10.28.50"><img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/fe56b8b8201a77f9d168d051f6c1e6a6194f7ffe_2_325x500.png" alt="Снимок экрана 2024-08-21 в 10.28.50" data-base62-sha1="AhZ4Od7hZtIgIhyjkTCgf6muTzU" width="325" height="500" srcset="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/fe56b8b8201a77f9d168d051f6c1e6a6194f7ffe_2_325x500.png, контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/fe56b8b8201a77f9d168d051f6c1e6a6194f7ffe_2_487x750.png 1.5x, контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/fe56b8b8201a77f9d168d051f6c1e6a6194f7ffe.png 2x" data-dominant-color="2E3133"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">Снимок экрана 2024-08-21 в 10.28.50</span><span class="informations">636×978 104 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p></td><td>2024-08-21T08:29:34.292Z</td></tr><tr><td>bync(Ole)</td><td><aside class="quote no-group" data-username="xtrime" data-post="976" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/xtrime/48/1524_2.png" class="avatar"> xtrime:</div>
<blockquote>
<p>Списки для ручного добавления доменов в папке <code>./config</code></p>
</blockquote>
</aside>
<p>а как запускать doall.sh в вашем контейнере?</p></td><td>2024-08-22T07:17:49.615Z</td></tr><tr><td>xtrime</td><td><aside class="quote no-group" data-username="bync" data-post="977" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/b/e56c9b/48.png" class="avatar"> bync:</div>
<blockquote>
<p>а как запускать doall.sh в вашем контейнере?</p>
</blockquote>
</aside>
<p>Достаточно перезапустить контейнер и он сразу запустится: docker compose restart. Ну или<br>
docker compose exec -it antizapret-vpn /root/antizapret/doall.sh</p></td><td>2024-08-22T08:09:03.189Z</td></tr><tr><td>bync(Ole)</td><td><p>Понял, благодарю!</p></td><td>2024-08-22T08:15:26.584Z</td></tr><tr><td>bync(Ole)</td><td><p>попробовал наконец-то перезапустить контейнер:<br>
root@server:~# docker compose restart<br>
no configuration file provided: not found</p></td><td>2024-08-23T12:32:53.869Z</td></tr><tr><td>xtrime</td><td><aside class="quote no-group" data-username="bync" data-post="980" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/b/e56c9b/48.png" class="avatar"> bync:</div>
<blockquote>
<p>no configuration file provided: not found</p>
</blockquote>
</aside>
<p>Команду docker compose надо выполнять в папке проекта, так как ей для работы нужен файл docker-compose.yml</p>
<p>Можно перезапускать указывая имя контейнера <code>docker restart antizapret-vpn</code></p></td><td>2024-08-23T12:38:11.587Z</td></tr><tr><td>bync(Ole)</td><td><aside class="quote no-group" data-username="xtrime" data-post="981" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/xtrime/48/1524_2.png" class="avatar"> xtrime:</div>
<blockquote>
<p>Команду docker compose надо выполнять в папке проекта</p>
</blockquote>
</aside>
<p>не знал, спасибо, а до</p>
<aside class="quote no-group" data-username="xtrime" data-post="981" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/xtrime/48/1524_2.png" class="avatar"> xtrime:</div>
<blockquote>
<p>docker restart antizapret-vpn</p>
</blockquote>
</aside>
<p>смог сам додуматься по аналогии с lxd)</p></td><td>2024-08-23T12:39:19.585Z</td></tr><tr><td>OneTema</td><td><p>Здравствуйте.<br>
Не нашел ответ.<br>
Какие системные требования для сервера под контейнер?<br>
Какая ОС и версия ? в как4ойто теме написано только debian 12<br>
проц:? чистота , ядра<br>
Оперативка : Гигов ?<br>
Диск :?</p>
<p>Может еще что то ?<br>
Спасибо</p></td><td>2024-08-24T08:07:13.470Z</td></tr><tr><td>AlyoshinAleksey(Alyoshin Aleksey)</td><td><p>Здравствуйте! А можно как-то добавить адрес <a href="http://intel.com" rel="noopener nofollow ugc">intel.com</a>, что бы он думал что я в другой стране? Выделенный сервер имеется в британии</p></td><td>2024-08-24T12:24:27.925Z</td></tr><tr><td>kirill</td><td><p>у меня Ubuntu 22.04, 1 CPU, 1 Гб RAM, NVMe, плюс zram-config</p>
<p>работает нормально</p></td><td>2024-08-24T19:40:45.716Z</td></tr><tr><td>kirill</td><td><p><code>lxc exec antizapret-vpn -- nano /root/antizapret/config/include-hosts-custom.txt</code></p></td><td>2024-08-24T19:43:49.415Z</td></tr><tr><td>alexunderboots(alexunderboots)</td><td><p>Поднял на микротике клиента, работает только с эксклюзивным Peer DNS, при этом половина сайтов перестало открываться — github, duckduck и тд<br>
Отключаю эксклюзивный режим — трафик для обхода в туннель не идёт (((((</p></td><td>2024-08-24T20:46:16.469Z</td></tr><tr><td>abugray(Georgy)</td><td><p>Попробовал так в докер версии:</p>
<pre><code class="lang-auto">services:
  antizapret-vpn:
    image: xtrime/antizapret-vpn:latest
    container_name: antizapret-vpn
    hostname: antizapret
    restart: unless-stopped
    privileged: true
    build: .
    environment:
      - DOMAIN
      - PORT=3003
      - CBC_CIPHERS
      - SCRAMBLE=1
      - DNS
      - DNS_RU
      - ADGUARD
      - TLS_CRYPT=1
    ports:
      - 3003:3003/tcp
      - 3003:3003/udp
#    dns:
#      - 1.1.1.1
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - ./keys:/etc/openvpn
      - ./config:/root/antizapret/config/custom
    logging:
      driver: json-file
      options:
        max-size: 100k
        max-file: 2
</code></pre>
<p>не подключается, надо все envirement заполнять? Планирую использовать на asus ac88u, но и с компьютера не пашет</p></td><td>2024-08-25T18:50:31.249Z</td></tr><tr><td>kirill</td><td><p>у докера своя тема</p>
<p>тут <a href="https://bitbucket.org/anticensority/antizapret-vpn-container/src/master/" rel="noopener nofollow ugc">anticensority / antizapret-vpn-container — Bitbucket</a></p></td><td>2024-08-25T20:00:15.470Z</td></tr><tr><td>abugray(Georgy)</td><td><p>Где? По ссылке сайт с LXD версией.</p></td><td>2024-08-25T20:02:33.913Z</td></tr><tr><td>kirill</td><td><p>тут обсуждается <a href="https://bitbucket.org/anticensority/antizapret-vpn-container/src/master/" rel="noopener nofollow ugc">anticensority / antizapret-vpn-container — Bitbucket</a></p></td><td>2024-08-25T20:05:10.985Z</td></tr><tr><td>kdkdjdndndjdjdjd(kdkdjdndndjdjdjd)</td><td><p>Подскажите, есть ли возможность использования OpenVPN Access Server ’ а для данного контейнера или другие решения для дополнительной аутентификации и создания пользователей?</p></td><td>2024-08-26T15:08:29.651Z</td></tr><tr><td>xtrime</td><td><aside class="quote no-group" data-username="abugray" data-post="988" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/a/6a8cbe/48.png" class="avatar"> abugray:</div>
<blockquote>
<p><code>SCRAMBLE=1</code></p>
</blockquote>
</aside>
<p>Для этой опции нужны специальные клиенты. Нужно отлючить/оставить пустой по умолчанию.</p>
<p>Если не поможет, то просьба прислать логи: <code>docker compose logs</code></p>
<p>UP: ссори, перепутал ветку, был одинаковый вопрос в обоих.</p></td><td>2024-08-27T18:13:56.930Z</td></tr><tr><td>sta010</td><td><p>Народ, подскажите, возможно ли создать свой личный VPN АнтиЗапрета с Ютубом  на базе ProstoVPN?</p></td><td>2024-08-28T11:03:28.792Z</td></tr><tr><td>xtrime</td><td><aside class="quote no-group" data-username="sta010" data-post="994" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/s/97f17d/48.png" class="avatar"> sta010:</div>
<blockquote>
<p>свой личный VPN АнтиЗапрета с Ютубом</p>
</blockquote>
</aside>
<p>Есть два основных варианта:</p>
<ol>
<li>
<p>Через docker:<br>
<a href="https://github.com/xtrime-ru/antizapret-vpn-docker?tab=readme-ov-file#installation" class="inline-onebox">GitHub - xtrime-ru/antizapret-vpn-docker: Docker container with antizapret-vpn for selfhosting.</a><br>
Обсуждение: <a href="https://ntc.party/t/%D0%BD%D0%B5%D0%BE%D1%84%D0%B8%D1%86%D0%B8%D0%B0%D0%BB%D1%8C%D0%BD%D1%8B%D0%B9-docker-%D0%BA%D0%BE%D0%BD%D1%82%D0%B5%D0%B9%D0%BD%D0%B5%D1%80-%D0%B0%D0%BD%D1%82%D0%B8%D0%B7%D0%B0%D0%BF%D1%80%D0%B5%D1%82%D0%B0/8839" class="inline-onebox">Неофициальный docker-контейнер АнтиЗапрета</a></p>
</li>
<li>
<p>Без docker:<br>
<a href="https://github.com/GubernievS/AntiZapret-VPN" class="inline-onebox">GitHub - GubernievS/AntiZapret-VPN</a><br>
Обсуждение: <a href="https://ntc.party/t/%D1%81%D0%BA%D1%80%D0%B8%D0%BF%D1%82-%D0%B4%D0%BB%D1%8F-%D0%B0%D0%B2%D1%82%D0%BE%D0%BC%D0%B0%D1%82%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%BE%D0%B3%D0%BE-%D1%80%D0%B0%D0%B7%D0%B2%D0%B5%D1%80%D1%82%D1%8B%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-antizapret-vpn-%D0%BD%D0%BE%D0%B2%D0%B0%D1%8F-%D0%B2%D0%B5%D1%80%D1%81%D0%B8%D1%8F-%D0%B1%D0%B5%D0%B7-%D0%BA%D0%BE%D0%BD%D1%82%D0%B5%D0%B9%D0%BD%D0%B5%D1%80%D0%B0-youtube/9270" class="inline-onebox">Скрипт для автоматического развертывания AntiZapret VPN (НОВАЯ версия БЕЗ контейнера) + YouTube</a></p>
</li>
</ol></td><td>2024-08-28T13:08:41.401Z</td></tr><tr><td>BlackMamba</td><td><p>Здравствуйте! Подскажите что сделать что-бы открывались “госуслуги” - ошибка “DNS_PROBE_FINISHED_NXDOMAIN”<br>
На сервере делал nslookup<br>
root@antizapret-vpn:~# nslookup <a href="http://gosuslugi.ru" rel="noopener nofollow ugc">gosuslugi.ru</a><br>
Server:         8.8.8.8<br>
Address:        8.8.8.8#53</p>
<p>Non-authoritative answer:<br>
Name:   <a href="http://gosuslugi.ru" rel="noopener nofollow ugc">gosuslugi.ru</a><br>
Address: 213.59.254.7<br>
Name:   <a href="http://gosuslugi.ru" rel="noopener nofollow ugc">gosuslugi.ru</a><br>
Address: 213.59.253.7</p>
<p>И на локальном пк<br>
╤хЁтхЁ:  UnKnown<br>
Address:  192.168.192.1</p>
<p>Не заслуживающий доверия ответ:<br>
╚ь :     <a href="http://gosuslugi.ru" rel="noopener nofollow ugc">gosuslugi.ru</a><br>
Addresses:  213.59.253.7<br>
213.59.254.7</p></td><td>2024-09-20T15:04:36.045Z</td></tr><tr><td>kirill</td><td><p>Для Discord нашёл вот такой перечень доменов</p><aside class="onebox githubblob" data-onebox-src="https://github.com/v2fly/domain-list-community/blob/master/data/discord">
  <header class="source">

      <a href="https://github.com/v2fly/domain-list-community/blob/master/data/discord" target="_blank" rel="noopener nofollow ugc">github.com</a>
  </header>

  <article class="onebox-body">
    <h4><a href="https://github.com/v2fly/domain-list-community/blob/master/data/discord" target="_blank" rel="noopener nofollow ugc">v2fly/domain-list-community/blob/master/data/discord</a></h4>


      <pre><code class="lang-"># Core
dis.gd
discord.co
discord.com
discord.design
discord.dev
discord.gg
discord.gift
discord.gifts
discord.media
discord.new
discord.store
discord.tools
discord-activities.com
discordactivities.com
discordapp.com
discordapp.net
discordmerch.com
discordpartygames.com
discordsays.com
</code></pre>



  This file has been truncated. <a href="https://github.com/v2fly/domain-list-community/blob/master/data/discord" target="_blank" rel="noopener nofollow ugc">show original</a>

  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

<p>добавил в<br>
<code>lxc exec antizapret-vpn -- nano /root/antizapret/config/include-hosts-custom.txt</code></p>
<pre><code class="lang-auto">dis.gd
discord.co
discord.com
discord.design
discord.dev
discord.gg
discord.gift
discord.gifts
discord.media
discord.new
discord.store
discord.tools
discord-activities.com
discordactivities.com
discordapp.com
discordapp.net
discordmerch.com
discordpartygames.com
discordsays.com
discordstatus.com
airhorn.solutions
airhornbot.com
bigbeans.solutions
watchanimeattheoffice.com
</code></pre>
<p>далее<br>
<code>lxc exec antizapret-vpn -- sh -c "LANG=C.UTF-8 /root/antizapret/doall.sh"</code><br>
<code>lxc exec antizapret-vpn -- sh -c "echo 'cache.clear()' | socat - /run/knot-resolver/control/1"</code></p>
<p>вроде работает</p></td><td>2024-10-10T16:35:27.360Z</td></tr><tr><td>Habrahar(Habrahar)</td><td><p>Добавил это, дискорд подключается, но проблема со звонками остается.<br>
Есть ли такая проблема у вас или решения дополнительные?</p></td><td>2024-10-18T10:56:39.571Z</td></tr><tr><td>Kamareka(Kamareka)</td><td><p>Здравствуйте.</p>
<p>Странно ломается dns. 192.168.104.1 - адрес контейнера antizapret в vpn.<br>
Первые пару раз команда с роутера выполняется, все остальные уже дают ошибку.<br>
Переподключаем vpn, снова поначалу все ок, затем таймауты.<br>
В чем может быть причина?</p>
<pre><code class="lang-auto">~ # dig youtube.com @192.168.104.1

; &lt;&lt;&gt;&gt; DiG 9.18.24 &lt;&lt;&gt;&gt; youtube.com @192.168.104.1
;; global options: +cmd
;; Got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 40414
;; flags: qr rd ra; QUERY: 1, ANSWER: 4, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 4096
;; QUESTION SECTION:
;youtube.com.                   IN      A

;; ANSWER SECTION:
youtube.com.            300     IN      A       10.224.0.1
youtube.com.            300     IN      A       10.224.0.2
youtube.com.            300     IN      A       10.224.0.3
youtube.com.            300     IN      A       10.224.0.4

;; Query time: 84 msec
;; SERVER: 192.168.104.1#53(192.168.104.1) (UDP)
;; WHEN: Fri Oct 18 18:04:47 +05 2024
;; MSG SIZE  rcvd: 104

~ #
~ #
~ # dig youtube.com @192.168.104.1
;; communications error to 192.168.104.1#53: timed out

; &lt;&lt;&gt;&gt; DiG 9.18.24 &lt;&lt;&gt;&gt; youtube.com @192.168.104.1
;; global options: +cmd
;; no servers could be reached
</code></pre>
<p>UPD. Даже пинг пропадает. Сначала есть, через минуту нет.</p></td><td>2024-10-18T13:31:44.297Z</td></tr><tr><td>kirill</td><td><p>не подскажу,</p>
<p>преимущественно использую в качестве чата в некоторых проектах</p></td><td>2024-10-18T21:10:41.088Z</td></tr><tr><td>Tyman</td><td><p>IP discord для голоса (большая часть):<br>
66.22.192.0/18<br>
35.192.0.0/11<br>
34.0.192.0/18</p></td><td>2024-10-18T23:01:20.848Z</td></tr><tr><td>smerto(max)</td><td><p>добрый день! При выполнение команды “LANG=C.UTF-8 /root/antizapret/doall.sh”<br>
выдаёт ошибку “curl: (22) The requested URL returned error: 404”<br>
соответственно список сайтов не обновляется как это исправить?</p></td><td>2024-12-26T18:23:00.254Z</td></tr><tr><td>nzkhammatov(Ainur Khammatov)</td><td><hr>
<p><strong>Миграция сюда</strong></p>
<blockquote>
<p><a href="https://github.com/GubernievS/AntiZapret-VPN" class="inline-onebox" rel="noopener nofollow ugc">GitHub - GubernievS/AntiZapret-VPN</a></p>
</blockquote>
<blockquote>
<p><a href="https://github.com/xtrime-ru/antizapret-vpn-docker" class="inline-onebox" rel="noopener nofollow ugc">GitHub - xtrime-ru/antizapret-vpn-docker: Docker container with antizapret-vpn for selfhosting.</a></p>
</blockquote>
<hr>
<details>
<summary>
option 1 | no check</summary>
<p><strong>Внутри контейнера</strong></p>
<p><strong>backup</strong></p>
<pre data-code-wrap="bash"><code class="lang-bash">clear
cd /root/antizapret
rm -rf update.sh.backup
cp update.sh update.sh.backup
clear
ls -lah | grep "update.sh"
</code></pre>
<p><strong>apply the fix</strong></p>
<pre data-code-wrap="bash"><code class="lang-bash">sed -i '/length/d; /differs/d' /root/antizapret/update.sh
</code></pre>
<pre data-code-wrap="bash"><code class="lang-bash">sed -i 's|https://raw.githubusercontent.com/zapret-info/z-i/master/dump.csv|https://app.assembla.com/spaces/z-i/git/source/master/dump.csv?_format=raw|g; s|https://raw.githubusercontent.com/zapret-info/z-i/master/nxdomain.txt|https://app.assembla.com/spaces/z-i/git/source/master/nxdomain.txt?_format=raw|g' /root/antizapret/update.sh
</code></pre>
<p><strong>restore from a backup</strong></p>
<pre data-code-wrap="bash"><code class="lang-bash">clear
cd /root/antizapret
rm -rf update.sh
cp update.sh.backup update.sh
clear
ls -lah | grep "update.sh"
</code></pre>
</details>
<hr>
<details>
<summary>
option 2 | md5sum</summary>
<p><strong>Внутри контейнера</strong></p>
<p><strong>backup</strong></p>
<pre data-code-wrap="bash"><code class="lang-bash">clear
cd /root/antizapret
rm -rf update.sh.backup
cp update.sh update.sh.backup
clear
ls -lah | grep "update.sh"
</code></pre>
<p><strong>apply the fix</strong></p>
<pre data-code-wrap="bash"><code class="lang-bash">echo -n &gt; /root/antizapret/update.sh
nano /root/antizapret/update.sh
</code></pre>
<pre data-code-wrap="bash"><code class="lang-bash">#!/bin/bash
set -e

HERE="$(dirname "$(readlink -f "${0}")")"
cd "$HERE"

LISTLINK='https://app.assembla.com/spaces/z-i/git/source/master/dump.csv?_format=raw'
NXDOMAINLINK='https://app.assembla.com/spaces/z-i/git/source/master/nxdomain.txt?_format=raw'
curl -f --fail-early --compressed -o temp/list_orig.csv "$LISTLINK" || exit 1
iconv -f cp1251 -t utf8 temp/list_orig.csv &gt; temp/list.csv
curl -f --fail-early --compressed -o temp/nxdomain.txt "$NXDOMAINLINK" || exit 1

LISTSIZE="$(curl -s "$LISTLINK" | md5sum | awk '{ print $1 }')"
[[ "$LISTSIZE" != "$(md5sum temp/list_orig.csv | awk '{ print $1 }')" ]] &amp;&amp; echo "List 1 hash differs" &amp;&amp; exit 2
LISTSIZE="$(curl -s "$NXDOMAINLINK" | md5sum | awk '{ print $1 }')"
[[ "$LISTSIZE" != "$(md5sum temp/nxdomain.txt | awk '{ print $1 }')" ]] &amp;&amp; echo "List 2 hash differs" &amp;&amp; exit 2

exit 0
</code></pre>
<p><strong>restore from a backup</strong></p>
<pre data-code-wrap="bash"><code class="lang-bash">clear
cd /root/antizapret
rm -rf update.sh
cp update.sh.backup update.sh
clear
ls -lah | grep "update.sh"
</code></pre>
</details>
<hr>
<details>
<summary>
option 3 | sha256sum</summary>
<p><strong>Внутри контейнера</strong></p>
<p><strong>backup</strong></p>
<pre data-code-wrap="bash"><code class="lang-bash">clear
cd /root/antizapret
rm -rf update.sh.backup
cp update.sh update.sh.backup
clear
ls -lah | grep "update.sh"
</code></pre>
<p><strong>apply the fix</strong></p>
<pre data-code-wrap="bash"><code class="lang-bash">echo -n &gt; /root/antizapret/update.sh
nano /root/antizapret/update.sh
</code></pre>
<pre data-code-wrap="bash"><code class="lang-bash">#!/bin/bash
set -e

HERE="$(dirname "$(readlink -f "${0}")")"
cd "$HERE"

LISTLINK='https://app.assembla.com/spaces/z-i/git/source/master/dump.csv?_format=raw'
NXDOMAINLINK='https://app.assembla.com/spaces/z-i/git/source/master/nxdomain.txt?_format=raw'
curl -f --fail-early --compressed -o temp/list_orig.csv "$LISTLINK" || exit 1
iconv -f cp1251 -t utf8 temp/list_orig.csv &gt; temp/list.csv
curl -f --fail-early --compressed -o temp/nxdomain.txt "$NXDOMAINLINK" || exit 1

LISTSIZE="$(curl -s "$LISTLINK" | sha256sum | awk '{ print $1 }')"
[[ "$LISTSIZE" != "$(sha256sum temp/list_orig.csv | awk '{ print $1 }')" ]] &amp;&amp; echo "List 1 hash differs" &amp;&amp; exit 2
LISTSIZE="$(curl -s "$NXDOMAINLINK" | sha256sum | awk '{ print $1 }')"
[[ "$LISTSIZE" != "$(sha256sum temp/nxdomain.txt | awk '{ print $1 }')" ]] &amp;&amp; echo "List 2 hash differs" &amp;&amp; exit 2

exit 0
</code></pre>
<p><strong>restore from a backup</strong></p>
<pre data-code-wrap="bash"><code class="lang-bash">clear
cd /root/antizapret
rm -rf update.sh
cp update.sh.backup update.sh
clear
ls -lah | grep "update.sh"
</code></pre>
</details>
<hr></td><td>2024-12-27T08:58:04.663Z</td></tr><tr><td>kirill</td><td><p>благодарю, недавно пофиксил по первому методу себе, где</p>
<p><code>lxc exec antizapret-vpn -- nano /root/antizapret/update.sh</code></p>
<p>стал</p>
<pre><code class="lang-auto">#!/bin/bash
set -e

HERE="$(dirname "$(readlink -f "${0}")")"
cd "$HERE"

LISTLINK='https://app.assembla.com/spaces/z-i/git/source/master/dump.csv?_format=raw'
NXDOMAINLINK='https://app.assembla.com/spaces/z-i/git/source/master/nxdomain.txt?_format=raw'
curl -f --fail-early --compressed -o temp/list_orig.csv "$LISTLINK" || exit 1
iconv -f cp1251 -t utf8 temp/list_orig.csv &gt; temp/list.csv
curl -f --fail-early --compressed -o temp/nxdomain.txt "$NXDOMAINLINK" || exit 1

exit 0
</code></pre>
<p>смотрю, ты добавил ещё с проверкой хешсумм два метода,<br>
поясни для тех, кто с деревни, что это</p></td><td>2025-01-02T20:52:38.793Z</td></tr><tr><td>kirill</td><td><p>вообще непонятно, почему на <a href="https://github.com/zapret-info/z-i" class="inline-onebox" rel="noopener nofollow ugc">GitHub - zapret-info/z-i: Register of Internet Addresses filtered in Russian Federation</a> убрали кумулятивный файл dump.csv, а на <a href="http://assembla.com" rel="noopener nofollow ugc">assembla.com</a> и sourceforge (с которого такой большой файл фиг скачаешь) – оставили?<br>
разные команды штоле делаются?</p>
<p>полагаю, что если оставить гитхаб, как в оригинальном скрипте, скачивать диффы и собирать из них искомый dump.csv, можно, наверное, сделать и так:</p>
<pre><code class="lang-auto">#!/bin/bash
set -e

HERE="$(dirname "$(readlink -f "${0}")")"
cd "$HERE"

# Ссылки на файлы
BASELINK='https://raw.githubusercontent.com/zapret-info/z-i/master/'
NXDOMAINLINK='https://raw.githubusercontent.com/zapret-info/z-i/master/nxdomain.txt'

# Очистка временных файлов
rm -rf temp
mkdir -p temp

# Скачивание всех частей dump-*.csv
i=0
while true; do
    PARTNAME="dump-$(printf "%02d" "$i").csv"
    PARTLINK="${BASELINK}${PARTNAME}"
    PARTFILE="temp/${PARTNAME}"
    
    # Пытаемся скачать текущую часть
    if ! curl -f --fail-early --compressed -o "$PARTFILE" "$PARTLINK"; then
        # Если файл отсутствует, выходим из цикла
        break
    fi
    
    echo "Скачан $PARTLINK"
    i=$((i + 1))
done

if [[ $i -eq 0 ]]; then
    echo "Не удалось скачать ни одного файла dump-*.csv"
    exit 1
fi

# Объединение всех частей в один файл
cat temp/dump-*.csv &gt; temp/list_orig.csv
echo "Объединены все части dump-*.csv в temp/list_orig.csv"

# Преобразование кодировки dump.csv
iconv -f cp1251 -t utf8 temp/list_orig.csv &gt; temp/list.csv

# Скачивание nxdomain.txt
curl -f --fail-early --compressed -o temp/nxdomain.txt "$NXDOMAINLINK" || exit 1

echo "Скрипт завершён успешно."
exit 0
</code></pre>
<p>поправьте, если я не прав</p></td><td>2025-01-03T19:19:06.166Z</td></tr><tr><td>kirill</td><td><p><a href="https://ntc.party/t/%D0%BA%D0%BE%D0%BD%D1%82%D0%B5%D0%B9%D0%BD%D0%B5%D1%80-vpn-%D0%B0%D0%BD%D1%82%D0%B8%D0%B7%D0%B0%D0%BF%D1%80%D0%B5%D1%82%D0%B0-%D0%B4%D0%BB%D1%8F-%D1%83%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B8-%D0%BD%D0%B0-%D1%81%D0%BE%D0%B1%D1%81%D1%82%D0%B2%D0%B5%D0%BD%D0%BD%D1%8B%D0%B9-%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80/129/693">вот тут</a> описано, как изменить стандартное обновление раз в шесть часов,<br>
сделав его, допустим, раз в сутки ночью</p>
<p>понятно, что как минимум раз в сутки репо точно обновляется, но<br>
если представить гипотетически, что это раз в сутки, то все огромные списки будут перекачиваться заново</p>
<p>теоретически, я не претендую на правильность, можно сделать так:</p>
<p>правим<br>
<code>lxc exec antizapret-vpn -- nano /root/antizapret/doall.sh</code></p>
<pre><code class="lang-auto">#!/bin/bash

set -e

# Устанавливаем текущий каталог как рабочий
HERE="$(dirname "$(readlink -f "${0}")")"
cd "$HERE"

# URL RSS-канала
RSS_URL="https://github.com/zapret-info/z-i/commits/master.atom"

# Файл для хранения последнего хэша коммита (с относительным путём)
LAST_COMMIT_FILE="./last_commit.txt"

LOG_FILE="./doall.log"

# Функция для выполнения скриптов с комментариями
run_scripts() {
    if ./update.sh; then
        echo "&gt;&gt;&gt; update.sh выполнен успешно."
    else
        echo "&gt;&gt;&gt; Ошибка в update.sh"
        exit 1
    fi

    if ./parse.sh; then
        echo "&gt;&gt;&gt; parse.sh выполнен успешно."
    else
        echo "&gt;&gt;&gt; Ошибка в parse.sh"
        exit 1
    fi

    if ./process.sh; then
        echo "&gt;&gt;&gt; process.sh выполнен успешно."
    else
        echo "&gt;&gt;&gt; Ошибка в process.sh"
        exit 1
    fi
}

# Проверка на существование файла с хэшем
if [ ! -f "$LAST_COMMIT_FILE" ]; then
    echo "Файл $LAST_COMMIT_FILE отсутствует. Выполняем начальную инициализацию..."
    LATEST_COMMIT=$(curl -s "$RSS_URL" | grep -oPm1 "(?&lt;=Grit::Commit/)[a-f0-9]{40}")
    echo "Последний коммит: $LATEST_COMMIT"
    
    # Выполняем начальную инициализацию
    if run_scripts; then
        echo "$LATEST_COMMIT" &gt; "$LAST_COMMIT_FILE"
        echo "$(date '+%Y-%m-%d %H:%M:%S') Обновление завершено успешно. Коммит: $LATEST_COMMIT" &gt; "$LOG_FILE"
        echo "Инициализация завершена успешно."
    else
        echo "Ошибка при выполнении инициализации."
        exit 1
    fi
    exit 0
fi

# Получаем текущий последний коммит из RSS
LATEST_COMMIT=$(curl -s "$RSS_URL" | grep -oPm1 "(?&lt;=Grit::Commit/)[a-f0-9]{40}")

# Сравниваем с сохраненным коммитом
SAVED_COMMIT=$(cat "$LAST_COMMIT_FILE")

if [ "$LATEST_COMMIT" != "$SAVED_COMMIT" ]; then
    echo "Обнаружен новый коммит: $LATEST_COMMIT"
    
    # Выполняем обновление
    if run_scripts; then
        echo "$LATEST_COMMIT" &gt; "$LAST_COMMIT_FILE"
        echo "$(date '+%Y-%m-%d %H:%M:%S') Обновление завершено успешно. Коммит: $LATEST_COMMIT" &gt;&gt; "$LOG_FILE"
        # Ограничиваем файл лога последними 15 записями
        tail -n 15 "$LOG_FILE" &gt; "/tmp/$(basename "$LOG_FILE").tmp" &amp;&amp; mv "/tmp/$(basename "$LOG_FILE").tmp" "$LOG_FILE"
        echo "Обновление завершено успешно."
    else
        echo "Ошибка при выполнении обновления."
        exit 1
    fi
else
    echo "Новых коммитов нет."
fi

</code></pre>
<p>далее правим<br>
<code>lxc exec antizapret-vpn -- nano /root/antizapret/update.sh</code></p>
<pre><code class="lang-auto">#!/bin/bash
set -e

HERE="$(dirname "$(readlink -f "${0}")")"
cd "$HERE"

# Базовые ссылки для скачивания
BASELINK='https://raw.githubusercontent.com/zapret-info/z-i/master/'
NXDOMAINLINK='https://raw.githubusercontent.com/zapret-info/z-i/master/nxdomain.txt'

# Очистка временных файлов
rm -rf temp
mkdir -p temp

# Скачивание всех частей dump-*.csv
i=0
while true; do
    PARTNAME="dump-$(printf "%02d" "$i").csv"
    PARTLINK="${BASELINK}${PARTNAME}"
    PARTFILE="temp/${PARTNAME}"
    
    # Пытаемся скачать текущую часть
    if ! curl -f --fail-early --compressed -o "$PARTFILE" "$PARTLINK" 2&gt;/dev/null; then
        # Если файл отсутствует, выходим из цикла
        break
    fi
    
    echo "Скачан $PARTLINK"
    
    # Проверка размера файла
    EXPECTED_SIZE=$(curl -sI "$PARTLINK" | awk 'BEGIN {IGNORECASE=1;} /content-length/ {sub(/[ \t\r\n]+$/, "", $2); print $2}')
    ACTUAL_SIZE=$(stat -c '%s' "$PARTFILE")
    if [[ "$EXPECTED_SIZE" != "$ACTUAL_SIZE" ]]; then
        echo "Ошибка: размер файла $PARTNAME отличается (ожидалось: $EXPECTED_SIZE, фактически: $ACTUAL_SIZE)"
        exit 2
    fi
    echo "Размер файла $PARTNAME совпадает (размер: $ACTUAL_SIZE байт)"
    
    i=$((i + 1))
done

# Проверяем, были ли скачаны файлы
if [[ $i -eq 0 ]]; then
    echo "Не удалось скачать ни одного файла dump-*.csv"
    exit 1
fi

echo "Всего скачано частей: $i"

# Объединение всех частей в один файл
cat temp/dump-*.csv &gt; temp/list_orig.csv
echo "Объединены все части dump-*.csv в temp/list_orig.csv"

# Преобразование кодировки dump.csv
iconv -f cp1251 -t utf8 temp/list_orig.csv &gt; temp/list.csv
echo "Файл temp/list_orig.csv преобразован в UTF-8 и сохранён как temp/list.csv"

# Скачивание nxdomain.txt
curl -f --fail-early --compressed -o temp/nxdomain.txt "$NXDOMAINLINK" 2&gt;/dev/null || exit 1
echo "Файл nxdomain.txt успешно скачан в temp/nxdomain.txt"

# Проверка размера nxdomain.txt
EXPECTED_SIZE=$(curl -sI "$NXDOMAINLINK" | awk 'BEGIN {IGNORECASE=1;} /content-length/ {sub(/[ \t\r\n]+$/, "", $2); print $2}')
ACTUAL_SIZE=$(stat -c '%s' temp/nxdomain.txt)
if [[ "$EXPECTED_SIZE" != "$ACTUAL_SIZE" ]]; then
    echo "Ошибка: размер файла nxdomain.txt отличается (ожидалось: $EXPECTED_SIZE, фактически: $ACTUAL_SIZE)"
    exit 2
fi
echo "Размер файла nxdomain.txt совпадает (размер: $ACTUAL_SIZE байт)"

echo "Скрипт update.sh завершён успешно"
exit 0

</code></pre>
<p>и таймер<br>
<code>lxc exec antizapret-vpn -- nano /etc/systemd/system/antizapret-update.timer</code></p>
<pre><code class="lang-auto">[Unit]
Description=Run antizapret-vpn update every 30 minutes

[Timer]
# Запускать задачу каждые 30 минут с момента последнего запуска
OnUnitActiveSec=30m
# Сохранить пропущенные запуски, если система была выключена
Persistent=true

[Install]
WantedBy=timers.target

</code></pre>
<p>по итогу таймер будет проверять раз в тридцать минут (по желанию) последний комит, и при несовпадении – уже скачивать</p>
<p>как обычно проверяем запуск<br>
<code>lxc exec antizapret-vpn -- sh -c "LANG=C.UTF-8 /root/antizapret/doall.sh"</code><br>
<code>lxc exec antizapret-vpn -- sh -c "echo 'cache.clear()' | socat - /run/knot-resolver/control/1"</code></p>
<p>и для контроля<br>
<code>lxc exec antizapret-vpn -- cat /root/antizapret/doall.log</code><br>
<code>lxc exec antizapret-vpn -- systemctl list-timers --all | awk 'NR==1 || /antizapret-update.timer/'</code></p></td><td>2025-01-10T21:18:58.399Z</td></tr><tr><td>gainhard(Rus)</td><td><p>очень давно не было обновлений =( команда LANG=C.UTF-8 /root/antizapret/doall.sh - не работает…</p></td><td>2025-01-17T03:41:41.834Z</td></tr><tr><td>Xunlei</td><td><p>И не будет, актульные ветки обсуждений от коммунити:<br>
<a href="https://ntc.party/t/%D0%BD%D0%B5%D0%BE%D1%84%D0%B8%D1%86%D0%B8%D0%B0%D0%BB%D1%8C%D0%BD%D1%8B%D0%B9-docker-%D0%BA%D0%BE%D0%BD%D1%82%D0%B5%D0%B9%D0%BD%D0%B5%D1%80-%D0%B0%D0%BD%D1%82%D0%B8%D0%B7%D0%B0%D0%BF%D1%80%D0%B5%D1%82%D0%B0/8839">Неофициальный docker-контейнер АнтиЗапрета</a><br>
<a href="https://ntc.party/t/%D1%81%D0%BA%D1%80%D0%B8%D0%BF%D1%82-%D0%B4%D0%BB%D1%8F-%D0%B0%D0%B2%D1%82%D0%BE%D0%BC%D0%B0%D1%82%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%BE%D0%B3%D0%BE-%D1%80%D0%B0%D0%B7%D0%B2%D0%B5%D1%80%D1%82%D1%8B%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-antizapret-vpn-%D0%BE%D0%B1%D1%8B%D1%87%D0%BD%D1%8B%D0%B9-vpn-%D0%B1%D0%B5%D0%B7-%D0%BA%D0%BE%D0%BD%D1%82%D0%B5%D0%B9%D0%BD%D0%B5%D1%80%D0%B0-openvpn-wireguard-amneziawg-%D0%BF%D0%B0%D1%82%D1%87-%D0%B4%D0%BB%D1%8F-%D0%BE%D0%B1%D1%85%D0%BE%D0%B4%D0%B0-%D0%B1%D0%BB%D0%BE%D0%BA%D0%B8%D1%80%D0%BE%D0%B2%D0%BA%D0%B8-openvpn/9270">Скрипт для автоматического развертывания AntiZapret VPN (без контейнера)</a></p></td><td>2025-01-17T13:49:26.556Z</td></tr><tr><td>gainhard(Rus)</td><td><p>Подскажите пожалуйста, а контейнер в шапке этот уже неактуальный и вообще нерабочий или только у меня с ним проблемы? Вроде как с сайта именно на него ссылка идет же…</p>
<p>Я установил его на ubuntu 22 используя LXC- вроде бы всё встало, к серверу подключаюсь… НО - ни один сайт не работает через vpn -всё как было так и пытается лезть напрямую. Ни из списка антизапрета, ни из списка, который я добавил в файл include-hosts-custom.txt - я что-то не так установил или лучше поставить уже какой-то неофициальный вариант сервера, но более актуальный?<br>
В чем может быть проблема, почему не идет траффик через сервер? LXC полностью по умолчанию настроен. Пробовал перезагружать и сервер и отдельно контейнер -не помогло… также пытался подключиться с конфигом udp вместо tcp- то же самое. Подключение есть к серверу, но не идет через него траффик. tracert по запрещенным доменам смотрю- как будто напрямую всё идет тупо… нет ip сервера там моего вообще. Или как правильно проверять работоспособность? Можно ли где-то логи глянуть?</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/bc6b5a6987f4fd9fc728e5ddad37ecd0cb2487b9.jpeg" data-download-href="https://ntc.party/uploads/default/bc6b5a6987f4fd9fc728e5ddad37ecd0cb2487b9" title="babe"><img src="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/bc6b5a6987f4fd9fc728e5ddad37ecd0cb2487b9_2_690x100.jpeg" alt="babe" data-base62-sha1="qSPLAuagLgZhtyRu659CIOOtSc1" width="690" height="100" srcset="контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/bc6b5a6987f4fd9fc728e5ddad37ecd0cb2487b9_2_690x100.jpeg, контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/bc6b5a6987f4fd9fc728e5ddad37ecd0cb2487b9.jpeg 1.5x, контейнер-vpn-антизапрета-для-установки-на-собственный-сервер-129/bc6b5a6987f4fd9fc728e5ddad37ecd0cb2487b9.jpeg 2x" data-dominant-color="1F1F1F"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">babe</span><span class="informations">977×142 35.3 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div><br>
и скрипт этот не работает что-то с сервера…</p></td><td>2025-01-17T15:32:13.730Z</td></tr><tr><td>Xunlei</td><td><p>Не могу подсказать, я не пользуюсь антизапретом.</p>
<aside class="quote no-group" data-username="gainhard" data-post="1010" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/gainhard/48/15054_2.png" class="avatar"> gainhard:</div>
<blockquote>
<p>лучше поставить уже какой-то неофициальный вариант сервера, но более актуальный?</p>
</blockquote>
</aside>
<p>Конечно, для этого ссылки и были приведены. В варианте от <a class="mention" href="/u/tyman">@Tyman</a> есть даже правила netFilter для защиты от флуда.</p></td><td>2025-01-17T15:49:48.912Z</td></tr><tr><td>kirill</td><td><aside class="quote no-group" data-username="gainhard" data-post="1010" data-topic="129">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/gainhard/48/15054_2.png" class="avatar"> gainhard:</div>
<blockquote>
<p>только у меня с ним проблемы?</p>
</blockquote>
</aside>
<p>я даже не знаю, что тебе сказать на это</p>
<p>буквально над первым же твоим постом пять сообщений вверх прочитать,</p>
<p>а если только установил, то да, придётся лопатить<br>
как минимум вот:</p><aside class="quote quote-modified" data-post="560" data-topic="129">
  <div class="title">
    <div class="quote-controls"></div>
    <img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/valdikss/48/2_2.png" class="avatar">
    <a href="https://ntc.party/t/%D0%BA%D0%BE%D0%BD%D1%82%D0%B5%D0%B9%D0%BD%D0%B5%D1%80-vpn-%D0%B0%D0%BD%D1%82%D0%B8%D0%B7%D0%B0%D0%BF%D1%80%D0%B5%D1%82%D0%B0-%D0%B4%D0%BB%D1%8F-%D1%83%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B8-%D0%BD%D0%B0-%D1%81%D0%BE%D0%B1%D1%81%D1%82%D0%B2%D0%B5%D0%BD%D0%BD%D1%8B%D0%B9-%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80/129/560">Контейнер VPN АнтиЗапрета для установки на собственный сервер</a> <a class="badge-category__wrapper " href="/c/antizapret-prostovpn-org/az-self-hosted/38"><span data-category-id="38" style="--category-badge-color: #0088CC; --category-badge-text-color: #FFFFFF; --parent-category-badge-color: #8C6238;" data-parent-category-id="5" data-drop-close="true" class="badge-category --has-parent" title="Вопросы и особенности работы контейнера VPN АнтиЗапрета на своих серверах"><span class="badge-category__name">АнтиЗапрет на собственном сервере (self-hosted)</span></span></a>
  </div>
  <blockquote>
    В Реестр попали домены с кириллическими именами в названии, которые не соответствуют правилам наименования. Вероятно, кто-то распознал домен с бумаги и скопировал распознанные символы, либо еще что-то. 
<a href="https://reestr.rublacklist.net/ru/?q=b%D0%B5llon%D0%B0" class="onebox" target="_blank" rel="noopener nofollow ugc">https://reestr.rublacklist.net/ru/?q=bеllonа</a> 
В качестве временной меры вот эту строку: 
<a href="https://bitbucket.org/anticensority/antizapret-pac-generator-light/src/c73e0d901feb5b862a14f6e0f13670e590fb49ea/parse.sh#lines-9:10" class="onebox" target="_blank" rel="noopener nofollow ugc">https://bitbucket.org/anticensority/antizapret-pac-generator-light/src/c73e0d901feb5b862a14f6e0f13670e590fb49ea/parse.sh#lines-9:10</a> 
Замените на 
awk -F ';' '{print $2}' temp/list.csv | sort -u | awk '/^$/ {n…
  </blockquote>
</aside>
<p>
(или вот <a href="https://ntc.party/t/%D0%BA%D0%BE%D0%BD%D1%82%D0%B5%D0%B9%D0%BD%D0%B5%D1%80-vpn-%D0%B0%D0%BD%D1%82%D0%B8%D0%B7%D0%B0%D0%BF%D1%80%D0%B5%D1%82%D0%B0-%D0%B4%D0%BB%D1%8F-%D1%83%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B8-%D0%BD%D0%B0-%D1%81%D0%BE%D0%B1%D1%81%D1%82%D0%B2%D0%B5%D0%BD%D0%BD%D1%8B%D0%B9-%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80/129/636" class="inline-onebox">Контейнер VPN АнтиЗапрета для установки на собственный сервер - #636 by stek29</a>)<br>
и вот<br>
<a href="https://ntc.party/t/%D0%BA%D0%BE%D0%BD%D1%82%D0%B5%D0%B9%D0%BD%D0%B5%D1%80-vpn-%D0%B0%D0%BD%D1%82%D0%B8%D0%B7%D0%B0%D0%BF%D1%80%D0%B5%D1%82%D0%B0-%D0%B4%D0%BB%D1%8F-%D1%83%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B8-%D0%BD%D0%B0-%D1%81%D0%BE%D0%B1%D1%81%D1%82%D0%B2%D0%B5%D0%BD%D0%BD%D1%8B%D0%B9-%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80/129/535" class="inline-onebox">Контейнер VPN АнтиЗапрета для установки на собственный сервер - #535 by ValdikSS</a><br>
и вот <a href="https://ntc.party/t/vpn/129/519" class="inline-onebox">Контейнер VPN АнтиЗапрета для установки на собственный сервер - #519 by ValdikSS</a></p>
<p>это вроде из основного</p>
<p>из полезного вот <a href="https://ntc.party/t/%D0%BA%D0%BE%D0%BD%D1%82%D0%B5%D0%B9%D0%BD%D0%B5%D1%80-vpn-%D0%B0%D0%BD%D1%82%D0%B8%D0%B7%D0%B0%D0%BF%D1%80%D0%B5%D1%82%D0%B0-%D0%B4%D0%BB%D1%8F-%D1%83%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B8-%D0%BD%D0%B0-%D1%81%D0%BE%D0%B1%D1%81%D1%82%D0%B2%D0%B5%D0%BD%D0%BD%D1%8B%D0%B9-%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80/129/127" class="inline-onebox">Контейнер VPN АнтиЗапрета для установки на собственный сервер - #127 by ValdikSS</a><br>
вот <a href="https://ntc.party/t/vpn/129/194">https://ntc.party/t/vpn/129/194</a><br>
<a href="https://ntc.party/t/vpn/129/76">https://ntc.party/t/vpn/129/76</a><br>
<a href="https://ntc.party/t/vpn-vpn/2040">https://ntc.party/t/vpn-vpn/2040</a><br>
<a href="https://ntc.party/t/vpn/129/329">https://ntc.party/t/vpn/129/329</a><br>
<a href="https://ntc.party/t/vpn/129/160">https://ntc.party/t/vpn/129/160</a><br>
<a href="https://ntc.party/t/vpn/129/247">https://ntc.party/t/vpn/129/247</a><br>
<a href="https://ntc.party/t/vpn/129/344">https://ntc.party/t/vpn/129/344</a><br>
<a href="https://ntc.party/t/vpn/129/39">https://ntc.party/t/vpn/129/39</a><br>
<a href="https://ntc.party/t/vpn/129/74">https://ntc.party/t/vpn/129/74</a><br>
<a href="https://ntc.party/t/vpn/129/372">https://ntc.party/t/vpn/129/372</a><br>
<a href="https://ntc.party/t/vpn/129/503">https://ntc.party/t/vpn/129/503</a><br>
<a href="https://ntc.party/t/vpn/129/505">https://ntc.party/t/vpn/129/505</a><br>
<a href="https://ntc.party/t/vpn/129/533">https://ntc.party/t/vpn/129/533</a><br>
<a href="https://ntc.party/t/%D0%BA%D0%BE%D0%BD%D1%82%D0%B5%D0%B9%D0%BD%D0%B5%D1%80-vpn-%D0%B0%D0%BD%D1%82%D0%B8%D0%B7%D0%B0%D0%BF%D1%80%D0%B5%D1%82%D0%B0-%D0%B4%D0%BB%D1%8F-%D1%83%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B8-%D0%BD%D0%B0-%D1%81%D0%BE%D0%B1%D1%81%D1%82%D0%B2%D0%B5%D0%BD%D0%BD%D1%8B%D0%B9-%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80/129/693">https://ntc.party/t/контейнер-vpn-антизапрета-для-установки-на-собственный-сервер/129/693</a><br>
<a href="https://ntc.party/t/%D0%B4%D0%BE%D0%B1%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5-chatgpt-%D0%B2-antizapret/7216">https://ntc.party/t/добавление-chatgpt-в-antizapret/7216</a><br>
<a href="https://ntc.party/t/rutrackerorg-%D0%BF%D0%BB%D0%BE%D1%85%D0%BE-%D0%BE%D1%82%D0%BA%D1%80%D1%8B%D0%B2%D0%B0%D0%B5%D1%82%D1%81%D1%8F-%D1%87%D0%B5%D1%80%D0%B5%D0%B7-%D0%B0%D0%BD%D1%82%D0%B8%D0%B7%D0%B0%D0%BF%D1%80%D0%B5%D1%82-vpn/7546/15">https://ntc.party/t/rutrackerorg-плохо-открывается-через-антизапрет-vpn/7546/15</a><br>
<a href="https://ntc.party/t/antizapret-%D0%BD%D0%B0-%D1%80%D0%BE%D1%83%D1%82%D0%B5%D1%80%D0%B5-%D0%BD%D0%B5-%D1%80%D0%B5%D0%B7%D0%BE%D0%BB%D1%8C%D0%B2%D0%B8%D1%82-%D0%BD%D0%B5%D0%BA%D0%BE%D1%82%D0%BE%D1%80%D1%8B%D0%B5-%D1%81%D0%B0%D0%B9%D1%82%D1%8B/7659/5">https://ntc.party/t/antizapret-на-роутере-не-резольвит-некоторые-сайты/7659/5</a><br>
<a href="https://ntc.party/t/%D0%BA%D0%BE%D0%BD%D1%82%D0%B5%D0%B9%D0%BD%D0%B5%D1%80-vpn-%D0%B0%D0%BD%D1%82%D0%B8%D0%B7%D0%B0%D0%BF%D1%80%D0%B5%D1%82%D0%B0-%D0%B4%D0%BB%D1%8F-%D1%83%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B8-%D0%BD%D0%B0-%D1%81%D0%BE%D0%B1%D1%81%D1%82%D0%B2%D0%B5%D0%BD%D0%BD%D1%8B%D0%B9-%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80/129/827">https://ntc.party/t/контейнер-vpn-антизапрета-для-установки-на-собственный-сервер/129/827</a><br>
<a href="https://ntc.party/t/%D0%BE%D0%B1%D1%85%D0%BE%D0%B4-%D0%B1%D0%BB%D0%BE%D0%BA%D0%B8%D1%80%D0%BE%D0%B2%D0%BE%D0%BA-%D0%B2-%D1%80%D0%BE%D1%81%D1%81%D0%B8%D0%B8-%D1%87%D0%B5%D1%80%D0%B5%D0%B7-%D0%B0%D0%BD%D1%82%D0%B8%D0%B7%D0%B0%D0%BF%D1%80%D0%B5%D1%82-%D0%BD%D0%B0-%D0%BF%D1%80%D0%BE%D1%88%D0%B8%D0%B2%D0%BA%D0%B5-keenetic/7768">https://ntc.party/t/обход-блокировок-в-россии-через-антизапрет-на-прошивке-keenetic/7768</a><br>
<a href="https://ntc.party/t/%D0%BA%D0%BE%D0%BD%D1%82%D0%B5%D0%B9%D0%BD%D0%B5%D1%80-vpn-%D0%B0%D0%BD%D1%82%D0%B8%D0%B7%D0%B0%D0%BF%D1%80%D0%B5%D1%82%D0%B0-%D0%B4%D0%BB%D1%8F-%D1%83%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B8-%D0%BD%D0%B0-%D1%81%D0%BE%D0%B1%D1%81%D1%82%D0%B2%D0%B5%D0%BD%D0%BD%D1%8B%D0%B9-%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80/129/436">https://ntc.party/t/контейнер-vpn-антизапрета-для-установки-на-собственный-сервер/129/436</a><br>
<a href="https://ntc.party/t/%D0%BA%D0%BE%D0%BD%D1%82%D0%B5%D0%B9%D0%BD%D0%B5%D1%80-vpn-%D0%B0%D0%BD%D1%82%D0%B8%D0%B7%D0%B0%D0%BF%D1%80%D0%B5%D1%82%D0%B0-%D0%B4%D0%BB%D1%8F-%D1%83%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B8-%D0%BD%D0%B0-%D1%81%D0%BE%D0%B1%D1%81%D1%82%D0%B2%D0%B5%D0%BD%D0%BD%D1%8B%D0%B9-%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80/129/939">https://ntc.party/t/контейнер-vpn-антизапрета-для-установки-на-собственный-сервер/129/939</a><br>
<a href="https://github.com/v2fly/domain-list-community/blob/master/data/discord" rel="noopener nofollow ugc">https://github.com/v2fly/domain-list-community/blob/master/data/discord</a></p>
<p>и ещё много чего, в этой теме почти всё есть</p></td><td>2025-01-17T22:49:22.956Z</td></tr><tr><td>Mr.Alex</td><td><p>Как сейчас установить контейнер с нуля? очень много всяких правок было спустя столько времени</p></td><td>2025-01-20T16:21:18.256Z</td></tr>
    </table>
      </body>
    </html>