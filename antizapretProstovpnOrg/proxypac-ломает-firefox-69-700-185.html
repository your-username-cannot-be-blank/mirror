
    <html>
      <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <style>
    th, td {
      border: 1px solid black;
      border-collapse: collapse;
    }
    th, td {
      word-wrap: break-word;
      padding: 5px;
    }
    table {
      width: 100%;
      max-width: 100%;
      border: 1px solid black;
      border-collapse: collapse;
      table-layout: fixed;
      word-wrap: break-word
    }
    code {
      word-wrap: break-word;
    }
    pre {
        white-space: pre-wrap;
    }
    </style>
        <title>proxypac-ломает-firefox-69-700-185</title>
      </head>
      <body>
        <table border="1" width="100%" cellpadding="5">
          <tr>
            <th style="width: 10%;">Ник</th>
            <th>Пост</th>
            <th style="width: 10%;">Дата</th>
          </tr>
    <tr><td>brook.qays</td><td><p>При использовании <a href="https://antizapret.prostovpn.org/proxy.pac" rel="nofollow noopener">https://antizapret.prostovpn.org/proxy.pac</a> в Firefox 69.* - 70.0 на Windows 7 64-bit все сайты загружаются около минуты, в т.ч. любые неблокированные, например Хабр. Включение или отключение DNS-over-HTTPS никакого заметного эффекта не оказывает. Проверено на нескольких чистых инсталляциях без дополнений и пользовательских настроек. При отключении proxy.pac неблокированные сайты загружаются практически мгновенно. В браузерах на базе WebKit использование <a href="https://antizapret.prostovpn.org/proxy.pac" rel="nofollow noopener">https://antizapret.prostovpn.org/proxy.pac</a> на этом же компьютере не вызывает никаких проблем с загрузкой любых сайтов.</p></td><td>2019-10-24T11:29:25.142Z</td></tr><tr><td>ValdikSS</td><td><p>Windows 7 32 bit, Firefox 70.0 — не проявляется. Запуск браузера происходит быстро, вне зависимости от наличия или отсутствия PAC-файла, заблокированные и незаблокированные сайты открываются без задержки.<br>
Тестировал на новом профиле и профиле, который использовал ранее.</p>
<p>Попробуйте открыть консоль браузера (CTRL+SHIFT+J) и посмотреть, происходит ли что-либо.</p></td><td>2019-10-24T12:40:54.214Z</td></tr><tr><td>brook.qays</td><td><p>При включенном proxy.pac в чистом Firefox 69.0.3 64-bit с новым профилем:</p>
<blockquote>
<p>PAC file installed from <a href="https://cloudflare-ipfs.com/ipns/pacipfs2.antizapret.prostovpn.org/proxy-ssl.js" rel="noopener nofollow ugc">https://cloudflare-ipfs.com/ipns/pacipfs2.antizapret.prostovpn.org/proxy-ssl.js</a><br>
Key event недоступен при использовании некоторых раскладок клавиатуры: ключ=«i» модификаторы=«accel,alt,shift» id=«key_browserToolbox» browser.xhtml<br>
NS_ERROR_FAILURE: Component returned failure code: 0x80004005 (NS_ERROR_FAILURE) [nsIInterfaceRequestor.getInterface] 2 network-response-listener.js:86<br>
NS_ERROR_FAILURE: Component returned failure code: 0x80004005 (NS_ERROR_FAILURE) [nsIInterfaceRequestor.getInterface] network-response-listener.js:86</p>
</blockquote>
<p>При отключенном proxy.pac ошибки NS_ERROR_FAILURE отсутствуют.</p>
<p>При включенном proxy.pac в Firefox 70.0 64-bit Safemode:</p>
<blockquote>
<p>[Exception… “Component returned failure code: 0x80520001 (NS_ERROR_FILE_UNRECOGNIZED_PATH) [nsIXPCComponents_Utils.readUTF8URI]” nsresult: “0x80520001 (NS_ERROR_FILE_UNRECOGNIZED_PATH)” location: “JS frame :: resource://gre/modules/L10nRegistry.jsm :: this.L10nRegistry.loadSync :: line 759” data: no] 2 <a>L10nRegistry.jsm:759:19</a><br>
uncaught exception: 2147746065 <a>SessionStore.jsm:5512:20</a><br>
Unknown category for SetEventRecordingEnabled: fxmonitor<br>
PAC file installed from <a href="https://cloudflare-ipfs.com/ipns/pacipfs2.antizapret.prostovpn.org/proxy-ssl.js" rel="noopener nofollow ugc">https://cloudflare-ipfs.com/ipns/pacipfs2.antizapret.prostovpn.org/proxy-ssl.js</a><br>
NS_ERROR_XPC_GS_RETURNED_FAILURE: ServiceManager::GetService returned failure code: <a>UrlClassifierListManager.jsm:73</a><br>
NS_ERROR_XPC_GS_RETURNED_FAILURE: ServiceManager::GetService returned failure code: <a>SafeBrowsing.jsm:303</a><br>
[Exception… “Component returned failure code: 0x80520001 (NS_ERROR_FILE_UNRECOGNIZED_PATH) [nsIXPCComponents_Utils.readUTF8URI]” nsresult: “0x80520001 (NS_ERROR_FILE_UNRECOGNIZED_PATH)” location: “JS frame :: resource://gre/modules/L10nRegistry.jsm :: this.L10nRegistry.loadSync :: line 759” data: no] 2 <a>L10nRegistry.jsm:759:19</a><br>
Key event недоступен при использовании некоторых раскладок клавиатуры: ключ=«i» модификаторы=«accel,alt,shift» id=«key_browserToolbox»</p>
</blockquote></td><td>2019-10-24T13:54:13.757Z</td></tr><tr><td>ValdikSS</td><td><p>Может, у вас с DNS что-то не так? Попробуйте сменить сервер.</p></td><td>2019-10-24T14:18:21.894Z</td></tr><tr><td>brook.qays</td><td><p>Попробовал, не помогло. Если бы проблема была с DNS, то на вебките она тоже должна была проявиться. При включенном proxy.pac в статусной строке Firefox во время загрузки незаблокированного сайта висит “Передача данных с <em>домен с которого идёт загрузка контента</em>”. То есть контент грузится и домены резолвятся, но внутри движка браузера что-то очень сильно замедляет процесс загрузки при включенном proxy.pac. Не удивлюсь если Firefox вовсе игнорирует правила и все сайты пускает через серверы Антизапрета. Есть подозрения что это баг 64-битной версии Firefox для Windows.</p></td><td>2019-10-24T14:44:13.543Z</td></tr><tr><td>ValdikSS</td><td><p>Протестировал на 64-битной Windows 7 с 64-битным Firefox 70.0 — всё в порядке. Видимо, это особенности вашей системы или DNS-сервера.</p>
<aside class="quote no-group" data-username="brook.qays" data-post="5" data-topic="185">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/b/85e7bf/48.png" class="avatar"> brook.qays:</div>
<blockquote>
<p>Есть подозрения что это баг 64-битной версии Firefox для Windows.</p>
</blockquote>
</aside>
<p>Незаблокированные сайты не будут открываться через прокси. Если бы браузер попытался их открыть через прокси, вы бы видели ошибку.</p></td><td>2019-10-24T16:20:54.922Z</td></tr><tr><td>brook.qays</td><td><p>Хотелось бы понять куда копать. Проверил на другой машине в той же сети (Firefox 69.0 64-bit, Windows 7 64-bit) - неблокированные ресурсы при включении proxy.pac также лагают исключительно в Firefox.</p>
<p>Методика тестирования:</p>
<ol>
<li>Отключаем proxy.pac в настройках Firefox</li>
<li>Открываем приватное окно</li>
<li>Включаем сетевой монитор Firefox из инструментов разработчика</li>
<li>Загружаем неблокированный url и дожидаемся полной загрузки</li>
<li>Записываем время DOMContentLoaded и load</li>
<li>Закрываем приватное окно</li>
<li>Включаем proxy.pac в настройках прокси</li>
<li>Открываем приватное окно и повторяем шаги с 3 по 5</li>
</ol>
<p>Результаты.</p>
<p>Proxy.pac отключен:</p>
<blockquote>
<p><a href="https://habr.com/ru/post/472780/" rel="noopener nofollow ugc">https://habr.com/ru/post/472780/</a><br>
DOMContentLoaded: 7,44 с<br>
load: 9,04 с</p>
</blockquote>
<pre><code>https://irecommend.ru/
DOMContentLoaded: 2,99 с
load: 4,75 с
</code></pre>
<p>Proxy.pac включен:</p>
<blockquote>
<p><a href="https://habr.com/ru/post/472780/" rel="noopener nofollow ugc">https://habr.com/ru/post/472780/</a><br>
DOMContentLoaded: 17,60 с<br>
load: 29,57 с</p>
</blockquote>
<pre><code>https://irecommend.ru/
DOMContentLoaded: 48,40 с
load: 1,24 мин
</code></pre></td><td>2019-10-25T10:29:00.208Z</td></tr><tr><td>ilyaigpetrov(ilyaigpetrov)</td><td><p>Попробуйте так:</p>
<ol>
<li>Скачать свежий PAC-скрипт (проделать обязательно).</li>
<li>Модифицировать в нём строчку, которая может вызывать замедление. Для начала можно заменить <code>dnsResolve(...)</code> на <code>null</code> и проверить, в DNS ли проблема.</li>
<li>Настроить FireFox на загрузку модифицированного скрипта из файловой системы или с localhost.</li>
</ol></td><td>2019-10-25T11:13:45.646Z</td></tr><tr><td>brook.qays</td><td><p>Благодарю, помогло. Заменил dnsResolve(…) на dnsResolve(null). Незаблокированные сайты загружаются без лагов, заблокированные тоже перестали лагать. Мой провайдер фильтрует по ip, поэтому резолвить имена через серверы Антизапрета это лишний overhead. Непонятно почему вебкит не ломается когда dnsResolve не выставлен в (null). Я так понимаю нельзя глобально выставить dnsResolve в (null), так как это сломает всё у пользователей чьи провайдеры подменяют ответы DNS?</p></td><td>2019-10-25T12:37:56.480Z</td></tr><tr><td>ilyaigpetrov(ilyaigpetrov)</td><td><p>Проверки одного лишь доменного имени недостаточно, чтобы соответствовать требованиям по блокировкам от РКН. Нужно также блочить те IP-адреса, которые никак не привязаны к доменным именам, именно такие ip и присутствуют в PAC-скрипте.</p>
<p>У вас не получится длительное время использовать модифицированный PAC-скрипт, нужно каждые N часов запрашивать новый скрипт для удовлетворения системы защиты от злоупотреблений прокси-серверами.</p></td><td>2019-10-25T14:30:02.129Z</td></tr><tr><td>ilyaigpetrov(ilyaigpetrov)</td><td><p>Убедитесь, что в настройках FireFox у вас отключен «DNS через HTTPS», т.к. один из серверов cloudflare, используемый для этого в FireFox, может быть блокирован вашим провайдером.</p></td><td>2019-10-25T14:44:41.320Z</td></tr><tr><td>ValdikSS</td><td><p>У вас проблемы с DNS, смените ваш DNS-сервер.</p></td><td>2019-10-25T14:47:28.579Z</td></tr><tr><td>ValdikSS</td><td><aside class="quote no-group" data-username="brook.qays" data-post="9" data-topic="185">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/b/85e7bf/48.png" class="avatar"> brook.qays:</div>
<blockquote>
<p>Мой провайдер фильтрует по ip, поэтому резолвить имена через серверы Антизапрета это лишний overhead.</p>
</blockquote>
</aside>
<p>Адреса резолвятся через системный DNS, а не через DNS антизапрета. Если ваш провайдер блокирует сайты по IP, антизапрет будет работать только частично, т.к. не предназначен для таких провайдеров.</p></td><td>2019-10-25T15:03:44.045Z</td></tr><tr><td>brook.qays</td><td><p>С помощью blockcheck v0.0.9.8 выяснил что проблемы с DNS на стороне провайдера и каноничные DNS-серверы прописывать бессмысленно.</p>
<blockquote>
<p>[!] Результат:<br>
[<img src="https://ntc.party/images/emoji/twitter/warning.png?v=12" title=":warning:" class="emoji" alt=":warning:" loading="lazy" width="20" height="20">] Ваш провайдер блокирует сторонние IPv4 DNS-серверы.<br>
Вам следует использовать шифрованный канал до DNS-серверов, например, через VPN, Tor, HTTPS/Socks прокси или DNSCrypt.<br>
[<img src="https://ntc.party/images/emoji/twitter/warning.png?v=12" title=":warning:" class="emoji" alt=":warning:" loading="lazy" width="20" height="20">] Ваш провайдер полностью блокирует доступ к HTTPS-сайтам из реестра.<br>
[<img src="https://ntc.party/images/emoji/twitter/warning.png?v=12" title=":warning:" class="emoji" alt=":warning:" loading="lazy" width="20" height="20">] У вашего провайдера “обычный” DPI. Вам поможет HTTPS/Socks прокси, VPN или Tor.</p>
</blockquote>
<p>DNSCrypt помог. Осталось 3 вопроса. Почему проблемы с DNS не проявляются в Opera и прочих браузерах на вебките? Почему проблемы проявляются в Firefox только при включенном прокси Антизапрета? Что означает переменная dnsResolve(null), резолвинг через DNS Антизапрета?</p>
<p>Неплохо было бы добавить в инструкцию Антизапрета предупреждение что Firefox не работает с Антизапретом без DNSCrypt при блокировках сторонних DNS-серверов. Установить и настроить DNSCrypt конечно несколько сложнее чем вбить url скрипта автонастройки прокси в настройки браузера, что явно не добавит лисе популярности.</p>
<p>Большое всем спасибо что помогли разобраться.</p></td><td>2019-10-25T18:09:39.452Z</td></tr><tr><td>ilyaigpetrov(ilyaigpetrov)</td><td><aside class="quote no-group" data-username="brook.qays" data-post="14" data-topic="185">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/b/85e7bf/48.png" class="avatar"> brook.qays:</div>
<blockquote>
<p>Что означает переменная dnsResolve(null), резолвинг через DNS Антизапрета?</p>
</blockquote>
</aside>
<pre data-code-wrap="js"><code class="lang-js">ip = dnsResolve(hostname);
</code></pre>
<p><code>hostname</code> – доменное имя.<br>
<code>dnsResolve</code> – функция, принимающая доменное имя и возвращающая ip-адрес.</p>
<p>Я советовал вам заменить <code>ip = dnsResolve(hostname)</code> на <code>ip = null</code>.<br>
То, как вы сделали, передав <code>null</code> вместо <code>hostname</code>, неожиданно тоже сработало, наверно, потому что функция может принимать ложные значения (<code>false</code>, <code>''</code>, <code>0</code>, <code>null</code> и т.п.) и возвращает для них что-то типа <code>null</code> вместо ip-адреса, как я догадываюсь.</p>
<aside class="quote no-group quote-modified" data-username="brook.qays" data-post="14" data-topic="185">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/b/85e7bf/48.png" class="avatar"> brook.qays:</div>
<blockquote>
<p>Установить и настроить DNSCrypt конечно несколько сложнее[…]</p>
</blockquote>
</aside>
<p>А попробуйте DNS over HTTPS: меню → Настройки → Основные → Параметры сети → Настроить… → Отметить галочкой “Включить DNS через HTTPS”.</p></td><td>2019-10-26T00:43:18.590Z</td></tr><tr><td>brook.qays</td><td><aside class="quote no-group" data-username="ilyaigpetrov" data-post="15" data-topic="185">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/i/5fc32e/48.png" class="avatar"> ilyaigpetrov:</div>
<blockquote>
<p>Я советовал вам заменить <code>ip = dnsResolve(hostname)</code> на <code>ip = null</code> .</p>
</blockquote>
</aside>
<p>Для чистоты эксперимента проверил <code>ip = null</code> - тоже сработало.</p>
<aside class="quote no-group" data-username="ilyaigpetrov" data-post="15" data-topic="185">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/i/5fc32e/48.png" class="avatar"> ilyaigpetrov:</div>
<blockquote>
<p>возвращает для них что-то типа <code>null</code> вместо ip-адреса, как я догадываюсь.</p>
</blockquote>
</aside>
<p>ip-адреса открываемого ресурса? Тогда откуда Firefox берёт его когда там <code>null</code>?</p>
<aside class="quote no-group" data-username="ilyaigpetrov" data-post="15" data-topic="185">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/i/5fc32e/48.png" class="avatar"> ilyaigpetrov:</div>
<blockquote>
<p>А попробуйте DNS over HTTPS: меню → Настройки → Основные → Параметры сети → Настроить… → Отметить галочкой “Включить DNS через HTTPS”.</p>
</blockquote>
</aside>
<p>Отключил DNSCrypt и включил DNS over HTTPS в Firefox.<br>
Proxy.pac отключен: неблокированные ресурсы отлично загружаются как при использовании дефолтного DoH-резолвера Cloudflare, так и при использовании стороннего, оба резолвера не блокируются провайдером и открываются без каких-либо проблем.<br>
Proxy.pac включен: с обоими DoH-резолверами неблокированные ресурсы лагают также как cо стандартными DNS.</p></td><td>2019-10-26T10:36:20.019Z</td></tr><tr><td>ilyaigpetrov(ilyaigpetrov)</td><td><aside class="quote no-group" data-username="brook.qays" data-post="16" data-topic="185">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/b/85e7bf/48.png" class="avatar"> brook.qays:</div>
<blockquote>
<p>ip-адреса открываемого ресурса? Тогда откуда Firefox берёт его когда там <code>null</code> ?</p>
</blockquote>
</aside>
<p>В PAC-скрипте есть главная функция, что-то типа main в других языках программирования, но тут она называется <code>FindProxyForURL(url, hostname)</code>. Эта функция вызывается при любом http-запросе браузера и в эту функцию передаются аргументы <code>url</code> и <code>hostname</code> для совершаемого запроса. <code>hostname</code> часто зовётся <code>host</code>, что я считаю неправильным (т.к. если адрес содержит порт, то это host, иначе hostname).</p>
<p>Так вот, внутри этой главной функции зовётся функция <code>dnsResolve(hostname)</code>. В переменной <code>hostname</code> лежит доменное имя запроса, как я описал в предыдущем абзаце. Если <code>hostname</code> заменить на <code>null</code>, то <code>dnsResolve</code> не знает, ip адрес какого доменного имени вы от него требуете и, как я догадываюсь, возвращает опять <code>null</code>, но уже в качестве результата работы (а не аргумента в скобочках в <code>dnsResolve(null)</code>). При таком “холостом” вызове DNS-запроса не совершается совсем.</p></td><td>2019-10-26T11:03:48.193Z</td></tr><tr><td>ilyaigpetrov(ilyaigpetrov)</td><td><p><a class="mention" href="/u/valdikss">@ValdikSS</a>, может, в этой версии FireFox <code>dnsResolve</code> использует системный DNS в обход DoH?</p></td><td>2019-10-26T11:15:03.724Z</td></tr><tr><td>ValdikSS</td><td><p>Я не вижу смысла разбираться в проблеме — очевидно, она вызвана проблемами с DNS.<br>
Если хотите разобраться, начните с записи трафика на порт 53.</p></td><td>2019-10-26T13:28:22.462Z</td></tr><tr><td>brook.qays</td><td><p>В PAC-скрипте используется не <code>hostname</code>, а <code>host</code>.<br>
<code>FindProxyForURL(url, host)</code><br>
<code>dnsResolve(host)</code><br>
и тд.</p>
<p>Если при “холостом” вызове DNS-запроса не совершается совсем, то откуда браузер берёт ip? Это любая версия Firefox 69.* - 70.*. Чем проще всего записать трафик на 53 порт?</p></td><td>2019-10-26T13:30:39.038Z</td></tr><tr><td>ValdikSS</td><td><p>dnsResolve вызывается на каждый запрос, к любым сайтам. Эта функция не обязательно будет работать точно так же, как резолв домена в браузере.</p></td><td>2019-10-26T13:35:15.278Z</td></tr><tr><td>ValdikSS</td><td><aside class="quote no-group" data-username="brook.qays" data-post="20" data-topic="185">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/b/85e7bf/48.png" class="avatar"> brook.qays:</div>
<blockquote>
<p>Чем проще всего записать трафик на 53 порт?</p>
</blockquote>
</aside>
<p><a href="https://www.wireshark.org/">Wireshark</a>.</p></td><td>2019-10-26T13:35:44.016Z</td></tr><tr><td>ilyaigpetrov(ilyaigpetrov)</td><td><aside class="quote no-group" data-username="brook.qays" data-post="20" data-topic="185">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/b/85e7bf/48.png" class="avatar"> brook.qays:</div>
<blockquote>
<p>Если при “холостом” вызове DNS-запроса не совершается совсем, то откуда браузер берёт ip? Это любая версия Firefox 69.* - 70.*. Чем проще всего записать трафик на 53 порт?</p>
</blockquote>
</aside>
<p><code>ip = dnsResolve(null)</code> и <code>ip = null</code> аналогичны по моей догадке. <code>ip</code> не присваивается строка с адресом, вместо этого ему присваивается значение <code>null</code> (не строка). Если говорить о том, откуда тогда браузер берёт ip для сайта вообще, т.е. вне PAC-скрипта, то там уже отдельный скрипт и он, скорей всего, не на js.</p></td><td>2019-10-26T13:45:46.077Z</td></tr><tr><td>brook.qays</td><td><p>Отправил всем в ЛС запись трафика на 53 порт. Всё записано при включенном proxy.pac, за исключением файла Firefox.pcapng. Особых отличий в запросах-ответах и таймингах между ними при лагах не вижу, но возможно что-то проглядел. Если они действительно не отличаются, тогда совсем непонятно почему движок Firefox ломается при включении proxy.pac.</p></td><td>2019-10-28T09:56:01.571Z</td></tr><tr><td>brook.qays</td><td><p>Благодарю всех за помощь, это баги Firefox.</p>
<ol>
<li>Функция dnsResolve блокирует движок, если для некоторых из запрашиваемых страницой доменов не приходит никакого ответа от DNS. Это не позволяет движку загрузить контент с остальных доменов пока блокировка не снимется по таймауту, что сильно замедляет загрузку страницы.</li>
<li>DNS-over-HTTPS не работает для функции dnsResolve. При включении DNS-over-HTTPS, все запросы функции dnsResolve идут к системному DNS на 53 порт.</li>
</ol></td><td>2019-10-29T11:35:47.023Z</td></tr><tr><td>ilyaigpetrov(ilyaigpetrov)</td><td><p>Создал <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1592248" rel="nofollow noopener">https://bugzilla.mozilla.org/show_bug.cgi?id=1592248</a>. 127.0.0.1 у меня тоже проксируется, PAC-скрипт для него срабатывает, dns-пакеты отсылаются.</p></td><td>2019-10-29T12:28:37.451Z</td></tr><tr><td>brook.qays</td><td><p>Странно что 127.0.0.1 проксируется, в Firefox на Windows он в исключениях. Второй баг тоже надо зарепортить, у них там какой-то говнокод, если сравнивать с вебкитом. Видимо в вебките это как-то асинхронно исполняется.</p></td><td>2019-10-29T16:44:07.279Z</td></tr><tr><td>ilyaigpetrov(ilyaigpetrov)</td><td><p>Попробуйте отправить им второй баг самостоятельно, я мало заинтересован в том, чтобы чинить FireFox для работы с блокировками на уровне DNS, мне нужно, чтобы наши PAC-скрипты работали у пользователей безопасно (т.е. через DoH) и независимо от системных DNS, когда нужно.</p></td><td>2019-10-29T17:14:31.388Z</td></tr><tr><td>brook.qays</td><td><p>Создал <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1592556" rel="nofollow noopener">https://bugzilla.mozilla.org/show_bug.cgi?id=1592556</a></p></td><td>2019-10-30T11:14:00.316Z</td></tr><tr><td>ilyaigpetrov(ilyaigpetrov)</td><td><p>WebKit-браузеры на windows – это, наверно, уже редкость, я ни одного не знаю. Хромиум перешёл на собственный движок Blink.</p></td><td>2019-10-30T11:28:17.820Z</td></tr><tr><td>brook.qays</td><td><p>Спасибо, дописал к репорту. Кстати, какой практический смысл в резолвинге через dnsResolve(), а не напрямую через движок?</p></td><td>2019-10-30T11:38:02.686Z</td></tr><tr><td>ilyaigpetrov(ilyaigpetrov)</td><td><p>Внутри PAC-скрипта вам не известен IP-адрес. Единственный способ там его получить – это dnsResolve. Почему dnsResolve работает не так, как адресная строка браузера, я не знаю. По идее dnsResolve отрабатывает до отправки DNS-запроса адресной строки (к примеру, этот dns-запрос вообще может быть передан прокси-серверу, установленному через PAC-скрипт).</p></td><td>2019-10-30T11:43:19.923Z</td></tr>
    </table>
      </body>
    </html>