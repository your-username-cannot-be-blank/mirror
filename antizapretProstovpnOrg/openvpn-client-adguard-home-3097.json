[
    {
        "id": 9918,
        "name": "",
        "username": "Joyz",
        "avatar_template": "/letter_avatar_proxy/v4/letter/j/b782af/{size}.png",
        "created_at": "2022-08-20T23:52:45.941Z",
        "cooked": "<p>На роутере поднят OpenVPN client antizapret и в локалке есть AdGuard Home.<br>\nМожно ли как по их подружить чтобы пользоваться этим одновременно или это заработает только если поднимать на удаленной VPS свой контейнер + AdGuard ?</p>",
        "post_number": 1,
        "post_type": 1,
        "posts_count": 9,
        "updated_at": "2022-08-20T23:52:45.941Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 988,
        "reads": 95,
        "readers_count": 94,
        "score": 4934.0,
        "yours": false,
        "topic_id": 3097,
        "topic_slug": "openvpn-client-adguard-home",
        "display_username": "",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 558,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": false,
        "wiki": false,
        "post_url": "/t/openvpn-client-adguard-home/3097/1",
        "can_translate": false
    },
    {
        "id": 9952,
        "name": null,
        "username": "ValdikSS",
        "avatar_template": "/user_avatar/ntc.party/valdikss/{size}/2_2.png",
        "created_at": "2022-08-22T16:22:28.937Z",
        "cooked": "<p>Инструкция от <a class=\"mention\" href=\"/u/dartraiden\">@dartraiden</a></p><aside class=\"onebox allowlistedgeneric\" data-onebox-src=\"https://dartraiden.github.io/AdGuard-Home-Keenetic/\">\n  <header class=\"source\">\n      <img src=\"openvpn-client-adguard-home-3097/ca168f6b7849e78cb6a28ba26d139146d17a7d4c.png\" class=\"site-icon\" data-dominant-color=\"563728\" width=\"32\" height=\"32\">\n\n      <a href=\"https://dartraiden.github.io/AdGuard-Home-Keenetic/\" target=\"_blank\" rel=\"noopener\" title=\"12:00AM - 13 December 2020\">Alexander Gavrilov – 13 Dec 20</a>\n  </header>\n\n  <article class=\"onebox-body\">\n    <img width=\"140\" height=\"140\" src=\"openvpn-client-adguard-home-3097/d9745616142fbf5bb84d4c592b6a85b5dee5e8fe.jpeg\" class=\"thumbnail onebox-avatar\" data-dominant-color=\"563727\">\n\n<h3><a href=\"https://dartraiden.github.io/AdGuard-Home-Keenetic/\" target=\"_blank\" rel=\"noopener\">Установка AdGuard Home на роутеры Keenetic</a></h3>\n\n  <p>Нужно понимать, что блокировка рекламы с помощью блокировки доменов никогда не будет столь же эффективным способом борьбы с рекламой, как AdblockPlus/uBlock в браузере. Бывают случаи, когда реклама загружается с того же домена, что и полезный...</p>\n\n\n  </article>\n\n  <div class=\"onebox-metadata\">\n    \n    \n  </div>\n\n  <div style=\"clear: both\"></div>\n</aside>\n",
        "post_number": 2,
        "post_type": 1,
        "posts_count": 9,
        "updated_at": "2022-08-22T16:22:28.937Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 30,
        "reads": 87,
        "readers_count": 86,
        "score": 167.4,
        "yours": false,
        "topic_id": 3097,
        "topic_slug": "openvpn-client-adguard-home",
        "display_username": null,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
            {
                "url": "https://dartraiden.github.io/AdGuard-Home-Keenetic/",
                "internal": false,
                "reflection": false,
                "title": "Установка AdGuard Home на роутеры Keenetic – Alexander Gavrilov – dartraiden",
                "clicks": 202
            }
        ],
        "read": true,
        "user_title": "AntiZapret staff",
        "title_is_group": false,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": true,
        "admin": true,
        "staff": true,
        "user_id": 1,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": false,
        "wiki": false,
        "post_url": "/t/openvpn-client-adguard-home/3097/2",
        "can_translate": false
    },
    {
        "id": 9958,
        "name": "Alexander Gavrilov",
        "username": "dartraiden",
        "avatar_template": "/user_avatar/ntc.party/dartraiden/{size}/15299_2.png",
        "created_at": "2022-08-22T19:14:10.891Z",
        "cooked": "<p>Принцип ровно так же, как и со встроенным DNS-сервером роутера</p>\n<ul>\n<li>клиентам в качестве DNS прописывается адрес AGH (где он там поднят в локалке)</li>\n<li>в настройках AGH в качестве апстрима указываются некоторые публичные DNS (обычные а-ля 8.8.8.8, не DoH/DoT)</li>\n<li>в конфиге OpenVPN на роутере трафик до всех этих публичных DNS с прошлого шага заворачивается в туннель командами <strong>route x.x.x.x</strong>\n</li>\n<li>дальше уже на стороне сервера antizapret этот DNS-трафик автоматически перехватывается и вместо этих публичных DNS отвечает DNS-сервер antizapret, ответ поступает к AGH, а от него клиентам =&gt; profit</li>\n</ul>",
        "post_number": 3,
        "post_type": 1,
        "posts_count": 9,
        "updated_at": "2022-08-22T19:18:06.913Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 38,
        "reads": 83,
        "readers_count": 82,
        "score": 206.6,
        "yours": false,
        "topic_id": 3097,
        "topic_slug": "openvpn-client-adguard-home",
        "display_username": "Alexander Gavrilov",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 3,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": "",
        "bookmarked": false,
        "actions_summary": [],
        "moderator": true,
        "admin": false,
        "staff": true,
        "user_id": 1450,
        "hidden": false,
        "trust_level": 3,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": false,
        "wiki": false,
        "post_url": "/t/openvpn-client-adguard-home/3097/3",
        "can_translate": false
    },
    {
        "id": 81626,
        "name": "",
        "username": "nirvana008",
        "avatar_template": "/letter_avatar_proxy/v4/letter/n/839c29/{size}.png",
        "created_at": "2025-01-26T16:29:49.716Z",
        "cooked": "<p>Здравствуйте, столкнулся с той же проблемой, что и автор темы. Не могу подружить OpenVPN клиент с антизапретом на Asus Merlin и adguard home, установленный на мини-сервере в моей локалке. Adguard хочу использовать как локальный dns-сервер. Пробовал различные настроить по всем инструкциям выше, не хотят работать вместе, либо перестают открываться сайты, либо не работает локальный домен. В чем может быть проблема? Может быть из-за того, что у меня роутер asus, нужно еще что-то настроить в нем?</p>",
        "post_number": 4,
        "post_type": 1,
        "posts_count": 9,
        "updated_at": "2025-01-26T16:29:49.716Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 0,
        "reads": 31,
        "readers_count": 30,
        "score": 6.2,
        "yours": false,
        "topic_id": 3097,
        "topic_slug": "openvpn-client-adguard-home",
        "display_username": "",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 9429,
        "hidden": false,
        "trust_level": 0,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": false,
        "wiki": false,
        "post_url": "/t/openvpn-client-adguard-home/3097/4",
        "can_translate": false
    },
    {
        "id": 81649,
        "name": "Alexander Gavrilov",
        "username": "dartraiden",
        "avatar_template": "/user_avatar/ntc.party/dartraiden/{size}/15299_2.png",
        "created_at": "2025-01-26T19:57:34.847Z",
        "cooked": "<p>Вряд ли я что-то могу сказать про то, почему не работает локальный домен.</p>",
        "post_number": 5,
        "post_type": 1,
        "posts_count": 9,
        "updated_at": "2025-01-26T19:57:34.847Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 0,
        "reads": 24,
        "readers_count": 23,
        "score": 4.8,
        "yours": false,
        "topic_id": 3097,
        "topic_slug": "openvpn-client-adguard-home",
        "display_username": "Alexander Gavrilov",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": "",
        "bookmarked": false,
        "actions_summary": [],
        "moderator": true,
        "admin": false,
        "staff": true,
        "user_id": 1450,
        "hidden": false,
        "trust_level": 3,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": false,
        "wiki": false,
        "post_url": "/t/openvpn-client-adguard-home/3097/5",
        "can_translate": false
    },
    {
        "id": 81651,
        "name": "",
        "username": "nirvana008",
        "avatar_template": "/letter_avatar_proxy/v4/letter/n/839c29/{size}.png",
        "created_at": "2025-01-26T20:09:25.363Z",
        "cooked": "<p>Складывается впечатление, что они мешают друг, поэтому работает либо vpn, либо adguard. В файле конфигурации vpn прописывал route с ip подсети, с ip роутера, с ip adguard, добавлял строчку dhcp-option DNS, менял access DNS на exclusive, ничего не помогает. В adguard прописывал upstream серверы такие же, как и в конфигурации VPN и отличные от внешних DNS, тоже не помогает, как только указываю adguard в качестве dns сервера, даже тест upstream перестают проходить. Может быть стоит dnsmasq использовать для локального DNS сервера?</p>",
        "post_number": 6,
        "post_type": 1,
        "posts_count": 9,
        "updated_at": "2025-01-26T20:09:25.363Z",
        "reply_count": 1,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 0,
        "reads": 25,
        "readers_count": 24,
        "score": 10.0,
        "yours": false,
        "topic_id": 3097,
        "topic_slug": "openvpn-client-adguard-home",
        "display_username": "",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 9429,
        "hidden": false,
        "trust_level": 0,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": false,
        "wiki": false,
        "post_url": "/t/openvpn-client-adguard-home/3097/6",
        "can_translate": false
    },
    {
        "id": 81663,
        "name": "Alexander Gavrilov",
        "username": "dartraiden",
        "avatar_template": "/user_avatar/ntc.party/dartraiden/{size}/15299_2.png",
        "created_at": "2025-01-26T21:07:51.411Z",
        "cooked": "<aside class=\"quote no-group\" data-username=\"nirvana008\" data-post=\"6\" data-topic=\"3097\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://ntc.party/letter_avatar_proxy/v4/letter/n/839c29/48.png\" class=\"avatar\"> nirvana008:</div>\n<blockquote>\n<p>route с ip подсети, с ip роутера, с ip adguard</p>\n</blockquote>\n</aside>\n<p>Ну, это совсем бессмысленно, вы же понимаете.</p>\n<p>Что даёт route x.x.x.x? Это указание, что трафик к x.x.x.x нужно отправить в туннель. То есть, вы трафик, который предназначен локальному вашему AGH, зачем-то роутите в туннель. Типа “у меня в квартире в соседней комнате бабушка, так чтобы с ней пообщаться я буду писать в Германию”. Это даже в теории никак помочь не сможет.</p>\n<p>Схема маршрутизации DNS-трафика должна быть такая:<br>\n<code>клиент -&gt; роутер -&gt; AGH -&gt; публичный plain-text DNS</code></p>\n<p>Разделим задачу на две части</p>\n<h3><a name=\"p-81663-h-1-1\" class=\"anchor\" href=\"#p-81663-h-1-1\"></a>Часть 1</h3>\n<p>Добейтесь сначала того, чтобы это работало. Без всякого АнтиЗапрета (лучше пока вообще подключение к АнтиЗапрету снести, чтобы не мешалось). Убедитесь на клиенте (клиентском устройве типа смартфона или ПК), что ему по DHCP в качестве DNS пришёл адрес роутера. Затем убедитесь, что роутер использует в качестве апстрим-DNS AGH (например, заблокируйте на AGH какой-то домен и убедитесь, что он стал недоступен на клиентах). В AGH соответственно в качестве апстрима укажите публичный DNS типа 8.8.8.8 (не шифрованный).</p>\n<h3><a name=\"p-81663-h-2-2\" class=\"anchor\" href=\"#p-81663-h-2-2\"></a>Часть 2</h3>\n<p>Когда у вас всё будет работать именно таким образом, уже пытайтесь в эту схему встроить АнтиЗапрет. Обычно это делается путём помещения в конфиг OVPN директивы <code>route 8.8.8.8</code> (тот адрес, который в AGH используется как апстрим).</p>\n<p>Благодаря этому схема получится <code>клиент -&gt; роутер -&gt; AGH -&gt; АнтиЗапрет</code> (т.к. трафик до публичного plain-text DNS будет ловиться АнтиЗапретом).</p>\n<p>Где-то тут на форуме была тема про асусы, там был нюанс, что есть такая пакость, как VPN Director на асусах (в настройках) и что-то там в нём нужно было сделать. Но в любом случае это уже вторая часть уравнения.</p>",
        "post_number": 7,
        "post_type": 1,
        "posts_count": 9,
        "updated_at": "2025-01-26T21:20:28.254Z",
        "reply_count": 1,
        "reply_to_post_number": 6,
        "quote_count": 1,
        "incoming_link_count": 2,
        "reads": 20,
        "readers_count": 19,
        "score": 19.0,
        "yours": false,
        "topic_id": 3097,
        "topic_slug": "openvpn-client-adguard-home",
        "display_username": "Alexander Gavrilov",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 4,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": "",
        "bookmarked": false,
        "actions_summary": [],
        "moderator": true,
        "admin": false,
        "staff": true,
        "user_id": 1450,
        "hidden": false,
        "trust_level": 3,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": false,
        "wiki": false,
        "post_url": "/t/openvpn-client-adguard-home/3097/7",
        "can_translate": false
    },
    {
        "id": 81673,
        "name": "",
        "username": "nirvana008",
        "avatar_template": "/letter_avatar_proxy/v4/letter/n/839c29/{size}.png",
        "created_at": "2025-01-26T21:43:59.693Z",
        "cooked": "<p>route использовал по одной из инструкций в интернете, решил попробовать, вдруг поможет, но не помогло. При отключении клиента vpn, adguard работает без проблем, как только включаю vpn, adguard перестает работать.<br>\nVPN director выключил, как было написано на этом форуме в одной из тем, так как он как я понял начинает весь трафик перенаправлять через vpn и прилетает бан от антизапрета.<br>\nОдинаковый публичный dns одинаковый указывал как в конфигурации OpenVPN, так и upstream сервер, не помогает.<br>\nХочу еще попробовать указать ip dns сервера adguard как в конфигурации на сервере, так и на клиенте, может быть это поможет</p>",
        "post_number": 8,
        "post_type": 1,
        "posts_count": 9,
        "updated_at": "2025-01-26T21:43:59.693Z",
        "reply_count": 0,
        "reply_to_post_number": 7,
        "quote_count": 0,
        "incoming_link_count": 0,
        "reads": 22,
        "readers_count": 21,
        "score": 4.4,
        "yours": false,
        "topic_id": 3097,
        "topic_slug": "openvpn-client-adguard-home",
        "display_username": "",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "reply_to_user": {
            "username": "dartraiden",
            "name": "Alexander Gavrilov",
            "avatar_template": "/user_avatar/ntc.party/dartraiden/{size}/15299_2.png"
        },
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 9429,
        "hidden": false,
        "trust_level": 0,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": false,
        "wiki": false,
        "post_url": "/t/openvpn-client-adguard-home/3097/8",
        "can_translate": false
    },
    {
        "id": 81675,
        "name": "Alexander Gavrilov",
        "username": "dartraiden",
        "avatar_template": "/user_avatar/ntc.party/dartraiden/{size}/15299_2.png",
        "created_at": "2025-01-26T21:46:46.455Z",
        "cooked": "<p>Да можно же просто трассировку запустить до условного 8.8.8.8 с указанием 53 порта и посмотреть, по какому маршруту оно идёт. Например, nmap позволяет указать порт<br>\n<code>sudo nmap -Pn --traceroute -p 53 8.8.8.8</code></p>",
        "post_number": 9,
        "post_type": 1,
        "posts_count": 9,
        "updated_at": "2025-01-26T21:49:53.777Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 0,
        "reads": 23,
        "readers_count": 22,
        "score": 4.6,
        "yours": false,
        "topic_id": 3097,
        "topic_slug": "openvpn-client-adguard-home",
        "display_username": "Alexander Gavrilov",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": "",
        "bookmarked": false,
        "actions_summary": [],
        "moderator": true,
        "admin": false,
        "staff": true,
        "user_id": 1450,
        "hidden": false,
        "trust_level": 3,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": false,
        "wiki": false,
        "post_url": "/t/openvpn-client-adguard-home/3097/9",
        "can_translate": false
    }
]