
    <html>
      <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <style>
    th, td {
      border: 1px solid black;
      border-collapse: collapse;
    }
    th, td {
      word-wrap: break-word;
      padding: 5px;
    }
    table {
      width: 100%;
      max-width: 100%;
      border: 1px solid black;
      border-collapse: collapse;
      table-layout: fixed;
      word-wrap: break-word
    }
    code {
      word-wrap: break-word;
    }
    pre {
        white-space: pre-wrap;
    }
    </style>
        <title>неофициальный-docker-контейнер-антизапрета-8839</title>
      </head>
      <body>
        <table border="1" width="100%" cellpadding="5">
          <tr>
            <th style="width: 10%;">Ник</th>
            <th>Пост</th>
            <th style="width: 10%;">Дата</th>
          </tr>
    <tr><td>crubik(Crubik)</td><td><p>Здравствуйте.<br>
Установил на VPS по этой инструкции <a href="https://github.com/GubernievS/AntiZapret-VPN-Container/blob/main/README.md" class="inline-onebox" rel="noopener nofollow ugc">AntiZapret-VPN-Container/README.md at main · GubernievS/AntiZapret-VPN-Container · GitHub</a> - всё хорошо. Вопрос - можно ли обновить OpenVPN, т.к. версия уж очень старая?<br>
<div class="lightbox-wrapper"><a class="lightbox" href="неофициальный-docker-контейнер-антизапрета-8839/70351dfda9a678731244a7c4d831fb1bcbde9fcf.png" data-download-href="https://ntc.party/uploads/default/70351dfda9a678731244a7c4d831fb1bcbde9fcf" title="Screenshot_14"><img src="неофициальный-docker-контейнер-антизапрета-8839/70351dfda9a678731244a7c4d831fb1bcbde9fcf.png" alt="Screenshot_14" data-base62-sha1="g0Dhl1A7mE8iA8MvbllJFEqYdJR" width="690" height="59" data-dominant-color="7C7B7C"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">Screenshot_14</span><span class="informations">1255×108 9.38 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p></td><td>2024-08-06T12:41:57.468Z</td></tr><tr><td>xtrime</td><td><p>Так как базовый образ старый (Debian 10), то там будет не самая последняя версия в apt. Можно начать с apt update -y &amp;&amp; apt upgrade -y внутри контейнера.</p>
<p>Если нужна прям последняя версия то надо собирать руками. У себя в docker я так делаю: <a href="https://github.com/xtrime-ru/antizapret-vpn-docker/blob/master/Dockerfile#L19" class="inline-onebox" rel="noopener nofollow ugc">antizapret-vpn-docker/Dockerfile at master · xtrime-ru/antizapret-vpn-docker · GitHub</a></p></td><td>2024-08-06T13:43:13.407Z</td></tr><tr><td>crubik(Crubik)</td><td><p>очень даже спасибо. ваша версия докера более свежая. удобно</p></td><td>2024-08-06T19:53:41.396Z</td></tr><tr><td>xtrime</td><td><p>Я сегодня переделал сборку, перешел на ubuntu 24.04 и последние версии OpenVPN и дополнительно поставил <a href="https://openvpn.net/as-docs/tutorials/tutorial--turn-on-openvpn-dco.html" rel="noopener nofollow ugc">openvpn-dco</a>.</p>
<p>По идее должно стать быстрее, но я не тестил какая нагрузка была на роутере до обновления сервера.</p></td><td>2024-08-06T19:59:07.223Z</td></tr><tr><td>Oless</td><td><p>Добрый день! А инструкцией или скриптом не поделитесь? а то уж больно не расторопный дефолтный контейнер, а DCO как никак должно дать прирост из-за драйвера ядра</p></td><td>2024-08-09T07:05:27.236Z</td></tr><tr><td>crubik(Crubik)</td><td><aside class="quote no-group" data-username="Oless" data-post="5" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/o/b5ac83/48.png" class="avatar"> Oless:</div>
<blockquote>
<p>а DCO как никак должно дать прирост из-за драйве</p>
</blockquote>
</aside>
<aside class="onebox githubrepo" data-onebox-src="https://github.com/xtrime-ru/antizapret-vpn-docker">
  <header class="source">

      <a href="https://github.com/xtrime-ru/antizapret-vpn-docker" target="_blank" rel="noopener nofollow ugc">github.com</a>
  </header>

  <article class="onebox-body">
    <div class="github-row" data-github-private-repo="false">
  <img width="690" height="344" src="неофициальный-docker-контейнер-антизапрета-8839/3f4178cf7cc0e54e77da75dbf645e8b493f49c39_2_690x344.png" class="thumbnail" data-dominant-color="EBEDED">

  <h3><a href="https://github.com/xtrime-ru/antizapret-vpn-docker" target="_blank" rel="noopener nofollow ugc">GitHub - xtrime-ru/antizapret-vpn-docker: Docker container with antizapret-vpn for...</a></h3>

    <p><span class="github-repo-description">Docker container with antizapret-vpn for selfhosting.</span></p>
</div>

  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>
</td><td>2024-08-09T08:26:09.236Z</td></tr><tr><td>xtrime</td><td><p>Я, правда, не смог определить включилось ли DCO и есть ли улучшения <img src="https://ntc.party/images/emoji/twitter/slight_smile.png?v=12" title=":slight_smile:" class="emoji" alt=":slight_smile:" loading="lazy" width="20" height="20"></p></td><td>2024-08-09T08:49:59.064Z</td></tr><tr><td>Xunlei</td><td><pre><code class="lang-auto">ip -details link show
</code></pre>
<p>Должно быть написано dco у виртуального интерфейса. Улучшения есть на десятки %.</p></td><td>2024-08-09T10:19:57.552Z</td></tr><tr><td>overherz(overherz)</td><td><p>как в твоем контейнер добавлять новые домены? в список внес, перезагрузил контейнер и ничего не меняется</p></td><td>2024-08-09T10:27:38.359Z</td></tr><tr><td>xtrime</td><td><p>Как и всегда - подождать пару минут, пока правила не обновятся. При старте kresd запускается сразу, но со существующими списками.</p></td><td>2024-08-09T10:29:21.652Z</td></tr><tr><td>overherz(overherz)</td><td><p>да уже минут 20 жду ) поэтому вопрос возник</p></td><td>2024-08-09T10:30:19.677Z</td></tr><tr><td>xtrime</td><td><aside class="quote no-group" data-username="Xunlei" data-post="8" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/x/8e7dd6/48.png" class="avatar"> Xunlei:</div>
<blockquote>
<p><code>ip -details link show</code></p>
</blockquote>
</aside>
<p>Да, видел в доках команду. Там ничего нет:<br>
<div class="lightbox-wrapper"><a class="lightbox" href="неофициальный-docker-контейнер-антизапрета-8839/9da53d5f8d61856b60b96185f7eacb37e7a5860e.jpeg" data-download-href="https://ntc.party/uploads/default/9da53d5f8d61856b60b96185f7eacb37e7a5860e" title="image"><img src="неофициальный-docker-контейнер-антизапрета-8839/9da53d5f8d61856b60b96185f7eacb37e7a5860e_2_690x69.jpeg" alt="image" data-base62-sha1="muAZdrHY30jQoupOgL0hiviJiJ8" width="690" height="69" srcset="неофициальный-docker-контейнер-антизапрета-8839/9da53d5f8d61856b60b96185f7eacb37e7a5860e_2_690x69.jpeg, неофициальный-docker-контейнер-антизапрета-8839/9da53d5f8d61856b60b96185f7eacb37e7a5860e_2_1035x103.jpeg 1.5x, неофициальный-docker-контейнер-антизапрета-8839/9da53d5f8d61856b60b96185f7eacb37e7a5860e_2_1380x138.jpeg 2x" data-dominant-color="333533"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">1920×194 64.4 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p></td><td>2024-08-09T10:31:21.871Z</td></tr><tr><td>xtrime</td><td><p>Я проверю, но если автоматически не запускатеся, то можно руками дернуть:</p>
<pre><code class="lang-auto">docker exec antizapret-vpn  bash -c "cd /root/antizapret &amp;&amp; ./doall.sh"
</code></pre></td><td>2024-08-09T10:33:21.791Z</td></tr><tr><td>Xunlei</td><td><p>Он включится автоматически, если используется</p>
<pre><code class="lang-auto">proto udp
topology subnet
cipher AES-256-GCM
tls-crypt
</code></pre></td><td>2024-08-09T10:37:55.242Z</td></tr><tr><td>overherz(overherz)</td><td><p>отбой, я серваки перепутал ) все работает, спасибо</p></td><td>2024-08-09T10:40:14.542Z</td></tr><tr><td>xtrime</td><td><aside class="quote no-group" data-username="Xunlei" data-post="14" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/x/8e7dd6/48.png" class="avatar"> Xunlei:</div>
<blockquote>
<pre><code class="lang-auto">cipher AES-256-GCM
tls-crypt
</code></pre>
</blockquote>
</aside>
<p>насколько я знаю AES-128-GCM тоже подходит. А вот про tls-crypt не слышал ничего. Сейчас попробую, спасибо!</p></td><td>2024-08-09T10:40:16.999Z</td></tr><tr><td>Xunlei</td><td><p>Да, должно работать, сейчас в коде:</p>
<pre><code class="lang-auto">const char *
dco_get_supported_ciphers(void)
{
    return "AES-128-GCM:AES-256-GCM:AES-192-GCM:CHACHA20-POLY1305";
}
</code></pre></td><td>2024-08-09T10:44:41.237Z</td></tr><tr><td>xtrime</td><td><aside class="quote no-group" data-username="Xunlei" data-post="14" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/x/8e7dd6/48.png" class="avatar"> Xunlei:</div>
<blockquote>
<p><code>tls-crypt</code></p>
</blockquote>
</aside>
<p>А есть пример как настроить? Я смотрю там надо ключи генерить для сервера и клиента. И есть еще новая версия tls-crypt-v2 с разными ключами для каждого клиента… <img src="https://ntc.party/images/emoji/twitter/thinking.png?v=12" title=":thinking:" class="emoji" alt=":thinking:" loading="lazy" width="20" height="20"></p></td><td>2024-08-09T10:46:53.815Z</td></tr><tr><td>Xunlei</td><td><pre><code class="lang-auto">openvpn --genkey secret ta.key
</code></pre>
<p>На сервере</p>
<pre><code class="lang-auto">tls-crypt ta.key 0
</code></pre>
<p>На клиенте</p>
<pre><code class="lang-auto">key-direction 1
tls-crypt ta.key 1
</code></pre>
<p>Или что-то в этом роде, у меня скрипт на go конфиг гененрирует с inline ключём.</p>
<p>tls-crypt-v2 не вижу поддержки в DCO</p></td><td>2024-08-09T10:51:26.166Z</td></tr><tr><td>xtrime</td><td><aside class="quote no-group" data-username="Xunlei" data-post="19" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/x/8e7dd6/48.png" class="avatar"> Xunlei:</div>
<blockquote>
<pre><code class="lang-auto">key-direction 1
tls-crypt ta.key 1
</code></pre>
</blockquote>
</aside>
<p>Ага, спасибо! Сhatpgt подсказал, как содержимое ключа прописать в ovpn файле. Тестирую.</p></td><td>2024-08-09T10:53:20.651Z</td></tr><tr><td>drno88</td><td><p>Привет. за докер спасибо отдельное, lxc крут, но не всегда подходит для конкретного окружения \ сервера.<br>
Есть ньюанс - как можно добавить в впн весь траф?<br>
на оригинале антизапрета пришлось подправить knot чтоб разрешить доступ к днс для всего трафика<br>
ну и на клиенте redirect-gateway def1 bypass-dhcp</p>
<p>тут наверно не сохранятся же изменения в контейнере?</p></td><td>2024-08-09T12:08:10.031Z</td></tr><tr><td>abrikman(Alexander K)</td><td><p>Да, с новой сборкой офигенно полетело всё.<br>
2 вопроса, которые меня мучают - чем чреват запуск doall.sh скажем раз в сутки? А то он каждые 6 часов запускается и могут быть фризы.<br>
А второй вопрос - где посмотреть список всех клиентов, которые к контейнеру подключены?</p></td><td>2024-08-09T12:09:40.649Z</td></tr><tr><td>xtrime</td><td><aside class="quote no-group" data-username="Xunlei" data-post="17" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/x/8e7dd6/48.png" class="avatar"> Xunlei:</div>
<blockquote>
<p><code>dco_get_supported_ciphers</code></p>
</blockquote>
</aside>
<p>Добавил --verb 3 в аргументы запуска openvpn и при старте появилось</p>
<pre><code class="lang-auto">Aug 09 12:18:26 22d5d25249d2 openvpn[1084]: Note: Kernel support for ovpn-dco missing, disabling data channel offload.
</code></pre>
<p>При том что я устанавливаю openvpn-dco-dkms! Буду разбираться. Но наконец то ясность появилась!</p></td><td>2024-08-09T12:23:57.619Z</td></tr><tr><td>h7n14(H7n14je)</td><td><p>У меня стоит 12 часов и проблем не испытывал. Разве что может быть если условный <a href="http://example.com" rel="noopener nofollow ugc">example.com</a> появится в <a href="https://raw.githubusercontent.com/zapret-info/z-i/master/dump.csv" rel="noopener nofollow ugc">https://raw.githubusercontent.com/zapret-info/z-i/master/dump.csv</a> то ты его в худшем случае получишь через 18 часов. Тут скорее вопрос как часто тебе надо иметь как можно более свежие списки блокировок. наверное🤔.</p>
<p>По второму неуверен но в соседней теме <a href="https://ntc.party/t/%D1%81%D0%BA%D1%80%D0%B8%D0%BF%D1%82-%D0%B4%D0%BB%D1%8F-%D0%B0%D0%B2%D1%82%D0%BE%D0%BC%D0%B0%D1%82%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%BE%D0%B3%D0%BE-%D1%80%D0%B0%D0%B7%D0%B2%D0%B5%D1%80%D1%82%D1%8B%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-antizapret-vpn-container-youtube/8379">Скрипт для автоматического развертывания AntiZapret VPN Container + YouTube</a> по ссылке на гитхаб написано следующее</p>
<pre><code class="lang-auto">Посмотреть статистику подключений OpenVpn (выход Ctrl+X)
sudo lxc exec antizapret-vpn -- nano /etc/openvpn/server/logs/status.log -v
</code></pre></td><td>2024-08-09T12:24:42.752Z</td></tr><tr><td>xtrime</td><td><aside class="quote no-group" data-username="drno88" data-post="21" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/d/ce7236/48.png" class="avatar"> drno88:</div>
<blockquote>
<p>тут наверно не сохранятся же изменения в контейнере?</p>
</blockquote>
</aside>
<p>При перезапуске контейнера все изменения сохраняются. При пересоздании - удалятся. Можно руками поправить нужные файлы или добавить в init.sh нужные скрипты, что бы они выполнялись при старте, а потом пересобрать контейнер docker compose built. Тогда локально будет образ со всеми исправлениями.</p>
<p>Но сейчас я активно вношу правки в репозиторий, так что в будущем будут проблемы с обновлением из за конфликтов. Лучше наверное подождать немного, пока весь код не перетащу из оригинального репозитория в мой.</p>
<p>Но если надо весь траф пустить через VPN, то я бы рекомендовал поднять обычный IPSec и/или L2TP. Поддержка этих протоколов есть везде, а скорость будет в разы выше.</p>
<p>Я у себя вот это использую: <a href="https://github.com/hwdsl2/docker-ipsec-vpn-server" class="inline-onebox" rel="noopener nofollow ugc">GitHub - hwdsl2/docker-ipsec-vpn-server: Docker image to run an IPsec VPN server, with IPsec/L2TP, Cisco IPsec and IKEv2</a></p></td><td>2024-08-09T12:30:55.822Z</td></tr><tr><td>abrikman(Alexander K)</td><td><p>Да не сказать чтобы часто, пусть появляется через 18 часов, это лучше чем кратковременные фризы.<br>
А за команды спасибо, то что искал и никак не нашел.</p></td><td>2024-08-09T12:34:03.944Z</td></tr><tr><td>abrikman(Alexander K)</td><td><p>А вот такой вопрос - планируется ли использование sndbuf и rcvbuf в клиенте и сервере? Я поставил коненчо себе по 4 мегабайта буферы, на старой сборке сильно помогло, а вот на новой по инерции перенес.<br>
И не могу понять оправданы они или нет <img src="https://ntc.party/images/emoji/twitter/slight_smile.png?v=12" title=":slight_smile:" class="emoji" alt=":slight_smile:" loading="lazy" width="20" height="20"></p></td><td>2024-08-09T12:37:46.345Z</td></tr><tr><td>drno88</td><td><p>мне не к спеху, у меня и обычная lxc версия отлично работает)<br>
IPsec я ненавижу, l2tp давно лочится местами)</p>
<p>просто все сервисы уже перевел на докер, этот по сути последний остался))</p>
<p>для скорости и мобил xray есть))</p>
<p>все ясно, ждемс, пасибо)</p></td><td>2024-08-09T12:56:08.914Z</td></tr><tr><td>xtrime</td><td><p>Разобрался с dkms!</p>
<p><a href="https://openvpn.net/as-docs/docker.html#limitations-and-known-issues" class="inline-onebox" rel="noopener nofollow ugc">Official Docker VPN Server with Access Server | OpenVPN</a> - написано, что для того что бы работал нужно ставить на хостовую машину!</p>
<pre><code class="lang-auto">DCO: You can enable DCO with Access Server if you install and load it on the host Linux system.
</code></pre>
<p>Проверяю, будет ли работать openvpn внутри контейнера с хостовым расширением ядра.</p></td><td>2024-08-09T13:13:02.717Z</td></tr><tr><td>xtrime</td><td><aside class="quote no-group" data-username="xtrime" data-post="29" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/xtrime/48/1524_2.png" class="avatar"> xtrime:</div>
<blockquote>
<p>Проверяю, будет ли работать openvpn внутри контейнера с хостовым расширением ядра.</p>
</blockquote>
</aside>
<p>Поднял для теста виртуалку с ubutnu24.04 (в более ранних версиях нет готового пакета dco)<br>
Установил на хосте apt install openvpn-dco-dkms и все заработало в контейнере.<br>
Нагрузка на cpu на сервере упала почти до 0!</p>
<p>Обновляю контейнер и делаю инструкцию.</p></td><td>2024-08-09T14:50:11.198Z</td></tr><tr><td>abrikman(Alexander K)</td><td><aside class="quote no-group" data-username="xtrime" data-post="30" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/xtrime/48/1524_2.png" class="avatar"> xtrime:</div>
<blockquote>
<p>Обновляю контейнер и делаю инструкцию.</p>
</blockquote>
</aside>
<p>забираем? <img src="https://ntc.party/images/emoji/twitter/slight_smile.png?v=12" title=":slight_smile:" class="emoji" alt=":slight_smile:" loading="lazy" width="20" height="20"></p></td><td>2024-08-09T15:12:30.602Z</td></tr><tr><td>xtrime</td><td><p>Готово!</p>
<p>Вот инструкция: <a href="https://github.com/xtrime-ru/antizapret-vpn-docker?tab=readme-ov-file#enable-openvpn-data-channel-offload-dco" class="inline-onebox" rel="noopener nofollow ugc">GitHub - xtrime-ru/antizapret-vpn-docker: Docker container with antizapret-vpn for selfhosting.</a></p>
<p>В старых конфигах сервера был в списке алгоритмов AES-128-CBC, из за него не включится dco. Либо обновить контейнер, либо удалить в конфигах руками.</p>
<p>Там для свежих систем (24 убунта и новее) и ручная установка deb пакета для 20-22 убунт.</p>
<p>Проверил на 24 и 22 убунтах - все прекрасно:</p>
<ul>
<li>В логах пишется, что dco включен</li>
<li>В ip -details link show появилась пометка ovpn-dco</li>
</ul></td><td>2024-08-09T15:24:11.548Z</td></tr><tr><td>xtrime</td><td><aside class="quote no-group" data-username="Xunlei" data-post="14" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/x/8e7dd6/48.png" class="avatar"> Xunlei:</div>
<blockquote>
<p><code>tls-crypt</code></p>
</blockquote>
</aside>
<p>tls-crypt кстати не требуется для DCO. Не стал его влючать, иначе все клиентские ключи надо будет перегенеривать. Да и нагрузка увеличится из за шифрования.</p></td><td>2024-08-09T15:37:00.891Z</td></tr><tr><td>Xunlei</td><td><p>Понятно, это доп. защита от сканирования (аналог PresharedKey в wireguard).</p></td><td>2024-08-09T15:40:10.854Z</td></tr><tr><td>abrikman(Alexander K)</td><td><p>Класс, пересобрал прям с нуля всё у себя и раскатал на все роутеры которые к моему контейнеру подключены. Всё работает, всё грузится, но</p>
<pre><code class="lang-auto">sndbuf 3670016
rcvbuf 3670016
</code></pre>
<p>всё равно себе вернул <img src="https://ntc.party/images/emoji/twitter/slight_smile.png?v=12" title=":slight_smile:" class="emoji" alt=":slight_smile:" loading="lazy" width="20" height="20"></p></td><td>2024-08-09T15:53:57.671Z</td></tr><tr><td>xtrime</td><td><p>Это только для серверного конфига? Замеры проводил?</p>
<p>UP: Для DCO в доках openvpn рекомендуют mtu 1420 выставить, но у меня чет через tun-mtu 1420 не срабатывает, в логах всеравно другие значения пишутся…</p></td><td>2024-08-09T15:55:12.968Z</td></tr><tr><td>abrikman(Alexander K)</td><td><aside class="quote no-group" data-username="xtrime" data-post="36" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/xtrime/48/1524_2.png" class="avatar"> xtrime:</div>
<blockquote>
<p>Это только для серверного конфига? Замеры проводил?</p>
</blockquote>
</aside>
<p>и на сервере добавил (в контейнере) и на клиенте (в конфиге роутера openvpn)</p>
<p>Замеры да, без этих параметров - открываю ютуб с веба, жду секунды 4-5 - начинает играть в 1080 при доступном 4к, скорость 20-30 мегабит и разгоняется<br>
С параметрами - открываю ютуб с веба, жду меньше секунды - играет сразу в 4к и скорость сразу под 100 мегабит если стате ютуба верить и разгоняется до 300 (канал дома - 500)</p></td><td>2024-08-09T16:07:03.437Z</td></tr><tr><td>ShiGhost(ShiGhost)</td><td><p>ChatGPT говорит что он нужен ещё для скрытия протокола. Так что думаю нужно добавить.<br>
<div class="lightbox-wrapper"><a class="lightbox" href="неофициальный-docker-контейнер-антизапрета-8839/1e947b419e8c25572b90ec5680e54426ac485b88.png" data-download-href="https://ntc.party/uploads/default/1e947b419e8c25572b90ec5680e54426ac485b88" title="Screenshot_25"><img src="неофициальный-docker-контейнер-антизапрета-8839/1e947b419e8c25572b90ec5680e54426ac485b88.png" alt="Screenshot_25" data-base62-sha1="4mwrxuiXsMMnbgAzHcKKkgmquiA" width="690" height="360" data-dominant-color="2F2F2F"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">Screenshot_25</span><span class="informations">1352×706 43.2 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p></td><td>2024-08-09T16:12:15.271Z</td></tr><tr><td>xtrime</td><td><p>Супер. Сделаю в выходные тогда.</p></td><td>2024-08-09T16:19:42.037Z</td></tr><tr><td>xtrime</td><td><p>Новая версия готова:</p><aside class="onebox allowlistedgeneric" data-onebox-src="https://github.com/xtrime-ru/antizapret-vpn-docker/releases/tag/v3.0.0">
  <header class="source">
      <img src="https://ntc.party/uploads/default/original/2X/b/bad3e5f9ad67c1ddf145107ce7032ac1d7b22563.svg" class="site-icon" data-dominant-color="" width="32" height="32">

      <a href="https://github.com/xtrime-ru/antizapret-vpn-docker/releases/tag/v3.0.0" target="_blank" rel="noopener">GitHub</a>
  </header>

  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:690/344;"><img src="неофициальный-docker-контейнер-антизапрета-8839/06b6472c9493fbd2df5a72c87b97e48be3cc0d17_2_690x345.png" class="thumbnail" data-dominant-color="EFF1F1" width="690" height="345"></div>

<h3><a href="https://github.com/xtrime-ru/antizapret-vpn-docker/releases/tag/v3.0.0" target="_blank" rel="noopener">Release v3.0.0 · xtrime-ru/antizapret-vpn-docker</a></h3>

  <p>Features:

Enable tls-crypt for additional security and obfuscation
Redirect journal to stdout / docker logs

Refactoring:

Include all source code from https://bitbucket.org/anticensority/antizapr...</p>


  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

<ol>
<li>Добавлен tls-crypt</li>
<li>Добавил рекомендуемые опции для mtu и  sndbuf/rcvbuf</li>
<li>Перенаправление всех логов в docker log. Теперь их видно при использовании docker compose up, или docker compose logs -f</li>
<li>Оставил файлы конфигов чистыми, что бы их можно было редактировать без конфликтов гита</li>
</ol>
<p>К сожалению, из за изменения структуры папок и добавления tls-crypt - ключи будут перегенерированы, так что не забудьте перенастроить клиентов после обновления.</p></td><td>2024-08-10T01:33:04.927Z</td></tr><tr><td>abrikman(Alexander K)</td><td><p>Ооо, за конфиги и конфликты прям отдельное спасибо! Пошел тестировать.</p></td><td>2024-08-10T04:13:10.897Z</td></tr><tr><td>ShiGhost(ShiGhost)</td><td><p>Вы не сравнивали скорость между TCP и UDP? Я хотел сравнить, но конфиг UDP не работает. Я сравнил TCP OpenVPN и Wireguard, с wireguard скорость на ютубе в 4-5 раза выше и после добавления</p>
<blockquote>
<p>sndbuf 3670016<br>
rcvbuf 3670016</p>
</blockquote>
<p>разницы в скорости не заметил.</p></td><td>2024-08-10T05:12:58.732Z</td></tr><tr><td>Oless</td><td><p>А как можно точно проверить работу DCO?<br>
У меня при выполнении команды: ip -details link show на хосте увы нет никаких пометок ovpn-dco на интерфейсах <img src="https://ntc.party/images/emoji/twitter/frowning.png?v=12" title=":frowning:" class="emoji" alt=":frowning:" loading="lazy" width="20" height="20"><br>
Делал всё по пунктам инструкции в гите<br>
<div class="lightbox-wrapper"><a class="lightbox" href="неофициальный-docker-контейнер-антизапрета-8839/4af38103d8bd5dbfda726c8bdfb5bab5012a0632.png" data-download-href="https://ntc.party/uploads/default/4af38103d8bd5dbfda726c8bdfb5bab5012a0632" title="Снимок экрана 2024-08-10 090529"><img src="неофициальный-docker-контейнер-антизапрета-8839/4af38103d8bd5dbfda726c8bdfb5bab5012a0632.png" alt="Снимок экрана 2024-08-10 090529" data-base62-sha1="aH32kJxjbM4Y0TXohpobwlDXTk6" width="690" height="252" data-dominant-color="42465B"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">Снимок экрана 2024-08-10 090529</span><span class="informations">1599×586 42 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p></td><td>2024-08-10T06:05:49.251Z</td></tr><tr><td>ShiGhost(ShiGhost)</td><td><p>Сделал ещё пару тестов. Изначально я использовал OpenVPN на роутере Keenetic KN1810 на нём нагрузка на процессор около 50% при просмотре ютуба, попробовал напрямую запустить и скорость увеличилась в 3-4 раза, но при этом нагрузка на сервер тоже увеличилась в разы, но даже так Wireguard на роутере быстрее и нагрузка на сервер минимальна. Вывод: нужен antizapret работающий на Wireguard.</p></td><td>2024-08-10T06:27:31.391Z</td></tr><tr><td>abrikman(Alexander K)</td><td><aside class="quote no-group" data-username="ShiGhost" data-post="42" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/shighost/48/4485_2.png" class="avatar"> ShiGhost:</div>
<blockquote>
<p>разницы в скорости не заметил.</p>
</blockquote>
</aside>
<p>я думаю это индивидуальная история. я проверял на UDP например, и мне было сильно легче. Плюс тут наверное реляет пинг до сервера и локация.</p></td><td>2024-08-10T06:53:54.252Z</td></tr><tr><td>xtrime</td><td><p>С DCO нагрузка на CPU сервера у меня около 0 при скорости в 200 мбит. Так что проще сервер настроить и роутер обновить. На последних asuswrt merelin, например, уже версии openvpn 2.6+. Надо только проверить, есть ли там расширение dco.</p>
<p>UP:<br>
Но добавить wireguard звучит, как задача на пару дней. Только не помню, позволяет ли он маршруты на клиенте прописывать.</p></td><td>2024-08-10T08:29:53.314Z</td></tr><tr><td>xtrime</td><td><blockquote>
<p>А как можно точно проверить работу DCO?</p>
</blockquote>
<p>Пометка <code> ovpn-dco</code>  появится на интерфейсах, которые создаст openvpn в контейнере: vpn и vpn-tcp.<br>
Кроме того в новом контейнере уровень логирования выше,  в логах будут записи:</p>
<pre data-code-wrap="shell"><code class="lang-shell">docker compose up -d &amp;&amp; docker compose logs -f | grep -i dco 
</code></pre>
<p>В результате должно быть такое:</p>
<pre><code class="lang-auto">antizapret-vpn  | Aug 10 08:48:23 0e72539c9161 kernel: acpi PNP0A03:00: _OSC: not requesting OS control; OS requires [ExtendedConfig ASPM ClockPM MSI]
antizapret-vpn  | Aug 10 08:48:23 0e72539c9161 kernel: ovpn_dco_v2: loading out-of-tree module taints kernel.
antizapret-vpn  | Aug 10 08:48:23 0e72539c9161 kernel: ovpn_dco_v2: module verification failed: signature and/or required key missing - tainting kernel
antizapret-vpn  | Aug 10 08:48:23 0e72539c9161 kernel: OpenVPN data channel offload (ovpn-dco) 0.0+git20231103 -- (C) 2020-2023 OpenVPN, Inc.
antizapret-vpn  | Aug 10 08:48:23 0e72539c9161 systemd[1]: ldconfig.service - Rebuild Dynamic Linker Cache was skipped because no trigger condition checks were met.
antizapret-vpn  | Aug 10 08:48:23 0e72539c9161 openvpn[121]: OpenVPN 2.6.9 x86_64-pc-linux-gnu [SSL (OpenSSL)] [LZO] [LZ4] [EPOLL] [PKCS11] [MH/PKTINFO] [AEAD] [DCO]
antizapret-vpn  | Aug 10 08:48:23 0e72539c9161 openvpn[121]: DCO version: 0.0+git20231103
antizapret-vpn  | Aug 10 08:48:23 0e72539c9161 openvpn[121]: net_iface_new: add vpn type ovpn-dco
antizapret-vpn  | Aug 10 08:48:23 0e72539c9161 openvpn[121]: DCO device vpn opened
</code></pre></td><td>2024-08-10T08:34:10.626Z</td></tr><tr><td>Oless</td><td><p>Спасибо! DCO работает, не понятно тогда почему у меня больше 25мб по скорости не идёт на youtube, не уж то кинетик не вывозит</p></td><td>2024-08-10T08:58:55.851Z</td></tr><tr><td>xtrime</td><td><aside class="quote no-group" data-username="Oless" data-post="48" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/o/b5ac83/48.png" class="avatar"> Oless:</div>
<blockquote>
<p>кинетик не вывозит</p>
</blockquote>
</aside>
<p>Да. На клиенте то DCO нет. У меня четырехядерный Asus AX55 выдает до 50-70 мбит через antizapret. А клиент на десктопе уже 300 мбит.</p>
<p>Я уже добавляю поддержку ipsec/l2tp, более знакомая для меня технология чем WG. Надеюсь не очень долго займет.</p></td><td>2024-08-10T09:04:04.691Z</td></tr><tr><td>Xunlei</td><td><p>В дескриптор службы openvpn@%i.service надо добавить капабилити <code>CAP_SETPCAP</code>.</p></td><td>2024-08-10T09:41:42.960Z</td></tr><tr><td>Oless</td><td><p>Дописал, никак не повлияло</p></td><td>2024-08-10T10:30:42.380Z</td></tr><tr><td>ShiGhost(ShiGhost)</td><td><p>У меня DCO включён, но нагрузка на сервер с 1 ядром достигает 100% при скорости около 70-90 мбит.</p></td><td>2024-08-10T10:58:20.176Z</td></tr><tr><td>Xunlei</td><td><p>На скриншоте у вас какие-то интерфейсы докеров, я ими никогда не пользовался (и до сих пор не понял, зачем эта лишняя сущность), мои рекомендации относятся к голой ос, например, на дебиане 12  DCO всегда запускался.</p></td><td>2024-08-10T11:04:43.411Z</td></tr><tr><td>xtrime</td><td><aside class="quote no-group" data-username="ShiGhost" data-post="52" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/shighost/48/4485_2.png" class="avatar"> ShiGhost:</div>
<blockquote>
<p>У меня DCO включён</p>
</blockquote>
</aside>
<p>Не уверен. Что выдает docker compose logs | grep -i dco  ?</p></td><td>2024-08-10T11:07:14.614Z</td></tr><tr><td>ShiGhost(ShiGhost)</td><td><blockquote>
<p>antizapret  | Aug 10 05:02:50 6da1b1315d13 openvpn[133]: OpenVPN 2.6.9 x86_64-pc-linux-gnu [SSL (OpenSSL)] [LZO] [LZ4] [EPOLL] [PKCS11] [MH/PKTINFO] [AEAD] [DCO]<br>
antizapret  | Aug 10 05:02:50 6da1b1315d13 openvpn[135]: OpenVPN 2.6.9 x86_64-pc-linux-gnu [SSL (OpenSSL)] [LZO] [LZ4] [EPOLL] [PKCS11] [MH/PKTINFO] [AEAD] [DCO]<br>
antizapret  | Aug 10 05:02:50 6da1b1315d13 openvpn[135]: DCO version: 0.0+git20231103<br>
antizapret  | Aug 10 05:02:50 6da1b1315d13 openvpn[133]: DCO version: 0.0+git20231103<br>
antizapret  | Aug 10 05:02:50 6da1b1315d13 openvpn[135]: net_iface_new: add vpn type ovpn-dco<br>
antizapret  | Aug 10 05:02:50 6da1b1315d13 openvpn[133]: net_iface_new: add vpn-tcp type ovpn-dco<br>
antizapret  | Aug 10 05:02:50 6da1b1315d13 openvpn[133]: DCO device vpn-tcp opened<br>
antizapret  | Aug 10 05:02:50 6da1b1315d13 openvpn[135]: DCO device vpn opened<br>
antizapret  | Aug 10 06:03:50 6da1b1315d13 openvpn[133]: antizapret-client/<em>.</em>.<em>.</em>:39908 SIGTERM[soft,ovpn-dco: transport error] received, client-instance exiting<br>
antizapret  | Aug 10 06:07:26 6da1b1315d13 openvpn[133]: dco_parse_peer_multi: cannot store DCO stats for peer 2</p>
</blockquote></td><td>2024-08-10T11:14:00.067Z</td></tr><tr><td>xtrime</td><td><p>Да, все верно. А что top внутри контейнера показывает во время интенсивного использования?</p></td><td>2024-08-10T11:17:20.042Z</td></tr><tr><td>dartraiden(Alexander Gavrilov)</td><td><aside class="quote no-group" data-username="ShiGhost" data-post="44" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/shighost/48/4485_2.png" class="avatar"> ShiGhost:</div>
<blockquote>
<p>Вывод: нужен antizapret работающий на Wireguard.</p>
</blockquote>
</aside>
<p>WG не умеет пушить маршруты клиенту.</p>
<p>Лучше смотрите в сторону IPSec, либо теребите поддержку Keenetic, чтобы добавили DCO.</p></td><td>2024-08-10T14:10:33.383Z</td></tr><tr><td>overherz(overherz)</td><td><p>кто-нибудь знает как это подключить на прошивке merlin?<br>
что я только там не пробовал, не конектит, пришлось официальную прошивку опять ставить</p></td><td>2024-08-10T14:10:33.981Z</td></tr><tr><td>dartraiden(Alexander Gavrilov)</td><td><aside class="quote no-group" data-username="overherz" data-post="58" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/overherz/48/6025_2.png" class="avatar"> overherz:</div>
<blockquote>
<p>не конектит</p>
</blockquote>
</aside>
<p>Слишком мало информации. Что в системном журнале, если в конфиг на клиенте добавить <code>verb 5</code>?</p></td><td>2024-08-10T14:13:53.515Z</td></tr><tr><td>ShiGhost(ShiGhost)</td><td><p>Внутри контейнера нагрузки показывает нет, но вне контейнера есть.<br>
<div class="lightbox-wrapper"><a class="lightbox" href="неофициальный-docker-контейнер-антизапрета-8839/dd72021e8c30a53da857791c212ce6a6a98a9e95.png" data-download-href="https://ntc.party/uploads/default/dd72021e8c30a53da857791c212ce6a6a98a9e95" title="Screenshot_27"><img src="неофициальный-docker-контейнер-антизапрета-8839/dd72021e8c30a53da857791c212ce6a6a98a9e95.png" alt="Screenshot_27" data-base62-sha1="vAZMweE0VS8qMBlYS7TkATM2029" width="690" height="51" data-dominant-color="2F2F2F"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">Screenshot_27</span><span class="informations">1486×111 7.85 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p></td><td>2024-08-10T15:16:22.680Z</td></tr><tr><td>xtrime</td><td><aside class="quote no-group" data-username="dartraiden" data-post="57" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/dartraiden/48/15299_2.png" class="avatar"> dartraiden:</div>
<blockquote>
<p>IPSec</p>
</blockquote>
</aside>
<p>Да, IPSec умеет через пушить конфиги подсеити через leftsubnet, Но у меня на компе чет не получилось настроить коннект, а на роутере asus вообще нет ipsec клиента.</p></td><td>2024-08-10T15:22:04.716Z</td></tr><tr><td>xtrime</td><td><p><div class="lightbox-wrapper"><a class="lightbox" href="неофициальный-docker-контейнер-антизапрета-8839/6b38de726258b8b64e0c6fb79f4ef349122c2848.jpeg" data-download-href="https://ntc.party/uploads/default/6b38de726258b8b64e0c6fb79f4ef349122c2848" title="Снимок экрана 2024-08-10 в 17.32.20"><img src="неофициальный-docker-контейнер-антизапрета-8839/6b38de726258b8b64e0c6fb79f4ef349122c2848_2_690x344.jpeg" alt="Снимок экрана 2024-08-10 в 17.32.20" data-base62-sha1="fiwVGHOhRxpXEPTzTzWU07VMfoc" width="690" height="344" srcset="неофициальный-docker-контейнер-антизапрета-8839/6b38de726258b8b64e0c6fb79f4ef349122c2848_2_690x344.jpeg, неофициальный-docker-контейнер-антизапрета-8839/6b38de726258b8b64e0c6fb79f4ef349122c2848_2_1035x516.jpeg 1.5x, неофициальный-docker-контейнер-антизапрета-8839/6b38de726258b8b64e0c6fb79f4ef349122c2848_2_1380x688.jpeg 2x" data-dominant-color="2E2F2B"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">Снимок экрана 2024-08-10 в 17.32.20</span><span class="informations">1920×958 120 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>А, так это из за TCP!<br>
На UDP меньше 5% суммарная нагрузка на CPU при 200+ мбит/сек</p></td><td>2024-08-10T15:35:40.087Z</td></tr><tr><td>ShiGhost(ShiGhost)</td><td><p>В вашем контейнере не работает UDP.</p></td><td>2024-08-10T15:51:29.141Z</td></tr><tr><td>xtrime</td><td><p>На скрине мой контейнер и коннект по UDP. Использую и с ПК и с роутера.<br>
Что в docker compose logs -f при попытке подключения по UDP?</p>
<p>UP: проверил - на TCP у меня нагрузка так же высокая. Т.е проблема именно в протоколе.</p></td><td>2024-08-10T16:22:09.422Z</td></tr><tr><td>ShiGhost(ShiGhost)</td><td><p>В контейнере не запускается openvpn udp<br>
<div class="lightbox-wrapper"><a class="lightbox" href="неофициальный-docker-контейнер-антизапрета-8839/30c40d5d198a84d95d4772ae8d7e2ad4d98618a0.png" data-download-href="https://ntc.party/uploads/default/30c40d5d198a84d95d4772ae8d7e2ad4d98618a0" title="Screenshot_29"><img src="неофициальный-docker-контейнер-антизапрета-8839/30c40d5d198a84d95d4772ae8d7e2ad4d98618a0.png" alt="Screenshot_29" data-base62-sha1="6XoXqqeU3FcWODdb5pjyt65KDf2" width="690" height="110" data-dominant-color="090707"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">Screenshot_29</span><span class="informations">1906×306 20.9 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p></td><td>2024-08-10T16:33:13.920Z</td></tr><tr><td>xtrime</td><td><p>Надо смотреть логи в journalctl. Команда есть на скрине.</p>
<p>Если сервер стартовал давно, то логи могли очистится. Надо сделать restart и еще раз проверить логи</p>
<pre><code class="lang-auto">docker exec antizapret-vpn systemctl restart openvpn-server@antizapret
docker exec antizapret-vpn journalctl -u openvpn-server@antizapret
</code></pre></td><td>2024-08-10T16:34:44.611Z</td></tr><tr><td>ShiGhost(ShiGhost)</td><td><p>Нету конфига для UDP, странно, что у вас запускается нормально.<br>
<div class="lightbox-wrapper"><a class="lightbox" href="неофициальный-docker-контейнер-антизапрета-8839/ad3a1fdd478092a0d113d53fbace745105f7d44c.png" data-download-href="https://ntc.party/uploads/default/ad3a1fdd478092a0d113d53fbace745105f7d44c" title="Screenshot_30"><img src="неофициальный-docker-контейнер-антизапрета-8839/ad3a1fdd478092a0d113d53fbace745105f7d44c_2_690x314.png" alt="Screenshot_30" data-base62-sha1="oIr8h8AqQbfIHFm6kVvhSNpGk7G" width="690" height="314" srcset="неофициальный-docker-контейнер-антизапрета-8839/ad3a1fdd478092a0d113d53fbace745105f7d44c_2_690x314.png, неофициальный-docker-контейнер-антизапрета-8839/ad3a1fdd478092a0d113d53fbace745105f7d44c_2_1035x471.png 1.5x, неофициальный-docker-контейнер-антизапрета-8839/ad3a1fdd478092a0d113d53fbace745105f7d44c_2_1380x628.png 2x" data-dominant-color="040404"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">Screenshot_30</span><span class="informations">2855×1302 148 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p></td><td>2024-08-10T17:03:08.096Z</td></tr><tr><td>xtrime</td><td><p>Я ошибся в названии сервиса. Там просто openvpn-server@antizapret, a не openvpn-server@antizapret-udp. Предыдущее сообщение обновил.</p></td><td>2024-08-10T17:07:13.802Z</td></tr><tr><td>xtrime</td><td><p>Команда для статуса тоже не верная.<br>
Вот так должн обыть:</p>
<p>systemctl status openvpn-server@antizapret</p></td><td>2024-08-10T17:09:31.281Z</td></tr><tr><td>ShiGhost(ShiGhost)</td><td><p>Почему openvpn-server@antizapret, а не openvpn-server@antizapret-udp? У меня openvpn-server@antizapret-tcp работает, а с openvpn-server@antizapret-udp нет.<br>
<div class="lightbox-wrapper"><a class="lightbox" href="неофициальный-docker-контейнер-антизапрета-8839/b73bf0376e4ac96bd3d4a5201887300d6b5ebb6b.png" data-download-href="https://ntc.party/uploads/default/b73bf0376e4ac96bd3d4a5201887300d6b5ebb6b" title="Screenshot_31"><img src="неофициальный-docker-контейнер-антизапрета-8839/b73bf0376e4ac96bd3d4a5201887300d6b5ebb6b_2_690x270.png" alt="Screenshot_31" data-base62-sha1="q8XNfH9eEF7ZWx3JdeFlc31r8VB" width="690" height="270" srcset="неофициальный-docker-контейнер-антизапрета-8839/b73bf0376e4ac96bd3d4a5201887300d6b5ebb6b_2_690x270.png, неофициальный-docker-контейнер-антизапрета-8839/b73bf0376e4ac96bd3d4a5201887300d6b5ebb6b_2_1035x405.png 1.5x, неофициальный-docker-контейнер-антизапрета-8839/b73bf0376e4ac96bd3d4a5201887300d6b5ebb6b_2_1380x540.png 2x" data-dominant-color="060606"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">Screenshot_31</span><span class="informations">3807×1491 295 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p></td><td>2024-08-10T17:13:52.411Z</td></tr><tr><td>xtrime</td><td><aside class="quote no-group" data-username="ShiGhost" data-post="70" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/shighost/48/4485_2.png" class="avatar"> ShiGhost:</div>
<blockquote>
<p>Почему openvpn-server@antizapret, а не openvpn-server@antizapret-udp</p>
</blockquote>
</aside>
<p>Так изначально было в оригинальном контейнере антизапрета. Я не трогал <img src="https://ntc.party/images/emoji/twitter/slight_smile.png?v=12" title=":slight_smile:" class="emoji" alt=":slight_smile:" loading="lazy" width="20" height="20"><br>
Есть два сервиса: openvpn-server@antizapret и openvpn-server@antizapret-tcp. Первый отвечает за udp. Конфиги в /etc/openvpn/server/ так же называются.</p>
<p>Никакого openvpn-server@antizapret-udp не существует.</p>
<p>По логам вижу что все работает корректно. Что там при подключении происходит?</p></td><td>2024-08-10T17:29:34.115Z</td></tr><tr><td>ShiGhost(ShiGhost)</td><td><p>Существует ибо systemctl status openvpn-server@antizapret-udp отображает.</p></td><td>2024-08-10T17:31:55.180Z</td></tr><tr><td>xtrime</td><td><p><div class="lightbox-wrapper"><a class="lightbox" href="неофициальный-docker-контейнер-антизапрета-8839/6580051d6aebf1d598d2f2c8d02895044060b89b.jpeg" data-download-href="https://ntc.party/uploads/default/6580051d6aebf1d598d2f2c8d02895044060b89b" title="Снимок экрана 2024-08-10 в 19.43.05"><img src="неофициальный-docker-контейнер-антизапрета-8839/6580051d6aebf1d598d2f2c8d02895044060b89b_2_690x398.jpeg" alt="Снимок экрана 2024-08-10 в 19.43.05" data-base62-sha1="etUvnhKauRes2WMyHOK7uRY0eKv" width="690" height="398" srcset="неофициальный-docker-контейнер-антизапрета-8839/6580051d6aebf1d598d2f2c8d02895044060b89b_2_690x398.jpeg, неофициальный-docker-контейнер-антизапрета-8839/6580051d6aebf1d598d2f2c8d02895044060b89b_2_1035x597.jpeg 1.5x, неофициальный-docker-контейнер-антизапрета-8839/6580051d6aebf1d598d2f2c8d02895044060b89b_2_1380x796.jpeg 2x" data-dominant-color="383838"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">Снимок экрана 2024-08-10 в 19.43.05</span><span class="informations">1420×820 119 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div><br>
Что угодно можно писать после @ и оно будет отображать. Это что то вроде аргумента, который прокидывается в базовый конфиг openvpn.</p>
<p>То что написано после @ подставляется в команду и openvpn ищет конфиг с этим именем в своей папке. Файлы конфига есть только antizapret.conf и antizapret-tcp.conf.</p>
<p>Эти же сервисы активируются в контейнере: <a href="https://github.com/xtrime-ru/antizapret-vpn-docker/blob/ea7702e664ee80ac8eba64f771dbb2a605fc8a1f/Dockerfile#L48" class="inline-onebox">antizapret-vpn-docker/Dockerfile at ea7702e664ee80ac8eba64f771dbb2a605fc8a1f · xtrime-ru/antizapret-vpn-docker · GitHub</a></p></td><td>2024-08-10T17:47:12.519Z</td></tr><tr><td>ShiGhost(ShiGhost)</td><td><p>Нашёл в чём причина, оказалось проблема не в контейнере, у меня не подключалось к UDP через клиент на Windows, а на смартфоне подключился и на роутере.</p></td><td>2024-08-10T17:57:41.161Z</td></tr><tr><td>xtrime</td><td><p>Рад слышать! Возможно какие то настройки конфликтуют с клиентом на винде. Его бы лог глянуть.<br>
Например я убирал устаревшие проколы шифрования, что бы DCO работал.</p></td><td>2024-08-10T17:59:15.801Z</td></tr><tr><td>ShiGhost(ShiGhost)</td><td><p>И как это сделать? Это связанно со строкой Note?</p>
<blockquote>
<p>2024-08-10 23:00:43 Note: --cipher is not set. OpenVPN versions before 2.5 defaulted to BF-CBC as fallback when cipher negotiation failed in this case. If you need this fallback please add ‘–data-ciphers-fallback BF-CBC’ to your configuration and/or add BF-CBC to --data-ciphers.<br>
2024-08-10 23:00:43 OpenVPN 2.6.12 [git:v2.6.12/038a94bae57a446c] Windows [SSL (OpenSSL)] [LZO] [LZ4] [PKCS11] [AEAD] [DCO] built on Jul 18 2024<br>
2024-08-10 23:00:43 Windows version 10.0 (Windows 10 or greater), amd64 executable<br>
2024-08-10 23:00:43 library versions: OpenSSL 3.3.1 4 Jun 2024, LZO 2.10<br>
2024-08-10 23:00:43 DCO version: N/A<br>
2024-08-10 23:00:43 TCP/UDP: Preserving recently used remote address: [AF_INET]IP:1194<br>
2024-08-10 23:00:43 All ovpn-dco adapters on this system are currently in use or disabled.<br>
2024-08-10 23:00:43 Exiting due to fatal error</p>
</blockquote></td><td>2024-08-10T18:02:31.019Z</td></tr><tr><td>xtrime</td><td><p>Нет, Note это нормально. Я ключ не указывал, что бы клиент и сервер сами договорились.</p>
<p>Проблема в “All ovpn-dco adapters on this system are currently in use or disabled.”</p>
<p>Есть issue: <a href="https://github.com/OpenVPN/ovpn-dco-win/issues/38" class="inline-onebox" rel="noopener nofollow ugc">OpenVPN error on network device Windows 10 22H2 x64 · Issue #38 · OpenVPN/ovpn-dco-win · GitHub</a> , но пока не решено</p></td><td>2024-08-10T18:13:31.777Z</td></tr><tr><td>ShiGhost(ShiGhost)</td><td><p>Протестировал UDP на роутере, ютуб стал открываться с минимальными задержками и ещё скорость загрузки видео увеличилась на 30%-40%. Спасибо, что постарался помочь и за сам контейнер.</p></td><td>2024-08-10T18:27:56.415Z</td></tr><tr><td>xtrime</td><td><p>На компе довольно просто починить клиент. Выключи в настройках клиента DCO. На сервере он останется, а на компе проц мощный, он и без DCO сотню мбит вытянет</p></td><td>2024-08-10T19:17:29.924Z</td></tr><tr><td>dartraiden(Alexander Gavrilov)</td><td><p>Можно ли добавлять домены по маске? Например, на ТСПУ блокируются все домены в зоне <code>.ua</code></p></td><td>2024-08-10T19:17:48.024Z</td></tr><tr><td>xtrime</td><td><p>В контейнере есть .awk файлы в папке /root/antizapret/<br>
В них как раз регулярные выражения.</p>
<p>Можно наверное в репозиторий такое правило добавить. Хотя странно, что раньше не добавили. Они точно не работают через антизапрет?</p></td><td>2024-08-10T19:21:48.061Z</td></tr><tr><td>xtrime</td><td><p>А, нет. Там только exclude. Значит надо по аналогии прописать в kres.d: <a href="https://github.com/xtrime-ru/antizapret-vpn-docker/blob/master/rootfs/etc/knot-resolver/kresd.conf#L65" class="inline-onebox" rel="noopener nofollow ugc">antizapret-vpn-docker/rootfs/etc/knot-resolver/kresd.conf at master · xtrime-ru/antizapret-vpn-docker · GitHub</a><br>
указать там 127.0.0.4 и ua.</p></td><td>2024-08-10T19:29:28.011Z</td></tr><tr><td>dartraiden(Alexander Gavrilov)</td><td><aside class="quote no-group" data-username="xtrime" data-post="81" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/xtrime/48/1524_2.png" class="avatar"> xtrime:</div>
<blockquote>
<p>Они точно не работают через антизапрет?</p>
</blockquote>
</aside>
<p>Не проксируются. Например, <code>overclockers.ua</code></p>
<pre><code class="lang-auto">Addresses:  2606:4700:20::ac43:480d
          2606:4700:20::681a:426
          2606:4700:20::681a:526
          172.67.72.13
          104.26.4.38
          104.26.5.38
</code></pre></td><td>2024-08-10T19:34:07.016Z</td></tr><tr><td>xtrime</td><td><p>Да, действительно не проксируются. Сейчас поправим!</p></td><td>2024-08-10T19:47:29.650Z</td></tr><tr><td>xtrime</td><td><p>Сейчас проверил, достаточно в inlude-hosts.custom.txt добавить домены без точек. Все будет работать.</p>
<p>Но я сделал фикс, что бы из коробки работало. Сейчас соберется и через 5 минут можно будет обновиться:</p>
<pre><code class="lang-auto">git pull &amp;&amp; docker compose pull &amp;&amp; docker compose up -d
</code></pre></td><td>2024-08-10T19:55:47.707Z</td></tr><tr><td>Tyman</td><td><p>можно добавлять домены первого уровня в исключения, те просто добавляй ua в include-hosts-custom.txt</p></td><td>2024-08-10T20:25:37.224Z</td></tr><tr><td>Tyman</td><td><p>Коллега <a href="https://ntc.party/u/xtrime"><strong>xtrime</strong></a>, смотрю вы тоже развлекаетесь, нам бы конечно объединить бы силы и опыт, правда я пошел в сторону разворачивания антизапрета на хосте - чтобы добиться максимальной производительности</p>
<p>Пока вот поделюсь наблюдениями по поводу настройки openvpn</p>
<p>настройка keepalive 2 10 - как я понимаю посылает каждые 2 секунды пинги, очень часто, я вообще пока убрал из конфига (по дефолту пинг 10 сек и где то через 40 сек реконектится), для tcp возможно ее даже стоит увеличить</p>
<p>увеличил txqueuelen до 1000 тк были потери пакетов</p>
<p>tun-mtu не трогал, и не стал бы менять значение, если нет проблем</p>
<p>увеличение sndbuf и rcvbuf помогает на некоторых роутерах увеличить скорость по UDP, но на сервере никакого положительного эффекта не наблюдал</p>
<p>для udp я добавил:<br>
fast-io</p>
<p>для tcp я добавил:<br>
tcp-nodelay</p>
<p>Изучал форумы, пишут что tls-crypt и возможно tls-crypt2 определяет ТСПУ в момент подключения к серверу и умеет блокировать</p></td><td>2024-08-10T21:18:09.359Z</td></tr><tr><td>dartraiden(Alexander Gavrilov)</td><td><aside class="quote no-group" data-username="Tyman" data-post="87" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/tyman/48/6894_2.png" class="avatar"> Tyman:</div>
<blockquote>
<p>правда я пошел в сторону разворачивания антизапрета на хосте</p>
</blockquote>
</aside>
<p>Да, вам бы унифицировать конфиги, а все различия чтобы сводились к способу установки (контейнер vs bare metal). Было бы очень круто. Я, например, не люблю контейнеризацию, предпочитая ставить всё через пакетный менеджер.</p>
<p>Раз уж заговорили про tls-crypt и защиту от обнаружения, есть ещё <a href="https://ntc.party/t/openvpn-anti-censorship-patches/">вот такие патчи</a>.</p></td><td>2024-08-10T23:25:57.668Z</td></tr><tr><td>alexalex</td><td><p>К сожалению, Mikrotik до сих пор не умеет в tls-crypt, а как сегодня выяснилось в процессе экспериментов с контейнером, и в UDP OpenVPN тоже. Ну если UDP они ломают-чинят от прошивки к прошивке, то tls-crypt не планируют, похоже, никогда.</p></td><td>2024-08-10T23:56:57.674Z</td></tr><tr><td>alexalex</td><td><p>А зачем <a href="http://google.com" rel="noopener nofollow ugc">google.com</a> включили в include-hosts-custom? Нет же (пока?) смысла весь трафик к google заворачивать в VPN.</p></td><td>2024-08-11T01:28:29.346Z</td></tr><tr><td>Ernieleo(Max)</td><td><p>Поддержу мнение свыше, хотел ещё несколько дней назад на Гите написать, смысл “заводского” добавления в списки всех подряд доменов?<br>
Достаточно нескольких официально заблокированных и тех что сейчас связаны с YouTube, тоже касается внесения несвязанных с Google остальных доменов.<br>
Наверное стоит внести их в dict (он же для этого предназначен на сколько помню) и закомментировать # не заблокированное/ограниченное, оставить на усмотрение пользователя.</p>
<p>И на сколько наблюдаю у себя и друзей, трафик с Европейской части России идёт на сервера Google в Финляндии на основании GeoDNS, и при расположении контейнера на сервере где-то в центральной Европе, для не используемых доменов Google (после исключения из “заводского” списка), на основании geo сервера, возвращает маршруты к Немецким и иным серверам, что увеличивает задержку. Geo так же актуально для Steam. Нужные для себя домены Гугла и Стим, не задействованные в обходе через VPN, указал в kresd.</p>
<p>Оптимальным вариантом, расположение арендуемого сервера где-то на Скандинавском полуострове что решает проблему сразу, вероятно это стоит упомянуть в readme.</p></td><td>2024-08-11T02:42:22.760Z</td></tr><tr><td>xtrime</td><td><aside class="quote no-group" data-username="Ernieleo" data-post="91" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/e/ce73a5/48.png" class="avatar"> Ernieleo:</div>
<blockquote>
<p>смысл “заводского” добавления в списки всех подряд доменов?</p>
</blockquote>
</aside>
<p>Смысл в удобстве. Что бы рандомный выполнил 4 команды на VPS, скачал сертификат и забыл про все это <img src="https://ntc.party/images/emoji/twitter/slight_smile.png?v=12" title=":slight_smile:" class="emoji" alt=":slight_smile:" loading="lazy" width="20" height="20"></p>
<p>Список скопипастил из скрипта в соседней теме и не знаю зачем там гугл включили. Удалил его пару дней назад.<br>
Не очень понял про какой dict идет речь. Но в папке config специально вынесены txt файлы, которые можно наполнить самостоятельно доменами которые надо добавить или исключить.</p></td><td>2024-08-11T13:38:51.371Z</td></tr><tr><td>xtrime</td><td><p>У вас старая версия сейчас influde-hosts-custum пустой по умолчанию.</p></td><td>2024-08-11T13:39:20.062Z</td></tr><tr><td>xtrime</td><td><aside class="quote no-group" data-username="Tyman" data-post="87" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/tyman/48/6894_2.png" class="avatar"> Tyman:</div>
<blockquote>
<p>нам бы конечно объединить бы силы и опыт</p>
</blockquote>
</aside>
<p>Да, видел, спасибо за труд! Часть фиксов копипастил из твоего скрипта <img src="https://ntc.party/images/emoji/twitter/slight_smile.png?v=12" title=":slight_smile:" class="emoji" alt=":slight_smile:" loading="lazy" width="20" height="20"> Буду только рад.</p>
<aside class="quote no-group" data-username="Tyman" data-post="87" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/tyman/48/6894_2.png" class="avatar"> Tyman:</div>
<blockquote>
<p>чтобы добиться максимальной производительности</p>
</blockquote>
</aside>
<p>Docker не дает никакого оверхеда. Это не виртуализация. Максимальную производительность дает расширение DCO в kernel-space <img src="https://ntc.party/images/emoji/twitter/slight_smile.png?v=12" title=":slight_smile:" class="emoji" alt=":slight_smile:" loading="lazy" width="20" height="20"></p>
<aside class="quote no-group quote-modified" data-username="Tyman" data-post="87" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/tyman/48/6894_2.png" class="avatar"> Tyman:</div>
<blockquote>
<p>keepalive 2 10 вообще пока убрал из конфига</p>
</blockquote>
</aside>
<p>У меня роутер раньше долго держал коннект с мертвым сервером из за чего интернет не работал совсем. Сделал настройку максимально агрессивной, что бы реконнект быстрее происходил. Что значит “очень часто”? Пинг не добавляет никакой нагрузки, не вижу минусов.</p>
<aside class="quote no-group" data-username="Tyman" data-post="87" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/tyman/48/6894_2.png" class="avatar"> Tyman:</div>
<blockquote>
<p>tun-mtu не трогал, и не стал бы менять значение, если нет проблем</p>
</blockquote>
</aside>
<p>Согласен, но в доках есть рекомендация установить его равным 1420 при использовании DCO.</p>
<aside class="quote no-group" data-username="Tyman" data-post="87" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/tyman/48/6894_2.png" class="avatar"> Tyman:</div>
<blockquote>
<p>tls-crypt и возможно tls-crypt2 определяет ТСПУ</p>
</blockquote>
</aside>
<p>Выше наоборот писали, что позволяет обфусцировать траффик. Да и некоторые роутеры не умеют в него., как оказалось.  Хорошо бы сделать такие вещи конфигурируемыми через ENV, но мне лень <img src="https://ntc.party/images/emoji/twitter/slight_smile.png?v=12" title=":slight_smile:" class="emoji" alt=":slight_smile:" loading="lazy" width="20" height="20"> Отключу.</p>
<p>txqueuelen, fast-io, tcp-nodelay поправлю сейчас. Спасибо!</p></td><td>2024-08-11T13:54:50.665Z</td></tr><tr><td>linpin</td><td><p>Добрый день, спасибо за контейнер!</p>
<p>подскажите, пожалуйста:</p>
<ol>
<li>возможно ли (и как правильно) вносить изменения в DNS? В частности я активный пользователь controld, с помощью которого можно открывать такие сервисы как netflix и прочее</li>
<li>контейнер будет работать только с openvpn или нет? Мне казалось, что это уже устаревшая технология</li>
<li>как правильно делиться конфигом?</li>
</ol></td><td>2024-08-11T15:00:32.693Z</td></tr><tr><td>alexalex</td><td><p>Странно, буквально вчера вечером (около 22 по Москве) тянул с git на свежую VPS. Прилип как-то старый…</p></td><td>2024-08-11T15:24:46.166Z</td></tr><tr><td>Mr.Alex</td><td><p>Удачи вам <img src="https://ntc.party/images/emoji/twitter/fist.png?v=12" title=":fist:" class="emoji" alt=":fist:" loading="lazy" width="20" height="20"></p></td><td>2024-08-11T15:44:00.813Z</td></tr><tr><td>Ernieleo(Max)</td><td><aside class="quote no-group" data-username="xtrime" data-post="92" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/xtrime/48/1524_2.png" class="avatar"> xtrime:</div>
<blockquote>
<p>Удалил его пару дней назад.</p>
</blockquote>
</aside>
<p>Только что посетил Git и проверил актуальный релиз, <a href="http://google.com" rel="noopener nofollow ugc">google.com</a> остаётся в списке.<br>
Предлагаю вернуть include-host-dict.txt что используется в установленном оригинальном lxd контейнере и аналогично ему внести “заводские” домены туда, что исправит конфликт при обновлении.</p></td><td>2024-08-11T16:52:00.008Z</td></tr><tr><td>xtrime</td><td><aside class="quote no-group" data-username="Ernieleo" data-post="98" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/e/ce73a5/48.png" class="avatar"> Ernieleo:</div>
<blockquote>
<p>и аналогично ему внести “заводские” домены туда, что исправит конфликт при обновлении.</p>
</blockquote>
</aside>
<p>Я именно это и сделал вот тут: <a href="https://github.com/xtrime-ru/antizapret-vpn-docker/blob/master/rootfs/root/fix.sh#L11" rel="noopener nofollow ugc">https://github.com/xtrime-ru/antizapret-vpn-docker/blob/master/rootfs/root/fix.sh#L11</a></p>
<p>Но я забыл очистить <a href="https://github.com/xtrime-ru/antizapret-vpn-docker/blob/master/config/include-hosts-custom.txt" class="inline-onebox" rel="noopener nofollow ugc">antizapret-vpn-docker/config/include-hosts-custom.txt at master · xtrime-ru/antizapret-vpn-docker · GitHub</a> <img src="https://ntc.party/images/emoji/twitter/slight_smile.png?v=12" title=":slight_smile:" class="emoji" alt=":slight_smile:" loading="lazy" width="20" height="20"><br>
Сейчас исправлю. В гите будет всегда лежать пустой файл. Спасибо!</p></td><td>2024-08-11T17:38:06.431Z</td></tr><tr><td>xtrime</td><td><aside class="quote no-group" data-username="linpin" data-post="95" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/l/9e8a1a/48.png" class="avatar"> linpin:</div>
<blockquote>
<p>возможно ли (и как правильно) вносить изменения в DNS</p>
</blockquote>
</aside>
<p>Добавляйте домены и/или ip адреса в соответствующие файлы в папке config.</p>
<aside class="quote no-group" data-username="linpin" data-post="95" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/l/9e8a1a/48.png" class="avatar"> linpin:</div>
<blockquote>
<p>контейнер будет работать только с openvpn или нет? Мне казалось, что это уже устаревшая технология</p>
</blockquote>
</aside>
<p>Пока только openvpn.<br>
Проблема в настройке tunnel split на клиенте и поддержке со стороны железок. Нужно указать клиенту, что только фейковые адреса 10.224.0.0/15 должны открываться через VPN. Такая фича есть еще в ipsec, но у меня на роутере, например, есть только поддержка PPTP, L2TP и OpenVPN клиентов. Поэтому нет мотивации тратить время на такую фичу.</p>
<p>В версии openvpn 2.6 добавили поддержку <a href="https://openvpn.net/as-docs/openvpn-dco.html" rel="noopener nofollow ugc">DCO</a>. Теперь по скорости openvpn не так сильно уступает интегрированным в ядро linux решениям типа wireguard.</p>
<aside class="quote no-group" data-username="linpin" data-post="95" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/l/9e8a1a/48.png" class="avatar"> linpin:</div>
<blockquote>
<p>как правильно делиться конфигом?</p>
</blockquote>
</aside>
<p>Скачать файл keys/client/antizapret-client-udp.ovpn или keys/client/antizapret-client-tcp.ovpn<br>
Файлы можно использовать на любом количестве клиентов. Рекомендуется upd, так как гораздо выше скорость и ниже нагрузка на CPU сервера и клиента.</p></td><td>2024-08-11T18:07:15.657Z</td></tr><tr><td>alexalex</td><td><p>Вопрос. А awk скрипты только в контейнере? Нет плана вынести их в хост, чтобы можно было править на предмет добавления зон (чтобы проксировать только домены 3 и дальше уровня, по типу <a href="http://play.google.com" rel="noopener nofollow ugc">play.google.com</a>)?</p></td><td>2024-08-11T22:10:16.687Z</td></tr><tr><td>xtrime</td><td><p>Мне кажется, что в txt файлы можно добавлять домены любого уровня и они будут работать как регулярки.</p></td><td>2024-08-11T22:15:26.579Z</td></tr><tr><td>alexalex</td><td><p>Ну я опирался вот на это:</p><aside class="quote" data-post="160" data-topic="129">
  <div class="title">
    <div class="quote-controls"></div>
    <img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/valdikss/48/2_2.png" class="avatar">
    <a href="https://ntc.party/t/%D0%BA%D0%BE%D0%BD%D1%82%D0%B5%D0%B9%D0%BD%D0%B5%D1%80-vpn-%D0%B0%D0%BD%D1%82%D0%B8%D0%B7%D0%B0%D0%BF%D1%80%D0%B5%D1%82%D0%B0-%D0%B4%D0%BB%D1%8F-%D1%83%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B8-%D0%BD%D0%B0-%D1%81%D0%BE%D0%B1%D1%81%D1%82%D0%B2%D0%B5%D0%BD%D0%BD%D1%8B%D0%B9-%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80/129/160">Контейнер VPN АнтиЗапрета для установки на собственный сервер</a> <a class="badge-category__wrapper " href="/c/antizapret-prostovpn-org/az-self-hosted/38"><span data-category-id="38" style="--category-badge-color: #0088CC; --category-badge-text-color: #FFFFFF; --parent-category-badge-color: #8C6238;" data-parent-category-id="5" data-drop-close="true" class="badge-category --has-parent" title="Вопросы и особенности работы контейнера VPN АнтиЗапрета на своих серверах"><span class="badge-category__name">АнтиЗапрет на собственном сервере (self-hosted)</span></span></a>
  </div>
  <blockquote>
    Скрипты заточены под обработку зон, а не отдельных доменов. 
Можете попробовать добавить в файл /root/antizapret/scripts/getzones.awk, в длинную строку с доменами, в конец |google. 
Примерно так: 
…appspot|my1|hwcdn|google)\.[^.]+$/))
  </blockquote>
</aside>
</td><td>2024-08-11T22:34:07.016Z</td></tr><tr><td>xtrime</td><td><p>Добавил поддержку внешних DNS серверов типа adguard с помощью env переменной: <a href="https://github.com/xtrime-ru/antizapret-vpn-docker/commit/b099467b7f2c62ec2663fcec454ec6b3a5506f37" class="inline-onebox" rel="noopener nofollow ugc">Feat: add adguard support · xtrime-ru/antizapret-vpn-docker@b099467 · GitHub</a></p>
<p>Готовый compose файл сразу с контейнером adguard, который будет использовать antizapret:</p><aside class="onebox githubblob" data-onebox-src="https://github.com/xtrime-ru/antizapret-vpn-docker/blob/master/docker-compose.adguard.yml">
  <header class="source">

      <a href="https://github.com/xtrime-ru/antizapret-vpn-docker/blob/master/docker-compose.adguard.yml" target="_blank" rel="noopener nofollow ugc">github.com</a>
  </header>

  <article class="onebox-body">
    <h4><a href="https://github.com/xtrime-ru/antizapret-vpn-docker/blob/master/docker-compose.adguard.yml" target="_blank" rel="noopener nofollow ugc">xtrime-ru/antizapret-vpn-docker/blob/master/docker-compose.adguard.yml</a></h4>


      <pre><code class="lang-yml">services:
  antizapret-vpn:
    extends:
      file: docker-compose.base.yml
      service: antizapret-vpn
    networks:
      default:
      static-network:
        ipv4_address: 10.5.0.2
    environment:
      - DNS=10.5.0.3
  adguardhome:
    image: adguard/adguardhome
    ports:
#      - 53:53/tcp
#      - 53:53/udp
#      - 784:784/udp
#      - 853:853/tcp
      - 3000:3000/tcp
      - 80:80/tcp
</code></pre>



  This file has been truncated. <a href="https://github.com/xtrime-ru/antizapret-vpn-docker/blob/master/docker-compose.adguard.yml" target="_blank" rel="noopener nofollow ugc">show original</a>

  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>
</td><td>2024-08-11T22:48:03.704Z</td></tr><tr><td>xtrime</td><td><aside class="quote no-group" data-username="alexalex" data-post="103" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/a/59ef9b/48.png" class="avatar"> alexalex:</div>
<blockquote>
<p>Ну я опирался вот на это:</p>
</blockquote>
</aside>
<p>Ох… Проверил исходники <a href="https://bitbucket.org/anticensority/antizapret-pac-generator-light/src/master/parse.sh" class="inline-onebox" rel="noopener nofollow ugc">Bitbucket</a></p>
<p>Действительно  /root/antizapret/scripts/getzones.awk проходится по списку сгенерированному из txt файлов и берет оттуда только домены.</p>
<p>Наверное для оптимизации сделано. Надо подумать как лучше сделать. Мб отдельный файл который будет прямо в конфиг kresd инжектится без всяких посредников <img src="https://ntc.party/images/emoji/twitter/slight_smile.png?v=12" title=":slight_smile:" class="emoji" alt=":slight_smile:" loading="lazy" width="20" height="20"></p></td><td>2024-08-11T23:16:54.963Z</td></tr><tr><td>Mr.Alex</td><td><p>Здравствуйте, <a class="mention" href="/u/xtrime">@xtrime</a>! Установил ваш скрипт все просто летает. Я так смотрю вы еще вручную добавили доступ к ChatGPT и YouTube? И подскажите, пожалуйста как завести AdGuard Home. Это нужно в /etc/knot-resolver/kresd.conf в конце прописать policy.add(policy.all(policy.FORWARD({‘ip_antizapret’})))?</p></td><td>2024-08-12T04:58:33.352Z</td></tr><tr><td>alexalex</td><td><p>Так может проще будет, если монтировать getzones.awk в docker, и положить его в config  на хосте? Чтобы не ломать голову…</p></td><td>2024-08-12T05:52:02.841Z</td></tr><tr><td>Oless</td><td><p>И снова здравствуйте! <img src="https://ntc.party/images/emoji/twitter/slight_smile.png?v=12" title=":slight_smile:" class="emoji" alt=":slight_smile:" loading="lazy" width="20" height="20"><br>
Спасибо за проделанную работу, возможно автору стоит уже задуматься о сборе на чай <img src="https://ntc.party/images/emoji/twitter/sweat_smile.png?v=12" title=":sweat_smile:" class="emoji" alt=":sweat_smile:" loading="lazy" width="20" height="20"><br>
Я с вопросом<br>
Сталкивался ли кто, что при развёрнутом контейнере, с открытыми портами (как allow в ufw, так и полностью выключенном ufw) происходит ситуация, что keenetic может спокойно подключаться по TCP, но в упор не может подключиться по UDP ?</p>
<p>В логах кинетика сыпет такое вот:</p>
<pre><code class="lang-auto">Авг 12 10:04:35
OpenVPN0
Note: --cipher is not set. OpenVPN versions before 2.5 defaulted to BF-CBC as fallback when cipher negotiation failed in this case. If you need this fallback please add '--data-ciphers-fallback BF-CBC' to your configuration and/or add BF-CBC to --data-ciphers.
Авг 12 10:04:35
OpenVPN0
OpenVPN 2.6.7 [SSL (OpenSSL)] [LZO] [LZ4] [EPOLL] [MH/PKTINFO] [AEAD] [DCO]
Авг 12 10:04:35
OpenVPN0
library versions: OpenSSL 3.1.5 30 Jan 2024, LZO 2.10
Авг 12 10:04:35
OpenVPN0
DCO version: N/A
Авг 12 10:04:35
OpenVPN0
UDPv4 link local: (not bound)
Авг 12 10:04:35
OpenVPN0
UDPv4 link remote: [AF_INET]IP_МОЕГО_VPS:1194
Авг 12 10:04:35
OpenVPN0
NOTE: UID/GID downgrade will be delayed because of --client, --pull, or --up-delay
Авг 12 10:04:45
OpenVPN0
[UNDEF] Inactivity timeout (--ping-restart), restarting
Авг 12 10:04:45
OpenVPN0
SIGTERM[soft,ping-restart] received, process exiting
Авг 12 10:04:45
ndm
Service: "OpenVPN0": unexpectedly stopped. 
</code></pre>
<p>Как будто ругается на то что не может достучаться до адреса и дропает соединение<br>
Хотя все нужные порты открыты, TCP на том же порте абсолютно нормально коннектится.</p>
<p>В какую сторону покурить?</p></td><td>2024-08-12T07:20:23.935Z</td></tr><tr><td>makx(3941701)</td><td><p>После обновления контейнер перестал реагировать на некоторые домены в include-hosts-custom. Да и в fix.sh тоже. Например, 2ip не проксируется и 4pda по-прежнему думает, что к нему заходят из РФ и не пускает в разные запретные части по обходам блокировок, хотя до обновления работало с этими же конфигами</p></td><td>2024-08-12T09:08:01.764Z</td></tr><tr><td>DoplerEffect</td><td><p><a class="mention" href="/u/xtrime">@xtrime</a> огромное спасибо вам за контейнер, особенно за поддержку DCO, скорость больше 300 мегабит, нагрузка на процессор минимальная. Я в восторге !</p>
<p>но у меня небольшая проблема, я не могу подружить с клиентом на linux почему то нет соединения, на пк под виндой(10) все отлично.</p>
<p>Upd. Разобрался, я ставил слишком новый клиент на линукс, сейчас полет отличный )</p></td><td>2024-08-12T09:09:35.412Z</td></tr><tr><td>overherz(overherz)</td><td><p>какой у тебя vps? тоже бы хотелось такую скорость</p></td><td>2024-08-12T09:54:54.482Z</td></tr><tr><td>DoplerEffect</td><td><p>zomro</p></td><td>2024-08-12T10:07:58.393Z</td></tr><tr><td>zzr</td><td><p>вырожаю автору мемнтальную понтдержку) (хоть я и не люблю докер (наверное потому что не понимаю как оно там работает под капотом)), валдикасс обленился) не хочет обновлять свой контейнер( (я ему скока раз просил уже), отрадно видеть что вот уже сообщесво понтянулось, опенвпн чем хорош что ето комбаин можно из него слепить например виригуард установив data-ciphers чача-поли1305 какой нето потому что в смаратафонах нет(?) понтдержки исрукций для ускорения аеэса на проце(соке)</p></td><td>2024-08-12T11:00:00.423Z</td></tr><tr><td>xtrime</td><td><p>Спасибо за добрые слова!</p>
<aside class="quote no-group" data-username="DoplerEffect" data-post="110" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/doplereffect/48/3817_2.png" class="avatar"> DoplerEffect:</div>
<blockquote>
<p>я ставил слишком новый клиент на линукс</p>
</blockquote>
</aside>
<p>Хм, странно. Возможно на новом клиенте DCO c ошибкой падает? Тут недавно на винде на это жаловались. Там с DCO клиент тоже не конектится. Надо в настройках выключать.</p>
<aside class="quote no-group" data-username="zzr" data-post="113" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/zzr/48/14949_2.png" class="avatar"> zzr:</div>
<blockquote>
<p>можно из него слепить например виригуард</p>
</blockquote>
</aside>
<p>Это как?</p>
<p>PS. Я пытаюсь еще ipsec/xauth прикрутить, но пока без результатов…</p></td><td>2024-08-12T11:24:21.703Z</td></tr><tr><td>xtrime</td><td><aside class="quote no-group" data-username="makx" data-post="109" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/makx/48/6630_2.png" class="avatar"> makx:</div>
<blockquote>
<p>После обновления контейнер перестал реагировать на некоторые домены в include-hosts-custom</p>
</blockquote>
</aside>
<p>При старте контейнера используются уже готовые правила. Но запускается генерация новых уже с пользовательскими настройками. Нужно подождать до 5 минут пока сгенерируются новые правила и потом уже проверять.<br>
Так же мб  кеш kresd мешает. Для надежности: запустить конетйнера, по логам удостоверится, что doall отработал и перезапустил kresd, перезапустить контейнер еще раз. Потом проверить dig <a href="http://2ip.ru">2ip.ru</a> <span class="mention">@127.0.0.1</span> в контейнере.</p></td><td>2024-08-12T11:29:27.337Z</td></tr><tr><td>xtrime</td><td><aside class="quote no-group" data-username="Oless" data-post="108" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/o/b5ac83/48.png" class="avatar"> Oless:</div>
<blockquote>
<p>не может подключиться по UDP</p>
</blockquote>
</aside>
<p>А что в логах openvpn на сервере в этот момент? Он видит коннект? docker compose logs -f<br>
И стоит добавить опцию verb 3 в конфиг клиента, что бы логов побольше было.</p></td><td>2024-08-12T11:32:42.147Z</td></tr><tr><td>DoplerEffect</td><td><aside class="quote no-group" data-username="xtrime" data-post="114" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/xtrime/48/1524_2.png" class="avatar"> xtrime:</div>
<blockquote>
<p>Хм, странно. Возможно на новом клиенте DCO c ошибкой падает? Тут недавно на винде на это жаловались. Там с DCO клиент тоже не конектится. Надо в настройках выключать.</p>
</blockquote>
</aside>
<p>все дело в том что я ставил openvpn3 на debian , он вообще даже не соединялся<br>
потом глянул какая версия в контейнере, и поставил уже 2 версию.<br>
Я поставил клиент на lxc в proxmox , dco завелся,на самом хосте ставил openvpn-dco-dkms, на роутере уже пробросил все маршруты в этот контейнер и получил хорошую скорость на всех устройствах в сети.<br>
Немного не разобрался со списками, немного отличаются от оригинального антизапрета, но это уже пустяки<br>
Еще раз , большое спасибо вам.</p>
<p><img src="неофициальный-docker-контейнер-антизапрета-8839/08aab7f074f9108c047fe65e725a5add6f0a683b.png" alt="изображение" data-base62-sha1="1eFA75MFxaFTs5FvhGIFuG2jdbl" width="643" height="287"><br>
вот так получилось в однопотоке</p></td><td>2024-08-12T13:09:45.702Z</td></tr><tr><td>linpin</td><td><p>спасибо за ответ, единственное по второму немного подискутирую.<br>
мне кажется странным делать фокусировку на роутере, т.к. основная боль именно на моб. устройствах и свой роутер не всегда есть под рукой</p>
<p>дома сделать еще есть различные варианты так или иначе</p></td><td>2024-08-12T14:07:00.286Z</td></tr><tr><td>linpin</td><td><p>можете, пожалуйста, чуть подробнее расписать как это использовать? (можно на примере adguard home)<br>
это по сути сейчас в виде доп. образа в контейнере, чтобы фильтровать рекламу? adguard home по итогу доступен по какому-то порту?</p></td><td>2024-08-12T14:18:15.199Z</td></tr><tr><td>xtrime</td><td><aside class="quote no-group" data-username="linpin" data-post="118" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/l/9e8a1a/48.png" class="avatar"> linpin:</div>
<blockquote>
<p>моб. устройствах</p>
</blockquote>
</aside>
<p>А есть какие то примеры? У меня на iphone 120 мбит youtube через openvpn показывает:<br>
<div class="lightbox-wrapper"><a class="lightbox" href="неофициальный-docker-контейнер-антизапрета-8839/df5e74eea6779756fff807cc91ad487814171bdf.jpeg" data-download-href="https://ntc.party/uploads/default/df5e74eea6779756fff807cc91ad487814171bdf" title="IMG_9549.PNG"><img src="неофициальный-docker-контейнер-антизапрета-8839/df5e74eea6779756fff807cc91ad487814171bdf_2_690x318.jpeg" alt="IMG_9549.PNG" data-base62-sha1="vS0QC0US7gVLbnWiNaO39Abyi75" width="690" height="318" srcset="неофициальный-docker-контейнер-антизапрета-8839/df5e74eea6779756fff807cc91ad487814171bdf_2_690x318.jpeg, неофициальный-docker-контейнер-антизапрета-8839/df5e74eea6779756fff807cc91ad487814171bdf_2_1035x477.jpeg 1.5x, неофициальный-docker-контейнер-антизапрета-8839/df5e74eea6779756fff807cc91ad487814171bdf_2_1380x636.jpeg 2x" data-dominant-color="394132"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">IMG_9549.PNG</span><span class="informations">1920×887 151 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>Но повторюсь прикрутить дополнительный транспорт с поддержкой tunnel split сложно. Я пытался прикрутить ipsec, пока не получилось. Если получится, то откладывать релиз не буду <img src="https://ntc.party/images/emoji/twitter/slight_smile.png?v=12" title=":slight_smile:" class="emoji" alt=":slight_smile:" loading="lazy" width="20" height="20"></p>
<p>Какие еще транспорты помимо ipsec и openvpn поддерживают tunnel split и есть на моб устройствах - я не знаю.</p>
<p>Дополнитлеьно использую этот контейнер для обычного VPN: <a href="https://github.com/hwdsl2/docker-ipsec-vpn-server" class="inline-onebox">GitHub - hwdsl2/docker-ipsec-vpn-server: Docker image to run an IPsec VPN server, with IPsec/L2TP, Cisco IPsec and IKEv2</a><br>
Там весь трафик пускается через VPN, но нагрузка минимальная и поддерживается на всех моб устройствах.</p>
<aside class="quote no-group" data-username="linpin" data-post="119" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/l/9e8a1a/48.png" class="avatar"> linpin:</div>
<blockquote>
<p>можете, пожалуйста, чуть подробнее расписать как это использовать? (можно на примере adguard home)</p>
</blockquote>
</aside>
<pre><code class="lang-auto">docker compose down &amp;&amp; git pull &amp;&amp; docker compose -f docker-compose.adguard.yml pull &amp;&amp; docker compose -f docker-compose.adguard.yml up -d
</code></pre>
<p>adguard будет доступен по адресу ip_вашего_сервера:3000<br>
антизапрет будет использовать его в качестве DNS сервера.</p></td><td>2024-08-12T14:28:30.364Z</td></tr><tr><td>rare.xlrd</td><td><p>Всем привет!<br>
Кто-нибудь подружил контейнер с Mikrotik’ом в качестве клиента?<br>
Уже специально ROS до 7-ки обновил, то ругается на “TLS error: handshake timed out(6)”, то “received packet with wrong ack rsid, dropping”. Какие ciphers и auth необходимо выбирать, чтобы заработало?(</p></td><td>2024-08-12T15:09:22.367Z</td></tr><tr><td>alexalex</td><td><ol>
<li>Только TCP</li>
<li>Только TCP</li>
<li>Только TCP</li>
</ol>
<p>ниже рабочий конфиг. ROS 7.15.3. Ну и не шифровать TLS. На сервере закомментировать строчку tls-crypt keys/antizapret-tls-crypt.key 0<br>
в файле ~/antizapret/keys/server/antizapret-tcp.conf</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="неофициальный-docker-контейнер-антизапрета-8839/147447487656654d73c2b48c82aa56ade819ab87.png" data-download-href="https://ntc.party/uploads/default/147447487656654d73c2b48c82aa56ade819ab87" title="image"><img src="неофициальный-docker-контейнер-антизапрета-8839/147447487656654d73c2b48c82aa56ade819ab87.png" alt="image" data-base62-sha1="2UWFQ4McTEoJ3JxwCxbL2rStEs7" width="690" height="321" data-dominant-color="F1F1F1"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">1107×516 9.77 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>ЗЫ На название profile  не обращайте внимания, я тоже пытался с UDP начать )) А так там default работает.</p></td><td>2024-08-12T15:16:00.016Z</td></tr><tr><td>alexalex</td><td><aside class="quote no-group" data-username="xtrime" data-post="120" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/xtrime/48/1524_2.png" class="avatar"> xtrime:</div>
<blockquote>
<p>adguard будет доступен по адресу ip_вашего_сервера:3000</p>
</blockquote>
</aside>
<p>Изнутри сервера (по адресу шлюза OpenVPN), или из интернета тоже?</p></td><td>2024-08-12T15:18:29.801Z</td></tr><tr><td>rare.xlrd</td><td><aside class="quote no-group" data-username="alexalex" data-post="122" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/a/59ef9b/48.png" class="avatar"> alexalex:</div>
<blockquote>
<p>На сервере закомментировать строчку tls-crypt keys/antizapret-tls-crypt.key 0<br>
в файле ~/antizapret/keys/server/antizapret-tcp.conf</p>
</blockquote>
</aside>
<p>А у меня такой строчки и нет)<br>
А как у тебя работает галочка “Verify Server Certificate”?<br>
Ты какие файлики сертификатов забирал с сервака? Клиентские .crt и .key?</p></td><td>2024-08-12T15:31:37.847Z</td></tr><tr><td>linpin</td><td><aside class="quote no-group" data-username="xtrime" data-post="120" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/xtrime/48/1524_2.png" class="avatar"> xtrime:</div>
<blockquote>
<pre><code class="lang-auto">docker compose down &amp;&amp; git pull &amp;&amp; docker compose -f docker-compose.adguard.yml pull &amp;&amp; docker compose -f docker-compose.adguard.yml up -d
</code></pre>
</blockquote>
</aside>
<p>спасибо! мне кажется это в readme хорошо бы тоже указать</p>
<hr>
<p>что касается скорости, то тут все действительно хорошо, подтверждаю…<br>
Есть проблема в другом на данный момент, у меня в ютубе/inst при начальном заходе в приложение оч долго грузится главная, иногда может вообще не загрузится</p></td><td>2024-08-12T15:35:30.107Z</td></tr><tr><td>alexalex</td><td><aside class="quote no-group" data-username="rare.xlrd" data-post="124" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/r/bc79bd/48.png" class="avatar"> rare.xlrd:</div>
<blockquote>
<p>Ты какие файлики сертификатов забирал с сервака? Клиентские .crt и .key?</p>
</blockquote>
</aside>
<p>никакие… я из ovpn файла копировал ca, crt и key</p>
<p>еще в конфиг сервера добавил<br>
reneg-sec 0<br>
иначе дергалось соединение каждый час</p>
<aside class="quote no-group" data-username="rare.xlrd" data-post="124" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/r/bc79bd/48.png" class="avatar"> rare.xlrd:</div>
<blockquote>
<p>А у меня такой строчки и нет)</p>
</blockquote>
</aside>
<p>возможно, в свежей версии автор вроде бы уже убрал строчку</p>
<aside class="quote no-group" data-username="rare.xlrd" data-post="124" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/r/bc79bd/48.png" class="avatar"> rare.xlrd:</div>
<blockquote>
<p>А как у тебя работает галочка “Verify Server Certificate”?</p>
</blockquote>
</aside>
<p>как-то работает ))</p></td><td>2024-08-12T15:40:11.310Z</td></tr><tr><td>rare.xlrd</td><td><aside class="quote no-group" data-username="alexalex" data-post="126" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/a/59ef9b/48.png" class="avatar"> alexalex:</div>
<blockquote>
<p>еще в конфиг сервера добавил<br>
reneg-sec 0<br>
иначе дергалось соединение каждый час</p>
</blockquote>
</aside>
<p>о, это полезно, спасибо!</p>
<p>Подключился, все ок, но сайты, которые нужно проксировать вообще не хотят открываться почему-то, в DNS-ах вот такие записи почему-то. Кто-нибудь указывал сторонние DNS-ы в Docker-compose файлике, может ему дефолтный ДНС не нравится, поэтому он чушь какую-то резолвит?(<br>
<img src="неофициальный-docker-контейнер-антизапрета-8839/c1305fd6d52973c8865d8a1a16b87a03942534b9.png" alt="image" data-base62-sha1="rz1NbRTIuYBy3eQKC7Ezwhum4JP" width="560" height="125"></p></td><td>2024-08-12T15:49:12.505Z</td></tr><tr><td>alexalex</td><td><p>Правильные адреса, покажите IP-Routes.</p></td><td>2024-08-12T15:52:00.778Z</td></tr><tr><td>rare.xlrd</td><td><p>Все, разобрался, правило маскарада надо было поправить)<br>
Но тем не менее, ютуб тот же открывается, но видео не грузятся от слова совсем, просто загрузка крутится и все(<br>
<img src="неофициальный-docker-контейнер-антизапрета-8839/1ed2b16db2cbaa34970b0839059a32b00eef5aa8.png" alt="image" data-base62-sha1="4oFJnDy3OWaKQrK0UjUkGfJSaQE" width="644" height="165"></p></td><td>2024-08-12T19:20:33.006Z</td></tr><tr><td>Mr.Alex</td><td><p>Такая же проблема у меня на (iOS, Android), но на ПК сразу все грузится</p></td><td>2024-08-12T19:27:17.542Z</td></tr><tr><td>alexalex</td><td><p>два варианта</p>
<ol>
<li>Не все прописано в include-hosts-custom</li>
<li>Вам по прежнему отдают с Российских серверов. Есть такие VPS хостинги, которые вроде не в России, а IP бьются как Российские у Google.</li>
</ol>
<p>П.2 можно проверить по  ссылке <a href="https://redirector.googlevideo.com/report_mapping?di=no" rel="noopener nofollow ugc">https://redirector.googlevideo.com/report_mapping?di=no</a><br>
Подробнее тут: <a href="https://ntc.party/t/google-%D0%BD%D0%B0%D1%87%D0%B0%D0%BB-%D0%B2%D0%BD%D0%BE%D1%81%D0%B8%D1%82%D1%8C-ip-proxy-%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80%D0%BE%D0%B2-%D0%B2-%D1%81%D0%BF%D0%B8%D1%81%D0%BE%D0%BA-%D0%B0%D0%B4%D1%80%D0%B5%D1%81%D0%BE%D0%B2-%D1%80%D1%84-%D0%B3%D0%B5%D0%BE%D1%82%D0%B0%D1%80%D0%B3%D0%B5%D1%82%D0%B8%D0%BD%D0%B3/9111/51" class="inline-onebox">Google начал вносить IP Proxy серверов в список адресов РФ (геотаргетинг) - #51 by Dhohbr</a></p>
<p>П. 1 - проверяйте.</p></td><td>2024-08-12T19:41:02.388Z</td></tr><tr><td>alexalex</td><td><aside class="quote no-group" data-username="rare.xlrd" data-post="129" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/r/bc79bd/48.png" class="avatar"> rare.xlrd:</div>
<blockquote>
<p>правило маскарада надо было поправить)</p>
</blockquote>
</aside>
<p>а… я-то сразу  интерфейс в WAN список бросаю, а дальше у меня правила по спискам работают. Вот и забыл уточнить, т.к. это делали руки без участия головы.</p></td><td>2024-08-12T19:44:28.514Z</td></tr><tr><td>alexalex</td><td><p>Стоп. У Вас адрес youtube почему 216…? Должен быть 10.224… Судя по трейсроуту - мимо VPN  идете.</p></td><td>2024-08-12T19:49:05.529Z</td></tr><tr><td>selkoslen(Selkoslen)</td><td><p>Здравствуйте, подскажите, как изменить DNS сервера уже на развернутом docker?<br>
По пути system/docker dns отсутвует конфиг DNS, а по штатному пути <code>/etc/docker/daemon.json</code> сервера за комментированы</p></td><td>2024-08-12T20:50:41.625Z</td></tr><tr><td>xtrime</td><td><p>Что значит “изменить DNS сервера уже на развернутом docker”?</p>
<p>Если надо что бы внутри антизапрета использовался другой DNS, то есть ENV переменная DNS. Пример: <a href="https://github.com/xtrime-ru/antizapret-vpn-docker/blob/master/docker-compose.adguard.yml#L11" class="inline-onebox">antizapret-vpn-docker/docker-compose.adguard.yml at master · xtrime-ru/antizapret-vpn-docker · GitHub</a>.</p>
<p>Но после правки docker-compose файла контейнер придется пересоздать. Однако в контейнере инфа не хранится, пересоздание не приводит к смене ключей или настроек (если конечно руками там ничего не правили).</p>
<p>Если речь в целом про докер, то внутри контейнера можно добаивть echo “nameserver x.x.x.x” &gt;&gt; /etc/resolve.conf , но эта штука кажется при перезапуске затирается.</p></td><td>2024-08-12T23:07:47.806Z</td></tr><tr><td>xtrime</td><td><aside class="quote no-group" data-username="linpin" data-post="125" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/l/9e8a1a/48.png" class="avatar"> linpin:</div>
<blockquote>
<p>у меня в ютубе/inst при начальном заходе в приложение оч долго грузится главная</p>
</blockquote>
</aside>
<p>Кажется говорили, что там испльзуется DOH. К сожалению сейчас в логах нет инфы из процесса proxy.py, который отвечает за обработку DNS. Я попробую пофиксить логи, тогда можно будет поразбираться что там за запрос прилетает.<br>
Или, возможно, где то в соседних темах уже поправили и надо очередной патч накатить…</p></td><td>2024-08-12T23:21:23.199Z</td></tr><tr><td>makx(3941701)</td><td><aside class="quote no-group" data-username="xtrime" data-post="115" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/xtrime/48/1524_2.png" class="avatar"> xtrime:</div>
<blockquote>
<p>При старте контейнера используются уже готовые правила. Но запускается генерация новых уже с пользовательскими настройками. Нужно подождать до 5 минут пока сгенерируются новые правила и потом уже проверять</p>
</blockquote>
</aside>
<p>Не работает, хоть 5 минут ждать, хоть 5 часов. Уже в какие только списки не добавлял. Все заблокированное обходит замечательно, но вот не заблокированное принудительно через VPN не идет</p></td><td>2024-08-13T01:57:16.853Z</td></tr><tr><td>alexalex</td><td><aside class="quote no-group" data-username="selkoslen" data-post="134" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/selkoslen/48/6545_2.png" class="avatar"> selkoslen:</div>
<blockquote>
<p>изменить DNS сервера</p>
</blockquote>
</aside>
<p>А зачем их изменять? Насколько я понимаю, knot не пользуется адресами серверов в контейнере, а ходит сразу выше, так как он полноценный рекурсивный ресолвер. Если нужно какой-то конкретный использовать для VPN - то policy в  kresd.conf</p></td><td>2024-08-13T08:04:54.058Z</td></tr><tr><td>alexalex</td><td><aside class="quote no-group" data-username="xtrime" data-post="135" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/xtrime/48/1524_2.png" class="avatar"> xtrime:</div>
<blockquote>
<p>ENV переменная DNS</p>
</blockquote>
</aside>
<p>А она в kresd отдает DNS, да?</p></td><td>2024-08-13T08:06:36.363Z</td></tr><tr><td>abrikman(Alexander K)</td><td><p>Накатываю каждый раз новую версию и всё супер.<br>
А можно таки как-то отказаться от зависимости от include-hosts-custom.txt и не пересоздавать ключи?<br>
Ну или ключ какой-то есть при ребилде, я в docker-compose не силён,</p></td><td>2024-08-13T10:57:48.250Z</td></tr><tr><td>rare.xlrd</td><td><p>В общем, на последней сборке есть траблы с DNS<br>
Снес виртуалку подчистую, накатил все заново, заново настроил на микроте, подключается, все ок, в кеше DNS ничего не появляется, при попытке nslookup’а - connection timeout(<br>
<div class="lightbox-wrapper"><a class="lightbox" href="неофициальный-docker-контейнер-антизапрета-8839/d6108223d707786d835a00761878dcdcbfc6e287.png" data-download-href="https://ntc.party/uploads/default/d6108223d707786d835a00761878dcdcbfc6e287" title="image"><img src="неофициальный-docker-контейнер-антизапрета-8839/d6108223d707786d835a00761878dcdcbfc6e287.png" alt="image" data-base62-sha1="uxHxXfNkBvKJ7SoSLfEF5Lc6PCn" width="473" height="500" data-dominant-color="E6E5E8"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">556×587 14.9 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div><br>
<img src="неофициальный-docker-контейнер-антизапрета-8839/8d3f033ad24c61cd76259980b212a0b07a04cb6c.png" alt="image" data-base62-sha1="k9wkhUIo95Z1o0Xu9hpbv9C1yuE" width="564" height="134"><br>
<img src="неофициальный-docker-контейнер-антизапрета-8839/59d09901fc7a4d03c460785d3e8c1c835b4bda88.png" alt="image" data-base62-sha1="cOxpCVpIXKcvxHhrTO1ipdScjna" width="474" height="167"></p></td><td>2024-08-13T12:59:21.526Z</td></tr><tr><td>alexalex</td><td><p>Странно.<br>
А без VPN все работает?<br>
А маршруты на DNS в VPN заворачивате?<br>
У меня вот так и работает.<br>
<div class="lightbox-wrapper"><a class="lightbox" href="неофициальный-docker-контейнер-антизапрета-8839/cc8e2f8b9ce761832d54922c4fb420117203defa.png" data-download-href="https://ntc.party/uploads/default/cc8e2f8b9ce761832d54922c4fb420117203defa" title="image"><img src="неофициальный-docker-контейнер-антизапрета-8839/cc8e2f8b9ce761832d54922c4fb420117203defa.png" alt="image" data-base62-sha1="tbA2cnZDremTFMIRJK1ySWQAIVs" width="690" height="431" data-dominant-color="E9E9ED"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">903×565 10.5 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>UPD: правда, сборка не последняя</p></td><td>2024-08-13T13:38:32.988Z</td></tr><tr><td>rare.xlrd</td><td><p>Без VPN все прекрасно<br>
Маршруты да, заворачиваются в туннель, все ок, забыл их скрин прикрепить.<br>
Я думаю, что нюанс именно с последнем сборкой, и возможно, только у меня <img src="https://ntc.party/images/emoji/twitter/slight_smile.png?v=12" title=":slight_smile:" class="emoji" alt=":slight_smile:" loading="lazy" width="20" height="20"></p></td><td>2024-08-13T15:12:26.076Z</td></tr><tr><td>xtrime</td><td><aside class="quote no-group" data-username="alexalex" data-post="139" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/a/59ef9b/48.png" class="avatar"> alexalex:</div>
<blockquote>
<p>А она в kresd отдает DNS, да?</p>
</blockquote>
</aside>
<ol>
<li>В kresd + отключает фиксы для ру доменов в нем.</li>
<li>В proxy.py</li>
<li>В сам контейнер (для загрузки списков блокировки через системный wget/curl)</li>
</ol></td><td>2024-08-13T16:36:59.987Z</td></tr><tr><td>xtrime</td><td><aside class="quote no-group" data-username="abrikman" data-post="140" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/a/848f3c/48.png" class="avatar"> abrikman:</div>
<blockquote>
<p>А можно таки как-то отказаться от зависимости от include-hosts-custom.txt и не пересоздавать ключи?</p>
</blockquote>
</aside>
<ol>
<li>include-hosts-custom.txt сейчас пустой, его можно не трогать.</li>
<li>Обычно обновление, перезагрузка и пересоздание контейнера не затрагивает ключи.<br>
Пересоздание могло произойти при обновлении с версии 2 на версию 3. Из-за того что структура проекта сильно поменялась + был неудачный эксперимент в включением и выключением tls-crypt, который тоже потребовал обновления клиентских ключей.</li>
</ol>
<p>Сейчас еще один рефакторинг планируем релизить, возможно там тоже ключи пересоздадутся. Конфиги так же уберем из git репозитория и будем создавать в runtime, что бы их можно было править без конфликтов с репозиторием.</p>
<p>Но конечно, нет цели мучать пользователей проблемами при обновлении. Если есть возможность сохранить старые ключи/файлы то так и делаем.</p></td><td>2024-08-13T16:42:12.708Z</td></tr><tr><td>Oless</td><td><p>Всё проверил, оказался косяк на стороне хостера <img src="https://ntc.party/images/emoji/twitter/slight_smile.png?v=12" title=":slight_smile:" class="emoji" alt=":slight_smile:" loading="lazy" width="20" height="20"> подсеть выпала кривая для сервера, всё по UDP не долетало, не только OVPN<br>
Сейчас всё отлично, спасибо!</p></td><td>2024-08-13T17:38:38.780Z</td></tr><tr><td>alexalex</td><td><aside class="quote no-group" data-username="xtrime" data-post="144" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/xtrime/48/1524_2.png" class="avatar"> xtrime:</div>
<blockquote>
<ul>
<li>отключает фиксы для ру доменов в нем.</li>
</ul>
</blockquote>
</aside>
<p>а не приведет ли это к проблемам с НСДИ? всякие госуслуги и банки не отвалятся?</p></td><td>2024-08-13T18:14:39.435Z</td></tr><tr><td>xtrime</td><td><p>Могут. Тут либо AdGuard, либо безпроблемная работа.</p></td><td>2024-08-13T18:18:49.332Z</td></tr><tr><td>alexalex</td><td><p>Хотя… в Adguard же можно для ru прописать свои upstream сервера.</p>
<p>Один вопрос повис - морда Adguard (на 3000м и 80м порту) будет откуда доступна? Только по адресу antizapret изнутри, или из интернета тоже?</p></td><td>2024-08-13T20:45:30.691Z</td></tr><tr><td>abrikman(Alexander K)</td><td><aside class="quote no-group" data-username="xtrime" data-post="145" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/xtrime/48/1524_2.png" class="avatar"> xtrime:</div>
<blockquote>
<p>Пересоздание могло произойти при обновлении с версии 2 на версию 3. Из-за того что структура проекта сильно поменялась + был неудачный эксперимент в включением и выключением tls-crypt, который тоже потребовал обновления клиентских ключей.</p>
</blockquote>
</aside>
<p>Да, это видимо я пропустил версии. Но тем не менее спасибо, что развиваете проект, сижу на нем с самой первой версии <img src="https://ntc.party/images/emoji/twitter/slight_smile.png?v=12" title=":slight_smile:" class="emoji" alt=":slight_smile:" loading="lazy" width="20" height="20"></p></td><td>2024-08-14T03:13:44.529Z</td></tr><tr><td>selkoslen(Selkoslen)</td><td><p><a class="mention" href="/u/xtrime">@xtrime</a> Подскажите пожалуйста, как удалить все хосты ютуб, чтобы трафик не ходил через OpenVPN<br>
удалял все хосты из rootfs/root/fix.sh<br>
перезагружал командами:<br>
git pull<br>
docker compose pull<br>
docker compose up -d<br>
добавлял в исключение все хосты в папку:config/exclude-hosts-custom.txt<br>
перезагружал сервер, и все равно трафик идет через это подключение</p></td><td>2024-08-14T06:18:48.227Z</td></tr><tr><td>makx(3941701)</td><td><p>У меня ситуация зеркальная. Наоборот делал все что возможно, чтобы трафик принудительно шел через VPN для нужных мне сайтов, удалял и вписывал где только возможно и не помогало. Вчера поставил на хосте убунту 24.04 вместо 20.04, сделал все то же самое и, о чудо, заработало. Может совпадение, но теперь лучше лишний раз туда не лезть)</p></td><td>2024-08-14T07:52:07.606Z</td></tr><tr><td>xtrime</td><td><aside class="quote no-group" data-username="selkoslen" data-post="151" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/selkoslen/48/6545_2.png" class="avatar"> selkoslen:</div>
<blockquote>
<p>exclude-hosts-custom.txt</p>
</blockquote>
</aside>
<p>exclude-hosts-custom.txt достаточно. После перезапуска нужно подождать несколько минут, пока правила обновятся.</p>
<aside class="quote no-group" data-username="makx" data-post="152" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/makx/48/6630_2.png" class="avatar"> makx:</div>
<blockquote>
<p>поставил на хосте убунту 24.04 вместо 20.04, сделал все то же самое и, о чудо, заработало</p>
</blockquote>
</aside>
<p>Вот это неприятно и странно. У меня на хосте 22 убунта. Там точно все в порядке.<br>
Бесит когда поведение контейнера отличается в зависимости от хостовой системы. Но лучше в такие момент проверить лог контейнера и скинуть сюда, что бы можно было поправить.</p>
<p>UP: кажетс на 20 убунте есть проблемы с iptables внутри контейнера. Ferm перетирает правила докера и DNS докера не работает.  Попробуем добавить фикс в будущих релизах.</p></td><td>2024-08-14T10:26:47.522Z</td></tr><tr><td>ShiGhost(ShiGhost)</td><td><p><a class="mention" href="/u/xtrime">@xtrime</a> как продвигаются успехи по внедрению IPSec? На сайте <a href="https://support.keenetic.ru/eaeu/speedster/kn-3012/ru/16933-vpn-types-in-keenetic-routers.html" rel="noopener nofollow ugc">keenetic</a> говориться о поддержке IPSec на аппаратном уровне, то есть скорость должна быть выше чем через OpenVPN.</p></td><td>2024-08-14T11:01:23.407Z</td></tr><tr><td>xtrime</td><td><p>DNS через него работает, split tunneling тоже, а вот трафик пока не смог редиректнуть из контейнера в контейнер. Посижу еще в выходные.</p></td><td>2024-08-14T11:04:23.688Z</td></tr><tr><td>ShiGhost(ShiGhost)</td><td><p><a class="mention" href="/u/xtrime">@xtrime</a> я заметил, что у меня какого то фига конфиг kresd.conf который я редактировал под себя (изменил /rootfs/etc/knot-resolver/kresd.conf) через какое то время изменяется на ваш который в github, при этом я не обновлял контейнер. Как это исправить?</p></td><td>2024-08-14T14:05:56.929Z</td></tr><tr><td>truealex81(Truealex81)</td><td><p>А вы не хотите все конфиги и ключи вынести на хост и прокинуть директорию с ними внутрь контейнера как вольюм? Это бы решило все проблемы с потерей настроек при замене контейнера.</p></td><td>2024-08-14T14:20:04.714Z</td></tr><tr><td>xtrime</td><td><aside class="quote no-group" data-username="truealex81" data-post="157" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/truealex81/48/6761_2.png" class="avatar"> truealex81:</div>
<blockquote>
<p>А вы не хотите все конфиги и ключи вынести на хост</p>
</blockquote>
</aside>
<p>Именно так и сделано: <a href="https://github.com/xtrime-ru/antizapret-vpn-docker/blob/master/docker-compose.base.yml#L11-L16" class="inline-onebox">antizapret-vpn-docker/docker-compose.base.yml at master · xtrime-ru/antizapret-vpn-docker · GitHub</a></p></td><td>2024-08-14T14:37:02.344Z</td></tr><tr><td>xtrime</td><td><aside class="quote no-group" data-username="ShiGhost" data-post="156" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/shighost/48/4485_2.png" class="avatar"> ShiGhost:</div>
<blockquote>
<p>через какое то время изменяется</p>
</blockquote>
</aside>
<p>Папка rootfs не используется в контейнере. Это копия репозитория, которая используется при копировании файлов в /etc и /root. Я забыл удалить ее. Правки в этой папке делать не надо.  Правильный путь /etc/knot-resolver/kresd.conf</p></td><td>2024-08-14T14:44:15.378Z</td></tr><tr><td>ShiGhost(ShiGhost)</td><td><p>Не понял, я именно там правки делал и при первом запуске контейнера используется мой конфиг в rootfs, а потом примерно через 2-3 часа конфиг меняется на тот, что на github.</p></td><td>2024-08-14T14:46:34.294Z</td></tr><tr><td>ShiGhost(ShiGhost)</td><td><p>В контейнер было бы полезно добавить фикс, без него если DNS сервер выдаст ip адрес из этой подсети не будет грузиться сайт. Эта подсеть относиться к CDN <a href="https://ntc.party/t/%D0%BD%D0%B5-%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D0%B0%D0%B5%D1%82-%D1%81%D0%B0%D0%B9%D1%82-valorant-%D0%B8-steam/6042/26">akamai</a>. Без этого фикса лично у меня не грузились аватарки и превью к играм в steam и не устанавливался лаунчер curseforge.</p>
<blockquote>
<p>sed -i ‘9i echo “104.109.143.0/24” &gt;&gt; temp/list.csv’ /root/antizapret/doall.sh</p>
</blockquote>
<p>Был ещё такой <a href="https://ntc.party/t/%D0%BA%D0%BE%D0%BD%D1%82%D0%B5%D0%B9%D0%BD%D0%B5%D1%80-vpn-%D0%B0%D0%BD%D1%82%D0%B8%D0%B7%D0%B0%D0%BF%D1%80%D0%B5%D1%82%D0%B0-%D0%B4%D0%BB%D1%8F-%D1%83%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B8-%D0%BD%D0%B0-%D1%81%D0%BE%D0%B1%D1%81%D1%82%D0%B2%D0%B5%D0%BD%D0%BD%D1%8B%D0%B9-%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80/129/800">фикс</a>, но у меня часть доменов работало, часть нет, поэтому первый фикс лучше.</p></td><td>2024-08-15T04:38:00.466Z</td></tr><tr><td>ShiGhost(ShiGhost)</td><td><p>Так же можно <a href="https://ntc.party/t/antizapret-%D0%BD%D0%B0-%D1%80%D0%BE%D1%83%D1%82%D0%B5%D1%80%D0%B5-%D0%BD%D0%B5-%D1%80%D0%B5%D0%B7%D0%BE%D0%BB%D1%8C%D0%B2%D0%B8%D1%82-%D0%BD%D0%B5%D0%BA%D0%BE%D1%82%D0%BE%D1%80%D1%8B%D0%B5-%D1%81%D0%B0%D0%B9%D1%82%D1%8B/7659/4">отключить DNSSEC</a> особенно <a href="https://ntc.party/t/%D0%BA%D0%BE%D0%BD%D1%82%D0%B5%D0%B9%D0%BD%D0%B5%D1%80-vpn-%D0%B0%D0%BD%D1%82%D0%B8%D0%B7%D0%B0%D0%BF%D1%80%D0%B5%D1%82%D0%B0-%D0%B4%D0%BB%D1%8F-%D1%83%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B8-%D0%BD%D0%B0-%D1%81%D0%BE%D0%B1%D1%81%D1%82%D0%B2%D0%B5%D0%BD%D0%BD%D1%8B%D0%B9-%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80/129/77">работая в связки с AdguardHome</a>.</p></td><td>2024-08-15T09:47:13.738Z</td></tr><tr><td>dartraiden(Alexander Gavrilov)</td><td><p>Если есть желание, можно интегрировать <a href="https://github.com/dartraiden/no-russia-hosts" class="inline-onebox">GitHub - dartraiden/no-russia-hosts: Список доменов, владельцы которых ограничивают доступ с российских IP-адресов</a></p>
<p>Как следует из названия, это домены, владельцы которых не пускают россиян, поэтому сам бог велел их проксировать. Некоторые домены там пересекаются со списком заблокированных (например, Grammarly, который одновременно и россиян не пускает, и заблокирован Роскомнадзором).</p></td><td>2024-08-15T22:10:19.424Z</td></tr><tr><td>flameshikari(Evgeny)</td><td><p>Определённо нужно. Я такой список искал в своё время, но не нашёл.</p>
<p>К слову, я помогаю этот Docker-контейнер развивать. Там куча изменений висит в PR; xtrime смержит как будет время. В планах ещё с systemd переехать на supervisor, чтобы избавиться от привилегировнного режима контейнера (systemd без него не запускается; но в то же время это нежелательная опция Docker-контейнера). С твиками ядра тоже проблема: они только в привилегированном режиме применяются. Есть ли от них польза — непонятно; нужно проверять.</p></td><td>2024-08-16T08:16:57.252Z</td></tr><tr><td>DoplerEffect</td><td><p>это хорошо конечно все, но иногда такие списки не всем нужны, хотелось бы иметь выбор или как то просто их отключать. И хотелось бы какой то прозрачности что уже добавлено “из коробки”</p></td><td>2024-08-16T08:48:30.471Z</td></tr><tr><td>flameshikari(Evgeny)</td><td><p>Вся прозрачность находится в <a href="https://github.com/xtrime-ru/antizapret-vpn-docker" rel="noopener nofollow ugc">GitHub-репозитории</a>, а конкретно в <a href="https://github.com/xtrime-ru/antizapret-vpn-docker/blob/master/rootfs/root/fix.sh" rel="noopener nofollow ugc">этом файле</a> на данный момент. В будущем дополнительные домены в другом файле будут находиться.</p>
<p>Можно исключить ненужные домены через exclude-hosts-custom.txt или сделать опцию у контейнера для включения списка по желанию. Ну идея-то такая, чтобы из коробки доступ был ко всему как раньше. Подумаем, как лучше это сделать.</p></td><td>2024-08-16T09:05:36.685Z</td></tr><tr><td>DoplerEffect</td><td><p>Ну я  к тому , что мне приходится лезть в контейнер и половину из этого списка удалять самому, с добавлением нового списка нужно будет проделывать тоже самое. Фишка антизапрета как раз была в том, что у тебя по умолчанию работают только домены из списков роскомнадзора, а то что тебе еще самому нужно ты добавляешь сам. Мне в принципе не сложно все это самому править , просто хотелось бы универсальности какой то при сборке контейнера</p></td><td>2024-08-16T09:17:50.104Z</td></tr><tr><td>ShiGhost(ShiGhost)</td><td><aside class="quote no-group" data-username="DoplerEffect" data-post="167" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/doplereffect/48/3817_2.png" class="avatar"> DoplerEffect:</div>
<blockquote>
<p>то мне приходится лезть в контейнер и половину из этого списка удалять самому, с добавлением нового списка нужно будет проделывать тоже самое. Фишка антизапрета как раз была в том, что у тебя по умолчанию работают только домены из списков роскомнадзора, а то что тебе еще самому нужно ты добавляешь сам. Мне в принципе не сложно все это самому править , просто хотелось бы универсальности какой то при сборке контейнера</p>
</blockquote>
</aside>
<p>Я считаю, что нужно интегрировать данный список по умолчанию, это почти одно и тоже, что и с блокировка сайта со стороны роскомнадзора, только в этом случае со стороны владельца сайта, но нужно интегрировать с автоматическим обновлением этого списка, а не постоянно ручками обновлять контейнер.</p></td><td>2024-08-17T05:19:11.986Z</td></tr><tr><td>DoplerEffect</td><td><p>ну вы считаете так , я считаю по-другому, в итоге должен быть какой то выбор все же</p></td><td>2024-08-17T05:31:44.779Z</td></tr><tr><td>aeros9080(Aeros9080)</td><td><p>Друг, приветствую!<br>
Помогите, кто-нибудь<br>
Имеется - хост на бубунте 22.04, так же установил DCO согласно гайду<br>
вроде всё запустил, контейнер работает, но коннекта нет что по удп что по тсп. овпн успешно рапортует что соединение установлено, айпишник выдаёт, но весь интернет падает. Что делать, куда копать? Лог ОВПН - в спойлере</p>
<details>
<summary>
Спойлер</summary>
<p>Sun Aug 18 00:48:05 2024 Note: --cipher is not set. OpenVPN versions before 2.5 defaulted to BF-CBC as fallback when cipher negotiation failed in this case. If you need this fallback please add ‘–data-ciphers-fallback BF-CBC’ to your configuration and/or add BF-CBC to --data-ciphers.<br>
Sun Aug 18 00:48:05 2024 OpenVPN 2.6.12 [git:v2.6.12/038a94bae57a446c] Windows [SSL (OpenSSL)] [LZO] [LZ4] [PKCS11] [AEAD] [DCO] built on Jul 18 2024<br>
Sun Aug 18 00:48:05 2024 Windows version 10.0 (Windows 10 or greater), amd64 executable<br>
Sun Aug 18 00:48:05 2024 library versions: OpenSSL 3.3.1 4 Jun 2024, LZO 2.10<br>
Sun Aug 18 00:48:05 2024 DCO version: 1.2.1<br>
Sun Aug 18 00:48:06 2024 NOTE: --fast-io is disabled since we are running on Windows<br>
Sun Aug 18 00:48:06 2024 TCP/UDP: Preserving recently used remote address: [AF_INET]171.22.120.139:1194<br>
Sun Aug 18 00:48:06 2024 ovpn-dco device [OpenVPN Data Channel Offload] opened<br>
Sun Aug 18 00:48:06 2024 UDP link local: (not bound)<br>
Sun Aug 18 00:48:06 2024 UDP link remote: [AF_INET]171.22.120.139:1194<br>
Sun Aug 18 00:48:06 2024 [antizapret-server] Peer Connection Initiated with [AF_INET]171.22.120.139:1194<br>
Sun Aug 18 00:48:07 2024 IPv4 dns servers set using service<br>
Sun Aug 18 00:48:07 2024 IPv4 MTU set to 1420 on interface 15 using service<br>
Sun Aug 18 00:48:07 2024 Blocking outside dns using service succeeded.<br>
Sun Aug 18 00:48:07 2024 Initialization Sequence Completed</p>
</details></td><td>2024-08-17T17:55:01.091Z</td></tr><tr><td>dddennnisss</td><td><p>Всем привет. Как правильно создать дополнительные ключи для openvpn? Это нужно делать в контейнере или напрямую в системе?<br>
Можете, пожалуйста, написать путь и команду для генерации?<br>
Так же вопрос. А возможно сделать так чтобы сразу генерировался с новыми ключами файлик .ovpn?</p></td><td>2024-08-18T07:25:27.770Z</td></tr><tr><td>as9sefrv9jm2(as9sefrv9jm2)</td><td><p>docker compose pull<br>
docker compose up -d<br>
volumes не пересоздаются. И можно получить ситуацию что отредактировал кастомный список, пересобрал образ, а изменения из списка не подтянулись.<br>
если все же не принципиально иметь возможность редактировать файл из хоста, то надо сначала дропнуть volumes<br>
sudo docker compose down -v</p>
<p>и еще раз отредактировал: похоже проблема была всё же из за прав.<br>
тогда обратно вопрос, почему отдельный файл под кастомный список доменов, а не обновлять имеющийся пользовательский. Заполнять так же скриптом. Если изначально файл пустой то автоматом применять, если файл не пустой - то по команде дополнять несуществующими.</p>
<p>И тогда перечень кастомных доменов доступен в одном месте удобно и прозрачно для пользователя.</p></td><td>2024-08-19T11:26:06.664Z</td></tr><tr><td>xtrime</td><td><p>Сделали большое обновление контейнера: <a href="https://github.com/xtrime-ru/antizapret-vpn-docker/releases/tag/v3.1.0" class="inline-onebox">Release v3.1.0 · xtrime-ru/antizapret-vpn-docker · GitHub</a></p>
<p>Самые главные фишки:</p>
<ol>
<li>Понятные и предсказуемые regex правила для урлов. Никаких скриптов, вытаскивающих домены и тд… Регулярки сразу кидаются в конфиг kresd и проверки регулярок запускаются первыми, для максимального приоритета.</li>
<li>XOR Tunneblick scramble патч. Кажется реально обходит DPI у мобильных операторов. Но не все клиенты поддерживают. По умолчанию выключен в конфигах. Можно включить env переменной.</li>
<li>CBC шифрование теперь можно включить ENV переменной. DCO выключится, конечно, но для старых клиентов иначе никак.</li>
<li>Фикс конфликта ferm и docker на старых версиях хостовых систем.</li>
<li>Улучшение работы с конфигами - теперь файлы не в гит, а генерируются п</li>
</ol>
<aside class="quote no-group" data-username="as9sefrv9jm2" data-post="172" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/a/e47c2d/48.png" class="avatar"> as9sefrv9jm2:</div>
<blockquote>
<p>И тогда перечень кастомных доменов доступен в одном месте удобно и прозрачно для пользователя.</p>
</blockquote>
</aside>
<p>Сложная логика, что бы учесть все возможные ситуации. Придется писать отдельный механизм миграций, как для БД. Например файл заполнен пользовательскими и  и надо добавить пресловутый ютуб… Кажется не выгодня фича по соотношению польза/трудозатраты.</p></td><td>2024-08-19T21:57:59.123Z</td></tr><tr><td>xtrime</td><td><aside class="quote no-group" data-username="aeros9080" data-post="170" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/a/ebca7d/48.png" class="avatar"> aeros9080:</div>
<blockquote>
<p>овпн успешно рапортует что соединение установлено, айпишник выдаёт, но весь интернет падает. Что делать, куда копать?</p>
</blockquote>
</aside>
<p>А другие клиенты работают? Внутри контейнера интернет работает? Если да - то попробовать выключить DCO в клиенте винды.<br>
Если нет - то попробовать новую версию, там исправлен баг с конфликтами ferm с правилами iptables docker.</p>
<aside class="quote no-group" data-username="dddennnisss" data-post="171" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/dddennnisss/48/5497_2.png" class="avatar"> dddennnisss:</div>
<blockquote>
<p>А возможно сделать так чтобы сразу генерировался с новыми ключами файлик .ovpn?</p>
</blockquote>
</aside>
<p>Вот инструкция как перегенерить ключи: <a href="https://github.com/xtrime-ru/antizapret-vpn-docker?tab=readme-ov-file#keysconfigs-persistence" class="inline-onebox">GitHub - xtrime-ru/antizapret-vpn-docker: Docker container with antizapret-vpn for selfhosting.</a></p></td><td>2024-08-19T22:18:03.262Z</td></tr><tr><td>dartraiden(Alexander Gavrilov)</td><td><aside class="quote no-group" data-username="xtrime" data-post="173" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/xtrime/48/1524_2.png" class="avatar"> xtrime:</div>
<blockquote>
<p>Сделали большое обновление контейнера</p>
</blockquote>
</aside>
<ol>
<li>Нужно <a href="https://github.com/xtrime-ru/antizapret-vpn-docker/pull/38">поправить в ридми путь к пользовательским спискам</a> (он не существует в репозитории, что смущает пользователей)</li>
<li>Убрать <a href="https://github.com/xtrime-ru/antizapret-vpn-docker?tab=readme-ov-file#improvements">дублирующееся упоминание XOR-патче</a></li>
<li>Актуализировать строку <code>DNS=1.1.1.1 — DNS server to resolve domains (default: host DNS server)</code> в ридми (<a href="https://github.com/xtrime-ru/antizapret-vpn-docker/blob/51c7c9c2afa4556430984041447a0aedc4c6a385/docker-compose.yml#L20">теперь по умолчанию используется не DNS хоста</a>, кстати, почему?).</li>
</ol></td><td>2024-08-19T22:58:03.733Z</td></tr><tr><td>Xirurg</td><td><p>Отвалился интернет на всех устройствах после обновления  , ощущение  , что dns , полная переустановка контейнера помогла.</p></td><td>2024-08-19T23:45:12.480Z</td></tr><tr><td>dddennnisss</td><td><aside class="quote no-group" data-username="xtrime" data-post="174" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/xtrime/48/1524_2.png" class="avatar"> xtrime:</div>
<blockquote>
<p>Вот инструкция как перегенерить ключи: <a href="https://github.com/xtrime-ru/antizapret-vpn-docker?tab=readme-ov-file#keysconfigs-persistence" rel="noopener nofollow ugc">GitHub - xtrime-ru/antizapret-vpn-docker: Docker container with antizapret-vpn for selfhosting. </a></p>
</blockquote>
</aside>
<p>Про то как стереть текущие ключи и создать новые я понял, а как сделать дополнительные с другими именами?</p></td><td>2024-08-20T02:53:34.378Z</td></tr><tr><td>dennis(denis)</td><td><p>Всем привет, с контейнерами мало работал, правильно ли я понимаю, что в lxd когда я захожу внутрь контейнера (lxd shell antizapret-vpn) и что-то меняю, это меняет сам образ приложения и все изменения запоминаются, а для контейнера docker, чтобы запомнить изменения, нужна пересборка образа из исходного когда?</p>
<p>Может тогда все изменяемые части вынести в ENV?</p></td><td>2024-08-20T04:40:43.645Z</td></tr><tr><td>paweca</td><td><p>Зачем дефольтный DNS 1.1.1.1? У меня теперь везде ERR_NAME_NOT_RESOLVED, кроме ютуба ничего не работает.<br>
Я нуб и не врубаюсь как сделать чтобы хост был опять dns’ом.</p></td><td>2024-08-20T05:18:43.767Z</td></tr><tr><td>as9sefrv9jm2(as9sefrv9jm2)</td><td><p>Ну есть в принципе 2 пути:<br>
1:  заходишь в контейнер</p>
<pre data-code-wrap="bash"><code class="lang-bash">docker exec -it  antizapret-vpn bash
</code></pre>
<p>там вносишь нужные тебе правки, Ctrl+D чтоб выйти из него.<br>
После этого останавливай перезапускай - твои изменения никуда не денутся.<br>
Если речь о дополнении списка для обхода, то его можно и из хоста править, главное чтоб inode файла не менялся.<br>
2: после того как получил копию репозитория, делаешь в файлах/скриптах правки, собираешь, запускаешь.<br>
не понравилось, опять вносишь правки пересобираешь.</p></td><td>2024-08-20T05:33:57.606Z</td></tr><tr><td>as9sefrv9jm2(as9sefrv9jm2)</td><td><aside class="quote no-group" data-username="xtrime" data-post="173" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/xtrime/48/1524_2.png" class="avatar"> xtrime:</div>
<blockquote>
<p>Сложная логика, что бы учесть все возможные ситуации. Придется писать отдельный механизм миграций, как для БД. Например файл заполнен пользовательскими и и надо добавить пресловутый ютуб… Кажется не выгодня фича по соотношению польза/трудозатраты.</p>
</blockquote>
</aside>
<p>Кажется вы сразу стали заниматься оверинженерингом. Мы же на старте и так запускаем скрипт, можно просто его разделить. И в основном делать проверку - если файл пустой, выполняем скрипт2, который и заполнит.<br>
А в скрипт2, сделать функцию принимающую на вход строку вида “если строка в файле есть то скип, иначе вставить” и все кастомные домены которые хочется автоматом проставлять добавлять через нее. А в инструкциб по обновлению контейнера добавить:<br>
если хотите актуализировать список2 выполните</p>
<pre><code class="lang-auto">docker exec antizapret-vpn  bash -c "cd /root/antizapret &amp;&amp; ./script2.sh"
</code></pre>
<p>неплохо иметь готовый скрипт для включения/отключения списка заблокированного ркн. Больно уж много там всякого мусора помимо ошибочно заблокированного, иногда хочется иметь чисто свой список и всё)</p>
<p>в readme <code>git clone https://github.com/xtrime-ru/antizapret-vpn-docker.git antizapret</code> подразумевает что на целевой машине есть git, но это далеко не всегда так, и не всегда хочется его тянуть.<br>
Можно же просто вытянуть архив и распаковать в текущую папку</p>
<pre><code class="lang-auto">curl -L https://api.github.com/repos/xtrime-ru/antizapret-vpn-docker/tarball/master  | tar -xz --strip 1
</code></pre></td><td>2024-08-20T06:26:51.410Z</td></tr><tr><td>ShiGhost(ShiGhost)</td><td><p>Я так понимаю, что поддержку tls-crypt не вернули? Так же не сделали <a href="https://ntc.party/t/%D0%BD%D0%B5%D0%BE%D1%84%D0%B8%D1%86%D0%B8%D0%B0%D0%BB%D1%8C%D0%BD%D1%8B%D0%B9-docker-%D0%BA%D0%BE%D0%BD%D1%82%D0%B5%D0%B9%D0%BD%D0%B5%D1%80-%D0%B0%D0%BD%D1%82%D0%B8%D0%B7%D0%B0%D0%BF%D1%80%D0%B5%D1%82%D0%B0/8839/162">фикс</a> для AdguardHome. Так же не вижу смысла в kresd добавлять для РФ доменов другой DNS, ибо при использовании AdguardHome, лучше в нём уже указывать и там же будет фильтрация, иначе фильтрация не будет работать для этих доменов.</p></td><td>2024-08-20T07:54:10.991Z</td></tr><tr><td>Mr.Alex</td><td><p>а у меня наоборот все работает кроме ютуб</p></td><td>2024-08-20T08:46:34.873Z</td></tr><tr><td>xtrime</td><td><aside class="quote no-group" data-username="ShiGhost" data-post="182" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/shighost/48/4485_2.png" class="avatar"> ShiGhost:</div>
<blockquote>
<p>Так же не сделали <a href="https://ntc.party/t/%D0%BD%D0%B5%D0%BE%D1%84%D0%B8%D1%86%D0%B8%D0%B0%D0%BB%D1%8C%D0%BD%D1%8B%D0%B9-docker-%D0%BA%D0%BE%D0%BD%D1%82%D0%B5%D0%B9%D0%BD%D0%B5%D1%80-%D0%B0%D0%BD%D1%82%D0%B8%D0%B7%D0%B0%D0%BF%D1%80%D0%B5%D1%82%D0%B0/8839/162">фикс</a> для AdguardHome</p>
</blockquote>
</aside>
<p>Пропустил. Сделаем.</p>
<aside class="quote no-group" data-username="ShiGhost" data-post="182" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/shighost/48/4485_2.png" class="avatar"> ShiGhost:</div>
<blockquote>
<p>не вижу смысла в kresd добавлять для РФ доменов другой DNS</p>
</blockquote>
</aside>
<p>Это нужно, когда DNS не переопределяется. Сейчас добавил отдельную переменную ADGUARD, что бы выключала этот фикс.</p>
<aside class="quote no-group" data-username="ShiGhost" data-post="182" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/shighost/48/4485_2.png" class="avatar"> ShiGhost:</div>
<blockquote>
<p>Я так понимаю, что поддержку tls-crypt не вернули?</p>
</blockquote>
</aside>
<p>Забыл про него. Щас верну и сделаю включение через переменную.</p></td><td>2024-08-20T10:21:01.030Z</td></tr><tr><td>xtrime</td><td><aside class="quote no-group" data-username="dennis" data-post="178" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/d/e56c9b/48.png" class="avatar"> dennis:</div>
<blockquote>
<p>а для контейнера docker, чтобы запомнить изменения, нужна пересборка образа из исходного когда?</p>
</blockquote>
</aside>
<p>Наоборот. Контейнер собирается из образа, но потом там можно вносить любые правки и они останутся в контейнере при перезапусках. Но если пересоздать контейнер, то все правки пропадут.</p>
<p>Для того что бы правки сохранялись при пересозданиях контейнера, есть два варианта:</p>
<ol>
<li>сделать docker commit</li>
<li>поправить файлы на хосте и пересобрать образ командой <code>docker compose build</code>.</li>
</ol>
<p>В любом случае делать после этого docker compose pull нельзя, иначе будет загружен образ без ваших изменений и следующая команда docker compose up -d пересоздаст контейнер и затрет изменения.</p>
<p>При этом есть еще смонтированные папки (keys, config, .adguard). Они хранятся только на хосте и не зависят от перезагрузок и пересозданий контейнера.</p>
<aside class="quote no-group" data-username="dennis" data-post="178" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/d/e56c9b/48.png" class="avatar"> dennis:</div>
<blockquote>
<p>Может тогда все изменяемые части вынести в ENV?</p>
</blockquote>
</aside>
<p>Да. Список опциональных ENV переменных постоянно растет: <a href="https://github.com/xtrime-ru/antizapret-vpn-docker?tab=readme-ov-file#environment-variables" class="inline-onebox">GitHub - xtrime-ru/antizapret-vpn-docker: Docker container with antizapret-vpn for selfhosting.</a></p>
<aside class="quote no-group" data-username="paweca" data-post="179" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/p/b38774/48.png" class="avatar"> paweca:</div>
<blockquote>
<p>Зачем дефольтный DNS 1.1.1.1</p>
</blockquote>
</aside>
<p>Закоментировали, оставили в качестве примера.</p>
<aside class="quote no-group" data-username="as9sefrv9jm2" data-post="181" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/a/e47c2d/48.png" class="avatar"> as9sefrv9jm2:</div>
<blockquote>
<p>Можно же просто вытянуть архив и распаковать в текущую папку</p>
</blockquote>
</aside>
<p>Да. Я предпочитаю гит, и его использование позволяет обновлять проект в последствии.<br>
Если пользователь не хочет использовать гит, то вероятно имеет высокую квалификацию и может смело игнорить инструкцию <img src="https://ntc.party/images/emoji/twitter/slight_smile.png?v=12" title=":slight_smile:" class="emoji" alt=":slight_smile:" loading="lazy" width="20" height="20"><br>
PS. curl тоже из коробки отсутствует в убунте <img src="https://ntc.party/images/emoji/twitter/wink.png?v=12" title=":wink:" class="emoji" alt=":wink:" loading="lazy" width="20" height="20"></p></td><td>2024-08-20T10:34:23.423Z</td></tr><tr><td>xtrime</td><td><aside class="quote no-group" data-username="ShiGhost" data-post="182" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/shighost/48/4485_2.png" class="avatar"> ShiGhost:</div>
<blockquote>
<p>Я так понимаю, что поддержку tls-crypt не вернули?</p>
</blockquote>
</aside>
<p>Вернул tls_crypt с отдельной ENV переменной для включения. По умолчанию выключено, для совместимости.</p>
<aside class="quote no-group" data-username="paweca" data-post="179" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/p/b38774/48.png" class="avatar"> paweca:</div>
<blockquote>
<p>DNS 1.1.1.1</p>
</blockquote>
</aside>
<p>На убунту 20.04 почему то без этой опции не работал антизапрет. В новой версии закоментил, но если у кого то будут проблемы на старых системах - то надо раскоментить.</p></td><td>2024-08-20T11:41:21.801Z</td></tr><tr><td>paweca</td><td><aside class="quote no-group" data-username="xtrime" data-post="186" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/xtrime/48/1524_2.png" class="avatar"> xtrime:</div>
<blockquote>
<p>На убунту 20.04 почему то без этой опции не работал антизапрет</p>
</blockquote>
</aside>
<p>Получается что на 24.04 <strong>с</strong> этой опцией не работал.</p>
<p>Сейчас всё отлично.</p></td><td>2024-08-20T12:13:37.626Z</td></tr><tr><td>as9sefrv9jm2(as9sefrv9jm2)</td><td><aside class="quote no-group" data-username="xtrime" data-post="185" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/xtrime/48/1524_2.png" class="avatar"> xtrime:</div>
<blockquote>
<p>PS. curl тоже из коробки отсутствует в убунте <img src="https://ntc.party/images/emoji/twitter/wink.png?v=12" title=":wink:" class="emoji" alt=":wink:" loading="lazy" width="20" height="20"></p>
</blockquote>
</aside>
<p>у меня в минимальной нашелся. но может я сам когда то его накатил, не вспомню) curl/wget один фиг)</p>
<aside class="quote no-group" data-username="xtrime" data-post="185" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/xtrime/48/1524_2.png" class="avatar"> xtrime:</div>
<blockquote>
<p>Я предпочитаю гит</p>
</blockquote>
</aside>
<p>я тоже) но там где просто артефакты перекидывать можно и без него. и на прод не потянешь же.<br>
в данном случае это просто вкусовщина, согласен)</p>
<p>Так а что на счёт скрипта/переменной для отключения списка ркн и работы только с кастомным?</p></td><td>2024-08-20T14:19:41.769Z</td></tr><tr><td>xtrime</td><td><aside class="quote no-group" data-username="as9sefrv9jm2" data-post="188" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/a/e47c2d/48.png" class="avatar"> as9sefrv9jm2:</div>
<blockquote>
<p>Так а что на счёт скрипта/переменной для отключения списка ркн и работы только с кастомным?</p>
</blockquote>
</aside>
<p>Закину в бэклог, но не скоро руки дойдут. Но если есть желание, то буду рад Pull Request.</p></td><td>2024-08-20T14:34:34.716Z</td></tr><tr><td>dennis(denis)</td><td><p>Да, спасибо, разобрался. Форкнулся, скачал на локальную WSL, поправил свою версию (с апстримом у меня 192.168.100.1 конфликтует, приходится править), сохранился через docker save, перенес на VPS и пока живу на ней.</p>
<p>Странные дела, с мобилки эта версия работает, а LXD-шная нет, даже без SCRAMBLE и TLS_CRYPT. Хотя вроде как то же самое все, ну разве что DCO включено.</p></td><td>2024-08-20T14:58:18.436Z</td></tr><tr><td>xtrime</td><td><aside class="quote no-group" data-username="dennis" data-post="190" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/d/e56c9b/48.png" class="avatar"> dennis:</div>
<blockquote>
<p>с апстримом у меня 192.168.100.1 конфликтует, приходится править</p>
</blockquote>
</aside>
<p>А не хотите PullRequest сделать? Можно вынести в ENV переменную tcp и udp адреса и менять их в  исходниках через sed в скрипте init.sh</p></td><td>2024-08-20T20:32:33.899Z</td></tr><tr><td>cr00z</td><td><p>Здравствуйте, xtrime! Я впервые занимаюсь установкой VPN на свой сервер. Выбрал вашу сборку и сделал все по инструкции, но возникла следующая проблема: заблокированные сайты открываются отлично, а вот обычные нет (ошибка ERR_NAME_NOT_RESOLVED). Сначала подумал, что проблема с роутером, но установив openVPN на телефон, подключившись через мобильную сеть и загрузив туда файл с настройками, увидел ту же ситуацию. В чем может быть проблема, подскажите? Какие настройки поменять?</p></td><td>2024-08-20T22:38:11.823Z</td></tr><tr><td>cr00z</td><td><p>Заработало, но так и не понял в чем была проблема. Просто переустановил, но только на Ubuntu 24.04, а не 20.04</p></td><td>2024-08-20T23:52:28.477Z</td></tr><tr><td>dennis(denis)</td><td><p>Всем привет.</p>
<p>А вот такие ошибки не сильно страшны? На интерфейсе dco видно</p>
<blockquote>
<p>dmesg<br>
[  340.674639] ovpn_dco_v2: loading out-of-tree module taints kernel.<br>
[  340.674649] ovpn_dco_v2: module verification failed: signature and/or required key missing - tainting kernel<br>
[  340.760790] OpenVPN data channel offload (ovpn-dco) 0.0+git20231103 – (C) 2020-2023 OpenVPN, Inc.</p>
</blockquote>
<pre><code class="lang-auto">
root@antizapret:~# ip -details link show

2: vpn-tcp: &lt;POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP&gt; mtu 1420 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000
    link/none  promiscuity 0  allmulti 0 minmtu 68 maxmtu 65463
    **ovpn-dco** addrgenmode random numtxqueues 1 numrxqueues 1 gso_max_size 65536 gso_max_segs 65535 tso_max_size 65536 tso_max_segs 65535 gro_max_size 65536
3: vpn: &lt;POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP&gt; mtu 1420 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000
    link/none  promiscuity 0  allmulti 0 minmtu 68 maxmtu 65463
    **ovpn-dco** addrgenmode random numtxqueues 1 numrxqueues 1 gso_max_size 65536 gso_max_segs 65535 tso_max_size 65536 tso_max_segs 65535 gro_max_size 65536</code></pre></td><td>2024-08-21T05:07:26.964Z</td></tr><tr><td>xtrime</td><td><aside class="quote no-group" data-username="dennis" data-post="194" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/d/e56c9b/48.png" class="avatar"> dennis:</div>
<blockquote>
<p>А вот такие ошибки не сильно страшны? На интерфейсе dco видно</p>
</blockquote>
</aside>
<p>Да, у меня тоже ругается на верификацию модуля, но это никак не влияет на работу. Есть разные уровни проверки в ядре, на самом жестком такие модули будут отключаться: <a href="https://wiki.gentoo.org/wiki/Signed_kernel_module_support">https://wiki.gentoo.org/wiki/Signed_kernel_module_support</a></p>
<p>Но судя по выводу ip - модуль работает, значит предупреждение можно игнорировать.</p>
<aside class="quote no-group" data-username="cr00z" data-post="192" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/cr00z/48/7008_2.png" class="avatar"> cr00z:</div>
<blockquote>
<p>ошибка ERR_NAME_NOT_RESOLVED)</p>
</blockquote>
</aside>
<p>Связано как раз со старой версий хостовой системы. Для ubuntu20.04 надо было раскоментировать эти строки: <a href="https://github.com/xtrime-ru/antizapret-vpn-docker/blob/master/docker-compose.yml#L21-L22" class="inline-onebox">antizapret-vpn-docker/docker-compose.yml at master · xtrime-ru/antizapret-vpn-docker · GitHub</a></p>
<pre data-code-wrap="yml"><code class="lang-yml">#    dns:
#      - 1.1.1.1
</code></pre></td><td>2024-08-21T08:37:21.072Z</td></tr><tr><td>abrikman(Alexander K)</td><td><aside class="quote no-group" data-username="xtrime" data-post="191" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/xtrime/48/1524_2.png" class="avatar"> xtrime:</div>
<blockquote>
<p>А не хотите PullRequest сделать? Можно вынести в ENV переменную tcp и udp адреса и менять их в исходниках через sed в скрипте init.sh</p>
</blockquote>
</aside>
<p>попрошу еще заодно адрес в ключах (опционально, конечно же) прописывать не IP адрес, а доменное имя. Ну или если как-то можно сделать - подскажите, пожалуйста.</p>
<p>IP адреса самого OpenVPN да, топово было б менять вручную. <img src="https://ntc.party/images/emoji/twitter/slight_smile.png?v=12" title=":slight_smile:" class="emoji" alt=":slight_smile:" loading="lazy" width="20" height="20"></p></td><td>2024-08-21T11:58:13.075Z</td></tr><tr><td>cr00z</td><td><p>Спасибо. Возник еще один момент: на айфоне очень долго прогружаются видео через приложение Youtube. Хотя через Safari на <a href="http://youtube.com" rel="noopener nofollow ugc">youtube.com</a> заходит быстро и все видео грузятся отлично. Также все хорошо и на ПК…</p></td><td>2024-08-21T12:05:56.220Z</td></tr><tr><td>xtrime</td><td><p>В личке с <a href="https://ntc.party/u/Tyman" class="inline-onebox">Profile - Tyman - NTC</a> сейчас обсуждаем mtu. Он предположил, что несмотря на рекомендации использовать mtu 1420, это может создавать проблемы в некоторых условиях.</p>
<p>Попробуйте убрать mtu из конфигов сервера <code>./keys/server/antizapret.conf</code> или <code>./keys/server/antizapret-tcp.conf</code>  и из ovpn.<br>
Перезапустите контейнер и проверьте снова.</p></td><td>2024-08-21T12:25:27.357Z</td></tr><tr><td>Xirurg</td><td><p>У меня , после обновления  последнего(3.2.1) так и не работают многие сайты , яндекс маркет например</p>
<p>В логе роутера посыпались  ошибки<br>
Aug 21 15:54:22 ndnproxy<br>
Info: [CD4F] answer from wrong socket (got from 19 9.9.9.10:53 [0] to 192.168.104.2:59021, exp from 21 9.9.9.10:53 to 52426).</p></td><td>2024-08-21T12:56:08.605Z</td></tr><tr><td>dartraiden(Alexander Gavrilov)</td><td><blockquote>
<p>несмотря на рекомендации использовать mtu 1420, это может создавать проблемы в некоторых условиях</p>
</blockquote>
<p>Похоже да. У меня к одному серверу подключены два кинетика из разных точек РФ. Один нормально, а второй постоянно рвёт соединение</p>
<pre><code class="lang-auto">[E] Aug 21 16:01:40 OpenVPN0: AEAD Decrypt error: cipher final failed 
[E] Aug 21 16:01:47 OpenVPN0: Core::Syslog: last message repeated 4 times.
[I] Aug 21 16:01:48 OpenVPN0: [antizapret-server] Inactivity timeout (--ping-restart), restarting
</code></pre>
<p>Отключение <code>mtu</code> помогло.</p></td><td>2024-08-21T13:24:24.352Z</td></tr><tr><td>xtrime</td><td><aside class="quote no-group" data-username="dartraiden" data-post="200" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/dartraiden/48/15299_2.png" class="avatar"> dartraiden:</div>
<blockquote>
<p>Отключение <code>mtu</code> помогло.</p>
</blockquote>
</aside>
<p>Спасибо. Выключил mtu в конфигах. Пушу обновленный контейнер.</p></td><td>2024-08-21T13:38:32.819Z</td></tr><tr><td>xtrime</td><td><aside class="quote no-group" data-username="Xirurg" data-post="199" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/x/ecccb3/48.png" class="avatar"> Xirurg:</div>
<blockquote>
<p>Info: [CD4F] answer from wrong socket (got from 19 9.9.9.10:53 [0] to 192.168.104.2:59021, exp from 21 9.9.9.10:53 to 52426).</p>
</blockquote>
</aside>
<p>Кажется какие то проблемы с настройкой роутера. Это кинетик?</p></td><td>2024-08-21T13:40:06.695Z</td></tr><tr><td>Mr.Alex</td><td><p>У меня почему то очень долго грузятся заблокированные сайты. Может по 10-15 секунд открываться<br>
Провайдер Билайн<br>
DNS на роутере 1.1.1.1 и 8.8.8.8<br>
Все что сделал поставил на сервер АнтиЗапрет и DCO больше я ничего не трогал</p></td><td>2024-08-21T14:56:34.032Z</td></tr><tr><td>Xirurg</td><td><p>Да , но я  не чего не трогал , обновил ваш конфиг на vps и понеслось  , сейчас обновил(3.2.2) еще раз , пока 3 часа все ок .</p></td><td>2024-08-21T15:50:41.040Z</td></tr><tr><td>Oless</td><td><p>Хм, с отрубленным MTU лично у меня на Keenetic Viva стал прям оперативнее загружать ресурсы, которые в include конфигах, спасибо! Единственное, что заметил, при выставлении переменной SCRAMBLE=1, то Keenetic наглухо не хочет коннектиться к OVPN, сразу рубит коннект) Ни по UDP, ни по TCP</p></td><td>2024-08-21T16:23:07.073Z</td></tr><tr><td>dennis(denis)</td><td><p>SCRAMBLE=1 работает только на патченных клиентах!<br>
Для роутеров под openwrt есть тут версии: <a href="https://openwrt.132lan.ru/packages/23.05/packages/" class="inline-onebox" rel="noopener nofollow ugc">Index of /packages/23.05/packages/</a></p></td><td>2024-08-21T16:38:04.925Z</td></tr><tr><td>Oless</td><td><p>Тогда всё встало на свои места, значит у меня всё остальное работает как надо, спасибо! Я сижу на стоковой OS кинетика, на openwrt не очень хочу шиться) Единственное, конечно, DCO не хватает на кинетике, но там пока и как собрать его тоже не шибко понятно, т.к. в entware репах в этом плане не густо</p></td><td>2024-08-21T16:43:14.873Z</td></tr><tr><td>dennis(denis)</td><td><p>Кстати, проверил на 4-х роутерах (beeline smartbox+, asus ac58u, belkin 3200, dynalink wrx-36, все под openwrt) работу в UDP/DCO с дефолтным конфигом на docker-версии антизапрета, разница в скорости по сравнению с LXD версией (конфиг UDP/без DCO) в 2-3 раза.<br>
Даже самый среди них дохлый beeline smartbox+ выдал под 17мбит/с, чего вполне для повседневки достаточно, а мощные белкин с диналинком уперлись в 50мбит/с - шейпинг egress на стороне VPSa.</p>
<p>Автору респект, сделал очень хорошее дело!</p></td><td>2024-08-21T17:09:53.164Z</td></tr><tr><td>ShiGhost(ShiGhost)</td><td><p><a class="mention" href="/u/xtrime">@xtrime</a> установишь данный <a href="https://ntc.party/t/%D0%BD%D0%B5%D0%BE%D1%84%D0%B8%D1%86%D0%B8%D0%B0%D0%BB%D1%8C%D0%BD%D1%8B%D0%B9-docker-%D0%BA%D0%BE%D0%BD%D1%82%D0%B5%D0%B9%D0%BD%D0%B5%D1%80-%D0%B0%D0%BD%D1%82%D0%B8%D0%B7%D0%B0%D0%BF%D1%80%D0%B5%D1%82%D0%B0/8839/161">фикс</a> или куда мне его самому прописать, раньше его в fix.sh записывал, но его щас нету.</p></td><td>2024-08-22T02:47:40.063Z</td></tr><tr><td>ShiGhost(ShiGhost)</td><td><p>Почему то при указании TLS_CRYPT=1, не включается TLS. В файле .ovpn вижу эту строку.</p>
<blockquote>
<p>#<br>
#${CLIENT_TLS_CRYPT}<br>
#</p>
</blockquote></td><td>2024-08-22T03:33:59.864Z</td></tr><tr><td>ShiGhost(ShiGhost)</td><td><p>Так же при смене порта отличного от того, что установлен по умолчанию, не подключается к OpenVPN.<br>
Делал изменения:</p>
<blockquote>
<pre><code>ports:
  - "708:708/tcp"
  - "708:708/udp"
environment:
  - PORT=708
</code></pre>
</blockquote></td><td>2024-08-22T04:17:26.169Z</td></tr><tr><td>sk_koff</td><td><p>добрый день!<br>
подскажите, как открыть доступ к локальной сети, в которой устройство с антизапретом?<br>
сеть 192.168.1<br>
из файла exclude ip dist удалил, в include ip custom добавил, но доступа  к сети так и нет. по адресу 192.168.1.1 вебморда роутера не открывается</p></td><td>2024-08-22T07:19:21.068Z</td></tr><tr><td>ronin</td><td><p>Работает, только в конфиг сервера не падает порт, пробрасываем дефолт:</p>
<pre><code class="lang-auto">ports:
  - "708:1194/tcp"
  - "708:1194/udp"
environment:
  - PORT=708
</code></pre></td><td>2024-08-22T08:03:26.878Z</td></tr><tr><td>IronDan</td><td><p>Здравствуйте!<br>
На кинетике почему-то не заводится UDP подключение. Через TCP все идеально работает. Конфиг соответственно брался из двух разных файлов Ovpn созданных при установке контейнера. Может быть кто-то сталкивался?<br>
Извиняюсь, не туда при ответе нажал.</p></td><td>2024-08-22T09:23:18.476Z</td></tr><tr><td>ronin</td><td><p>Все работает, нужно смотреть логи из диагностики кинетика<br>
Проверьте работу конфига ovpn предварительно на ПК<br>
Возможно на сервере блокируется брандмауэром</p></td><td>2024-08-22T09:31:25.212Z</td></tr><tr><td>Oless</td><td><p>У меня такое было!!! Если вдруг, ну чисто случайно, твой хостер AEZA, то пиши в саппорт с проблемой, что нет коннекта к VPS по UDP протоколу) Они меняют IP адрес у VPS и магическим образом всё начинает работать) Мб сработает и с другими хостерами, т.к. если ты развернул всё правильно, у тебя нет кривых правил у фаервола, то проблема в 90% случаев у хостера.</p>
<p>Ну и на всякий случай, чекни фаервол) вдруг ты юзаешь какой-нибудь UFW и допустим открыл у порта только TCP</p></td><td>2024-08-22T10:44:00.076Z</td></tr><tr><td>xtrime</td><td><aside class="quote no-group" data-username="ShiGhost" data-post="209" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/shighost/48/4485_2.png" class="avatar"> ShiGhost:</div>
<blockquote>
<p>установишь данный <a href="https://ntc.party/t/%D0%BD%D0%B5%D0%BE%D1%84%D0%B8%D1%86%D0%B8%D0%B0%D0%BB%D1%8C%D0%BD%D1%8B%D0%B9-docker-%D0%BA%D0%BE%D0%BD%D1%82%D0%B5%D0%B9%D0%BD%D0%B5%D1%80-%D0%B0%D0%BD%D1%82%D0%B8%D0%B7%D0%B0%D0%BF%D1%80%D0%B5%D1%82%D0%B0/8839/161">фикс</a> или куда мне его самому прописать</p>
</blockquote>
</aside>
<p>Да, сделаю сейчас. У нас в репо целиком хранится doall.sh с правками и несколько других скриптов: <a href="https://github.com/xtrime-ru/antizapret-vpn-docker/tree/master/rootfs/root/antizapret" class="inline-onebox">antizapret-vpn-docker/rootfs/root/antizapret at master · xtrime-ru/antizapret-vpn-docker · GitHub</a><br>
Они перезаписывают то, что скачивается из оригинального репозитория при сборке.</p>
<aside class="quote no-group" data-username="ShiGhost" data-post="211" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/shighost/48/4485_2.png" class="avatar"> ShiGhost:</div>
<blockquote>
<p>Так же при смене порта отличного от того, что установлен по умолчанию, не подключается к OpenVPN.<br>
Делал изменения:</p>
</blockquote>
</aside>
<p>Достаточно вот такой правки, env не надо трогать:</p>
<pre><code class="lang-auto">ports:
  - "708:1194/tcp"
  - "708:1194/udp"
</code></pre>
<p>Надо выпилить лишние переменные.</p>
<aside class="quote no-group" data-username="ShiGhost" data-post="210" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/shighost/48/4485_2.png" class="avatar"> ShiGhost:</div>
<blockquote>
<p>Почему то при указании TLS_CRYPT=1, не включается TLS. В файле .ovpn вижу эту строку.</p>
</blockquote>
</aside>
<p>Точно! В init.sh баг, мы сначала генерируем конфиги из шаблонов, а потом правим регуляркой шаблоны <img src="https://ntc.party/images/emoji/twitter/slight_smile.png?v=12" title=":slight_smile:" class="emoji" alt=":slight_smile:" loading="lazy" width="20" height="20"><br>
Сделаю фикс, а пока достаточно еще пару раз перезапустить контейнер.</p></td><td>2024-08-22T11:09:49.285Z</td></tr><tr><td>xtrime</td><td><aside class="quote no-group" data-username="ShiGhost" data-post="209" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/shighost/48/4485_2.png" class="avatar"> ShiGhost:</div>
<blockquote>
<p>установишь данный <a href="https://ntc.party/t/%D0%BD%D0%B5%D0%BE%D1%84%D0%B8%D1%86%D0%B8%D0%B0%D0%BB%D1%8C%D0%BD%D1%8B%D0%B9-docker-%D0%BA%D0%BE%D0%BD%D1%82%D0%B5%D0%B9%D0%BD%D0%B5%D1%80-%D0%B0%D0%BD%D1%82%D0%B8%D0%B7%D0%B0%D0%BF%D1%80%D0%B5%D1%82%D0%B0/8839/161">фикс</a> или куда мне его самому прописать</p>
</blockquote>
</aside>
<p>А что вообще должен делать данный фикс? Разве нельзя просто положить данный диапазон в include-ips-custom.txt ?</p></td><td>2024-08-22T11:17:13.698Z</td></tr><tr><td>xtrime</td><td><p>А я правильно понимаю, что в parse.sh <a href="https://bitbucket.org/anticensority/antizapret-pac-generator-light/src/master/parse.sh" class="inline-onebox">Bitbucket</a> есть баг и temp/include-ips.txt и temp/exclude-ips.txt никак не используются?</p>
<p>Кажется, что temp/include-ips.txt должно мерджится в result/blocked-ranges.txt</p>
<p>UPDATE:<br>
Доработал патч: <a href="https://github.com/xtrime-ru/antizapret-vpn-docker/commit/32b7d5c221c80d7cc010cc153cb83129e0d5e5e1?diff=split&amp;w=1" class="inline-onebox">Fix: use include-ips.txt in parse.sh · xtrime-ru/antizapret-vpn-docker@32b7d5c · GitHub</a></p>
<p>Теперь blocked_ranges выглядит так, в последней строке наш диапазон:</p>
<pre><code class="lang-auto">103.246.200.0/22
178.239.88.0/21
185.104.45.0/24
193.105.213.36/30
203.104.128.0/20
203.104.144.0/21
203.104.152.0/22
68.171.224.0/19
74.82.64.0/19
104.109.143.0/24
</code></pre>
<p>Но exclude-ips-*.txt все еще не используются. Наверное предполагалось как то фильтровать blocked_ranges. Но это сложная для меня задача <img src="https://ntc.party/images/emoji/twitter/slight_smile.png?v=12" title=":slight_smile:" class="emoji" alt=":slight_smile:" loading="lazy" width="20" height="20"></p></td><td>2024-08-22T11:30:40.999Z</td></tr><tr><td>ShiGhost(ShiGhost)</td><td><p>Маршруты добавляет для этого диапазона ip адресов, а на счёт просто добавить в include-ips-custom.txt, не знаю, ибо сам <a href="https://ntc.party/t/%D0%BA%D0%BE%D0%BD%D1%82%D0%B5%D0%B9%D0%BD%D0%B5%D1%80-vpn-%D0%B0%D0%BD%D1%82%D0%B8%D0%B7%D0%B0%D0%BF%D1%80%D0%B5%D1%82%D0%B0-%D0%B4%D0%BB%D1%8F-%D1%83%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B8-%D0%BD%D0%B0-%D1%81%D0%BE%D0%B1%D1%81%D1%82%D0%B2%D0%B5%D0%BD%D0%BD%D1%8B%D0%B9-%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80/129/79">ValdikSS его изначально предлагал, а потом сказал сделать так.</a></p></td><td>2024-08-22T15:20:19.468Z</td></tr><tr><td>xtrime</td><td><p>Попробуйте свежую версию, вроде сделал тоже самое, но более правильным способом. Маршрут в итоге прилетает клиенту через push и должен роутиться через VPN.</p>
<p>Баг с TLS_CRYPT тоже поправил.</p></td><td>2024-08-22T15:28:32.200Z</td></tr><tr><td>dartraiden(Alexander Gavrilov)</td><td><aside class="quote no-group" data-username="IronDan" data-post="214" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/i/bc79bd/48.png" class="avatar"> IronDan:</div>
<blockquote>
<p>На кинетике почему-то не заводится UDP подключение.</p>
</blockquote>
</aside>
<p>По <a href="https://ntc.party/t/%D0%BE%D0%B1%D1%85%D0%BE%D0%B4-%D0%B1%D0%BB%D0%BE%D0%BA%D0%B8%D1%80%D0%BE%D0%B2%D0%BE%D0%BA-%D0%B2-%D1%80%D0%BE%D1%81%D1%81%D0%B8%D0%B8-%D1%87%D0%B5%D1%80%D0%B5%D0%B7-%D0%B0%D0%BD%D1%82%D0%B8%D0%B7%D0%B0%D0%BF%D1%80%D0%B5%D1%82-%D0%BD%D0%B0-%D0%BF%D1%80%D0%BE%D1%88%D0%B8%D0%B2%D0%BA%D0%B5-keenetic/7768">этой инструкции</a> всё прекрасно заводится. Только, разумеется, конфиг там будет не от публичного АнтиЗапрета, а тот, который вы вытащите со своего сервера.</p></td><td>2024-08-22T15:33:33.883Z</td></tr><tr><td>ShiGhost(ShiGhost)</td><td><p>Всё заработало, спасибо. А XOR с TLS работает? А то я включил их оба, не заработало пишет ошибка Options error: Unrecognized option or missing or extra parameter(s) in antizapret-client-udp.ovpn:42: scramble (2.6.12), потом отключил SCRAMBLE=0, сделал docker compose down &amp;&amp; docker compose up -d и ошибка осталась и не грузиться теперь ничего.</p></td><td>2024-08-22T16:21:53.636Z</td></tr><tr><td>ShiGhost(ShiGhost)</td><td><p>Удалил папку keys и заново пересоздал и подключилось, но dns запросы не работают, внутри контейнера kresd@1 имею логи</p>
<blockquote>
<p>Aug 22 19:32:39 2c6159b1215f kresd[473]: [system] warning: hard limit for number of file-descriptors is only 65535 but recommended value is 524288<br>
Aug 22 19:32:39 2c6159b1215f kresd[473]: [system] error while loading config: /etc/knot-resolver/knot-aliases-alt.conf:128496: unexpected symbol near ‘$’ (workdir ‘/var/lib/knot-resolver’)<br>
Aug 22 19:32:39 2c6159b1215f systemd[1]: kresd@1.service: Main process exited, code=exited, status=1/FAILURE<br>
Aug 22 19:32:39 2c6159b1215f systemd[1]: kresd@1.service: Failed with result ‘exit-code’.<br>
Aug 22 19:32:39 2c6159b1215f systemd[1]: Failed to start kresd@1.service - Knot Resolver daemon.</p>
</blockquote></td><td>2024-08-22T16:43:02.084Z</td></tr><tr><td>xtrime</td><td><aside class="quote no-group" data-username="ShiGhost" data-post="224" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/shighost/48/4485_2.png" class="avatar"> ShiGhost:</div>
<blockquote>
<p>error while loading config: /etc/knot-resolver/knot-aliases-alt.conf:128496</p>
</blockquote>
</aside>
<p>Какая то ошибка в файлике с правилами. Я бы рекомендовал еще раз пересоздать контейнер.</p></td><td>2024-08-22T19:41:02.198Z</td></tr><tr><td>CyberValdemar(CyberValdemar)</td><td><p>Здравствуйте, поставил контейнер на Ubuntu 22.04 без модификаций, только DCO включил для OpenVPN, такая же проблема как и у пользователя cr00z - в приложении youtube на айфоне видео подгружаются очень долго и нестабильно<br>
На ПК все вроде бы плюс минус окей - примерно как с контейнером антизапрета на LXC контейнере</p>
<p>mtu закомментирован в <code>./keys/server/antizapret.conf</code> - контейнер от 22.08.2024</p>
<p>Подскажите пожалуйста, в чем еще может быть проблема или как ее выявить)</p></td><td>2024-08-23T00:35:20.352Z</td></tr><tr><td>ShiGhost(ShiGhost)</td><td><p>Я нашёл причину, когда в файл include-hosts-custom.txt добавляю домены, то происходит данная ошибка.</p></td><td>2024-08-23T02:57:59.846Z</td></tr><tr><td>ShiGhost(ShiGhost)</td><td><p>В <a href="https://play.google.com/store/apps/details?id=de.blinkt.openvpn" rel="noopener nofollow ugc">клиенте OpenVPN</a> на android, не подключается к VPN, пока не удалишь из конфига</p>
<blockquote>
<p><span class="hashtag-raw">#tun-mtu</span> 1420<br>
<span class="hashtag-raw">#scramble</span> obfuscate password</p>
</blockquote>
<p>Ошибка без удаления</p>
<blockquote>
<p>Options error: Unrecognized option or missing or extra parameter(s) in stdin:129: scramble (2.7_master)</p>
</blockquote>
<p>При этом настройка SCRAMBLE=0</p></td><td>2024-08-23T04:23:52.147Z</td></tr><tr><td>DoplerEffect</td><td><p>в новом контейнере include-hosts-custom больше не работает ? есть ли вообще смысл обновляться?</p></td><td>2024-08-23T05:52:57.044Z</td></tr><tr><td>abrikman(Alexander K)</td><td><p>Интерресное наблюдение - если в кинетики с одной из новых версий контейнера не указать pull-filter ignore block-outside-dns - всё работает и так <img src="https://ntc.party/images/emoji/twitter/slight_smile.png?v=12" title=":slight_smile:" class="emoji" alt=":slight_smile:" loading="lazy" width="20" height="20"></p></td><td>2024-08-23T07:44:45.048Z</td></tr><tr><td>makx(3941701)</td><td><p>Удалось скомпилировать OpenVPN 2.6.12 с DCO под старенький MT7621 на Xiaomi Mi Router 4A Gigabit Edition на OpenWRT. Еще заменил шифрование на чача и скорость с 30 мегабит выросла почти до 60. В пиках даже выше, но всегда хочется больше) В итоге начал эксперименты с Wireguard, AmneziaWG, как по отдельности, так и с ruantiblock. Так и не смог добиться стабильной работы выборочной блокировки. Тот же 4pda не пускает в интересные разделы форума. Проверка 2ip то показывает зарубежный IP, то нет. Хотя ютуб работает отлично, скорость под 100 мегабит. В итоге вернулся на антизапрет. Пусть скорость и ниже, зато все работает стабильно и предсказуемо.</p></td><td>2024-08-23T08:14:05.362Z</td></tr><tr><td>xtrime</td><td><aside class="quote no-group" data-username="ShiGhost" data-post="228" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/shighost/48/4485_2.png" class="avatar"> ShiGhost:</div>
<blockquote>
<p>SCRAMBLE=0</p>
</blockquote>
</aside>
<p>Для scruble нужен клиент с поддержкой этой опции.</p>
<aside class="quote no-group" data-username="ShiGhost" data-post="227" data-topic="8839" data-full="true">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/shighost/48/4485_2.png" class="avatar"> ShiGhost:</div>
<blockquote>
<p>Я нашёл причину, когда в файл include-hosts-custom.txt добавляю домены, то происходит данная ошибка.</p>
</blockquote>
</aside>
<p>Спасибо, сейчас проверю include-hosts-custom. Рекомендую пользоваться include-regex-custom.txt. Там нет никакой дополнительной логики и ограничений на уровни домена, как в hosts файлах.</p></td><td>2024-08-23T11:32:37.384Z</td></tr><tr><td>xtrime</td><td><aside class="quote no-group" data-username="ShiGhost" data-post="227" data-topic="8839" data-full="true">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/shighost/48/4485_2.png" class="avatar"> ShiGhost:</div>
<blockquote>
<p>Я нашёл причину, когда в файл include-hosts-custom.txt добавляю домены, то происходит данная ошибка.</p>
</blockquote>
</aside>
<p>У меня проблема не воспроизводится. Можно пример файла?</p></td><td>2024-08-23T11:36:29.552Z</td></tr><tr><td>xtrime</td><td><aside class="quote no-group" data-username="CyberValdemar" data-post="226" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/c/59ef9b/48.png" class="avatar"> CyberValdemar:</div>
<blockquote>
<p>mtu закомментирован в <code>./keys/server/antizapret.conf</code></p>
</blockquote>
</aside>
<p>А в ovpn файле на клиенте?</p></td><td>2024-08-23T11:37:23.959Z</td></tr><tr><td>ShiGhost(ShiGhost)</td><td><p>Добавлял в файл который находиться в папке config, а не в rootfs.</p>
<blockquote>
<p><a href="http://mongodb.com" rel="noopener nofollow ugc">mongodb.com</a><br>
<a href="http://mongodb.net" rel="noopener nofollow ugc">mongodb.net</a></p>
</blockquote></td><td>2024-08-23T11:56:38.685Z</td></tr><tr><td>xtrime</td><td><p>К сожалению не могу воспроизвести проблему.</p>
<p>Мб ваш редактор добавляет какие то непечатные символы, типа \r в текст?</p>
<p>Попробуйте заполнить файл на сервере:</p>
<pre data-code-wrap="shell"><code class="lang-shell">echo -e "mongodb.com\nmongodb.net" &gt; ./config/include-hosts-custom.txt
</code></pre></td><td>2024-08-23T12:09:30.744Z</td></tr><tr><td>CyberValdemar(CyberValdemar)</td><td><p>Да, на клиенте тоже это закомментировано) Сам ничего не менял, видимо это ваши свежие изменения)</p></td><td>2024-08-23T13:51:41.110Z</td></tr><tr><td>ShiGhost(ShiGhost)</td><td><p>Странно. После ввода вашей команды заработало, потом я попробовал снова добавить, как я добавлял до этого и заработало.</p></td><td>2024-08-23T14:12:31.272Z</td></tr><tr><td>dartraiden(Alexander Gavrilov)</td><td><p>Советую добавлять с помощью nano, он гарантированно не добавляет ничего лишнего.</p>
<p><code>nano /путь/к/файлу</code></p>
<p>Ctrl+S - сохранить<br>
Ctrl+X  - выход</p></td><td>2024-08-24T00:05:10.647Z</td></tr><tr><td>spong(spong)</td><td><p>не актуально</p></td><td>2024-08-24T09:42:29.867Z</td></tr><tr><td>ShiGhost(ShiGhost)</td><td><p>А у меня такие логи в Keenetic, сегодня проблемы начались с работой OpenVPN, с переменным успехом работает. Мб начали блокировать OpenVPN?</p>
<blockquote>
<p>read UDPv4 [EMSGSIZE Path-MTU=1476|EMSGSIZE Path-MTU=1476]: Message too large (fd=4,code=97)<br>
read UDPv4 [EMSGSIZE Path-MTU=1476]: Message too large (fd=4,code=97)</p>
</blockquote></td><td>2024-08-24T10:17:03.408Z</td></tr><tr><td>Mr.Alex</td><td><p>Скорее всего. У меня со вчера начались проблемы с OpenVPN</p>
<p>Москва Билайн</p></td><td>2024-08-24T10:36:24.322Z</td></tr><tr><td>ShiGhost(ShiGhost)</td><td><p>Раскомментировал tun-mtu 1420 на сервере и на клиенте ошибка пропала и стало нормально работать.</p></td><td>2024-08-24T11:33:43.944Z</td></tr><tr><td>spong(spong)</td><td><p>Хотел узнать, на apple перестал ютуб работать, причем и на планшете и на телефоне, на всем остальном ОК, там патч на эпл не слетел случаем?<br>
<a href="https://redirector.googlevideo.com/report_mapping?di=no" class="onebox" target="_blank" rel="noopener nofollow ugc">https://redirector.googlevideo.com/report_mapping?di=no</a><br>
по этой ссылке выдает зарубежный сервер на эпле так что идёт через тунель.</p></td><td>2024-08-25T11:50:29.311Z</td></tr><tr><td>Lodeon(Lodeon)</td><td><p>Такая же фигня - домашний Билайн, но я грешил на хостинг - у меня дешевый Slicehosting с анлимом трафика и 3Gb памяти от индусов в Германии.</p>
<p>Брал по предложению на <a href="http://lowendbox.com" rel="noopener nofollow ugc">lowendbox.com</a>. Такое ощущение, что если поднять коннект openvpn до сервера, то в пингах до сервера начинаются потери. Но прямой закономерности не нашел. Нет такого, чтобя поднял openvpn и коннект сразу оборвался.</p>
<p>Как у вас выглядит?</p></td><td>2024-08-25T13:18:02.999Z</td></tr><tr><td>spong(spong)</td><td><p>У некоторых клиентов имеются проблемы, некоторые устройства (в частности ТВ, но не все), ловят периодическую буферизацию в видео на ютубе, которая висит бесконечно (перемотка не помогает) и нужно перезапускать видео (а зачастую и весь ютуб, который тоже не сразу запускается)<br>
Есть идем что может быть? Версия корнтейнера последняя (mtu убран). На других устройствах все ок и ютуб пингуется<br>
До этого в оригинальном конейтнере такой проблемы не было</p>
<p>Стало сильно меньше проблем после отключения fast-io на кинетике по протоколу udp, но прям полностью проблему не исправило</p></td><td>2024-08-25T16:13:52.640Z</td></tr><tr><td>Mr.Alex</td><td><p>Соеденение престало рваться, но режется скорость</p></td><td>2024-08-25T19:32:32.319Z</td></tr><tr><td>abugray(Georgy)</td><td><p>Какие параметры оптимальны для прошивки asus merlin в docker-compose.yaml? И такой же вопрос про параметры в админке роутера.</p></td><td>2024-08-25T21:13:35.509Z</td></tr><tr><td>dartraiden(Alexander Gavrilov)</td><td><p>Я ленивая жопа, которую напрягает перезапускать контейнер вручную каждый раз после добавления кастомных доменов, поэтому прикрутил автоперезапуск контейнера при изменении доменов:</p>
<pre><code class="lang-auto">sudo apt install incron

sudo nano /etc/incron.allow
</code></pre>
<p>Добавляем туда пользователя root</p>
<pre><code class="lang-auto">sudo systemctl enable incron

sudo incrontab -e
</code></pre>
<p>Вписывам <code>/path/to/antizapret/config IN_CREATE,IN_MODIFY docker restart antizapret-vpn</code></p>
<p><code>/path/to/antizapret/</code> - путь к склонированному репозиторию</p>
<p>При создании или изменении любого файла в <code>/path/to/antizapret/config</code> контейнер будет перезапущен</p></td><td>2024-08-25T21:50:23.052Z</td></tr><tr><td>spong(spong)</td><td><p><a class="mention" href="/u/xtrime">@xtrime</a> Вообщем я вчера весь вечер тестил, без fast-io ТВ ведут себя гораздо стабильнее.<br>
Но с устройствами эппл проблема сохраняется, как я описывал выше. Нереально долго грузится ютуб, на некоторых вообще не грузится. при этом пинг есть до частного адреса и стабильный а так же сервера выдают зарубежные</p></td><td>2024-08-26T04:50:54.997Z</td></tr><tr><td>xtrime</td><td><p>Прикольно, но лучше не рестартить, а только обновлять kresd:</p>
<pre data-code-wrap="shell"><code class="lang-shell">/path/to/antizapret/config IN_CREATE,IN_MODIFY docker exec antizapret-vpn bash /root/antizapret/doall.sh
</code></pre>
<p>Есть идеи автотоматически рестартить делать doall.sh если файлы поменялись, но пока не делали, так как есть задачи поважнее.</p>
<aside class="quote no-group" data-username="spong" data-post="246" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/s/7ea924/48.png" class="avatar"> spong:</div>
<blockquote>
<p>Стало сильно меньше проблем после отключения fast-io на кинетике по протоколу udp, но прям полностью проблему не исправило</p>
</blockquote>
</aside>
<p>Сейчас добавлю переменную для отключения всех “оптимизаций” типа fast-io и buffer size. Что бы было как в оригинальном антизапрете.</p>
<p>И еще добавлю лог в kresd,  что бы было видно какие урлы резолвятся. Мб приложение youtube ходит по каким то другим адресам? Надо будет обновиться, воспроизвести проблему и посотреть на какие адреса ходят приложения.<br>
Я недавно столкнулся с тем, что приложение speedtest ходит не на теже адреса, что сайт.</p></td><td>2024-08-26T10:14:20.045Z</td></tr><tr><td>xtrime</td><td><aside class="quote no-group" data-username="spong" data-post="250" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/s/7ea924/48.png" class="avatar"> spong:</div>
<blockquote>
<p>а так же сервера выдают зарубежные</p>
</blockquote>
</aside>
<p>Это что значит? DNS выдает для ютуба адреса из подсети 10.224 или нет?</p></td><td>2024-08-26T10:15:31.157Z</td></tr><tr><td>xtrime</td><td><aside class="quote no-group" data-username="abugray" data-post="248" data-topic="8839" data-full="true">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/a/6a8cbe/48.png" class="avatar"> abugray:</div>
<blockquote>
<p>Какие параметры оптимальны для прошивки asus merlin в docker-compose.yaml?</p>
</blockquote>
</aside>
<p>Используйте udp конфиг, там оптимальные параметры, которые отлично работают у меня на asus wrt.<br>
Но многое зависит от сети/провайдера. Если будут проблемы - пишите.</p></td><td>2024-08-26T10:17:18.280Z</td></tr><tr><td>spong(spong)</td><td><aside class="quote" data-post="252" data-topic="8839">
  <div class="title">
    <div class="quote-controls"></div>
    <img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/xtrime/48/1524_2.png" class="avatar">
    <a href="https://ntc.party/t/%D0%BD%D0%B5%D0%BE%D1%84%D0%B8%D1%86%D0%B8%D0%B0%D0%BB%D1%8C%D0%BD%D1%8B%D0%B9-docker-%D0%BA%D0%BE%D0%BD%D1%82%D0%B5%D0%B9%D0%BD%D0%B5%D1%80-%D0%B0%D0%BD%D1%82%D0%B8%D0%B7%D0%B0%D0%BF%D1%80%D0%B5%D1%82%D0%B0/8839/252">Неофициальный docker-контейнер АнтиЗапрета</a> <a class="badge-category__wrapper " href="/c/antizapret-prostovpn-org/az-self-hosted/38"><span data-category-id="38" style="--category-badge-color: #0088CC; --category-badge-text-color: #FFFFFF; --parent-category-badge-color: #8C6238;" data-parent-category-id="5" data-drop-close="true" class="badge-category --has-parent" title="Вопросы и особенности работы контейнера VPN АнтиЗапрета на своих серверах"><span class="badge-category__name">АнтиЗапрет на собственном сервере (self-hosted)</span></span></a>
  </div>
  <blockquote>
    Это что значит? DNS выдает для ютуба адреса из подсети 10.224 или нет?
  </blockquote>
</aside>
<p>
Это само собой, что пинги правильные (10.224.) я имел ввиду что по ссылке<br>
<a href="https://redirector.googlevideo.com/report_mapping?di=no" class="onebox" target="_blank" rel="noopener nofollow ugc">https://redirector.googlevideo.com/report_mapping?di=no</a><br>
Видеопоток идет как надо (с нидерландского сервера)<br>
Т.е. ситуация такая, 8 устройств, у всех пинги правильные (на эпле сужу косвенно, по серверу отдачи по ссылке выше) и по этой ссылке у всех одинаковый сервер отдачи потока, но на планшете старом эпловском вообще не грузится (либо грузится через 2 минуты), на телефоне эпловском с переменным успехом (может долго грузится а потом нормально работать)</p></td><td>2024-08-26T10:58:55.992Z</td></tr><tr><td>abugray(Georgy)</td><td><p>попробовал конфиг без всяких envirement, ничего не менял, на запрещенные сайты не заходит, vps своя.<br>
<div class="lightbox-wrapper"><a class="lightbox" href="неофициальный-docker-контейнер-антизапрета-8839/232c9c1719399f64d48d5b36f64fc80d5572cd9f.jpeg" data-download-href="https://ntc.party/uploads/default/232c9c1719399f64d48d5b36f64fc80d5572cd9f" title="75446757657"><img src="неофициальный-docker-контейнер-антизапрета-8839/232c9c1719399f64d48d5b36f64fc80d5572cd9f_2_274x500.jpeg" alt="75446757657" data-base62-sha1="51ahODmyMtySNjwQbnDhPcwBCLd" width="274" height="500" srcset="неофициальный-docker-контейнер-антизапрета-8839/232c9c1719399f64d48d5b36f64fc80d5572cd9f_2_274x500.jpeg, неофициальный-docker-контейнер-антизапрета-8839/232c9c1719399f64d48d5b36f64fc80d5572cd9f_2_411x750.jpeg 1.5x, неофициальный-docker-контейнер-антизапрета-8839/232c9c1719399f64d48d5b36f64fc80d5572cd9f_2_548x1000.jpeg 2x" data-dominant-color="565E61"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">75446757657</span><span class="informations">1030×1876 272 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>На переключатель не обращайте внимание, я отключил после того как проверил</p></td><td>2024-08-26T11:07:23.056Z</td></tr><tr><td>xtrime</td><td><aside class="quote no-group" data-username="spong" data-post="250" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/s/7ea924/48.png" class="avatar"> spong:</div>
<blockquote>
<p>без fast-io ТВ ведут себя гораздо стабильнее</p>
</blockquote>
</aside>
<p>Релизнул версию 3.3.0.</p>
<p>Добавил управление оптимизациями и MTU в ENV параметры: <a href="https://github.com/xtrime-ru/antizapret-vpn-docker?tab=readme-ov-file#environment-variables" class="inline-onebox">GitHub - xtrime-ru/antizapret-vpn-docker: Docker container with antizapret-vpn for selfhosting.</a></p>
<p>Так же протестил у себя приложени youtube. Вроде работает нормально, но добавил еще пару доменов apple, что бы резолвились через DNS_RU.</p>
<p>Если проблема с youtube сохраняется, то надо установить ENV переменную LOG_DNS=1 и посмотреть что за домены оно пытается резолвить в этот момент.</p></td><td>2024-08-26T14:24:30.891Z</td></tr><tr><td>xtrime</td><td><p>Не знаю что значат опции Create NAT on tunnel и Inbound firewall.</p>
<p>У меня вот так выглядят настройки. Вручную ничего не указываю, все из ovpn берется:<br>
<div class="lightbox-wrapper"><a class="lightbox" href="неофициальный-docker-контейнер-антизапрета-8839/b4d7b70ef5f74f27b98276bd363653449ab15a77.jpeg" data-download-href="https://ntc.party/uploads/default/b4d7b70ef5f74f27b98276bd363653449ab15a77" title="Снимок экрана 2024-08-26 в 16.28.17"><img src="неофициальный-docker-контейнер-антизапрета-8839/b4d7b70ef5f74f27b98276bd363653449ab15a77_2_645x499.jpeg" alt="Снимок экрана 2024-08-26 в 16.28.17" data-base62-sha1="pNO6WSsLLrVtC1l4rzlNh3KaOA7" width="645" height="499" srcset="неофициальный-docker-контейнер-антизапрета-8839/b4d7b70ef5f74f27b98276bd363653449ab15a77_2_645x499.jpeg, неофициальный-docker-контейнер-антизапрета-8839/b4d7b70ef5f74f27b98276bd363653449ab15a77_2_967x748.jpeg 1.5x, неофициальный-docker-контейнер-антизапрета-8839/b4d7b70ef5f74f27b98276bd363653449ab15a77_2_1290x998.jpeg 2x" data-dominant-color="3F4B4E"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">Снимок экрана 2024-08-26 в 16.28.17</span><span class="informations">1920×1488 151 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>Что в логах роутера и контейнера antizapret-vpn ?<br>
Что выдает <code>nslookup youtube.com 192.168.100.1</code> ?</p></td><td>2024-08-26T14:33:04.351Z</td></tr><tr><td>dartraiden(Alexander Gavrilov)</td><td><aside class="quote no-group" data-username="xtrime" data-post="257" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/xtrime/48/1524_2.png" class="avatar"> xtrime:</div>
<blockquote>
<p>У меня вот так выглядят настройки. Вручную ничего не указываю, все из ovpn берется:</p>
</blockquote>
</aside>
<p>Т.е. на асусах DNS, полученные от провайдера, игнорируются при подключении к VPN, и используется исключительно адрес DNS, полученный от сервера?</p>
<p>Там в новых прошивках есть такая странная штука “VPN Director”, <a href="https://ntc.party/t/antizapret-%D0%BD%D0%B0-asuswrt-merlin/7941/15">была информация, что его нужно отключать</a>.</p>
<p>Вроде как должно работать <a href="https://ntc.party/t/%D0%BD%D0%B5-%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D0%B0%D0%B5%D1%82-antizapret-%D0%BD%D0%B0-asus-ax88u/7985/7">вот так</a>. Но, возможно, тут лишние действия с дополнительными DNS и этим самым VPN Director. У меня нет на руках асуса, чтобы проверить.</p></td><td>2024-08-26T14:39:55.385Z</td></tr><tr><td>xtrime</td><td><aside class="quote no-group" data-username="dartraiden" data-post="258" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/dartraiden/48/15299_2.png" class="avatar"> dartraiden:</div>
<blockquote>
<p>Т.е. на асусах DNS, полученные от провайдера, игнорируются при подключении к VPN, и используется исключительно адрес DNS, полученный от сервера?</p>
</blockquote>
</aside>
<p>На моей версии прошивки, для клиентов - да. А когда по ssh на роутер заходишь, то он использует по умолчанию провайдерские DNS. Для dig/nslookup надо руками указывать 192.168.100.1</p></td><td>2024-08-26T14:47:57.147Z</td></tr><tr><td>dartraiden(Alexander Gavrilov)</td><td><p>Понятно, значит, мой вариант со сторонними DNS предпочтительнее, поскольку тогда и сам роутер использует DNS АнтиЗапрета.</p></td><td>2024-08-26T14:54:10.460Z</td></tr><tr><td>abugray(Georgy)</td><td><pre><code class="lang-auto">dig +trace youtube.com    

; &lt;&lt;&gt;&gt; DiG 9.10.6 &lt;&lt;&gt;&gt; +trace youtube.com
;; global options: +cmd
;; Received 38 bytes from 192.168.100.1#53(192.168.100.1) in 42 ms

 ~ % dig +trace youtube.com

; &lt;&lt;&gt;&gt; DiG 9.10.6 &lt;&lt;&gt;&gt; +trace youtube.com
;; global options: +cmd
;; Received 38 bytes from 192.168.100.1#53(192.168.100.1) in 41 ms
</code></pre>
<p>С компьютера вроде ожило, как заставить chatgpt работать? Добавил домен <a href="http://chatgpt.com" rel="noopener nofollow ugc">chatgpt.com</a> в файл ./config/include-hosts-custom.txt но не помогло.</p>
<p>Please try again later. If you are using a VPN, try turning it off. Check the <a href="https://status.openai.com/" rel="noopener nofollow ugc">status page</a> for information on outages.</p>
<p>Про роутер завтра отпишусь скорее всего, у вас официальная прошивка а у меня от мерлина, в плане VPN там намного больше настроек.</p></td><td>2024-08-26T18:58:01.869Z</td></tr><tr><td>xtrime</td><td><aside class="quote no-group" data-username="abugray" data-post="261" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/a/6a8cbe/48.png" class="avatar"> abugray:</div>
<blockquote>
<p><code>dig +trace youtube.com  </code></p>
</blockquote>
</aside>
<p>Не знаю как читать  +trace. Должно быть так:</p>
<pre><code class="lang-auto">root@antizapret:~# dig +short youtube.com @192.168.100.1
10.224.0.60
</code></pre>
<aside class="quote no-group quote-modified" data-username="abugray" data-post="261" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/a/6a8cbe/48.png" class="avatar"> abugray:</div>
<blockquote>
<p>Домены openai у нас включены в <a href="https://github.com/xtrime-ru/antizapret-vpn-docker/blob/master/rootfs/root/antizapret/config/include-hosts-dist.txt#L90-L94">ручной список</a>. Возможно ip вашего сервера у них в черном списке.</p>
</blockquote>
</aside></td><td>2024-08-26T19:12:43.708Z</td></tr><tr><td>abugray(Georgy)</td><td><pre><code class="lang-auto">dig +short youtube.com @192.168.100.1
10.224.0.16
10.224.0.17
10.224.0.18
10.224.0.15
</code></pre></td><td>2024-08-26T19:14:53.312Z</td></tr><tr><td>xtrime</td><td><p>Подсеть правильная, заблокированные сайты открываются через VPN. Все должно работать. Надо разобраться с роутером, что бы было так же <img src="https://ntc.party/images/emoji/twitter/slight_smile.png?v=12" title=":slight_smile:" class="emoji" alt=":slight_smile:" loading="lazy" width="20" height="20"></p></td><td>2024-08-26T19:19:20.562Z</td></tr><tr><td>dartraiden(Alexander Gavrilov)</td><td><aside class="quote no-group" data-username="abugray" data-post="261" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/a/6a8cbe/48.png" class="avatar"> abugray:</div>
<blockquote>
<p>Добавил домен <a href="http://chatgpt.com">chatgpt.com</a></p>
</blockquote>
</aside>
<p>Он “из коробки” <a href="https://github.com/xtrime-ru/antizapret-vpn-docker/blob/5b66541d3eac4e8318fca3fff84164b91750169e/rootfs/root/antizapret/config/include-hosts-dist.txt#L90">добавлен</a>, второй раз нет смысла.</p>
<p>Проверьте, в какие адреса на клиенте у вас резолвятся домены</p>
<pre><code class="lang-auto">chatgpt.com
oaistatic.com
oaiusercontent.com
openai.com
</code></pre>
<p>Они все должны резолвиться в 10.x.x.x, т.е. проксироваться через АнтиЗапрет.</p></td><td>2024-08-26T19:22:52.774Z</td></tr><tr><td>abugray(Georgy)</td><td><aside class="quote no-group" data-username="dartraiden" data-post="265" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/dartraiden/48/15299_2.png" class="avatar"> dartraiden:</div>
<blockquote>
<p><code>chatgpt.com</code></p>
</blockquote>
</aside>
<p>dig +short <a href="http://chatgpt.com" rel="noopener nofollow ugc">chatgpt.com</a> <span class="mention">@192.168.100.1</span><br>
172.64.155.209<br>
104.18.32.47</p></td><td>2024-08-26T19:26:04.699Z</td></tr><tr><td>abugray(Georgy)</td><td><p>теперь через роутер запрещенка работает, и ничего больше</p></td><td>2024-08-26T20:54:38.073Z</td></tr><tr><td>ShiGhost(ShiGhost)</td><td><p>После обновления не работает переменная OPENVPN_PORT, то есть конфиг со стандартным портом.</p></td><td>2024-08-27T03:02:19.068Z</td></tr><tr><td>dennis(denis)</td><td><aside class="quote no-group" data-username="abugray" data-post="267" data-topic="8839" data-full="true">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/a/6a8cbe/48.png" class="avatar"> abugray:</div>
<blockquote>
<p>теперь через роутер запрещенка работает, и ничего больше</p>
</blockquote>
</aside>
<p>Сталкивался с кем, что на DNS-сервере роутера при установке антизапрета обязательно надо выключать опцию rebind protection, по крайней мере так она в openwrt называется</p></td><td>2024-08-27T06:35:33.207Z</td></tr><tr><td>xtrime</td><td><p>Проверю. Спасибо за багрепорт.</p></td><td>2024-08-27T08:17:44.777Z</td></tr><tr><td>xtrime</td><td><p>Получилось победить iptables и docker. В ближайшие дни вынесу openvpn в отдельный контейнер и добавлю еще контейнер для ipsec.<br>
Вчера проверил, что там tunnel split работает.</p>
<p>Чуть позже будет wireguard и openconnect.</p></td><td>2024-08-27T08:22:53.893Z</td></tr><tr><td>abugray(Georgy)</td><td><aside class="quote no-group" data-username="abugray" data-post="267" data-topic="8839" data-full="true">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/a/6a8cbe/48.png" class="avatar"> abugray:</div>
<blockquote>
<p>теперь через роутер запрещенка работает, и ничего больше</p>
</blockquote>
</aside>
<p>теперь через роутер запрещенка работает, и ничего больше</p>
<p>Как это поправить?</p></td><td>2024-08-27T10:11:19.414Z</td></tr><tr><td>abrikman(Alexander K)</td><td><aside class="quote no-group" data-username="xtrime" data-post="271" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/xtrime/48/1524_2.png" class="avatar"> xtrime:</div>
<blockquote>
<p>В ближайшие дни вынесу openvpn в отдельный контейнер</p>
</blockquote>
</aside>
<p>сорян, а зачем? <img src="https://ntc.party/images/emoji/twitter/slight_smile.png?v=12" title=":slight_smile:" class="emoji" alt=":slight_smile:" loading="lazy" width="20" height="20"></p></td><td>2024-08-27T16:35:00.582Z</td></tr><tr><td>xtrime</td><td><p><strong>Добавлены сервера Cisco IPsec и Wireguard</strong></p>
<p><a href="https://github.com/xtrime-ru/antizapret-vpn-docker/blob/master/README.md#wireguard-server"><strong>Инструкция</strong></a><br>
<a href="https://github.com/xtrime-ru/antizapret-vpn-docker/pull/49">Исходный код</a></p>
<p><strong>[UPDATE 2024-08-28]:</strong> Забыл сразу запушить обновленный образ из за чего DNS не работал совсем через wireguard. Просьба сейчас обновить образы.</p>
<p><strong>Cisco IPSec</strong><br>
Cisco IPsec не смог полноценно проверить. Вероятно мой клиент (стандартный apple) не поддерживает tunnel split. Если использовать leftsubnet=10.0.0.0/8 в /etc/ipsec.conf, то клиент зависает на этапе получения конфигураций от сервера.  Но возможно на каких нибудь роутерах/системах заведется.</p>
<p><strong>Wireguard</strong><br>
Wireguard работает без нареканий. Через туннель идут только запросы в 10.0.0.0/8<br>
В openvpn еще несколько подсетей проксируются, это пока не реализовал для Wireguard. Но не думаю, что это критично.</p>
<p>Зато скорость и нагрузка на CPU вне конкуренции! На upload не смотрите, это у меня интернет такой <img src="https://ntc.party/images/emoji/twitter/slight_smile.png?v=12" title=":slight_smile:" class="emoji" alt=":slight_smile:" loading="lazy" width="20" height="20"><br>
<div class="lightbox-wrapper"><a class="lightbox" href="неофициальный-docker-контейнер-антизапрета-8839/0fa58140299a18a225aa5f544f490ad246f467b1.png" data-download-href="https://ntc.party/uploads/default/0fa58140299a18a225aa5f544f490ad246f467b1" title="image"><img src="неофициальный-docker-контейнер-антизапрета-8839/0fa58140299a18a225aa5f544f490ad246f467b1_2_690x292.png" alt="image" data-base62-sha1="2epKMPohBMrgieJTxzq3meB76hz" width="690" height="292" srcset="неофициальный-docker-контейнер-антизапрета-8839/0fa58140299a18a225aa5f544f490ad246f467b1_2_690x292.png, неофициальный-docker-контейнер-антизапрета-8839/0fa58140299a18a225aa5f544f490ad246f467b1_2_1035x438.png 1.5x, неофициальный-docker-контейнер-антизапрета-8839/0fa58140299a18a225aa5f544f490ad246f467b1_2_1380x584.png 2x" data-dominant-color="2E2F42"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">1440×610 73.8 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>Может быть когда нибудь прикручу openconnect. Схема отработана:<br>
Вот все что требуется запускать в контейнерах с сторонними протоколами, что бы трафик и DNS проксировались в antizapret-vpn:</p>
<pre><code class="lang-auto">ip route add 10.0.0.0/8 via $(dig +short antizapret-vpn)
iptables -t nat -A OUTPUT -d 10.0.0.1/32 -j DNAT --to-destination $(dig +short antizapret-vpn)
iptables -t nat -A PREROUTING -d 10.0.0.1/32 -j DNAT --to-destination $(dig +short antizapret-vpn)
iptables -t nat -A POSTROUTING -d 10.0.0.1/32 -j MASQUERADE
</code></pre></td><td>2024-08-27T17:59:50.780Z</td></tr><tr><td>xtrime</td><td><aside class="quote no-group" data-username="abrikman" data-post="275" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/a/848f3c/48.png" class="avatar"> abrikman:</div>
<blockquote>
<p>сорян, а зачем?</p>
</blockquote>
</aside>
<p>Можно использовать готовый оффициальный openvpn образ. И так более правильно с точки зрения микросервисной архитектуры. Единоличная ответственность и все такое.<br>
Так же можно будет рестартить только antizapret, а vpn туннель при этом будет живой.</p></td><td>2024-08-27T18:18:09.556Z</td></tr><tr><td>xtrime</td><td><aside class="quote no-group" data-username="abugray" data-post="272" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/a/6a8cbe/48.png" class="avatar"> abugray:</div>
<blockquote>
<p>теперь через роутер запрещенка работает, и ничего больше</p>
</blockquote>
</aside>
<p>А пробовали запустить openvpn клиент на телефоне или ПК и проверить там? Если работает ок, значит проблема в настройке роутера. Вот свежие темы про Asus:</p><aside class="quote quote-modified" data-post="1" data-topic="7941">
  <div class="title">
    <div class="quote-controls"></div>
    <img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/eliondel/48/2201_2.png" class="avatar">
    <a href="https://ntc.party/t/antizapret-%D0%BD%D0%B0-asuswrt-merlin/7941">Antizapret на Asuswrt-Merlin</a> <a class="badge-category__wrapper " href="/c/antizapret-prostovpn-org/az-self-hosted/38"><span data-category-id="38" style="--category-badge-color: #0088CC; --category-badge-text-color: #FFFFFF; --parent-category-badge-color: #8C6238;" data-parent-category-id="5" data-drop-close="true" class="badge-category --has-parent" title="Вопросы и особенности работы контейнера VPN АнтиЗапрета на своих серверах"><span class="badge-category__name">АнтиЗапрет на собственном сервере (self-hosted)</span></span></a>
  </div>
  <blockquote>
    Поднял свой сервер antizapret. При подключении через клиент openvpn - все работает прекрасно. Сайты, включая заблокированные открываются. 
Пытаюсь настроить на роутере - работают только НЕ заблокированные сайты. Заблокированные не работают. 
Может кто-то сможет подсказать что я делаю не так? 
Скрины всех настроек залил. 
Роутер RT-AX86U. 
Прошивка Asuswrt-Merlin 3004.388.7 
 <a class="lightbox" href="неофициальный-docker-контейнер-антизапрета-8839/62dc75580cca3f4ea3a8d2c8f5587cacd1d644bf.png" data-download-href="https://ntc.party/uploads/default/62dc75580cca3f4ea3a8d2c8f5587cacd1d644bf" title="Screenshot 2024-06-05 161337">[Screenshot 2024-06-05 161337]</a> 
<a class="lightbox" href="неофициальный-docker-контейнер-антизапрета-8839/724c3163a6d712c5fe60887895438e5ad913a548.png" data-download-href="https://ntc.party/uploads/default/724c3163a6d712c5fe60887895438e5ad913a548" title="Screenshot 2024-06-05 161443">[Screenshot 2024-06-05 161443]</a> 
<a class="lightbox" href="неофициальный-docker-контейнер-антизапрета-8839/fff2a7500a4daaf356ae5efaaf6723f21b160bee.png" data-download-href="https://ntc.party/uploads/default/fff2a7500a4daaf356ae5efaaf6723f21b160bee" title="Screenshot 2024-06-05 161417">[Screenshot 2024-06-05 161417]</a>
  </blockquote>
</aside>
<aside class="quote" data-post="1" data-topic="9769">
  <div class="title">
    <div class="quote-controls"></div>
    <img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/j/838e76/48.png" class="avatar">
    <a href="https://ntc.party/t/%D0%B0%D0%BD%D1%82%D0%B8%D0%B7%D0%B0%D0%BF%D1%80%D0%B5%D1%82-%D0%BD%D0%B0-asuswrt-merlin/9769">АнтиЗапрет на ASUSWrt-Merlin</a> <a class="badge-category__wrapper " href="/c/antizapret-prostovpn-org/az-self-hosted/38"><span data-category-id="38" style="--category-badge-color: #0088CC; --category-badge-text-color: #FFFFFF; --parent-category-badge-color: #8C6238;" data-parent-category-id="5" data-drop-close="true" class="badge-category --has-parent" title="Вопросы и особенности работы контейнера VPN АнтиЗапрета на своих серверах"><span class="badge-category__name">АнтиЗапрет на собственном сервере (self-hosted)</span></span></a>
  </div>
  <blockquote>
    Как побороть, двойной ответ  DNS? <a href="https://i.imgur.com/Uq8n1qg.png" rel="noopener nofollow ugc">nslookup</a> 
Роутер Asus.  <a href="https://i.imgur.com/YHquRtD.png" rel="noopener nofollow ugc">Лог запуска OPENVPN на Asus AX88U</a>
  </blockquote>
</aside>

<p>Если и обычные клиенты не работают, значит проблема на сервере. Возможно какие то правки вносились.<br>
Лучше стереть все и попробовать заново:</p>
<pre><code class="lang-auto">docker compose down
cd ../
rm -rf antizapret/
git clone https://github.com/xtrime-ru/antizapret-vpn-docker.git antizapret
cd antizapret
docker compose pull
docker compose up -d
</code></pre></td><td>2024-08-27T20:46:19.617Z</td></tr><tr><td>overherz(overherz)</td><td><p>у меня wg не заработал, сразу домены резолвиться перестают<br>
сносил, ставил все по новой<br>
openvpn работает</p></td><td>2024-08-27T23:00:15.212Z</td></tr><tr><td>Mr.Alex</td><td><p>Спасибо вам за такую тяжелую работу</p></td><td>2024-08-28T05:22:47.947Z</td></tr><tr><td>Oless</td><td><p>Аналогично, на кинетике попробовал подкинуть конфиг wg, сразу всё перестаёт резолвиться<br>
Видимо надо копаться, как он маршруты поднимает</p></td><td>2024-08-28T06:28:22.339Z</td></tr><tr><td>xtrime</td><td><p>Мой косяк, я забыл собрать новый образ для antizapret-vpn. Там новые iptables, без которых ferm не проксирует трафик из других контейнеров. Две ночи не спал <img src="https://ntc.party/images/emoji/twitter/upside_down_face.png?v=12" title=":upside_down_face:" class="emoji" alt=":upside_down_face:" loading="lazy" width="20" height="20"></p>
<p>Запушил обновленный контейнер. Просьба обновиться и попробовать снова.</p>
<pre><code class="lang-auto">git pull
docker compose down
docker compose -f docker-compose.wireguard.yml down
docker compose -f docker-compose.wireguard.yml pull
docker compose -f docker-compose.wireguard.yml up -d
</code></pre>
<p>Для избежания таких проблемcможно делать <code>git pull &amp;&amp; docker compose [-f ....] build</code>, что бы гарантированно иметь образ соответствующий состоянию git.</p></td><td>2024-08-28T08:57:20.687Z</td></tr><tr><td>ShiGhost(ShiGhost)</td><td><p>Ещё бы инструкцию по настройки клиента IPSec на Keenetic.</p></td><td>2024-08-28T09:35:59.430Z</td></tr><tr><td>overherz(overherz)</td><td><p>у меня через wg как-то долго все резолвится</p></td><td>2024-08-28T09:49:01.448Z</td></tr><tr><td>abugray(Georgy)</td><td><p>Удалить</p></td><td>2024-08-28T10:01:05.114Z</td></tr><tr><td>xtrime</td><td><p>Нужно использовать IPsec/XAuth (“Cisco IPsec”)<br>
Используется <strong>IKEv1 (XAUTH)</strong></p>
<p>Тут можно подчерпнуть какие то детали: <a href="https://github.com/hwdsl2/setup-ipsec-vpn/blob/master/docs/clients-xauth.md#fedora-and-centos" class="inline-onebox">setup-ipsec-vpn/docs/clients-xauth.md at master · hwdsl2/setup-ipsec-vpn · GitHub</a></p>
<p>В инструкции написано, что не все клиенты поддерживают split tunnel: <a href="https://github.com/hwdsl2/setup-ipsec-vpn/blob/master/docs/advanced-usage.md#split-tunneling" class="inline-onebox">setup-ipsec-vpn/docs/advanced-usage.md at master · hwdsl2/setup-ipsec-vpn · GitHub</a></p>
<blockquote>
<p>Split tunneling has some limitations, and is not supported by all VPN clients.</p>
</blockquote>
<p>Можно дополнительно попробовать настроить в контейнере ikev2: <a href="https://github.com/hwdsl2/setup-ipsec-vpn/blob/master/docs/ikev2-howto.md" class="inline-onebox">setup-ipsec-vpn/docs/ikev2-howto.md at master · hwdsl2/setup-ipsec-vpn · GitHub</a><br>
Есть вероятность что в таком режиме клиенты будут более совместимы. Но там много ручных действий, я не стал тратить время и прикрутил wireguard.</p></td><td>2024-08-28T10:06:01.313Z</td></tr><tr><td>xtrime</td><td><p>Т.е. проблема была в прописанных route? А зачем вы их прописывали? В ovpn файлах ничего такого нет.<br>
И кстати что будет если просто загрузить ovpn файл? В обычной прошивке этого достаточно.</p>
<aside class="quote no-group" data-username="abugray" data-post="285" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/a/6a8cbe/48.png" class="avatar"> abugray:</div>
<blockquote>
<p>Привет самому “дружелюбному” линукс комьюнити которое годами не могло выложить подобный скрин.</p>
</blockquote>
</aside>
<p>Т.е. надо было купить оборудование с поддержкой merelin, поставить нестандартную прошивку и настроить ее, что бы помочь анониму в интернете?</p></td><td>2024-08-28T10:14:48.703Z</td></tr><tr><td>abugray(Georgy)</td><td><p>Не ожило, ютуб не пашет, вернулся на старый VPN где на теликах тупо весь трафик пробрасывается. Почти все асус роутеры поддерживают прошивку от мерлина. Сколько уже бодаюсь с этим антизапретом лучше чем ручная настройка VPN директора и скрипта от open vpn ничего нет.</p></td><td>2024-08-28T10:23:18.981Z</td></tr><tr><td>Oless</td><td><p>Спасибо, проверил, не резолвит<br>
Скорее всего причина где-то у меня, раз коннект к WG есть в целом</p>
<p>По существу, при добавлении WG конфига и без\с галкой: Использовать для доступа в интернет , всегда получаю такую картину:</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="неофициальный-docker-контейнер-антизапрета-8839/fdae9c1281b83917465ff83faf7122fe837a5676.png" data-download-href="https://ntc.party/uploads/default/fdae9c1281b83917465ff83faf7122fe837a5676" title="Снимок экрана 2024-08-28 132622"><img src="неофициальный-docker-контейнер-антизапрета-8839/fdae9c1281b83917465ff83faf7122fe837a5676_2_690x366.png" alt="Снимок экрана 2024-08-28 132622" data-base62-sha1="AcaTLDtfbQrZTZynWsRdhVPyNZI" width="690" height="366" srcset="неофициальный-docker-контейнер-антизапрета-8839/fdae9c1281b83917465ff83faf7122fe837a5676_2_690x366.png, неофициальный-docker-контейнер-антизапрета-8839/fdae9c1281b83917465ff83faf7122fe837a5676_2_1035x549.png 1.5x, неофициальный-docker-контейнер-антизапрета-8839/fdae9c1281b83917465ff83faf7122fe837a5676_2_1380x732.png 2x" data-dominant-color="FBFBFC"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">Снимок экрана 2024-08-28 132622</span><span class="informations">1408×747 36.9 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>Поднимается автоматом два роута на 0.0.0.0 шлюз, на сколько понимаю один из роутов 10.0.0.1 это дефолтный DNS в WG конфиге, а 10.8.0.0 подсеть адреса самого WG, но ничего не резолвится<br>
При этом, если подкинуть в конфиг в AllowedIPs подсеть 0.0.0.0\0, то всё начинает работать с одним НО, весь трафик заворачивается в тунель WG, а не выборочно</p>
<p>Пока по ресёрчу кажется, что маршруты от WG, одним из которых является DNS никак не участвуют в резолвинге, от этого не понятно куда копать</p></td><td>2024-08-28T10:36:06.643Z</td></tr><tr><td>xtrime</td><td><p>Да, маршруты неправильные.<br>
В wireguard конфиге указан всего один маршрут:</p>
<pre><code class="lang-auto">AllowedIPs = 10.0.0.0/8
</code></pre>
<p>Но ваш роутер не хочет его использовать по какой то причине. При этом сам добавляет машрут до DNS: 10.0.0.1/32</p>
<p>Вам нужно вручную добавить машрут до 10.0.0.0/8 через wireguard. После этого должно все заработать.</p></td><td>2024-08-28T11:08:35.336Z</td></tr><tr><td>xtrime</td><td><aside class="quote no-group" data-username="abugray" data-post="288" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/a/6a8cbe/48.png" class="avatar"> abugray:</div>
<blockquote>
<p>Почти все асус роутеры поддерживают прошивку от мерлина</p>
</blockquote>
</aside>
<p>Все роутеры без USB его не поддерживают. Мой AX55 - например.</p>
<aside class="quote no-group" data-username="abugray" data-post="288" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/a/6a8cbe/48.png" class="avatar"> abugray:</div>
<blockquote>
<p>Сколько уже бодаюсь с этим антизапретом лучше чем ручная настройка VPN директора и скрипта от open vpn ничего нет</p>
</blockquote>
</aside>
<p>Прошу прощения, за бестактность, но ручная настройка это хорошо, если уметь ей пользоваться. Но в таком случае вы бы не задавали тут вопросы.<br>
Для того что бы opevpn корректно работал на AsusWRT достаточно загрузить openvpn в роутер и все. Вы сами усложняете себе жизнь.</p></td><td>2024-08-28T11:13:36.022Z</td></tr><tr><td>xtrime</td><td><p>Поправил работу OPENVPN_PORT, спасибо за bug report!</p></td><td>2024-08-28T11:38:03.674Z</td></tr><tr><td>Vazelinchik</td><td><p><a class="mention" href="/u/xtrime">@xtrime</a> день добрый. В первую очередь спасибо огромное за такую реализацию, всё очень нравится. После обновления отпал AdGuard в качестве настроенного DNS сервера. Настройки по сути изначальные не изменял, сделал файл docker-compose.override.yml в папке /antizapret с следующими данными</p>
<pre><code class="lang-auto">services:  
antizapret-vpn:
    environment:
      - DNS=adguardhome
      - ADGUARD=1
      - OPENVPN_OPTIMIZATIONS=1
      - OPENVPN_TLS_CRYPT=1
    depends_on:
      - adguardhome
  adguardhome:
    extends:
      file: docker-compose.adguard.yml
      service: adguardhome
  wg-easy:
    extends:
      file: docker-compose.wireguard.yml
      service: wg-easy
</code></pre>
<p>рядом лежит неизмененный файл docker-compose.adguard.yml . Если что-то ещё нужно предоставить или завести issue на github-е дайте знать. Но мне кажется (не сильно пока в этом разбираюсь правда), но где-то упустил зависимость или неправильно оформил .yml файл.<br>
p.s. сам openvpn с телефона работает, проблем с DNS нет. На пк указывал только DoH адрес AdGuard-а так и понял что он отлетел.</p></td><td>2024-08-28T12:25:00.720Z</td></tr><tr><td>Oless</td><td><p>Огромное спасибо за подсказку, сразу дошло куда копать. Вдруг кому-то будет полезно для Кинетиков, что сделал я:</p>
<ol start="0">
<li>
<p>Предусловие: в моём случае я имел отдельный профиль DNS интернет-фильтров. На скрине профиль Antizapret, где перечислен набор DNS адресов, которые я готов скармливать в Антизапрет через шлюз для дальнейшего резолва. Данный профиль выбран, как профиль контентной фильтрации по умолчанию для моей домашней сети.<br>
<div class="lightbox-wrapper"><a class="lightbox" href="неофициальный-docker-контейнер-антизапрета-8839/df2658ec7404fb1307f3872a89dba4b8ef43f638.png" data-download-href="https://ntc.party/uploads/default/df2658ec7404fb1307f3872a89dba4b8ef43f638" title="image"><img src="неофициальный-docker-контейнер-антизапрета-8839/df2658ec7404fb1307f3872a89dba4b8ef43f638_2_630x500.png" alt="image" data-base62-sha1="vQ4DlXG10l32SDbnIAD9K4QZx3y" width="630" height="500" srcset="неофициальный-docker-контейнер-антизапрета-8839/df2658ec7404fb1307f3872a89dba4b8ef43f638_2_630x500.png, неофициальный-docker-контейнер-антизапрета-8839/df2658ec7404fb1307f3872a89dba4b8ef43f638.png 1.5x, неофициальный-docker-контейнер-антизапрета-8839/df2658ec7404fb1307f3872a89dba4b8ef43f638.png 2x" data-dominant-color="ECF2F6"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">923×732 44.1 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
</li>
<li>
<p>В конфиге WG полученном с веб-интерфейса убрал переменную с DNS=10.0.0.1 и значение DNS адреса из конфига добавил в свой профиль контентной фильтрации Antizapret<br>
<div class="lightbox-wrapper"><a class="lightbox" href="неофициальный-docker-контейнер-антизапрета-8839/c14c367a1a34ea1762fdb1ed9141332cee721e58.png" data-download-href="https://ntc.party/uploads/default/c14c367a1a34ea1762fdb1ed9141332cee721e58" title="image"><img src="неофициальный-docker-контейнер-антизапрета-8839/c14c367a1a34ea1762fdb1ed9141332cee721e58_2_602x499.png" alt="image" data-base62-sha1="rzZr5HWdDjpcY04qegCfbBPAlhS" width="602" height="499" srcset="неофициальный-docker-контейнер-антизапрета-8839/c14c367a1a34ea1762fdb1ed9141332cee721e58_2_602x499.png, неофициальный-docker-контейнер-антизапрета-8839/c14c367a1a34ea1762fdb1ed9141332cee721e58.png 1.5x, неофициальный-docker-контейнер-антизапрета-8839/c14c367a1a34ea1762fdb1ed9141332cee721e58.png 2x" data-dominant-color="EBF2F7"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">884×734 36.8 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
</li>
<li>
<p>Загрузил файл WG в Других подключениях Кинетика и активировал его. Как и писалось выше, WG поднимает роуты. Т.к. DNS в конфиге более не присутствует, то поднимается только ОДИН роут - 10.8.0.0/24 с шлюзом 0.0.0.0 на интерфейсе WG.</p>
</li>
<li>
<p>Теперь необходимо добавить недостающие роуты и завернуть профиль контентной фильтрации Antizapret в собственно сам Antizapret на сервере.<br>
Создал bat файл со след. содержимым:</p>
</li>
</ol>
<pre><code class="lang-auto">route ADD 1.1.1.1 MASK 255.255.255.255 10.8.0.2
route ADD 8.8.8.8 MASK 255.255.255.255 10.8.0.2
route ADD 9.9.9.10 MASK 255.255.255.255 10.8.0.2
route ADD 77.88.8.8 MASK 255.255.255.255 10.8.0.2
route ADD 195.208.4.1 MASK 255.255.255.255 10.8.0.2
route ADD 10.0.0.0 MASK 255.0.0.0 10.8.0.2
route ADD 10.0.0.1 MASK 255.255.255.255 10.8.0.2
</code></pre>
<p>Как можно заметить, после команды ADD идут IP адреса DNS серверов из профиля контентной фильтрации Antizapret, далее маска подсети (почти везде /32) и IP адрес шлюза, его можно забрать из конфига WG в переменной Address без подсети.</p>
<p>Единственный роут, который не находится в профиле контентной фильтрации Antizapret это - 10.0.0.0/8 - насколько я понимаю, это сама подсеть антизапрета и её так же прокидывает через WG с помощью адреса шлюза.</p>
<p>По итогу маршруты выглядят так:<br>
<div class="lightbox-wrapper"><a class="lightbox" href="неофициальный-docker-контейнер-антизапрета-8839/5f9e47790b4a791d8e5f9389cdfdb79da996dc08.png" data-download-href="https://ntc.party/uploads/default/5f9e47790b4a791d8e5f9389cdfdb79da996dc08" title="image"><img src="неофициальный-docker-контейнер-антизапрета-8839/5f9e47790b4a791d8e5f9389cdfdb79da996dc08_2_690x452.png" alt="image" data-base62-sha1="dDStdEL0RRcmq8RzHc1dbgocdPq" width="690" height="452" srcset="неофициальный-docker-контейнер-антизапрета-8839/5f9e47790b4a791d8e5f9389cdfdb79da996dc08_2_690x452.png, неофициальный-docker-контейнер-антизапрета-8839/5f9e47790b4a791d8e5f9389cdfdb79da996dc08_2_1035x678.png 1.5x, неофициальный-docker-контейнер-антизапрета-8839/5f9e47790b4a791d8e5f9389cdfdb79da996dc08.png 2x" data-dominant-color="FAFBFB"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">1313×861 46.7 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>При проверке через dnsleaktest получаю аналогичный набор серверов, что и на конфигурации с OVPN:<br>
<div class="lightbox-wrapper"><a class="lightbox" href="неофициальный-docker-контейнер-антизапрета-8839/ec4d05e380186cda56c3168f87546caab306c8eb.png" data-download-href="https://ntc.party/uploads/default/ec4d05e380186cda56c3168f87546caab306c8eb" title="image"><img src="неофициальный-docker-контейнер-антизапрета-8839/ec4d05e380186cda56c3168f87546caab306c8eb.png" alt="image" data-base62-sha1="xIpHEmmrozCF0NUKT2z12iBfpF1" width="690" height="356" data-dominant-color="ECECEB"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">1005×519 19.4 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>Скорость на ютьюбе:<br>
<div class="lightbox-wrapper"><a class="lightbox" href="неофициальный-docker-контейнер-антизапрета-8839/997fbee541c2aaab47a01f8c14e2956dd717e87a.jpeg" data-download-href="https://ntc.party/uploads/default/997fbee541c2aaab47a01f8c14e2956dd717e87a" title="image"><img src="неофициальный-docker-контейнер-антизапрета-8839/997fbee541c2aaab47a01f8c14e2956dd717e87a_2_689x370.jpeg" alt="image" data-base62-sha1="lTUKiSNeMnpZqua5Su3ZOMikwPw" width="689" height="370" srcset="неофициальный-docker-контейнер-антизапрета-8839/997fbee541c2aaab47a01f8c14e2956dd717e87a_2_689x370.jpeg, неофициальный-docker-контейнер-антизапрета-8839/997fbee541c2aaab47a01f8c14e2956dd717e87a_2_1033x555.jpeg 1.5x, неофициальный-docker-контейнер-антизапрета-8839/997fbee541c2aaab47a01f8c14e2956dd717e87a.jpeg 2x" data-dominant-color="636668"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">1283×689 85.7 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p></td><td>2024-08-28T12:47:21.864Z</td></tr><tr><td>xtrime</td><td><p>Спасибо за инструкцию.</p>
<p>Но я не понимаю зачем нужны “DNS интернет-фильтры” ? Почему нельзя все это дропнуть, подключить конфиг по умолчанию и использовать DNS 10.0.0.1 который идет через wireguard в антизапрет? Какое поведение вы ожидаете?</p>
<p>С этими route постоянно проблемы (уже два треда про асус было, где из за них ломалось).</p></td><td>2024-08-28T13:02:09.899Z</td></tr><tr><td>xtrime</td><td><aside class="quote no-group" data-username="Vazelinchik" data-post="293" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/v/c37758/48.png" class="avatar"> Vazelinchik:</div>
<blockquote>
<pre><code class="lang-auto">services:  
antizapret-vpn:
</code></pre>
</blockquote>
</aside>
<p>У вас перед <code>antizapret-vpn:</code> не хватает отступа. Все остальное выглядит хорошо.</p></td><td>2024-08-28T13:04:07.154Z</td></tr><tr><td>Oless</td><td><p>Возможно это не актуально для данного решения в докере, но я черпал знания из этой инструкции, где необходимо было добавлять эти роуты при подключении к антизапрету через ovpn. Теперь по привычке и пытаюсь их прокидывать.</p>
<aside class="quote quote-modified" data-post="1" data-topic="7768">
  <div class="title">
    <div class="quote-controls"></div>
    <img alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/dartraiden/48/15299_2.png" class="avatar">
    <a href="https://ntc.party/t/%D0%BE%D0%B1%D1%85%D0%BE%D0%B4-%D0%B1%D0%BB%D0%BE%D0%BA%D0%B8%D1%80%D0%BE%D0%B2%D0%BE%D0%BA-%D0%B2-%D1%80%D0%BE%D1%81%D1%81%D0%B8%D0%B8-%D1%87%D0%B5%D1%80%D0%B5%D0%B7-%D0%B0%D0%BD%D1%82%D0%B8%D0%B7%D0%B0%D0%BF%D1%80%D0%B5%D1%82-%D0%BD%D0%B0-%D0%BF%D1%80%D0%BE%D1%88%D0%B8%D0%B2%D0%BA%D0%B5-keenetic/7768/1">Обход блокировок в России через АнтиЗапрет на прошивке Keenetic</a> <a class="badge-category__wrapper " href="/c/antizapret-prostovpn-org/help-me/40"><span data-category-id="40" style="--category-badge-color: #A461EF; --category-badge-text-color: #FFFFFF; --parent-category-badge-color: #8C6238;" data-parent-category-id="5" data-drop-close="true" class="badge-category --has-parent" title="Инструкции по настройке маршрутизаторов, просьбы о помощи — сюда"><span class="badge-category__name">Помощь с настройкой</span></span></a>
  </div>
  <blockquote>
    Если у вас прошивка версии 3.8 или новее 


Должны быть установлены компоненты «Фильтрация контента и блокировка рекламы при помощи облачных сервисов» и «Прокси-сервер DNS-over-HTTPS». Если у вас оригинальный роутер Keenetic, то установите эти компоненты, если не оригинальный, то все компоненты уже установлены. 


В разделе «Интернет-фильтр» на вкладке «Настройка DNS» в «Системный» профиль добавить серверы 


Тип сервера DNS: DNS-over-HTTPS
URL сервера DNS: https://common.dot.dns.yandex.net/dns-…
  </blockquote>
</aside>
</td><td>2024-08-28T13:16:13.208Z</td></tr><tr><td>xtrime</td><td><p>Звучит, как <a href="https://ru.wikipedia.org/wiki/%D0%9A%D0%B0%D1%80%D0%B3%D0%BE-%D0%BA%D1%83%D0%BB%D1%8C%D1%82" class="inline-onebox">Карго-культ — Википедия</a> <img src="https://ntc.party/images/emoji/twitter/slight_smile.png?v=12" title=":slight_smile:" class="emoji" alt=":slight_smile:" loading="lazy" width="20" height="20"></p>
<p>Я рекомендую попробовать максимально простую конфиграцию: убрать все фильтры/опции, загрузить готовый ovpn/wireguard файл.<br>
Если не работает, то тогда уже разбираться, почему.</p></td><td>2024-08-28T13:20:46.090Z</td></tr><tr><td>xtrime</td><td><aside class="quote no-group" data-username="abugray" data-post="267" data-topic="8839" data-full="true">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/a/6a8cbe/48.png" class="avatar"> abugray:</div>
<blockquote>
<p>теперь через роутер запрещенка работает, и ничего больше</p>
</blockquote>
</aside>
<p>Кстати проблема может быть вызвана багом DNS в докере на старых версиях хостовых систем.</p>
<p>Если у вас ubuntu 20.04 или аналогичная по древности система на хосте, то стоит вот эти две строки раскоментировать: <a href="https://github.com/xtrime-ru/antizapret-vpn-docker/blob/master/docker-compose.yml#L25-L26" class="inline-onebox">antizapret-vpn-docker/docker-compose.yml at master · xtrime-ru/antizapret-vpn-docker · GitHub</a> и сделать</p>
<pre data-code-wrap="shell"><code class="lang-shell">docker compose down
docker compose pull
docker compose up -d
</code></pre></td><td>2024-08-28T13:52:01.649Z</td></tr><tr><td>Vazelinchik</td><td><p>Виноват, неправильно вставил текст, там с отступом. Что ещё может быть?</p></td><td>2024-08-28T13:54:45.231Z</td></tr><tr><td>xtrime</td><td><p>В чем именно проблема? Чем больше деталей дадите, тем проще помогать <img src="https://ntc.party/images/emoji/twitter/slight_smile.png?v=12" title=":slight_smile:" class="emoji" alt=":slight_smile:" loading="lazy" width="20" height="20"></p></td><td>2024-08-28T13:56:24.946Z</td></tr><tr><td>xtrime</td><td><p>А! Я могу догадываться. В последней версии я убрал из adguard проброс 80 и 443 портов, для совместимости с серверами, где они уже заняты. Оставил только 3000. Если вы не можете получить доступ к админке, то надо</p>
<pre><code class="lang-auto">docker compose stop adguardhome
rm -rf .adguard/
docker compose up -d
</code></pre>
<p>И снова настроить adguard , но указать в качестве порта 3000 вместо 80.</p></td><td>2024-08-28T14:01:32.856Z</td></tr><tr><td>Vazelinchik</td><td><p>проблема в том, что перестал работать adguard. Не могу зайти в web-интерфейс, запустил docker compose logs adguardhome для просмотра информации, но там вроде бы всё хорошо, за исключением сообщения о буфере, может быть критичным?</p>
<pre><code class="lang-auto">adguardhome  | 2024/08/28 13:55:46.447379 [info] AdGuard Home is available at the following addresses:
adguardhome  | 2024/08/28 13:55:46.447600 [info] go to http://127.0.0.1:80
adguardhome  | 2024/08/28 13:55:46.447607 [info] go to http://[::1]:80
adguardhome  | 2024/08/28 13:55:46.447610 [info] go to http://172.18.0.2:80
adguardhome  | 2024/08/28 13:55:46.448025 [info] clients: processing addresses
adguardhome  | 2024/08/28 13:55:46.473063 [info] go to https://MY_SERVER_HOST:443
adguardhome  | 2024/08/28 13:55:47.739503 [info] dnsproxy: starting dns proxy server
adguardhome  | 2024/08/28 13:55:47.739745 [info] dnsproxy: creating udp server socket 0.0.0.0:53
adguardhome  | 2024/08/28 13:55:47.740135 [info] dnsproxy: listening to udp://[::]:53
adguardhome  | 2024/08/28 13:55:47.740301 [info] dnsproxy: creating tcp server socket 0.0.0.0:53
adguardhome  | 2024/08/28 13:55:47.740502 [info] dnsproxy: listening to tcp://[::]:53
adguardhome  | 2024/08/28 13:55:47.740906 [info] dnsproxy: creating tls server socket 0.0.0.0:853
adguardhome  | 2024/08/28 13:55:47.741116 [info] dnsproxy: listening to tls://[::]:853
adguardhome  | 2024/08/28 13:55:47.741287 [info] creating listener quic://0.0.0.0:853
adguardhome  | 2024/08/28 13:55:47.744694 failed to sufficiently increase receive buffer size (was: 208 kiB, wanted: 7168 kiB, got: 416 kiB). See https://github.com/quic-go/quic-go/wiki/UDP-Buffer-Sizes for details.
adguardhome  | 2024/08/28 13:55:47.745921 [info] listening quic://[::]:853
adguardhome  | 2024/08/28 13:55:47.753887 [info] dnsproxy: entering udp listener loop on [::]:53
adguardhome  | 2024/08/28 13:55:47.754304 [info] dnsproxy: entering tcp listener loop on [::]:53
adguardhome  | 2024/08/28 13:55:47.754858 [info] dnsproxy: entering tls listener loop on [::]:853
adguardhome  | 2024/08/28 13:55:47.755144 [info] Entering the DNS-over-QUIC listener loop on [::]:853

</code></pre>
<p>на всякий скидываю файл docker для adguard</p>
<pre><code class="lang-auto">services:
  antizapret-vpn:
    extends:
      file: docker-compose.yml
      service: antizapret-vpn
    environment:
      - DNS=adguardhome
      - ADGUARD=1
    depends_on:
      - adguardhome
  adguardhome:
    image: adguard/adguardhome
    container_name: adguardhome
    hostname: adguardhome
    restart: unless-stopped
    ports:
      # - 53:53/tcp
      # - 53:53/udp
      # - 80:80/tcp
      # - 443:443/tcp
      # - 784:784/udp
      # - 853:853/tcp
      - 3000:3000/tcp
#    dns:
#      - 1.1.1.1
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - ./.adguard/confdir:/opt/adguardhome/conf
      - ./.adguard/workdir:/opt/adguardhome/work
</code></pre></td><td>2024-08-28T14:08:33.002Z</td></tr><tr><td>dartraiden(Alexander Gavrilov)</td><td><p>Кинетик при подключении к VPN (по крайней мере, OpenVPN) не игнорирует адреса, полученные от провайдера (даже доисторическая прошивка Padavan это умела, а вот KeeneticOS не умеет).</p>
<p>Поэтому, если просто поднять туннель, кинетик будет использовать как адреса от провайдера, так и адрес DNS АнтиЗапрета. Соответственно, обход блокировок будет работать по принципу “работает в зависимости от того, кто первым успел ответить”.</p>
<p>Если же отключить получение адресов от провайдера вообще, то при падении туннеля (например, если сервер умрет или Роскомнадзор начнёт резать протокол) некому будет резолвить вообще.</p>
<p>Отсюда необходимость в принципе прописывать сторонние DNS и создавать роуты.</p>
<p>Вдобавок, приходится создавать отдельный профиль DNS для клиентов, потому, что без него возникают проблемы в некоторых случаях, когда провайдер использует PPPoE (в случае, когда подключение к провайдеру по IPoE, можно ограничиться добавлением DNS в системный профиль, не создавая профиль для клиентов).</p>
<p>Но это всё относится к OpenVPN. Поскольку инструкцция писалась под “официальный” АнтиЗапрет, она не тестировалась с WG и другими протоколами.</p></td><td>2024-08-28T14:09:09.540Z</td></tr><tr><td>Vazelinchik</td><td><p>Да, отлично. В этом и была причина, благодарю!</p></td><td>2024-08-28T14:10:11.317Z</td></tr><tr><td>xtrime</td><td><p>Спасибо за отличное обьяснение! Просто люди начинают эти роуты использовать и в asus, что бы решить пробему которой там, кажется, нет <img src="https://ntc.party/images/emoji/twitter/slight_smile.png?v=12" title=":slight_smile:" class="emoji" alt=":slight_smile:" loading="lazy" width="20" height="20"></p></td><td>2024-08-28T14:32:51.227Z</td></tr><tr><td>ShiGhost(ShiGhost)</td><td><p>В ipsec.env есть переменная VPN_IPSEC_PSK, откуда её брать или как сгенерировать?</p></td><td>2024-08-28T15:11:38.721Z</td></tr><tr><td>xtrime</td><td><p>Это любая строка на ваш выбор. В клиенте это называется общий ключ.</p></td><td>2024-08-28T15:33:10.196Z</td></tr><tr><td>ShiGhost(ShiGhost)</td><td><p>А тут?<br>
<div class="lightbox-wrapper"><a class="lightbox" href="неофициальный-docker-контейнер-антизапрета-8839/6f4d5238e0476f7ae026817964fc5586790b29e8.png" data-download-href="https://ntc.party/uploads/default/6f4d5238e0476f7ae026817964fc5586790b29e8" title="Screenshot_12"><img src="неофициальный-docker-контейнер-антизапрета-8839/6f4d5238e0476f7ae026817964fc5586790b29e8_2_690x103.png" alt="Screenshot_12" data-base62-sha1="fSCERwlK2ga91YrrhuMIGKiA1xC" width="690" height="103" srcset="неофициальный-docker-контейнер-антизапрета-8839/6f4d5238e0476f7ae026817964fc5586790b29e8_2_690x103.png, неофициальный-docker-контейнер-антизапрета-8839/6f4d5238e0476f7ae026817964fc5586790b29e8_2_1035x154.png 1.5x, неофициальный-docker-контейнер-антизапрета-8839/6f4d5238e0476f7ae026817964fc5586790b29e8_2_1380x206.png 2x" data-dominant-color="F9F9FA"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">Screenshot_12</span><span class="informations">1627×245 16.1 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p></td><td>2024-08-28T15:55:31.826Z</td></tr><tr><td>Oless</td><td><p>Спасибо огромное за разъяснение этого момента! Значит не зря я эти роуты добавлял, потому что у Keenetic с WG в этом плане такая же история, как и с OVPN</p></td><td>2024-08-28T16:08:43.905Z</td></tr><tr><td>Oless</td><td><p><a class="mention" href="/u/xtrime">@xtrime</a> осталось для полного фарша добавить поддержку XRay (XTLS Realty) и вообще не страшно будет, даже если WG\OVPN прихлопнут, то такой прокси уже просто так не потушить <img src="https://ntc.party/images/emoji/twitter/slight_smile.png?v=12" title=":slight_smile:" class="emoji" alt=":slight_smile:" loading="lazy" width="20" height="20"></p></td><td>2024-08-28T16:19:28.736Z</td></tr><tr><td>xtrime</td><td><aside class="onebox allowlistedgeneric" data-onebox-src="https://help.keenetic.com/hc/ru/articles/360000422620-IPSec-VPN-%D0%BA%D0%BB%D0%B8%D0%B5%D0%BD%D1%82-%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80">
  <header class="source">
      

      <a href="https://help.keenetic.com/hc/ru/articles/360000422620-IPSec-VPN-%D0%BA%D0%BB%D0%B8%D0%B5%D0%BD%D1%82-%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80" target="_blank" rel="noopener">Keenetic</a>
  </header>

  <article class="onebox-body">
    

<h3><a href="https://help.keenetic.com/hc/ru/articles/360000422620-IPSec-VPN-%D0%BA%D0%BB%D0%B8%D0%B5%D0%BD%D1%82-%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80" target="_blank" rel="noopener">IPSec VPN клиент/сервер</a></h3>

  <p>В Keenetic реализована&nbsp;возможность использовать встроенный клиент/сервер IPSec VPN.&nbsp;Благодаря наличию этой функции существует возможность, в соответствии с самыми&nbsp;строгими требованиями к безопаснос...</p>


  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

<p><img src="неофициальный-docker-контейнер-антизапрета-8839/b874684b279de83958a5b46f090b12abdf9dc778.png" alt="" data-base62-sha1="qjLfT3VxDU8bzy0IMgyDOjiG1oQ" role="presentation" width="575" height="227"><br>
<div class="lightbox-wrapper"><a class="lightbox" href="неофициальный-docker-контейнер-антизапрета-8839/3ad3a1e6cc1b4eface80111595d6f6600de76fc6.png" data-download-href="https://ntc.party/uploads/default/3ad3a1e6cc1b4eface80111595d6f6600de76fc6" title=""><img src="неофициальный-docker-контейнер-антизапрета-8839/3ad3a1e6cc1b4eface80111595d6f6600de76fc6_2_690x140.png" alt="" data-base62-sha1="8op72X9Wwo7WI5MPExc1jt9jHam" role="presentation" width="690" height="140" srcset="неофициальный-docker-контейнер-антизапрета-8839/3ad3a1e6cc1b4eface80111595d6f6600de76fc6_2_690x140.png, неофициальный-docker-контейнер-антизапрета-8839/3ad3a1e6cc1b4eface80111595d6f6600de76fc6.png 1.5x, неофициальный-docker-контейнер-антизапрета-8839/3ad3a1e6cc1b4eface80111595d6f6600de76fc6.png 2x" data-dominant-color="E4EAEE"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename"></span><span class="informations">932×190 18.9 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div><br>
Они так предлагают. Т.е. в локальной пишите свою сеть, а в удаленной как раз то что надо проксировать: 10.0.0.0 - 255.0.0.0 (/8)</p></td><td>2024-08-28T16:24:57.092Z</td></tr><tr><td>xtrime</td><td><aside class="quote no-group" data-username="Oless" data-post="311" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/o/b5ac83/48.png" class="avatar"> Oless:</div>
<blockquote>
<p>XRay</p>
</blockquote>
</aside>
<p>А там есть tunnel split? Я кажется только в openconnect видел. Но плохо разбираюсь во всех этих современных штуках.</p></td><td>2024-08-28T16:27:49.087Z</td></tr><tr><td>Oless</td><td><p>Может быть это ответит на ваш вопрос: <a href="https://sing-box.sagernet.org/configuration/" class="inline-onebox" rel="noopener nofollow ugc">Introduction - sing-box</a></p></td><td>2024-08-28T16:35:06.776Z</td></tr><tr><td>ShiGhost(ShiGhost)</td><td><p>Не получается подключить пишет нет соединения. А с wireguard на смартфоне вроде бы работает, но на Keenetic по инструкции выше не работает.</p></td><td>2024-08-28T16:46:37.006Z</td></tr><tr><td>dartraiden(Alexander Gavrilov)</td><td><p>Достаточно добавить OpenConnect, который маскируется под HTTPS, имеет кучу клиентов под все платформы и поддерживается даже в Keenetic (на данный момент - в бета-версиях).</p></td><td>2024-08-28T20:31:38.319Z</td></tr><tr><td>Oless</td><td><p>Спасибо, почитал про OpenConnect и действительно, это то что нужно<br>
Завернуть под HTTPS и там хоть об блокируйся, потому что по сути придётся весь HTTPS на 443 блокировать</p></td><td>2024-08-29T07:13:05.296Z</td></tr><tr><td>xtrime</td><td><p>Знакомый devops подсказал, что wg на 443 порту не блочат <img src="https://ntc.party/images/emoji/twitter/slight_smile.png?v=12" title=":slight_smile:" class="emoji" alt=":slight_smile:" loading="lazy" width="20" height="20"><br>
Запушил фикс На мегафоне он начал работать: <a href="https://github.com/xtrime-ru/antizapret-vpn-docker/issues/54" class="inline-onebox">ASC для WireGuard (AmneziaWG) · Issue #54 · xtrime-ru/antizapret-vpn-docker · GitHub</a></p>
<p>Обновляйтесь через git pull, пересоздавайте контейнер и скачивайте обновленный конфиг. Ну или руками поправить порт в старом конфиге.</p>
<p>PS</p>
<ul>
<li>Мам, давай сделаем OpenConnect?</li>
<li>У нас есть OpenConnect дома!<br>
OpenConnect дома:<br>
<img src="неофициальный-docker-контейнер-антизапрета-8839/b692f802bc5f5c97d303ae7a9721011f1dfc38b0.png" alt="image-29-e1670231093526-427x372" data-base62-sha1="q37MhJeHeIkdbiEsrfX5wVQC1Gg" width="213" height="186"></li>
</ul></td><td>2024-08-29T10:52:01.193Z</td></tr><tr><td>Oless</td><td><p>Спасибо!<br>
Только единственное:<br>
Переменная WG_PORT в docker-compose.wireguard.yml говорит именно WG внутри контейнера юзать 443, как основной порт подключения, а значит в компоузе проброс должен быть таким:</p>
<p>ports:<br>
- “443:443/udp”</p>
<p>Либо оставлять WG порт внутри контейнера дефолтный (не трогать переменную WG_PORT, дефолтный порт 51820), а маппить в самом компоузе на хостовый порт 443, тогда текущий маппинг будет верный:</p>
<p>ports:<br>
- “443:51820/udp”</p></td><td>2024-08-29T11:34:42.601Z</td></tr><tr><td>xtrime</td><td><p>Спасибо, проверю и поправлю сейчас. Второй вариант точно не правильный, так как переменная так же отвечает за генерацию клиентских конфигов. И там должен быть 443.</p></td><td>2024-08-29T11:41:24.941Z</td></tr><tr><td>crubik(Crubik)</td><td><aside class="quote no-group" data-username="Oless" data-post="319" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/o/b5ac83/48.png" class="avatar"> Oless:</div>
<blockquote>
<p>443:443</p>
</blockquote>
</aside>
<p>сломалось. не принимает трафик</p></td><td>2024-08-29T11:44:44.206Z</td></tr><tr><td>abugray(Georgy)</td><td><p>Sep  8 11:20:30 ovpn-client3[20654]: Data Channel: cipher ‘AES-128-GCM’, peer-id: 2<br>
Sep  8 11:20:30 ovpn-client3[20654]: Timers: ping 2, ping-restart 10<br>
Sep  8 11:20:30 ovpn-client3[20654]: Protocol options: protocol-flags cc-exit tls-ekm dyn-tls-crypt<br>
Sep  8 11:20:32 ovpn-client3[20654]: Initialization Sequence Completed<br>
Sep  8 11:20:41 ovpn-client3[20654]: [antizapret-server] Inactivity timeout (–ping-restart), restarting<br>
Sep  8 11:20:41 ovpn-client3[20654]: SIGUSR1[soft,ping-restart] received, process restarting<br>
Sep  8 11:20:41 ovpn-client3[20654]: Restart pause, 1 second(s)</p>
<p>И так постоянно.</p></td><td>2024-09-08T08:22:37.532Z</td></tr><tr><td>DoplerEffect</td><td><p>Используйте <code>OPENVPN_SCRAMBLE=1</code> и клиент с примененным xor патчем, возможно ваш провайдер блокирует openvpn протокол до вашего VPS</p></td><td>2024-09-08T11:10:53.281Z</td></tr><tr><td>abugray(Georgy)</td><td><aside class="quote no-group" data-username="DoplerEffect" data-post="323" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/doplereffect/48/3817_2.png" class="avatar"> DoplerEffect:</div>
<blockquote>
<p>клиент с примененным xor патчем</p>
</blockquote>
</aside>
<p>про это можно поподробнее? Как это сделать на прошивке от мерлина?</p></td><td>2024-09-09T12:53:39.832Z</td></tr><tr><td>dartraiden(Alexander Gavrilov)</td><td><p>Для этого нужно пересобирать прошивочный OpenVPN с патчем. Обращайтесь к разработчику прошивки.</p></td><td>2024-09-10T00:11:35.789Z</td></tr><tr><td>ronin</td><td><p>Ожидаем <a href="https://github.com/xtrime-ru/antizapret-vpn-docker/pull/59" rel="noopener nofollow ugc">одобрение на Wireguard Amnezia</a>, написал <a href="https://github.com/Dimariqe/antizapret-vpn-docker/blob/master/docs/guide_Keenetic_RU.md" rel="noopener nofollow ugc">инструкцию для Keenetic</a>, если есть желающие протестировать - можно запуститься из <a href="https://github.com/Dimariqe/antizapret-vpn-docker" rel="noopener nofollow ugc">моего форка</a>. Единственное, для работы SKIP_UPDATE_FROM_ZAPRET и UPDATE_TIMER нужно будет сделать билд контейнера. Но это не обязательно.</p></td><td>2024-09-10T07:56:07.896Z</td></tr><tr><td>abugray(Georgy)</td><td><p>Боюсь мерлин никогда подобное не интегрирует)</p></td><td>2024-09-10T12:14:48.774Z</td></tr><tr><td>dartraiden(Alexander Gavrilov)</td><td><p>Да, он <a href="https://www.snbforums.com/threads/merlin-firmware-openvpn-obfuscate.23200/#post-170603">советовал</a> переходить на asuswrt-phantom, форк его прошивки, куда интегрировали этот патч, но этот форк уже заброшен. Впрочем, контакты известны, можно и попросить, вдруг он передумает, как говорится, за спрос денег не берут.</p></td><td>2024-09-10T15:40:49.430Z</td></tr><tr><td>1946amber</td><td><p>у кого то получилось запустить на tp-link?<br>
с конфигом OpenVPN tcp - открываются только заблокированные сайты<br>
с конфигом OpenVPN udp - не открываются заблокированные сайты</p>
<p>на телефоне смог запустить конфиг WG - все работает отлично, но на роутере он открывает только заблокированные сайты.<br>
я так понимаю что нужно роуты тоже какие.</p></td><td>2024-09-11T04:32:21.699Z</td></tr><tr><td>bync(Ole)</td><td><p>Добрый день! В вашем контейнере же прописаны нейросети и интел? Просто некоторые сайты, если делать nslookup, то, например, <a href="http://gemini.google.com" rel="noopener nofollow ugc">gemini.google.com</a> или <a href="http://intel.com" rel="noopener nofollow ugc">intel.com</a> показывает реальные айпи, а не подменные.</p></td><td>2024-09-11T14:07:53.038Z</td></tr><tr><td>Xirurg</td><td><p>Добрый. Хотелось то же патчик как в теме без контейнера , для тех у кого заблочили openvpn</p></td><td>2024-09-12T19:51:02.663Z</td></tr><tr><td>ronin</td><td><p>Если будут желающие протестировать, могу добавить патч.</p></td><td>2024-09-13T09:24:27.979Z</td></tr><tr><td>DoplerEffect</td><td><p>так есть же уже <a href="https://tunnelblick.net/cOpenvpn_xorpatch.html" rel="noopener nofollow ugc">XOR Tunneblick patch</a></p></td><td>2024-09-13T10:08:31.878Z</td></tr><tr><td>ronin</td><td><p>Есть, но как я понимаю для него необходим собственный клиент, а в <a href="https://ntc.party/t/%D1%81%D0%BA%D1%80%D0%B8%D0%BF%D1%82-%D0%B4%D0%BB%D1%8F-%D0%B0%D0%B2%D1%82%D0%BE%D0%BC%D0%B0%D1%82%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%BE%D0%B3%D0%BE-%D1%80%D0%B0%D0%B7%D0%B2%D0%B5%D1%80%D1%82%D1%8B%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-antizapret-vpn-%D0%BE%D0%B1%D1%8B%D1%87%D0%BD%D1%8B%D0%B9-vpn-%D0%B1%D0%B5%D0%B7-%D0%BA%D0%BE%D0%BD%D1%82%D0%B5%D0%B9%D0%BD%D0%B5%D1%80%D0%B0-%D0%BF%D0%B0%D1%82%D1%87-%D0%B4%D0%BB%D1%8F-%D0%BE%D0%B1%D1%85%D0%BE%D0%B4%D0%B0-%D0%B1%D0%BB%D0%BE%D0%BA%D0%B8%D1%80%D0%BE%D0%B2%D0%BA%D0%B8-openvpn/9270/776">версии от пользователя</a> <a class="mention" href="/u/tyman">@Tyman</a> не нарушена работа со всеми клиентами openvpn. Как я понимаю просто подмешивается мусор, чтобы обойти dpi.</p></td><td>2024-09-13T11:20:03.779Z</td></tr><tr><td>h7n14(H7n14je)</td><td><p>А как заставить резолвить opennic адреса? kresd.conf в контейнере и в rootfs вроде стоят рабочие адреса. Попробовал поменять адреса все так же не работают</p></td><td>2024-09-13T13:06:43.864Z</td></tr><tr><td>Xirurg</td><td><p>Подскажите пожалуйста .Если хочу  еще одного  клиента подключить , можно  ли использовать одновременно  один конфиг ? Если нет , как создать на том же vps еще один.</p></td><td>2024-09-15T18:03:59.966Z</td></tr><tr><td>dartraiden(Alexander Gavrilov)</td><td><p>Можно.</p></td><td>2024-09-15T21:39:41.258Z</td></tr><tr><td>bync(Ole)</td><td><p>Автор в тему не отвечает уже давно, контейнер заброшен?</p></td><td>2024-09-16T08:34:02.580Z</td></tr><tr><td>Xirurg</td><td><p>Да вот только вчера  обновление  было , теперь  на заблоченных vps заработало .</p></td><td>2024-09-16T11:40:15.372Z</td></tr><tr><td>bync(Ole)</td><td><aside class="quote no-group" data-username="Xirurg" data-post="339" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/x/ecccb3/48.png" class="avatar"> Xirurg:</div>
<blockquote>
<p>Да вот только вчера обновление было</p>
</blockquote>
</aside>
<p>Действительно, странно просто что тут молчит…</p></td><td>2024-09-16T12:30:48.159Z</td></tr><tr><td>bync(Ole)</td><td><p>Подскажите, кто в курсе, если роутер Кинетик Гига 1101 то DCO нужно отключать? Вроде где-то мелькнуло что не поддерживает клиент и фича бесполезна?</p></td><td>2024-09-16T12:36:37.560Z</td></tr><tr><td>dartraiden(Alexander Gavrilov)</td><td><p>Поддержка DCO ускоряет работу на той стороне, на которой она есть.<br>
Она не обязательно обязана быть с обоих концов.</p>
<p>Таким образом, на сервере OpenVPN будет работать быстрее.<br>
На роутере поддержка, конечно, тоже бы не помешала.</p></td><td>2024-09-16T13:04:35.197Z</td></tr><tr><td>bync(Ole)</td><td><p>Понятно, спасибо.</p></td><td>2024-09-16T13:07:04.239Z</td></tr><tr><td>dartraiden(Alexander Gavrilov)</td><td><p>Если точнее, то поддержка <a href="https://forum.keenetic.com/topic/18741-openvpn-%D0%B8-dco/">есть</a>, но она до конца не оттестирована и не включена по-умолчанию, а также нормально работает лишь на ARM-процессорах, у которых проблема с производительностью и без того не особо стоит.</p>
<p>Поэтому, проще считать, что её нет, а то пользователи радостно начнут её включать на своих древних MT7621.</p></td><td>2024-09-16T13:10:20.991Z</td></tr><tr><td>makx(3941701)</td><td><p>Вам проще прошиться на openwrt, если есть поддержка. У меня на древнем 7621 было около 30 мегабит, а с DCO стало почти в 2 раза больше. Хотя сейчас все равно использую wireguard и DCO настроил чисто ради спортивного интереса. На гиге вроде такой же проц и прирост будет аналогичный</p></td><td>2024-09-16T13:28:06.109Z</td></tr><tr><td>bync(Ole)</td><td><aside class="quote no-group" data-username="makx" data-post="345" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/makx/48/6630_2.png" class="avatar"> makx:</div>
<blockquote>
<p>Вам проще прошиться на openwrt</p>
</blockquote>
</aside>
<p>не думаю что это проще</p>
<aside class="quote no-group" data-username="makx" data-post="345" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/makx/48/6630_2.png" class="avatar"> makx:</div>
<blockquote>
<p>У меня на древнем 7621 было около 30 мегабит, а с DCO стало почти в 2 раза больше</p>
</blockquote>
</aside>
<p>ну у меня все таки не древний роутер… пробовал вкл/выкл DCO на сервере, скорость (ютуба) не меняется</p></td><td>2024-09-16T13:31:26.016Z</td></tr><tr><td>abrikman(Alexander K)</td><td><p>Протестировал на 4.2 кинетике (точнее на 10 штуках аж)<br>
Всё работает и кажется быстрее (локация - Stockholm, vultr, у меня до него пинг 20 мс)</p>
<p>Единственный вопрос - WireGuard же на телефоне с Амнезией будет всё роутить, весь трафик?</p></td><td>2024-09-16T15:33:26.871Z</td></tr><tr><td>Xirurg</td><td><p>enable-dco  пробовали на 4.2 , работает ?</p></td><td>2024-09-16T16:13:31.521Z</td></tr><tr><td>abrikman(Alexander K)</td><td><p>Неа, я чисто ради WireGuard поиграться поставил. Если честно у меня с Linux OpenVPN вообще не подключается при таких настройках <img src="https://ntc.party/images/emoji/twitter/frowning.png?v=12" title=":frowning:" class="emoji" alt=":frowning:" loading="lazy" width="20" height="20"></p></td><td>2024-09-16T16:20:28.813Z</td></tr><tr><td>xtrime</td><td><aside class="quote no-group" data-username="bync" data-post="338" data-topic="8839" data-full="true">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/b/e56c9b/48.png" class="avatar"> bync:</div>
<blockquote>
<p>Автор в тему не отвечает уже давно, контейнер заброшен?</p>
</blockquote>
</aside>
<p>Был в отпуске <img src="https://ntc.party/images/emoji/twitter/slight_smile.png?v=12" title=":slight_smile:" class="emoji" alt=":slight_smile:" loading="lazy" width="20" height="20"> Добрался вчера до компа - все замерджил <img src="https://ntc.party/images/emoji/twitter/slight_smile.png?v=12" title=":slight_smile:" class="emoji" alt=":slight_smile:" loading="lazy" width="20" height="20"><br>
Всем контрибьюторам большое спасибо, особенно за фикс для openvpn</p></td><td>2024-09-16T17:05:55.436Z</td></tr><tr><td>xtrime</td><td><aside class="quote no-group" data-username="abrikman" data-post="347" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/a/848f3c/48.png" class="avatar"> abrikman:</div>
<blockquote>
<p>WireGuard же на телефоне с Амнезией будет всё роутить, весь трафик?</p>
</blockquote>
</aside>
<p>Нет, все аналогично с openvpn: роутится только подсеть 10.224.0.0/15</p></td><td>2024-09-16T17:06:45.410Z</td></tr><tr><td>abrikman(Alexander K)</td><td><p>Значит лыжи едут и поиграюсь-ка я с Allowed IPs</p></td><td>2024-09-16T17:58:55.162Z</td></tr><tr><td>Dimenshn</td><td><p>Добрый день, а кто-нибудь уже тестировал новую версию 3.4.0 с Keenetic? Было довольно интересно, поможет ли новый патч обойти блокировки провайдера по OpenVPN.</p>
<ol>
<li>Ultra (KN-1811): На  3.3.0 провайдер дропает соединение через 10 секунд. 3.4.0 подключение перестало сразу же обрываться.</li>
<li>Air (KN-1613): На 3.3.0 стабильно работает даже по UDP. 3.4.0 вообще перестал подключаться с многократной ошибкой “TLS Error: unknown opcode received from [AF_INET]“IP моего сервера”:1194 op=0”.</li>
</ol>
<p>На обоих роутерах стоит прошивка 4.1.7. При откате на 3.3.0 ситуация восстанавливается до такой, какая и была. То есть дело точно в изменениях на сервере.<br>
Подозреваю, что у младшей модели чего-то не хватает в прошивке, чтобы корректно отрабатывать подключение с последним патчем.</p></td><td>2024-09-17T01:21:24.976Z</td></tr><tr><td>tunivi</td><td><p>Что нужно прописать в Allowed IPS, чтобы подключение на телефоне работало как обычный антизапрет? Поднял Amnezia по инструкции для Keenetic, но разумеется при <em>WG_ALLOWED_IPS=0.0.0.0/0</em> весь трафик идёт через VPN.</p></td><td>2024-09-17T06:32:45.210Z</td></tr><tr><td>bync(Ole)</td><td><aside class="quote no-group" data-username="xtrime" data-post="350" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/xtrime/48/1524_2.png" class="avatar"> xtrime:</div>
<blockquote>
<p>Был в отпуске</p>
</blockquote>
</aside>
<p>Сорри тогда, надеюсь хорошо отдохнул)</p>
<aside class="quote no-group" data-username="abrikman" data-post="347" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/a/848f3c/48.png" class="avatar"> abrikman:</div>
<blockquote>
<p>Протестировал на 4.2 кинетике</p>
</blockquote>
</aside>
<p>Хм, я когда обновил до 4.2 то у меня антизапреты перестали работать, кстати сейчас в ченйджлогах 4.3 есть строка:</p>
<ul>
<li>OpenVPN: исправлено добавление маршрутов, полученных от удаленного узла [NDM-3415]</li>
</ul>
<p>вот думаю, может из-за этого и не работали…</p></td><td>2024-09-17T08:38:49.465Z</td></tr><tr><td>bync(Ole)</td><td><p><a class="mention" href="/u/xtrime">@xtrime</a> Помогите плиз со следующим разобраться:</p>
<ol>
<li>Хотел бы попробовать IPSec и WG, ввожу команды с гитхаба, но мне выдает ошибку, например для WG пишет, что нет диретории или файла wireguard.env. Как правильно развернуть эти серверы и настроить?</li>
<li>Хотел проверить DCO, вкл по инструкции на гитхабе, потом решил выключить, сделал apt remove --purge openvpn-dco-dkms, потом снова решил вернуть, установив заново, но запуская lsmod | grep openvpn_dco получаю в ответ ничего. ЧЯДНТ?</li>
</ol></td><td>2024-09-17T09:54:40.307Z</td></tr><tr><td>ronin</td><td><blockquote>
<p>AllowedIPs =  10.224.0.0/15, 10.1.166.0/24, 103.246.200.0/22, 178.239.88.0/21, 185.104.45.0/24, 193.105.213.36/30, 203.104.128.0/20, 203.104.144.0/21, 203.104.152.0/22, 68.171.224.0/19, 74.82.64.0/19, 104.109.143.0/24</p>
</blockquote>
<p>Но можно и меньший диапазон взять, к примеру:</p>
<blockquote>
<p>AllowedIPs =  10.224.0.0/15, 10.1.166.0/24</p>
</blockquote>
<p>Вполне будет достаточно для HTTP(S) трафика</p></td><td>2024-09-17T10:29:40.891Z</td></tr><tr><td>ronin</td><td><ol>
<li>Нужно выполнить <a href="https://github.com/xtrime-ru/antizapret-vpn-docker?tab=readme-ov-file#wireguard-server" rel="noopener nofollow ugc">первый пункт инструкции</a> и установить пароль как изначально предполагалось:<br>
<code>docker run --rm ghcr.io/wg-easy/wg-easy wgpw 'YOUR_PASSWORD' | sed "s/'//g" | sed -r 's/\$/\$\$/g' | tee ./wireguard/wireguard.env</code><br>
Если пароль уже установлен в docker compose по инструкции, можно создать просто файл:<br>
<code>touch  ./wireguard/wireguard.env</code></li>
</ol>
<p>Я отправил реквест пулл на исправление инструкции кинетика.</p></td><td>2024-09-17T10:51:53.805Z</td></tr><tr><td>abrikman(Alexander K)</td><td><p>Вот у меня обратная проблема - я прописал</p>
<pre><code class="lang-auto">AllowedIPs = 10.224.0.0/15, 10.1.166.0/24, 103.246.200.0/22, 178.239.88.0/21, 185.104.45.0/24, 193.105.213.36/30, 203.104.128.0/20, 203.104.144.0/21, 203.104.152.0/22, 68.171.224.0/19, 74.82.64.0/19, 104.109.143.0/24
</code></pre>
<p>и октрывается всё, кроме заблокированных сайтов :))))</p></td><td>2024-09-17T11:24:58.132Z</td></tr><tr><td>ronin</td><td><p>А какой DNS в конфиге указан?</p></td><td>2024-09-17T11:45:08.342Z</td></tr><tr><td>abrikman(Alexander K)</td><td><pre><code class="lang-auto">[Interface]
PrivateKey = 
Address = 10.1.166.29/24
DNS = 10.224.0.1
Jc = 9
Jmin = 50
Jmax = 1000
S1 = 47
S2 = 100
H1 = 926913266
H2 = 515320819
H3 = 518076015
H4 = 1056013181

[Peer]
PublicKey = 
PresharedKey = 
AllowedIPs =  10.224.0.0/15, 10.1.166.0/24, 103.246.200.0/22, 178.239.88.0/21, 185.104.45.0/24, 193.105.213.36/30, 203.104.128.0/20, 203.104.144.0/21, 203.104.152.0/22, 68.171.224.0/19, 74.82.64.0/19, 104.109.143.0/24
PersistentKeepalive = 25
Endpoint =
</code></pre>
<p>ну и деплоил тоже по канонам</p>
<pre><code class="lang-auto">      - WG_ALLOWED_IPS=
          10.224.0.0/15,
          10.1.166.0/24,
          103.246.200.0/22,
          178.239.88.0/21,
          185.104.45.0/24,
          193.105.213.36/30,
          203.104.128.0/20,
          203.104.144.0/21,
          203.104.152.0/22,
          68.171.224.0/19,
          74.82.64.0/19,
          104.109.143.0/24
    ports:
      - "443:443/udp"
      - "6843:6843/tcp"
</code></pre>
<p>правда разница в том, что это amnezia-wg-easy и docker-compose.wireguard-amnezia.yml</p></td><td>2024-09-17T11:48:13.472Z</td></tr><tr><td>ronin</td><td><p>В целом настройки верные, а клиент и ось какие?<br>
Если с компа то посмотрите<br>
tracerout 10.224.0.1<br>
Если трассировка проходит посмотрите что отвечает DNS:<br>
nslookup <a href="http://youtube.com" rel="noopener nofollow ugc">youtube.com</a></p></td><td>2024-09-17T11:57:00.335Z</td></tr><tr><td>abrikman(Alexander K)</td><td><p>Ребутнул контейнер - с компа всё ок.<br>
То есть и открывается всё как надо, и работает именно с компа (я правда не знаю что это было, но всё же)</p>
<p>А вот с телефона именно Амнезия не роутит на заблокированные сайты. Сдается мне что в Амнезии дело, а не в ком-то ещё.<br>
Конфиг в телефоне как с компа, но ессно новый :).</p></td><td>2024-09-17T12:12:21.607Z</td></tr><tr><td>aeros9080(Aeros9080)</td><td><p>Мой провайдер уже забанил и вайр, и опенвпн, может ещё какие варианты есть? Установлено по инструкции. вчера работало, сегодня и вайр отвалился, опенвпн ещё с неделю назад, и патч не помог <img src="https://ntc.party/images/emoji/twitter/frowning.png?v=12" title=":frowning:" class="emoji" alt=":frowning:" loading="lazy" width="20" height="20"><br>
Есть ещё какие-то варианты?</p></td><td>2024-09-17T12:41:55.123Z</td></tr><tr><td>abrikman(Alexander K)</td><td><p>Короче это я тупой. Надо было ставить не AmneziaVPN как клиент, а AmneziaWG. На ноуте оно и было.<br>
На телефоне - нет. Всё работает прекрасно, простите извините.</p></td><td>2024-09-17T12:45:22.449Z</td></tr><tr><td>xtrime</td><td><p><em>WG_ALLOWED_IPS=0.0.0.0/0</em></p>
<p>Нужно скачать конфиг из web интерфейса wg-easy который запускается на порту 51821 , там прописаны все нужные подсети.</p></td><td>2024-09-17T20:37:19.426Z</td></tr><tr><td>xtrime</td><td><aside class="quote no-group" data-username="bync" data-post="356" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/b/e56c9b/48.png" class="avatar"> bync:</div>
<blockquote>
<p>lsmod | grep openvpn_dco</p>
</blockquote>
</aside>
<p>Я не знаю что это за команда, у меня тоже ничего не возвращает, хотя dco установлен.</p>
<p>Проще всего проверить логи openvpn при старте контейнера, там должна быть строка, что dco включен.</p>
<p>Либо вот так:</p>
<pre><code class="lang-auto">docker exec -it antizapret-vpn openvpn --version | grep "DCO version"
DCO version: 0.0+git20231103
</code></pre>
<p>Для того что бы выключить DCO достаточно использовать переменную <code>OPENVPN_CBC_CIPHERS=1</code> в docker-compose</p></td><td>2024-09-17T22:16:17.489Z</td></tr><tr><td>momamark(mark)</td><td><p>Подскажите пожалуйста, есть ли способ заставить заработать wireguard и mikrotik с этим решением? В случае с ovpn идет резолвинг через dns exclusively, а wg как?</p></td><td>2024-09-18T02:10:48.074Z</td></tr><tr><td>bync(Ole)</td><td><aside class="quote no-group" data-username="xtrime" data-post="367" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/xtrime/48/1524_2.png" class="avatar"> xtrime:</div>
<blockquote>
<p>Я не знаю что это за команда, у меня тоже ничего не возвращает, хотя dco установлен.</p>
</blockquote>
</aside>
<p>это я у чатгпт спросил как проверить…</p>
<aside class="quote no-group" data-username="xtrime" data-post="367" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/xtrime/48/1524_2.png" class="avatar"> xtrime:</div>
<blockquote>
<p>вот так:</p>
</blockquote>
</aside>
<p>попробую, спасибо.</p>
<aside class="quote no-group" data-username="xtrime" data-post="367" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/xtrime/48/1524_2.png" class="avatar"> xtrime:</div>
<blockquote>
<p>что бы выключить DCO достаточно использовать переменную <code>OPENVPN_CBC_CIPHERS=1</code> в docker-compose</p>
</blockquote>
</aside>
<p>я вот не очень соображаю касаемо редактирования подоных файлов, я с трудом даже нашел куда вписывать свои домены, ибо папок на сервере содержащих файлы include-host-… две:<br>
<img src="неофициальный-docker-контейнер-антизапрета-8839/7bc8addbb867dfef170040984ee5fac33ed81918.png" alt="image" data-base62-sha1="hF2GhkerscfZQyLmp2VDUoODv0Q" width="346" height="163"><br>
<img src="неофициальный-docker-контейнер-антизапрета-8839/bee8b8c6885ee04675bd83ff1ea02a4519e817a4.png" alt="image" data-base62-sha1="reRk3wEjT4QMC078gBvIGoIlvY8" width="566" height="318"><br>
добавил свои домены в файл на втором скрине кстати, intel и claude, но они не открываются, может не туда добавил?</p></td><td>2024-09-18T08:36:27.154Z</td></tr><tr><td>bync(Ole)</td><td><aside class="quote no-group" data-username="ronin" data-post="358" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/r/ad7895/48.png" class="avatar"> ronin:</div>
<blockquote>
<p>Нужно выполнить <a href="https://github.com/xtrime-ru/antizapret-vpn-docker?tab=readme-ov-file#wireguard-server" rel="noopener nofollow ugc">первый пункт инструкции</a> и установить пароль как изначально предполагалось</p>
</blockquote>
</aside>
<p>я так и делал, да.</p>
<aside class="quote no-group" data-username="ronin" data-post="358" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/r/ad7895/48.png" class="avatar"> ronin:</div>
<blockquote>
<p>можно создать просто файл:<br>
<code>touch  ./wireguard/wireguard.env</code></p>
</blockquote>
</aside>
<p>спасибо</p></td><td>2024-09-18T08:38:26.137Z</td></tr><tr><td>xtrime</td><td><aside class="quote no-group" data-username="bync" data-post="369" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/b/e56c9b/48.png" class="avatar"> bync:</div>
<blockquote>
<p>я вот не очень соображаю касаемо редактирования подоных файлов, я с трудом даже нашел куда вписывать свои домены, ибо папок на сервере содержащих файлы include-host-… две</p>
</blockquote>
</aside>
<p>Папка rootfs используется для сборки. Надо представить что ее нет, правки в ней всеравно ни на что не повляют без пересборки <img src="https://ntc.party/images/emoji/twitter/slight_smile.png?v=12" title=":slight_smile:" class="emoji" alt=":slight_smile:" loading="lazy" width="20" height="20"> Используете только папки keys и config.</p></td><td>2024-09-18T10:27:23.342Z</td></tr><tr><td>DoplerEffect</td><td><p>уважаемый <a class="mention" href="/u/xtrime">@xtrime</a> можно пожалуйста env переменную на /antizapret/config/include-hosts-dist.txt(предустановленный список с доменами которые не находятся в официальном блоке ркн), что бы его можно было выключать тем , кому он не нужен</p>
<p>Так же я еще просил env переменную на keepalive, но из-за того что на форуме потерлись некоторые сообщения из-за сбоя, оно затерялось</p></td><td>2024-09-18T10:31:40.046Z</td></tr><tr><td>bync(Ole)</td><td><p><div class="lightbox-wrapper"><a class="lightbox" href="неофициальный-docker-контейнер-антизапрета-8839/e2ea8f5231db143d4eb79cdadf74c4935dad0b2d.png" data-download-href="https://ntc.party/uploads/default/e2ea8f5231db143d4eb79cdadf74c4935dad0b2d" title="image"><img src="неофициальный-docker-контейнер-антизапрета-8839/e2ea8f5231db143d4eb79cdadf74c4935dad0b2d.png" alt="image" data-base62-sha1="wnorVDwkvzme4t1KXNcxnxIRBi5" width="620" height="500" data-dominant-color="2A2927"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">757×610 36.7 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div><br>
вот тут?</p></td><td>2024-09-18T10:34:11.096Z</td></tr><tr><td>xtrime</td><td><p>Да</p></td><td>2024-09-18T10:39:28.790Z</td></tr><tr><td>bync(Ole)</td><td><p>понял, спасибо.</p></td><td>2024-09-18T10:41:13.031Z</td></tr><tr><td>xtrime</td><td><p>Можно сделать маунт пустого файла в docker-compose volumes, что бы очистить include-hosts-dist.txt:</p>
<ul>
<li>./config/include-hosts-dist.txt:/root/antizapret/config/include-hosts-dist.txt</li>
</ul></td><td>2024-09-18T10:42:09.024Z</td></tr><tr><td>makx(3941701)</td><td><p>В последней версии контейнер с WG работает идеально, с кастомными списками никаких проблем. Поставил просто на ПК клиент WG, на МТС полет нормальный. На телефоне с билайном тоже. А вот в роутере на openwrt не смог завести. Были настройки от антизапрета на опенвпн, но простой заменой интерфейса похоже не обойтись. Может у кого мануал есть, как с киннетиком?</p></td><td>2024-09-18T16:09:58.792Z</td></tr><tr><td>bync(Ole)</td><td><p>перенастроил подключение на роутере по новой интсрукции, раньше я просто в системном профиле указывал пару днс и их же в конфиге, все работало, теперь сделал профиль антизапрет, все работает, но почему то на <a href="http://dnsleaktest.com" rel="noopener nofollow ugc">dnsleaktest.com</a> показывает cloudflare dns москва, вместо айпи моего сервера, почему так? контейнер от <a class="mention" href="/u/xtrime">@xtrime</a> если что.</p></td><td>2024-09-18T10:13:04.373Z</td></tr><tr><td>Batonskij</td><td><p>надо удалить или закомментить строку policy.add(function (state, query)  в файле kresd.conf.</p></td><td>2024-09-18T10:16:16.905Z</td></tr><tr><td>bync(Ole)</td><td><p>а где он находится, можете подсказать?</p></td><td>2024-09-18T10:18:47.261Z</td></tr><tr><td>Batonskij</td><td><p>в версии с контейнером не знаю, без контейнера /etc/knot-resolver/kresd.conf</p></td><td>2024-09-18T10:20:20.518Z</td></tr><tr><td>bync(Ole)</td><td><p>я вроде нашел, но там это две строки<br>
<div class="lightbox-wrapper"><a class="lightbox" href="неофициальный-docker-контейнер-антизапрета-8839/310f09bfe552bc505c0cbee400fdd86fb0378159.png" data-download-href="https://ntc.party/uploads/default/310f09bfe552bc505c0cbee400fdd86fb0378159" title="image"><img src="неофициальный-docker-контейнер-антизапрета-8839/310f09bfe552bc505c0cbee400fdd86fb0378159.png" alt="image" data-base62-sha1="6ZZC83vIMD0xppQivndcDbmhRyh" width="629" height="500" data-dominant-color="2C2C2C"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">933×741 28 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p></td><td>2024-09-18T10:21:37.566Z</td></tr><tr><td>xtrime</td><td><p>Нет, это для фильтрации доменов regex.</p>
<p>И файлы в папке rootfs только для сборки контейнера.<br>
Править надо именно /etc/knot-resolver/kresd.conf в контейнере, но правки пропадут при пересоздании/обновлении контейнера из нового образа.</p></td><td>2024-09-18T10:25:28.663Z</td></tr><tr><td>bync(Ole)</td><td><p>и как в итоге лучше поступить?</p></td><td>2024-09-18T10:26:24.259Z</td></tr><tr><td>xtrime</td><td><p>Я не понимаю в чем проблема и какой результат ожидается.</p></td><td>2024-09-18T10:28:43.747Z</td></tr><tr><td>bync(Ole)</td><td><p>проблема в этом:<br>
<div class="lightbox-wrapper"><a class="lightbox" href="неофициальный-docker-контейнер-антизапрета-8839/0987d95b6338badfaf2149910854a573fae88431.png" data-download-href="https://ntc.party/uploads/default/0987d95b6338badfaf2149910854a573fae88431" title="image"><img src="неофициальный-docker-контейнер-антизапрета-8839/0987d95b6338badfaf2149910854a573fae88431.png" alt="image" data-base62-sha1="1mjlQWxe0M0fj8z63FRlQ6zsNXj" width="690" height="275" data-dominant-color="ECECEB"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">1008×402 13.3 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div><br>
раньше тут был только один ip моего сервера</p></td><td>2024-09-18T10:32:58.773Z</td></tr><tr><td>dartraiden(Alexander Gavrilov)</td><td><p>Это нормально, появилось после одного из обновлений контейнера. На работу не влияет.</p></td><td>2024-09-18T21:28:07.298Z</td></tr><tr><td>bync(Ole)</td><td><p>вот оно что, ясно, спасибо</p></td><td>2024-09-19T07:31:05.155Z</td></tr><tr><td>xtrime</td><td><p>А контейнер Adguard используется?</p></td><td>2024-09-20T09:07:49.026Z</td></tr><tr><td>abrikman(Alexander K)</td><td><p>Очень редкий кейс словил с инстаграмом с декстопа<br>
При попытке открыть сайт в любом режиме я вижу вот такое в редиректах</p>
<pre><code class="lang-auto">Request URL:
https://www.instagram.com/accounts/login/?next=https%3A%2F%2Fwww.instagram.com%2F&amp;is_from_rle
Request Method:
GET
Status Code:
429 Too Many Requests
Remote Address:
10.224.1.215:443
Referrer Policy:
strict-origin-when-cross-origin
</code></pre>
<p>какое-то невероятное количество редиректов происходит. с телефона всё ок, при чем инстаграм в АЗ добавлен в регулярках. Было у кого-то еще?</p></td><td>2024-09-20T11:44:16.620Z</td></tr><tr><td>tunivi</td><td><p>После обновления на релиз 3.5.0 перестал работать антизапрет через Amnezia. К адресу DNS 10.224.0.1 трассировка не проходит. В чём может быть дело? Получается, нет связи между антизапретом и контейнером Amnezia</p></td><td>2024-09-20T11:45:07.712Z</td></tr><tr><td>bync(Ole)</td><td><aside class="quote no-group" data-username="xtrime" data-post="389" data-topic="8839" data-full="true">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/xtrime/48/1524_2.png" class="avatar"> xtrime:</div>
<blockquote>
<p>А контейнер Adguard используется?</p>
</blockquote>
</aside>
<p>нет</p></td><td>2024-09-20T16:04:57.872Z</td></tr><tr><td>dartraiden(Alexander Gavrilov)</td><td><aside class="quote no-group" data-username="abrikman" data-post="390" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/a/848f3c/48.png" class="avatar"> abrikman:</div>
<blockquote>
<p>Было у кого-то еще?</p>
</blockquote>
</aside>
<p>Да. Инста не любит диапазоны хостинг-провайдеров, как я понимаю.</p></td><td>2024-09-20T23:10:42.363Z</td></tr><tr><td>xtrime</td><td><p>Да, был косяк во вчерашней 3.5.0. Я поправил и заменил версию, просьба еще раз обновиться.</p></td><td>2024-09-21T00:37:58.377Z</td></tr><tr><td>as9sefrv9jm2(as9sefrv9jm2)</td><td><p>Из простого варианта когда захотел развернул и пользуйся превратилось в комбайн)<br>
И “если не хотите сломать обновление не редактируйте компос файл” и для разных случаев надо редактировать компос файл. Да уж.<br>
Если что, существует файл переменных, которые могут использоваться в компосе, и не придется ничего редактировать. Достаточно создать рядом файл <code>.env</code> <a href="https://docs.docker.com/compose/how-tos/environment-variables/variable-interpolation/" rel="noopener nofollow ugc">https://docs.docker.com/compose/how-tos/environment-variables/variable-interpolation/</a> в котором перечислить теги которые использовать в самом композе. Так же там поддерживается возможность задавать значение по умолчанию, если такой переменной нет в  <code>.env</code></p></td><td>2024-09-21T08:36:51.804Z</td></tr><tr><td>dennis(denis)</td><td><p>Просьба к автору - можно ли iperf3 включить в докерфайл, чтобы скачивался и устанавливался сервисом?</p></td><td>2024-09-22T05:45:54.017Z</td></tr><tr><td>abrikman(Alexander K)</td><td><p>На самом деле автор - красавчик. Особенно спасибо за WG и Amnezia. AdGuard я правда не особо юзер срезания рекламы, но кажется стало сильно легче. (Странно что еще никто PiHole не попросил)<br>
Теперь всё работает как часы, я помню первые версии, да, они были проще в деплое, но только один OpenVPN, сейчас это по сути E2E решение почти под любой запрос. Хитрые протоколы имхо не нужны сейчас.</p>
<p>Но кажется нужно иногда остановиться и просто отрефакторить проект, например с .env согласен прям.<br>
Ну и ссылку на донаты приложить, потому что я в семье и среди друзей «комплюктерщик» которым я починил ютуб таким образом - все счастливы.<br>
Иначе можно упороться и сильно наворотить монстра)</p></td><td>2024-09-22T08:24:20.177Z</td></tr><tr><td>mafiacheb(Александр)</td><td><p>подскажите пожалуйста, а DCO работает только с udp конфигом?</p></td><td>2024-09-24T06:51:57.325Z</td></tr><tr><td>Xunlei</td><td><p><s>Да.</s></p></td><td>2024-09-24T11:21:13.644Z</td></tr><tr><td>hondaspb(Hondaspb)</td><td><p>засирает лог и вешает опенвпн так что не переподключиться</p></td><td>2024-09-24T16:08:47.656Z</td></tr><tr><td>hondaspb(Hondaspb)</td><td><aside class="quote no-group" data-username="bync" data-post="355" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/b/e56c9b/48.png" class="avatar"> bync:</div>
<blockquote>
<p>Хм, я когда обновил до 4.2 то у меня антизапреты перестали работать, кстати сейчас в ченйджлогах 4.3 есть строка:</p>
<ul>
<li>OpenVPN: исправлено добавление маршрутов, полученных от удаленного узла [NDM-3415]</li>
</ul>
<p>вот думаю, может из-за этого и не работали…</p>
</blockquote>
</aside>
<p>Это тикет был когда после переключения на резерв и обратно кинетик переставал маршруты полученные через openvpn применять</p></td><td>2024-09-24T16:18:32.056Z</td></tr><tr><td>bync(Ole)</td><td><p>Понятно, вчера вот поставил 4.2.0 preview  и все норм.</p></td><td>2024-09-25T08:00:15.757Z</td></tr><tr><td>Tyman</td><td><aside class="quote no-group" data-username="mafiacheb" data-post="399" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/m/aca169/48.png" class="avatar"> mafiacheb:</div>
<blockquote>
<p>DCO работает только с udp конфигом</p>
</blockquote>
</aside>
<p>Работает UDP и TCP</p></td><td>2024-09-25T08:27:55.259Z</td></tr><tr><td>mafiacheb(Александр)</td><td><p>подскажите пожалуйста вот установил DCO и нимогу понять включен он или не включен<br>
ввел команду ip -details link show нигде там слов dco не обнаружил. последняя версия докер стоит</p></td><td>2024-09-25T09:15:58.486Z</td></tr><tr><td>Tyman</td><td><p>можно еще посмотреть: openvpn --version если будет указана версия DCO то установился</p></td><td>2024-09-25T09:19:35.533Z</td></tr><tr><td>mafiacheb(Александр)</td><td><p>у меня докерная версия, на эту команду у меня выдает<br>
Command ‘openvpn’ not found, but can be installed with:<br>
apt install openvpn<br>
разобрался, можно <a href="https://ntc.party/t/%D0%BD%D0%B5%D0%BE%D1%84%D0%B8%D1%86%D0%B8%D0%B0%D0%BB%D1%8C%D0%BD%D1%8B%D0%B9-docker-%D0%BA%D0%BE%D0%BD%D1%82%D0%B5%D0%B9%D0%BD%D0%B5%D1%80-%D0%B0%D0%BD%D1%82%D0%B8%D0%B7%D0%B0%D0%BF%D1%80%D0%B5%D1%82%D0%B0/8839/47">проверить</a> вот так</p></td><td>2024-09-25T09:21:20.892Z</td></tr><tr><td>dennis(denis)</td><td><p>Поясните по логике работы контейнера, например сегодня его dns-сервер 6 часов с момента запуска ничего, кроме youtube и гугл-серверов в private ip не отдавал - адреса facebook, ntc.party, rutor, rutracker, instagram отдавались в public ip. Потом что-то произошло и все заработало.</p>
<p>Пытался смотреть в docker compose logs -s, как будто не было событий [mapping IP private] to [IP public], FORCE=true ./doall.sh не помогал, что дергать надо в таких случаях?<br>
Выглядит со стороны роутера это так:</p>
<pre><code class="lang-auto">root@RT3200:~# dig @10.224.0.1 youtube.com

; &lt;&lt;&gt;&gt; DiG 9.18.28 &lt;&lt;&gt;&gt; @10.224.0.1 youtube.com
; (1 server found)
;; global options: +cmd
;; Got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 27081
;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 1232
;; QUESTION SECTION:
;youtube.com.                   IN      A

;; ANSWER SECTION:
youtube.com.            300     IN      A       10.224.0.4

;; Query time: 200 msec
;; SERVER: 10.224.0.1#53(10.224.0.1) (UDP)
;; WHEN: Wed Sep 25 23:40:29 +05 2024
;; MSG SIZE  rcvd: 56

root@RT3200:~# dig @10.224.0.1 rutor.info

; &lt;&lt;&gt;&gt; DiG 9.18.28 &lt;&lt;&gt;&gt; @10.224.0.1 rutor.info
; (1 server found)
;; global options: +cmd
;; Got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 5731
;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 1232
;; QUESTION SECTION:
;rutor.info.                    IN      A

;; ANSWER SECTION:
rutor.info.             299     IN      A          193.46.255.29  ВОТ С ЧЕГО БЫ ТАК?

;; Query time: 190 msec
;; SERVER: 10.224.0.1#53(10.224.0.1) (UDP)
;; WHEN: Wed Sep 25 23:40:36 +05 2024
;; MSG SIZE  rcvd: 55
</code></pre></td><td>2024-09-25T16:02:02.933Z</td></tr><tr><td>xtrime</td><td><p>Готово <img src="https://ntc.party/images/emoji/twitter/slight_smile.png?v=12" title=":slight_smile:" class="emoji" alt=":slight_smile:" loading="lazy" width="20" height="20"> Наверное это ваш pull request я щас залил? <img src="https://ntc.party/images/emoji/twitter/slight_smile.png?v=12" title=":slight_smile:" class="emoji" alt=":slight_smile:" loading="lazy" width="20" height="20"></p>
<p>PS. почему то NTC не показывал, что есть новые сообщения в теме. Я кучу пропустил!</p></td><td>2024-09-25T22:01:03.184Z</td></tr><tr><td>xtrime</td><td><p>Вы запускаете на хосте, а надо внутри контейнера:</p>
<pre><code class="lang-auto">docker exec antizapret-vpn openvpn --version
</code></pre></td><td>2024-09-25T22:03:52.125Z</td></tr><tr><td>xtrime</td><td><p>Не могу представить, как такое может быть.</p>
<p>Могу только посоветовать LOG_DNS=1 включить, что бы все DNS запросы попадали в логи и проверить файлы конфигов/исключений доменов.</p></td><td>2024-09-25T22:19:51.696Z</td></tr><tr><td>dennis(denis)</td><td><aside class="quote no-group" data-username="xtrime" data-post="409" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/xtrime/48/1524_2.png" class="avatar"> xtrime:</div>
<blockquote>
<p>Наверное это ваш pull request я щас залил?</p>
</blockquote>
</aside>
<p>точно) спасибо) для openvpn все отлично работает, а через amnezia не хочет iperf3 -c 10.224.0.1 работать, видел правки для iptables, но кажется еще что-то ему надо</p></td><td>2024-09-26T03:33:56.869Z</td></tr><tr><td>bync(Ole)</td><td><p>После обновления еле-еле подключился<br>
<div class="lightbox-wrapper"><a class="lightbox" href="неофициальный-docker-контейнер-антизапрета-8839/a289fae17134620d501f348755a43e6c9b47624e.png" data-download-href="https://ntc.party/uploads/default/a289fae17134620d501f348755a43e6c9b47624e" title="image"><img src="неофициальный-docker-контейнер-антизапрета-8839/a289fae17134620d501f348755a43e6c9b47624e_2_349x500.png" alt="image" data-base62-sha1="nbSYcxB7TnnvBfcjIiTpxod6HWS" width="349" height="500" srcset="неофициальный-docker-контейнер-антизапрета-8839/a289fae17134620d501f348755a43e6c9b47624e_2_349x500.png, неофициальный-docker-контейнер-антизапрета-8839/a289fae17134620d501f348755a43e6c9b47624e_2_523x750.png 1.5x, неофициальный-docker-контейнер-антизапрета-8839/a289fae17134620d501f348755a43e6c9b47624e.png 2x" data-dominant-color="2A2C3A"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">639×915 65.4 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p></td><td>2024-09-26T11:06:21.929Z</td></tr><tr><td>xtrime</td><td><p>Да, по какой то причине не работают такие правила:</p>
<pre><code class="lang-auto">-A PREROUTING -d 10.224.0.1/32 -j REDIRECT
</code></pre>
<p>Пробовал так же вот так (без успеха):</p>
<pre><code class="lang-auto">-A PREROUTING -d 10.224.0.1/32 -j DNAT --to-destination 127.0.0.1
</code></pre>
<p>При этом tcpdump видит пакеты, но они не передресовываются…<br>
<div class="lightbox-wrapper"><a class="lightbox" href="неофициальный-docker-контейнер-антизапрета-8839/375d64e69a1fa64475bf1906fe67829567e3fd09.jpeg" data-download-href="https://ntc.party/uploads/default/375d64e69a1fa64475bf1906fe67829567e3fd09" title="Снимок экрана 2024-09-26 в 13.03.06"><img src="неофициальный-docker-контейнер-антизапрета-8839/375d64e69a1fa64475bf1906fe67829567e3fd09_2_690x174.jpeg" alt="Снимок экрана 2024-09-26 в 13.03.06" data-base62-sha1="7TMm7WoDQ3FX65ic0g96inWYGRH" width="690" height="174" srcset="неофициальный-docker-контейнер-антизапрета-8839/375d64e69a1fa64475bf1906fe67829567e3fd09_2_690x174.jpeg, неофициальный-docker-контейнер-антизапрета-8839/375d64e69a1fa64475bf1906fe67829567e3fd09_2_1035x261.jpeg 1.5x, неофициальный-docker-контейнер-антизапрета-8839/375d64e69a1fa64475bf1906fe67829567e3fd09_2_1380x348.jpeg 2x" data-dominant-color="2A2A2A"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">Снимок экрана 2024-09-26 в 13.03.06</span><span class="informations">1920×486 54 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>В качестве костыля сейчас добавлю переадресацию в контейнере wireguard c 10.224.0.1 на адрес докера:</p>
<pre><code class="lang-auto">iptables -t nat -A PREROUTING -d 10.224.0.1/32 -j DNAT --to-destination $AZ_HOST
iptables -t nat -A OUTPUT -d 10.224.0.1/32 -j DNAT --to-destination $AZ_HOST
</code></pre>
<p>Но если кто то знает, в чем причина, то буду признателен!</p></td><td>2024-09-26T11:06:39.443Z</td></tr><tr><td>hondaspb(Hondaspb)</td><td><aside class="quote no-group" data-username="xtrime" data-post="414" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/xtrime/48/1524_2.png" class="avatar"> xtrime:</div>
<blockquote>
<p>Да, по какой то причине не работают такие правила:</p>
<pre><code class="lang-auto">-A PREROUTING -d 10.224.0.1/32 -j REDIRECT
</code></pre>
<p>Пробовал так же вот так (без успеха):</p>
<pre><code class="lang-auto">-A PREROUTING -d 10.224.0.1/32 -j DNAT --to-destination 127.0.0.1
</code></pre>
</blockquote>
</aside>
<p>В каком контейнере вы пытались применить эти правила?</p></td><td>2024-09-26T21:33:13.138Z</td></tr><tr><td>xtrime</td><td><p>В основном - antizapret-vpn</p>
<p>Вот первый коммит: <a href="https://github.com/xtrime-ru/antizapret-vpn-docker/commit/bb7455f8de019c7646b32832ff3f8bc2b31e2105#diff-6f8e4ba3688d6c2bd74e1a544567367d4288dca063bb694f6b556aa0a504b06fR62" class="inline-onebox">Update ferm · xtrime-ru/antizapret-vpn-docker@bb7455f · GitHub</a></p>
<p>Заработали только правила OUTPUT (при использовании openvpn, когда трафик локальный)</p>
<p>Вот коммит с хотфиксом: <a href="https://github.com/xtrime-ru/antizapret-vpn-docker/commit/302c04a0e81693ae6afac2a169e634e9ed24edf6" class="inline-onebox">Fix iperf · xtrime-ru/antizapret-vpn-docker@302c04a · GitHub</a></p>
<p>Пришлось менять адрес назначения до попадания в контейнер antizapret.</p></td><td>2024-09-26T22:54:54.927Z</td></tr><tr><td>mafiacheb(Александр)</td><td><p>подскажите пожалуйста, есть роутер на openwrt на arm процессоре. там тоже надо как то DCO включать или нет? или какую то патченную версию опен впн ставить с этим дсо?</p></td><td>2024-09-27T06:36:59.985Z</td></tr><tr><td>bync(Ole)</td><td><p>В соседней ветке (без контейнера) сделали две версии патча, и это позволило убрать все ошибки подключения, было бы здорово чтобы и в докер-версии такое появилось.</p></td><td>2024-09-27T07:59:56.176Z</td></tr><tr><td>hondaspb(Hondaspb)</td><td><p>Сделайте pull request? )) У меня кинетик и патч который применен в докере сейчас работает без сбоев.</p></td><td>2024-09-27T09:05:00.582Z</td></tr><tr><td>bync(Ole)</td><td><aside class="quote no-group" data-username="hondaspb" data-post="419" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/hondaspb/48/2090_2.png" class="avatar"> hondaspb:</div>
<blockquote>
<p>Сделайте pull request?</p>
</blockquote>
</aside>
<p>а это как?)</p></td><td>2024-09-27T09:31:53.731Z</td></tr><tr><td>hondaspb(Hondaspb)</td><td><p>тогда только <a class="mention" href="/u/tyman">@Tyman</a> просить чтобы патч был в каком-то виде чтобы его можно было быстро применять здесь. Я брал патч у него.</p></td><td>2024-09-27T10:31:40.529Z</td></tr><tr><td>bync(Ole)</td><td><p><a class="mention" href="/u/tyman">@Tyman</a> возможно ли это?</p>
<aside class="quote no-group" data-username="hondaspb" data-post="421" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/hondaspb/48/2090_2.png" class="avatar"> hondaspb:</div>
<blockquote>
<p>тогда только <a class="mention" href="/u/tyman">@Tyman</a> просить чтобы патч был в каком-то виде чтобы его можно было быстро применять здесь</p>
</blockquote>
</aside></td><td>2024-09-27T12:26:01.673Z</td></tr><tr><td>Tyman</td><td><p>а как патч раньше ставился в контейнере? я просто не в курсе, патч же собирает из исходников сборку, в целом, в патче есть параметр, можно передать номер версии патча и запустить его на сборку</p></td><td>2024-09-27T12:28:58.751Z</td></tr><tr><td>hondaspb(Hondaspb)</td><td><p>как-то так <a href="https://github.com/xtrime-ru/antizapret-vpn-docker/blob/master/Dockerfile#L77" class="inline-onebox" rel="noopener nofollow ugc">antizapret-vpn-docker/Dockerfile at master · xtrime-ru/antizapret-vpn-docker · GitHub</a><br>
я взял ваш патч и закинул в докерфайл</p></td><td>2024-09-27T12:31:07.874Z</td></tr><tr><td>hondaspb(Hondaspb)</td><td><p>потому что срабатывает другое правило (<a href="https://github.com/xtrime-ru/antizapret-vpn-docker/commit/302c04a0e81693ae6afac2a169e634e9ed24edf6#diff-6f8e4ba3688d6c2bd74e1a544567367d4288dca063bb694f6b556aa0a504b06fL60" class="inline-onebox" rel="noopener nofollow ugc">Fix iperf · xtrime-ru/antizapret-vpn-docker@302c04a · GitHub</a>) и до REDIRECT не доходит.</p>
<pre><code class="lang-auto">saddr $DOCKER_RANGE daddr $DOCKER_DNS ACCEPT;
daddr ($VPNUDP_DNS $VPNTCP_DNS $DOCKER_DNS) REDIRECT;
</code></pre>
<p>iptables-legacy -t nat -I PREROUTING 6 -d 10.224.0.1/32 -p tcp --dport 5201 -j REDIRECT<br>
вот так сработало.</p></td><td>2024-09-27T15:40:23.454Z</td></tr><tr><td>xtrime</td><td><p>Да, мы утром обсуждали с <a class="mention" href="/u/tyman">@Tyman</a>. Но я хочу, что бы можно было на лету через ENV менять поведение openvpn, а не пересобирать.</p>
<p>Мб сделаю в выходные. Если у кого то есть опыт С, то с удовольствием апрувну PR <img src="https://ntc.party/images/emoji/twitter/slight_smile.png?v=12" title=":slight_smile:" class="emoji" alt=":slight_smile:" loading="lazy" width="20" height="20"></p></td><td>2024-09-27T16:55:30.744Z</td></tr><tr><td>xtrime</td><td><p>Благодарю!<br>
Я грешил на порядок, но не думал, что ACCEPT на что-то влияет <img src="https://ntc.party/images/emoji/twitter/confused.png?v=12" title=":confused:" class="emoji" alt=":confused:" loading="lazy" width="20" height="20"></p>
<p>Поправил PR, сделал: <code>daddr ($VPNUDP_DNS $VPNTCP_DNS $DOCKER_DNS) REDIRECT;</code> - работает!</p></td><td>2024-09-27T16:57:06.785Z</td></tr><tr><td>hondaspb(Hondaspb)</td><td><p>зачем весь трафик гнать таким образом, если это только для iperf, не лучше ли слать только iperf трафик?</p></td><td>2024-09-27T18:04:29.643Z</td></tr><tr><td>xtrime</td><td><p>Сегодня iperf, завтра еще что то добавим… Удобно когда есть статичный адрес контейнера в который можно постучаться извне. Теперь всегда и везде можно использовать 10.224.0.1 и не думать.</p>
<p>Весь траф в любом случае идет в контейнер антизапрета: либо в dnsmap правила, либо в localhost.</p>
<p>Какие минусы у такого решения?</p></td><td>2024-09-27T18:14:57.311Z</td></tr><tr><td>dennis(denis)</td><td><aside class="quote no-group" data-username="xtrime" data-post="429" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/xtrime/48/1524_2.png" class="avatar"> xtrime:</div>
<blockquote>
<p>10.224.0.1</p>
</blockquote>
</aside>
<p>Iperf теперь работает и с amnezia, просто отлично.</p>
<p>Еще предложу в конфиг амнезии в Allowed IPs 1.1.1.1/32 добавить.<br>
1.1.1.1 вообще в качестве dns-форвардера на клиенте удобнее 10.224.0.1, именно так в старом контейнере было - если туннельное соединение падает, или вдруг не поднялся маршрут, то включается ресолвинг через one.one.one.one и хоть что-то работает.</p></td><td>2024-09-28T05:38:28.400Z</td></tr><tr><td>hondaspb(Hondaspb)</td><td><aside class="quote no-group" data-username="dennis" data-post="430" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/d/e56c9b/48.png" class="avatar"> dennis:</div>
<blockquote>
<p>если туннельное соединение падает</p>
</blockquote>
</aside>
<p>То все маршруты из таблицы маршрутизации клиента должны удалиться и будет использоваться резолвер прописанный в ОС.</p>
<aside class="quote no-group" data-username="dennis" data-post="430" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/d/e56c9b/48.png" class="avatar"> dennis:</div>
<blockquote>
<p>так в старом контейнере было</p>
</blockquote>
</aside>
<p>В каком?</p></td><td>2024-09-28T10:32:44.717Z</td></tr><tr><td>hondaspb(Hondaspb)</td><td><aside class="quote no-group" data-username="xtrime" data-post="426" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/xtrime/48/1524_2.png" class="avatar"> xtrime:</div>
<blockquote>
<p>через ENV менять поведение openvpn</p>
</blockquote>
</aside>
<p>Иметь две сборки openvpn и между ними переключаться?</p></td><td>2024-09-28T10:34:07.119Z</td></tr><tr><td>Kebu</td><td><p>Не очень понял из ридми как обрабатываются домены третьего уровня при добавлении в include-hosts-custom.txt – добавляется и вышестоящий домен второго? если да, то как можно добавить только условный <a href="http://test.domain.net" rel="noopener nofollow ugc">test.domain.net</a> не добавляя <a href="http://domain.net" rel="noopener nofollow ugc">domain.net</a>?</p></td><td>2024-09-28T10:42:36.818Z</td></tr><tr><td>dennis(denis)</td><td><p>[quote=“hondaspb, post:431, topic:8839”]</p>
<aside class="quote no-group quote-modified" data-username="dennis" data-post="430" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/d/e56c9b/48.png" class="avatar"> dennis:</div>
<blockquote>
<p>В каком?</p>
</blockquote>
</aside>
<p>который lxd</p>
<p>В том и дело, что owrt-роутеры (и может другие) не имеют приоритетности DNS и на них нельзя оставить резервный “DNS уровня ОС” на случай падения VPN, точнее можно, но он будет долбиться в оба. Поэтому 1.1.1.1 удобный вариант.</p></td><td>2024-09-28T14:28:26.712Z</td></tr><tr><td>dartraiden(Alexander Gavrilov)</td><td><aside class="quote no-group" data-username="Kebu" data-post="433" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/k/8797f3/48.png" class="avatar"> Kebu:</div>
<blockquote>
<p>добавляется и вышестоящий домен второго?</p>
</blockquote>
</aside>
<p>Да.</p>
<aside class="quote no-group" data-username="Kebu" data-post="433" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/k/8797f3/48.png" class="avatar"> Kebu:</div>
<blockquote>
<p>как можно добавить только условный <a href="http://test.domain.net">test.domain.net</a></p>
</blockquote>
</aside>
<p>Именно поэтому в ридми рекомендуется использовать <code>-regex-custom.txt</code>, т.к. он позволяет оперировать доменами 3 и более уровня.</p>
<p>Учтите, что туда нужно добавлять регулярные выражения, например, <code>^test\.example\.com$</code></p></td><td>2024-09-28T15:27:52.337Z</td></tr><tr><td>hondaspb(Hondaspb)</td><td><aside class="quote no-group" data-username="dennis" data-post="434" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/d/e56c9b/48.png" class="avatar"> dennis:</div>
<blockquote>
<p>который lxd</p>
</blockquote>
</aside>
<p>В оригинале предлагается устанавливать маршруты до публичных резолверов через openvpn. <a href="https://ntc.party/t/%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-%D0%BD%D0%B0-zyxel-keenetic-ultra/698/10" class="inline-onebox">Настройка на Zyxel Keenetic Ultra - #10 by ValdikSS</a> Если туннель упал, маршрута до публичного резолвера через openvpn нет, и трафик до них идет как обычно.<br>
И что важно, какие именно резолверы направлять в туннель решается на стороне клиента, а не конфигом зашитым на сервере.</p></td><td>2024-09-28T16:37:30.125Z</td></tr><tr><td>Kebu</td><td><p>Спасибо, попробую так подобавлять ютубовские поддомены — на айфоне/айпэде медленно открывает и видео, и комменты. После открытия видео идет нормально, с той же скоростью как на других устройствах.</p></td><td>2024-09-28T17:14:20.367Z</td></tr><tr><td>Kebu</td><td><p>Не пойму что с регекс-файлом. К примеру добавляю в include-regex-custom.txt строчку</p>
<p><code>^mdns\.mcast\.net$</code></p>
<p>Перезагружаю контейнер, жду пару минут. При этом из include-hosts-custom.txt обрабатываются правильно, dig возвращает адреса из 10.224.*<br>
А из регекс-файла этот адрес не добавляется.</p></td><td>2024-09-28T19:17:20.220Z</td></tr><tr><td>hondaspb(Hondaspb)</td><td><p>Этот адрес не имеет ничего общего с ютубом, вам дали вредный совет. <a href="https://en.m.wikipedia.org/wiki/Mcast.net" class="inline-onebox" rel="noopener nofollow ugc">mcast.net - Wikipedia</a></p></td><td>2024-09-28T19:39:16.189Z</td></tr><tr><td>Kebu</td><td><p>Принимается <img src="https://ntc.party/images/emoji/twitter/slight_smile.png?v=12" title=":slight_smile:" class="emoji" alt=":slight_smile:" loading="lazy" width="20" height="20"><br>
Но почему он не добавляется в список?</p></td><td>2024-09-28T19:47:38.762Z</td></tr><tr><td>hondaspb(Hondaspb)</td><td><aside class="quote no-group" data-username="Kebu" data-post="440" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/k/8797f3/48.png" class="avatar"> Kebu:</div>
<blockquote>
<p>Но почему он не добавляется в список?</p>
</blockquote>
</aside>
<p>Добавляется, но у записи TTL большой, вот вы и не видите немедленного эффекта.<br>
Можете сами проверить, зайти в контейнер и посмотреть.<br>
root@antizapret:/etc/knot-resolver# cat knot-aliases-alt.conf | grep mdns<br>
regex_blocked = ‘(^mdns.mcast.net$)’</p>
<p>Да и непонятно какой результат хотелось достигнуть. <a href="https://en.wikipedia.org/wiki/Multicast_address" class="inline-onebox" rel="noopener nofollow ugc">Multicast address - Wikipedia</a></p></td><td>2024-09-28T20:33:14.433Z</td></tr><tr><td>dartraiden(Alexander Gavrilov)</td><td><aside class="quote no-group" data-username="Kebu" data-post="438" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/k/8797f3/48.png" class="avatar"> Kebu:</div>
<blockquote>
<p>А из регекс-файла этот адрес не добавляется.</p>
</blockquote>
</aside>
<p>Нормально добавляется, я проверял лично на примере <code>rkn.gov.ru</code> (после сброса кэша DNS на клиенте он резолвится в <code>10.x.x.x</code>, в то время как <code>gov.ru</code> продолжает резолвиться в свой настоящий адрес).</p></td><td>2024-09-29T06:21:44.447Z</td></tr><tr><td>dennis(denis)</td><td><aside class="quote no-group" data-username="hondaspb" data-post="436" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/hondaspb/48/2090_2.png" class="avatar"> hondaspb:</div>
<blockquote>
<p>И что важно, какие именно резолверы направлять в туннель решается на стороне клиента, а не конфигом зашитым на сервере.</p>
</blockquote>
</aside>
<p>Ok, принято.</p></td><td>2024-09-29T07:38:34.020Z</td></tr><tr><td>Kebu</td><td><p>Нет, не добавляется. Выждал почти час, пробовал с разных устройств.</p>
<p>И диг из контейнера подтверждает. Где-то ошибка у меня все-таки</p>
<pre><code class="lang-auto">root@antizapret:~# dig +short rkn.gov.ru  @192.168.100.1

212.192.156.40
</code></pre></td><td>2024-09-29T08:58:35.608Z</td></tr><tr><td>xtrime</td><td><p>Проверьте, что правила сбилдились корректно:</p>
<pre><code class="lang-auto">docker exec antizapret-vpn tail -n 10 /etc/knot-resolver/knot-aliases-alt.conf 
</code></pre>
<p>Иногда бывают проблемы из за неправильных переносов строки, при редактировании файла, например.</p></td><td>2024-09-29T19:18:15.642Z</td></tr><tr><td>xtrime</td><td><p>Лучше все же добавить в патч чтение env и if. Если не получится,  то тогда ваш вариант <img src="https://ntc.party/images/emoji/twitter/slight_smile.png?v=12" title=":slight_smile:" class="emoji" alt=":slight_smile:" loading="lazy" width="20" height="20"></p></td><td>2024-09-29T19:20:03.621Z</td></tr><tr><td>Kebu</td><td><pre><code class="lang-auto">

root@server:~# docker exec antizapret-vpn tail -n 10 /etc/knot-resolver/knot-aliases-alt.conf
'zzzino777.org.',
'zzzooo.space.',
'zzztube.com.',
'zzztube.tv.',
'zzzz1.live.',
'zzzz2.live.',
'zzzzfilm.club.',
}
regex_blocked = ''
regex_allowed = ''

</code></pre>
<p>Не очень понял: это норм?)</p></td><td>2024-09-29T19:27:42.260Z</td></tr><tr><td>xtrime</td><td><p>Нет, двух последних строках должны быть склеены правила из regex файлов. А их нет. Надо разбираться, почему не генерируются regex правила.</p>
<pre><code class="lang-auto">regex_blocked = ‘’
regex_allowed = ‘’
</code></pre>
<p>Для того что бы не ждать долго обновления конфигов рекомендую запускать обновление руками:</p>
<p><code>docker exec antizapret-vpn /root/antizapret/doall.sh</code></p></td><td>2024-09-29T19:29:52.136Z</td></tr><tr><td>Kebu</td><td><p>Имя файла верное? include-regex-custom.txt</p></td><td>2024-09-29T19:32:21.895Z</td></tr><tr><td>xtrime</td><td><p>Да, в папке конфиг: config/include-regex-custom.txt</p>
<p>Все файлы доступные для редактирования генерируются в папке config при первом старте контейнера.<br>
Если у вас нет файла, то нужно обновить git и docker образ</p></td><td>2024-09-29T19:33:25.103Z</td></tr><tr><td>Xirurg</td><td><p>Добрый вечер , там интересное в соседней  теме сделали , wg antizapret , еще бы в docker  это дело завернуть , чисто wg antizapret , без openvpn и вообще красота  будет . Так как на роутере openvpn  тяжело идет 20-30 мегабит , wg ~150. Вдруг  заинтересует Вас.</p></td><td>2024-09-29T19:39:26.530Z</td></tr><tr><td>xtrime</td><td><p>Спасибо, у нас тоже в работе вынос openvpn в отдельный контейнер. Но wireguard давно есть. Openvpn ресурсы не потребляет если им не пользоваться <img src="https://ntc.party/images/emoji/twitter/slight_smile.png?v=12" title=":slight_smile:" class="emoji" alt=":slight_smile:" loading="lazy" width="20" height="20"></p></td><td>2024-09-30T07:33:52.126Z</td></tr><tr><td>Xirurg</td><td><p>WG который работает  как точечный обход  по списку ркн  на роутерах(как сейчас openvpn) ? Может  я не в теме конечно .</p></td><td>2024-09-30T07:50:52.747Z</td></tr><tr><td>dennis(denis)</td><td><aside class="quote no-group" data-username="xtrime" data-post="452" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/xtrime/48/1524_2.png" class="avatar"> xtrime:</div>
<blockquote>
<p>Спасибо, у нас тоже в работе вынос openvpn в отдельный контейнер. Но wireguard давно есть. Openvpn ресурсы не потребляет если им не пользоваться</p>
</blockquote>
</aside>
<p>Можно будет одновременно запускать и openvpn и wireguard/wg amnezia и ipsec? Сейчас можно openvpn+что-то одно.</p></td><td>2024-09-30T07:58:13.873Z</td></tr><tr><td>bync(Ole)</td><td><p><a class="mention" href="/u/xtrime">@xtrime</a> подскажи пожалуйста, как убрать ютуб из списка? достаточно будет добавить в кастомный список исключения?</p></td><td>2024-09-30T11:19:07.509Z</td></tr><tr><td>xtrime</td><td><p>Можно все одновременно запускать, хоть в нескольких экземплярах. Единственное ограничение - порты должны быть уникальны.  Править порты через директиву <code>ports: !override</code> в docker-compose.override.yml</p></td><td>2024-09-30T15:27:14.798Z</td></tr><tr><td>xtrime</td><td><p>Да, достаточно.</p>
<p>Что бы убрать все правила надо создать пустой файл и смонтировать его через директиву volumes в контейнер по пути: /root/antizapret/config/include-hosts-dist.txt</p>
<pre data-code-wrap="yml"><code class="lang-yml">volumes: 
 - ./some-empty-file-on-host.txt:/root/antizapret/config/include-hosts-dist.txt
</code></pre></td><td>2024-09-30T15:29:04.796Z</td></tr><tr><td>bync(Ole)</td><td><aside class="quote no-group" data-username="xtrime" data-post="457" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/xtrime/48/1524_2.png" class="avatar"> xtrime:</div>
<blockquote>
<p>Да, достаточно.</p>
</blockquote>
</aside>
<p>да, все сработало, теперь когда снова ютуб упадет, просто очищу этот кастомный список, спасибо.</p></td><td>2024-09-30T15:33:53.006Z</td></tr><tr><td>Olejka</td><td><p>Я недели 2 назад <a href="https://github.com/xtrime-ru/antizapret-vpn-docker/discussions/63" rel="noopener nofollow ugc">спрашивал на гите</a> как можно организовать связку zapret + antizapret, т.к. ответа так и не последовало, решил задать тут. Если вообще просто, то мне нужно НЕ получать домены из реестра, т.е. чтобы антизапрет брал домены только из <code>include-hosts-custom.txt</code>. Можно ли как-нибудь отключить подгрузку из реестра не модифицируя содержимое контейнера? Если такого способа сейчас нет, то что конкретно нужно изменить и будет ли в будущем способ сделать это “по-человечески” (условно переменная CUSTOM_ONLY или что-то подобное)?</p></td><td>2024-09-30T17:53:54.537Z</td></tr><tr><td>dartraiden(Alexander Gavrilov)</td><td><aside class="quote no-group" data-username="Olejka" data-post="459" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/olejka/48/4711_2.png" class="avatar"> Olejka:</div>
<blockquote>
<p>Можно ли как-нибудь отключить подгрузку из реестра</p>
</blockquote>
</aside>
<p>В ридми же <a href="https://github.com/xtrime-ru/antizapret-vpn-docker?tab=readme-ov-file#environment-variables">всё написано</a>. Прямо первая переменная из списка переменных.</p></td><td>2024-09-30T18:02:41.177Z</td></tr><tr><td>Olejka</td><td><p>Аааааа… Да я гений, получается) Остается открытым вопрос как на одном сервере запустить 2 антизапрета: один с обходом всего, а другой чисто для роутера с нужными мне ресурсами</p></td><td>2024-09-30T18:04:36.225Z</td></tr><tr><td>as9sefrv9jm2(as9sefrv9jm2)</td><td><p>путь примерно следующий:<br>
Сделать 2 папки, в каждой поправить конфиг/композ-файл (имя контейнера, порт на который мапится в хосте, другие настройки). и запустить их параллельно.</p></td><td>2024-09-30T19:55:15.881Z</td></tr><tr><td>Olejka</td><td><p>Сработало спасибо. Не думал, что решение настолько “в лоб”</p></td><td>2024-09-30T20:47:34.517Z</td></tr><tr><td>Ernieleo(Max)</td><td><p>Кто-нибудь знает решение проблемы с kresd? После добавления доменов в список обычный или через regex, происходит запуск с ошибкой по синтаксису kresd. На Гите создал тикет о проблеме, но ответа пока что нет, может тут кто-то знает в чём дело, проблема на чистой установке, переустановка не помогла.</p></td><td>2024-10-02T08:21:25.369Z</td></tr><tr><td>Kebu</td><td><p>Разобрался, пардон )</p></td><td>2024-10-02T08:57:13.542Z</td></tr><tr><td>Magika</td><td><p>Я что то так и не поняла, всё в кучу без пояснений для обычных пользователей…<br>
при использовании wg - работает как когда то с openVPN и через впн идет только то что из списка остальное в впн не попадает или тут дургая тема? (помнится Valdik писал что <a href="https://ntc.party/t/%D0%BF%D0%BE%D0%B4%D0%B4%D0%B5%D1%80%D0%B6%D0%BA%D0%B0-wireguard/2139/8">WG не умеет как OpenVPN</a>)<br>
Через какой клиент всё же нужно подключаться к awg ?<br>
<a href="https://github.com/amnezia-vpn/amnezia-client" rel="noopener nofollow ugc">amnezia-vpn/amnezia-client: Amnezia VPN Client (Desktop+Mobile) (github.com)</a><br>
или<br>
<a href="https://github.com/amnezia-vpn/amneziawg-windows" rel="noopener nofollow ugc">amnezia-vpn/amneziawg-windows: AmneziaWG for Windows (github.com)</a></p></td><td>2024-10-02T20:57:46.929Z</td></tr><tr><td>abrikman(Alexander K)</td><td><p>Через AmneizaWG. Но у мобильных операторов какой-то прикол пошел что он не подключается и надо параметры менять.<br>
Я вообще на WG вернулся из-за этого.</p></td><td>2024-10-03T13:11:34.544Z</td></tr><tr><td>bync(Ole)</td><td><p>Подскажите, как так получается, что я не могу зайти на форум без впн, антизапрет работает на роутере и этот сайт идет через него, nslookup ntc.party показывает 10.224… но сайт не открывается, врубаю впн и все ок.</p>
<p>апд.: помогла перезагрузка компа</p></td><td>2024-10-03T13:15:23.057Z</td></tr><tr><td>xtrime</td><td><p>WG так же работает в режиме tunnel split, т.е. в туннель идет только трафик до заблокированных сайтов.<br>
У WG есть единственное ограничение  - вся конфигурация захардкожена в файл/QR код. Т.е. если завтра РКН заблокирует новые диапазоны придется вручную обновлять конфиг на клиентах, что бы он добавился. Но такое проихсодит не часто. Домены работают так же как и openvpn.</p>
<p>На iphone использую AmneziaVPN из app store. В настройках нужно указать DNS: 10.224.0.1</p></td><td>2024-10-03T23:10:43.198Z</td></tr><tr><td>xtrime</td><td><p>ntc.party сегодня не работал <img src="https://ntc.party/images/emoji/twitter/slight_smile.png?v=12" title=":slight_smile:" class="emoji" alt=":slight_smile:" loading="lazy" width="20" height="20"></p></td><td>2024-10-03T23:11:40.035Z</td></tr><tr><td>Tyman</td><td><aside class="quote no-group" data-username="xtrime" data-post="470" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/xtrime/48/1524_2.png" class="avatar"> xtrime:</div>
<blockquote>
<p>РКН заблокирует новые диапазоны придется вручную обновлять конфиг на клиентах</p>
</blockquote>
</aside>
<p>а я проверил что там за диапазоны генерятся для опенвпн - фигня какая то, половина это хосты <a href="http://blackberry.com">blackberry.com</a> и еще какая то фигня, ничего актуального, я убрал их, как обработку, да и вообще переделал, там еще файлик с дохлыми доменами качался но не юзался, его прикрутил, домен там действительно мертвые, итог минус 100к записей</p></td><td>2024-10-03T23:20:05.915Z</td></tr><tr><td>xtrime</td><td><p>Прикольно. Я тоже какой то баг правил, так как файлик blocked-ranges.txt не заполнялся.</p></td><td>2024-10-03T23:31:36.936Z</td></tr><tr><td>dartraiden(Alexander Gavrilov)</td><td><aside class="quote no-group" data-username="bync" data-post="469" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/b/e56c9b/48.png" class="avatar"> bync:</div>
<blockquote>
<p>но сайт не открывается, врубаю впн и все ок.</p>
<p>апд.: помогла перезагрузка компа</p>
</blockquote>
</aside>
<p>Контейнер перезапускали? Если да, то причина в этом: контейнер перезапустили, а кэш DNS на компьютере не очистили (при перезагрузке он очистился).</p>
<p>В итоге, после перезапуска контейнера ntc.party сопоставлен уже другой IP-адрес из диапазона 10.x.x.x, но ваш браузер по старой памяти берёт из кэша прежний адрес и ломится туда, а контейнер про этот адрес ничего не знает, он в “прошлой жизни” был валиден. IP-адреса не прибиты к доменам гвоздями.</p></td><td>2024-10-04T04:31:25.454Z</td></tr><tr><td>bync(Ole)</td><td><aside class="quote no-group" data-username="dartraiden" data-post="474" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/dartraiden/48/15299_2.png" class="avatar"> dartraiden:</div>
<blockquote>
<p>Контейнер перезапускали? Если да, то причина в этом: контейнер перезапустили, а кэш DNS на компьютере не очистили</p>
</blockquote>
</aside>
<p>я сюда написал потому что ВСЕ проделал, как обычно, перезапуск контейнера, флашднс и прочее, браузер чаще всего перезапускаешь и все норм, а тут даже это не помогало.</p></td><td>2024-10-04T08:10:04.509Z</td></tr><tr><td>mafiacheb(Александр)</td><td><p>подскажите пожалуйста, возможно ли файле docker-compose.yml указать dot doh днс?</p>
<ul>
<li>DNS=tls://one.one.one.one ?</li>
</ul></td><td>2024-10-07T06:12:32.490Z</td></tr><tr><td>bync(Ole)</td><td><p>Заметил интересную вещь - при включении АЗ в яндекс.го не загружается карта для отслеживания курьера.</p></td><td>2024-10-07T10:59:32.055Z</td></tr><tr><td>Kebu</td><td><p>Да, это давняя история. И там, в других приложениях где используются карты от яндекса</p></td><td>2024-10-07T11:06:00.189Z</td></tr><tr><td>bync(Ole)</td><td><aside class="quote no-group" data-username="Kebu" data-post="478" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/k/8797f3/48.png" class="avatar"> Kebu:</div>
<blockquote>
<p>Да, это давняя история.</p>
</blockquote>
</aside>
<p>О как, а выяснили, что нужно убрать из списка?</p></td><td>2024-10-07T11:32:13.606Z</td></tr><tr><td>Kebu</td><td><p>Мне кажется я что-то настраивал на старом сервере, еще с «обычной» установкой антизапрета через lxd. Честно говоря деталей не помню(</p>
<aside class="quote no-group quote-modified" data-username="bync" data-post="479" data-topic="8839" data-full="true">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/b/e56c9b/48.png" class="avatar"> bync:</div>
<blockquote>
<aside class="quote no-group" data-username="Kebu" data-post="478" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/k/8797f3/48.png" class="avatar"> Kebu:</div>
<blockquote>
<p>Да, это давняя история.</p>
</blockquote>
</aside>
<p>О как, а выяснили, что нужно убрать из списка?</p>
</blockquote>
</aside></td><td>2024-10-07T16:47:18.390Z</td></tr><tr><td>Tyman</td><td><aside class="quote no-group" data-username="bync" data-post="477" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/b/e56c9b/48.png" class="avatar"> bync:</div>
<blockquote>
<p>не загружается карта для отслеживания курьера</p>
</blockquote>
</aside>
<p>а просто карта отображается? где например такси вызвать и тд?<br>
проверил на своей версии, без докера, карта грузится с андройда, яндекс карты тоже</p></td><td>2024-10-07T17:47:26.408Z</td></tr><tr><td>bync(Ole)</td><td><aside class="quote no-group" data-username="Tyman" data-post="481" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/tyman/48/6894_2.png" class="avatar"> Tyman:</div>
<blockquote>
<p>а просто карта отображается?</p>
</blockquote>
</aside>
<p>карта отображается, да, и где такси тоже, но с компа в сервисе доставки - нет.</p></td><td>2024-10-08T08:18:51.775Z</td></tr><tr><td>Ernieleo(Max)</td><td><p>На телефоне проверьте на карте, загружается ли местность любой другой страны, улицы там, места, да даже другого соседнего города.</p></td><td>2024-10-08T15:10:56.417Z</td></tr><tr><td>amfe</td><td><p>Позвольте глупый вопрос. А каким образом в этой сборке шифруется трафик? И шифруется ли вообще?</p></td><td>2024-10-08T16:22:22.390Z</td></tr><tr><td>dartraiden(Alexander Gavrilov)</td><td><p>Средствами протокола (OVPN/WG/IPSec)</p></td><td>2024-10-08T16:29:16.701Z</td></tr><tr><td>bync(Ole)</td><td><p>на телефоне все ок</p></td><td>2024-10-09T08:31:05.399Z</td></tr><tr><td>abrikman(Alexander K)</td><td><p>Такими темпами, кажется, скоро будет проще всё что из .ru и .рф доменов добавлять в вайт лист, а всё что не .ru и .рф - пропускать через OpenVPN Антизапрета <img src="https://ntc.party/images/emoji/twitter/slight_smile.png?v=12" title=":slight_smile:" class="emoji" alt=":slight_smile:" loading="lazy" width="20" height="20"><br>
Кто-то пробовал проворачивать такое? <a class="mention" href="/u/xtrime">@xtrime</a> реально ли в текущей версии такое провернуть?</p></td><td>2024-10-09T09:48:54.506Z</td></tr><tr><td>xtrime</td><td><p>Да легко. D include-regex-custom.txt добавьте что то типа:</p>
<pre><code class="lang-auto">.*(?&lt;!\.ru)$
.*(?&lt;!\.рф)$
.*(?&lt;!\.su)$
</code></pre></td><td>2024-10-09T10:11:41.646Z</td></tr><tr><td>xtrime</td><td><p>Домены в DNS переменной можно использовать, они зарезолвятся в IP. Но kresd кажется не умеет в DOH.  т.е. запросы туда будут идти по udp.</p>
<p>Я бы рекомендовал поднять adguard (см docker-compose.adguard.yml) и в нем уже настроить upstream в любой DOH.</p></td><td>2024-10-09T10:14:17.915Z</td></tr><tr><td>xtrime</td><td><p>Добаивил discord подсети из этого сообщения <a class="mention" href="/u/tyman">@Tyman</a></p><aside class="quote" data-post="1586" data-topic="9270">
  <div class="title">
    <div class="quote-controls"></div>
    <img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/tyman/48/6894_2.png" class="avatar">
    <a href="https://ntc.party/t/%D1%81%D0%BA%D1%80%D0%B8%D0%BF%D1%82-%D0%B4%D0%BB%D1%8F-%D0%B0%D0%B2%D1%82%D0%BE%D0%BC%D0%B0%D1%82%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%BE%D0%B3%D0%BE-%D1%80%D0%B0%D0%B7%D0%B2%D0%B5%D1%80%D1%82%D1%8B%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-antizapret-vpn-%D0%BE%D0%B1%D1%8B%D1%87%D0%BD%D1%8B%D0%B9-vpn-%D0%B1%D0%B5%D0%B7-%D0%BA%D0%BE%D0%BD%D1%82%D0%B5%D0%B9%D0%BD%D0%B5%D1%80%D0%B0-openvpn-wireguard-amneziawg-%D0%BF%D0%B0%D1%82%D1%87-%D0%B4%D0%BB%D1%8F-%D0%BE%D0%B1%D1%85%D0%BE%D0%B4%D0%B0-%D0%B1%D0%BB%D0%BE%D0%BA%D0%B8%D1%80%D0%BE%D0%B2%D0%BA%D0%B8-openvpn/9270/1586">Скрипт для автоматического развертывания AntiZapret VPN + обычный VPN (без контейнера) OpenVPN / WireGuard / AmneziaWG + Патч для обхода блокировки OpenVPN</a> <a class="badge-category__wrapper " href="/c/antizapret-prostovpn-org/az-self-hosted/38"><span data-category-id="38" style="--category-badge-color: #0088CC; --category-badge-text-color: #FFFFFF; --parent-category-badge-color: #8C6238;" data-parent-category-id="5" data-drop-close="true" class="badge-category --has-parent" title="Вопросы и особенности работы контейнера VPN АнтиЗапрета на своих серверах"><span class="badge-category__name">АнтиЗапрет на собственном сервере (self-hosted)</span></span></a>
  </div>
  <blockquote>
    для wg надо в ручную прописать маршруты в впн: 
66.22.192.0/18 
35.192.0.0/11 
34.0.192.0/18
  </blockquote>
</aside>

<p>Если кто то пользуется им - просьба проверить свежий образ. Для wireguard надо будет заново скачать конфиг клиента или поправить свой конфиг.</p></td><td>2024-10-09T10:24:04.436Z</td></tr><tr><td>Fatal1ty</td><td><p>Я передеплоил. Пока не работает. Я так понял по сообщению от <a class="mention" href="/u/tyman">@Tyman</a> это только для войсов маршруты, он сообщением выше говорил что какие-то другие домены за подключение отвечают.</p></td><td>2024-10-09T11:26:50.791Z</td></tr><tr><td>xtrime</td><td><p>Тут скинули список доменов и IP: <a href="https://github.com/xtrime-ru/antizapret-vpn-docker/issues/98" class="inline-onebox">Discord · Issue #98 · xtrime-ru/antizapret-vpn-docker · GitHub</a></p>
<p>Попробуйте добавить домены в inсlude-hosts-custom.txt, а подсети в docker-compose.wireguard.yml (или в свой конфиг wireguard прям на клиенте) или в include-ips-custom.txt для openvpn</p></td><td>2024-10-09T11:30:30.672Z</td></tr><tr><td>abrikman(Alexander K)</td><td><p>У меня с инклюдами получилось сразу же и всё в порядке.</p></td><td>2024-10-09T11:37:34.528Z</td></tr><tr><td>Fatal1ty</td><td><p>А это может быть связано с тем, что я использую конфиг с амнезией?</p></td><td>2024-10-09T12:05:54.279Z</td></tr><tr><td>abrikman(Alexander K)</td><td><p>кажется, что немного не так.<br>
я имел в виду включить bypass на весь трафик, а в exclude, наверное, добавить как раз</p>
<pre><code class="lang-auto">.*(?&lt;!\.ru)$
.*(?&lt;!\.рф)$
.*(?&lt;!\.su)$
</code></pre>
<p>чтобы всякие <code>io, com</code> и все такие домены не добавлять.</p></td><td>2024-10-09T12:14:31.416Z</td></tr><tr><td>xtrime</td><td><p>Это negative look behind.</p>
<p>Вот такое правило означает все кроме указанного:</p>
<pre><code class="lang-auto">.*(?&lt;!\.ru|\.su|\.рф)$
</code></pre>
<p><div class="lightbox-wrapper"><a class="lightbox" href="неофициальный-docker-контейнер-антизапрета-8839/8f32f01339a7d31fa776dc2fcf42f22d77b89af4.png" data-download-href="https://ntc.party/uploads/default/8f32f01339a7d31fa776dc2fcf42f22d77b89af4" title="image"><img src="неофициальный-docker-контейнер-антизапрета-8839/8f32f01339a7d31fa776dc2fcf42f22d77b89af4_2_493x500.png" alt="image" data-base62-sha1="kqNpxHvi1O4xoZrwrFDOUqcg6oc" width="493" height="500" srcset="неофициальный-docker-контейнер-антизапрета-8839/8f32f01339a7d31fa776dc2fcf42f22d77b89af4_2_493x500.png, неофициальный-docker-контейнер-антизапрета-8839/8f32f01339a7d31fa776dc2fcf42f22d77b89af4.png 1.5x, неофициальный-docker-контейнер-антизапрета-8839/8f32f01339a7d31fa776dc2fcf42f22d77b89af4.png 2x" data-dominant-color="292B2E"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">622×630 23.6 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p></td><td>2024-10-09T12:52:00.163Z</td></tr><tr><td>Fatal1ty</td><td><p>Я когда настраивал конфиг по вашей инструкции амнезию для кинетика, в docker-compose.override.yml там стояло WG_ALLOWED_IPS=0.0.0.0/0 и с такими настройками сгененрировал конфиг.<br>
А если в конфиге указать<br>
AllowedIPs =  10.224.0.0/15, 10.1.166.0/24, 103.246.200.0/22, 178.239.88.0/21, 185.104.45.0/24, 193.105.213.36/30, 203.104.128.0/20, 203.104.144.0/21, 203.104.152.0/22, 68.171.224.0/19, 74.82.64.0/19, 104.109.143.0/24, 66.22.192.0/18, 35.192.0.0/11, 34.0.192.0/18<br>
то почему-то вообще все перестает работать</p></td><td>2024-10-09T13:34:47.952Z</td></tr><tr><td>Kebu</td><td><p>Подскажи пожалуйста пару вопросов:<br>
— Могут ли одновременно крутиться и классический Openvpn и WG?<br>
— Кастомные адреса из текстовых файлов в папке config должны подсасываться в WG-конфигурацию?</p></td><td>2024-10-09T15:12:44.361Z</td></tr><tr><td>tunivi</td><td><p>У меня тоже перестала работать Amnezia после сегодняшнего обновления контейнера. Подсети в конфиге те же. Пинг до 10.224.0.1 проходит, но заблокированные сайты не резолвятся</p>
<p>UPD: обновился ещё раз, и всё заработало</p></td><td>2024-10-09T15:40:23.823Z</td></tr><tr><td>dartraiden(Alexander Gavrilov)</td><td><aside class="quote no-group" data-username="xtrime" data-post="492" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/xtrime/48/1524_2.png" class="avatar"> xtrime:</div>
<blockquote>
<p>Тут скинули список доменов и IP: <a href="https://github.com/xtrime-ru/antizapret-vpn-docker/issues/98">Discord · Issue #98 · xtrime-ru/antizapret-vpn-docker · GitHub </a></p>
</blockquote>
</aside>
<p>Всё добавлено, но в браузере Discord так дальше вертящегося логотипа и не открывается (OpenVPN)</p></td><td>2024-10-10T00:05:43.020Z</td></tr><tr><td>xtrime</td><td><aside class="quote no-group" data-username="Fatal1ty" data-post="497" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/f/ecd19e/48.png" class="avatar"> Fatal1ty:</div>
<blockquote>
<p>WG_ALLOWED_IPS=0.0.0.0/0</p>
</blockquote>
</aside>
<p>В таком случае весь трафик идет через vpn. Нет никакого смысла для этого использовать antizapret.</p></td><td>2024-10-10T08:10:33.287Z</td></tr><tr><td>xtrime</td><td><ol>
<li>Да, одновременно может крутиться любое количество контейнеров с любыми комбинациями протоколов</li>
<li>Хосты из папки config идут в конфигурацию kresd (DNS сервер). Используете dns 10.224.0.1, что бы все корректно работало. Файл include-ips-custom.txt не использetncz в конфиге wireguard. Добавляется нужные подсети вручную  в AllowedIps в своем конфиге, либо в docker-compose.yml</li>
</ol></td><td>2024-10-10T08:15:44.628Z</td></tr><tr><td>Saiake(Saiake)</td><td><p>При подключении через Wireguard тоже используется реестр РНК + свои IP адреса или только то, что прокинуто в конфиге?<br>
Почему-то после создания и запуска wg открывается лишь часть заблоченных сайтов (ютуб, через раз рутрекер)<br>
При использовании openvpn всё нормально (но у меня роутер с ним не справляется с 4к видео на ютубе, поэтому ищу альтернативы)</p></td><td>2024-10-10T20:04:24.718Z</td></tr><tr><td>hondaspb(Hondaspb)</td><td><aside class="quote no-group" data-username="xtrime" data-post="489" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/xtrime/48/1524_2.png" class="avatar"> xtrime:</div>
<blockquote>
<p>Но kresd кажется не умеет в DOH</p>
</blockquote>
</aside>
<p>Умеет в DOT.</p>
<pre><code class="lang-auto">policy.add(policy.all(policy.TLS_FORWARD({
         { '1.1.1.1', hostname='cloudflare-dns.com'},
})))
</code></pre></td><td>2024-10-11T06:57:16.734Z</td></tr><tr><td>Fatal1ty</td><td><p>У меня маршруты на кинетике прописаны. Я когда этим 3 маршрута прописал не помогло</p></td><td>2024-10-11T08:30:09.644Z</td></tr><tr><td>abrikman(Alexander K)</td><td><p>Проверил. На кинетиках что с WG, что с OpenVPN советую так не делать - они просто не получили маршруты и умерли кажется <img src="https://ntc.party/images/emoji/twitter/slight_smile.png?v=12" title=":slight_smile:" class="emoji" alt=":slight_smile:" loading="lazy" width="20" height="20"><br>
Даже моя Ultra не смогла прожевать.</p></td><td>2024-10-16T15:47:25.467Z</td></tr><tr><td>mafiacheb(Александр)</td><td><p>Подскажите пожалуйста, тут в наборе идёт wg amnezia или просто wg?</p></td><td>2024-10-17T17:18:22.614Z</td></tr><tr><td>tunivi</td><td><p>И то, и то. Пользую Amnezia на телефоне и роутерах Keenetic: работает безупречно. Важно верно настроить контейнер под себя через <code>docker-compose.override.yml</code>. Мусорные пакеты в частности.</p></td><td>2024-10-17T19:10:03.082Z</td></tr><tr><td>dennis(denis)</td><td><aside class="quote no-group" data-username="dartraiden" data-post="500" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/dartraiden/48/15299_2.png" class="avatar"> dartraiden:</div>
<blockquote>
<p>Всё добавлено, но в браузере Discord так дальше вертящегося логотипа и не открывается (OpenVPN)</p>
</blockquote>
</aside>
<p>У ребенка на компе заработало после добавления вот этого.<br>
Попробуйте добавить в rootfs/root/antizapret/config/include-hosts-dist.txt  и пересобрать:</p>
<pre><code class="lang-auto">#discord
discord.com
discord.gg
discordapp.net
discordapp.com
discord.media
googleapis.com

</code></pre>
<p>пулрек закинул в репу</p></td><td>2024-10-18T05:27:27.538Z</td></tr><tr><td>hondaspb(Hondaspb)</td><td><p><a class="mention" href="/u/xtrime">@xtrime</a> у вaс так же?<br>
antizapret-vpn  | Oct 25 07:03:58 systemd-sysctl[97]: Couldn’t write ‘4194304’ to ‘net/core/rmem_max’, ignoring: No such file or directory<br>
antizapret-vpn  | Oct 25 07:03:58 systemd-sysctl[97]: Couldn’t write ‘262143’ to ‘net/core/rmem_default’, ignoring: No such file or directory<br>
antizapret-vpn  | Oct 25 07:03:58 systemd-sysctl[97]: Couldn’t write ‘4194304’ to ‘net/core/wmem_max’, ignoring: No such file or directory<br>
antizapret-vpn  | Oct 25 07:03:58 systemd-sysctl[97]: Couldn’t write ‘262143’ to ‘net/core/wmem_default’, ignoring: No such file or directory</p>
<p>Ошибки в общем-то ожидаемы, может убрать эти параметры? <a href="https://github.com/xtrime-ru/antizapret-vpn-docker/blob/master/rootfs/etc/sysctl.d/20-network.conf#L8" class="inline-onebox" rel="noopener nofollow ugc">antizapret-vpn-docker/rootfs/etc/sysctl.d/20-network.conf at master · xtrime-ru/antizapret-vpn-docker · GitHub</a><br>
This thing is not net namespaced:<br>
<a href="https://github.com/torvalds/linux/blob/b401b621758e46812da61fa58a67c3fd8d91de0d/net/core/sysctl_net_core.c#L377" class="inline-onebox" rel="noopener nofollow ugc">linux/net/core/sysctl_net_core.c at b401b621758e46812da61fa58a67c3fd8d91de0d · torvalds/linux · GitHub</a></p></td><td>2024-10-25T16:42:13.822Z</td></tr><tr><td>xtrime</td><td><p>Спасибо, смерджил.</p></td><td>2024-11-01T12:29:08.498Z</td></tr><tr><td>xtrime</td><td><p>Поправим в обновлении, сейчас не проверял.</p></td><td>2024-11-01T12:29:20.869Z</td></tr><tr><td>ilneo</td><td><p>Всем привет!<br>
Запустил контейнер. конф файлы создались, импортирую напрямую в роутер, ничего не работает, как только ставлю конф файл в приложение на телефоне или на пк, все работает.<br>
сначала пытался на asuswrt запустить, потом на openwrt, ничего не поменялось, хотя ранее, не помню на какой версии, все работало (вроде, 3.0.2), сейчас поставил 3.6.2<br>
Может кто-то подсказать почему так происходит и помочь решить данную проблему?</p></td><td>2024-12-03T07:10:25.287Z</td></tr><tr><td>dartraiden(Alexander Gavrilov)</td><td><p>Вы почти никакой информации не предоставили. Как я понимаю, вы используете OpenVPN? Если так, то добавьте в конфиг строчку <code>verb 5</code> и смотрите, что при подключении OpenVPN будет происходить в системном журнале.</p></td><td>2024-12-03T13:53:35.420Z</td></tr><tr><td>ilneo</td><td><p>да, вы правы использую OpenVPN<br>
в приложении логи, почему-то кажеться, что-то с днс<br>
<a class="attachment" href="неофициальный-docker-контейнер-антизапрета-8839/m4ExydipIedGxkqMpN2blIBEWzU.txt">log.txt</a> (10,3 КБ)</p></td><td>2024-12-04T11:36:33.034Z</td></tr><tr><td>dartraiden(Alexander Gavrilov)</td><td><p>С виду всё нормально, нужно учитывать, что обычно требуется дополнительная настройка на роутере, чтобы роутер использовал только DNS АнтиЗапрета. OpenVPN в Windows умеет автоматически игнорировать прочие DNS, поэтому там “всё работает”.</p>
<p>Например, в OpenWrt это делается <a href="https://t.me/FuckYouRKN/9">так</a>, в KeeneticOS <a href="https://t.me/FuckYouRKN/7">так</a>, для асусов где-то тут на форуме тоже находили решение.</p>
<p>В общем случае настройка сводится к:</p>
<ul>
<li>отключению использования провайдерских DNS</li>
<li>добавлению каких-нибудь публичных DNS вместо провайдерских</li>
<li>добавлению директив <code>route x.x.x.x</code> в конфиг OpenVPN, где x.x.x.x - те самые публичные DNS</li>
</ul></td><td>2024-12-04T15:16:46.076Z</td></tr><tr><td>paweca</td><td><p>Последняя версия с роутерами действительно не работает почему-то, с клиентами под Android, Windows работает прекрасно. 3.6.2 которая, 3.6.0 была ок</p></td><td>2024-12-05T04:00:42.077Z</td></tr><tr><td>dartraiden(Alexander Gavrilov)</td><td><p>Никаких проблем с 3.6.2 на двух кинетиках (на одном OVPN, на другом WG) не испытываю.</p></td><td>2024-12-05T22:27:52.325Z</td></tr><tr><td>xtrime</td><td><p>Сейчас столкнулся с полной блокировкой моего иностранного хостинга (даже ssh не работал)</p>
<p>Помогло купить VPS в РФ и проксировать весь траф с нее зарубеж:</p>
<pre><code class="lang-auto">#!/bin/sh

echo "net.ipv4.ip_forward=1" &gt;&gt; /etc/sysctl.d/99-sysctl.conf 
sysctl -w net.ipv4.ip_forward=1

# DNAT rules 
iptables -t nat -A PREROUTING -p tcp ! --dport 22 -j DNAT --to-destination xxxxx
iptables -t nat -A PREROUTING -p udp ! --dport 22 -j DNAT --to-destination xxxx
# MASQUERADE rules
iptables -t nat -A POSTROUTING -p tcp -d xxxx -j MASQUERADE
iptables -t nat -A POSTROUTING -p udp -d xxxx  -j MASQUERADE

echo iptables-persistent iptables-persistent/autosave_v4 boolean true | sudo debconf-set-selections
echo iptables-persistent iptables-persistent/autosave_v6 boolean true | sudo debconf-set-selections
apt install -y iptables-persistent
</code></pre>
<p>Протестирую все и добавлю скрипт для быстрой настройки такой “прокси” по ssh в репозиторий.</p></td><td>2024-12-19T18:46:31.488Z</td></tr><tr><td>Joyz</td><td><p>А какой хостинг попал под блокировку?</p></td><td>2024-12-20T12:48:24.756Z</td></tr><tr><td>xtrime</td><td><p>hetzner, но только в МГТС. На других провайдерах работал.</p></td><td>2024-12-20T18:51:19.925Z</td></tr><tr><td>Mr.Alex</td><td><p>У меня такая проблема что не влезает подсеть 34.0.192.0/18 на роутере asus ax4200 на стоковой прошивке(WireGuard)<br>
<div class="lightbox-wrapper"><a class="lightbox" href="неофициальный-docker-контейнер-антизапрета-8839/bc3563dcd4d2bdba88c8591591005d02fa661a8a.png" data-download-href="https://ntc.party/uploads/default/bc3563dcd4d2bdba88c8591591005d02fa661a8a" title="image"><img src="неофициальный-docker-контейнер-антизапрета-8839/bc3563dcd4d2bdba88c8591591005d02fa661a8a.png" alt="image" data-base62-sha1="qQY9qZ2zcP06i44VILsQUTRn8fg" width="392" height="500" data-dominant-color="3A3732"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">440×561 11.9 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p></td><td>2024-12-27T12:49:05.906Z</td></tr><tr><td>grbr</td><td><p>с Новым годом, коллеги!<br>
Во первых хочу сказать огромное спасибо автору и комьюнити за столь полезную сборку.<br>
Хочу поделиться наблюдением.<br>
Ubuntu 24.04.1 LTS полностью обновленная<br>
Крайняя версия контейнера<br>
Hopper (KN-3811), Версия KeeneticOS: 4.3 Alpha 12<br>
подключение PPoE<br>
коннект по UDP<br>
Все поставлено по инструкции, при просмотре ютуба в логах кинетика масса сообщений вида</p>
<pre><code class="lang-auto">OpenVPN0
AEAD Decrypt error: bad packet ID (may be a replay): [ #2445447 ] – see the man page entry for --no-replay and --replay-window for more info or silence this warning with --mute-replay-warnings
OpenVPN0
AEAD Decrypt error: bad packet ID (may be a replay): [ #2445448 ] – see the man page entry for --no-replay and --replay-window for more info or silence this warning with --mute-replay-warnings
</code></pre>
<p>Добавление <a href="https://askubuntu.com/questions/1136003/aead-decrypt-error-bad-packet-id-on-openvpn-using-udp" rel="noopener nofollow ugc">mssfix 1431</a> в .ovpn файл, частично решило проблему. сообщений стало меньше, но ютуб в  4к стал подвисать иногда.<br>
куда бы покопать?</p></td><td>2025-01-05T13:02:44.880Z</td></tr><tr><td>Oless</td><td><p>Так если есть кинетик, почему бы не заюзать AmneziaWG ? Он и производительнее, и нагрузки меньше даёт на роутер</p></td><td>2025-01-05T19:28:29.594Z</td></tr><tr><td>dartraiden(Alexander Gavrilov)</td><td><aside class="quote no-group" data-username="Mr.Alex" data-post="523" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/m/db5fbb/48.png" class="avatar"> Mr.Alex:</div>
<blockquote>
<p>не влезает подсеть</p>
</blockquote>
</aside>
<p>Можно попробовать с помощью инструментов разработчика в браузере убрать у поля ограничение на длину символов.</p></td><td>2025-01-05T20:03:50.518Z</td></tr><tr><td>Mr.Alex</td><td><p>Большое спасибо. Способ помог</p></td><td>2025-01-06T08:55:32.444Z</td></tr><tr><td>grbr</td><td><aside class="quote no-group" data-username="Oless" data-post="525" data-topic="8839">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/o/b5ac83/48.png" class="avatar"> Oless:</div>
<blockquote>
<p>почему бы не заюзать AmneziaWG</p>
</blockquote>
</aside>
<p>Я может, что не так делаю канеч <img src="https://ntc.party/images/emoji/twitter/frowning.png?v=12" title=":frowning:" class="emoji" alt=":frowning:" loading="lazy" width="20" height="20"> Но вроде все четко по инструкции. и картина даже хуже чем с open vpn. Постоянные подвисания ютуба</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="неофициальный-docker-контейнер-антизапрета-8839/bb409e266a098f4694edf887ee3b8c2eb45bd023.png" data-download-href="https://ntc.party/uploads/default/bb409e266a098f4694edf887ee3b8c2eb45bd023" title="Нагрузка на CPU внутри какая-то жестокая"><img src="неофициальный-docker-контейнер-антизапрета-8839/bb409e266a098f4694edf887ee3b8c2eb45bd023.png" alt="Нагрузка на CPU внутри какая-то жестокая" data-base62-sha1="qIvJfNjcpGQ2pZVatJ9hubYFb3B" width="690" height="93" data-dominant-color="3D3E3F"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">Нагрузка на CPU внутри какая-то жестокая</span><span class="informations">1001×135 6.91 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p></td><td>2025-01-07T20:15:04.921Z</td></tr><tr><td>xtrime</td><td><p>Так не должно быть.  Можно вывод команды top на хосте в момент нагрузки? Памяти на сервере достаточно? Мб это swap?<br>
Рекомендую попробовать взять VPS с 2 гигабайами оперативы. Мб стоит попробовать другого хостера. У таймвеба почасовая оплата, например.</p></td><td>2025-01-19T18:39:43.919Z</td></tr><tr><td>xtrime</td><td><p>В целом эти подсети не обязательны, если не пользуетесь дискордом, то можно оставить только 10.224.0.0/15</p></td><td>2025-01-19T18:42:06.470Z</td></tr><tr><td>DoplerEffect</td><td><p>после последнего обновления на одном из впс начались какие то утечки памяти и проц начал в 100% улетать, сначала не понял в чем проблема, но отключение контейнера помогло</p></td><td>2025-01-22T08:15:10.915Z</td></tr><tr><td>xtrime</td><td><p>Возможно список заблокированных сайтов стал слишком большой и не помещается в память. Что вызывает использование swap. Это очень медленно и все время уходит на ожидание диска.</p>
<p>Нужен скрин вывода команды top на сервере в момент возникновения проблемы.</p>
<p>Решение - сократить потребление памяти другими процессами, либо увеличить размер памяти, либо отключить обновление списков. Рекомендуемый размер памяти для работы 2 гигабайта.</p></td><td>2025-01-22T11:03:56.116Z</td></tr><tr><td>DoplerEffect</td><td><p>а, извините, я уже разобрался, я с какого-то контейнера или еще где поймал perfctl.</p></td><td>2025-01-22T11:16:29.409Z</td></tr><tr><td>Kebu</td><td><p>Добрый день, не удалось пока добавить такой скрипт в репозиторий?</p></td><td>2025-01-22T14:20:01.462Z</td></tr><tr><td>xtrime</td><td><p>Пока не делал. Но скрипт полностью рабочий. Укажите вместо xxxxx в  --to-destination xxxxx  ip своего сервера и все будет работать.</p>
<p>Если используйте timeweb, то там можно добавить скрипт в cloud-init. Он выполнится при создании VPS:<br>
<div class="lightbox-wrapper"><a class="lightbox" href="неофициальный-docker-контейнер-антизапрета-8839/3d2a31d996877c15ff2e596af7d2ffd8c518699f.png" data-download-href="https://ntc.party/uploads/default/3d2a31d996877c15ff2e596af7d2ffd8c518699f" title="image"><img src="неофициальный-docker-контейнер-антизапрета-8839/3d2a31d996877c15ff2e596af7d2ffd8c518699f_2_690x406.png" alt="image" data-base62-sha1="8J5wHDFiFH2vzLh74AIiQtB1eEf" width="690" height="406" srcset="неофициальный-docker-контейнер-антизапрета-8839/3d2a31d996877c15ff2e596af7d2ffd8c518699f_2_690x406.png, неофициальный-docker-контейнер-антизапрета-8839/3d2a31d996877c15ff2e596af7d2ffd8c518699f_2_1035x609.png 1.5x, неофициальный-docker-контейнер-антизапрета-8839/3d2a31d996877c15ff2e596af7d2ffd8c518699f_2_1380x812.png 2x" data-dominant-color="242D38"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">1492×880 60.2 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>Тогда все будет сразу после покупки и запуска работать.</p></td><td>2025-01-22T16:55:36.862Z</td></tr><tr><td>Tyman</td><td><p>Да, список стал очень большим, я у себя переделал кнот резолвере на работу с <a href="https://www.knot-resolver.cz/documentation/stable/modules-policy.html#response-policy-zones">RPZ</a> файлами, они не так сильно жрут оперативку, и в итоге даже гружу весь список без фильтрации и очистки от всяких казино и тд</p></td><td>2025-01-22T18:34:05.849Z</td></tr><tr><td>Kebu</td><td><p>Спасибо, а еще глупый вопрос – на этом рф-сервере сначала надо вайргард например поднять? Или какой доступ правильнее?</p></td><td>2025-01-24T13:29:26.896Z</td></tr><tr><td>xtrime</td><td><p>Нет.<br>
Проксирование трафика идет на низком уровне.<br>
Промежуточный сервер во всех входящих пакетах меняет адреса отправителя и получателя и они уходят на целевой сервер.<br>
Все ответные пакеты с целевого сервера направляются соответствующим отправителям. iptables при этом хранит все связки (это называется маскарадинг).</p>
<p>Тоесть для всех протоколов этот сервер является “зеркалом” целевого сервера. Это уровень ниже, чем любой VPN.</p>
<p>Нужна голая ubuntu и запустить этот скрипт. Все.</p></td><td>2025-01-24T14:10:34.884Z</td></tr><tr><td>Kebu</td><td><p>Понял, благодарю!</p></td><td>2025-01-24T14:22:59.417Z</td></tr><tr><td>Di1Ly(Di1 Ly)</td><td><p>Добрый день!<br>
Проапгрейдил Ubuntu 24 и установил на хосте пакеты для включения DCO.<br>
На вский случай забилдил контейнеры заново.<br>
В логах контейнера OpenVPN пишет что на хосте нет DCO…<br>
Может его както включать надо ?</p>
<pre><code class="lang-auto">
        2025-03-13 11:19:09 Note: Kernel support for ovpn-dco missing, disabling data channel offload.
        2025-03-13 11:19:09 WARNING: Using --management on a TCP port WITHOUT passwords is STRONGLY discouraged and considered insecure
        2025-03-13 11:19:09 OpenVPN 2.6.13 x86_64-pc-linux-musl [SSL (OpenSSL)] [LZ4] [EPOLL] [MH/PKTINFO] [AEAD] [DCO]
        2025-03-13 11:19:09 library versions: OpenSSL 3.3.3 11 Feb 2025
        2025-03-13 11:19:09 DCO version: N/A
        2025-03-13 11:19:09 net_route_v4_best_gw query: dst 0.0.0.0
        2025-03-13 11:19:09 net_route_v4_best_gw result: via 10.200.0.1 dev eth0
</code></pre></td><td>2025-03-13T11:28:46.012Z</td></tr><tr><td>Di1Ly(Di1 Ly)</td><td><p>Разобрался, после<br>
apt install linux-headers-generic<br>
драйвер dco теперь работает )))</p></td><td>2025-03-13T18:33:08.478Z</td></tr><tr><td>Kebu</td><td><p>День добрый! Давно не обновлял контейнер, может там что-то поменялось в этом смысле, но после гит пулл в папке антизапрет делаю:</p>
<pre><code class="lang-auto">root@better:~/antizapret# docker compose pull
open /root/antizapret/docker-compose.wireguard.yml: no such file or directory
</code></pre>
<p>Пользуюсь как раз версией на вайргарде, docker-compose.override.yml давным-давно настроил там и забыл)</p>
<p>Подскажите пожалуйста куда тут копать <img src="https://ntc.party/images/emoji/twitter/slight_smile.png?v=12" title=":slight_smile:" class="emoji" alt=":slight_smile:" loading="lazy" width="20" height="20"></p></td><td>2025-03-14T12:27:20.404Z</td></tr><tr><td>xtrime</td><td><p>У нас был мажорный апгрейд версии с v3 до v4. Вынесли openvpn в отдельный контейнер, заменили kresd на adguardhome и еще куча других изменений. Структура проекта тоже поменялась.</p>
<p>Рекомендуется сделать чистую устнановку (конфиги потеряются, но для wireguard можно перенести руками):</p><aside class="onebox githubrepo" data-onebox-src="https://github.com/xtrime-ru/antizapret-vpn-docker?tab=readme-ov-file#upgrade-from-v3">
  <header class="source">

      <a href="https://github.com/xtrime-ru/antizapret-vpn-docker?tab=readme-ov-file#upgrade-from-v3" target="_blank" rel="noopener">github.com</a>
  </header>

  <article class="onebox-body">
    <div class="github-row" data-github-private-repo="false">
  <img width="690" height="344" src="неофициальный-docker-контейнер-антизапрета-8839/0cb195aee9b46ad1df3ad0f22f8dbe8122d66111_2_690x344.png" class="thumbnail" data-dominant-color="ECEDED">

  <h3><a href="https://github.com/xtrime-ru/antizapret-vpn-docker?tab=readme-ov-file#upgrade-from-v3" target="_blank" rel="noopener">GitHub - xtrime-ru/antizapret-vpn-docker: Docker container with antizapret-vpn for...</a></h3>

    <p><span class="github-repo-description">Docker container with antizapret-vpn for selfhosting.</span></p>
</div>

  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>
<aside class="onebox githubrepo" data-onebox-src="https://github.com/xtrime-ru/antizapret-vpn-docker?tab=readme-ov-file#installation">
  <header class="source">

      <a href="https://github.com/xtrime-ru/antizapret-vpn-docker?tab=readme-ov-file#installation" target="_blank" rel="noopener">github.com</a>
  </header>

  <article class="onebox-body">
    <div class="github-row" data-github-private-repo="false">
  <img width="690" height="344" src="неофициальный-docker-контейнер-антизапрета-8839/0cb195aee9b46ad1df3ad0f22f8dbe8122d66111_2_690x344.png" class="thumbnail" data-dominant-color="ECEDED">

  <h3><a href="https://github.com/xtrime-ru/antizapret-vpn-docker?tab=readme-ov-file#installation" target="_blank" rel="noopener">GitHub - xtrime-ru/antizapret-vpn-docker: Docker container with antizapret-vpn for...</a></h3>

    <p><span class="github-repo-description">Docker container with antizapret-vpn for selfhosting.</span></p>
</div>

  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

<p>wireguard остался на прежнем адресе, adguardhome тоже. Openvpn теперь со своей админкой на порту 8080. И его можно не устанавливать, если не используется.</p>
<p>В adguardhome теперь видны внутренние ip всех пользователей. Т.е. если есть несколько разных wireguard/openvpn пользователей, то у всех будут разные адреса в журнале запросов.</p>
<p>Если интересно, то можно почитать примечания к релизам и readme: <a href="https://github.com/xtrime-ru/antizapret-vpn-docker/releases" class="inline-onebox">Releases · xtrime-ru/antizapret-vpn-docker · GitHub</a></p>
<p>Так же пока ntc был недоступен сделали группу в телеграмм: <a href="https://t.me/antizapret_support" class="inline-onebox">Telegram: Contact @antizapret_support</a></p></td><td>2025-03-14T15:40:45.591Z</td></tr>
    </table>
      </body>
    </html>