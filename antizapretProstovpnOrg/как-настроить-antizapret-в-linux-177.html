
    <html>
      <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <style>
    th, td {
      border: 1px solid black;
      border-collapse: collapse;
    }
    th, td {
      word-wrap: break-word;
      padding: 5px;
    }
    table {
      width: 100%;
      max-width: 100%;
      border: 1px solid black;
      border-collapse: collapse;
      table-layout: fixed;
      word-wrap: break-word
    }
    code {
      word-wrap: break-word;
    }
    pre {
        white-space: pre-wrap;
    }
    </style>
        <title>как-настроить-antizapret-в-linux-177</title>
      </head>
      <body>
        <table border="1" width="100%" cellpadding="5">
          <tr>
            <th style="width: 10%;">Ник</th>
            <th>Пост</th>
            <th style="width: 10%;">Дата</th>
          </tr>
    <tr><td>mindxaker</td><td><p>Добрый вечер! Долгое время пользовался вашим сервисом на Windows, всё было круто!<br>
Теперь необходимо настроить на Linux (elementary os)<br>
При импорте в network manager, сайты не открываются вообще, при установленных галках “использовать только внутри этой сети” в ipv4 и ipv6 открываются сайты, но провайдер перехватывает запросы. Провайдер Дом.ру (ertelecom).<br>
Я в Linux новичек. Прошу помощи. Как настроить, чтобы всё заработало? Как импортировать, какие конфигурации использовать?<br>
Заранее спасибо за ответ!</p></td><td>2019-10-19T17:47:38.235Z</td></tr><tr><td>ValdikSS</td><td><p>Достаточно скачать ZIP-архив с конфигурацией, импортировать его через NetworkManager, в настройках соединения, в маршрутах IPv4 установить галочку “use only for resources on this connection”, и должно заработать.</p></td><td>2019-10-20T10:09:45.592Z</td></tr><tr><td>mindxaker</td><td><p>Я сделал всё, как вы описали. Заблокированные сайты не открываются, всё остальное открывается как обычно.</p>
<details>
<summary>
Скриншоты</summary>
<p><img src="как-настроить-antizapret-в-linux-177/20e7e4ed7f1d3da2f6333091ec4f9758e44c225e.png" alt="17" data-base62-sha1="4H66PzFDOwZX5pBnHjAz7DpeNpc" width="570" height="193"></p>
</details></td><td>2019-10-20T12:54:36.725Z</td></tr><tr><td>ValdikSS</td><td><p>Видимо, у вас настройки DNS не применяются. Проверьте содержание <code>/etc/resolv.conf</code>. Подозреваю, что у вас используется какой-то кеширующий сервер (либо dnsmasq, либо systemd-resolved), и либо он закешировал старую запись для <a href="http://rutracker.org" rel="nofollow noopener">rutracker.org</a> (чтобы это проверить, попробуйте зайти на какой-то другой заблокированный сайт, на который еще ни разу за последние сутки не заходили), либо он не применяет настройки DNS из VPN.</p></td><td>2019-10-20T13:16:24.035Z</td></tr><tr><td>mindxaker</td><td><p>Попробовал зайти на новый сайт. Опять провайдерская заглушка. Можно ли как-то заставить применять настройки DNS из VPN?</p>
<details>
<summary>
Содержание /etc/resolv.conf</summary>
<h1>Generated by NetworkManager</h1>
<p>nameserver 127.0.0.53</p>
</details></td><td>2019-10-20T13:24:40.596Z</td></tr><tr><td>ValdikSS</td><td><p>По всей вероятности, у вас <code>systemd-resolved</code>, а он сломан в Ubuntu.</p><aside class="onebox githubissue" data-onebox-src="https://github.com/systemd/systemd/issues/6076">
  <header class="source">

      <a href="https://github.com/systemd/systemd/issues/6076" target="_blank" rel="noopener">github.com/systemd/systemd</a>
  </header>

  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Issue" data-github-private-repo="false">
	  <svg width="60" height="60" class="github-icon" viewBox="0 0 14 16" aria-hidden="true"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="https://github.com/systemd/systemd/issues/6076" target="_blank" rel="noopener">After connected to VPN, systemd-resolve still use ISP's DNS server( which was polluted because of regulation )</a>
    </h4>

    <div class="github-info">
      <div class="date">
        opened <span class="discourse-local-date" data-format="ll" data-date="2017-06-02" data-time="16:25:10" data-timezone="UTC">04:25PM - 02 Jun 17 UTC</span>
      </div>

        <div class="date">
          closed <span class="discourse-local-date" data-format="ll" data-date="2020-11-06" data-time="11:13:04" data-timezone="UTC">11:13AM - 06 Nov 20 UTC</span>
        </div>

      <div class="user">
        <a href="https://github.com/joshuafc" target="_blank" rel="noopener">
          <img alt="joshuafc" src="как-настроить-antizapret-в-linux-177/9de9498cc0a1baf3a73476faf6300d3f2fa4f4f1.png" class="onebox-avatar-inline" width="20" height="20" data-dominant-color="E0D5EB">
          joshuafc
        </a>
      </div>
    </div>

    <div class="labels">
        <span style="display:inline-block;margin-top:2px;background-color: #B8B8B8;padding: 2px;border-radius: 4px;color: #fff;margin-left: 3px;">
          resolve
        </span>
        <span style="display:inline-block;margin-top:2px;background-color: #B8B8B8;padding: 2px;border-radius: 4px;color: #fff;margin-left: 3px;">
          not-our-bug
        </span>
    </div>
  </div>
</div>

  <div class="github-row">
    <p class="github-body-container">### Submission type



 - Request for enhancement (RFE)



### systemd v<span class="show-more-container"><a href="" rel="noopener" class="show-more">…</a></span><span class="excerpt hidden">ersion the issue has been seen with

&gt; systemd 232
+PAM +AUDIT +SELINUX +IMA +APPARMOR +SMACK +SYSVINIT +UTMP +LIBCRYPTSETUP +GCRYPT +GNUTLS +ACL +XZ +LZ4 +SECCOMP +BLKID +ELFUTILS +KMOD +IDN

### Used distribution

&gt; Ubuntu 17.04   Linux version 4.10.0-21-generic (buildd@lgw01-12) (gcc version 6.3.0 20170406 (Ubuntu 6.3.0-12ubuntu2) ) #23-Ubuntu SMP Fri Apr 28 16:14:22 UTC 2017


Because of the **Internet regulation**, ISP's DNS server can not resolve some domian **correctly**( for example www.google.com www.youtube.com ). Under normal conditions, we use vpn and set the vpn as default internet gateway when needed to access above website. 
When I start to use Ubuntu 17.04, It is found that when connected to vpn, all internet package transfer through vpn except domain name resolve. Infact, VPN server had tell correct DNS server IP address through DHCP. But systemd-resolve still use ISP's polluted resolve.
At /etc/resolv.conf, I found that DNS resolve had be taken over by systemd-resolve. There can't find any easy way to tell systemd-resolve to use a specified DNS server, or disable any DNS server according " systemd-resolve --help ".
Willing to accept guidance to correct my use of systemd-resolve, 
If you can, Please add some necessary feature to systemd-resolve to solve such problem, 


### In case of bug report: Expected behaviour you didn't see

&gt; …

### In case of bug report: Unexpected behaviour you saw

&gt; …

### In case of bug report: Steps to reproduce the problem

&gt; …</span></p>
  </div>

  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

<p>Попробуйте советы вроде <a href="https://github.com/systemd/systemd/issues/6076#issuecomment-475069455">этого</a>, или какие-то другие советы из этой темы.</p>
<p>Также можно просто отключить systend-resolved, в файле <code>/etc/NetworkManager/NetworkManager.conf</code> должна быть директива вроде <code>dns=что-то</code>, попробуйте её закомментировать и перезапустить NetworkManager: <code>sudo systemctl restart network-manager</code>.</p></td><td>2019-10-20T13:36:55.168Z</td></tr><tr><td>mindxaker</td><td><p>Огромное спасибо!<br>
Директивы dns в /etc/NetworkManager/NetworkManager.conf не оказалось, но я попробовал совет, по той ссылке и всё заработало</p></td><td>2019-10-20T13:52:01.657Z</td></tr><tr><td>vpetrigo(Vladimir Petrigo)</td><td><p>Оставлю для истории:<br>
• в Fedora 33 для того, чтобы Antizapret VPN успешно заработал необходимо было выполнить команду описанную <a href="https://github.com/systemd/systemd/issues/6076#issuecomment-726837761" rel="noopener nofollow ugc">здесь</a>. Больше информации, зачем это нужно, можно почерпнуть в <a href="https://github.com/systemd/systemd/blob/main/docs/RESOLVED-VPNS.md" rel="noopener nofollow ugc">официальной документации systemd</a>.</p></td><td>2021-03-17T10:16:39.850Z</td></tr><tr><td>vpetrigo(Vladimir Petrigo)</td><td><p>По описанию в файле <code>antizapret-tcp.ovpn</code>:</p>
<pre><code class="lang-auto">##### NOTE TO LINUX USERS #####
# OpenVPN does not handle DNS on Linux.
# This also applies to ROUTERS.
#
# You have two workarounds:
# 1. Configure OpenVPN connection using NetworkManager.
#    This is preferrable method.
# 2. Uncomment the lines below
#    For Debian, Ubuntu and derivatives:
#
# script-security 2
# up /etc/openvpn/update-resolv-conf
# down /etc/openvpn/update-resolv-conf
#
#    For Fedora:
#
# script-security 2
# up /usr/share/doc/openvpn/contrib/pull-resolv-conf/client.up
# down /usr/share/doc/openvpn/contrib/pull-resolv-conf/client.down
</code></pre>
<p>Часть, касающаяся Fedora, похоже, должна быть обновлена, так как <code>client.up</code> и <code>client.down</code> файлы в указанной директории не являются исполняемыми.</p>
<p>Также наблюдение в Fedora 33: при импорте конфигурации в NetworkManager, <code>up</code>/<code>down</code> директивы, похоже, игнорируются, так как отладочные записи из этих скриптов в системном журнале не появляются при подключении/отключении VPN. ¯_(ツ)_/¯</p>
<p>При запуске через командную строку <code>openvpn --config antizapret-tcp.ovpn</code>, скрипты корректно выполняются, но заблокированные сайты не открываются, хотя <code>ip-forward</code> и <code>masquerade</code> в системе разрешены.</p></td><td>2021-03-17T12:42:48.444Z</td></tr><tr><td>yurikfm</td><td><p>всем привет.<br>
есть на сегодня гайд на запуск в линуксе?<br>
по аналогии с виндой,поставил OpenVPN на линукс и …<br>
интернет блокируется.</p></td><td>2021-12-03T22:24:25.714Z</td></tr><tr><td>ValdikSS</td><td><p>Смотрите сообщения выше и проверяйте настройку DNS.</p></td><td>2021-12-04T20:57:02.039Z</td></tr><tr><td>yurikfm</td><td><p>ну я не настолько продвинутый линуксоид.может со временем сумею прочитать много букв про DNS.</p></td><td>2021-12-05T15:42:50.746Z</td></tr><tr><td>yuriko1158</td><td><p>это я же,yurikfm.почту удалил.пришлось по новой зарегистрироваться.<br>
так вот.<br>
я выполнил команду:</p>
<blockquote>
<p>nmcli -p connection modify antizapret-tcp ipv4.never-default no<br>
nmcli -p connection modify antizapret-tcp ipv4.ignore-auto-dns no<br>
nmcli -p connection modify antizapret-tcp ipv4.dns-priority -42</p>
</blockquote>
<p>VPN заработал,открыл сайт kinovod.net.но стоило открыть nnmclub,как всё отрезало.<br>
видимо пошла блокировка.так как теперь при подключении VPN вообще ничего не открывается.<br>
печально.<br>
,</p></td><td>2021-12-06T15:37:09.035Z</td></tr><tr><td>ValdikSS</td><td><p>Попробуйте:<br>
<code>nmcli connection modify &lt;vpn-connection-name&gt; ipv4.dns-search '~.'</code></p>
<p>Настройка DNS в Linux зависит от используемого демона кеширования и дистрибутива. См. документацию к вашему дистрибутиву.</p></td><td>2021-12-08T22:26:08.811Z</td></tr><tr><td>yuriko1158</td><td><p>я остановил и отключил systemd-resolved.поставил nameserver от Google.<br>
почти уже работает,верстка сайта nnmclub ломается.<br>
kinovod и filmix вроде работает.<br>
теперь осталось найти что мешает …</p></td><td>2021-12-09T23:53:55.696Z</td></tr><tr><td>unxed(Unxed)</td><td><aside class="quote no-group" data-username="ValdikSS" data-post="2" data-topic="177">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/valdikss/48/2_2.png" class="avatar"> ValdikSS:</div>
<blockquote>
<p>в маршрутах IPv4 установить галочку “use only for resources on this connection”</p>
</blockquote>
</aside>
<p>Сделал так, теперь открываются только не заблокированные сайты, а заблокированные не открываются. Linux Mint 20.3 Una x64 MATE</p>
<p>Помогло вот это:</p>
<pre><code class="lang-auto">nmcli -p connection modify antizapret-tcp ipv4.dns-search '~.'
</code></pre></td><td>2022-07-09T21:46:55.676Z</td></tr><tr><td>unxed(Unxed)</td><td><p>В Mint 21 (на базе Ubuntu 22.04) перестало соединяться. Ошибка в логе: «ca md too week». Решение: в файле /etc/NetworkManager/system-connections/antizapret-tcp.nmconnection<br>
после строчки<br>
[vpn]<br>
добавить:<br>
tls-cipher=DEFAULT:@SECLEVEL=0<br>
И потом выполнить<br>
nmcli connection reload</p>
<p>Взято здесь:<br>
<a href="https://forums.openvpn.net/viewtopic.php?p=79185#p79185" class="onebox" target="_blank" rel="noopener nofollow ugc">https://forums.openvpn.net/viewtopic.php?p=79185#p79185</a></p></td><td>2022-08-08T13:51:50.692Z</td></tr><tr><td>filkint(Filkint)</td><td><p>Проблемы с openssl, ждать когда пофиксят.<br>
З.Ы. В debian bullseye таких проблем нет.</p></td><td>2022-08-09T02:26:43.406Z</td></tr><tr><td>anon94384997</td><td><p>В Ubuntu 22.04 OpenSSL 3.0, а Debian Bullseye на год старее и там OpenSSL 1.1.1.<br>
Версия 3.0 принесла новые несовместимости. Пока ее используют только новые Debian (соответственно Ubuntu) и Fedora. Даже в роллинговом Арче еще 1.1.1.</p></td><td>2022-08-09T04:29:23.278Z</td></tr><tr><td>filkint(Filkint)</td><td><p>Совершенно верно, я просто поленился подробно расписывать проблему…</p></td><td>2022-08-09T05:18:50.565Z</td></tr><tr><td>ValdikSS</td><td><p>Это не проблема OpenSSL и исправлять её не будут.<br>
CA-сертификат АнтиЗапрета использует подпись sha1, что считается небезопасно стандартными настройками части дистрибутивов.</p></td><td>2022-08-09T16:47:59.355Z</td></tr><tr><td>filkint(Filkint)</td><td><p>Да, я читал про это, тогда решения проблемы не существует?</p></td><td>2022-08-10T01:45:06.444Z</td></tr>
    </table>
      </body>
    </html>