
    <html>
      <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <style>
    th, td {
      border: 1px solid black;
      border-collapse: collapse;
    }
    th, td {
      word-wrap: break-word;
      padding: 5px;
    }
    table {
      width: 100%;
      max-width: 100%;
      border: 1px solid black;
      border-collapse: collapse;
      table-layout: fixed;
      word-wrap: break-word
    }
    code {
      word-wrap: break-word;
    }
    pre {
        white-space: pre-wrap;
    }
    </style>
        <title>domain-borrowing</title>
      </head>
      <body>
        <table border="1" width="100%" cellpadding="5">
          <tr>
            <th style="width: 10%;">Ник</th>
            <th>Пост</th>
            <th style="width: 10%;">Дата</th>
          </tr>
    <tr><td>ValdikSS</td><td><p><a class="attachment" href="domain-borrowing/hmPWSfhCS65ucNTfoztyVHB30Wc.pdf">as-21-Ding-Domain-Borrowing-Catch-My-C2-Traffic-If-You-Can.pdf</a> (6.6 MB)</p>
<p>Summary: it is possible to use domain fronting without your own domain, by adding the existing well-trusted domain name to the selected CDNs without domain validation (the domain doesn’t have to use said CDN). Additionally, to obtain proper HTTPS certificate for this domain, one can abuse wildcard certificates for well-trusted domains and add a subdomain of such domain name to the CDN panel (the domain should use the CDN in this case).</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="domain-borrowing/6b51dcec206c89d25860aa98006fda788fbfe8f7.png" data-download-href="https://ntc.party/uploads/default/6b51dcec206c89d25860aa98006fda788fbfe8f7" title="as-21-Ding-Domain-Borrowing-Catch-My-C2-Traffic-If-You-Can-fs8"><img src="domain-borrowing/6b51dcec206c89d25860aa98006fda788fbfe8f7_2_690x320.png" alt="as-21-Ding-Domain-Borrowing-Catch-My-C2-Traffic-If-You-Can-fs8" data-base62-sha1="fjotKXNmrT9WsbbmFolyUsT6acD" width="690" height="320" srcset="domain-borrowing/6b51dcec206c89d25860aa98006fda788fbfe8f7_2_690x320.png, domain-borrowing/6b51dcec206c89d25860aa98006fda788fbfe8f7_2_1035x480.png 1.5x, domain-borrowing/6b51dcec206c89d25860aa98006fda788fbfe8f7_2_1380x640.png 2x" data-dominant-color="E5ECF0"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">as-21-Ding-Domain-Borrowing-Catch-My-C2-Traffic-If-You-Can-fs8</span><span class="informations">1512×702 43.9 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p><strong>Domain Borrowing vs. Others</strong></p>
<div class="md-table">
<table>
<thead>
<tr>
<th>Detection method</th>
<th>Domain Borrowing</th>
<th>Domain Fronting</th>
<th>Domain Hiding</th>
</tr>
</thead>
<tbody>
<tr>
<td>high reputation SNI</td>
<td><img src="https://ntc.party/images/emoji/twitter/white_check_mark.png?v=12" title=":white_check_mark:" class="emoji only-emoji" alt=":white_check_mark:" loading="lazy" width="20" height="20"></td>
<td><img src="https://ntc.party/images/emoji/twitter/white_check_mark.png?v=12" title=":white_check_mark:" class="emoji only-emoji" alt=":white_check_mark:" loading="lazy" width="20" height="20"></td>
<td><img src="https://ntc.party/images/emoji/twitter/white_check_mark.png?v=12" title=":white_check_mark:" class="emoji only-emoji" alt=":white_check_mark:" loading="lazy" width="20" height="20"></td>
</tr>
<tr>
<td>high reputation Host</td>
<td><img src="https://ntc.party/images/emoji/twitter/white_check_mark.png?v=12" title=":white_check_mark:" class="emoji only-emoji" alt=":white_check_mark:" loading="lazy" width="20" height="20"></td>
<td><img src="https://ntc.party/images/emoji/twitter/x.png?v=12" title=":x:" class="emoji only-emoji" alt=":x:" loading="lazy" width="20" height="20"></td>
<td>—[2]</td>
</tr>
<tr>
<td>check if SNI == Host</td>
<td><img src="https://ntc.party/images/emoji/twitter/white_check_mark.png?v=12" title=":white_check_mark:" class="emoji only-emoji" alt=":white_check_mark:" loading="lazy" width="20" height="20"></td>
<td><img src="https://ntc.party/images/emoji/twitter/x.png?v=12" title=":x:" class="emoji only-emoji" alt=":x:" loading="lazy" width="20" height="20"></td>
<td>—[2]</td>
</tr>
<tr>
<td>valid HTTPS certificates</td>
<td><img src="https://ntc.party/images/emoji/twitter/white_check_mark.png?v=12" title=":white_check_mark:" class="emoji only-emoji" alt=":white_check_mark:" loading="lazy" width="20" height="20"></td>
<td><img src="https://ntc.party/images/emoji/twitter/white_check_mark.png?v=12" title=":white_check_mark:" class="emoji only-emoji" alt=":white_check_mark:" loading="lazy" width="20" height="20"></td>
<td><img src="https://ntc.party/images/emoji/twitter/white_check_mark.png?v=12" title=":white_check_mark:" class="emoji only-emoji" alt=":white_check_mark:" loading="lazy" width="20" height="20"></td>
</tr>
<tr>
<td>without ESNI[1]</td>
<td><img src="https://ntc.party/images/emoji/twitter/white_check_mark.png?v=12" title=":white_check_mark:" class="emoji only-emoji" alt=":white_check_mark:" loading="lazy" width="20" height="20"></td>
<td><img src="https://ntc.party/images/emoji/twitter/white_check_mark.png?v=12" title=":white_check_mark:" class="emoji only-emoji" alt=":white_check_mark:" loading="lazy" width="20" height="20"></td>
<td><img src="https://ntc.party/images/emoji/twitter/x.png?v=12" title=":x:" class="emoji only-emoji" alt=":x:" loading="lazy" width="20" height="20"></td>
</tr>
</tbody>
</table>
</div><p>[1] ESNI will be blocked by some country-wide and enterprise firewalls<br>
[2] TLSv1.3 + ESNI cannot be decrypted by well-known firewalls currently</p></td><td>2022-08-07T07:58:49.511Z</td></tr><tr><td>tango</td><td><p>I am not sure, but this may be the same idea as <a href="https://github.com/net4people/bbs/issues/73">domain shadowing</a>, which was published around the same time.<br>
<a href="https://www.usenix.org/conference/usenixsecurity21/presentation/wei" class="onebox" target="_blank" rel="noopener">https://www.usenix.org/conference/usenixsecurity21/presentation/wei</a></p><aside class="onebox allowlistedgeneric" data-onebox-src="https://blog.torproject.org/anti-censorship-domain-shadowing/">
  <header class="source">
      <img src="domain-borrowing/a975d26b37a64300cddb82257cf7fae117b880f8.png" class="site-icon" data-dominant-color="787472" width="32" height="32">

      <a href="https://blog.torproject.org/anti-censorship-domain-shadowing/" target="_blank" rel="noopener">blog.torproject.org</a>
  </header>

  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:690/383;"><img src="domain-borrowing/eed492d6725ef822af602ff02bd837bf688254d9_2_690x383.png" class="thumbnail" data-dominant-color="F4F2F3" width="690" height="383"></div>

<h3><a href="https://blog.torproject.org/anti-censorship-domain-shadowing/" target="_blank" rel="noopener">Domain Shadowing: Leveraging CDNs for Robust Blocking-Resistant Communications...</a></h3>

  <p>We invited guest blog author, Mingkui Wei, to submit a summary of their research to the blog...</p>


  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>
</td><td>2022-08-15T20:18:19.219Z</td></tr><tr><td>ValdikSS</td><td><p>The idea of domain shadowing (DS), at least how is it outlined in the paper and implemented in browser extension, is to utilize CDN to access a specified fixed website using a fixed (sub)domain of another existing or non-existing domain, using CDN routing/host rewriting feature only. There’s no VPS/web hosting to proxy the traffic to, and there’s no software “client” application per se, except browser extension which uses CDN’s API. This is somewhat similar to web proxy (also called “anonymizer” sometimes), except it’s “running” on a CDN, not on a server.</p>
<p><em>You need to buy the domain for (regular) domain shadowing. SNI == Host.</em></p>
<p>Domain Fronting and Shadowing (DfDs) improves this idea a bit further, by using the fact that not all CDNs perform domain validation, and some even allow to add non-exiting domain names. I’m not sure whether it provides proper TLS certificate for such configuration, the authors do not mention that anywhere. It probably doesn’t.</p>
<p><em>You don’t need to buy the domain for domain fronting and shadowing, you use a random one, even non-delegated. SNI != Host. You need to directly connect to CDN’s IP address, without DNS. Probably not a valid HTTPS certificate.</em></p>
<p>Enhanced DfDs (DfDs++) state that you can use (regular) domain fronting with this technique: just use any reputable domain name already present on the CDN as SNI.</p>
<p><em>You don’t need to buy the domain for enhanced DfDs++, you use a trusted one, which already uses this CDN. SNI != Host.</em></p>
<p>However, Domain Borrowing is different:</p>
<ol>
<li>It allows to use (and configure your way) <em>any</em> subdomains of high-reputation domain. The domain should be already present on CDN, subdomains should not.</li>
<li>SNI == Host, works even with NGFWs/proxies re-encrypting the traffic and checking for SNI == Host equality.</li>
<li>You receive valid wildcard HTTPS certificate of high-reputation domain.</li>
</ol>
<p>So, no, these two methods are different, despite being similar in some aspects.</p></td><td>2022-08-15T21:13:53.300Z</td></tr>
    </table>
      </body>
    </html>