
    <html>
      <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <style>
    th, td {
      border: 1px solid black;
      border-collapse: collapse;
    }
    th, td {
      word-wrap: break-word;
      padding: 5px;
    }
    table {
      width: 100%;
      max-width: 100%;
      border: 1px solid black;
      border-collapse: collapse;
      table-layout: fixed;
      word-wrap: break-word
    }
    code {
      word-wrap: break-word;
    }
    pre {
        white-space: pre-wrap;
    }
    </style>
        <title>настройка-домашней-сети-c-маршрутизацией-на-mikrotik-vmraspberry-pi-3-b</title>
      </head>
      <body>
        <table border="1" width="100%" cellpadding="5">
          <tr>
            <th style="width: 10%;">Ник</th>
            <th>Пост</th>
            <th style="width: 10%;">Дата</th>
          </tr>
    <tr><td>Azshov</td><td><p>Всем привет</p>
<p>(если я написал не туда или что-то неверно указал в настройке темы прошу простить на форумах ранее не общался)</p>
<p>Есть у меня домашняя сеть - маршрутизатор mikrotik hap ac2 (как я почитал он слабоват для контейнеров, но у меня вроде как хватает ресурсов на нем ,но я ещё не пробовал разворачивать контейнеры) в маршрутизатор заходит провод от провайдера (адрес выдается по dhcp (сам адрес белый статический)), в порт ethernet2 подключен неуправляемый коммутатор до компа и от этого же коммутатора уходит линк в другую комнату до другого неуправляемого коммутатора в который подключен nas сервера truenas (который является файловой хранилкой и он также умеет крутить виртуальные машины). По wifi подключены тв и смартфоны дома.</p>
<p>Тут в ходе последних событий ютуб дома стал совсем туго работать. Я приобрёл впс с расположением в Польше и закатал туда router os CHR. Первый вечер я настраивал простой тоннель WG между 2 микротами и ещё сделал конфиг для простого подключения через десктопное приложение работало нормально. При этом ещё настроил маршрутизацию через правила mangle и добавил несколько тестовых адресов в адрес лист по типу 2ip и ютуб по доменному имени, но ходит ли нормально трафик через маршрутизацию я так и не понял. Когда утром проснулся пару пакетов пробегало по тоннелю и всё трафик не шёл нормально (при этом если менять настройки порта WG или сам адрес, какое-то время тоннель работает корректно и потом всё равно начинает тормозить)</p>
<p>По советам знакомых попробовал поднять GRE тоннель, он конечно работает, но пипец как медленно даже без IPsec.</p>
<p>Сейчас настроил Ovpn тоннель простой, работает нормально, но маршрутизацию для домашних устройств не получилось сделать, так как кода руками прописываю маршрут по нему почему-то трафик не ходит, а кода при старте тоннеля ставишь галку “Add Default Route” маршрут создается автоматически + у него выставляются другие атрибуты, которые я не могу проставить при создании маршрута руками (когда руками -“AS”, а когда автоматически “DAv+”), а мне надо что бы маршрут был прописан руками так как нужно указать таблицу адресов для маршрутизации, в атематическом варианте этот параметр указать нельзя (может можно как то по другому сделать?). Боюсь, что OVPn провайдер тоже скоро будет резать.</p>
<p>Ещё пробовал SSTP тоннель, но отказался от него, так как он работал медленнее OVPN и у него как я понял по хуже с секюрностью.</p>
<p>Вопрос что можно сделать, используя доступные мне ресурсы:</p>
<ol>
<li>
<p>в целом можно сделать витруалку и на неё поставить клиента какой-нибудь “amnezia vpn(amneziaWG)” или клиент чего-то другого что бы через неё домашние устройства ходили на нужные мне ресурсы. Единственное что меня напрягает с виртуалкой это то что она находится за 2 неуправляемыми коммутаторами, и я не смогу нормально сделать маршрутизацию до неё. Хотя может я заблуждаюсь</p>
</li>
<li>
<p>развернуть контейнеры на микротике, но скорее всего он не вывезет (сейчас по свободным ресурсам на нём оперативки 52.4 MiB , а по памяти 1648 KiB в целом могу добавить флешку к нему )</p>
</li>
<li>
<p>у меня валяется raspberry pi 3 b+ с отпавшими usb портами, но её уже можно напрямую воткнуть в микрот и поставить рядом с ним подключив в один из свободных ethernet портов. Только вопрос что можно на неё поставить и насколько это будет мучительно ковыряться с старой малиной и старыми версиями ос.</p>
</li>
</ol>
<hr>
<p>$) Плюнуть на микрот купить другой роутер с поддержкой Openwrt или купить кинетик который умеет в “amnezia vpn (amneziaWG)”</p>
<hr>
<p>Также я где то видел что настраивают как то (amneziaWG) используя правила firewall, но как человек это сделал я не понял</p>
<p>Хочу вас попросить дать совет что лучше сделать при этом, затратив наименьшее количество финансовых ресурсов. И какой протокол лучше всего использовать, имея то что у меня есть на руках сейчас?</p>
<p>Если у вас есть вопросы спрашивайте, буду рад вашим подсказкам/советам</p></td><td>2025-01-04T19:05:12.309Z</td></tr><tr><td>Texsis</td><td><p>Для экономии финансов пробуйте на малинке развернуть sing-box и локальный WireGuard. На WireGuard делаете пересылку пакетов на sing-box. Микрот цепляете по WireGuard к малинке и настраиваете на нем выборочную маршрутизацию с использованием dns static. У меня так настроено, только вместо Малинки апельсинка. Все работает. Протокол Vless. Все попсовые протоколы либо блокируются, у меня ртк не резал, но сильно замедлял трансграничные, по РФ нормально работают. Либо все тоже самое можно поднять на виртуалке.</p></td><td>2025-01-05T07:26:45.377Z</td></tr><tr><td>zzr</td><td><aside class="quote no-group" data-username="Azshov" data-post="1" data-topic="14327">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/a/91b2a8/48.png" class="avatar"> Azshov:</div>
<blockquote>
<p>Вопрос что можно сделать, используя доступные мне ресурсы:</p>
</blockquote>
</aside>
<p>можиш на распери пи прост настроить zapret замуить форвардинг пакетов+ маскарад, указываеш шлюз на усройсвах в дом сети адрес распери пи и <span class="spoiler">пытаться</span> кайфовать</p></td><td>2025-01-08T17:52:52.820Z</td></tr>
    </table>
      </body>
    </html>