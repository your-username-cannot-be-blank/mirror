
    <html>
      <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <style>
    th, td {
      border: 1px solid black;
      border-collapse: collapse;
    }
    th, td {
      word-wrap: break-word;
      padding: 5px;
    }
    table {
      width: 100%;
      max-width: 100%;
      border: 1px solid black;
      border-collapse: collapse;
      table-layout: fixed;
      word-wrap: break-word
    }
    code {
      word-wrap: break-word;
    }
    pre {
        white-space: pre-wrap;
    }
    </style>
        <title>не-работает-dns-ipv6-в-роутере</title>
      </head>
      <body>
        <table border="1" width="100%" cellpadding="5">
          <tr>
            <th style="width: 10%;">Ник</th>
            <th>Пост</th>
            <th style="width: 10%;">Дата</th>
          </tr>
    <tr><td>anton90(Anton)</td><td><p>Добрый день!<br>
Мой провайдер _DOMRU.ru фильтрует Dns (UDP 53 IPv4), но есть IPv6. Роутер ASUS настроил на использование IPv6 ( Native, DHCP-PD, Stateless, DNS ipv6 cloudflare ). <div class="lightbox-wrapper"><a class="lightbox" href="не-работает-dns-ipv6-в-роутере/b1553cd962add424a831fb5890e378928b0c6531.png" data-download-href="https://ntc.party/uploads/default/b1553cd962add424a831fb5890e378928b0c6531" title="2019-09-16_173812"><img src="не-работает-dns-ipv6-в-роутере/b1553cd962add424a831fb5890e378928b0c6531.png" alt="2019-09-16_173812" data-base62-sha1="piL8fX6rmQERUx0quJHEn5M0TG9" width="608" height="500" data-dominant-color="526065"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">2019-09-16_173812</span><span class="informations">747×614 23.5 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>Если настройки в ноутбуке установить следующим образом (DNS IPv6 от cloudflare)<br>
<img src="не-работает-dns-ipv6-в-роутере/1797572b1731791fd5f22337d36696891e39d637.png" alt="2019-09-16_174049" data-base62-sha1="3mHe5VBlYcaW8ewrzfmVsdoPMfd" width="545" height="452"><br>
то легко открываются заблокированные ресурсы у которых есть ipv6 адрес (_rutracker.org, _nnmclub.to и др).Если настройки в ноутбуке установить на автоматич. получение dns, сайты блокируется.Почему в роутере DNS IPv6 не работает?</p></td><td>2019-09-16T13:02:34.810Z</td></tr><tr><td>ilyaigpetrov(ilyaigpetrov)</td><td><p>Предполагается, что опция “Подключаться к DNS-серверу автоматически” должна быть в состоянии “Включить” (не как на скриншоте, в тексте сообщения об этом тоже не упоминается).</p></td><td>2019-09-16T13:30:48.837Z</td></tr><tr><td>ValdikSS</td><td><p>Вероятно, маршрутизатор пытается использовать и IPv4 DNS, и IPv6.<br>
Как понимаю, у вас альтернативная прошивка. Установите tcpdump на маршрутизатор и посмотрите, куда маршрутизатор отправляет запросы.</p></td><td>2019-09-16T14:48:36.008Z</td></tr><tr><td>anton90(Anton)</td><td><aside class="quote no-group" data-username="ValdikSS" data-post="3" data-topic="64">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/valdikss/48/2_2.png" class="avatar"> ValdikSS:</div>
<blockquote>
<p>Как понимаю, у вас альтернативная прошивка.</p>
</blockquote>
</aside>
<p>Прошивка оригинальная RT-N12 VP B1.</p>
<aside class="quote no-group" data-username="ValdikSS" data-post="3" data-topic="64">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/valdikss/48/2_2.png" class="avatar"> ValdikSS:</div>
<blockquote>
<p>Установите tcpdump на маршрутизатор</p>
</blockquote>
</aside>
<p>Для меня это уже сложно.<br>
Есть вот это<br>
<div class="lightbox-wrapper"><a class="lightbox" href="не-работает-dns-ipv6-в-роутере/5166d301a21a3c712d28d76dab83278cc553efca.png" data-download-href="https://ntc.party/uploads/default/5166d301a21a3c712d28d76dab83278cc553efca" title="2019-09-16_221146"><img src="не-работает-dns-ipv6-в-роутере/5166d301a21a3c712d28d76dab83278cc553efca.png" alt="2019-09-16_221146" data-base62-sha1="bC6Ys1wJt5fatXffDpqZCZvjgEy" width="690" height="465" data-dominant-color="49585C"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">2019-09-16_221146</span><span class="informations">770×519 14.3 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<aside class="quote no-group" data-username="ilyaigpetrov" data-post="2" data-topic="64" data-full="true">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/i/5fc32e/48.png" class="avatar"> ilyaigpetrov:</div>
<blockquote>
<p>Предполагается, что опция “Подключаться к DNS-серверу автоматически” должна быть в состоянии “Включить”</p>
</blockquote>
</aside>
<p>И так тоже пробовал.<img src="https://ntc.party/images/emoji/twitter/frowning.png?v=12" title=":frowning:" class="emoji" alt=":frowning:" loading="lazy" width="20" height="20"></p></td><td>2019-09-16T17:17:50.063Z</td></tr><tr><td>ValdikSS</td><td><aside class="quote no-group" data-username="anton90" data-post="4" data-topic="64">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/a/96bed5/48.png" class="avatar"> anton90:</div>
<blockquote>
<p>Есть вот это</p>
</blockquote>
</aside>
<p>Как видно, запрос выполняется по IPv4.</p></td><td>2019-09-16T18:14:08.316Z</td></tr><tr><td>anton90(Anton)</td><td><aside class="quote no-group" data-username="ValdikSS" data-post="5" data-topic="64">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/valdikss/48/2_2.png" class="avatar"> ValdikSS:</div>
<blockquote>
<p>Как видно, запрос выполняется по IPv4.</p>
</blockquote>
</aside>
<p>Так и должно быть?</p></td><td>2019-09-16T19:26:16.416Z</td></tr><tr><td>ValdikSS</td><td><p>Обычно IPv6 имеет приоритет над IPv4. У вас в настройках где-то прописан DNS 1.1.1.1, помимо тех DNS по IPv6 на скриншоте. Попробуйте убрать все IPv4 DNS и посмотрите, что из этого выйдет.</p></td><td>2019-09-16T23:22:54.215Z</td></tr><tr><td>anton90(Anton)</td><td><p>Если убрать все DNS IPv4, то не сохраняются настройки. Значит маршрутизатор мудрит. Спасибо.</p></td><td>2019-09-17T05:01:12.021Z</td></tr><tr><td>krab4t</td><td><p>Это проблема прошивки Asus, если не всех роутеров то многих. Настройки не сохраняются, глючит DNS в целом, из-за чего часто при пользовании браузером сайты не открываются с первого раза либо останавливается загрузка рандомно, либо же все грузится но без картинок.</p>
<p>Вначале лечил я это на RT-AC57U я прошивкой от padawan и указанием ручных ip dns везде где можно: в DHCP, в WAN. Так же лечится с помощью openwrt (правда судя гуглу у вас там 8 mb ROM, 32 mb RAM, не знаю хватит ли).</p>
<p>Подозреваю что виноват встроенный dnsmasq который работает в режиме forwarder, но как его отключить полностью было лень искать, openwrt работает.</p>
<p>Точнее на клиентах не должно быть никаких IP адресов указанных вручную, всем должен заведовать DHCP/DHCPv6, в таком режиме все работает без проблем, разбираться опять же лень.</p></td><td>2019-10-04T22:30:29.491Z</td></tr><tr><td>anton90(Anton)</td><td><aside class="quote no-group" data-username="krab4t" data-post="9" data-topic="64">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/krab4t/48/112_2.png" class="avatar"> krab4t:</div>
<blockquote>
<p>не знаю хватит ли</p>
</blockquote>
</aside>
<p>openwrt есть такая _<a href="http://4pda.ru/forum/index.php?showtopic=530569&amp;st=4100#entry83841577" rel="noopener nofollow ugc">http://4pda.ru/forum/index.php?showtopic=530569&amp;st=4100#entry83841577</a>, но там вырезан ipv6.<br>
Роутеры не шил, боюсь.<br>
На родной прошивке всё устраивает кроме dns ipv6.</p></td><td>2019-10-06T10:19:34.323Z</td></tr><tr><td>krab4t</td><td><p>Там же должен быть SSH, настроить можно и вручную если ничего не сохраняется.</p></td><td>2019-10-06T10:32:17.086Z</td></tr><tr><td>anton90(Anton)</td><td><aside class="quote no-group" data-username="krab4t" data-post="11" data-topic="64" data-full="true">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/krab4t/48/112_2.png" class="avatar"> krab4t:</div>
<blockquote>
<p>Там же должен быть SSH</p>
</blockquote>
</aside>
<p>SSH есть, а что настраивать?</p></td><td>2019-10-06T13:08:16.490Z</td></tr><tr><td>krab4t</td><td><p>Без понятия что там за линукс, никогда со стоком не работал, наверное там какой-то форк openwrt, нужно смотреть на файлы в /etc/config если такие есть.</p></td><td>2019-10-06T13:13:51.320Z</td></tr><tr><td>anton90(Anton)</td><td><p>В моей проблеме помогают 2 правила iptables:<br>
iptables -I INPUT 2 -p udp --sport 53 -m string --hex-string ‘|05030311|’ --from 50 --to 80 --algo bm -j DROP<br>
iptables -I INPUT 3 -p udp --sport 53 -m string --hex-string ‘|2a022698a00200010000000000030017|’ --from 50 --to 90 --algo bm -j DROP<br>
Это напряжно для роутера или нет? Встречал информацию о   -m string ,что это ресурсозатратно.</p></td><td>2019-10-10T20:21:33.150Z</td></tr><tr><td>ValdikSS</td><td><p>Это антиспуфинг-правила для <a href="http://dom.ru" rel="nofollow noopener">dom.ru</a>? Если они вам требуются, это значит, что ваши DNS-запросы всё равно анализируются оборудованием провайдера.<br>
В вашем случае? надежнее всего будет использование DNSCrypt, DNS over TLS или DNS over HTTPS.</p></td><td>2019-10-10T20:34:37.343Z</td></tr><tr><td>anton90(Anton)</td><td><aside class="quote no-group" data-username="ValdikSS" data-post="15" data-topic="64">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/valdikss/48/2_2.png" class="avatar"> ValdikSS:</div>
<blockquote>
<p>Это антиспуфинг-правила для <a href="http://dom.ru" rel="noopener nofollow ugc">dom.ru</a>?</p>
</blockquote>
</aside>
<p>Да.</p>
<p>У меня нет задачи конфиденциальность. Хочется чтобы работало быстро, с меньшими ресурсозатратами и желательно для всех устройств. Экспериментирую пока…</p></td><td>2019-10-11T05:45:24.305Z</td></tr><tr><td>krab4t</td><td><p>И как в том же openwrt просто включить DNS over TLS? Например у Ростелекома 1.1.1.1 роутится через Лондон там что-то вроде 80 мс для Поволжья это же ад.</p>
<p>Хотя уже не надо. Наггулилось само сходу.</p></td><td>2019-10-11T20:31:09.405Z</td></tr>
    </table>
      </body>
    </html>