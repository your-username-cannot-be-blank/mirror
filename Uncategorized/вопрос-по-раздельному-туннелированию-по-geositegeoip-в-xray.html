
    <html>
      <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <style>
    th, td {
      border: 1px solid black;
      border-collapse: collapse;
    }
    th, td {
      word-wrap: break-word;
      padding: 5px;
    }
    table {
      width: 100%;
      max-width: 100%;
      border: 1px solid black;
      border-collapse: collapse;
      table-layout: fixed;
      word-wrap: break-word
    }
    code {
      word-wrap: break-word;
    }
    pre {
        white-space: pre-wrap;
    }
    </style>
        <title>вопрос-по-раздельному-туннелированию-по-geositegeoip-в-xray</title>
      </head>
      <body>
        <table border="1" width="100%" cellpadding="5">
          <tr>
            <th style="width: 10%;">Ник</th>
            <th>Пост</th>
            <th style="width: 10%;">Дата</th>
          </tr>
    <tr><td>aggravatingbee</td><td><p>Добрый день!</p>
<p>Хочу настроить раздельное туннелирование в xray, но в упор не могу разобраться с базами/настройками geosite/geoip.</p>
<p>Задача - поставить proxy для всех заблокированных ресурсов, freedom - для всего остального.</p>
<ol>
<li>
<p>Где можно забирать эти файлы автоматически по прямой ссылке? Поддерживающие актуальность, а также (в идеале) поддерживаювающие не только сайты и сервисы, заблокированные РФ, но и сайты с сервисами, заблокированными ДЛЯ РФ (Notion и прочее). Нашел что-то тут <a href="https://github.com/Nidelon/ru-block-v2ray-rules/tree/release?tab=readme-ov-file" class="inline-onebox" rel="noopener nofollow ugc">GitHub - Nidelon/ru-block-v2ray-rules at release</a>, но не знаю какое там содержимое и какой признак нужно указывать (geoip:ru? geoip:ru-block?)</p>
</li>
<li>
<p>Несмотря на условия задачи - сомневаюсь, что мне удастся избежать добавления доменов вручную, отсюда вопрос - в каких программах (желательно с GUI) можно открыть эти файлы?</p>
</li>
<li>
<p>Упоминал выше, но хочу выделить в отдельный вопрос - как понять какой признак для этих файлов указывать в конфиге xray?</p>
</li>
</ol></td><td>2024-12-14T11:24:16.018Z</td></tr><tr><td>spotted_giraffe</td><td><p>У меня были когда-то базы giosite:antizapret, которые подразумевалось подкладывать для клиента Nekoray. Но потом по опыту понял, что проще самому прописать сайты ручками если куда-то нужно зайти. Из всего заблокированного не так много нужно для постоянного использования</p>
<blockquote>
<p>geoip:ru</p>
</blockquote>
<p>Это обязательно пропишете как правило чтобы ходить напрямую, вы же не хотите засветить вашу впс случайно там где не стоит</p></td><td>2024-12-14T18:24:58.285Z</td></tr><tr><td>aggravatingbee</td><td><p>Я хочу их добавить именно на уровне сервера. И что-то мне подсказывает, что руками я их буду искать и прописывать 24/7. Самый красивый пример - я без понятия к каким адресам обращается rockstar laucnher при запуске GTA V (при том что Steam тоже не работает без прокси).</p>
<p>“ru” - это стандартный признак xray? Или в разных базах он может называться по разному?</p></td><td>2024-12-14T19:04:15.797Z</td></tr><tr><td>s.v.d(00svd00)</td><td><p>Попробуйте эти списки. Там всё подробно задокументировано, что куда</p><aside class="onebox allowlistedgeneric" data-onebox-src="https://github.com/runetfreedom">
  <header class="source">
      <img src="https://ntc.party/uploads/default/original/2X/b/bad3e5f9ad67c1ddf145107ce7032ac1d7b22563.svg" class="site-icon" data-dominant-color="" width="32" height="32">

      <a href="https://github.com/runetfreedom" target="_blank" rel="noopener nofollow ugc">GitHub</a>
  </header>

  <article class="onebox-body">
    <img width="420" height="420" src="вопрос-по-раздельному-туннелированию-по-geositegeoip-в-xray/960cfe37fc1cbd42384e93a1811fa86d0f3a4b16.png" class="thumbnail onebox-avatar" data-dominant-color="BEC3E5">

<h3><a href="https://github.com/runetfreedom" target="_blank" rel="noopener nofollow ugc">runetfreedom - Overview</a></h3>

  <p>runetfreedom has 12 repositories available. Follow their code on GitHub.</p>


  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>
<p>
Плюс вы можете собрать свой собственный винигрет, тут есть тулза</p><aside class="onebox githubrepo" data-onebox-src="https://github.com/v2fly/geoip">
  <header class="source">

      <a href="https://github.com/v2fly/geoip" target="_blank" rel="noopener nofollow ugc">github.com</a>
  </header>

  <article class="onebox-body">
    <div class="github-row" data-github-private-repo="false">
  <img width="690" height="344" src="вопрос-по-раздельному-туннелированию-по-geositegeoip-в-xray/0fa1215b7befb3a946ff40ffff4fe6c78d9fffef_2_690x344.png" class="thumbnail" data-dominant-color="EFEFF4">

  <h3><a href="https://github.com/v2fly/geoip" target="_blank" rel="noopener nofollow ugc">GitHub - v2fly/geoip: GeoIP for V2Ray. Generate and release GeoIP files...</a></h3>

    <p><span class="github-repo-description">GeoIP for V2Ray. Generate and release GeoIP files such as geoip.dat and geoip-only-cn-private.dat for V2Ray automatically every Thursday.</span></p>
</div>

  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>
</td><td>2024-12-14T19:11:29.557Z</td></tr><tr><td>REM1X</td><td><p>А есть какой-то понятный и простой инструмент чтобы смотреть эти .dat файлы и хотя бы проверять что в них есть а что нет?<br>
Некорей то вроде подтягивает при вводе есть это в базе или нет, а всякие другие приблуды уже не показывают.<br>
Например поставил себе xKeen сегодня, а там свои какие то базы которые тоже обновляются и хз что там есть а что нет.</p></td><td>2024-12-14T19:55:59.387Z</td></tr><tr><td>s.v.d(00svd00)</td><td><p>HEX редактор. Я лично через Notepad++ смотрел вообще, напр. если поискать ^\x{0002}RU - найдётся начало списка RU<br>
Соотв. если полистать поиск ^\x{0002} - то найдутся начала других списков</p></td><td>2024-12-14T20:26:05.242Z</td></tr><tr><td>REM1X</td><td><p>Notepad ++ я тоже пробовал, но там нечитаемо практически показывает</p></td><td>2024-12-15T07:24:21.309Z</td></tr><tr><td>s.v.d(00svd00)</td><td><p>Ну разумеется, это же бинарный файл. Но ± разобраться можно</p></td><td>2024-12-15T16:50:45.250Z</td></tr><tr><td>REM1X</td><td><p>Ну вот в том то и дело, что там по сути одни спецсимволы и вхождение определенных адресов не понять.<br>
Поэтому и интересуюсь есть ли способы просмотра, а то как черный ящик, подставляешь, а узнаешь есть там адрес или нет, только если сервис не запустится и не сругается.</p></td><td>2024-12-15T18:13:49.360Z</td></tr><tr><td>spotted_giraffe</td><td><p>Вам похоже нужно копать в эту сторону: <a href="https://packages.debian.org/ru/sid/geoip-bin" class="inline-onebox" rel="noopener nofollow ugc">Debian -- Подробная информация о пакете geoip-bin в sid</a></p>
<p>Бинарный формат, geoip-bin с ним работает. Насчет UI для этого всего очень сомнительно что существует</p></td><td>2024-12-15T18:48:35.524Z</td></tr><tr><td>aggravatingbee</td><td><p>Вот у меня та же проблема. Хотя, если верить анализу логов через ChatGPT маршрутизация на уровне сервера - в целом тот еще геморрой. Мой xray не видит кастомные файлы geoip и geosite, несмотря на прописанные пути в .env файле. А при попытке прописать домены вручную (уже просто интереса ради) выдает ошибку конфига. Убил на это полтора дня и не сдвинулся ни на шаг.</p></td><td>2024-12-15T22:39:04.078Z</td></tr><tr><td>0ka(0ka)</td><td><p>В xray нельзя сделать маршрутизацию на уровне сервера, точнее можно заблокировать соединение или отправить например в warp, но контроллировать клиент нельзя.</p></td><td>2024-12-16T01:07:05.079Z</td></tr><tr><td>sakontwist</td><td><p>Посмотреть, что включено в geosite можно здесь - <a href="https://github.com/v2fly/domain-list-community/" class="inline-onebox" rel="noopener nofollow ugc">GitHub - v2fly/domain-list-community: Community managed domain list. Generate geosite.dat for V2Ray.</a><br>
Мне этого достаточно для настройки необходимой марщрутизации.<br>
Что касается geoip, предпочитаю брать отсюда - <a href="https://github.com/Loyalsoldier/geoip" class="inline-onebox" rel="noopener nofollow ugc">GitHub - Loyalsoldier/geoip: 🌚 🌍 🌝 GeoIP 规则文件加强版，支持自行定制 V2Ray dat 格式文件 geoip.dat、MaxMind mmdb 格式文件、sing-box SRS 格式文件、mihomo MRS 格式文件、Clash ruleset、Surge ruleset 等。Enhanced edition of GeoIP files for V2Ray, Xray-core, sing-box, Clash, mihomo, Shadowrocket, Quantumult X, Surge, hysteria, Trojan-Go, Leaf, Nginx, etc.</a>, регулярно обновляется, раскатываю через ansible.</p></td><td>2024-12-16T06:30:40.857Z</td></tr><tr><td>sakontwist</td><td><p>Насколько я помню документацию, никакой env править не надо. Свой файл geosite/geoip достаточно положить рядом с типовым из пакета (/usr/local/share/xray/)  и затем его можно подключить в конфигурацию через “ext:my-geoip.dat:ru” - это есть в документации в разделе RuleObject <a href="https://github.com/XTLS/Xray-docs-next/blob/main/docs/ru/config/routing.md" class="inline-onebox" rel="noopener nofollow ugc">Xray-docs-next/docs/ru/config/routing.md at main · XTLS/Xray-docs-next · GitHub</a></p>
<p>Впрочем я кустарными файлами не заморачивался, а предпочитаю использовать готовые geosite или просто дополнять правило по domain.При попытке “прописать домены вручную” никакой проблемы нет. Нужно использовать rule с объектом domain и списком доменов. Транскрипция там же, в разделе RuleObject</p>
<pre><code class="lang-auto">        {
            "inboundTag": ["in-tproxy"],
            "domain": [
                "domain:cloudflare-ech.com",
                "domain:googlevideo.com",
                ...............
                "domain:ggpht.com",
                "domain:ytimg.com",
                "domain:youtube.com",
                "domain:flickr.com",
                "domain:internetat.tv",
                "full:play.google.com"
            ],
            "outboundTag": "vless5",
            "ruleTag": "tv"
        }
</code></pre></td><td>2024-12-16T06:45:33.880Z</td></tr><tr><td>notcvnt</td><td><aside class="quote no-group" data-username="0ka" data-post="12" data-topic="13801">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/0/d78d45/48.png" class="avatar"> 0ka:</div>
<blockquote>
<p>отправить например в warp</p>
</blockquote>
</aside>
<p>Буду бесконечно благодарен если дадите ссылку на гайд как на уровне сервера ru ip и/или домены в warp заворачивать (warp в системе установлен, а не через панель)</p></td><td>2024-12-16T22:41:32.139Z</td></tr>
    </table>
      </body>
    </html>