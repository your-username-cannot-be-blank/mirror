
    <html>
      <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <style>
    th, td {
      border: 1px solid black;
      border-collapse: collapse;
    }
    th, td {
      word-wrap: break-word;
      padding: 5px;
    }
    table {
      width: 100%;
      max-width: 100%;
      border: 1px solid black;
      border-collapse: collapse;
      table-layout: fixed;
      word-wrap: break-word
    }
    code {
      word-wrap: break-word;
    }
    pre {
        white-space: pre-wrap;
    }
    </style>
        <title>как-правильно-настроить-nekoray</title>
      </head>
      <body>
        <table border="1" width="100%" cellpadding="5">
          <tr>
            <th style="width: 10%;">Ник</th>
            <th>Пост</th>
            <th style="width: 10%;">Дата</th>
          </tr>
    <tr><td>Sxber</td><td><p>Подскажите, пожалуйста, верные настройки для Nekoray, чтобы не было утечек DNS, адекватно работали и TCP и UDP приложения</p></td><td>2024-11-23T00:53:19.959Z</td></tr><tr><td>xX_RUP3R7_P4UL50N_Xx</td><td><p>Лично я настроил таким образом (за правильность на 100% не ручаюсь, настройки выставлял сам, ориентируясь на разные источники):</p>
<details>
<summary>
0. Общие настройки для клиента NekoBox</summary>
<p><div class="lightbox-wrapper"><a class="lightbox" href="как-правильно-настроить-nekoray/c32aac2b9b02403373dbfbf7e0a289be1aa0652d.png" data-download-href="https://ntc.party/uploads/default/c32aac2b9b02403373dbfbf7e0a289be1aa0652d" title="VLESS_Config_XUDP_ON"><img src="как-правильно-настроить-nekoray/c32aac2b9b02403373dbfbf7e0a289be1aa0652d_2_496x375.png" alt="VLESS_Config_XUDP_ON" data-base62-sha1="rQwwZUbgZPzv7VeP1tRREmOSr2l" width="496" height="375" srcset="как-правильно-настроить-nekoray/c32aac2b9b02403373dbfbf7e0a289be1aa0652d_2_496x375.png, как-правильно-настроить-nekoray/c32aac2b9b02403373dbfbf7e0a289be1aa0652d_2_744x562.png 1.5x, как-правильно-настроить-nekoray/c32aac2b9b02403373dbfbf7e0a289be1aa0652d_2_992x750.png 2x" data-dominant-color="323031"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">VLESS_Config_XUDP_ON</span><span class="informations">1036×782 37 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div><br>
<div class="lightbox-wrapper"><a class="lightbox" href="как-правильно-настроить-nekoray/de35a6e114d943c4f21dd76a29987eaec70ba5dd.png" data-download-href="https://ntc.party/uploads/default/de35a6e114d943c4f21dd76a29987eaec70ba5dd" title="DNS"><img src="как-правильно-настроить-nekoray/de35a6e114d943c4f21dd76a29987eaec70ba5dd_2_476x375.png" alt="DNS" data-base62-sha1="vHKWIroNFRF0wH31IEF2CpanCNv" width="476" height="375" srcset="как-правильно-настроить-nekoray/de35a6e114d943c4f21dd76a29987eaec70ba5dd_2_476x375.png, как-правильно-настроить-nekoray/de35a6e114d943c4f21dd76a29987eaec70ba5dd_2_714x562.png 1.5x, как-правильно-настроить-nekoray/de35a6e114d943c4f21dd76a29987eaec70ba5dd_2_952x750.png 2x" data-dominant-color="383536"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">DNS</span><span class="informations">1002×788 29.6 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div><br>
<div class="lightbox-wrapper"><a class="lightbox" href="как-правильно-настроить-nekoray/7988fac0330fe4c4d60193dbff8e91be260429b4.png" data-download-href="https://ntc.party/uploads/default/7988fac0330fe4c4d60193dbff8e91be260429b4" title="TUN_mode"><img src="как-правильно-настроить-nekoray/7988fac0330fe4c4d60193dbff8e91be260429b4_2_357x375.png" alt="TUN_mode" data-base62-sha1="hl9fznxE90R6ZJPlOC1EtyCNE56" width="357" height="375" srcset="как-правильно-настроить-nekoray/7988fac0330fe4c4d60193dbff8e91be260429b4_2_357x375.png, как-правильно-настроить-nekoray/7988fac0330fe4c4d60193dbff8e91be260429b4_2_535x562.png 1.5x, как-правильно-настроить-nekoray/7988fac0330fe4c4d60193dbff8e91be260429b4_2_714x750.png 2x" data-dominant-color="2C2A2B"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">TUN_mode</span><span class="informations">752×788 23.3 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
</details>
<details>
<summary>
1. Настройка роутинга для работы вместе с Zapret (проксируются только выбраные сайты для обхода регион блока)</summary>
<p><div class="lightbox-wrapper"><a class="lightbox" href="как-правильно-настроить-nekoray/0b4a27aeaa6f35d36d70b26d60b4e4fb14e1bc19.png" data-download-href="https://ntc.party/uploads/default/0b4a27aeaa6f35d36d70b26d60b4e4fb14e1bc19" title="01_ALL-to-Direct_Specified-to-Proxy"><img src="как-правильно-настроить-nekoray/0b4a27aeaa6f35d36d70b26d60b4e4fb14e1bc19_2_476x375.png" alt="01_ALL-to-Direct_Specified-to-Proxy" data-base62-sha1="1BS7Y8N8sj6ZzUvMtNFMU1IW80F" width="476" height="375" srcset="как-правильно-настроить-nekoray/0b4a27aeaa6f35d36d70b26d60b4e4fb14e1bc19_2_476x375.png, как-правильно-настроить-nekoray/0b4a27aeaa6f35d36d70b26d60b4e4fb14e1bc19_2_714x562.png 1.5x, как-правильно-настроить-nekoray/0b4a27aeaa6f35d36d70b26d60b4e4fb14e1bc19_2_952x750.png 2x" data-dominant-color="2E2C2D"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">01_ALL-to-Direct_Specified-to-Proxy</span><span class="informations">1002×788 27.5 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div><br>
<a class="attachment" href="как-правильно-настроить-nekoray/jNWUzzvks687Y4nRDRlUpVKScnX.txt">01_ALL-to-Direct_Specified-to-Proxy.txt</a> (124 байта)</p>
</details>
<details>
<summary>
2. Настройка роутинга для работы только NekoBox (пропуск всего РУ трафика и проксирование всего зарубежного КРОМЕ исключений)</summary>
<p><div class="lightbox-wrapper"><a class="lightbox" href="как-правильно-настроить-nekoray/700395aaf90ee0c3fa4bf71426f48d8933fbda01.png" data-download-href="https://ntc.party/uploads/default/700395aaf90ee0c3fa4bf71426f48d8933fbda01" title="02_Russia-to-Direct_Other-to-Proxy"><img src="как-правильно-настроить-nekoray/700395aaf90ee0c3fa4bf71426f48d8933fbda01_2_476x375.png" alt="02_Russia-to-Direct_Other-to-Proxy" data-base62-sha1="fYV9Ix1tzOr9kLjbG54MLL2Tu13" width="476" height="375" srcset="как-правильно-настроить-nekoray/700395aaf90ee0c3fa4bf71426f48d8933fbda01_2_476x375.png, как-правильно-настроить-nekoray/700395aaf90ee0c3fa4bf71426f48d8933fbda01_2_714x562.png 1.5x, как-правильно-настроить-nekoray/700395aaf90ee0c3fa4bf71426f48d8933fbda01_2_952x750.png 2x" data-dominant-color="2F2C2E"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">02_Russia-to-Direct_Other-to-Proxy</span><span class="informations">1002×788 34.1 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div><br>
<a class="attachment" href="как-правильно-настроить-nekoray/gTfpEKbUolmgUPABT7zBCOn6nXP.txt">02_Russia-to-Direct_Other-to-Proxy.txt</a> (358 байтов)</p>
</details>
<details>
<summary>
3. Ещё крайне рекоммендую настроить роутинг всего РУ трафика на сервере в WARP (на всякий случай, вдруг подключитесь с проксированием всего трафика в клиенте)</summary>
<p><a class="attachment" href="как-правильно-настроить-nekoray/b1AqyJkZc85b7LW6ECOYIBF7y26.txt">Маршруты_для_сервера.txt</a> (174 байта)</p>
</details>
<p>Потом в клиенте нажимаешь режим TUN, выбираешь сервер и нажимаешь ENTER.</p>
<ul>
<li>
<p>Для проверки первого варианта роутинга пробуешь перейти <a href="https://habr.com/ru/articles/770400/" rel="noopener nofollow ugc">на эту статью</a>, если не высвечивается ошибка и на <a href="http://2ip.ru" rel="noopener nofollow ugc">2ip.ru</a> / <a href="http://2ip.io" rel="noopener nofollow ugc">2ip.io</a> россиский айпишник, то всё гуд.</p>
</li>
<li>
<p>Для проверки второго варианта роутинга заходишь на <a href="http://2ip.ru" rel="noopener nofollow ugc">2ip.ru</a> и <a href="http://2ip.io" rel="noopener nofollow ugc">2ip.io</a>, на первом сайте должен высветиться российский IP, на втором соответственно той страны, в которой находится сам сервер.</p>
</li>
</ul>
<p>PROFIT!!!</p></td><td>2024-11-23T02:31:31.044Z</td></tr><tr><td>IndeecFOX(IndeecFox)</td><td><aside class="quote no-group" data-username="xX_RUP3R7_P4UL50N_Xx" data-post="2" data-topic="13311">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/xx_rup3r7_p4ul50n_xx/48/13752_2.png" class="avatar"> xX_RUP3R7_P4UL50N_Xx:</div>
<blockquote>
<p>Потом в клиенте нажимаешь режим TUN, выбираешь сервер и нажимаешь ENTER.</p>
</blockquote>
</aside>
<p>От себя добавлю, что у меня сбоит часто в такой последовательности почему-то.<br>
Сначала подключаюсь, а только потом галку на TUN кидаю. Так всё ок)</p></td><td>2024-11-23T02:44:59.180Z</td></tr><tr><td>xX_RUP3R7_P4UL50N_Xx</td><td><p>Да, бывает. Ещё иногда по необъяснимым причинам выскакивает ошибка в духе “Слижком долгое подключение к серверу, хотите перезапустить программу?”, помогает удалить сетевой интерфейс singtun с драйверами в диспетчере устройств и включить / выключить сетевую карту самого ПК</p></td><td>2024-11-23T02:47:33.504Z</td></tr><tr><td>IndeecFOX(IndeecFox)</td><td><aside class="quote no-group" data-username="xX_RUP3R7_P4UL50N_Xx" data-post="4" data-topic="13311">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/xx_rup3r7_p4ul50n_xx/48/13752_2.png" class="avatar"> xX_RUP3R7_P4UL50N_Xx:</div>
<blockquote>
<p>Слижком долгое подключение к серверу, хотите перезапустить программу</p>
</blockquote>
</aside>
<p>Вот именно от этой проблемы мне и помогает обратная последовательность)</p></td><td>2024-11-23T11:02:34.791Z</td></tr><tr><td>Sxber</td><td><p>С такими настройками при заходе на условный browserleaks он как бешеный начинает выдавать мой настоящий DNS вперемешку с DNS хоста. Пробовал в настройках TUN ставить Fake DNS и Strict routing, но тогда нереально замедляется ютуб, хотя в остальных требовательных к скорости процессах все нормально, а русский днс перестает палиться</p></td><td>2024-11-23T11:37:45.904Z</td></tr><tr><td>Sxber</td><td><p>Тормозит, кстати, совсем не настолько ужасно, насколько без прокси в принципе, обычное РКНовское замедление замедляет совсем до невозможности.</p></td><td>2024-11-23T11:59:02.703Z</td></tr><tr><td>xX_RUP3R7_P4UL50N_Xx</td><td><p>Хм, тогда можно попробовать включить галочку на “Вкл. DNS-маршрутизацию”, а в DNS для “прямых” запросов прописать <a href="https://8.8.8.8/dns-query" rel="noopener nofollow ugc">https://8.8.8.8/dns-query</a> (Google не имеет DNS серверов на территории России) либо local либо <a href="https://77.88.8.8/dns-query" rel="noopener nofollow ugc">https://77.88.8.8/dns-query</a> (Яндекс DNS).</p>
<p>Ещё бы посоветовал поставить расширение Disable WebRTC, это особенно актуально если вы используете Proxy режим в NekoBox</p></td><td>2024-11-23T19:48:55.024Z</td></tr><tr><td>invictus(invictus)</td><td><p>Прошу прощения, а где найти настройки, которые на первой картинке "“Общие настройки для клиента Nekobox”? У меня такого нет))</p></td><td>2024-11-25T09:26:09.591Z</td></tr><tr><td>xX_RUP3R7_P4UL50N_Xx</td><td><p>Дабл клик по VLESS конфигу</p></td><td>2024-11-25T09:32:33.049Z</td></tr><tr><td>invictus(invictus)</td><td><p>ох…) а я всю дорогу думаю, что даблклик его стартует и поэтому всегда жму пкм и старт)) Вот так вот, век живи - век учись. Спасибо за науку)</p></td><td>2024-11-25T10:38:15.278Z</td></tr><tr><td>wsvall</td><td><p>Всем привет!<br>
Настроил nekoray v4.0.1 в TUN с распределением зон, все настройки делал в GUI.<br>
Визуально все работает, всякие 2ip показывают ip как нужно (ру = ру, не ру = не ру), утечек нет.<br>
Но не могу понять несколько вещей:<br>
Ставлю для проверки domain:com в direct (чтобы не юзал прокси)</p>
<ol>
<li>Если смотреть Wireshark, то при обращении к .com ресурсу, например, запустить обновление в винде, то пойдут два запроса: первый я ожидаю - запрос не должен попасть через тунель (выделил зеленым); второй, идет в тунель (выделил красным). Может так работает сеть и это нормально, но хотел спросить мнение  у других , так должно быть ? Не будет ли это подозрительным на стороне провайдера?<br>
<div class="lightbox-wrapper"><a class="lightbox" href="как-правильно-настроить-nekoray/c727bb6551097b80ef667fdf7f81a509ddcad210.png" data-download-href="https://ntc.party/uploads/default/c727bb6551097b80ef667fdf7f81a509ddcad210" title="image"><img src="как-правильно-настроить-nekoray/c727bb6551097b80ef667fdf7f81a509ddcad210.png" alt="image" data-base62-sha1="spO8O6QWdq9SrRbLtn6CFFBM7oQ" width="690" height="106" data-dominant-color="C3D1DE"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">915×141 24.7 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></li>
<li>Если запустить nslookup <a href="http://mail.ru" rel="noopener nofollow ugc">mail.ru</a> или nslookup <a href="http://time.net" rel="noopener nofollow ugc">time.net</a> , то вывод в командной строке покажет что запрос пошел к днс тунеля 172.19.0.2. В Wireshark вижу все те же два запроса, если используется .ru адрес (почему два?) и один запрос, если используется .net (что мне и нужно). Провайдер будет видеть два запроса так же к ru зоне ?</li>
<li>Как отлючить логирование ?</li>
</ol>
<p>Я бы оставил полный TUN, но кажется это будет подозрительно на стороне провайдера. На сервере работает vless с маскировакой под сайт.</p></td><td>2024-12-24T09:37:03.398Z</td></tr><tr><td>Xunlei</td><td><aside class="quote no-group" data-username="wsvall" data-post="12" data-topic="13311">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/wsvall/48/14315_2.png" class="avatar"> wsvall:</div>
<blockquote>
<p>так должно быть ?</p>
</blockquote>
</aside>
<p>Да. В виндовсе если указано несколько адресов DNS резолверов на разных сетевых адаптерах, то резолвинг происходит паралельно. Для избегания этого есть разные механизмы.</p>
<aside class="quote no-group" data-username="wsvall" data-post="12" data-topic="13311">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/wsvall/48/14315_2.png" class="avatar"> wsvall:</div>
<blockquote>
<p>Если запустить nslookup</p>
</blockquote>
</aside>
<p>nslookup работает по другому, в отличие от функции <em>gethostbyname</em></p></td><td>2024-12-24T09:47:04.523Z</td></tr><tr><td>wsvall</td><td><aside class="quote no-group" data-username="Xunlei" data-post="13" data-topic="13311" data-full="true">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/x/8e7dd6/48.png" class="avatar"> Xunlei:</div>
<blockquote>
<p>Для избегания этого есть разные механизмы.</p>
</blockquote>
</aside>
<p>Спасибо за ответ. А какой механизм можно использовать ? Погуглил, нашел только что то про сменить приоритет метрик у интерфейсов, но кажется это не то.<br>
И не совсем понял, разолвинг в идеале лучше исправлять, чтобы провайдер не видел бардака в моих запросах или можно забить? У меня цель, максимально скрыть использование впн.</p></td><td>2024-12-24T12:14:02.208Z</td></tr><tr><td>Xunlei</td><td><aside class="quote no-group" data-username="wsvall" data-post="14" data-topic="13311">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/wsvall/48/14315_2.png" class="avatar"> wsvall:</div>
<blockquote>
<p>А какой механизм можно использовать ?</p>
</blockquote>
</aside>
<p>В некорей незнаю, не пользуюсь. В разных впн клиентах есть добавление отдельного правила маршрутизации настроенного текущего адреса резолвера через туннель, или, например, добавление запретительного правила в брандмауэр. Я пользуюсь локальным кэширующим резолвером для свой домашней сети (<a href="https://technitium.com/dns/" rel="noopener nofollow ugc">TDNS</a>).</p>
<aside class="quote no-group" data-username="wsvall" data-post="14" data-topic="13311">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/wsvall/48/14315_2.png" class="avatar"> wsvall:</div>
<blockquote>
<p>разолвинг в идеале лучше исправлять, чтобы провайдер не видел бардака в моих запросах или можно забить?</p>
</blockquote>
</aside>
<p>Провайдер может применять DNS спуфинг для блокировок (вроде бы по данным OONI probe применяется у 0.3% абонентов), а виндовс резолвер разослав паралельные запросы возмёт тот, который пришёл раньше всего (не проверял, но это самая простая реализация, в TDNS, например, происходит агрегация).<br>
Так же возможен отказ в обслуживании некоторых сервисов которые пытаются определить ваш регион (сам не знаю таких, которые применяют DNS leak test).</p>
<aside class="quote no-group" data-username="wsvall" data-post="14" data-topic="13311">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/wsvall/48/14315_2.png" class="avatar"> wsvall:</div>
<blockquote>
<p>У меня цель, максимально скрыть использование впн.</p>
</blockquote>
</aside>
<p>От статистического анализа это сложно скрыть, а от текущих возможностей ТСПУ в РФ вроде бы пока хватает подстановки мимикрирующих заголовочных байтов рукопожатия (мне по крайней мере точно).</p></td><td>2024-12-24T12:28:15.189Z</td></tr>
    </table>
      </body>
    </html>