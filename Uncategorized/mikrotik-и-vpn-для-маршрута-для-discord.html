
    <html>
      <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <style>
    th, td {
      border: 1px solid black;
      border-collapse: collapse;
    }
    th, td {
      word-wrap: break-word;
      padding: 5px;
    }
    table {
      width: 100%;
      max-width: 100%;
      border: 1px solid black;
      border-collapse: collapse;
      table-layout: fixed;
      word-wrap: break-word
    }
    code {
      word-wrap: break-word;
    }
    pre {
        white-space: pre-wrap;
    }
    </style>
        <title>mikrotik-и-vpn-для-маршрута-для-discord</title>
      </head>
      <body>
        <table border="1" width="100%" cellpadding="5">
          <tr>
            <th style="width: 10%;">Ник</th>
            <th>Пост</th>
            <th style="width: 10%;">Дата</th>
          </tr>
    <tr><td>karasd13(Karasd13)</td><td><p>Mikrotik hap ax2 подключал 2 варианта Vpn:WG и L2tp ipsec<br>
Настроил добавление адресов по TLS host<br>
Но подключение в голосовым RTC-Серверам не работает</p>
<p>Буду рад если подскажете</p></td><td>2024-12-29T16:56:21.858Z</td></tr><tr><td>Xunlei</td><td><p>Я себе добавил <code>66.22.208.0/20</code> (AS49544 i3Dnet) в тунель. Там 4-5 пакетов всего пробежит и соединения с комнатами устанавливается.</p></td><td>2024-12-29T17:00:53.896Z</td></tr><tr><td>karasd13(Karasd13)</td><td><p>Немного нуб, Можешь команду для терминала написать или скрин настройки скинуть</p></td><td>2024-12-29T17:02:51.408Z</td></tr><tr><td>Xunlei</td><td><p>Не знаю, микротиками не пользуюсь. Проблема скорее не связана с микротиком.</p></td><td>2024-12-29T17:04:26.291Z</td></tr><tr><td>karasd13(Karasd13)</td><td><p>Скорей всего с вязано с настройками, где-то ошибаюсь с настройкой. Так как если пустить весь трафик. То все работает. А так как я ленивый и хочется упростить добавление и обновление address list<br>
Хочу настроить автоматическое добавление</p></td><td>2024-12-29T17:13:50.228Z</td></tr><tr><td>Xunlei</td><td><p>Наверняка на устройстве есть таблица маршрутов, создайте правило для подсети <code>66.22.208.0/20</code> пустив его через тунель.</p></td><td>2024-12-29T17:17:14.263Z</td></tr><tr><td>karasd13(Karasd13)</td><td><p>Это уже сделал. Все равно 0 реакции<br>
Читая о такой проблеме, пишут что RTC-сервер стучится по UDP и как его маршрутизацию сделать не нашел</p></td><td>2024-12-29T17:28:29.802Z</td></tr><tr><td>Xunlei</td><td><p>Можно добавить <a href="https://github.com/GhostRooter0953/discord-voice-ips" rel="noopener nofollow ugc">эти</a> подсети или поймать куда дискорд лезет по udp в Wireshark или других утилитах.</p></td><td>2024-12-29T17:33:26.818Z</td></tr><tr><td>Texsis</td><td><p>Адреса в адрес лист закидываются? Если в адрес лист то нужно добавить диапазон в адрес лист вручную и тогда будет неважно tcp или udp траффик.</p></td><td>2024-12-29T19:09:07.774Z</td></tr><tr><td>karasd13(Karasd13)</td><td><p>Адреса закидываются.<br>
Пробовал через Laer 7, что-не пошло</p></td><td>2024-12-29T19:30:52.100Z</td></tr><tr><td>hdrover</td><td><p>Немного не в тему, но можете попробовать мою программу в режиме direct через установщик. Голос должен заработать.</p><aside class="onebox allowlistedgeneric" data-onebox-src="https://github.com/hdrover/discord-drover/releases/tag/v0.8">
  <header class="source">
      <img src="https://ntc.party/uploads/default/original/2X/b/bad3e5f9ad67c1ddf145107ce7032ac1d7b22563.svg" class="site-icon" data-dominant-color="" width="32" height="32">

      <a href="https://github.com/hdrover/discord-drover/releases/tag/v0.8" target="_blank" rel="noopener nofollow ugc">GitHub</a>
  </header>

  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:690/344;"><img src="mikrotik-и-vpn-для-маршрута-для-discord/bea3dbf734ece73234a10e9b9ef98490093dafe6_2_690x345.png" class="thumbnail" data-dominant-color="F7F8F3" width="690" height="345"></div>

<h3><a href="https://github.com/hdrover/discord-drover/releases/tag/v0.8" target="_blank" rel="noopener nofollow ugc">Release drover v0.8 · hdrover/discord-drover</a></h3>

  <p>Added support for CANARY and PTB versions.
Added Direct mode to the installer, allowing users to bypass voice chat restrictions without using a proxy.</p>


  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>
</td><td>2024-12-29T19:42:29.177Z</td></tr><tr><td>karasd13(Karasd13)</td><td><p>Так, и запрет можно поставить. Хочу разобраться как настроить автоматизацию добавления ip из UDP трафика на MikroTik</p></td><td>2024-12-29T20:03:34.517Z</td></tr><tr><td>Texsis</td><td><p>А он не к домену подключается? У меня через dns static идет добавление ip адресов. Просто закидываю домены, а микрот сам резолвит и добавляет в адрес лист. Правда я голосовыми в дискорде не пользуюсь, но полагаю работать будет так же. Плюс он так же докидывает и поддомены, если домен в списке и соответственно их ip.</p></td><td>2024-12-29T20:55:28.771Z</td></tr><tr><td>karasd13(Karasd13)</td><td><p>Можешь расписать настройку, попробовал по одной из статей. Что-то не ппошло</p></td><td>2024-12-29T22:33:00.428Z</td></tr><tr><td>Texsis</td><td><p>Версия ros какая? Маршруты до туннеля есть? Напиши мне в личку, завтра постараюсь помочь.</p></td><td>2024-12-29T22:58:08.527Z</td></tr><tr><td>0ka(0ka)</td><td><p>нет, voice серверы не используют днс и по sni не сниффятся</p></td><td>2024-12-30T14:57:14.235Z</td></tr><tr><td>karasd13(Karasd13)</td><td><p>Вот и ищу как с этим разобраться</p></td><td>2024-12-30T16:20:51.176Z</td></tr><tr><td>Texsis</td><td><p>Тогда получается следующее, нужно добавить как писали выше 66.22.208.0/20 вручную в адрес лист, пример на скрине, как у меня сделано<br>
<div class="lightbox-wrapper"><a class="lightbox" href="mikrotik-и-vpn-для-маршрута-для-discord/4f37e53b874fc8c1d2949b43ade52dea8f1cef73.png" data-download-href="https://ntc.party/uploads/default/4f37e53b874fc8c1d2949b43ade52dea8f1cef73" title="image"><img src="mikrotik-и-vpn-для-маршрута-для-discord/4f37e53b874fc8c1d2949b43ade52dea8f1cef73.png" alt="image" data-base62-sha1="biNtub0f5d4IXlZZg8SHn9CVTAD" width="690" height="352" data-dominant-color="E7E7EB"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">1153×589 36 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div><br>
Вот хорошая статья <a href="https://habr.com/ru/articles/775110/" class="inline-onebox" rel="noopener nofollow ugc">Точечная маршрутизация на Mikrotik: BGP и Address lists + Mangle. Реализация через домены / Хабр</a></p></td><td>2024-12-30T16:47:03.491Z</td></tr><tr><td>karasd13(Karasd13)</td><td><p>Добавление ip результата не дает.<br>
BGP надо статик ip оплачивать, плюс писать скрипт для выгрузки в адрес лист.<br>
Пробовал без mangle, только сайт открыл и все дальше не ступор приложение тоже не грузит.</p>
<p>Буду искать инфу, как завернуть UPD трафик в VPN</p></td><td>2024-12-31T00:15:12.954Z</td></tr><tr><td>0ka(0ka)</td><td><p>когда пишут ip диапазоны дискорда то там только голосовые сервера, без адресов сайта и приложения.</p></td><td>2024-12-31T06:53:34.913Z</td></tr><tr><td>Texsis</td><td><aside class="onebox allowlistedgeneric" data-onebox-src="https://interface31.ru/tech_it/2022/04/nastroyka-wireguard-vpn-na-routerah-mikrotik.html">
  <header class="source">
      <img src="https://ntc.party/uploads/default/original/2X/6/69f60815a26f3bc7245367f342801c2371f32c76.svg" class="site-icon" data-dominant-color="" width="86" height="86">

      <a href="https://interface31.ru/tech_it/2022/04/nastroyka-wireguard-vpn-na-routerah-mikrotik.html" target="_blank" rel="noopener nofollow ugc">Записки IT специалиста</a>
  </header>

  <article class="onebox-body">
    <img width="320" height="320" src="mikrotik-и-vpn-для-маршрута-для-discord/7e38b334b96a44d6627c857ae4ead4adcdb2510a.png" class="thumbnail onebox-avatar" data-dominant-color="A7A49C">

<h3><a href="https://interface31.ru/tech_it/2022/04/nastroyka-wireguard-vpn-na-routerah-mikrotik.html" target="_blank" rel="noopener nofollow ugc">Настройка WireGuard VPN на роутерах Mikrotik</a></h3>

  <p>Рассматривая настройку WireGuard в наших предыдущих материалах, мы намеренно не касались Mikrotik, запланировав для этого отдельную статью. И для этого есть свои причины. RouterOS, под управлением которой работают данные устройства, имеет свои...</p>


  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>
<p>
А вот тут к концу статьи</p></td><td>2024-12-31T11:12:44.671Z</td></tr><tr><td>nzkhammatov(Ainur Khammatov)</td><td><aside class="quote no-group" data-username="karasd13" data-post="1" data-topic="14226">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/karasd13/48/14551_2.png" class="avatar"> karasd13:</div>
<blockquote>
<p>Буду рад если подскажете</p>
</blockquote>
</aside>
<p><strong>Попробуйте</strong></p>
<pre data-code-wrap="bash"><code class="lang-bash">clear
comment="discord"
gateway="antizapret-tcp-gateway"
echo "IPv4 Prefixes | Mikrotik"
echo -e "\u2193"
echo "===================================================================================================="
echo "/ip route remove [find comment=$comment]"
curl -s https://raw.githubusercontent.com/sdnv0x4d/ip-lists/refs/heads/master/discord/discord_cidr_sum.txt | \
awk '!seen[$0]++' | \
grep -E '^[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+(/[0-9]+)?$' | \
while read -r cidr; do
    echo "/ip route add comment=$comment dst-address=$cidr gateway=$gateway"
done
echo "/put \"\\n\""
echo "===================================================================================================="
</code></pre>
<p><strong>Редактируйте комментарий и название интерфейса</strong></p>
<pre data-code-wrap="bash"><code class="lang-bash">comment="discord"
gateway="antizapret-tcp-gateway"
</code></pre>
<p><strong>Источник</strong></p>
<blockquote>
<p><a href="https://github.com/sdnv0x4d/ip-lists" class="inline-onebox" rel="noopener nofollow ugc">GitHub - sdnv0x4d/ip-lists: IP lists of Discord, Steam etc... Network engineers against RKN</a></p>
</blockquote></td><td>2024-12-31T11:23:06.021Z</td></tr><tr><td>karasd13(Karasd13)</td><td><p>Настроить удалость. На WG и то добавив список адресов.<br>
L2tp iPsec где-то не правильно настраиваю.</p>
<p>Но в идеале хочется через такое правило настроить голосовые чаты:</p>
<p>IP / FIREWALL / MANGLE (верх списка)</p>
<ul>
<li>
<p>создаем первое правило Prerouting, где src - ваша локалка, протокол: tcp, порт: 443;<br>
вкладка Advanced - поле TLS host: *.instagram.com;<br>
вкладка Action - add dst to address list; addresslist - viaVPN; таймаут можно поставить 7 дней;</p>
</li>
<li>
<p>создаем второе правило Prerouting, где src - ваша локалка, протокол: tcp, порт: 443;<br>
вкладка Advanced - поле TLS host: *.cdninstagram.com;<br>
вкладка Action - add dst to address list; addresslist - viaVPN; таймаут можно поставить 7 дней;</p>
</li>
</ul>
<p>IP / FIREWALL / MANGLE (низ списка)</p>
<ul>
<li>создаем правило Prerouting, где src - ваша локалка; dst. address list: viaVPN<br>
вкладка Action - route; Route Dst: IP сервера wireguard, openvpn и т.д.</li>
</ul></td><td>2025-01-03T08:24:53.734Z</td></tr><tr><td>Longy(Hans)</td><td><p>Ни разу не встретил у себя проблем с l2tp/ipsec</p></td><td>2025-01-03T13:21:07.623Z</td></tr><tr><td>karasd13(Karasd13)</td><td><p>Проблема только с подключением к голосовым чатам Discord<br>
Где-то настройку упускаю</p></td><td>2025-01-05T01:14:02.687Z</td></tr><tr><td>Longy(Hans)</td><td><p>Сам себе…</p></td><td>2025-01-06T17:00:11.432Z</td></tr><tr><td>Longy(Hans)</td><td><p>L2TP/IPSec поднимается канал вообще или нет?</p>
<p>У меня по-другому завернут траффик в vpn, через “mark routing” с использованием “Dst. Address List”.</p>
<p>Попробуйте добавить, по вашему методу, протокол UDP в обработку с диапазоном портов: 50000-65535**</p>
<p>**Динамические порты UDP в диапазоне от 50 000 до 65 535 для голосовой связи.</p></td><td>2025-01-06T17:03:04.340Z</td></tr>
    </table>
      </body>
    </html>