
    <html>
      <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <style>
    th, td {
      border: 1px solid black;
      border-collapse: collapse;
    }
    th, td {
      word-wrap: break-word;
      padding: 5px;
    }
    table {
      width: 100%;
      max-width: 100%;
      border: 1px solid black;
      border-collapse: collapse;
      table-layout: fixed;
      word-wrap: break-word
    }
    code {
      word-wrap: break-word;
    }
    pre {
        white-space: pre-wrap;
    }
    </style>
        <title>странная-работа-vless-tcp-reality</title>
      </head>
      <body>
        <table border="1" width="100%" cellpadding="5">
          <tr>
            <th style="width: 10%;">Ник</th>
            <th>Пост</th>
            <th style="width: 10%;">Дата</th>
          </tr>
    <tr><td>notcvnt</td><td><p>Всем здраствуйте! Уже не знаю что делать кому и куда писать и обращаться, поэтому хочу выложить своб проблему здесь.</p>
<p><strong>И так, что дано:</strong><br>
Два сервера<br>
ПК на windows<br>
Мобильное устройство<br>
Macbook</p>
<p><strong>Суть проблемы:</strong></p>
<p>Некоторые сайты (<a href="http://microsoft.com" rel="noopener nofollow ugc">microsoft.com</a> например) не открываются, ошибка PR_END_OF_FILE_ERROR. А так же не могу выбрать аккаунт google для захода на сайтах, например, захожу на picsart (не реклама, пример сайта, проблема на любом сайте где можно зарегестрироваться или войти через google), нажимаю Log in, выбираю через аккаунт google, прогружается страница выбора аккаунтов, но при нажатии на аккаунт ничего не происходит. <a href="http://drive.google.com" rel="noopener nofollow ugc">drive.google.com</a> постоянно думает что я оффайн, <a href="http://mail.google.com" rel="noopener nofollow ugc">mail.google.com</a> работает, но при нажатии на аватарку, чтобы сменить аккаунт ничего не происходит, пришет ошибку Opps! We can’t download image that you selected. Иконка кнопки лайка (исключительно лайка, с дизайлоком всё ок) отсутствует, но нажимается и засчитывается.<br>
При отключении от vpn эти проблемы исчезают</p>
<p><strong>Что я пробовал:</strong></p>
<p>Начнём с клиентов, пробовал nekobox, Hiddify и Amnezia, проблема индентична на любом и устроиств.<br>
Теперь сервера, сервера не относится друг к другу никаким образом, они у разных хостеров, в разных странах, проблема сохраняется (панель 3x-ui на обоих).<br>
Пробовал кидать сайт google через warp, проблему не исправляет, google видит меня через warp.<br>
Купил домен, привязал к cloudflare, и к 1-му серверу, сертификаты для панели получил через комманду x-ui в консоль и выбор получения сертификата через Cloudflare SSL, если заходить через домен в панель - то никаких ошибок нету, всё работает как часы.<br>
От провайдера тоже не зависит как я понял, пробовал через дом.ру (проводной), ростелеком (проводной), раздачу через точку доступа Мегафон (он только торренты не даёт качать, а на остальное ему фиолетово, я через точку доступа по 200gb в месяц качаю).<br>
При подключении к 2 серверу проблемы остаються.<br>
На 1-ом сервере sni <a href="http://ign.com" rel="noopener nofollow ugc">ign.com</a><br>
На 2-ом сервере sni local.se<br>
На обоих порт 443.<br>
flow=xtls-rprx-vision<br>
Пробовал через приватные окна - ничего не изменилось.<br>
Пробовал повторить всё то же самое через firefox, edge, safari - результата ноль.<br>
Пробовал откатить версии панели - тоже ничего<br>
На 1 сервере включин BBR, на 2-ом нет (ничего не трогал)<br>
Пробовал смотреть логи в браузерах, в клиентах, на сервере - пусто, лишь сообщения о том что “Я подключился” в случае клиента или “Ко мне подключились” в случае сервера.<br>
Пробовал обновлять ubuntu - результата ноль<br>
Перезаупск xray, панели, сервера или всё вместе тоже результатов не даёт</p>
<p>Вот пример пингов<br>
1-ый сервер:</p>
<pre><code class="lang-auto">
root@"Тут название сервера": ping microsoft.com
PING microsoft.com (20.76.201.171) 56(84) bytes of data.
64 bytes from 20.76.201.171 (20.76.201.171): icmp_seq=1 ttl=114 time=30.9 ms
64 bytes from 20.76.201.171 (20.76.201.171): icmp_seq=2 ttl=114 time=30.1 ms
64 bytes from 20.76.201.171 (20.76.201.171): icmp_seq=3 ttl=114 time=30.1 ms
64 bytes from 20.76.201.171 (20.76.201.171): icmp_seq=4 ttl=114 time=30.6 ms
64 bytes from 20.76.201.171 (20.76.201.171): icmp_seq=5 ttl=114 time=30.3 ms
64 bytes from 20.76.201.171 (20.76.201.171): icmp_seq=6 ttl=114 time=30.2 ms
64 bytes from 20.76.201.171 (20.76.201.171): icmp_seq=7 ttl=114 time=30.4 ms
64 bytes from 20.76.201.171 (20.76.201.171): icmp_seq=8 ttl=114 time=30.5 ms
64 bytes from 20.76.201.171 (20.76.201.171): icmp_seq=9 ttl=114 time=30.2 ms
^C
--- microsoft.com ping statistics ---
9 packets transmitted, 9 received, 0% packet loss, time 8011ms
rtt min/avg/max/mdev = 30.078/30.377/30.938/0.266 ms
</code></pre>
<p>ping с cmd на Windows машине:</p>
<pre><code class="lang-auto">
C:\Users\*&gt;ping microsoft.com

Pinging microsoft.com [20.236.44.162] with 32 bytes of data:
Reply from 20.236.44.162: bytes=32 time&lt;1ms TTL=64
Reply from 20.236.44.162: bytes=32 time&lt;1ms TTL=64
Reply from 20.236.44.162: bytes=32 time&lt;1ms TTL=64
Reply from 20.236.44.162: bytes=32 time&lt;1ms TTL=64

Ping statistics for 20.236.44.162:
    Packets: Sent = 4, Received = 4, Lost = 0 (0% loss),
Approximate round trip times in milli-seconds:
    Minimum = 0ms, Maximum = 0ms, Average = 0ms
</code></pre>
<p>И что самое странное, такое поведение началось относительно недавно. Раньше у обоих хостеров всё работало как часы, а теперь что-то не так, я уже не знаю что делать и куда смотреть. Хочу услышать более умных людей в этой сфере.</p>
<p>P.S вариант что хостеры плохие скорее всего не релевантен. Ибо 2-ой сервер хоститься у Амазона напрямую, без посредников</p>
<p>P.S.S Если кто-нибудь скинет нормальный, хороший и подробный гайд как организовать steal oneself + vless tcp Reality буду безмерно благодарен, ибо я нашёл только на китайском и как-то очень не понятно.</p></td><td>2024-12-16T01:46:42.670Z</td></tr><tr><td>PlavaliZnaem( )</td><td><aside class="quote no-group" data-username="notcvnt" data-post="1" data-topic="13827">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/notcvnt/48/14848_2.png" class="avatar"> notcvnt:</div>
<blockquote>
<p>Если кто-нибудь скинет нормальный, хороший и подробный гайд как организовать steal oneself</p>
</blockquote>
</aside>
<p>Хороший и нормальный вряд ли. Возьмите отсюда: <a href="https://ntc.party/t/%D0%BA%D0%B0%D0%BA-%D0%BF%D0%BE%D1%81%D1%82%D0%B0%D0%B2%D0%B8%D1%82%D1%8C-%D0%B2%D0%B5%D0%B1-%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80-%D0%B8-vless-%D0%BD%D0%B0-%D0%BE%D0%B4%D0%BD%D0%BE%D0%BC-vps/13773/14" class="inline-onebox">Как поставить веб-сервер и VLESS на одном VPS? - #14 by aggravatingbee</a></p>
<p>Либо как вариант готовый скрипт от Кортеза. Мне он не зашел почему-то</p></td><td>2024-12-16T03:53:34.320Z</td></tr><tr><td>xofamim548</td><td><p>ipv6 отключен на сервере? Была похожая проблема из-за него.</p>
<p>Также в теории может быть проблема из-за неправильно прописанных DNS на вашем VPS (но сомнительно). Гуглите для своей системы и проверяйте, у меня везде выставлены 8.8.8.8 и 4.4.4.4.</p>
<aside class="quote no-group" data-username="notcvnt" data-post="1" data-topic="13827">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/notcvnt/48/14848_2.png" class="avatar"> notcvnt:</div>
<blockquote>
<p>Если кто-нибудь скинет нормальный, хороший и подробный гайд как организовать steal oneself + vless tcp Reality буду безмерно благодарен, ибо я нашёл только на китайском и как-то очень не понятно.</p>
</blockquote>
</aside>
<p>Вот <a href="https://gist.github.com/bioros/c3327c8ab86cbc985fac1feb2693d415">здесь</a> описан процесс установки с сервером Caddy.</p></td><td>2024-12-16T09:15:11.560Z</td></tr><tr><td>0ka(0ka)</td><td><p>А если отключить сниффинг в inbound x-ui?</p></td><td>2024-12-16T09:15:14.586Z</td></tr><tr><td>slq</td><td><p>Если два сервера, то может на одном что-то другое поднять. SS; vless + xtls/tls; вместо tcp поставить grpc/websocket и т.д.</p></td><td>2024-12-16T09:20:27.561Z</td></tr><tr><td>notcvnt</td><td><aside class="quote no-group" data-username="xofamim548" data-post="3" data-topic="13827">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/x/a698b9/48.png" class="avatar"> xofamim548:</div>
<blockquote>
<p>ipv6 отключен на сервере? Была похожая проблема из-за него.</p>
</blockquote>
</aside>
<p>Выключил через добавление в /etc/sysctl.conf строк</p>
<pre><code class="lang-auto">net.ipv6.conf.all.disable_ipv6 = 1
net.ipv6.conf.default.disable_ipv6 = 1
net.ipv6.conf.lo.disable_ipv6 = 1
</code></pre>
<p>Проблема осталась</p>
<aside class="quote no-group" data-username="xofamim548" data-post="3" data-topic="13827">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/x/a698b9/48.png" class="avatar"> xofamim548:</div>
<blockquote>
<p>Также в теории может быть проблема из-за неправильно прописанных DNS на вашем VPS (но сомнительно). Гуглите для своей системы и проверяйте, у меня везде выставлены 8.8.8.8 и 4.4.4.4.</p>
</blockquote>
</aside>
<p>На клиентах (пк, мобильный и т.д) у меня очень давно стоят либо 1.1.1.1 либо гугловские днс,<br>
В интеренет пишут изменять dns в /etc/network/interfaces. У меня ubuntu 22.<br>
Вот так выглядит конфиг, я его не менял</p>
<pre><code class="lang-auto">iface ens3 inet static
    address   176.тут.ип.vps'ки
    netmask   255.255.255.255
    gateway   10.0.0.1
    hwaddress ether **:**:**:**:**:**
    dns-nameservers 8.8.8.8 1.1.1.1
iface ens3 inet6 static
    address   ****:****:****::2
    netmask   48
    gateway   2a12:5940:8f2d::1
    dns-nameservers 8.8.8.8 1.1.1.1
</code></pre>
<p>То есть гугловские dns стояли ещё при создании vps</p>
<aside class="quote no-group" data-username="xofamim548" data-post="3" data-topic="13827">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/x/a698b9/48.png" class="avatar"> xofamim548:</div>
<blockquote>
<p>Вот <a href="https://gist.github.com/bioros/c3327c8ab86cbc985fac1feb2693d415" rel="noopener nofollow ugc">здесь </a> описан процесс установки с сервером Caddy.</p>
</blockquote>
</aside>
<p>Спасибо большое, посмотрю</p>
<aside class="quote no-group" data-username="PlavaliZnaem" data-post="2" data-topic="13827">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/plavaliznaem/48/8180_2.png" class="avatar"> PlavaliZnaem:</div>
<blockquote>
<p>Возьмите отсюда: <a href="https://ntc.party/t/%D0%BA%D0%B0%D0%BA-%D0%BF%D0%BE%D1%81%D1%82%D0%B0%D0%B2%D0%B8%D1%82%D1%8C-%D0%B2%D0%B5%D0%B1-%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80-%D0%B8-vless-%D0%BD%D0%B0-%D0%BE%D0%B4%D0%BD%D0%BE%D0%BC-vps/13773/14">Как поставить веб-сервер и VLESS на одном VPS? - #14 by aggravatingbee </a></p>
</blockquote>
</aside>
<p>Спасибо, посмотрю</p></td><td>2024-12-16T10:48:29.723Z</td></tr><tr><td>notcvnt</td><td><aside class="quote no-group" data-username="0ka" data-post="4" data-topic="13827" data-full="true">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/0/d78d45/48.png" class="avatar"> 0ka:</div>
<blockquote>
<p>А если отключить сниффинг в inbound x-ui?</p>
</blockquote>
</aside>
<p>Помогло!<br>
Сайт microsoft начал открываться, <a href="http://drive.google.com" rel="noopener nofollow ugc">drive.google.com</a> перестал думать что я оффлайн, и заход через аккаунт google на другие сайты заработал.</p>
<p>Но перестаёт работать routing (очевидно), т.е ру ip более не проксируется, так не сойдёт. Вариант что на клиенте настроить в обход тоже не пойдёт, ибо этим vps ещё иногда родственники пользуются, а ехать к каждому чтобы поправить это такое. + какая-то проблема с macos, никакие клиенты v2box, amnezia в тупую не хотят роутить вообще ничего и никак и никуда. И мне собственно проще через warp гонять ру ip на сервере</p>
<p>Потыкав sniffing я понял что данная проблема появляется если поставить чекбокс около TLS. А QUIC, HTTP или FakeDNS вообще в данном случае не влияют. Есть ли варианты решения?</p></td><td>2024-12-16T11:10:20.058Z</td></tr><tr><td>notcvnt</td><td><aside class="quote no-group" data-username="slq" data-post="5" data-topic="13827">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/s/e68b1a/48.png" class="avatar"> slq:</div>
<blockquote>
<p>может на одном что-то другое поднять</p>
</blockquote>
</aside>
<p>Вариант звучит хорошо, а на практике…<br>
SS, outline или что-то иное сразу нет, ибо оно уже детектиться ТСПУ, я не хочу получать бан ип на vps’ку из-за старых протоколов. Я читал здесь же на форуме что так делать вообще не стоит, если Вам интересно могу найти пост и скинуть</p>
<aside class="quote no-group" data-username="slq" data-post="5" data-topic="13827">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/s/e68b1a/48.png" class="avatar"> slq:</div>
<blockquote>
<p>vless + xtls/tls</p>
</blockquote>
</aside>
<p>Оба сервера стояли на vless tcp reality, tls не вижу смысла ибо он имеет недостатки в сравнении от Reality.</p>
<p>Я пытался новомодный XHTTP + reality поставить но что-то не пошло, коннекта нету, статей кроме как на гитхабе не нашёл (в issue на оригинальном xray-core висит статья), на гитхабе хоть и обновили её, но я видимо что-то не так делаю.</p>
<p>Пока известно что sniffing делает проблемы с доступом на сайт или их поломку. Как домой приеду попробую на 2 сервак без sniffing поставить vless tcp reality и на те сайты что не работают routing поставлю с 1-го на 2-ой</p></td><td>2024-12-16T11:19:11.573Z</td></tr><tr><td>0ka(0ka)</td><td><p>эта проблема эта уже старая, убедись что все обновлено, еще посмотри есть ли настройка route-only рядом со sniffing и включи обе. и по мне так роутинг .ru в warp это для параноиков, как и отказ от tls в пользу reality.</p>
<aside class="quote no-group" data-username="notcvnt" data-post="7" data-topic="13827">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/notcvnt/48/14848_2.png" class="avatar"> notcvnt:</div>
<blockquote>
<p>Но перестаёт работать routing (очевидно), т.е ру ip более не проксируется</p>
</blockquote>
</aside>
<p>перестаёт работать роутинг по доменам, роутинг по ip не требует sniffing</p></td><td>2024-12-16T11:39:48.110Z</td></tr><tr><td>notcvnt</td><td><aside class="quote no-group" data-username="0ka" data-post="9" data-topic="13827">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/0/d78d45/48.png" class="avatar"> 0ka:</div>
<blockquote>
<p>убедись что все обновлено</p>
</blockquote>
</aside>
<p>Панель 3x-ui версии 2.4.8 (последняя на данный момент).<br>
sudo apt update говорит что All packages are up to date.<br>
Если есть информация как обновить xray для панели 3x-ui буду благодарен (xray как-будто в контейнере docker, потому что в системе он не установлен, при попытки ввести xray в консоль выводиться xray: command not found), а версия в панели отстаёт от релизной xray.</p>
<aside class="quote no-group" data-username="0ka" data-post="9" data-topic="13827">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/0/d78d45/48.png" class="avatar"> 0ka:</div>
<blockquote>
<p>еще посмотри есть ли настройка route-only рядом со sniffing и включи обе</p>
</blockquote>
</aside>
<p>Есть, но я попробовал все варианты, при любых настройках, даже если включить metadata only или route only или всё вместе то оно не работает то тех пор, пока я не уберу TLS или не выключу sniffing.</p>
<aside class="quote no-group" data-username="0ka" data-post="9" data-topic="13827">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/0/d78d45/48.png" class="avatar"> 0ka:</div>
<blockquote>
<p>перестаёт работать роутинг по доменам, роутинг по ip не требует sniffing</p>
</blockquote>
</aside>
<p>geoip:ru в warp без этой настройки перестаёт заворачиваться к сожалению.</p>
<aside class="quote no-group quote-modified" data-username="0ka" data-post="9" data-topic="13827">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/0/d78d45/48.png" class="avatar"> 0ka:</div>
<blockquote>
<p>Отказ от tls</p>
</blockquote>
</aside>
<p>Как я помню от tls отказались из-за того что требуется свой домен и немного минусов ещё сверху. Странно ведь выглядит на сайт <a href="http://vasyapupkin.com" rel="noopener nofollow ugc">vasyapupkin.com</a> качать по 250-300 gb трафика в месяц, наводит на некоторые мысли регуляторов, а Reality позволяет прикидываться под любой сайт, что выглядит более легитимно, что условно я с сайта мелкомягких или гугл или иных сайтов качаю много трафика. Хоть и вызовет вопросы почему мелкомягкие хостяться где-то у чёрта на куличиках, но в данном случае будет всё таки проще потом поменять с сайта мелкомягких на другой. Но это моё мнение. Я думаю все плюшки TLS и Reality можно собрать если настраивать Reality с steal oneself.</p>
<aside class="quote no-group" data-username="0ka" data-post="9" data-topic="13827">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/0/d78d45/48.png" class="avatar"> 0ka:</div>
<blockquote>
<p>мне так роутинг .ru в warp это для параноиков</p>
</blockquote>
</aside>
<p>Так и есть, закон Яровой не просто так существует. Я бы хотя бы минимум вк, госуслуги и яндекс заворачивал в warp. Ибо в Китае если такого не делать и ходить по .cn сайтам, то vps умрёт чуть быстрее чем моментально (banip, бан порта и другие виды надругательств).</p></td><td>2024-12-16T12:05:33.361Z</td></tr><tr><td>vint2k(Vint2k)</td><td><aside class="onebox githubissue" data-onebox-src="https://github.com/XTLS/Xray-core/issues/4033">
  <header class="source">

      <a href="https://github.com/XTLS/Xray-core/issues/4033" target="_blank" rel="noopener nofollow ugc">github.com/XTLS/Xray-core</a>
  </header>

  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Issue" data-github-private-repo="false">
	  <svg width="60" height="60" class="github-icon" viewBox="0 0 14 16" aria-hidden="true"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="https://github.com/XTLS/Xray-core/issues/4033" target="_blank" rel="noopener nofollow ugc">VLESS+Reality and intermediate server configuration</a>
    </h4>

    <div class="github-info">
      <div class="date">
        opened <span class="discourse-local-date" data-format="ll" data-date="2024-11-19" data-time="23:05:12" data-timezone="UTC">11:05PM - 19 Nov 24 UTC</span>
      </div>


      <div class="user">
        <a href="https://github.com/vint2k" target="_blank" rel="noopener nofollow ugc">
          <img alt="vint2k" src="странная-работа-vless-tcp-reality/ec95e8d16e8bb5f928cd63654fde97523b9d57df.jpeg" class="onebox-avatar-inline" width="20" height="20" data-dominant-color="705C5A">
          vint2k
        </a>
      </div>
    </div>

    <div class="labels">
    </div>
  </div>
</div>

  <div class="github-row">
    <p class="github-body-container">### Integrity requirements

- [X] I confirm that I have read the documentation<span class="show-more-container"><a href="" rel="noopener" class="show-more">…</a></span><span class="excerpt hidden">, understand the meaning of all the configuration items I wrote, and did not pile up seemingly useful options or default values.
- [X] I provided the complete config and logs, rather than just providing the truncated parts based on my own judgment.
- [X] I searched issues and did not find any similar issues.
- [X] The problem can be successfully reproduced in the latest Release

### Description

When using VLESS+Reality and a configuration with an intermediate server (XRay_Client &lt;- VLESS+Reality -&gt; XRay_Server1 &lt;- VLESS+Reality -&gt; XRay_Server2), some services work very inconsistently.
For example, https://console.firebase.google.com/ refuses to load, or parts of its functionality become unavailable.

Enabling or disabling sniffing, does not change the situation.

However, if the classic configuration with a single XRay server is used (XRay_Client &lt;- VLESS+Reality -&gt; XRay_Server2), such issues do not occur.

### Reproduction Method

Create configuration: **XRay_Client &lt;- VLESS+Reality -&gt; XRay_Server1 &lt;- VLESS+Reality -&gt; XRay_Server2**
and go to https://console.firebase.google.com/

### Client config

N/A

### Server config

&lt;details&gt;&lt;summary&gt;XRay_server1 conf&lt;/summary&gt;&lt;pre&gt;&lt;code&gt;
{
  "inbounds": [
    {
      "listen": "0.0.0.0",
      "port": 443,
      "protocol": "vless",
      "settings": {
        "clients": [
          {
            "email": "client",
            "flow": "xtls-rprx-vision",
            "id": "&lt;- UUID -&gt;"
          }
        ],
        "decryption": "none"
      },
      "streamSettings": {
        "network": "tcp",
        "realitySettings": {
          "dest": "&lt;- dest domain:port -&gt;",
          "maxClient": "",
          "maxTimediff": 0,
          "minClient": "",
          "privateKey": "&lt;- private key -&gt;",
          "serverNames": [
            "&lt;- dest domain -&gt;"
          ],
          "shortIds": [
            ""
          ],
          "show": true,
          "xver": 0
        },
        "security": "reality"
      },
      "tag": "inbound-443"
    }
  ],
  "outbounds": [
    {
      "tag": "xray2",
      "protocol": "vless",
      "settings": {
        "vnext": [
          {
            "address": "&lt;- dest domain/IP -&gt;",
            "port": 443,
            "users": [
              {
                "id": "&lt;- UUID -&gt;",
                "flow": "xtls-rprx-vision",
                "encryption": "none"
              }
            ]
          }
        ]
      },
      "streamSettings": {
        "network": "tcp",
        "security": "reality",
        "realitySettings": {
          "publicKey": "&lt;- public key -&gt;",
          "fingerprint": "chrome",
          "serverName": "&lt;- dest domain -&gt;",
          "shortId": "",
          "spiderX": "/"
        }
      }
    }
  ]
}
&lt;/code&gt;&lt;/pre&gt;&lt;/details&gt;
&lt;details&gt;&lt;summary&gt;XRay_server2 conf&lt;/summary&gt;&lt;pre&gt;&lt;code&gt;
{
  "inbounds": [
    {
      "listen": "0.0.0.0",
      "port": 443,
      "protocol": "vless",
      "settings": {
        "clients": [
          {
            "email": "xray1",
            "flow": "xtls-rprx-vision",
            "id": "&lt;- UUID -&gt;"
          },
          {
            "email": "client",
            "flow": "xtls-rprx-vision",
            "id": "&lt;- UUID -&gt;"
          }
        ],
        "decryption": "none"
      },
      "streamSettings": {
        "network": "tcp",
        "realitySettings": {
          "dest": "&lt;- dest domain:port -&gt;",
          "maxClient": "",
          "maxTimediff": 0,
          "minClient": "",
          "privateKey": "&lt;- private key -&gt;",
          "serverNames": [
            "&lt;- dest domain -&gt;"
          ],
          "shortIds": [
            ""
          ],
          "show": true,
          "xver": 0
        },
        "security": "reality"
      },
      "tag": "inbound-443"
    }
  ],
  "outbounds": [
    {
      "tag": "direct",
      "protocol": "freedom"
    }
  ]
}
&lt;/code&gt;&lt;/pre&gt;&lt;/details&gt;

### Client log

N/A

### Server log

N/A</span></p>
  </div>

  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>
<p>
это проблема самого reality, часть сервисов могут работать через раз если трафик гнать через промежуточный сервер</p>
<p>если между серверами поднять vless+tls, то все работает</p>
<p>надо ждать фикс</p></td><td>2024-12-16T17:02:34.814Z</td></tr><tr><td>notcvnt</td><td><aside class="quote no-group" data-username="vint2k" data-post="11" data-topic="13827">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/vint2k/48/14028_2.png" class="avatar"> vint2k:</div>
<blockquote>
<p>если трафик гнать через промежуточный сервер</p>
</blockquote>
</aside>
<p>Я понял ты о чём, я так делал, у меня работало ровно так же. т.е сайт microsoft не открывался не при одном сценарии.</p>
<p>Видимо ты суть проблемы не понял, я не делаю связку Client —Vless+Reality—&gt; Server 1 —Vless+Reality—&gt; Server 2. Я 2-ой сервер использовал для теста, что проблема не в хостере или sni который я выбрал.</p>
<p>Я пока что ищу способ как реализовать затеяное, если будут результаты - отпишу</p></td><td>2024-12-16T17:42:38.974Z</td></tr><tr><td>vint2k(Vint2k)</td><td><p>да, прошу прощения<br>
формулировка про два сервера ввела в заблуждение</p>
<p>попробуй логи включить в режим debug и посмотреть error.log на наличие проблемных доменов</p></td><td>2024-12-17T06:56:38.093Z</td></tr><tr><td>Arch4Arts(Артур)</td><td><p>Проблема по идее стара как мир, странно что вы не искали по коду ошибки, <a href="https://ntc.party/t/%D0%BD%D0%B8%D0%B7%D0%BA%D0%B0%D1%8F-%D1%81%D0%BA%D0%BE%D1%80%D0%BE%D1%81%D1%82%D1%8C-%D0%BF%D1%80%D0%B8-%D0%B8%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B8-vless-reality/8259/56" class="inline-onebox">Низкая скорость при использовании VLESS + REALITY - #56 by Waffenrock</a></p></td><td>2024-12-17T11:32:17.598Z</td></tr><tr><td>notcvnt</td><td><p><strong>В итоге проблема была решена, была виновата geosite и geoip база Китая в панели 3x-ui, при её выключении всё нормально начинает работать. Это не проблема sniffing, это проблема баз данных загруженных в панель</strong></p>
<p><strong>Всем спасибо за помощь! И особенную благодарность <a class="mention" href="/u/0ka">@0ka</a></strong></p>
<aside class="quote no-group" data-username="vint2k" data-post="13" data-topic="13827">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/vint2k/48/14028_2.png" class="avatar"> vint2k:</div>
<blockquote>
<p>попробуй логи включить в режим debug и посмотреть error.log на наличие проблемных доменов</p>
</blockquote>
</aside>
<p>Проблема в том что логи что на стороне клиента, что на стороне сервера пустые. Единственное что характерно это ошибка 504 Bad gateway в nekobox.</p>
<aside class="quote no-group" data-username="Arch4Arts" data-post="14" data-topic="13827" data-full="true">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/letter_avatar_proxy/v4/letter/a/bc8723/48.png" class="avatar"> Arch4Arts:</div>
<blockquote>
<p>Проблема по идее стара как мир, странно что вы не искали по коду ошибки, <a href="https://ntc.party/t/%D0%BD%D0%B8%D0%B7%D0%BA%D0%B0%D1%8F-%D1%81%D0%BA%D0%BE%D1%80%D0%BE%D1%81%D1%82%D1%8C-%D0%BF%D1%80%D0%B8-%D0%B8%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B8-vless-reality/8259/56">Низкая скорость при использовании VLESS + REALITY - #56 by Waffenrock</a></p>
</blockquote>
</aside>
<p>Проблема как оказалось не в этом, к тому же я выше писал что</p>
<aside class="quote no-group" data-username="notcvnt" data-post="12" data-topic="13827">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="https://ntc.party/user_avatar/ntc.party/notcvnt/48/14848_2.png" class="avatar"> notcvnt:</div>
<blockquote>
<p>Я 2-ой сервер использовал для теста, что проблема не в хостере или sni который я выбрал.</p>
</blockquote>
</aside></td><td>2024-12-17T11:51:53.377Z</td></tr>
    </table>
      </body>
    </html>