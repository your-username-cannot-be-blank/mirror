
    <html>
      <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <style>
    th, td {
      border: 1px solid black;
      border-collapse: collapse;
    }
    th, td {
      word-wrap: break-word;
      padding: 5px;
    }
    table {
      width: 100%;
      max-width: 100%;
      border: 1px solid black;
      border-collapse: collapse;
      table-layout: fixed;
      word-wrap: break-word
    }
    code {
      word-wrap: break-word;
    }
    pre {
        white-space: pre-wrap;
    }
    </style>
        <title>уроки-вынесенные-из-отключения-интернета-в-казахстане-в-январе-2022-года-для-обхода-цензуры</title>
      </head>
      <body>
        <table border="1" width="100%" cellpadding="5">
          <tr>
            <th style="width: 10%;">Ник</th>
            <th>Пост</th>
            <th style="width: 10%;">Дата</th>
          </tr>
    <tr><td>tango</td><td><p>↓ English version is below ↓</p>
<h1><a name="h-2022-1" class="anchor" href="#h-2022-1"></a>Уроки, вынесенные из отключения интернета в Казахстане в январе 2022 года для обхода цензуры</h1>
<p>Интернет в Казахстане был недоступен большую часть дня, каждый день с 05.01.2022 по 10.01.2022. Но блокировка не была полной: люди в Казахстане и за его пределами находили способы хоть как-то устанавливать соединения. Хотя успех был лишь частичным, он показал, что отключение Интернета — не обязательно безнадежная ситуация. Существуют инструменты и методы, которые мы можем использовать в будущем.</p>
<p>Обсуждение случившегося:</p>
<ul>
<li><a href="https://ntc.party/t/network-shutdown-all-around-kazakhstan/1601" class="inline-onebox">Network shutdown, all around Kazakhstan</a></li>
<li><a href="https://github.com/net4people/bbs/issues/99" class="inline-onebox">Shutdown in Kazakhstan since 2022-01-05, with brief periods of connectivity · Issue #99 · net4people/bbs · GitHub</a></li>
<li><a href="https://www.accessnow.org/kazakhstan-internet-shutdowns-protests-almaty-timeline-whats-happening/" class="inline-onebox">Kazakhstan internet shutdowns and protests: Timeline</a></li>
</ul>
<p>Что удалось:</p>
<ul>
<li>Жители Казахстана быстро сообщили о моменте отключения (которое сначала было только в мобильных сетях). Исследователи со стороны (например, <a href="https://blog.cloudflare.com/internet-shut-down-in-kazakhstan-amid-unrest/">Cloudflare Radar</a>, <a href="https://ioda.caida.org/ioda/dashboard#lastView=overview&amp;view=inspect&amp;entity=country/KZ&amp;from=1641168000&amp;until=1642032000">CAIDA IODA</a>, <a href="https://labs.ripe.net/author/emileaben/the-kazakhstan-outage-as-seen-from-ripe-atlas/">Атлас RIPE</a>) смогли собрать данные о сетевой связности и отслеживать её изменения.</li>
<li>Жители Казахстана могли проводить тесты сети и сообщать о своих результатах в течение коротких периодов восстановления доступа.</li>
<li>Было обнаружено, что некоторые TCP-порты (включая как минимум порты 3785 и 179) не были заблокированы: исследователи настроили прокси-серверы на этих портах, чтобы предоставлять людям в стране доступ в интернет.</li>
<li>Было обнаружено, что DNS-трафик на UDP-порту 53 не был заблокирован, и некоторые смогли выйти в сеть с помощью DNS-туннеля.</li>
</ul>
<p>Что можно улучшить в работе исследователей:</p>
<ul>
<li>Начальная реакция могла бы быть быстрее. Было бы хорошо начать настраивать прокси в первый или второй день, а не на 4 или 5.</li>
<li>Отсутствуют преднастроенные и публичные туннели DNS. Людям приходилось делать свои собственные туннели, что значительно ограничивало круг лиц, для которых был доступен этот метод обхода.</li>
</ul>
<p>Также следует понимать, что сила даже авторитарных государств не безгранична. Казахстан столкнулся с политическими и экономическими проблемами, которые затруднили удержание интернета в отключенном состоянии. Касым-Жомарт Токаев, президент Казахстана, сказал следующее в публичном выступлении 7 января 2022:</p>
<p><a href="https://www.gov.kz/news/details/309489?lang=kk">https://www.gov.kz/news/details/309489?lang=kk</a> (<a href="https://archive.is/WpWRs">архив</a>)</p>
<blockquote>
<p>Осындай «белсенділердің» кесірінен интернет бұғатталады. Нәтижесінде миллиондаған азамат пен отандық бизнес зардап шегеді.</p>
</blockquote>
<p><a href="https://www.gov.kz/news/details/309489?lang=ru">https://www.gov.kz/news/details/309489?lang=ru</a> (<a href="https://archive.is/SGvGF">архив</a>)</p>
<blockquote>
<p>Из-за этих «активистов» «зауживается» Интернет, в результате чего страдают интересы миллионов граждан и отечественного бизнеса. То есть наносится огромный ущерб внутренней экономической, социальной и политической стабильности.</p>
</blockquote>
<p><a href="https://www.gov.kz/news/details/309489?lang=en">https://www.gov.kz/news/details/309489?lang=en</a> (<a href="https://archive.is/apKSs">архив</a>)</p>
<blockquote>
<p>Because of these activists, the use of Internet gets limited, as a result of which the interests of millions of citizens and domestic businesses suffer. In other words, internal economic, social and political stability is greatly damaged.</p>
</blockquote>
<p>Следует улучшить нашу координацию в ответ на такие внезапные события, как отключение интернет-связности, но при этом стремиться сделать так, чтобы надёжно отключать интернет стало сложнее в общем и целом.</p>
<h2><a name="h-2" class="anchor" href="#h-2"></a>Открытые порты и их сканирование</h2>
<p>09 января 2022 г. было сообщено, что в стране работают <a href="https://ntc.party/t/network-shutdown-all-around-kazakhstan/1601/14">обычные SOCKS-прокси на порту TCP 3875</a>. На следующей день было получено подтверждение, что <a href="https://ntc.party/t/network-shutdown-all-around-kazakhstan/1601/24">OpenVPN на порту UDP 3785</a> также работает. <a href="https://ntc.party/t/network-shutdown-all-around-kazakhstan/1601/20">Сканирование портов</a> показало также доступность <a href="https://ntc.party/t/network-shutdown-all-around-kazakhstan/1601/29">порта 179</a>.</p>
<p>Порты 3785 и 179 используются для маршрутизации. 3785 — <a href="https://datatracker.ietf.org/doc/html/rfc5881#section-4">bfd-echo</a> (Bidirectional Forwarding Detection Echo). Порт 179 — <a href="https://datatracker.ietf.org/doc/html/rfc4271#section-3">bgp</a> (Border Gateway Protocol). Доступность этих портов конечным пользователям можно объяснить некорректной настройкой блокировки или техническими ограничениями. Однако, следует помнить об этом в дальнейшем.</p>
<p>На факт доступности этих портов отреагировал Tor Project, открыв <a href="https://forum.torproject.net/t/internet-shutdown-in-kazakhstan-how-to-circumvent-censorship-with-tor/1679">особую службу поддержки пользователей по почте</a>, предоставляющую мосты Tor на рабочих портах. Lantern <a href="https://ntc.party/t/network-shutdown-all-around-kazakhstan/1601/28">перенастроил часть своих серверов</a> на порт 3785 и другие.</p>
<p>Сканирование портов — удобный метод для нахождения брешей в системе блокировок в целом. В случае отключения интернета он был особенно полезен, т.к. зачастую сканировать порты можно извне с такой же точностью, как и изнутри страны. Так, доступность порта 179 была обнаружена путём сканирования сети Казахстана снаружи: сначала был обнаружен хост, доступный по порту 3785, затем было произведено сканирование всех портов этого хоста. Это выглядит следующим образом в <a href="https://nmap.org/">Nmap</a>:</p>
<pre><code class="lang-plaintext"># nmap -PS3785 -sn -n gov.kz/24
Nmap scan report for 195.12.114.89
Host is up (0.21s latency).
Nmap done: 256 IP addresses (1 host up) scanned in 15.57 seconds

# nmap -Pn -n -p- --reason 195.12.114.89
Nmap scan report for 195.12.114.89
Host is up, received user-set (0.23s latency).
Not shown: 65529 filtered ports
Reason: 65529 no-responses
PORT     STATE  SERVICE       REASON
179/tcp  closed bgp           reset ttl 233
646/tcp  closed ldp           reset ttl 236
3784/tcp closed bfd-control   reset ttl 234
3785/tcp closed bfd-echo      reset ttl 234
4784/tcp closed bfd-multi-ctl reset ttl 233
5060/tcp open   sip           syn-ack ttl 50
Nmap done: 1 IP address (1 host up) scanned in 344.21 seconds
</code></pre>
<p><code>gov.kz/24</code> означает сканирование IP-адресов gov.kz и всей подсети /24, т.е. 256 соседних адресов. <a href="https://nmap.org/book/host-discovery-techniques.html#host-discovery-PS"><code>-PS3785</code></a> включает функцию обнаружения хостов с помощью отправки TCP SYN на порт 3785. <a href="https://nmap.org/book/host-discovery-controls.html#host-discovery-sn"><code>-sn</code></a> отключает полное сканирование портов и выводит только доступные хосты. <a href="https://nmap.org/book/host-discovery-dns.html"><code>-n</code></a> отключает получение обратной DNS-записи PTR. <a href="https://nmap.org/book/host-discovery-controls.html#host-enum-p0"><code>-Pn</code></a> отключает другие способы обнаружения доступности хостов и выполнит только сканирование одного порта. <a href="https://nmap.org/book/port-scanning-options.html#port-scanning-options-ports"><code>-p-</code></a> задаёт сканирование портов 0–65535. <a href="https://nmap.org/book/port-scanning-options.html#port-scanning-options-misc"><code>--reason</code></a> добавляет колонку <code>REASON</code> в вывод программы.</p>
<p>В этом случае мы уже знали о доступности порта 3785, поэтому поиск других портов был достаточно простой задачей и мог быть выполнен в пределах маленькой сети. Если о доступности портов изначально неизвестно, следует сканировать больший диапазон портов.</p>
<h2><a name="dns-3" class="anchor" href="#dns-3"></a>DNS-туннели</h2>
<p>09 января 2022 г. <a href="https://ntc.party/t/network-shutdown-all-around-kazakhstan/1601/11">пользователь сообщил</a> о работоспособности <a href="https://www.bamsoftware.com/software/dnstt/">dnstt</a> — туннеля DNS, в режиме подключения по UDP-порту 53. По-видимому, можно было использовать как провайдерский DNS-резолвер, так и публичный резолвер <a href="https://developers.google.com/speed/public-dns/docs/using#addresses">8.8.8.8 от Google</a> в качестве промежуточного узла для построения туннеля.</p>
<p>dnstt был создан отчасти как реакция на <a href="https://www.article19.org/ttn-iran-november-shutdown/">отключение работы интернета в Иране в ноябре 2019 г.</a>, когда <a href="https://ooni.org/post/2019-iran-internet-blackout/#connecting-to-the-internet-from-iran">OONI сообщали</a>, что DNS-трафик не был заблокирован. Хоть dnstt в первую очередь предназначен для использования с зашифрованным DNS (DNS через TLS или DNS через HTTPS), он поддерживает режим UDP DNS, несмотря на <a href="https://www.bamsoftware.com/software/dnstt/#caveats">неустойчивость этого режима к блокировке</a>, как раз для подобных экстремальных ситуаций.</p>
<p>Но полезность туннелей DNS была ограничена, потому что на момент отключения не было уже существующей прокси-инфраструктуры, а для человека, не подкованного с технологиях обхода, не было простого способа запустить туннельный клиент — в частности, не было готовых клиентов для мобильных устройств. Настройка туннеля DNS требует настройки некоторых записей DNS, запуска туннельного сервера на постоянно подключенном к сети компьютере и распространения связки из доменного имени и открытого ключа среди потенциальных пользователей. Выполнение некоторых из этих шагов заранее позволит нам реагировать быстрее.</p>
<p>DNS-туннели, использующие порт UDP 53, легко обнаружить, т.к. они передают доменное имя туннелирующего сервера в открытом виде. Из-за отсутствия шифрования, человек, просматривающий трафик, может обнаружить имя сервера и заблокировать его. dnstt шифрует содержимое запросов, но он не может предотвратить факт обнаружения использования DNS-туннеля. Было предложено <a href="https://ntc.party/t/idea-let-dnstt-server-respond-to-any-dns-zone/1650">улучшить программу, чтобы она отвечала на любой запрашиваемый домен</a>, что немного повысит устойчивость к блокировке, поскольку к одному и тому же серверу можно обращаться по разным именам, но даже при этом можно обнаружить туннель UDP на порту 53. Лично мне обычно не нравятся методы обхода цензуры, которые зависят от неосведомленности цензора, но я думаю, что такие вещи оправданы, поскольку мы продвигаем границы того, что может быть возможно во время отключения доступа к сети.</p>
<p>Перевод от <a class="mention" href="/u/valdikss">@ValdikSS</a>.</p>
<h1><a name="lessons-from-the-january-2022-internet-shutdown-in-kazakhstan-for-censorship-circumvention-4" class="anchor" href="#lessons-from-the-january-2022-internet-shutdown-in-kazakhstan-for-censorship-circumvention-4"></a>Lessons from the January 2022 Internet shutdown in Kazakhstan for censorship circumvention</h1>
<p>Internet access in Kazakhstan was shut down for most of the day, every day between 2022-01-05 and 2022-01-10. But the blockade was not total: people inside and outside Kazakhstan found ways to maintain a small level of connectivity. Though success was only partial, it showed that an Internet shutdown is not necessarily a hopeless situation. There are tools and techniques that we can be prepared to try in the future.</p>
<p>Background:</p>
<ul>
<li><a href="https://ntc.party/t/network-shutdown-all-around-kazakhstan/1601" class="inline-onebox">Network shutdown, all around Kazakhstan</a></li>
<li><a href="https://github.com/net4people/bbs/issues/99" class="inline-onebox">Shutdown in Kazakhstan since 2022-01-05, with brief periods of connectivity · Issue #99 · net4people/bbs · GitHub</a></li>
<li><a href="https://www.accessnow.org/kazakhstan-internet-shutdowns-protests-almaty-timeline-whats-happening/" class="inline-onebox">Kazakhstan internet shutdowns and protests: Timeline</a></li>
</ul>
<p>What worked well:</p>
<ul>
<li>People inside Kazakhstan quickly reported the onset of the shutdown (which was only on mobile networks at first). Researchers on the outside (for example <a href="https://blog.cloudflare.com/internet-shut-down-in-kazakhstan-amid-unrest/">Cloudflare Radar</a>, <a href="https://ioda.caida.org/ioda/dashboard#lastView=overview&amp;view=inspect&amp;entity=country/KZ&amp;from=1641168000&amp;until=1642032000">CAIDA IODA</a>, <a href="https://labs.ripe.net/author/emileaben/the-kazakhstan-outage-as-seen-from-ripe-atlas/">RIPE Atlas</a>) were able to collect network evidence and monitor for changes.</li>
<li>People in Kazakhstan could perform network tests, and report their results during the brief periods of restored access.</li>
<li>It was discovered that certain TCP ports (including at least ports 3785 and 179) were not blocked, and proxies were set up on those ports to help people in the country.</li>
<li>It was discovered that DNS traffic on UDP port 53 was not blocked, and some people were able to get access using a DNS tunnel.</li>
</ul>
<p>What we can do better:</p>
<ul>
<li>The initial response might have been faster. It would have been good to start setting up proxies on day 1 or 2, not day 4 or 5.</li>
<li>There was no easy-to-use DNS tunnel infrastructure already in place. People had to make their own tunnels, which effectively limited the number of people who could use this form of circumvention.</li>
</ul>
<p>It is good to remember that even authoritarians’ power is not unlimited. They face political and economic constraints that increase the cost of sustaining a shutdown. Kassym-Jomart Tokayev, the President of Kazakhstan, acknowledge the cost of the shutdown in his public address of 2022-01-07:</p>
<p><a href="https://www.gov.kz/news/details/309489?lang=kk">https://www.gov.kz/news/details/309489?lang=kk</a> (<a href="https://archive.is/WpWRs">archive</a>)</p>
<blockquote>
<p>Осындай «белсенділердің» кесірінен интернет бұғатталады. Нәтижесінде миллиондаған азамат пен отандық бизнес зардап шегеді.</p>
</blockquote>
<p><a href="https://www.gov.kz/news/details/309489?lang=ru">https://www.gov.kz/news/details/309489?lang=ru</a> (<a href="https://archive.is/SGvGF">archive</a>)</p>
<blockquote>
<p>Из-за этих «активистов» «зауживается» Интернет, в результате чего страдают интересы миллионов граждан и отечественного бизнеса. То есть наносится огромный ущерб внутренней экономической, социальной и политической стабильности.</p>
</blockquote>
<p><a href="https://www.gov.kz/news/details/309489?lang=en">https://www.gov.kz/news/details/309489?lang=en</a> (<a href="https://archive.is/apKSs">archive</a>)</p>
<blockquote>
<p>Because of these activists, the use of Internet gets limited, as a result of which the interests of millions of citizens and domestic businesses suffer. In other words, internal economic, social and political stability is greatly damaged.</p>
</blockquote>
<p>Let’s improve our ability to respond to acute situations like shutdowns, while keeping in mind a broader goal of establishing conditions in which acts like shutting down the Internet are harder to commit.</p>
<h2><a name="open-ports-and-port-scans-5" class="anchor" href="#open-ports-and-port-scans-5"></a>Open ports and port scans</h2>
<p>On 2022-01-09, it was reported that a <a href="https://ntc.party/t/network-shutdown-all-around-kazakhstan/1601/14">plain SOCKS proxy on TCP port 3875</a> worked. A day later there was confirmation that <a href="https://ntc.party/t/network-shutdown-all-around-kazakhstan/1601/24">OpenVPN on UDP port 3785</a> also worked. <a href="https://ntc.party/t/network-shutdown-all-around-kazakhstan/1601/20">Port scans</a> further revealed that <a href="https://ntc.party/t/network-shutdown-all-around-kazakhstan/1601/29">port 179 worked as well</a>.</p>
<p>Ports 3785 and 179 are related to routing. 3785 is <a href="https://datatracker.ietf.org/doc/html/rfc5881#section-4">bfd-echo</a> (Bidirectional Forwarding Detection Echo). Port 179 is <a href="https://datatracker.ietf.org/doc/html/rfc4271#section-3">bgp</a> (Border Gateway Protocol). The fact that these ports were open to ordinary users may have been only an oversight or a technical limitation. Nevertheless, it is a good thing to remember.</p>
<p>The Tor Project responded to the port-number discovery by setting up a <a href="https://forum.torproject.net/t/internet-shutdown-in-kazakhstan-how-to-circumvent-censorship-with-tor/1679">special email help line</a> for users to get a Tor bridge on a usable port. Lantern <a href="https://ntc.party/t/network-shutdown-all-around-kazakhstan/1601/28">made some of their servers</a> listen on port 3785 and others.</p>
<p>Port scanning can be a useful technique for finding holes in blockades, in general. In a shutdown situation, it can be especially useful, because it likely works equally well from the inside or the outside. In this case, the accessibility of port 179 was discovered by scanning a network in Kazakhstan, from the outside, to find a host that responded on port 3785; then scanning to see what other ports that host responded on. Using <a href="https://nmap.org/">Nmap</a>, it looks like this:</p>
<pre><code class="lang-plaintext"># nmap -PS3785 -sn -n gov.kz/24
Nmap scan report for 195.12.114.89
Host is up (0.21s latency).
Nmap done: 256 IP addresses (1 host up) scanned in 15.57 seconds

# nmap -Pn -n -p- --reason 195.12.114.89
Nmap scan report for 195.12.114.89
Host is up, received user-set (0.23s latency).
Not shown: 65529 filtered ports
Reason: 65529 no-responses
PORT     STATE  SERVICE       REASON
179/tcp  closed bgp           reset ttl 233
646/tcp  closed ldp           reset ttl 236
3784/tcp closed bfd-control   reset ttl 234
3785/tcp closed bfd-echo      reset ttl 234
4784/tcp closed bfd-multi-ctl reset ttl 233
5060/tcp open   sip           syn-ack ttl 50
Nmap done: 1 IP address (1 host up) scanned in 344.21 seconds
</code></pre>
<p><code>gov.kz/24</code> means to scan the IP address of gov.kz and its /24 network; i.e., it and the 255 addresses around it. <a href="https://nmap.org/book/host-discovery-techniques.html#host-discovery-PS"><code>-PS3785</code></a> means to do host discovery using a TCP SYN probe to port 3785. <a href="https://nmap.org/book/host-discovery-controls.html#host-discovery-sn"><code>-sn</code></a> means to only report the hosts that are up, do not port scan yet. <a href="https://nmap.org/book/host-discovery-dns.html"><code>-n</code></a> means not to do reverse DNS resolution. <a href="https://nmap.org/book/host-discovery-controls.html#host-enum-p0"><code>-Pn</code></a> means to skip host discovery and only do a port scan. <a href="https://nmap.org/book/port-scanning-options.html#port-scanning-options-ports"><code>-p-</code></a> means to scan all 65536 TCP ports. <a href="https://nmap.org/book/port-scanning-options.html#port-scanning-options-misc"><code>--reason</code></a> adds the <code>REASON</code> column to the output.</p>
<p>In this case, we had the advantage of already knowing that port 3785 was accessible, so it was relatively easy to find other ports, by scanning a small network. If no ports are known in advance, you may have to start with a wider scan over a large range of ports.</p>
<h2><a name="dns-tunnels-6" class="anchor" href="#dns-tunnels-6"></a>DNS tunnels</h2>
<p>On 2022-01-09, <a href="https://ntc.party/t/network-shutdown-all-around-kazakhstan/1601/11">a user reported</a> having success with <a href="https://www.bamsoftware.com/software/dnstt/">dnstt</a>, a DNS tunnel, in its UDP port 53 mode. Apparently, one could use either an ISP resolver, or <a href="https://developers.google.com/speed/public-dns/docs/using#addresses">Google’s 8.8.8.8</a>, as the recursive resolver in the middle of the tunnel.</p>
<p>dnstt was created, in part, as a reaction to the <a href="https://www.article19.org/ttn-iran-november-shutdown/">November 2019 shutdown in Iran</a>, when <a href="https://ooni.org/post/2019-iran-internet-blackout/#connecting-to-the-internet-from-iran">OONI reported</a> that DNS traffic was not blocked. Although dnstt is primarily intended to be used with encrypted DNS (DNS over TLS or DNS over HTTPS), it retains a UDP DNS mode, even though that mode is <a href="https://www.bamsoftware.com/software/dnstt/#caveats">not resistant to blocking</a>, precisely because it may be useful in an extreme situation such as a shutdown.</p>
<p>But the usefulness of DNS tunnels was limited, because there was no alredy existing proxy infrastructure in place at the time of the shutdown, and no easy way for someone without technical ability to run a tunnel client—in particular there was no ready-made mobile app. Setting up a DNS tunnel requires setting some DNS records, running a tunnel server on an always-on network-connected computer, and distributing the server’s domain name and public key to potential users. Doing some of these steps in advance would let us respond more quickly.</p>
<p>DNS tunnels that use UDP port 53 are detectable because they must include the domain name of the tunnel server. Without some form of encrypted DNS, a middlebox observer can look for DNS queries that are addressed to known tunnel servers, and block them. (dnstt encrypts the <em>contents</em> of the tunnel, but without encrypted DNS it cannot hide the <em>existence</em> of the tunnel.) There is a proposal to <a href="https://ntc.party/t/idea-let-dnstt-server-respond-to-any-dns-zone/1650">let the dnstt tunnel server respond to any domain name</a>, which would enhance blocking resistance a bit, because the same server could be addressed by many names, but even with this a UDP port 53 tunnel is detectable. Personally, I do not normally like circumvention strategies that depend on a censor being ignorant, but I think it is justifiable to try things like this, as we advance the frontiers of what may be possible during a shutdown.</p></td><td>2022-02-07T16:47:13.671Z</td></tr><tr><td>zinoid</td><td><p>No one has had any precedent for accessing the Internet via (full-duplex) satellite? I think this is the most acceptable solution. It is possible to mask it under a TV receiver.</p>
<p>By the way, in Turkmenistan a few years ago many people had satellite TV (because of undeveloped and miserable central TV). Then the government started getting rid of them. It was possible to hide the Internet among them.<br>
// judging by Varlamov’s photo reports.</p></td><td>2022-02-07T22:45:51.695Z</td></tr>
    </table>
      </body>
    </html>